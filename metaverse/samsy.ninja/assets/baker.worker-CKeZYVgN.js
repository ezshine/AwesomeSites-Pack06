(function(){"use strict";/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const S0="181dev",A0="attached",Sy="detached",ue="srgb",ze="srgb-linear",N0="linear",na="srgb";function Ay(r){for(let t=r.length-1;t>=0;--t)if(r[t]>=65535)return!0;return!1}function jl(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}const R0={};function Gl(...r){const t="THREE."+r.shift()}function j(...r){const t="THREE."+r.shift()}function et(...r){const t="THREE."+r.shift()}function E0(...r){const t=r.join(" ");t in R0||(R0[t]=!0,j(...r))}let vs=class{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){const i=this._listeners;return i!==void 0&&i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){const i=this._listeners;if(i===void 0)return;const s=i[t];if(s!==void 0){const n=s.indexOf(e);n!==-1&&s.splice(n,1)}}dispatchEvent(t){const e=this._listeners;if(e===void 0)return;const i=e[t.type];if(i!==void 0){t.target=this;const s=i.slice(0);for(let n=0,a=s.length;n<a;n++)s[n].call(this,t);t.target=null}}};const ce=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let I0=1234567;const ra=Math.PI/180,aa=180/Math.PI;function ai(){const r=4294967295*Math.random()|0,t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(ce[255&r]+ce[r>>8&255]+ce[r>>16&255]+ce[r>>24&255]+"-"+ce[255&t]+ce[t>>8&255]+"-"+ce[t>>16&15|64]+ce[t>>24&255]+"-"+ce[63&e|128]+ce[e>>8&255]+"-"+ce[e>>16&255]+ce[e>>24&255]+ce[255&i]+ce[i>>8&255]+ce[i>>16&255]+ce[i>>24&255]).toLowerCase()}function ht(r,t,e){return Math.max(t,Math.min(e,r))}function Yl(r,t){return(r%t+t)%t}function oa(r,t,e){return(1-e)*r+e*t}function oi(r,t){switch(t.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function _t(r,t){switch(t.constructor){case Float32Array:return r;case Uint32Array:return Math.round(4294967295*r);case Uint16Array:return Math.round(65535*r);case Uint8Array:return Math.round(255*r);case Int32Array:return Math.round(2147483647*r);case Int16Array:return Math.round(32767*r);case Int8Array:return Math.round(127*r);default:throw new Error("Invalid component type.")}}const Zl={DEG2RAD:ra,RAD2DEG:aa,generateUUID:ai,clamp:ht,euclideanModulo:Yl,mapLinear:function(r,t,e,i,s){return i+(r-t)*(s-i)/(e-t)},inverseLerp:function(r,t,e){return r!==t?(e-r)/(t-r):0},lerp:oa,damp:function(r,t,e,i){return oa(r,t,1-Math.exp(-e*i))},pingpong:function(r,t=1){return t-Math.abs(Yl(r,2*t)-t)},smoothstep:function(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t))*r*(3-2*r)},smootherstep:function(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t))*r*r*(r*(6*r-15)+10)},randInt:function(r,t){return r+Math.floor(Math.random()*(t-r+1))},randFloat:function(r,t){return r+Math.random()*(t-r)},randFloatSpread:function(r){return r*(.5-Math.random())},seededRandom:function(r){r!==void 0&&(I0=r);let t=I0+=1831565813;return t=Math.imul(t^t>>>15,1|t),t^=t+Math.imul(t^t>>>7,61|t),((t^t>>>14)>>>0)/4294967296},degToRad:function(r){return r*ra},radToDeg:function(r){return r*aa},isPowerOfTwo:function(r){return!(r&r-1)&&r!==0},ceilPowerOfTwo:function(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},floorPowerOfTwo:function(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},setQuaternionFromProperEuler:function(r,t,e,i,s){const n=Math.cos,a=Math.sin,o=n(e/2),h=a(e/2),l=n((t+i)/2),u=a((t+i)/2),c=n((t-i)/2),d=a((t-i)/2),p=n((i-t)/2),m=a((i-t)/2);switch(s){case"XYX":r.set(o*u,h*c,h*d,o*l);break;case"YZY":r.set(h*d,o*u,h*c,o*l);break;case"ZXZ":r.set(h*c,h*d,o*u,o*l);break;case"XZX":r.set(o*u,h*m,h*p,o*l);break;case"YXY":r.set(h*p,o*u,h*m,o*l);break;case"ZYZ":r.set(h*m,h*p,o*u,o*l);break;default:j("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}},normalize:_t,denormalize:oi};class nt{constructor(t=0,e=0){nt.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6],this.y=s[1]*e+s[4]*i+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=ht(this.x,t.x,e.x),this.y=ht(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=ht(this.x,t,e),this.y=ht(this.y,t,e),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(ht(i,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(ht(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),s=Math.sin(e),n=this.x-t.x,a=this.y-t.y;return this.x=n*i-a*s+t.x,this.y=n*s+a*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Te{constructor(t=0,e=0,i=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=s}static slerpFlat(t,e,i,s,n,a,o){let h=i[s+0],l=i[s+1],u=i[s+2],c=i[s+3];const d=n[a+0],p=n[a+1],m=n[a+2],f=n[a+3];if(o===0)return t[e+0]=h,t[e+1]=l,t[e+2]=u,void(t[e+3]=c);if(o===1)return t[e+0]=d,t[e+1]=p,t[e+2]=m,void(t[e+3]=f);if(c!==f||h!==d||l!==p||u!==m){let g=1-o;const y=h*d+l*p+u*m+c*f,x=y>=0?1:-1,_=1-y*y;if(_>Number.EPSILON){const v=Math.sqrt(_),N=Math.atan2(v,y*x);g=Math.sin(g*N)/v,o=Math.sin(o*N)/v}const M=o*x;if(h=h*g+d*M,l=l*g+p*M,u=u*g+m*M,c=c*g+f*M,g===1-o){const v=1/Math.sqrt(h*h+l*l+u*u+c*c);h*=v,l*=v,u*=v,c*=v}}t[e]=h,t[e+1]=l,t[e+2]=u,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,s,n,a){const o=i[s],h=i[s+1],l=i[s+2],u=i[s+3],c=n[a],d=n[a+1],p=n[a+2],m=n[a+3];return t[e]=o*m+u*c+h*p-l*d,t[e+1]=h*m+u*d+l*c-o*p,t[e+2]=l*m+u*p+o*d-h*c,t[e+3]=u*m-o*c-h*d-l*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,s){return this._x=t,this._y=e,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const i=t._x,s=t._y,n=t._z,a=t._order,o=Math.cos,h=Math.sin,l=o(i/2),u=o(s/2),c=o(n/2),d=h(i/2),p=h(s/2),m=h(n/2);switch(a){case"XYZ":this._x=d*u*c+l*p*m,this._y=l*p*c-d*u*m,this._z=l*u*m+d*p*c,this._w=l*u*c-d*p*m;break;case"YXZ":this._x=d*u*c+l*p*m,this._y=l*p*c-d*u*m,this._z=l*u*m-d*p*c,this._w=l*u*c+d*p*m;break;case"ZXY":this._x=d*u*c-l*p*m,this._y=l*p*c+d*u*m,this._z=l*u*m+d*p*c,this._w=l*u*c-d*p*m;break;case"ZYX":this._x=d*u*c-l*p*m,this._y=l*p*c+d*u*m,this._z=l*u*m-d*p*c,this._w=l*u*c+d*p*m;break;case"YZX":this._x=d*u*c+l*p*m,this._y=l*p*c+d*u*m,this._z=l*u*m-d*p*c,this._w=l*u*c-d*p*m;break;case"XZY":this._x=d*u*c-l*p*m,this._y=l*p*c-d*u*m,this._z=l*u*m+d*p*c,this._w=l*u*c+d*p*m;break;default:j("Quaternion: .setFromEuler() encountered an unknown order: "+a)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],n=e[8],a=e[1],o=e[5],h=e[9],l=e[2],u=e[6],c=e[10],d=i+o+c;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(u-h)*p,this._y=(n-l)*p,this._z=(a-s)*p}else if(i>o&&i>c){const p=2*Math.sqrt(1+i-o-c);this._w=(u-h)/p,this._x=.25*p,this._y=(s+a)/p,this._z=(n+l)/p}else if(o>c){const p=2*Math.sqrt(1+o-i-c);this._w=(n-l)/p,this._x=(s+a)/p,this._y=.25*p,this._z=(h+u)/p}else{const p=2*Math.sqrt(1+c-i-o);this._w=(a-s)/p,this._x=(n+l)/p,this._y=(h+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<1e-8?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(ht(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(i===0)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,n=t._z,a=t._w,o=e._x,h=e._y,l=e._z,u=e._w;return this._x=i*u+a*o+s*l-n*h,this._y=s*u+a*h+n*o-i*l,this._z=n*u+a*l+i*h-s*o,this._w=a*u-i*o-s*h-n*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const i=this._x,s=this._y,n=this._z,a=this._w;let o=a*t._w+i*t._x+s*t._y+n*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=i,this._y=s,this._z=n,this;const h=1-o*o;if(h<=Number.EPSILON){const p=1-e;return this._w=p*a+e*this._w,this._x=p*i+e*this._x,this._y=p*s+e*this._y,this._z=p*n+e*this._z,this.normalize(),this}const l=Math.sqrt(h),u=Math.atan2(l,o),c=Math.sin((1-e)*u)/l,d=Math.sin(e*u)/l;return this._w=a*c+this._w*d,this._x=i*c+this._x*d,this._y=s*c+this._y*d,this._z=n*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),i=Math.random(),s=Math.sqrt(1-i),n=Math.sqrt(i);return this.set(s*Math.sin(t),s*Math.cos(t),n*Math.sin(e),n*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class S{constructor(t=0,e=0,i=0){S.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(C0.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(C0.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,s=this.z,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6]*s,this.y=n[1]*e+n[4]*i+n[7]*s,this.z=n[2]*e+n[5]*i+n[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,n=t.elements,a=1/(n[3]*e+n[7]*i+n[11]*s+n[15]);return this.x=(n[0]*e+n[4]*i+n[8]*s+n[12])*a,this.y=(n[1]*e+n[5]*i+n[9]*s+n[13])*a,this.z=(n[2]*e+n[6]*i+n[10]*s+n[14])*a,this}applyQuaternion(t){const e=this.x,i=this.y,s=this.z,n=t.x,a=t.y,o=t.z,h=t.w,l=2*(a*s-o*i),u=2*(o*e-n*s),c=2*(n*i-a*e);return this.x=e+h*l+a*c-o*u,this.y=i+h*u+o*l-n*c,this.z=s+h*c+n*u-a*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,s=this.z,n=t.elements;return this.x=n[0]*e+n[4]*i+n[8]*s,this.y=n[1]*e+n[5]*i+n[9]*s,this.z=n[2]*e+n[6]*i+n[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=ht(this.x,t.x,e.x),this.y=ht(this.y,t.y,e.y),this.z=ht(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=ht(this.x,t,e),this.y=ht(this.y,t,e),this.z=ht(this.z,t,e),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(ht(i,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,n=t.z,a=e.x,o=e.y,h=e.z;return this.x=s*h-n*o,this.y=n*a-i*h,this.z=i*o-s*a,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return Jl.copy(this).projectOnVector(t),this.sub(Jl)}reflect(t){return this.sub(Jl.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(ht(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this.x=s*Math.sin(i),this.y=Math.cos(e)*t,this.z=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,i=Math.sqrt(1-e*e);return this.x=i*Math.cos(t),this.y=e,this.z=i*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Jl=new S,C0=new Te;class He{constructor(t,e,i,s,n,a,o,h,l){He.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,i,s,n,a,o,h,l)}set(t,e,i,s,n,a,o,h,l){const u=this.elements;return u[0]=t,u[1]=s,u[2]=o,u[3]=e,u[4]=n,u[5]=h,u[6]=i,u[7]=a,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,n=this.elements,a=i[0],o=i[3],h=i[6],l=i[1],u=i[4],c=i[7],d=i[2],p=i[5],m=i[8],f=s[0],g=s[3],y=s[6],x=s[1],_=s[4],M=s[7],v=s[2],N=s[5],T=s[8];return n[0]=a*f+o*x+h*v,n[3]=a*g+o*_+h*N,n[6]=a*y+o*M+h*T,n[1]=l*f+u*x+c*v,n[4]=l*g+u*_+c*N,n[7]=l*y+u*M+c*T,n[2]=d*f+p*x+m*v,n[5]=d*g+p*_+m*N,n[8]=d*y+p*M+m*T,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],s=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=t[8];return e*a*u-e*o*l-i*n*u+i*o*h+s*n*l-s*a*h}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=t[8],c=u*a-o*l,d=o*h-u*n,p=l*n-a*h,m=e*c+i*d+s*p;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const f=1/m;return t[0]=c*f,t[1]=(s*l-u*i)*f,t[2]=(o*i-s*a)*f,t[3]=d*f,t[4]=(u*e-s*h)*f,t[5]=(s*n-o*e)*f,t[6]=p*f,t[7]=(i*h-l*e)*f,t[8]=(a*e-i*n)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,s,n,a,o){const h=Math.cos(n),l=Math.sin(n);return this.set(i*h,i*l,-i*(h*a+l*o)+a+t,-s*l,s*h,-s*(-l*a+h*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(Ql.makeScale(t,e)),this}rotate(t){return this.premultiply(Ql.makeRotation(-t)),this}translate(t,e){return this.premultiply(Ql.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,i=t.elements;for(let s=0;s<9;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Ql=new He,z0=new He().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),L0=new He().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Ny(){const r={enabled:!0,workingColorSpace:ze,spaces:{},convert:function(s,n,a){return this.enabled!==!1&&n!==a&&n&&a&&(this.spaces[n].transfer===na&&(s.r=ji(s.r),s.g=ji(s.g),s.b=ji(s.b)),this.spaces[n].primaries!==this.spaces[a].primaries&&(s.applyMatrix3(this.spaces[n].toXYZ),s.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===na&&(s.r=Un(s.r),s.g=Un(s.g),s.b=Un(s.b))),s},workingToColorSpace:function(s,n){return this.convert(s,this.workingColorSpace,n)},colorSpaceToWorking:function(s,n){return this.convert(s,n,this.workingColorSpace)},getPrimaries:function(s){return this.spaces[s].primaries},getTransfer:function(s){return s===""?N0:this.spaces[s].transfer},getToneMappingMode:function(s){return this.spaces[s].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(s,n=this.workingColorSpace){return s.fromArray(this.spaces[n].luminanceCoefficients)},define:function(s){Object.assign(this.spaces,s)},_getMatrix:function(s,n,a){return s.copy(this.spaces[n].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(s){return this.spaces[s].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(s=this.workingColorSpace){return this.spaces[s].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(s,n){return E0("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),r.workingToColorSpace(s,n)},toWorkingColorSpace:function(s,n){return E0("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),r.colorSpaceToWorking(s,n)}},t=[.64,.33,.3,.6,.15,.06],e=[.2126,.7152,.0722],i=[.3127,.329];return r.define({[ze]:{primaries:t,whitePoint:i,transfer:N0,toXYZ:z0,fromXYZ:L0,luminanceCoefficients:e,workingColorSpaceConfig:{unpackColorSpace:ue},outputColorSpaceConfig:{drawingBufferColorSpace:ue}},[ue]:{primaries:t,whitePoint:i,transfer:na,toXYZ:z0,fromXYZ:L0,luminanceCoefficients:e,outputColorSpaceConfig:{drawingBufferColorSpace:ue}}}),r}const Vt=Ny();function ji(r){return r<.04045?.0773993808*r:Math.pow(.9478672986*r+.0521327014,2.4)}function Un(r){return r<.0031308?12.92*r:1.055*Math.pow(r,.41666)-.055}let Wn,Ry=class{static getDataURL(t,e="image/png"){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let i;if(t instanceof HTMLCanvasElement)i=t;else{Wn===void 0&&(Wn=jl("canvas")),Wn.width=t.width,Wn.height=t.height;const s=Wn.getContext("2d");t instanceof ImageData?s.putImageData(t,0,0):s.drawImage(t,0,0,t.width,t.height),i=Wn}return i.toDataURL(e)}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=jl("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const s=i.getImageData(0,0,t.width,t.height),n=s.data;for(let a=0;a<n.length;a++)n[a]=255*ji(n[a]/255);return i.putImageData(s,0,0),e}if(t.data){const e=t.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(255*ji(e[i]/255)):e[i]=ji(e[i]);return{data:e,width:t.width,height:t.height}}return j("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}},Ey=0;class Kl{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Ey++}),this.uuid=ai(),this.data=t,this.dataReady=!0,this.version=0}getSize(t){const e=this.data;return typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?t.set(e.videoWidth,e.videoHeight,0):e instanceof VideoFrame?t.set(e.displayHeight,e.displayWidth,0):e!==null?t.set(e.width,e.height,e.depth||0):t.set(0,0,0),t}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let n;if(Array.isArray(s)){n=[];for(let a=0,o=s.length;a<o;a++)s[a].isDataTexture?n.push(tu(s[a].image)):n.push(tu(s[a]))}else n=tu(s);i.url=n}return e||(t.images[this.uuid]=i),i}}function tu(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?Ry.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(j("Texture: Unable to serialize Texture."),{})}let Iy=0;const eu=new S;let Se=class Wl extends vs{constructor(t=Wl.DEFAULT_IMAGE,e=Wl.DEFAULT_MAPPING,i=1001,s=1001,n=1006,a=1008,o=1023,h=1009,l=Wl.DEFAULT_ANISOTROPY,u=""){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Iy++}),this.uuid=ai(),this.name="",this.source=new Kl(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=n,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=h,this.offset=new nt(0,0),this.repeat=new nt(1,1),this.center=new nt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new He,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(t&&t.depth&&t.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(eu).x}get height(){return this.source.getSize(eu).y}get depth(){return this.source.getSize(eu).z}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.isArrayTexture=t.isArrayTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}setValues(t){for(const e in t){const i=t[e];if(i===void 0){j(`Texture.setValues(): parameter '${e}' has value of undefined.`);continue}const s=this[e];s!==void 0?s&&i&&s.isVector2&&i.isVector2||s&&i&&s.isVector3&&i.isVector3||s&&i&&s.isMatrix3&&i.isMatrix3?s.copy(i):this[e]=i:j(`Texture.setValues(): property '${e}' does not exist.`)}}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const i={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==300)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case 1001:t.x=t.x<0?0:1;break;case 1002:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case 1001:t.y=t.y<0?0:1;break;case 1002:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}};Se.DEFAULT_IMAGE=null,Se.DEFAULT_MAPPING=300,Se.DEFAULT_ANISOTROPY=1;let wt=class hy{constructor(t=0,e=0,i=0,s=1){hy.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=s}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,s){return this.x=t,this.y=e,this.z=i,this.w=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,n=this.w,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*s+a[12]*n,this.y=a[1]*e+a[5]*i+a[9]*s+a[13]*n,this.z=a[2]*e+a[6]*i+a[10]*s+a[14]*n,this.w=a[3]*e+a[7]*i+a[11]*s+a[15]*n,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,s,n;const h=t.elements,l=h[0],u=h[4],c=h[8],d=h[1],p=h[5],m=h[9],f=h[2],g=h[6],y=h[10];if(Math.abs(u-d)<.01&&Math.abs(c-f)<.01&&Math.abs(m-g)<.01){if(Math.abs(u+d)<.1&&Math.abs(c+f)<.1&&Math.abs(m+g)<.1&&Math.abs(l+p+y-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const _=(l+1)/2,M=(p+1)/2,v=(y+1)/2,N=(u+d)/4,T=(c+f)/4,C=(m+g)/4;return _>M&&_>v?_<.01?(i=0,s=.707106781,n=.707106781):(i=Math.sqrt(_),s=N/i,n=T/i):M>v?M<.01?(i=.707106781,s=0,n=.707106781):(s=Math.sqrt(M),i=N/s,n=C/s):v<.01?(i=.707106781,s=.707106781,n=0):(n=Math.sqrt(v),i=T/n,s=C/n),this.set(i,s,n,e),this}let x=Math.sqrt((g-m)*(g-m)+(c-f)*(c-f)+(d-u)*(d-u));return Math.abs(x)<.001&&(x=1),this.x=(g-m)/x,this.y=(c-f)/x,this.z=(d-u)/x,this.w=Math.acos((l+p+y-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=ht(this.x,t.x,e.x),this.y=ht(this.y,t.y,e.y),this.z=ht(this.z,t.z,e.z),this.w=ht(this.w,t.w,e.w),this}clampScalar(t,e){return this.x=ht(this.x,t,e),this.y=ht(this.y,t,e),this.z=ht(this.z,t,e),this.w=ht(this.w,t,e),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(ht(i,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},yo=class extends vs{constructor(t=1,e=1,i={}){super(),i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:1006,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},i),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=i.depth,this.scissor=new wt(0,0,t,e),this.scissorTest=!1,this.viewport=new wt(0,0,t,e);const s={width:t,height:e,depth:i.depth},n=new Se(s);this.textures=[];const a=i.count;for(let o=0;o<a;o++)this.textures[o]=n.clone(),this.textures[o].isRenderTargetTexture=!0,this.textures[o].renderTarget=this;this._setTextureOptions(i),this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=i.depthTexture,this.samples=i.samples,this.multiview=i.multiview}_setTextureOptions(t={}){const e={minFilter:1006,generateMipmaps:!1,flipY:!1,internalFormat:null};t.mapping!==void 0&&(e.mapping=t.mapping),t.wrapS!==void 0&&(e.wrapS=t.wrapS),t.wrapT!==void 0&&(e.wrapT=t.wrapT),t.wrapR!==void 0&&(e.wrapR=t.wrapR),t.magFilter!==void 0&&(e.magFilter=t.magFilter),t.minFilter!==void 0&&(e.minFilter=t.minFilter),t.format!==void 0&&(e.format=t.format),t.type!==void 0&&(e.type=t.type),t.anisotropy!==void 0&&(e.anisotropy=t.anisotropy),t.colorSpace!==void 0&&(e.colorSpace=t.colorSpace),t.flipY!==void 0&&(e.flipY=t.flipY),t.generateMipmaps!==void 0&&(e.generateMipmaps=t.generateMipmaps),t.internalFormat!==void 0&&(e.internalFormat=t.internalFormat);for(let i=0;i<this.textures.length;i++)this.textures[i].setValues(e)}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}set depthTexture(t){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),t!==null&&(t.renderTarget=this),this._depthTexture=t}get depthTexture(){return this._depthTexture}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let s=0,n=this.textures.length;s<n;s++)this.textures[s].image.width=t,this.textures[s].image.height=e,this.textures[s].image.depth=i,this.textures[s].isArrayTexture=this.textures[s].image.depth>1;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let e=0,i=t.textures.length;e<i;e++){this.textures[e]=t.textures[e].clone(),this.textures[e].isRenderTargetTexture=!0,this.textures[e].renderTarget=this;const s=Object.assign({},t.textures[e].image);this.textures[e].source=new Kl(s)}return this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}},Cy=class extends yo{constructor(t=1,e=1,i={}){super(t,e,i),this.isWebGLRenderTarget=!0}},zy=class extends Se{constructor(t=null,e=1,i=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:s},this.magFilter=1003,this.minFilter=1003,this.wrapR=1001,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}},hi=class{constructor(t=new S(1/0,1/0,1/0),e=new S(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e+=3)this.expandByPoint(li.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,i=t.count;e<i;e++)this.expandByPoint(li.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=li.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(i!==void 0){const n=i.getAttribute("position");if(e===!0&&n!==void 0&&t.isInstancedMesh!==!0)for(let a=0,o=n.count;a<o;a++)t.isMesh===!0?t.getVertexPosition(a,li):li.fromBufferAttribute(n,a),li.applyMatrix4(t.matrixWorld),this.expandByPoint(li);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),xo.copy(t.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),xo.copy(i.boundingBox)),xo.applyMatrix4(t.matrixWorld),this.union(xo)}const s=t.children;for(let n=0,a=s.length;n<a;n++)this.expandByObject(s[n],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,li),li.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ha),bo.subVectors(this.max,ha),Hn.subVectors(t.a,ha),qn.subVectors(t.b,ha),$n.subVectors(t.c,ha),ws.subVectors(qn,Hn),Ts.subVectors($n,qn),sn.subVectors(Hn,$n);let e=[0,-ws.z,ws.y,0,-Ts.z,Ts.y,0,-sn.z,sn.y,ws.z,0,-ws.x,Ts.z,0,-Ts.x,sn.z,0,-sn.x,-ws.y,ws.x,0,-Ts.y,Ts.x,0,-sn.y,sn.x,0];return!!iu(e,Hn,qn,$n,bo)&&(e=[1,0,0,0,1,0,0,0,1],!!iu(e,Hn,qn,$n,bo)&&(Mo.crossVectors(ws,Ts),e=[Mo.x,Mo.y,Mo.z],iu(e,Hn,qn,$n,bo)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,li).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(li).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Gi[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Gi[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Gi[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Gi[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Gi[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Gi[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Gi[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Gi[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Gi)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(t){return this.min.fromArray(t.min),this.max.fromArray(t.max),this}};const Gi=[new S,new S,new S,new S,new S,new S,new S,new S],li=new S,xo=new hi,Hn=new S,qn=new S,$n=new S,ws=new S,Ts=new S,sn=new S,ha=new S,bo=new S,Mo=new S,nn=new S;function iu(r,t,e,i,s){for(let n=0,a=r.length-3;n<=a;n+=3){nn.fromArray(r,n);const o=s.x*Math.abs(nn.x)+s.y*Math.abs(nn.y)+s.z*Math.abs(nn.z),h=t.dot(nn),l=e.dot(nn),u=i.dot(nn);if(Math.max(-Math.max(h,l,u),Math.min(h,l,u))>o)return!1}return!0}const Ly=new hi,la=new S,su=new S;class qe{constructor(t=new S,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;e!==void 0?i.copy(e):Ly.setFromPoints(t).getCenter(i);let s=0;for(let n=0,a=t.length;n<a;n++)s=Math.max(s,i.distanceToSquared(t[n]));return this.radius=Math.sqrt(s),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;la.subVectors(t,this.center);const e=la.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),s=.5*(i-this.radius);this.center.addScaledVector(la,s/i),this.radius+=s}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(su.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(la.copy(t.center).add(su)),this.expandByPoint(la.copy(t.center).sub(su))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(t){return this.radius=t.radius,this.center.fromArray(t.center),this}}const Yi=new S,nu=new S,_o=new S,Ss=new S,ru=new S,vo=new S,au=new S;class wo{constructor(t=new S,e=new S(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Yi)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Yi.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Yi.copy(this.origin).addScaledVector(this.direction,e),Yi.distanceToSquared(t))}distanceSqToSegment(t,e,i,s){nu.copy(t).add(e).multiplyScalar(.5),_o.copy(e).sub(t).normalize(),Ss.copy(this.origin).sub(nu);const n=.5*t.distanceTo(e),a=-this.direction.dot(_o),o=Ss.dot(this.direction),h=-Ss.dot(_o),l=Ss.lengthSq(),u=Math.abs(1-a*a);let c,d,p,m;if(u>0)if(c=a*h-o,d=a*o-h,m=n*u,c>=0)if(d>=-m)if(d<=m){const f=1/u;c*=f,d*=f,p=c*(c+a*d+2*o)+d*(a*c+d+2*h)+l}else d=n,c=Math.max(0,-(a*d+o)),p=-c*c+d*(d+2*h)+l;else d=-n,c=Math.max(0,-(a*d+o)),p=-c*c+d*(d+2*h)+l;else d<=-m?(c=Math.max(0,-(-a*n+o)),d=c>0?-n:Math.min(Math.max(-n,-h),n),p=-c*c+d*(d+2*h)+l):d<=m?(c=0,d=Math.min(Math.max(-n,-h),n),p=d*(d+2*h)+l):(c=Math.max(0,-(a*n+o)),d=c>0?n:Math.min(Math.max(-n,-h),n),p=-c*c+d*(d+2*h)+l);else d=a>0?-n:n,c=Math.max(0,-(a*d+o)),p=-c*c+d*(d+2*h)+l;return i&&i.copy(this.origin).addScaledVector(this.direction,c),s&&s.copy(nu).addScaledVector(_o,d),p}intersectSphere(t,e){Yi.subVectors(t.center,this.origin);const i=Yi.dot(this.direction),s=Yi.dot(Yi)-i*i,n=t.radius*t.radius;if(s>n)return null;const a=Math.sqrt(n-s),o=i-a,h=i+a;return h<0?null:o<0?this.at(h,e):this.at(o,e)}intersectsSphere(t){return!(t.radius<0)&&this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return i===null?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0?!0:t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,s,n,a,o,h;const l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,d=this.origin;return l>=0?(i=(t.min.x-d.x)*l,s=(t.max.x-d.x)*l):(i=(t.max.x-d.x)*l,s=(t.min.x-d.x)*l),u>=0?(n=(t.min.y-d.y)*u,a=(t.max.y-d.y)*u):(n=(t.max.y-d.y)*u,a=(t.min.y-d.y)*u),i>a||n>s?null:((n>i||isNaN(i))&&(i=n),(a<s||isNaN(s))&&(s=a),c>=0?(o=(t.min.z-d.z)*c,h=(t.max.z-d.z)*c):(o=(t.max.z-d.z)*c,h=(t.min.z-d.z)*c),i>h||o>s?null:((o>i||i!=i)&&(i=o),(h<s||s!=s)&&(s=h),s<0?null:this.at(i>=0?i:s,e)))}intersectsBox(t){return this.intersectBox(t,Yi)!==null}intersectTriangle(t,e,i,s,n){ru.subVectors(e,t),vo.subVectors(i,t),au.crossVectors(ru,vo);let a,o=this.direction.dot(au);if(o>0){if(s)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}Ss.subVectors(this.origin,t);const h=a*this.direction.dot(vo.crossVectors(Ss,vo));if(h<0)return null;const l=a*this.direction.dot(ru.cross(Ss));if(l<0||h+l>o)return null;const u=-a*Ss.dot(au);return u<0?null:this.at(u/o,n)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class G{constructor(t,e,i,s,n,a,o,h,l,u,c,d,p,m,f,g){G.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,i,s,n,a,o,h,l,u,c,d,p,m,f,g)}set(t,e,i,s,n,a,o,h,l,u,c,d,p,m,f,g){const y=this.elements;return y[0]=t,y[4]=e,y[8]=i,y[12]=s,y[1]=n,y[5]=a,y[9]=o,y[13]=h,y[2]=l,y[6]=u,y[10]=c,y[14]=d,y[3]=p,y[7]=m,y[11]=f,y[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new G().fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,s=1/Xn.setFromMatrixColumn(t,0).length(),n=1/Xn.setFromMatrixColumn(t,1).length(),a=1/Xn.setFromMatrixColumn(t,2).length();return e[0]=i[0]*s,e[1]=i[1]*s,e[2]=i[2]*s,e[3]=0,e[4]=i[4]*n,e[5]=i[5]*n,e[6]=i[6]*n,e[7]=0,e[8]=i[8]*a,e[9]=i[9]*a,e[10]=i[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,s=t.y,n=t.z,a=Math.cos(i),o=Math.sin(i),h=Math.cos(s),l=Math.sin(s),u=Math.cos(n),c=Math.sin(n);if(t.order==="XYZ"){const d=a*u,p=a*c,m=o*u,f=o*c;e[0]=h*u,e[4]=-h*c,e[8]=l,e[1]=p+m*l,e[5]=d-f*l,e[9]=-o*h,e[2]=f-d*l,e[6]=m+p*l,e[10]=a*h}else if(t.order==="YXZ"){const d=h*u,p=h*c,m=l*u,f=l*c;e[0]=d+f*o,e[4]=m*o-p,e[8]=a*l,e[1]=a*c,e[5]=a*u,e[9]=-o,e[2]=p*o-m,e[6]=f+d*o,e[10]=a*h}else if(t.order==="ZXY"){const d=h*u,p=h*c,m=l*u,f=l*c;e[0]=d-f*o,e[4]=-a*c,e[8]=m+p*o,e[1]=p+m*o,e[5]=a*u,e[9]=f-d*o,e[2]=-a*l,e[6]=o,e[10]=a*h}else if(t.order==="ZYX"){const d=a*u,p=a*c,m=o*u,f=o*c;e[0]=h*u,e[4]=m*l-p,e[8]=d*l+f,e[1]=h*c,e[5]=f*l+d,e[9]=p*l-m,e[2]=-l,e[6]=o*h,e[10]=a*h}else if(t.order==="YZX"){const d=a*h,p=a*l,m=o*h,f=o*l;e[0]=h*u,e[4]=f-d*c,e[8]=m*c+p,e[1]=c,e[5]=a*u,e[9]=-o*u,e[2]=-l*u,e[6]=p*c+m,e[10]=d-f*c}else if(t.order==="XZY"){const d=a*h,p=a*l,m=o*h,f=o*l;e[0]=h*u,e[4]=-c,e[8]=l*u,e[1]=d*c+f,e[5]=a*u,e[9]=p*c-m,e[2]=m*c-p,e[6]=o*u,e[10]=f*c+d}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Py,t,By)}lookAt(t,e,i){const s=this.elements;return Le.subVectors(t,e),Le.lengthSq()===0&&(Le.z=1),Le.normalize(),As.crossVectors(i,Le),As.lengthSq()===0&&(Math.abs(i.z)===1?Le.x+=1e-4:Le.z+=1e-4,Le.normalize(),As.crossVectors(i,Le)),As.normalize(),To.crossVectors(Le,As),s[0]=As.x,s[4]=To.x,s[8]=Le.x,s[1]=As.y,s[5]=To.y,s[9]=Le.y,s[2]=As.z,s[6]=To.z,s[10]=Le.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,n=this.elements,a=i[0],o=i[4],h=i[8],l=i[12],u=i[1],c=i[5],d=i[9],p=i[13],m=i[2],f=i[6],g=i[10],y=i[14],x=i[3],_=i[7],M=i[11],v=i[15],N=s[0],T=s[4],C=s[8],P=s[12],F=s[1],D=s[5],q=s[9],X=s[13],it=s[2],mt=s[6],xt=s[10],Q=s[14],gt=s[3],st=s[7],rt=s[11],Rt=s[15];return n[0]=a*N+o*F+h*it+l*gt,n[4]=a*T+o*D+h*mt+l*st,n[8]=a*C+o*q+h*xt+l*rt,n[12]=a*P+o*X+h*Q+l*Rt,n[1]=u*N+c*F+d*it+p*gt,n[5]=u*T+c*D+d*mt+p*st,n[9]=u*C+c*q+d*xt+p*rt,n[13]=u*P+c*X+d*Q+p*Rt,n[2]=m*N+f*F+g*it+y*gt,n[6]=m*T+f*D+g*mt+y*st,n[10]=m*C+f*q+g*xt+y*rt,n[14]=m*P+f*X+g*Q+y*Rt,n[3]=x*N+_*F+M*it+v*gt,n[7]=x*T+_*D+M*mt+v*st,n[11]=x*C+_*q+M*xt+v*rt,n[15]=x*P+_*X+M*Q+v*Rt,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],s=t[8],n=t[12],a=t[1],o=t[5],h=t[9],l=t[13],u=t[2],c=t[6],d=t[10],p=t[14];return t[3]*(+n*h*c-s*l*c-n*o*d+i*l*d+s*o*p-i*h*p)+t[7]*(+e*h*p-e*l*d+n*a*d-s*a*p+s*l*u-n*h*u)+t[11]*(+e*l*c-e*o*p-n*a*c+i*a*p+n*o*u-i*l*u)+t[15]*(-s*o*u-e*h*c+e*o*d+s*a*c-i*a*d+i*h*u)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=t[8],c=t[9],d=t[10],p=t[11],m=t[12],f=t[13],g=t[14],y=t[15],x=c*g*l-f*d*l+f*h*p-o*g*p-c*h*y+o*d*y,_=m*d*l-u*g*l-m*h*p+a*g*p+u*h*y-a*d*y,M=u*f*l-m*c*l+m*o*p-a*f*p-u*o*y+a*c*y,v=m*c*h-u*f*h-m*o*d+a*f*d+u*o*g-a*c*g,N=e*x+i*_+s*M+n*v;if(N===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/N;return t[0]=x*T,t[1]=(f*d*n-c*g*n-f*s*p+i*g*p+c*s*y-i*d*y)*T,t[2]=(o*g*n-f*h*n+f*s*l-i*g*l-o*s*y+i*h*y)*T,t[3]=(c*h*n-o*d*n-c*s*l+i*d*l+o*s*p-i*h*p)*T,t[4]=_*T,t[5]=(u*g*n-m*d*n+m*s*p-e*g*p-u*s*y+e*d*y)*T,t[6]=(m*h*n-a*g*n-m*s*l+e*g*l+a*s*y-e*h*y)*T,t[7]=(a*d*n-u*h*n+u*s*l-e*d*l-a*s*p+e*h*p)*T,t[8]=M*T,t[9]=(m*c*n-u*f*n-m*i*p+e*f*p+u*i*y-e*c*y)*T,t[10]=(a*f*n-m*o*n+m*i*l-e*f*l-a*i*y+e*o*y)*T,t[11]=(u*o*n-a*c*n-u*i*l+e*c*l+a*i*p-e*o*p)*T,t[12]=v*T,t[13]=(u*f*s-m*c*s+m*i*d-e*f*d-u*i*g+e*c*g)*T,t[14]=(m*o*s-a*f*s-m*i*h+e*f*h+a*i*g-e*o*g)*T,t[15]=(a*c*s-u*o*s+u*i*h-e*c*h-a*i*d+e*o*d)*T,this}scale(t){const e=this.elements,i=t.x,s=t.y,n=t.z;return e[0]*=i,e[4]*=s,e[8]*=n,e[1]*=i,e[5]*=s,e[9]*=n,e[2]*=i,e[6]*=s,e[10]*=n,e[3]*=i,e[7]*=s,e[11]*=n,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,s))}makeTranslation(t,e,i){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),s=Math.sin(e),n=1-i,a=t.x,o=t.y,h=t.z,l=n*a,u=n*o;return this.set(l*a+i,l*o-s*h,l*h+s*o,0,l*o+s*h,u*o+i,u*h-s*a,0,l*h-s*o,u*h+s*a,n*h*h+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,s,n,a){return this.set(1,i,n,0,t,1,a,0,e,s,1,0,0,0,0,1),this}compose(t,e,i){const s=this.elements,n=e._x,a=e._y,o=e._z,h=e._w,l=n+n,u=a+a,c=o+o,d=n*l,p=n*u,m=n*c,f=a*u,g=a*c,y=o*c,x=h*l,_=h*u,M=h*c,v=i.x,N=i.y,T=i.z;return s[0]=(1-(f+y))*v,s[1]=(p+M)*v,s[2]=(m-_)*v,s[3]=0,s[4]=(p-M)*N,s[5]=(1-(d+y))*N,s[6]=(g+x)*N,s[7]=0,s[8]=(m+_)*T,s[9]=(g-x)*T,s[10]=(1-(d+f))*T,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,i){const s=this.elements;let n=Xn.set(s[0],s[1],s[2]).length();const a=Xn.set(s[4],s[5],s[6]).length(),o=Xn.set(s[8],s[9],s[10]).length();this.determinant()<0&&(n=-n),t.x=s[12],t.y=s[13],t.z=s[14],ui.copy(this);const h=1/n,l=1/a,u=1/o;return ui.elements[0]*=h,ui.elements[1]*=h,ui.elements[2]*=h,ui.elements[4]*=l,ui.elements[5]*=l,ui.elements[6]*=l,ui.elements[8]*=u,ui.elements[9]*=u,ui.elements[10]*=u,e.setFromRotationMatrix(ui),i.x=n,i.y=a,i.z=o,this}makePerspective(t,e,i,s,n,a,o=2e3,h=!1){const l=this.elements,u=2*n/(e-t),c=2*n/(i-s),d=(e+t)/(e-t),p=(i+s)/(i-s);let m,f;if(h)m=n/(a-n),f=a*n/(a-n);else if(o===2e3)m=-(a+n)/(a-n),f=-2*a*n/(a-n);else{if(o!==2001)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);m=-a/(a-n),f=-a*n/(a-n)}return l[0]=u,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=c,l[9]=p,l[13]=0,l[2]=0,l[6]=0,l[10]=m,l[14]=f,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,e,i,s,n,a,o=2e3,h=!1){const l=this.elements,u=2/(e-t),c=2/(i-s),d=-(e+t)/(e-t),p=-(i+s)/(i-s);let m,f;if(h)m=1/(a-n),f=a/(a-n);else if(o===2e3)m=-2/(a-n),f=-(a+n)/(a-n);else{if(o!==2001)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);m=-1/(a-n),f=-n/(a-n)}return l[0]=u,l[4]=0,l[8]=0,l[12]=d,l[1]=0,l[5]=c,l[9]=0,l[13]=p,l[2]=0,l[6]=0,l[10]=m,l[14]=f,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let s=0;s<16;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const Xn=new S,ui=new G,Py=new S(0,0,0),By=new S(1,1,1),As=new S,To=new S,Le=new S,P0=new G,B0=new Te;class $e{constructor(t=0,e=0,i=0,s=$e.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,s=this._order){return this._x=t,this._y=e,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const s=t.elements,n=s[0],a=s[4],o=s[8],h=s[1],l=s[5],u=s[9],c=s[2],d=s[6],p=s[10];switch(e){case"XYZ":this._y=Math.asin(ht(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-a,n)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ht(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(h,l)):(this._y=Math.atan2(-c,n),this._z=0);break;case"ZXY":this._x=Math.asin(ht(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-c,p),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(h,n));break;case"ZYX":this._y=Math.asin(-ht(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(h,n)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(ht(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-c,n)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-ht(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-u,p),this._y=0);break;default:j("Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return P0.makeRotationFromQuaternion(t),this.setFromRotationMatrix(P0,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return B0.setFromEuler(this),this.setFromQuaternion(B0,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}$e.DEFAULT_ORDER="XYZ";class Oy{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return!!(this.mask&1<<t)}}let Vy=0;const O0=new S,jn=new Te,Zi=new G,So=new S,ua=new S,Fy=new S,ky=new Te,V0=new S(1,0,0),F0=new S(0,1,0),k0=new S(0,0,1),D0={type:"added"},Dy={type:"removed"},Gn={type:"childadded",child:null},ou={type:"childremoved",child:null};class Pt extends vs{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Vy++}),this.uuid=ai(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Pt.DEFAULT_UP.clone();const t=new S,e=new $e,i=new Te,s=new S(1,1,1);e._onChange(function(){i.setFromEuler(e,!1)}),i._onChange(function(){e.setFromQuaternion(i,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new G},normalMatrix:{value:new He}}),this.matrix=new G,this.matrixWorld=new G,this.matrixAutoUpdate=Pt.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Pt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new Oy,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return jn.setFromAxisAngle(t,e),this.quaternion.multiply(jn),this}rotateOnWorldAxis(t,e){return jn.setFromAxisAngle(t,e),this.quaternion.premultiply(jn),this}rotateX(t){return this.rotateOnAxis(V0,t)}rotateY(t){return this.rotateOnAxis(F0,t)}rotateZ(t){return this.rotateOnAxis(k0,t)}translateOnAxis(t,e){return O0.copy(t).applyQuaternion(this.quaternion),this.position.add(O0.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(V0,t)}translateY(t){return this.translateOnAxis(F0,t)}translateZ(t){return this.translateOnAxis(k0,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Zi.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?So.copy(t):So.set(t,e,i);const s=this.parent;this.updateWorldMatrix(!0,!1),ua.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Zi.lookAt(ua,So,this.up):Zi.lookAt(So,ua,this.up),this.quaternion.setFromRotationMatrix(Zi),s&&(Zi.extractRotation(s.matrixWorld),jn.setFromRotationMatrix(Zi),this.quaternion.premultiply(jn.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(et("Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(D0),Gn.child=t,this.dispatchEvent(Gn),Gn.child=null):et("Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Dy),ou.child=t,this.dispatchEvent(ou),ou.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Zi.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Zi.multiply(t.parent.matrixWorld)),t.applyMatrix4(Zi),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(D0),Gn.child=t,this.dispatchEvent(Gn),Gn.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,s=this.children.length;i<s;i++){const n=this.children[i].getObjectByProperty(t,e);if(n!==void 0)return n}}getObjectsByProperty(t,e,i=[]){this[t]===e&&i.push(this);const s=this.children;for(let n=0,a=s.length;n<a;n++)s[n].getObjectsByProperty(t,e,i);return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ua,t,Fy),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ua,ky,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(t===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),e===!0){const s=this.children;for(let n=0,a=s.length;n<a;n++)s[n].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const s={};function n(o,h){return o[h.uuid]===void 0&&(o[h.uuid]=h.toJSON(t)),h.uuid}if(s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),s.instanceInfo=this._instanceInfo.map(o=>({...o})),s.availableInstanceIds=this._availableInstanceIds.slice(),s.availableGeometryIds=this._availableGeometryIds.slice(),s.nextIndexStart=this._nextIndexStart,s.nextVertexStart=this._nextVertexStart,s.geometryCount=this._geometryCount,s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.matricesTexture=this._matricesTexture.toJSON(t),s.indirectTexture=this._indirectTexture.toJSON(t),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(s.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(s.boundingBox=this.boundingBox.toJSON())),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=n(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const h=o.shapes;if(Array.isArray(h))for(let l=0,u=h.length;l<u;l++){const c=h[l];n(t.shapes,c)}else n(t.shapes,h)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let h=0,l=this.material.length;h<l;h++)o.push(n(t.materials,this.material[h]));s.material=o}else s.material=n(t.materials,this.material);if(this.children.length>0){s.children=[];for(let o=0;o<this.children.length;o++)s.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let o=0;o<this.animations.length;o++){const h=this.animations[o];s.animations.push(n(t.animations,h))}}if(e){const o=a(t.geometries),h=a(t.materials),l=a(t.textures),u=a(t.images),c=a(t.shapes),d=a(t.skeletons),p=a(t.animations),m=a(t.nodes);o.length>0&&(i.geometries=o),h.length>0&&(i.materials=h),l.length>0&&(i.textures=l),u.length>0&&(i.images=u),c.length>0&&(i.shapes=c),d.length>0&&(i.skeletons=d),p.length>0&&(i.animations=p),m.length>0&&(i.nodes=m)}return i.object=s,i;function a(o){const h=[];for(const l in o){const u=o[l];delete u.metadata,h.push(u)}return h}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){const s=t.children[i];this.add(s.clone())}return this}}Pt.DEFAULT_UP=new S(0,1,0),Pt.DEFAULT_MATRIX_AUTO_UPDATE=!0,Pt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ci=new S,Ji=new S,hu=new S,Qi=new S,Yn=new S,Zn=new S,U0=new S,lu=new S,uu=new S,cu=new S,du=new wt,pu=new wt,mu=new wt;class Xe{constructor(t=new S,e=new S,i=new S){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,s){s.subVectors(i,e),ci.subVectors(t,e),s.cross(ci);const n=s.lengthSq();return n>0?s.multiplyScalar(1/Math.sqrt(n)):s.set(0,0,0)}static getBarycoord(t,e,i,s,n){ci.subVectors(s,e),Ji.subVectors(i,e),hu.subVectors(t,e);const a=ci.dot(ci),o=ci.dot(Ji),h=ci.dot(hu),l=Ji.dot(Ji),u=Ji.dot(hu),c=a*l-o*o;if(c===0)return n.set(0,0,0),null;const d=1/c,p=(l*h-o*u)*d,m=(a*u-o*h)*d;return n.set(1-p-m,m,p)}static containsPoint(t,e,i,s){return this.getBarycoord(t,e,i,s,Qi)!==null&&Qi.x>=0&&Qi.y>=0&&Qi.x+Qi.y<=1}static getInterpolation(t,e,i,s,n,a,o,h){return this.getBarycoord(t,e,i,s,Qi)===null?(h.x=0,h.y=0,"z"in h&&(h.z=0),"w"in h&&(h.w=0),null):(h.setScalar(0),h.addScaledVector(n,Qi.x),h.addScaledVector(a,Qi.y),h.addScaledVector(o,Qi.z),h)}static getInterpolatedAttribute(t,e,i,s,n,a){return du.setScalar(0),pu.setScalar(0),mu.setScalar(0),du.fromBufferAttribute(t,e),pu.fromBufferAttribute(t,i),mu.fromBufferAttribute(t,s),a.setScalar(0),a.addScaledVector(du,n.x),a.addScaledVector(pu,n.y),a.addScaledVector(mu,n.z),a}static isFrontFacing(t,e,i,s){return ci.subVectors(i,e),Ji.subVectors(t,e),ci.cross(Ji).dot(s)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,s){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[s]),this}setFromAttributeAndIndices(t,e,i,s){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,s),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return ci.subVectors(this.c,this.b),Ji.subVectors(this.a,this.b),.5*ci.cross(Ji).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Xe.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Xe.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,i,s,n){return Xe.getInterpolation(t,this.a,this.b,this.c,e,i,s,n)}containsPoint(t){return Xe.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Xe.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,s=this.b,n=this.c;let a,o;Yn.subVectors(s,i),Zn.subVectors(n,i),lu.subVectors(t,i);const h=Yn.dot(lu),l=Zn.dot(lu);if(h<=0&&l<=0)return e.copy(i);uu.subVectors(t,s);const u=Yn.dot(uu),c=Zn.dot(uu);if(u>=0&&c<=u)return e.copy(s);const d=h*c-u*l;if(d<=0&&h>=0&&u<=0)return a=h/(h-u),e.copy(i).addScaledVector(Yn,a);cu.subVectors(t,n);const p=Yn.dot(cu),m=Zn.dot(cu);if(m>=0&&p<=m)return e.copy(n);const f=p*l-h*m;if(f<=0&&l>=0&&m<=0)return o=l/(l-m),e.copy(i).addScaledVector(Zn,o);const g=u*m-p*c;if(g<=0&&c-u>=0&&p-m>=0)return U0.subVectors(n,s),o=(c-u)/(c-u+(p-m)),e.copy(s).addScaledVector(U0,o);const y=1/(g+f+d);return a=f*y,o=d*y,e.copy(i).addScaledVector(Yn,a).addScaledVector(Zn,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const W0={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ns={h:0,s:0,l:0},Ao={h:0,s:0,l:0};function fu(r,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+6*(t-r)*e:e<.5?t:e<2/3?r+6*(t-r)*(2/3-e):r}let ut=class{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,i)}set(t,e,i){if(e===void 0&&i===void 0){const s=t;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(t,e,i);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=ue){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Vt.colorSpaceToWorking(this,e),this}setRGB(t,e,i,s=Vt.workingColorSpace){return this.r=t,this.g=e,this.b=i,Vt.colorSpaceToWorking(this,s),this}setHSL(t,e,i,s=Vt.workingColorSpace){if(t=Yl(t,1),e=ht(e,0,1),i=ht(i,0,1),e===0)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,a=2*i-n;this.r=fu(a,n,t+1/3),this.g=fu(a,n,t),this.b=fu(a,n,t-1/3)}return Vt.colorSpaceToWorking(this,s),this}setStyle(t,e=ue){function i(n){n!==void 0&&parseFloat(n)<1&&j("Color: Alpha component of "+t+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(t)){let n;const a=s[1],o=s[2];switch(a){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(n[4]),this.setRGB(Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255,e);if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(n[4]),this.setRGB(Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100,e);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(n[4]),this.setHSL(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,e);break;default:j("Color: Unknown color model "+t)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(t)){const n=s[1],a=n.length;if(a===3)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,e);if(a===6)return this.setHex(parseInt(n,16),e);j("Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=ue){const i=W0[t.toLowerCase()];return i!==void 0?this.setHex(i,e):j("Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=ji(t.r),this.g=ji(t.g),this.b=ji(t.b),this}copyLinearToSRGB(t){return this.r=Un(t.r),this.g=Un(t.g),this.b=Un(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=ue){return Vt.workingToColorSpace(de.copy(this),t),65536*Math.round(ht(255*de.r,0,255))+256*Math.round(ht(255*de.g,0,255))+Math.round(ht(255*de.b,0,255))}getHexString(t=ue){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Vt.workingColorSpace){Vt.workingToColorSpace(de.copy(this),e);const i=de.r,s=de.g,n=de.b,a=Math.max(i,s,n),o=Math.min(i,s,n);let h,l;const u=(o+a)/2;if(o===a)h=0,l=0;else{const c=a-o;switch(l=u<=.5?c/(a+o):c/(2-a-o),a){case i:h=(s-n)/c+(s<n?6:0);break;case s:h=(n-i)/c+2;break;case n:h=(i-s)/c+4}h/=6}return t.h=h,t.s=l,t.l=u,t}getRGB(t,e=Vt.workingColorSpace){return Vt.workingToColorSpace(de.copy(this),e),t.r=de.r,t.g=de.g,t.b=de.b,t}getStyle(t=ue){Vt.workingToColorSpace(de.copy(this),t);const e=de.r,i=de.g,s=de.b;return t!==ue?`color(${t} ${e.toFixed(3)} ${i.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*s)})`}offsetHSL(t,e,i){return this.getHSL(Ns),this.setHSL(Ns.h+t,Ns.s+e,Ns.l+i)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(Ns),t.getHSL(Ao);const i=oa(Ns.h,Ao.h,e),s=oa(Ns.s,Ao.s,e),n=oa(Ns.l,Ao.l,e);return this.setHSL(i,s,n),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,i=this.g,s=this.b,n=t.elements;return this.r=n[0]*e+n[3]*i+n[6]*s,this.g=n[1]*e+n[4]*i+n[7]*s,this.b=n[2]*e+n[5]*i+n[8]*s,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const de=new ut;ut.NAMES=W0;let Uy=0,he=class extends vs{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Uy++}),this.uuid=ai(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ut(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const i=t[e];if(i===void 0){j(`Material: parameter '${e}' has value of undefined.`);continue}const s=this[e];s!==void 0?s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[e]=i:j(`Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const i={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};function s(n){const a=[];for(const o in n){const h=n[o];delete h.metadata,a.push(h)}return a}if(i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(i.sheenColorMap=this.sheenColorMap.toJSON(t).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(i.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(t).uuid),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==1&&(i.blending=this.blending),this.side!==0&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==204&&(i.blendSrc=this.blendSrc),this.blendDst!==205&&(i.blendDst=this.blendDst),this.blendEquation!==100&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==3&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==519&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==7680&&(i.stencilFail=this.stencilFail),this.stencilZFail!==7680&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==7680&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),e){const n=s(t.textures),a=s(t.images);n.length>0&&(i.textures=n),a.length>0&&(i.images=a)}return i}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(e!==null){const s=e.length;i=new Array(s);for(let n=0;n!==s;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}},Rs=class extends he{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ut(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new $e,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}};Wy();function Wy(){const r=new ArrayBuffer(4),t=new Float32Array(r),e=new Uint32Array(r),i=new Uint32Array(512),s=new Uint32Array(512);for(let h=0;h<256;++h){const l=h-127;l<-27?(i[h]=0,i[256|h]=32768,s[h]=24,s[256|h]=24):l<-14?(i[h]=1024>>-l-14,i[256|h]=1024>>-l-14|32768,s[h]=-l-1,s[256|h]=-l-1):l<=15?(i[h]=l+15<<10,i[256|h]=l+15<<10|32768,s[h]=13,s[256|h]=13):l<128?(i[h]=31744,i[256|h]=64512,s[h]=24,s[256|h]=24):(i[h]=31744,i[256|h]=64512,s[h]=13,s[256|h]=13)}const n=new Uint32Array(2048),a=new Uint32Array(64),o=new Uint32Array(64);for(let h=1;h<1024;++h){let l=h<<13,u=0;for(;!(8388608&l);)l<<=1,u-=8388608;l&=-8388609,u+=947912704,n[h]=l|u}for(let h=1024;h<2048;++h)n[h]=939524096+(h-1024<<13);for(let h=1;h<31;++h)a[h]=h<<23;a[31]=1199570944,a[32]=2147483648;for(let h=33;h<63;++h)a[h]=2147483648+(h-32<<23);a[63]=3347054592;for(let h=1;h<64;++h)h!==32&&(o[h]=1024);return{floatView:t,uint32View:e,baseTable:i,shiftTable:s,mantissaTable:n,exponentTable:a,offsetTable:o}}const Ht=new S,No=new nt;let Hy=0,Ae=class{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:Hy++}),this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=i,this.usage=35044,this.updateRanges=[],this.gpuType=1015,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let s=0,n=this.itemSize;s<n;s++)this.array[t+s]=e.array[i+s];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)No.fromBufferAttribute(this,e),No.applyMatrix3(t),this.setXY(e,No.x,No.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)Ht.fromBufferAttribute(this,e),Ht.applyMatrix3(t),this.setXYZ(e,Ht.x,Ht.y,Ht.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)Ht.fromBufferAttribute(this,e),Ht.applyMatrix4(t),this.setXYZ(e,Ht.x,Ht.y,Ht.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Ht.fromBufferAttribute(this,e),Ht.applyNormalMatrix(t),this.setXYZ(e,Ht.x,Ht.y,Ht.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Ht.fromBufferAttribute(this,e),Ht.transformDirection(t),this.setXYZ(e,Ht.x,Ht.y,Ht.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let i=this.array[t*this.itemSize+e];return this.normalized&&(i=oi(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=_t(i,this.array)),this.array[t*this.itemSize+e]=i,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=oi(e,this.array)),e}setX(t,e){return this.normalized&&(e=_t(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=oi(e,this.array)),e}setY(t,e){return this.normalized&&(e=_t(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=oi(e,this.array)),e}setZ(t,e){return this.normalized&&(e=_t(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=oi(e,this.array)),e}setW(t,e){return this.normalized&&(e=_t(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=_t(e,this.array),i=_t(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,s){return t*=this.itemSize,this.normalized&&(e=_t(e,this.array),i=_t(i,this.array),s=_t(s,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this}setXYZW(t,e,i,s,n){return t*=this.itemSize,this.normalized&&(e=_t(e,this.array),i=_t(i,this.array),s=_t(s,this.array),n=_t(n,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==35044&&(t.usage=this.usage),t}},qy=class extends Ae{constructor(t,e,i){super(new Uint16Array(t),e,i)}},$y=class extends Ae{constructor(t,e,i){super(new Uint32Array(t),e,i)}},Es=class extends Ae{constructor(t,e,i){super(new Float32Array(t),e,i)}},Xy=0;const je=new G,gu=new Pt,Jn=new S,Pe=new hi,ca=new hi,te=new S;let rn=class ly extends vs{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Xy++}),this.uuid=ai(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Ay(t)?$y:qy)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const n=new He().getNormalMatrix(t);i.applyNormalMatrix(n),i.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(t),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return je.makeRotationFromQuaternion(t),this.applyMatrix4(je),this}rotateX(t){return je.makeRotationX(t),this.applyMatrix4(je),this}rotateY(t){return je.makeRotationY(t),this.applyMatrix4(je),this}rotateZ(t){return je.makeRotationZ(t),this.applyMatrix4(je),this}translate(t,e,i){return je.makeTranslation(t,e,i),this.applyMatrix4(je),this}scale(t,e,i){return je.makeScale(t,e,i),this.applyMatrix4(je),this}lookAt(t){return gu.lookAt(t),gu.updateMatrix(),this.applyMatrix4(gu.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Jn).negate(),this.translate(Jn.x,Jn.y,Jn.z),this}setFromPoints(t){const e=this.getAttribute("position");if(e===void 0){const i=[];for(let s=0,n=t.length;s<n;s++){const a=t[s];i.push(a.x,a.y,a.z||0)}this.setAttribute("position",new Es(i,3))}else{const i=Math.min(t.length,e.count);for(let s=0;s<i;s++){const n=t[s];e.setXYZ(s,n.x,n.y,n.z||0)}t.length>e.count&&j("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new hi);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return et("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new S(-1/0,-1/0,-1/0),new S(1/0,1/0,1/0));if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,s=e.length;i<s;i++){const n=e[i];Pe.setFromBufferAttribute(n),this.morphTargetsRelative?(te.addVectors(this.boundingBox.min,Pe.min),this.boundingBox.expandByPoint(te),te.addVectors(this.boundingBox.max,Pe.max),this.boundingBox.expandByPoint(te)):(this.boundingBox.expandByPoint(Pe.min),this.boundingBox.expandByPoint(Pe.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&et('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new qe);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return et("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new S,1/0);if(t){const i=this.boundingSphere.center;if(Pe.setFromBufferAttribute(t),e)for(let n=0,a=e.length;n<a;n++){const o=e[n];ca.setFromBufferAttribute(o),this.morphTargetsRelative?(te.addVectors(Pe.min,ca.min),Pe.expandByPoint(te),te.addVectors(Pe.max,ca.max),Pe.expandByPoint(te)):(Pe.expandByPoint(ca.min),Pe.expandByPoint(ca.max))}Pe.getCenter(i);let s=0;for(let n=0,a=t.count;n<a;n++)te.fromBufferAttribute(t,n),s=Math.max(s,i.distanceToSquared(te));if(e)for(let n=0,a=e.length;n<a;n++){const o=e[n],h=this.morphTargetsRelative;for(let l=0,u=o.count;l<u;l++)te.fromBufferAttribute(o,l),h&&(Jn.fromBufferAttribute(t,l),te.add(Jn)),s=Math.max(s,i.distanceToSquared(te))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&et('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0)return void et("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.position,s=e.normal,n=e.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ae(new Float32Array(4*i.count),4));const a=this.getAttribute("tangent"),o=[],h=[];for(let C=0;C<i.count;C++)o[C]=new S,h[C]=new S;const l=new S,u=new S,c=new S,d=new nt,p=new nt,m=new nt,f=new S,g=new S;function y(C,P,F){l.fromBufferAttribute(i,C),u.fromBufferAttribute(i,P),c.fromBufferAttribute(i,F),d.fromBufferAttribute(n,C),p.fromBufferAttribute(n,P),m.fromBufferAttribute(n,F),u.sub(l),c.sub(l),p.sub(d),m.sub(d);const D=1/(p.x*m.y-m.x*p.y);isFinite(D)&&(f.copy(u).multiplyScalar(m.y).addScaledVector(c,-p.y).multiplyScalar(D),g.copy(c).multiplyScalar(p.x).addScaledVector(u,-m.x).multiplyScalar(D),o[C].add(f),o[P].add(f),o[F].add(f),h[C].add(g),h[P].add(g),h[F].add(g))}let x=this.groups;x.length===0&&(x=[{start:0,count:t.count}]);for(let C=0,P=x.length;C<P;++C){const F=x[C],D=F.start;for(let q=D,X=D+F.count;q<X;q+=3)y(t.getX(q+0),t.getX(q+1),t.getX(q+2))}const _=new S,M=new S,v=new S,N=new S;function T(C){v.fromBufferAttribute(s,C),N.copy(v);const P=o[C];_.copy(P),_.sub(v.multiplyScalar(v.dot(P))).normalize(),M.crossVectors(N,P);const F=M.dot(h[C])<0?-1:1;a.setXYZW(C,_.x,_.y,_.z,F)}for(let C=0,P=x.length;C<P;++C){const F=x[C],D=F.start;for(let q=D,X=D+F.count;q<X;q+=3)T(t.getX(q+0)),T(t.getX(q+1)),T(t.getX(q+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Ae(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let d=0,p=i.count;d<p;d++)i.setXYZ(d,0,0,0);const s=new S,n=new S,a=new S,o=new S,h=new S,l=new S,u=new S,c=new S;if(t)for(let d=0,p=t.count;d<p;d+=3){const m=t.getX(d+0),f=t.getX(d+1),g=t.getX(d+2);s.fromBufferAttribute(e,m),n.fromBufferAttribute(e,f),a.fromBufferAttribute(e,g),u.subVectors(a,n),c.subVectors(s,n),u.cross(c),o.fromBufferAttribute(i,m),h.fromBufferAttribute(i,f),l.fromBufferAttribute(i,g),o.add(u),h.add(u),l.add(u),i.setXYZ(m,o.x,o.y,o.z),i.setXYZ(f,h.x,h.y,h.z),i.setXYZ(g,l.x,l.y,l.z)}else for(let d=0,p=e.count;d<p;d+=3)s.fromBufferAttribute(e,d+0),n.fromBufferAttribute(e,d+1),a.fromBufferAttribute(e,d+2),u.subVectors(a,n),c.subVectors(s,n),u.cross(c),i.setXYZ(d+0,u.x,u.y,u.z),i.setXYZ(d+1,u.x,u.y,u.z),i.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)te.fromBufferAttribute(t,e),te.normalize(),t.setXYZ(e,te.x,te.y,te.z)}toNonIndexed(){function t(o,h){const l=o.array,u=o.itemSize,c=o.normalized,d=new l.constructor(h.length*u);let p=0,m=0;for(let f=0,g=h.length;f<g;f++){p=o.isInterleavedBufferAttribute?h[f]*o.data.stride+o.offset:h[f]*u;for(let y=0;y<u;y++)d[m++]=l[p++]}return new Ae(d,u,c)}if(this.index===null)return j("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new ly,i=this.index.array,s=this.attributes;for(const o in s){const h=t(s[o],i);e.setAttribute(o,h)}const n=this.morphAttributes;for(const o in n){const h=[],l=n[o];for(let u=0,c=l.length;u<c;u++){const d=t(l[u],i);h.push(d)}e.morphAttributes[o]=h}e.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,h=a.length;o<h;o++){const l=a[o];e.addGroup(l.start,l.count,l.materialIndex)}return e}toJSON(){const t={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const h=this.parameters;for(const l in h)h[l]!==void 0&&(t[l]=h[l]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const h in i){const l=i[h];t.data.attributes[h]=l.toJSON(t.data)}const s={};let n=!1;for(const h in this.morphAttributes){const l=this.morphAttributes[h],u=[];for(let c=0,d=l.length;c<d;c++){const p=l[c];u.push(p.toJSON(t.data))}u.length>0&&(s[h]=u,n=!0)}n&&(t.data.morphAttributes=s,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(t.data.boundingSphere=o.toJSON()),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;i!==null&&this.setIndex(i.clone());const s=t.attributes;for(const l in s){const u=s[l];this.setAttribute(l,u.clone(e))}const n=t.morphAttributes;for(const l in n){const u=[],c=n[l];for(let d=0,p=c.length;d<p;d++)u.push(c[d].clone(e));this.morphAttributes[l]=u}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let l=0,u=a.length;l<u;l++){const c=a[l];this.addGroup(c.start,c.count,c.materialIndex)}const o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());const h=t.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const H0=new G,an=new wo,Ro=new qe,q0=new S,Eo=new S,Io=new S,Co=new S,yu=new S,zo=new S,$0=new S,Lo=new S;class di extends Pt{constructor(t=new rn,e=new Rs){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,n=i.length;s<n;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}getVertexPosition(t,e){const i=this.geometry,s=i.attributes.position,n=i.morphAttributes.position,a=i.morphTargetsRelative;e.fromBufferAttribute(s,t);const o=this.morphTargetInfluences;if(n&&o){zo.set(0,0,0);for(let h=0,l=n.length;h<l;h++){const u=o[h],c=n[h];u!==0&&(yu.fromBufferAttribute(c,t),a?zo.addScaledVector(yu,u):zo.addScaledVector(yu.sub(e),u))}e.add(zo)}return e}raycast(t,e){const i=this.geometry,s=this.material,n=this.matrixWorld;if(s!==void 0){if(i.boundingSphere===null&&i.computeBoundingSphere(),Ro.copy(i.boundingSphere),Ro.applyMatrix4(n),an.copy(t.ray).recast(t.near),Ro.containsPoint(an.origin)===!1&&(an.intersectSphere(Ro,q0)===null||an.origin.distanceToSquared(q0)>(t.far-t.near)**2))return;H0.copy(n).invert(),an.copy(t.ray).applyMatrix4(H0),i.boundingBox!==null&&an.intersectsBox(i.boundingBox)===!1||this._computeIntersections(t,e,an)}}_computeIntersections(t,e,i){let s;const n=this.geometry,a=this.material,o=n.index,h=n.attributes.position,l=n.attributes.uv,u=n.attributes.uv1,c=n.attributes.normal,d=n.groups,p=n.drawRange;if(o!==null)if(Array.isArray(a))for(let m=0,f=d.length;m<f;m++){const g=d[m],y=a[g.materialIndex];for(let x=Math.max(g.start,p.start),_=Math.min(o.count,Math.min(g.start+g.count,p.start+p.count));x<_;x+=3)s=Po(this,y,t,i,l,u,c,o.getX(x),o.getX(x+1),o.getX(x+2)),s&&(s.faceIndex=Math.floor(x/3),s.face.materialIndex=g.materialIndex,e.push(s))}else for(let m=Math.max(0,p.start),f=Math.min(o.count,p.start+p.count);m<f;m+=3)s=Po(this,a,t,i,l,u,c,o.getX(m),o.getX(m+1),o.getX(m+2)),s&&(s.faceIndex=Math.floor(m/3),e.push(s));else if(h!==void 0)if(Array.isArray(a))for(let m=0,f=d.length;m<f;m++){const g=d[m],y=a[g.materialIndex];for(let x=Math.max(g.start,p.start),_=Math.min(h.count,Math.min(g.start+g.count,p.start+p.count));x<_;x+=3)s=Po(this,y,t,i,l,u,c,x,x+1,x+2),s&&(s.faceIndex=Math.floor(x/3),s.face.materialIndex=g.materialIndex,e.push(s))}else for(let m=Math.max(0,p.start),f=Math.min(h.count,p.start+p.count);m<f;m+=3)s=Po(this,a,t,i,l,u,c,m,m+1,m+2),s&&(s.faceIndex=Math.floor(m/3),e.push(s))}}function Po(r,t,e,i,s,n,a,o,h,l){r.getVertexPosition(o,Eo),r.getVertexPosition(h,Io),r.getVertexPosition(l,Co);const u=(function(c,d,p,m,f,g,y,x){let _;if(_=d.side===1?m.intersectTriangle(y,g,f,!0,x):m.intersectTriangle(f,g,y,d.side===0,x),_===null)return null;Lo.copy(x),Lo.applyMatrix4(c.matrixWorld);const M=p.ray.origin.distanceTo(Lo);return M<p.near||M>p.far?null:{distance:M,point:Lo.clone(),object:c}})(r,t,e,i,Eo,Io,Co,$0);if(u){const c=new S;Xe.getBarycoord($0,Eo,Io,Co,c),s&&(u.uv=Xe.getInterpolatedAttribute(s,o,h,l,c,new nt)),n&&(u.uv1=Xe.getInterpolatedAttribute(n,o,h,l,c,new nt)),a&&(u.normal=Xe.getInterpolatedAttribute(a,o,h,l,c,new S),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const d={a:o,b:h,c:l,normal:new S,materialIndex:0};Xe.getNormal(Eo,Io,Co,d.normal),u.face=d,u.barycoord=c}return u}class da extends rn{constructor(t=1,e=1,i=1,s=1,n=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:s,heightSegments:n,depthSegments:a};const o=this;s=Math.floor(s),n=Math.floor(n),a=Math.floor(a);const h=[],l=[],u=[],c=[];let d=0,p=0;function m(f,g,y,x,_,M,v,N,T,C,P){const F=M/T,D=v/C,q=M/2,X=v/2,it=N/2,mt=T+1,xt=C+1;let Q=0,gt=0;const st=new S;for(let rt=0;rt<xt;rt++){const Rt=rt*D-X;for(let _s=0;_s<mt;_s++){const kn=_s*F-q;st[f]=kn*x,st[g]=Rt*_,st[y]=it,l.push(st.x,st.y,st.z),st[f]=0,st[g]=0,st[y]=N>0?1:-1,u.push(st.x,st.y,st.z),c.push(_s/T),c.push(1-rt/C),Q+=1}}for(let rt=0;rt<C;rt++)for(let Rt=0;Rt<T;Rt++){const _s=d+Rt+mt*rt,kn=d+Rt+mt*(rt+1),Fl=d+(Rt+1)+mt*(rt+1),go=d+(Rt+1)+mt*rt;h.push(_s,kn,go),h.push(kn,Fl,go),gt+=6}o.addGroup(p,gt,P),p+=gt,d+=Q}m("z","y","x",-1,-1,i,e,t,a,n,0),m("z","y","x",1,-1,i,e,-t,a,n,1),m("x","z","y",1,1,t,i,e,s,a,2),m("x","z","y",1,-1,t,i,-e,s,a,3),m("x","y","z",1,-1,t,e,i,s,n,4),m("x","y","z",-1,-1,t,e,-i,s,n,5),this.setIndex(h),this.setAttribute("position",new Es(l,3)),this.setAttribute("normal",new Es(u,3)),this.setAttribute("uv",new Es(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new da(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function X0(r){const t={};for(const e in r){t[e]={};for(const i in r[e]){const s=r[e][i];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(j("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[e][i]=null):t[e][i]=s.clone():Array.isArray(s)?t[e][i]=s.slice():t[e][i]=s}}return t}class jy extends he{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,this.fragmentShader=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=X0(t.uniforms),this.uniformsGroups=(function(e){const i=[];for(let s=0;s<e.length;s++)i.push(e[s].clone());return i})(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const s in this.uniforms){const n=this.uniforms[s].value;n&&n.isTexture?e.uniforms[s]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[s]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[s]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[s]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[s]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[s]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[s]={type:"m4",value:n.toArray()}:e.uniforms[s]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const i={};for(const s in this.extensions)this.extensions[s]===!0&&(i[s]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}class Bo extends Pt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new G,this.projectionMatrix=new G,this.projectionMatrixInverse=new G,this.coordinateSystem=2e3,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Is=new S,j0=new nt,G0=new nt;let Li=class extends Bo{constructor(t=50,e=1,i=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=s,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*aa*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*ra*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*aa*Math.atan(Math.tan(.5*ra*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,i){Is.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(Is.x,Is.y).multiplyScalar(-t/Is.z),Is.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Is.x,Is.y).multiplyScalar(-t/Is.z)}getViewSize(t,e){return this.getViewBounds(t,j0,G0),e.subVectors(G0,j0)}setViewOffset(t,e,i,s,n,a){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*ra*this.fov)/this.zoom,i=2*e,s=this.aspect*i,n=-.5*s;const a=this.view;if(this.view!==null&&this.view.enabled){const h=a.fullWidth,l=a.fullHeight;n+=a.offsetX*s/h,e-=a.offsetY*i/l,s*=a.width/h,i*=a.height/l}const o=this.filmOffset;o!==0&&(n+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+s,e,e-i,t,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}};const Qn=-90;let Y0=class extends Pt{constructor(t,e,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new Li(Qn,1,t,e);s.layers=this.layers,this.add(s);const n=new Li(Qn,1,t,e);n.layers=this.layers,this.add(n);const a=new Li(Qn,1,t,e);a.layers=this.layers,this.add(a);const o=new Li(Qn,1,t,e);o.layers=this.layers,this.add(o);const h=new Li(Qn,1,t,e);h.layers=this.layers,this.add(h);const l=new Li(Qn,1,t,e);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[i,s,n,a,o,h]=e;for(const l of e)this.remove(l);if(t===2e3)i.up.set(0,1,0),i.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),n.up.set(0,0,-1),n.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),h.up.set(0,1,0),h.lookAt(0,0,-1);else{if(t!==2001)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);i.up.set(0,-1,0),i.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),n.up.set(0,0,1),n.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),h.up.set(0,-1,0),h.lookAt(0,0,-1)}for(const l of e)this.add(l),l.updateMatrixWorld()}update(t,e){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:s}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[n,a,o,h,l,u]=this.children,c=t.getRenderTarget(),d=t.getActiveCubeFace(),p=t.getActiveMipmapLevel(),m=t.xr.enabled;t.xr.enabled=!1;const f=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0,s),t.render(e,n),t.setRenderTarget(i,1,s),t.render(e,a),t.setRenderTarget(i,2,s),t.render(e,o),t.setRenderTarget(i,3,s),t.render(e,h),t.setRenderTarget(i,4,s),t.render(e,l),i.texture.generateMipmaps=f,t.setRenderTarget(i,5,s),t.render(e,u),t.setRenderTarget(c,d,p),t.xr.enabled=m,i.texture.needsPMREMUpdate=!0}},xu=class extends Se{constructor(t=[],e=301,i,s,n,a,o,h,l,u){super(t,e,i,s,n,a,o,h,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}},Gy=class extends Cy{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const i={width:t,height:t,depth:1},s=[i,i,i,i,i,i];this.texture=new xu(s),this._setTextureOptions(e),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new da(5,5,5),n=new jy({name:"CubemapFromEquirect",uniforms:X0(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:1,blending:0});n.uniforms.tEquirect.value=e;const a=new di(s,n),o=e.minFilter;return e.minFilter===1008&&(e.minFilter=1006),new Y0(1,10,this).update(t,a),e.minFilter=o,a.geometry.dispose(),a.material.dispose(),this}clear(t,e=!0,i=!0,s=!0){const n=t.getRenderTarget();for(let a=0;a<6;a++)t.setRenderTarget(this,a),t.clear(e,i,s);t.setRenderTarget(n)}},bu=class extends Pt{constructor(){super(),this.isGroup=!0,this.type="Group"}},Mu=class extends Pt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new $e,this.environmentIntensity=1,this.environmentRotation=new $e,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}},_u=class{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=35044,this.updateRanges=[],this.version=0,this.uuid=ai()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let s=0,n=this.stride;s<n;s++)this.array[t+s]=e.array[i+s];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ai()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=ai()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};const Me=new S;let Z0=class uy{constructor(t,e,i,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)Me.fromBufferAttribute(this,e),Me.applyMatrix4(t),this.setXYZ(e,Me.x,Me.y,Me.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Me.fromBufferAttribute(this,e),Me.applyNormalMatrix(t),this.setXYZ(e,Me.x,Me.y,Me.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Me.fromBufferAttribute(this,e),Me.transformDirection(t),this.setXYZ(e,Me.x,Me.y,Me.z);return this}getComponent(t,e){let i=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(i=oi(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=_t(i,this.array)),this.data.array[t*this.data.stride+this.offset+e]=i,this}setX(t,e){return this.normalized&&(e=_t(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=_t(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=_t(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=_t(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=oi(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=oi(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=oi(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=oi(e,this.array)),e}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=_t(e,this.array),i=_t(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=_t(e,this.array),i=_t(i,this.array),s=_t(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=s,this}setXYZW(t,e,i,s,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=_t(e,this.array),i=_t(i,this.array),s=_t(s,this.array),n=_t(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=s,this.data.array[t+3]=n,this}clone(t){if(t===void 0){Gl("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)e.push(this.data.array[s+n])}return new Ae(new this.array.constructor(e),this.itemSize,this.normalized)}return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new uy(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){Gl("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)e.push(this.data.array[s+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}},Yy=class extends he{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ut(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}};new S,new S,new S,new nt,new nt,new G,new S,new S,new S,new nt,new nt,new nt,new S,new S;const J0=new S,Q0=new wt,K0=new wt,Zy=new S,tp=new G,Oo=new S,vu=new qe,ep=new G,wu=new wo;class Jy extends di{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=A0,this.bindMatrix=new G,this.bindMatrixInverse=new G,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new hi),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let i=0;i<e.count;i++)this.getVertexPosition(i,Oo),this.boundingBox.expandByPoint(Oo)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new qe),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let i=0;i<e.count;i++)this.getVertexPosition(i,Oo),this.boundingSphere.expandByPoint(Oo)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const i=this.material,s=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),vu.copy(this.boundingSphere),vu.applyMatrix4(s),t.ray.intersectsSphere(vu)!==!1&&(ep.copy(s).invert(),wu.copy(t.ray).applyMatrix4(ep),this.boundingBox!==null&&wu.intersectsBox(this.boundingBox)===!1||this._computeIntersections(t,e,wu)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new wt,e=this.geometry.attributes.skinWeight;for(let i=0,s=e.count;i<s;i++){t.fromBufferAttribute(e,i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===A0?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===Sy?this.bindMatrixInverse.copy(this.bindMatrix).invert():j("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const i=this.skeleton,s=this.geometry;Q0.fromBufferAttribute(s.attributes.skinIndex,t),K0.fromBufferAttribute(s.attributes.skinWeight,t),J0.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let n=0;n<4;n++){const a=K0.getComponent(n);if(a!==0){const o=Q0.getComponent(n);tp.multiplyMatrices(i.bones[o].matrixWorld,i.boneInverses[o]),e.addScaledVector(Zy.copy(J0).applyMatrix4(tp),a)}}return e.applyMatrix4(this.bindMatrixInverse)}}let ip=class extends Pt{constructor(){super(),this.isBone=!0,this.type="Bone"}},pa=class extends Se{constructor(t=null,e=1,i=1,s,n,a,o,h,l=1003,u=1003,c,d){super(null,a,o,h,l,u,s,n,c,d),this.isDataTexture=!0,this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};const sp=new G,Qy=new G;class Vo{constructor(t=[],e=[]){this.uuid=ai(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),e.length===0)this.calculateInverses();else if(t.length!==e.length){j("Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,s=this.bones.length;i<s;i++)this.boneInverses.push(new G)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const i=new G;this.bones[t]&&i.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const i=this.bones[t];i&&i.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const i=this.bones[t];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,s=this.boneTexture;for(let n=0,a=t.length;n<a;n++){const o=t[n]?t[n].matrixWorld:Qy;sp.multiplyMatrices(o,e[n]),sp.toArray(i,16*n)}s!==null&&(s.needsUpdate=!0)}clone(){return new Vo(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new pa(e,t,t,1023,1015);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){const s=this.bones[e];if(s.name===t)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,s=t.bones.length;i<s;i++){const n=t.bones[i];let a=e[n];a===void 0&&(j("Skeleton: No bone found with UUID:",n),a=new ip),this.bones.push(a),this.boneInverses.push(new G().fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let s=0,n=e.length;s<n;s++){const a=e[s];t.bones.push(a.uuid);const o=i[s];t.boneInverses.push(o.toArray())}return t}}class ma extends Ae{constructor(t,e,i,s=1){super(t,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Kn=new G,np=new G,Fo=[],rp=new hi,Ky=new G,fa=new di,ga=new qe;let tx=class extends di{constructor(t,e,i){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new ma(new Float32Array(16*i),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let s=0;s<i;s++)this.setMatrixAt(s,Ky)}computeBoundingBox(){const t=this.geometry,e=this.count;this.boundingBox===null&&(this.boundingBox=new hi),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,Kn),rp.copy(t.boundingBox).applyMatrix4(Kn),this.boundingBox.union(rp)}computeBoundingSphere(){const t=this.geometry,e=this.count;this.boundingSphere===null&&(this.boundingSphere=new qe),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,Kn),ga.copy(t.boundingSphere).applyMatrix4(Kn),this.boundingSphere.union(ga)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),t.morphTexture!==null&&(this.morphTexture=t.morphTexture.clone()),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}getMorphAt(t,e){const i=e.morphTargetInfluences,s=this.morphTexture.source.data.data,n=t*(i.length+1)+1;for(let a=0;a<i.length;a++)i[a]=s[n+a]}raycast(t,e){const i=this.matrixWorld,s=this.count;if(fa.geometry=this.geometry,fa.material=this.material,fa.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),ga.copy(this.boundingSphere),ga.applyMatrix4(i),t.ray.intersectsSphere(ga)!==!1))for(let n=0;n<s;n++){this.getMatrixAt(n,Kn),np.multiplyMatrices(i,Kn),fa.matrixWorld=np,fa.raycast(t,Fo);for(let a=0,o=Fo.length;a<o;a++){const h=Fo[a];h.instanceId=n,h.object=this,e.push(h)}Fo.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new ma(new Float32Array(3*this.instanceMatrix.count).fill(1),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}setMorphAt(t,e){const i=e.morphTargetInfluences,s=i.length+1;this.morphTexture===null&&(this.morphTexture=new pa(new Float32Array(s*this.count),s,this.count,1028,1015));const n=this.morphTexture.source.data.data;let a=0;for(let l=0;l<i.length;l++)a+=i[l];const o=this.geometry.morphTargetsRelative?1:1-a,h=s*t;n[h]=o,n.set(i,h+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}};const Tu=new S,ex=new S,ix=new He;let Cs=class{constructor(t=new S(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,s){return this.normal.set(t,e,i),this.constant=s,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const s=Tu.subVectors(i,e).cross(ex.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(s,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const i=t.delta(Tu),s=this.normal.dot(i);if(s===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const n=-(t.start.dot(this.normal)+this.constant)/s;return n<0||n>1?null:e.copy(t.start).addScaledVector(i,n)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||ix.getNormalMatrix(t),s=this.coplanarPoint(Tu).applyMatrix4(t),n=this.normal.applyMatrix3(i).normalize();return this.constant=-s.dot(n),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}};const on=new qe,sx=new nt(.5,.5),ko=new S;let Do=class{constructor(t=new Cs,e=new Cs,i=new Cs,s=new Cs,n=new Cs,a=new Cs){this.planes=[t,e,i,s,n,a]}set(t,e,i,s,n,a){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(s),o[4].copy(n),o[5].copy(a),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t,e=2e3,i=!1){const s=this.planes,n=t.elements,a=n[0],o=n[1],h=n[2],l=n[3],u=n[4],c=n[5],d=n[6],p=n[7],m=n[8],f=n[9],g=n[10],y=n[11],x=n[12],_=n[13],M=n[14],v=n[15];if(s[0].setComponents(l-a,p-u,y-m,v-x).normalize(),s[1].setComponents(l+a,p+u,y+m,v+x).normalize(),s[2].setComponents(l+o,p+c,y+f,v+_).normalize(),s[3].setComponents(l-o,p-c,y-f,v-_).normalize(),i)s[4].setComponents(h,d,g,M).normalize(),s[5].setComponents(l-h,p-d,y-g,v-M).normalize();else if(s[4].setComponents(l-h,p-d,y-g,v-M).normalize(),e===2e3)s[5].setComponents(l+h,p+d,y+g,v+M).normalize();else{if(e!==2001)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);s[5].setComponents(h,d,g,M).normalize()}return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),on.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),on.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(on)}intersectsSprite(t){on.center.set(0,0,0);const e=sx.distanceTo(t.center);return on.radius=.7071067811865476+e,on.applyMatrix4(t.matrixWorld),this.intersectsSphere(on)}intersectsSphere(t){const e=this.planes,i=t.center,s=-t.radius;for(let n=0;n<6;n++)if(e[n].distanceToPoint(i)<s)return!1;return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const s=e[i];if(ko.x=s.normal.x>0?t.max.x:t.min.x,ko.y=s.normal.y>0?t.max.y:t.min.y,ko.z=s.normal.z>0?t.max.z:t.min.z,s.distanceToPoint(ko)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};new G,new Do,new G,new ut(1,1,1),new Do,new hi,new qe,new S,new S,new S,new di;let Uo=class extends he{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ut(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}};const Wo=new S,Ho=new S,ap=new G,ya=new wo,qo=new qe,Su=new S,op=new S;let Au=class extends Pt{constructor(t=new rn,e=new Uo){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,i=[0];for(let s=1,n=e.count;s<n;s++)Wo.fromBufferAttribute(e,s-1),Ho.fromBufferAttribute(e,s),i[s]=i[s-1],i[s]+=Wo.distanceTo(Ho);t.setAttribute("lineDistance",new Es(i,1))}else j("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const i=this.geometry,s=this.matrixWorld,n=t.params.Line.threshold,a=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),qo.copy(i.boundingSphere),qo.applyMatrix4(s),qo.radius+=n,t.ray.intersectsSphere(qo)===!1)return;ap.copy(s).invert(),ya.copy(t.ray).applyMatrix4(ap);const o=n/((this.scale.x+this.scale.y+this.scale.z)/3),h=o*o,l=this.isLineSegments?2:1,u=i.index,c=i.attributes.position;if(u!==null){const d=Math.max(0,a.start),p=Math.min(u.count,a.start+a.count);for(let m=d,f=p-1;m<f;m+=l){const g=u.getX(m),y=u.getX(m+1),x=$o(this,t,ya,h,g,y,m);x&&e.push(x)}if(this.isLineLoop){const m=u.getX(p-1),f=u.getX(d),g=$o(this,t,ya,h,m,f,p-1);g&&e.push(g)}}else{const d=Math.max(0,a.start),p=Math.min(c.count,a.start+a.count);for(let m=d,f=p-1;m<f;m+=l){const g=$o(this,t,ya,h,m,m+1,m);g&&e.push(g)}if(this.isLineLoop){const m=$o(this,t,ya,h,p-1,d,p-1);m&&e.push(m)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,n=i.length;s<n;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}};function $o(r,t,e,i,s,n,a){const o=r.geometry.attributes.position;if(Wo.fromBufferAttribute(o,s),Ho.fromBufferAttribute(o,n),e.distanceSqToSegment(Wo,Ho,Su,op)>i)return;Su.applyMatrix4(r.matrixWorld);const h=t.ray.origin.distanceTo(Su);return h<t.near||h>t.far?void 0:{distance:h,point:op.clone().applyMatrix4(r.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:r}}const hp=new S,lp=new S;let nx=class extends Au{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,i=[];for(let s=0,n=e.count;s<n;s+=2)hp.fromBufferAttribute(e,s),lp.fromBufferAttribute(e,s+1),i[s]=s===0?0:i[s-1],i[s+1]=i[s]+hp.distanceTo(lp);t.setAttribute("lineDistance",new Es(i,1))}else j("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},rx=class extends Au{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}},Nu=class extends he{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ut(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}};const up=new G,Ru=new wo,Xo=new qe,jo=new S;class ax extends Pt{constructor(t=new rn,e=new Nu){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,s=this.matrixWorld,n=t.params.Points.threshold,a=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Xo.copy(i.boundingSphere),Xo.applyMatrix4(s),Xo.radius+=n,t.ray.intersectsSphere(Xo)===!1)return;up.copy(s).invert(),Ru.copy(t.ray).applyMatrix4(up);const o=n/((this.scale.x+this.scale.y+this.scale.z)/3),h=o*o,l=i.index,u=i.attributes.position;if(l!==null)for(let c=Math.max(0,a.start),d=Math.min(l.count,a.start+a.count);c<d;c++){const p=l.getX(c);jo.fromBufferAttribute(u,p),cp(jo,p,h,s,t,e,this)}else for(let c=Math.max(0,a.start),d=Math.min(u.count,a.start+a.count);c<d;c++)jo.fromBufferAttribute(u,c),cp(jo,c,h,s,t,e,this)}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,n=i.length;s<n;s++){const a=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}function cp(r,t,e,i,s,n,a){const o=Ru.distanceSqToPoint(r);if(o<e){const h=new S;Ru.closestPointToPoint(r,h),h.applyMatrix4(i);const l=s.ray.origin.distanceTo(h);if(l<s.near||l>s.far)return;n.push({distance:l,distanceToRay:Math.sqrt(o),point:h,index:t,face:null,faceIndex:null,barycoord:null,object:a})}}class dp extends Se{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=1003,this.minFilter=1003,this.generateMipmaps=!1,this.needsUpdate=!0}}class Eu extends Se{constructor(t,e,i=1014,s,n,a,o=1003,h=1003,l,u=1026,c=1){if(u!==1026&&u!==1027)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super({width:t,height:e,depth:c},s,n,a,o,h,u,i,l),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.source=new Kl(Object.assign({},t.image)),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}new S,new S,new S,new Xe,new S;class ox extends he{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ut(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}let Go=class extends he{constructor(t){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new ut(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ut(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new $e,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}},pi=class extends Go{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new nt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ht(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ut(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ut(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ut(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}};class hx extends he{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ut(16777215),this.specular=new ut(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ut(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new $e,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class lx extends he{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ut(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ut(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class ux extends he{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class cx extends he{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ut(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ut(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new $e,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class dx extends he{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ut(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new nt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class pp extends Uo{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}function Yo(r,t){return r&&r.constructor!==t?typeof t.BYTES_PER_ELEMENT=="number"?new t(r):Array.prototype.slice.call(r):r}function px(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function mx(r){const t=r.length,e=new Array(t);for(let i=0;i!==t;++i)e[i]=i;return e.sort(function(i,s){return r[i]-r[s]}),e}function mp(r,t,e){const i=r.length,s=new r.constructor(i);for(let n=0,a=0;a!==i;++n){const o=e[n]*t;for(let h=0;h!==t;++h)s[a++]=r[o+h]}return s}function fp(r,t,e,i){let s=1,n=r[0];for(;n!==void 0&&n[i]===void 0;)n=r[s++];if(n===void 0)return;let a=n[i];if(a!==void 0)if(Array.isArray(a))do a=n[i],a!==void 0&&(t.push(n.time),e.push(...a)),n=r[s++];while(n!==void 0);else if(a.toArray!==void 0)do a=n[i],a!==void 0&&(t.push(n.time),a.toArray(e,e.length)),n=r[s++];while(n!==void 0);else do a=n[i],a!==void 0&&(t.push(n.time),e.push(a)),n=r[s++];while(n!==void 0)}let xa=class{constructor(t,e,i,s){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,s=e[i],n=e[i-1];i:{t:{let a;e:{s:if(!(t<s)){for(let o=i+2;;){if(s===void 0){if(t<n)break s;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===o)break;if(n=s,s=e[++i],t<s)break t}a=e.length;break e}if(!(t>=n)){const o=e[1];t<o&&(i=2,n=o);for(let h=i-2;;){if(n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===h)break;if(s=n,n=e[--i-1],t>=n)break t}a=i,i=0;break e}break i}for(;i<a;){const o=i+a>>>1;t<e[o]?a=o:i=o+1}if(s=e[i],n=e[i-1],n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,n,s)}return this.interpolate_(i,n,t,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,s=this.valueSize,n=t*s;for(let a=0;a!==s;++a)e[a]=i[n+a];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}},fx=class extends xa{constructor(t,e,i,s){super(t,e,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(t,e,i){const s=this.parameterPositions;let n=t-2,a=t+1,o=s[n],h=s[a];if(o===void 0)switch(this.getSettings_().endingStart){case 2401:n=t,o=2*e-i;break;case 2402:n=s.length-2,o=e+s[n]-s[n+1];break;default:n=t,o=i}if(h===void 0)switch(this.getSettings_().endingEnd){case 2401:a=t,h=2*i-e;break;case 2402:a=1,h=i+s[1]-s[0];break;default:a=t-1,h=e}const l=.5*(i-e),u=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(h-i),this._offsetPrev=n*u,this._offsetNext=a*u}interpolate_(t,e,i,s){const n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,h=t*o,l=h-o,u=this._offsetPrev,c=this._offsetNext,d=this._weightPrev,p=this._weightNext,m=(i-e)/(s-e),f=m*m,g=f*m,y=-d*g+2*d*f-d*m,x=(1+d)*g+(-1.5-2*d)*f+(-.5+d)*m+1,_=(-1-p)*g+(1.5+p)*f+.5*m,M=p*g-p*f;for(let v=0;v!==o;++v)n[v]=y*a[u+v]+x*a[l+v]+_*a[h+v]+M*a[c+v];return n}},gp=class extends xa{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t,e,i,s){const n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,h=t*o,l=h-o,u=(i-e)/(s-e),c=1-u;for(let d=0;d!==o;++d)n[d]=a[l+d]*c+a[h+d]*u;return n}},gx=class extends xa{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t){return this.copySampleValue_(t-1)}},mi=class{constructor(t,e,i,s){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Yo(e,this.TimeBufferType),this.values=Yo(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:Yo(t.times,Array),values:Yo(t.values,Array)};const s=t.getInterpolation();s!==t.DefaultInterpolation&&(i.interpolation=s)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new gx(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new gp(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new fx(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case 2300:e=this.InterpolantFactoryMethodDiscrete;break;case 2301:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(e===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(t===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return j("KeyframeTrack:",i),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const e=this.times;for(let i=0,s=e.length;i!==s;++i)e[i]+=t}return this}scale(t){if(t!==1){const e=this.times;for(let i=0,s=e.length;i!==s;++i)e[i]*=t}return this}trim(t,e){const i=this.times,s=i.length;let n=0,a=s-1;for(;n!==s&&i[n]<t;)++n;for(;a!==-1&&i[a]>e;)--a;if(++a,n!==0||a!==s){n>=a&&(a=Math.max(a,1),n=a-1);const o=this.getValueSize();this.times=i.slice(n,a),this.values=this.values.slice(n*o,a*o)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(et("KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,s=this.values,n=i.length;n===0&&(et("KeyframeTrack: Track is empty.",this),t=!1);let a=null;for(let o=0;o!==n;o++){const h=i[o];if(typeof h=="number"&&isNaN(h)){et("KeyframeTrack: Time is not a valid number.",this,o,h),t=!1;break}if(a!==null&&a>h){et("KeyframeTrack: Out of order keys.",this,o,h,a),t=!1;break}a=h}if(s!==void 0&&px(s))for(let o=0,h=s.length;o!==h;++o){const l=s[o];if(isNaN(l)){et("KeyframeTrack: Value is not a valid number.",this,o,l),t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),i=this.getValueSize(),s=this.getInterpolation()===2302,n=t.length-1;let a=1;for(let o=1;o<n;++o){let h=!1;const l=t[o];if(l!==t[o+1]&&(o!==1||l!==t[0]))if(s)h=!0;else{const u=o*i,c=u-i,d=u+i;for(let p=0;p!==i;++p){const m=e[u+p];if(m!==e[c+p]||m!==e[d+p]){h=!0;break}}}if(h){if(o!==a){t[a]=t[o];const u=o*i,c=a*i;for(let d=0;d!==i;++d)e[c+d]=e[u+d]}++a}}if(n>0){t[a]=t[n];for(let o=n*i,h=a*i,l=0;l!==i;++l)e[h+l]=e[o+l];++a}return a!==t.length?(this.times=t.slice(0,a),this.values=e.slice(0,a*i)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),i=new this.constructor(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}};mi.prototype.ValueTypeName="",mi.prototype.TimeBufferType=Float32Array,mi.prototype.ValueBufferType=Float32Array,mi.prototype.DefaultInterpolation=2301;let tr=class extends mi{constructor(t,e,i){super(t,e,i)}};tr.prototype.ValueTypeName="bool",tr.prototype.ValueBufferType=Array,tr.prototype.DefaultInterpolation=2300,tr.prototype.InterpolantFactoryMethodLinear=void 0,tr.prototype.InterpolantFactoryMethodSmooth=void 0;let yp=class extends mi{constructor(t,e,i,s){super(t,e,i,s)}};yp.prototype.ValueTypeName="color";let er=class extends mi{constructor(t,e,i,s){super(t,e,i,s)}};er.prototype.ValueTypeName="number";let yx=class extends xa{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t,e,i,s){const n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,h=(i-e)/(s-e);let l=t*o;for(let u=l+o;l!==u;l+=4)Te.slerpFlat(n,0,a,l-o,a,l,h);return n}},zs=class extends mi{constructor(t,e,i,s){super(t,e,i,s)}InterpolantFactoryMethodLinear(t){return new yx(this.times,this.values,this.getValueSize(),t)}};zs.prototype.ValueTypeName="quaternion",zs.prototype.InterpolantFactoryMethodSmooth=void 0;let ir=class extends mi{constructor(t,e,i){super(t,e,i)}};ir.prototype.ValueTypeName="string",ir.prototype.ValueBufferType=Array,ir.prototype.DefaultInterpolation=2300,ir.prototype.InterpolantFactoryMethodLinear=void 0,ir.prototype.InterpolantFactoryMethodSmooth=void 0;let Ls=class extends mi{constructor(t,e,i,s){super(t,e,i,s)}};Ls.prototype.ValueTypeName="vector";let ba=class{constructor(t="",e=-1,i=[],s=2500){this.name=t,this.tracks=i,this.duration=e,this.blendMode=s,this.uuid=ai(),this.userData={},this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,s=1/(t.fps||1);for(let a=0,o=i.length;a!==o;++a)e.push(xx(i[a]).scale(s));const n=new this(t.name,t.duration,e,t.blendMode);return n.uuid=t.uuid,n.userData=JSON.parse(t.userData||"{}"),n}static toJSON(t){const e=[],i=t.tracks,s={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode,userData:JSON.stringify(t.userData)};for(let n=0,a=i.length;n!==a;++n)e.push(mi.toJSON(i[n]));return s}static CreateFromMorphTargetSequence(t,e,i,s){const n=e.length,a=[];for(let o=0;o<n;o++){let h=[],l=[];h.push((o+n-1)%n,o,(o+1)%n),l.push(0,1,0);const u=mx(h);h=mp(h,1,u),l=mp(l,1,u),s||h[0]!==0||(h.push(n),l.push(l[0])),a.push(new er(".morphTargetInfluences["+e[o].name+"]",h,l).scale(1/i))}return new this(t,-1,a)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const s=t;i=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<i.length;s++)if(i[s].name===e)return i[s];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const s={},n=/^([\w-]*?)([\d]+)$/;for(let o=0,h=t.length;o<h;o++){const l=t[o],u=l.name.match(n);if(u&&u.length>1){const c=u[1];let d=s[c];d||(s[c]=d=[]),d.push(l)}}const a=[];for(const o in s)a.push(this.CreateFromMorphTargetSequence(o,s[o],e,i));return a}static parseAnimation(t,e){if(j("AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!t)return et("AnimationClip: No animation in JSONLoader data."),null;const i=function(u,c,d,p,m){if(d.length!==0){const f=[],g=[];fp(d,f,g,p),f.length!==0&&m.push(new u(c,f,g))}},s=[],n=t.name||"default",a=t.fps||30,o=t.blendMode;let h=t.length||-1;const l=t.hierarchy||[];for(let u=0;u<l.length;u++){const c=l[u].keys;if(c&&c.length!==0)if(c[0].morphTargets){const d={};let p;for(p=0;p<c.length;p++)if(c[p].morphTargets)for(let m=0;m<c[p].morphTargets.length;m++)d[c[p].morphTargets[m]]=-1;for(const m in d){const f=[],g=[];for(let y=0;y!==c[p].morphTargets.length;++y){const x=c[p];f.push(x.time),g.push(x.morphTarget===m?1:0)}s.push(new er(".morphTargetInfluence["+m+"]",f,g))}h=d.length*a}else{const d=".bones["+e[u].name+"]";i(Ls,d+".position",c,"pos",s),i(zs,d+".quaternion",c,"rot",s),i(Ls,d+".scale",c,"scl",s)}}return s.length===0?null:new this(n,h,s,o)}resetDuration(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){const s=this.tracks[e];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let i=0;i<this.tracks.length;i++)t.push(this.tracks[i].clone());const e=new this.constructor(this.name,this.duration,t,this.blendMode);return e.userData=JSON.parse(JSON.stringify(this.userData)),e}toJSON(){return this.constructor.toJSON(this)}};function xx(r){if(r.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=(function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return er;case"vector":case"vector2":case"vector3":case"vector4":return Ls;case"color":return yp;case"quaternion":return zs;case"bool":case"boolean":return tr;case"string":return ir}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)})(r.type);if(r.times===void 0){const e=[],i=[];fp(r.keys,e,i,"value"),r.times=e,r.values=i}return t.parse!==void 0?t.parse(r):new t(r.name,r.times,r.values,r.interpolation)}const Ki={enabled:!1,files:{},add:function(r,t){this.enabled!==!1&&(this.files[r]=t)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};class bx{constructor(t,e,i){const s=this;let n,a=!1,o=0,h=0;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.abortController=new AbortController,this.itemStart=function(u){h++,a===!1&&s.onStart!==void 0&&s.onStart(u,o,h),a=!0},this.itemEnd=function(u){o++,s.onProgress!==void 0&&s.onProgress(u,o,h),o===h&&(a=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(u){s.onError!==void 0&&s.onError(u)},this.resolveURL=function(u){return n?n(u):u},this.setURLModifier=function(u){return n=u,this},this.addHandler=function(u,c){return l.push(u,c),this},this.removeHandler=function(u){const c=l.indexOf(u);return c!==-1&&l.splice(c,2),this},this.getHandler=function(u){for(let c=0,d=l.length;c<d;c+=2){const p=l[c],m=l[c+1];if(p.global&&(p.lastIndex=0),p.test(u))return m}return null},this.abort=function(){return this.abortController.abort(),this.abortController=new AbortController,this}}}const Mx=new bx;let sr=class{constructor(t){this.manager=t!==void 0?t:Mx,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise(function(s,n){i.load(t,s,e,n)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}abort(){return this}};sr.DEFAULT_MATERIAL_NAME="__DEFAULT";const ts={};class _x extends Error{constructor(t,e){super(t),this.response=e}}let xp=class extends sr{constructor(t){super(t),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(t,e,i,s){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const n=Ki.get(`file:${t}`);if(n!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(n),this.manager.itemEnd(t)},0),n;if(ts[t]!==void 0)return void ts[t].push({onLoad:e,onProgress:i,onError:s});ts[t]=[],ts[t].push({onLoad:e,onProgress:i,onError:s});const a=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),o=this.mimeType,h=this.responseType;fetch(a).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&j("FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;const u=ts[t],c=l.body.getReader(),d=l.headers.get("X-File-Size")||l.headers.get("Content-Length"),p=d?parseInt(d):0,m=p!==0;let f=0;const g=new ReadableStream({start(y){(function x(){c.read().then(({done:_,value:M})=>{if(_)y.close();else{f+=M.byteLength;const v=new ProgressEvent("progress",{lengthComputable:m,loaded:f,total:p});for(let N=0,T=u.length;N<T;N++){const C=u[N];C.onProgress&&C.onProgress(v)}y.enqueue(M),x()}},_=>{y.error(_)})})()}});return new Response(g)}throw new _x(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(h){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(u=>new DOMParser().parseFromString(u,o));case"json":return l.json();default:if(o==="")return l.text();{const u=/charset="?([^;"\s]*)"?/i.exec(o),c=u&&u[1]?u[1].toLowerCase():void 0,d=new TextDecoder(c);return l.arrayBuffer().then(p=>d.decode(p))}}}).then(l=>{Ki.add(`file:${t}`,l);const u=ts[t];delete ts[t];for(let c=0,d=u.length;c<d;c++){const p=u[c];p.onLoad&&p.onLoad(l)}}).catch(l=>{const u=ts[t];if(u===void 0)throw this.manager.itemError(t),l;delete ts[t];for(let c=0,d=u.length;c<d;c++){const p=u[c];p.onError&&p.onError(l)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}};const nr=new WeakMap;let vx=class extends sr{constructor(t){super(t)}load(t,e,i,s){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const n=this,a=Ki.get(`image:${t}`);if(a!==void 0){if(a.complete===!0)n.manager.itemStart(t),setTimeout(function(){e&&e(a),n.manager.itemEnd(t)},0);else{let c=nr.get(a);c===void 0&&(c=[],nr.set(a,c)),c.push({onLoad:e,onError:s})}return a}const o=jl("img");function h(){u(),e&&e(this);const c=nr.get(this)||[];for(let d=0;d<c.length;d++){const p=c[d];p.onLoad&&p.onLoad(this)}nr.delete(this),n.manager.itemEnd(t)}function l(c){u(),s&&s(c),Ki.remove(`image:${t}`);const d=nr.get(this)||[];for(let p=0;p<d.length;p++){const m=d[p];m.onError&&m.onError(c)}nr.delete(this),n.manager.itemError(t),n.manager.itemEnd(t)}function u(){o.removeEventListener("load",h,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",h,!1),o.addEventListener("error",l,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),Ki.add(`image:${t}`,o),n.manager.itemStart(t),o.src=t,o}},wx=class extends sr{constructor(t){super(t)}load(t,e,i,s){const n=new Se,a=new vx(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(t,function(o){n.image=o,n.needsUpdate=!0,e!==void 0&&e(n)},i,s),n}},Iu=class extends Pt{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new ut(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(e.object.target=this.target.uuid),e}};const Cu=new G,bp=new S,Mp=new S;let zu=class{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new nt(512,512),this.mapType=1009,this.map=null,this.mapPass=null,this.matrix=new G,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Do,this._frameExtents=new nt(1,1),this._viewportCount=1,this._viewports=[new wt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;bp.setFromMatrixPosition(t.matrixWorld),e.position.copy(bp),Mp.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(Mp),e.updateMatrixWorld(),Cu.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Cu,e.coordinateSystem,e.reversedDepth),e.reversedDepth?i.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Cu)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.autoUpdate=t.autoUpdate,this.needsUpdate=t.needsUpdate,this.normalBias=t.normalBias,this.blurSamples=t.blurSamples,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.intensity!==1&&(t.intensity=this.intensity),this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}};class Tx extends zu{constructor(){super(new Li(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(t){const e=this.camera,i=2*aa*t.angle*this.focus,s=this.mapSize.width/this.mapSize.height*this.aspect,n=t.distance||e.far;i===e.fov&&s===e.aspect&&n===e.far||(e.fov=i,e.aspect=s,e.far=n,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class Sx extends Iu{constructor(t,e,i=0,s=Math.PI/3,n=0,a=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Pt.DEFAULT_UP),this.updateMatrix(),this.target=new Pt,this.distance=i,this.angle=s,this.penumbra=n,this.decay=a,this.map=null,this.shadow=new Tx}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const _p=new G,Ma=new S,Lu=new S;class Ax extends zu{constructor(){super(new Li(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new nt(4,2),this._viewportCount=6,this._viewports=[new wt(2,1,1,1),new wt(0,1,1,1),new wt(3,1,1,1),new wt(1,1,1,1),new wt(3,0,1,1),new wt(1,0,1,1)],this._cubeDirections=[new S(1,0,0),new S(-1,0,0),new S(0,0,1),new S(0,0,-1),new S(0,1,0),new S(0,-1,0)],this._cubeUps=[new S(0,1,0),new S(0,1,0),new S(0,1,0),new S(0,1,0),new S(0,0,1),new S(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,s=this.matrix,n=t.distance||i.far;n!==i.far&&(i.far=n,i.updateProjectionMatrix()),Ma.setFromMatrixPosition(t.matrixWorld),i.position.copy(Ma),Lu.copy(i.position),Lu.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(Lu),i.updateMatrixWorld(),s.makeTranslation(-Ma.x,-Ma.y,-Ma.z),_p.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_p,i.coordinateSystem,i.reversedDepth)}}class Nx extends Iu{constructor(t,e,i=0,s=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=s,this.shadow=new Ax}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}let Zo=class extends Bo{constructor(t=-1,e=1,i=1,s=-1,n=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=s,this.near=n,this.far=a,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,i,s,n,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=s,this.view.width=n,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let n=i-t,a=i+t,o=s+e,h=s-e;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=l*this.view.offsetX,a=n+l*this.view.width,o-=u*this.view.offsetY,h=o-u*this.view.height}this.projectionMatrix.makeOrthographic(n,a,o,h,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}};class Rx extends zu{constructor(){super(new Zo(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class Ex extends Iu{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Pt.DEFAULT_UP),this.updateMatrix(),this.target=new Pt,this.shadow=new Rx}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}let _a=class{static extractUrlBase(t){const e=t.lastIndexOf("/");return e===-1?"./":t.slice(0,e+1)}static resolveURL(t,e){return typeof t!="string"||t===""?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}};const Pu=new WeakMap;let Ix=class extends sr{constructor(t){super(t),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&j("ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&j("ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(t){return this.options=t,this}load(t,e,i,s){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const n=this,a=Ki.get(`image-bitmap:${t}`);if(a!==void 0)return n.manager.itemStart(t),a.then?void a.then(l=>{if(Pu.has(a)!==!0)return e&&e(l),n.manager.itemEnd(t),l;s&&s(Pu.get(a)),n.manager.itemError(t),n.manager.itemEnd(t)}):(setTimeout(function(){e&&e(a),n.manager.itemEnd(t)},0),a);const o={};o.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",o.headers=this.requestHeader,o.signal=typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const h=fetch(t,o).then(function(l){return l.blob()}).then(function(l){return createImageBitmap(l,Object.assign(n.options,{colorSpaceConversion:"none"}))}).then(function(l){return Ki.add(`image-bitmap:${t}`,l),e&&e(l),n.manager.itemEnd(t),l}).catch(function(l){s&&s(l),Pu.set(h,l),Ki.remove(`image-bitmap:${t}`),n.manager.itemError(t),n.manager.itemEnd(t)});Ki.add(`image-bitmap:${t}`,h),n.manager.itemStart(t)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}};new G,new G,new G,new S,new S,new S,new S,new S,new S,new S;let Cx=class{constructor(t,e,i){let s,n,a;switch(this.binding=t,this.valueSize=i,e){case"quaternion":s=this._slerp,n=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":s=this._select,n=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:s=this._lerp,n=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=n,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,s=this.valueSize,n=t*s+s;let a=this.cumulativeWeight;if(a===0){for(let o=0;o!==s;++o)i[n+o]=i[o];a=e}else{a+=e;const o=e/a;this._mixBufferRegion(i,n,0,o,s)}this.cumulativeWeight=a}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,s=i*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(e,s,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,s=t*e+e,n=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,n<1){const h=e*this._origIndex;this._mixBufferRegion(i,s,h,1-n,e)}a>0&&this._mixBufferRegionAdditive(i,s,this._addIndex*e,1,e);for(let h=e,l=e+e;h!==l;++h)if(i[h]!==i[h+e]){o.setValue(i,s);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,s=i*this._origIndex;t.getValue(e,s);for(let n=i,a=s;n!==a;++n)e[n]=e[s+n%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,s,n){if(s>=.5)for(let a=0;a!==n;++a)t[e+a]=t[i+a]}_slerp(t,e,i,s){Te.slerpFlat(t,e,t,e,t,i,s)}_slerpAdditive(t,e,i,s,n){const a=this._workIndex*n;Te.multiplyQuaternionsFlat(t,a,t,e,t,i),Te.slerpFlat(t,e,t,e,t,a,s)}_lerp(t,e,i,s,n){const a=1-s;for(let o=0;o!==n;++o){const h=e+o;t[h]=t[h]*a+t[i+o]*s}}_lerpAdditive(t,e,i,s,n){for(let a=0;a!==n;++a){const o=e+a;t[o]=t[o]+t[i+a]*s}}};const Bu="\\[\\]\\.:\\/",zx=new RegExp("["+Bu+"]","g"),Ou="[^"+Bu+"]",Lx="[^"+Bu.replace("\\.","")+"]",Px=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",Ou)+/(WCOD+)?/.source.replace("WCOD",Lx)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Ou)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Ou)+"$"),Bx=["material","materials","bones","map"];let zt=class ea{constructor(t,e,i){this.path=e,this.parsedPath=i||ea.parseTrackName(e),this.node=ea.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new ea.Composite(t,e,i):new ea(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(zx,"")}static parseTrackName(t){const e=Px.exec(t);if(e===null)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},s=i.nodeName&&i.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){const n=i.nodeName.substring(s+1);Bx.indexOf(n)!==-1&&(i.nodeName=i.nodeName.substring(0,s),i.objectName=n)}if(i.propertyName===null||i.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(e===void 0||e===""||e==="."||e===-1||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(i!==void 0)return i}if(t.children){const i=function(n){for(let a=0;a<n.length;a++){const o=n[a];if(o.name===e||o.uuid===e)return o;const h=i(o.children);if(h)return h}return null},s=i(t.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let s=0,n=i.length;s!==n;++s)t[e++]=i[s]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let s=0,n=i.length;s!==n;++s)i[s]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let s=0,n=i.length;s!==n;++s)i[s]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let s=0,n=i.length;s!==n;++s)i[s]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,s=e.propertyName;let n=e.propertyIndex;if(t||(t=ea.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void j("PropertyBinding: No target node found for track: "+this.path+".");if(i){let l=e.objectIndex;switch(i){case"materials":if(!t.material)return void et("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void et("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void et("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let u=0;u<t.length;u++)if(t[u].name===l){l=u;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void et("PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void et("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(t[i]===void 0)return void et("PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(l!==void 0){if(t[l]===void 0)return void et("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[l]}}const a=t[s];if(a===void 0)return void et("PropertyBinding: Trying to update property for track: "+e.nodeName+"."+s+" but it wasn't found.",t);let o=this.Versioning.None;this.targetObject=t,t.isMaterial===!0?o=this.Versioning.NeedsUpdate:t.isObject3D===!0&&(o=this.Versioning.MatrixWorldNeedsUpdate);let h=this.BindingType.Direct;if(n!==void 0){if(s==="morphTargetInfluences"){if(!t.geometry)return void et("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void et("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);t.morphTargetDictionary[n]!==void 0&&(n=t.morphTargetDictionary[n])}h=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=n}else a.fromArray!==void 0&&a.toArray!==void 0?(h=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(h=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[h],this.setValue=this.SetterByBindingTypeAndVersioning[h][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};zt.Composite=class{constructor(r,t,e){const i=e||zt.parseTrackName(t);this._targetGroup=r,this._bindings=r.subscribe_(t,i)}getValue(r,t){this.bind();const e=this._targetGroup.nCachedObjects_,i=this._bindings[e];i!==void 0&&i.getValue(r,t)}setValue(r,t){const e=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=e.length;i!==s;++i)e[i].setValue(r,t)}bind(){const r=this._bindings;for(let t=this._targetGroup.nCachedObjects_,e=r.length;t!==e;++t)r[t].bind()}unbind(){const r=this._bindings;for(let t=this._targetGroup.nCachedObjects_,e=r.length;t!==e;++t)r[t].unbind()}},zt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},zt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},zt.prototype.GetterByBindingType=[zt.prototype._getValue_direct,zt.prototype._getValue_array,zt.prototype._getValue_arrayElement,zt.prototype._getValue_toArray],zt.prototype.SetterByBindingTypeAndVersioning=[[zt.prototype._setValue_direct,zt.prototype._setValue_direct_setNeedsUpdate,zt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[zt.prototype._setValue_array,zt.prototype._setValue_array_setNeedsUpdate,zt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[zt.prototype._setValue_arrayElement,zt.prototype._setValue_arrayElement_setNeedsUpdate,zt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[zt.prototype._setValue_fromArray,zt.prototype._setValue_fromArray_setNeedsUpdate,zt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];let Ox=class{constructor(t,e,i=null,s=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=s;const n=e.tracks,a=n.length,o=new Array(a),h={endingStart:2400,endingEnd:2400};for(let l=0;l!==a;++l){const u=n[l].createInterpolant(null);o[l]=u,u.settings=h}this._interpolantSettings=h,this._interpolants=o,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i=!1){if(t.fadeOut(e),this.fadeIn(e),i===!0){const s=this._clip.duration,n=t._clip.duration,a=n/s,o=s/n;t.warp(1,a,e),this.warp(o,1,e)}return this}crossFadeTo(t,e,i=!1){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return t!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const s=this._mixer,n=s.time,a=this.timeScale;let o=this._timeScaleInterpolant;o===null&&(o=s._lendControlInterpolant(),this._timeScaleInterpolant=o);const h=o.parameterPositions,l=o.sampleValues;return h[0]=n,h[1]=n+i,l[0]=t/a,l[1]=e/a,this}stopWarping(){const t=this._timeScaleInterpolant;return t!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,s){if(!this.enabled)return void this._updateWeight(t);const n=this._startTime;if(n!==null){const h=(t-n)*i;h<0||i===0?e=0:(this._startTime=null,e=i*h)}e*=this._updateTimeScale(t);const a=this._updateTime(e),o=this._updateWeight(t);if(o>0){const h=this._interpolants,l=this._propertyBindings;if(this.blendMode===2501)for(let u=0,c=h.length;u!==c;++u)h[u].evaluate(a),l[u].accumulateAdditive(o);else for(let u=0,c=h.length;u!==c;++u)h[u].evaluate(a),l[u].accumulate(s,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(i!==null){const s=i.evaluate(t)[0];e*=s,t>i.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;i!==null&&(e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),e===0?this.paused=!0:this.timeScale=e))}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let s=this.time+t,n=this._loopCount;const a=i===2202;if(t===0)return n===-1||!a||1&~n?s:e-s;if(i===2200){n===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));i:{if(s>=e)s=e;else{if(!(s<0)){this.time=s;break i}s=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(n===-1&&(t>=0?(n=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),s>=e||s<0){const o=Math.floor(s/e);s-=e*o,n+=Math.abs(o);const h=this.repetitions-n;if(h<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=t>0?e:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(h===1){const l=t<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=n,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=s;if(a&&!(1&~n))return e-s}return s}_setEndings(t,e,i){const s=this._interpolantSettings;i?(s.endingStart=2401,s.endingEnd=2401):(s.endingStart=t?this.zeroSlopeAtStart?2401:2400:2402,s.endingEnd=e?this.zeroSlopeAtEnd?2401:2400:2402)}_scheduleFading(t,e,i){const s=this._mixer,n=s.time;let a=this._weightInterpolant;a===null&&(a=s._lendControlInterpolant(),this._weightInterpolant=a);const o=a.parameterPositions,h=a.sampleValues;return o[0]=n,h[0]=e,o[1]=n+t,h[1]=i,this}};const Vx=new Float32Array(1);let Fx=class extends vs{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,s=t._clip.tracks,n=s.length,a=t._propertyBindings,o=t._interpolants,h=i.uuid,l=this._bindingsByRootAndName;let u=l[h];u===void 0&&(u={},l[h]=u);for(let c=0;c!==n;++c){const d=s[c],p=d.name;let m=u[p];if(m!==void 0)++m.referenceCount,a[c]=m;else{if(m=a[c],m!==void 0){m._cacheIndex===null&&(++m.referenceCount,this._addInactiveBinding(m,h,p));continue}const f=e&&e._propertyBindings[c].binding.parsedPath;m=new Cx(zt.create(i,p,f),d.ValueTypeName,d.getValueSize()),++m.referenceCount,this._addInactiveBinding(m,h,p),a[c]=m}o[c].resultBuffer=m.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(t._cacheIndex===null){const i=(t._localRoot||this._root).uuid,s=t._clip.uuid,n=this._actionsByClip[s];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,s,i)}const e=t._propertyBindings;for(let i=0,s=e.length;i!==s;++i){const n=e[i];n.useCount++===0&&(this._lendBinding(n),n.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let i=0,s=e.length;i!==s;++i){const n=e[i];--n.useCount===0&&(n.restoreOriginalState(),this._takeBackBinding(n))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return e!==null&&e<this._nActiveActions}_addInactiveAction(t,e,i){const s=this._actions,n=this._actionsByClip;let a=n[e];if(a===void 0)a={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,n[e]=a;else{const o=a.knownActions;t._byClipCacheIndex=o.length,o.push(t)}t._cacheIndex=s.length,s.push(t),a.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],s=t._cacheIndex;i._cacheIndex=s,e[s]=i,e.pop(),t._cacheIndex=null;const n=t._clip.uuid,a=this._actionsByClip,o=a[n],h=o.knownActions,l=h[h.length-1],u=t._byClipCacheIndex;l._byClipCacheIndex=u,h[u]=l,h.pop(),t._byClipCacheIndex=null,delete o.actionByRoot[(t._localRoot||this._root).uuid],h.length===0&&delete a[n],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let i=0,s=e.length;i!==s;++i){const n=e[i];--n.referenceCount===0&&this._removeInactiveBinding(n)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,s=this._nActiveActions++,n=e[s];t._cacheIndex=s,e[s]=t,n._cacheIndex=i,e[i]=n}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,s=--this._nActiveActions,n=e[s];t._cacheIndex=s,e[s]=t,n._cacheIndex=i,e[i]=n}_addInactiveBinding(t,e,i){const s=this._bindingsByRootAndName,n=this._bindings;let a=s[e];a===void 0&&(a={},s[e]=a),a[i]=t,t._cacheIndex=n.length,n.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,s=i.rootNode.uuid,n=i.path,a=this._bindingsByRootAndName,o=a[s],h=e[e.length-1],l=t._cacheIndex;h._cacheIndex=l,e[l]=h,e.pop(),delete o[n],Object.keys(o).length===0&&delete a[s]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,s=this._nActiveBindings++,n=e[s];t._cacheIndex=s,e[s]=t,n._cacheIndex=i,e[i]=n}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,s=--this._nActiveBindings,n=e[s];t._cacheIndex=s,e[s]=t,n._cacheIndex=i,e[i]=n}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return i===void 0&&(i=new gp(new Float32Array(2),new Float32Array(2),1,Vx),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,s=--this._nActiveControlInterpolants,n=e[s];t.__cacheIndex=s,e[s]=t,n.__cacheIndex=i,e[i]=n}clipAction(t,e,i){const s=e||this._root,n=s.uuid;let a=typeof t=="string"?ba.findByName(s,t):t;const o=a!==null?a.uuid:t,h=this._actionsByClip[o];let l=null;if(i===void 0&&(i=a!==null?a.blendMode:2500),h!==void 0){const c=h.actionByRoot[n];if(c!==void 0&&c.blendMode===i)return c;l=h.knownActions[0],a===null&&(a=l._clip)}if(a===null)return null;const u=new Ox(this,a,e,i);return this._bindAction(u,l),this._addInactiveAction(u,o,n),u}existingAction(t,e){const i=e||this._root,s=i.uuid,n=typeof t=="string"?ba.findByName(i,t):t,a=n?n.uuid:t,o=this._actionsByClip[a];return o!==void 0&&o.actionByRoot[s]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,s=this.time+=t,n=Math.sign(t),a=this._accuIndex^=1;for(let l=0;l!==i;++l)e[l]._update(s,t,n,a);const o=this._bindings,h=this._nActiveBindings;for(let l=0;l!==h;++l)o[l].apply(a);return this}setTime(t){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,s=this._actionsByClip,n=s[i];if(n!==void 0){const a=n.knownActions;for(let o=0,h=a.length;o!==h;++o){const l=a[o];this._deactivateAction(l);const u=l._cacheIndex,c=e[e.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,c._cacheIndex=u,e[u]=c,e.pop(),this._removeInactiveBindingsForAction(l)}delete s[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const n in i){const a=i[n].actionByRoot[e];a!==void 0&&(this._deactivateAction(a),this._removeInactiveAction(a))}const s=this._bindingsByRootAndName[e];if(s!==void 0)for(const n in s){const a=s[n];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(t,e){const i=this.existingAction(t,e);i!==null&&(this._deactivateAction(i),this._removeInactiveAction(i))}},kx=class extends _u{constructor(t,e,i=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}};new G;class Vu{constructor(t,e,i,s){Vu.prototype.isMatrix2=!0,this.elements=[1,0,0,1],t!==void 0&&this.set(t,e,i,s)}identity(){return this.set(1,0,0,1),this}fromArray(t,e=0){for(let i=0;i<4;i++)this.elements[i]=t[i+e];return this}set(t,e,i,s){const n=this.elements;return n[0]=t,n[2]=e,n[1]=i,n[3]=s,this}}new nt,new S,new S,new S,new S,new S,new S,new S,new S,new S,new G,new G,new S,new ut,new ut,new S,new S,new S,new S,new Bo,new hi,new S,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:S0}})),typeof window<"u"&&(window.__THREE__?j("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=S0);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Dx=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","aoMapIntensity","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveIntensity","emissiveMap","envMap","envMapIntensity","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","lightMapIntensity","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"],Fu=new WeakMap;class Ux{constructor(t){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(t),this.hasAnimation=t.object.isSkinnedMesh===!0,this.refreshUniforms=Dx,this.renderId=0}firstInitialization(t){return this.renderObjects.has(t)===!1&&(this.getRenderObjectData(t),!0)}needsVelocity(t){const e=t.getMRT();return e!==null&&e.has("velocity")}getRenderObjectData(t){let e=this.renderObjects.get(t);if(e===void 0){const{geometry:i,material:s,object:n}=t;if(e={material:this.getMaterialData(s),geometry:{id:i.id,attributes:this.getAttributesData(i.attributes),indexVersion:i.index?i.index.version:null,drawRange:{start:i.drawRange.start,count:i.drawRange.count}},worldMatrix:n.matrixWorld.clone()},n.center&&(e.center=n.center.clone()),n.morphTargetInfluences&&(e.morphTargetInfluences=n.morphTargetInfluences.slice()),t.bundle!==null&&(e.version=t.bundle.version),e.material.transmission>0){const{width:a,height:o}=t.context;e.bufferWidth=a,e.bufferHeight=o}e.lights=this.getLightsData(t.lightsNode.getLights()),this.renderObjects.set(t,e)}return e}getAttributesData(t){const e={};for(const i in t){const s=t[i];e[i]={version:s.version}}return e}containsNode(t){const e=t.material;for(const i in e)if(e[i]&&e[i].isNode)return!0;return t.renderer.overrideNodes.modelViewMatrix!==null||t.renderer.overrideNodes.modelNormalViewMatrix!==null}getMaterialData(t){const e={};for(const i of this.refreshUniforms){const s=t[i];s!=null&&(typeof s=="object"&&s.clone!==void 0?s.isTexture===!0?e[i]={id:s.id,version:s.version}:e[i]=s.clone():e[i]=s)}return e}equals(t,e){const{object:i,material:s,geometry:n}=t,a=this.getRenderObjectData(t);if(a.worldMatrix.equals(i.matrixWorld)!==!0)return a.worldMatrix.copy(i.matrixWorld),!1;const o=a.material;for(const g in o){const y=o[g],x=s[g];if(y.equals!==void 0){if(y.equals(x)===!1)return y.copy(x),!1}else if(x.isTexture===!0){if(y.id!==x.id||y.version!==x.version)return y.id=x.id,y.version=x.version,!1}else if(y!==x)return o[g]=x,!1}if(o.transmission>0){const{width:g,height:y}=t.context;if(a.bufferWidth!==g||a.bufferHeight!==y)return a.bufferWidth=g,a.bufferHeight=y,!1}const h=a.geometry,l=n.attributes,u=h.attributes,c=Object.keys(u),d=Object.keys(l);if(h.id!==n.id)return h.id=n.id,!1;if(c.length!==d.length)return a.geometry.attributes=this.getAttributesData(l),!1;for(const g of c){const y=u[g],x=l[g];if(x===void 0)return delete u[g],!1;if(y.version!==x.version)return y.version=x.version,!1}const p=n.index,m=h.indexVersion,f=p?p.version:null;if(m!==f)return h.indexVersion=f,!1;if(h.drawRange.start!==n.drawRange.start||h.drawRange.count!==n.drawRange.count)return h.drawRange.start=n.drawRange.start,h.drawRange.count=n.drawRange.count,!1;if(a.morphTargetInfluences){let g=!1;for(let y=0;y<a.morphTargetInfluences.length;y++)a.morphTargetInfluences[y]!==i.morphTargetInfluences[y]&&(g=!0);if(g)return!0}if(a.lights){for(let g=0;g<e.length;g++)if(a.lights[g].map!==e[g].map)return!1}return a.center&&a.center.equals(i.center)===!1?(a.center.copy(i.center),!0):(t.bundle!==null&&(a.version=t.bundle.version),!0)}getLightsData(t){const e=[];for(const i of t)i.isSpotLight===!0&&i.map!==null&&e.push({map:i.map.version});return e}getLights(t,e){if(Fu.has(t)){const s=Fu.get(t);if(s.renderId===e)return s.lightsData}const i=this.getLightsData(t.getLights());return Fu.set(t,{renderId:e,lightsData:i}),i}needsRefresh(t,e){if(this.hasNode||this.hasAnimation||this.firstInitialization(t)||this.needsVelocity(e.renderer))return!0;const{renderId:i}=e;if(this.renderId!==i)return this.renderId=i,!0;const s=t.object.static===!0,n=t.bundle!==null&&t.bundle.static===!0&&this.getRenderObjectData(t).version===t.bundle.version;if(s||n)return!1;const a=this.getLights(t.lightsNode,i);return this.equals(t,a)!==!0}}function va(r,t=0){let e=3735928559^t,i=1103547991^t;if(r instanceof Array)for(let s,n=0;n<r.length;n++)s=r[n],e=Math.imul(e^s,2654435761),i=Math.imul(i^s,1597334677);else for(let s,n=0;n<r.length;n++)s=r.charCodeAt(n),e=Math.imul(e^s,2654435761),i=Math.imul(i^s,1597334677);return e=Math.imul(e^e>>>16,2246822507),e^=Math.imul(i^i>>>13,3266489909),i=Math.imul(i^i>>>16,2246822507),i^=Math.imul(e^e>>>13,3266489909),4294967296*(2097151&i)+(e>>>0)}const Wx=r=>va(r),vp=r=>va(r),wp=(...r)=>va(r);function Tp(r,t=!1){const e=[];r.isNode===!0&&e.push(r.id);for(const{property:i,childNode:s}of Jo(r))e.push(va(i.slice(0,-4)),s.getCacheKey(t));return va(e)}function*Jo(r,t=!1){for(const e of Object.getOwnPropertyNames(r)){if(e.startsWith("_")===!0)continue;const i=r[e];if(Array.isArray(i)===!0)for(let s=0;s<i.length;s++){const n=i[s];n&&(n.isNode===!0||t&&typeof n.toJSON=="function")&&(yield{property:e,index:s,childNode:n})}else if(i&&i.isNode===!0)yield{property:e,childNode:i};else if(i&&Object.getPrototypeOf(i)===Object.prototype)for(const s in i){if(s.startsWith("_")===!0)continue;const n=i[s];n&&(n.isNode===!0||t&&typeof n.toJSON=="function")&&(yield{property:e,index:s,childNode:n})}}}const Sp=new WeakMap;function Ps(r){if(r==null)return null;const t=typeof r;return r.isNode===!0?"node":t==="number"?"float":t==="boolean"?"bool":t==="string"?"string":t==="function"?"shader":r.isVector2===!0?"vec2":r.isVector3===!0?"vec3":r.isVector4===!0?"vec4":r.isMatrix2===!0?"mat2":r.isMatrix3===!0?"mat3":r.isMatrix4===!0?"mat4":r.isColor===!0?"color":r instanceof ArrayBuffer?"ArrayBuffer":null}function ku(r,...t){const e=r?r.slice(-4):void 0;return t.length===1&&(e==="vec2"?t=[t[0],t[0]]:e==="vec3"?t=[t[0],t[0],t[0]]:e==="vec4"&&(t=[t[0],t[0],t[0],t[0]])),r==="color"?new ut(...t):e==="vec2"?new nt(...t):e==="vec3"?new S(...t):e==="vec4"?new wt(...t):e==="mat2"?new Vu(...t):e==="mat3"?new He(...t):e==="mat4"?new G(...t):r==="bool"?t[0]||!1:r==="float"||r==="int"||r==="uint"?t[0]||0:r==="string"?t[0]||"":r==="ArrayBuffer"?Np(t[0]):null}function Hx(r){let t=Sp.get(r);return t===void 0&&(t={},Sp.set(r,t)),t}function Ap(r){let t="";const e=new Uint8Array(r);for(let i=0;i<e.length;i++)t+=String.fromCharCode(e[i]);return btoa(t)}function Np(r){return Uint8Array.from(atob(r),t=>t.charCodeAt(0)).buffer}const Qo={VERTEX:"vertex"},Tt={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},hn={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"};[...["fragment","vertex"]];const wa=["x","y","z","w"],qx={analyze:"setup",generate:"analyze"};let $x=0;class $ extends vs{static get type(){return"Node"}constructor(t=null){super(),this.nodeType=t,this.updateType=Tt.NONE,this.updateBeforeType=Tt.NONE,this.updateAfterType=Tt.NONE,this.uuid=Zl.generateUUID(),this.version=0,this.global=!1,this.parents=!1,this.isNode=!0,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:$x++})}set needsUpdate(t){t===!0&&this.version++}get type(){return this.constructor.type}onUpdate(t,e){return this.updateType=e,this.update=t.bind(this),this}onFrameUpdate(t){return this.onUpdate(t,Tt.FRAME)}onRenderUpdate(t){return this.onUpdate(t,Tt.RENDER)}onObjectUpdate(t){return this.onUpdate(t,Tt.OBJECT)}onReference(t){return this.updateReference=t.bind(this),this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:t}of Jo(this))yield t}dispose(){this.dispatchEvent({type:"dispose"})}traverse(t){t(this);for(const e of this.getChildren())e.traverse(t)}getCacheKey(t=!1){return(t=t||this.version!==this._cacheKeyVersion)!==!0&&this._cacheKey!==null||(this._cacheKey=wp(Tp(this,t),this.customCacheKey()),this._cacheKeyVersion=this.version),this._cacheKey}customCacheKey(){return 0}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(t){const e=this.getNodeType(t);return t.getElementType(e)}getMemberType(){return"void"}getNodeType(t){const e=t.getNodeProperties(this);return e.outputNode?e.outputNode.getNodeType(t):this.nodeType}getShared(t){const e=this.getHash(t);return t.getNodeFromHash(e)||this}getArrayCount(){return null}setup(t){const e=t.getNodeProperties(this);let i=0;for(const s of this.getChildren())e["node"+i++]=s;return e.outputNode||null}analyze(t,e=null){const i=t.increaseUsage(this);if(this.parents===!0){const s=t.getDataFromNode(this,"any");s.stages=s.stages||{},s.stages[t.shaderStage]=s.stages[t.shaderStage]||[],s.stages[t.shaderStage].push(e)}if(i===1){const s=t.getNodeProperties(this);for(const n of Object.values(s))n&&n.isNode===!0&&n.build(t,this)}}generate(t,e){const{outputNode:i}=t.getNodeProperties(this);if(i&&i.isNode===!0)return i.build(t,e)}updateBefore(){j("Abstract function.")}updateAfter(){j("Abstract function.")}update(){j("Abstract function.")}build(t,e=null){const i=this.getShared(t);if(this!==i)return i.build(t,e);const s=t.getDataFromNode(this);s.buildStages=s.buildStages||{},s.buildStages[t.buildStage]=!0;const n=qx[t.buildStage];if(n&&s.buildStages[n]!==!0){const h=t.getBuildStage();t.setBuildStage(n),this.build(t),t.setBuildStage(h)}t.addNode(this),t.addChain(this);let a=null;const o=t.getBuildStage();if(o==="setup"){this.updateReference(t);const h=t.getNodeProperties(this);if(h.initialized!==!0){h.initialized=!0,h.outputNode=this.setup(t)||h.outputNode||null;for(const l of Object.values(h))if(l&&l.isNode===!0){if(l.parents===!0){const u=t.getNodeProperties(l);u.parents=u.parents||[],u.parents.push(this)}l.build(t)}}a=h.outputNode}else if(o==="analyze")this.analyze(t,e);else if(o==="generate"){if(this.generate.length===1){const h=this.getNodeType(t),l=t.getDataFromNode(this);a=l.snippet,a===void 0?l.generated===void 0?(l.generated=!0,a=this.generate(t)||"",l.snippet=a):(j("Node: Recursion detected.",this),a="/* Recursion detected. */"):l.flowCodes!==void 0&&t.context.nodeBlock!==void 0&&t.addFlowCodeHierarchy(this,t.context.nodeBlock),a=t.format(a,h,e)}else a=this.generate(t,e)||"";a===""&&e!==null&&e!=="void"&&e!=="OutputType"&&(et(`TSL: Invalid generated code, expected a "${e}".`),a=t.generateConst(e))}return t.removeChain(this),t.addSequentialNode(this),a}getSerializeChildren(){return Jo(this)}serialize(t){const e=this.getSerializeChildren(),i={};for(const{property:s,index:n,childNode:a}of e)n!==void 0?(i[s]===void 0&&(i[s]=Number.isInteger(n)?[]:{}),i[s][n]=a.toJSON(t.meta).uuid):i[s]=a.toJSON(t.meta).uuid;Object.keys(i).length>0&&(t.inputNodes=i)}deserialize(t){if(t.inputNodes!==void 0){const e=t.meta.nodes;for(const i in t.inputNodes)if(Array.isArray(t.inputNodes[i])){const s=[];for(const n of t.inputNodes[i])s.push(e[n]);this[i]=s}else if(typeof t.inputNodes[i]=="object"){const s={};for(const n in t.inputNodes[i]){const a=t.inputNodes[i][n];s[n]=e[a]}this[i]=s}else{const s=t.inputNodes[i];this[i]=e[s]}}}toJSON(t){const{uuid:e,type:i}=this,s=t===void 0||typeof t=="string";s&&(t={textures:{},images:{},nodes:{}});let n=t.nodes[e];function a(o){const h=[];for(const l in o){const u=o[l];delete u.metadata,h.push(u)}return h}if(n===void 0&&(n={uuid:e,type:i,meta:t,metadata:{version:4.7,type:"Node",generator:"Node.toJSON"}},s!==!0&&(t.nodes[n.uuid]=n),this.serialize(n),delete n.meta),s){const o=a(t.textures),h=a(t.images),l=a(t.nodes);o.length>0&&(n.textures=o),h.length>0&&(n.images=h),l.length>0&&(n.nodes=l)}return n}}class rr extends ${static get type(){return"ArrayElementNode"}constructor(t,e){super(),this.node=t,this.indexNode=e,this.isArrayElementNode=!0}getNodeType(t){return this.node.getElementType(t)}generate(t){const e=this.indexNode.getNodeType(t);return`${this.node.build(t)}[ ${this.indexNode.build(t,!t.isVector(e)&&t.isInteger(e)?e:"uint")} ]`}}class Rp extends ${static get type(){return"ConvertNode"}constructor(t,e){super(),this.node=t,this.convertTo=e}getNodeType(t){const e=this.node.getNodeType(t);let i=null;for(const s of this.convertTo.split("|"))i!==null&&t.getTypeLength(e)!==t.getTypeLength(s)||(i=s);return i}serialize(t){super.serialize(t),t.convertTo=this.convertTo}deserialize(t){super.deserialize(t),this.convertTo=t.convertTo}generate(t,e){const i=this.node,s=this.getNodeType(t),n=i.build(t,s);return t.format(n,s,e)}}class Ft extends ${static get type(){return"TempNode"}constructor(t=null){super(t),this.isTempNode=!0}hasDependencies(t){return t.getDataFromNode(this).usageCount>1}build(t,e){if(t.getBuildStage()==="generate"){const i=t.getVectorType(this.getNodeType(t,e)),s=t.getDataFromNode(this);if(s.propertyName!==void 0)return t.format(s.propertyName,i,e);if(i!=="void"&&e!=="void"&&this.hasDependencies(t)){const n=super.build(t,i),a=t.getVarFromNode(this,null,i),o=t.getPropertyName(a);return t.addLineFlowCode(`${o} = ${n}`,this),s.snippet=n,s.propertyName=o,t.format(s.propertyName,i,e)}}return super.build(t,e)}}class Xx extends Ft{static get type(){return"JoinNode"}constructor(t=[],e=null){super(e),this.nodes=t}getNodeType(t){return this.nodeType!==null?t.getVectorType(this.nodeType):t.getTypeFromLength(this.nodes.reduce((e,i)=>e+t.getTypeLength(i.getNodeType(t)),0))}generate(t,e){const i=this.getNodeType(t),s=t.getTypeLength(i),n=this.nodes,a=t.getComponentType(i),o=[];let h=0;for(const u of n){if(h>=s){et(`TSL: Length of parameters exceeds maximum length of function '${i}()' type.`);break}let c,d=u.getNodeType(t),p=t.getTypeLength(d);if(h+p>s&&(et(`TSL: Length of '${i}()' data exceeds maximum length of output type.`),p=s-h,d=t.getTypeFromLength(p)),h+=p,c=u.build(t,d),t.getComponentType(d)!==a){const m=t.getTypeFromLength(p,a);c=t.format(c,d,m)}o.push(c)}const l=`${t.getType(i)}( ${o.join(", ")} )`;return t.format(l,i,e)}}const jx=wa.join("");class Gx extends ${static get type(){return"SplitNode"}constructor(t,e="x"){super(),this.node=t,this.components=e,this.isSplitNode=!0}getVectorLength(){let t=this.components.length;for(const e of this.components)t=Math.max(wa.indexOf(e)+1,t);return t}getComponentType(t){return t.getComponentType(this.node.getNodeType(t))}getNodeType(t){return t.getTypeFromLength(this.components.length,this.getComponentType(t))}getScope(){return this.node.getScope()}generate(t,e){const i=this.node,s=t.getTypeLength(i.getNodeType(t));let n=null;if(s>1){let a=null;this.getVectorLength()>=s&&(a=t.getTypeFromLength(this.getVectorLength(),this.getComponentType(t)));const o=i.build(t,a);n=this.components.length===s&&this.components===jx.slice(0,this.components.length)?t.format(o,a,e):t.format(`${o}.${this.components}`,this.getNodeType(t),e)}else n=i.build(t,e);return n}serialize(t){super.serialize(t),t.components=this.components}deserialize(t){super.deserialize(t),this.components=t.components}}class Yx extends Ft{static get type(){return"SetNode"}constructor(t,e,i){super(),this.sourceNode=t,this.components=e,this.targetNode=i}getNodeType(t){return this.sourceNode.getNodeType(t)}generate(t){const{sourceNode:e,components:i,targetNode:s}=this,n=this.getNodeType(t),a=t.getComponentType(s.getNodeType(t)),o=t.getTypeFromLength(i.length,a),h=s.build(t,o),l=e.build(t,n),u=t.getTypeLength(n),c=[];for(let d=0;d<u;d++){const p=wa[d];p===i[0]?(c.push(h),d+=i.length-1):c.push(l+"."+p)}return`${t.getType(n)}( ${c.join(", ")} )`}}class Zx extends Ft{static get type(){return"FlipNode"}constructor(t,e){super(),this.sourceNode=t,this.components=e}getNodeType(t){return this.sourceNode.getNodeType(t)}generate(t){const{components:e,sourceNode:i}=this,s=this.getNodeType(t),n=i.build(t),a=t.getVarFromNode(this),o=t.getPropertyName(a);t.addLineFlowCode(o+" = "+n,this);const h=t.getTypeLength(s),l=[];let u=0;for(let c=0;c<h;c++){const d=wa[c];d===e[u]?(l.push("1.0 - "+o+"."+d),u++):l.push(o+"."+d)}return`${t.getType(s)}( ${l.join(", ")} )`}}class Du extends ${static get type(){return"InputNode"}constructor(t,e=null){super(e),this.isInputNode=!0,this.value=t,this.precision=null}getNodeType(){return this.nodeType===null?Ps(this.value):this.nodeType}getInputType(t){return this.getNodeType(t)}setPrecision(t){return this.precision=t,this}serialize(t){super.serialize(t),t.value=this.value,this.value&&this.value.toArray&&(t.value=this.value.toArray()),t.valueType=Ps(this.value),t.nodeType=this.nodeType,t.valueType==="ArrayBuffer"&&(t.value=Ap(t.value)),t.precision=this.precision}deserialize(t){super.deserialize(t),this.nodeType=t.nodeType,this.value=Array.isArray(t.value)?ku(t.valueType,...t.value):t.value,this.precision=t.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(t.value))}generate(){j("Abstract function.")}}const Ep=/float|u?int/;class Pi extends Du{static get type(){return"ConstNode"}constructor(t,e=null){super(t,e),this.isConstNode=!0}generateConst(t){return t.generateConst(this.getNodeType(t),this.value)}generate(t,e){const i=this.getNodeType(t);return Ep.test(i)&&Ep.test(e)?t.generateConst(e,this.value):t.format(this.generateConst(t),i,e)}}class Jx extends ${static get type(){return"MemberNode"}constructor(t,e){super(),this.structNode=t,this.property=e,this.isMemberNode=!0}hasMember(t){return(!this.structNode.isMemberNode||this.structNode.hasMember(t)!==!1)&&this.structNode.getMemberType(t,this.property)!=="void"}getNodeType(t){return this.hasMember(t)===!1?"float":this.structNode.getMemberType(t,this.property)}getMemberType(t,e){if(this.hasMember(t)===!1)return"float";const i=this.getNodeType(t);return t.getStructTypeNode(i).getMemberType(t,e)}generate(t){if(this.hasMember(t)===!1){j(`TSL: Member "${this.property}" does not exist in struct.`);const e=this.getNodeType(t);return t.generateConst(e)}return this.structNode.build(t)+"."+this.property}}let ln=null;const Uu=new Map;function z(r,t){if(Uu.has(r))j(`TSL: Redefinition of method chaining '${r}'.`);else{if(typeof t!="function")throw new Error(`THREE.TSL: Node element ${r} is not a function`);Uu.set(r,t),r!=="assign"&&($.prototype[r]=function(...e){return this.isStackNode?this.add(t(...e)):t(this,...e)},$.prototype[r+"Assign"]=function(...e){return this.isStackNode?this.assign(e[0],t(...e)):this.assign(t(this,...e))})}}const Ip=r=>(t=>t.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"))(r).split("").sort().join("");$.prototype.assign=function(...r){if(this.isStackNode!==!0)return ln!==null?ln.assign(this,...r):et("TSL: No stack defined for assign operation. Make sure the assign is inside a Fn()."),this;{const t=Uu.get("assign");return this.add(t(...r))}},$.prototype.toVarIntent=function(){return this},$.prototype.get=function(r){return new Jx(this,r)};const Ta={};function Ko(r,t,e){Ta[r]=Ta[t]=Ta[e]={get(){this._cache=this._cache||{};let a=this._cache[r];return a===void 0&&(a=new Gx(this,r),this._cache[r]=a),a},set(a){this[r].assign(V(a))}};const i=r.toUpperCase(),s=t.toUpperCase(),n=e.toUpperCase();$.prototype["set"+i]=$.prototype["set"+s]=$.prototype["set"+n]=function(a){const o=Ip(r);return new Yx(this,o,V(a))},$.prototype["flip"+i]=$.prototype["flip"+s]=$.prototype["flip"+n]=function(){const a=Ip(r);return new Zx(this,a)}}const Bi=["x","y","z","w"],Oi=["r","g","b","a"],Vi=["s","t","p","q"];for(let r=0;r<4;r++){let t=Bi[r],e=Oi[r],i=Vi[r];Ko(t,e,i);for(let s=0;s<4;s++){t=Bi[r]+Bi[s],e=Oi[r]+Oi[s],i=Vi[r]+Vi[s],Ko(t,e,i);for(let n=0;n<4;n++){t=Bi[r]+Bi[s]+Bi[n],e=Oi[r]+Oi[s]+Oi[n],i=Vi[r]+Vi[s]+Vi[n],Ko(t,e,i);for(let a=0;a<4;a++)t=Bi[r]+Bi[s]+Bi[n]+Bi[a],e=Oi[r]+Oi[s]+Oi[n]+Oi[a],i=Vi[r]+Vi[s]+Vi[n]+Vi[a],Ko(t,e,i)}}}for(let r=0;r<32;r++)Ta[r]={get(){this._cache=this._cache||{};let t=this._cache[r];return t===void 0&&(t=new rr(this,new Pi(r,"uint")),this._cache[r]=t),t},set(t){this[r].assign(V(t))}};Object.defineProperties($.prototype,Ta);const Cp=new WeakMap,Qx=function(r,t=null){for(const e in r)r[e]=V(r[e],t);return r},Kx=function(r,t=null){const e=r.length;for(let i=0;i<e;i++)r[i]=V(r[i],t);return r},zp=function(r,t=null,e=null,i=null){function s(u){return i!==null?(u=V(Object.assign(u,i)),i.intent===!0&&(u=u.toVarIntent())):u=V(u),u}let n,a,o,h=t;function l(u){let c;return c=h?/[a-z]/i.test(h)?h+"()":h:r.type,a!==void 0&&u.length<a?(et(`TSL: "${c}" parameter length is less than minimum required.`),u.concat(new Array(a-u.length).fill(0))):o!==void 0&&u.length>o?(et(`TSL: "${c}" parameter length exceeds limit.`),u.slice(0,o)):u}return t===null?n=(...u)=>s(new r(...ar(l(u)))):e!==null?(e=V(e),n=(...u)=>s(new r(t,...ar(l(u)),e))):n=(...u)=>s(new r(t,...ar(l(u)))),n.setParameterLength=(...u)=>(u.length===1?a=o=u[0]:u.length===2&&([a,o]=u),n),n.setName=u=>(h=u,n),n},t2=function(r,...t){return V(new r(...ar(t)))};class e2 extends ${constructor(t,e){super(),this.shaderNode=t,this.rawInputs=e,this.isShaderCallNodeInternal=!0}getNodeType(t){return this.shaderNode.nodeType||this.getOutputNode(t).getNodeType(t)}getMemberType(t,e){return this.getOutputNode(t).getMemberType(t,e)}call(t){const{shaderNode:e,rawInputs:i}=this,s=t.getNodeProperties(e),n=t.getClosestSubBuild(e.subBuilds)||"",a=n||"default";if(s[a])return s[a];const o=t.subBuildFn;t.subBuildFn=n;let h=null;if(e.layout){let l=Cp.get(t.constructor);l===void 0&&(l=new WeakMap,Cp.set(t.constructor,l));let u=l.get(e);u===void 0&&(u=V(t.buildFunctionNode(e)),l.set(e,u)),t.addInclude(u);const c=i?(function(d){let p;return Xu(d),p=d[0]&&(d[0].isNode||Object.getPrototypeOf(d[0])!==Object.prototype)?[...d]:d[0],p})(i):null;h=V(u.call(c))}else{const l=new Proxy(t,{get:(m,f,g)=>{let y;return y=Symbol.iterator===f?function*(){yield}:Reflect.get(m,f,g),y}}),u=i?(function(m){let f=0;return Xu(m),new Proxy(m,{get:(g,y,x)=>{let _;if(y==="length")return _=m.length,_;if(Symbol.iterator===y)_=function*(){for(const M of m)yield V(M)};else{if(m.length>0)if(Object.getPrototypeOf(m[0])===Object.prototype){const M=m[0];_=M[y]===void 0?M[f++]:Reflect.get(M,y,x)}else m[0]instanceof $&&(_=m[y]===void 0?m[f++]:Reflect.get(m,y,x));else _=Reflect.get(g,y,x);_=V(_)}return _}})})(i):null,c=Array.isArray(i)?i.length>0:i!==null,d=e.jsFunc,p=c||d.length>1?d(u,l):d(l);h=V(p)}return t.subBuildFn=o,e.once&&(s[a]=h),h}setupOutput(t){return t.addStack(),t.stack.outputNode=this.call(t),t.removeStack()}getOutputNode(t){const e=t.getNodeProperties(this),i=t.getSubBuildOutput(this);return e[i]=e[i]||this.setupOutput(t),e[i].subBuild=t.getClosestSubBuild(this),e[i]}build(t,e=null){let i=null;const s=t.getBuildStage(),n=t.getNodeProperties(this),a=t.getSubBuildOutput(this),o=this.getOutputNode(t);if(s==="setup"){const h=t.getSubBuildProperty("initialized",this);if(n[h]!==!0&&(n[h]=!0,n[a]=this.getOutputNode(t),n[a].build(t),this.shaderNode.subBuilds))for(const l of t.chaining){const u=t.getDataFromNode(l,"any");u.subBuilds=u.subBuilds||new Set;for(const c of this.shaderNode.subBuilds)u.subBuilds.add(c)}i=n[a]}else s==="analyze"?o.build(t,e):s==="generate"&&(i=o.build(t,e)||"");return i}}class i2 extends ${constructor(t,e){super(e),this.jsFunc=t,this.layout=null,this.global=!0,this.once=!1}setLayout(t){return this.layout=t,this}call(t=null){return V(new e2(this,t))}setup(){return this.call()}}const s2=[!1,!0],n2=[0,1,2,3],r2=[-1,-2],Lp=[.5,1.5,1/3,1e-6,1e6,Math.PI,2*Math.PI,1/Math.PI,2/Math.PI,1/(2*Math.PI),Math.PI/2],Wu=new Map;for(const r of s2)Wu.set(r,new Pi(r));const Hu=new Map;for(const r of n2)Hu.set(r,new Pi(r,"uint"));const qu=new Map([...Hu].map(r=>new Pi(r.value,"int")));for(const r of r2)qu.set(r,new Pi(r,"int"));const th=new Map([...qu].map(r=>new Pi(r.value)));for(const r of Lp)th.set(r,new Pi(r));for(const r of Lp)th.set(-r,new Pi(-r));const eh={bool:Wu,uint:Hu,ints:qu,float:th},Pp=new Map([...Wu,...th]),$u=(r,t)=>Pp.has(r)?Pp.get(r):r.isNode===!0?r:new Pi(r,t),qt=function(r,t=null){return(...e)=>{for(const s of e)if(s===void 0)return et(`TSL: Invalid parameter for the type "${r}".`),V(new Pi(0,r));if((e.length===0||!["bool","float","int","uint"].includes(r)&&e.every(s=>{const n=typeof s;return n!=="object"&&n!=="function"}))&&(e=[ku(r,...e)]),e.length===1&&t!==null&&t.has(e[0]))return sh(t.get(e[0]));if(e.length===1){const s=$u(e[0],r);return s.nodeType===r?sh(s):sh(new Rp(s,r))}const i=e.map(s=>$u(s));return sh(new Xx(i,r))}},ih=r=>typeof r=="object"&&r!==null?r.value:r,a2=r=>r!=null?r.nodeType||r.convertTo||(typeof r=="string"?r:null):null;function Sa(r,t){return new i2(r,t)}const V=(r,t=null)=>(function(e,i=null){const s=Ps(e);return s==="node"?e:i===null&&(s==="float"||s==="boolean")||s&&s!=="shader"&&s!=="string"?V($u(e,i)):s==="shader"?e.isFn?e:A(e):e})(r,t),sh=(r,t=null)=>V(r,t).toVarIntent(),Xu=(r,t=null)=>new Qx(r,t),ar=(r,t=null)=>new Kx(r,t),Z=(r,t=null,e=null,i=null)=>new zp(r,t,e,i),U=(r,...t)=>new t2(r,...t),k=(r,t=null,e=null,i={})=>new zp(r,t,e,{intent:!0,...i});let o2=0;class h2 extends ${constructor(t,e=null){super();let i=null;e!==null&&(typeof e=="object"?i=e.return:(typeof e=="string"?i=e:et("TSL: Invalid layout type."),e=null)),this.shaderNode=new Sa(t,i),e!==null&&this.setLayout(e),this.isFn=!0}setLayout(t){const e=this.shaderNode.nodeType;if(typeof t.inputs!="object"){const i={name:"fn"+o2++,type:e,inputs:[]};for(const s in t)s!=="return"&&i.inputs.push({name:s,type:t[s]});t=i}return this.shaderNode.setLayout(t),this}getNodeType(t){return this.shaderNode.getNodeType(t)||"float"}call(...t){const e=this.shaderNode.call(t);return this.shaderNode.nodeType==="void"&&e.toStack(),e.toVarIntent()}once(t=null){return this.shaderNode.once=!0,this.shaderNode.subBuilds=t,this}generate(t){const e=this.getNodeType(t);return et('TSL: "Fn()" was declared but not invoked. Try calling it like "Fn()( ...params )".'),t.generateConst(e)}}function A(r,t=null){const e=new h2(r,t);return new Proxy(()=>{},{apply:(i,s,n)=>e.call(...n),get:(i,s,n)=>Reflect.get(e,s,n),set:(i,s,n,a)=>Reflect.set(e,s,n,a)})}const Bp=r=>{ln=r},Op=()=>ln,Y=(...r)=>ln.If(...r);function Vp(r){return ln&&ln.add(r),r}z("toStack",Vp);const l2=new qt("color"),b=new qt("float",eh.float),w=new qt("int",eh.ints),H=new qt("uint",eh.uint),fi=new qt("bool",eh.bool),B=new qt("vec2"),ee=new qt("ivec2"),u2=new qt("uvec2"),c2=new qt("bvec2"),R=new qt("vec3"),d2=new qt("ivec3"),Aa=new qt("uvec3"),Fp=new qt("bvec3"),J=new qt("vec4"),p2=new qt("ivec4"),m2=new qt("uvec4"),f2=new qt("bvec4"),ju=new qt("mat2"),Be=new qt("mat3"),or=new qt("mat4");z("toColor",l2),z("toFloat",b),z("toInt",w),z("toUint",H),z("toBool",fi),z("toVec2",B),z("toIVec2",ee),z("toUVec2",u2),z("toBVec2",c2),z("toVec3",R),z("toIVec3",d2),z("toUVec3",Aa),z("toBVec3",Fp),z("toVec4",J),z("toIVec4",p2),z("toUVec4",m2),z("toBVec4",f2),z("toMat2",ju),z("toMat3",Be),z("toMat4",or);const g2=Z(rr).setParameterLength(2),y2=(r,t)=>V(new Rp(V(r),t));z("element",g2),z("convert",y2),z("append",r=>(j("TSL: .append() has been renamed to .toStack()."),Vp(r)));class bt extends ${static get type(){return"PropertyNode"}constructor(t,e=null,i=!1){super(t),this.name=e,this.varying=i,this.isPropertyNode=!0,this.global=!0}getHash(t){return this.name||super.getHash(t)}generate(t){let e;return this.varying===!0?(e=t.getVaryingFromNode(this,this.name),e.needsInterpolation=!0):e=t.getVarFromNode(this,this.name),t.getPropertyName(e)}}const Bs=(r,t)=>V(new bt(r,t)),nh=(r,t)=>V(new bt(r,t,!0)),gi=U(bt,"vec4","DiffuseColor"),kp=U(bt,"vec3","EmissiveColor"),x2=U(bt,"float","Roughness");U(bt,"float","Metalness"),U(bt,"float","Clearcoat"),U(bt,"float","ClearcoatRoughness");const b2=U(bt,"vec3","Sheen"),M2=U(bt,"float","SheenRoughness"),_2=U(bt,"float","Iridescence");U(bt,"float","IridescenceIOR"),U(bt,"float","IridescenceThickness");const Dp=U(bt,"float","AlphaT"),v2=U(bt,"float","Anisotropy"),Gu=U(bt,"vec3","AnisotropyT"),Na=U(bt,"vec3","AnisotropyB"),w2=U(bt,"color","SpecularColor");U(bt,"float","SpecularF90");const Up=U(bt,"float","Shininess"),Ra=U(bt,"vec4","Output");U(bt,"float","dashSize"),U(bt,"float","gapSize"),U(bt,"float","pointWidth"),U(bt,"float","IOR"),U(bt,"float","Transmission"),U(bt,"float","Thickness"),U(bt,"float","AttenuationDistance"),U(bt,"color","AttenuationColor"),U(bt,"float","Dispersion");class Wp extends ${static get type(){return"UniformGroupNode"}constructor(t,e=!1,i=1){super("string"),this.name=t,this.shared=e,this.order=i,this.isUniformGroup=!0}serialize(t){super.serialize(t),t.name=this.name,t.version=this.version,t.shared=this.shared}deserialize(t){super.deserialize(t),this.name=t.name,this.version=t.version,this.shared=t.shared}}const T2=r=>new Wp(r),Yu=(r,t=0)=>new Wp(r,!0,t);Yu("frame");const pt=Yu("render"),S2=T2("object");class Ea extends Du{static get type(){return"UniformNode"}constructor(t,e=null){super(t,e),this.isUniformNode=!0,this.name="",this.groupNode=S2}setName(t){return this.name=t,this}label(t){return j('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(t)}setGroup(t){return this.groupNode=t,this}getGroup(){return this.groupNode}getUniformHash(t){return this.getHash(t)}onUpdate(t,e){return t=t.bind(this),super.onUpdate(i=>{const s=t(i,this);s!==void 0&&(this.value=s)},e)}getInputType(t){let e=super.getInputType(t);return e==="bool"&&(e="uint"),e}generate(t,e){const i=this.getNodeType(t),s=this.getUniformHash(t);let n=t.getNodeFromHash(s);n===void 0&&(t.setHashNode(this,s),n=this);const a=n.getInputType(t),o=t.getUniformFromNode(n,a,t.shaderStage,this.name||t.context.nodeName),h=t.getPropertyName(o);t.context.nodeName!==void 0&&delete t.context.nodeName;let l=h;if(i==="bool"){const u=t.getDataFromNode(this);let c=u.propertyName;if(c===void 0){const d=t.getVarFromNode(this,null,"bool");c=t.getPropertyName(d),u.propertyName=c,l=t.format(h,a,i),t.addLineFlowCode(`${c} = ${l}`,this)}l=c}return t.format(l,i,e)}}const K=(r,t)=>{const e=a2(t||r);return e===r&&(r=ku(e)),r=r&&r.isNode===!0?r.node&&r.node.value||r.value:r,V(new Ea(r,e))};class Hp extends Ft{static get type(){return"ArrayNode"}constructor(t,e,i=null){super(t),this.count=e,this.values=i,this.isArrayNode=!0}getArrayCount(){return this.count}getNodeType(t){return this.nodeType===null&&(this.nodeType=this.values[0].getNodeType(t)),this.nodeType}getElementType(t){return this.getNodeType(t)}generate(t){const e=this.getNodeType(t);return t.generateArray(e,this.count,this.values)}}const A2=(...r)=>{let t;if(r.length===1){const e=r[0];t=new Hp(null,e.length,e)}else{const e=r[0],i=r[1];t=new Hp(e,i)}return V(t)};z("toArray",(r,t)=>A2(Array(t).fill(r)));class N2 extends Ft{static get type(){return"AssignNode"}constructor(t,e){super(),this.targetNode=t,this.sourceNode=e,this.isAssignNode=!0}hasDependencies(){return!1}getNodeType(t,e){return e!=="void"?this.targetNode.getNodeType(t):"void"}needsSplitAssign(t){const{targetNode:e}=this;if(t.isAvailable("swizzleAssign")===!1&&e.isSplitNode&&e.components.length>1){const i=t.getTypeLength(e.node.getNodeType(t));return wa.join("").slice(0,i)!==e.components}return!1}setup(t){const{targetNode:e,sourceNode:i}=this,s=e.getScope();t.getNodeProperties(s).assign=!0;const n=t.getNodeProperties(this);n.sourceNode=i,n.targetNode=e.context({assign:!0})}generate(t,e){const{targetNode:i,sourceNode:s}=t.getNodeProperties(this),n=this.needsSplitAssign(t),a=i.build(t),o=i.getNodeType(t),h=s.build(t,o),l=s.getNodeType(t),u=t.getDataFromNode(this);let c;if(u.initialized===!0)e!=="void"&&(c=a);else if(n){const d=t.getVarFromNode(this,null,o),p=t.getPropertyName(d);t.addLineFlowCode(`${p} = ${h}`,this);const m=i.node,f=m.node.context({assign:!0}).build(t);for(let g=0;g<m.components.length;g++){const y=m.components[g];t.addLineFlowCode(`${f}.${y} = ${p}[ ${g} ]`,this)}e!=="void"&&(c=a)}else c=`${a} = ${h}`,e!=="void"&&l!=="void"||(t.addLineFlowCode(c,this),e!=="void"&&(c=a));return u.initialized=!0,t.format(c,o,e)}}const R2=Z(N2).setParameterLength(2);z("assign",R2);class E2 extends Ft{static get type(){return"FunctionCallNode"}constructor(t=null,e={}){super(),this.functionNode=t,this.parameters=e}setParameters(t){return this.parameters=t,this}getParameters(){return this.parameters}getNodeType(t){return this.functionNode.getNodeType(t)}getMemberType(t,e){return this.functionNode.getMemberType(t,e)}generate(t){const e=[],i=this.functionNode,s=i.getInputs(t),n=this.parameters,a=(o,h)=>{const l=h.type;let u;return u=l==="pointer"?"&"+o.build(t):o.build(t,l),u};if(Array.isArray(n)){if(n.length>s.length)et("TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),n.length=s.length;else if(n.length<s.length)for(et("TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");n.length<s.length;)n.push(b(0));for(let o=0;o<n.length;o++)e.push(a(n[o],s[o]))}else for(const o of s){const h=n[o.name];h!==void 0?e.push(a(h,o)):(et(`TSL: Input '${o.name}' not found in 'Fn()'.`),e.push(a(b(0),o)))}return`${i.build(t,"property")}( ${e.join(", ")} )`}}z("call",(r,...t)=>(t=t.length>1||t[0]&&t[0].isNode===!0?ar(t):Xu(t[0]),V(new E2(V(r),t))));const I2={"==":"equal","!=":"notEqual","<":"lessThan",">":"greaterThan","<=":"lessThanEqual",">=":"greaterThanEqual","%":"mod"};class Lt extends Ft{static get type(){return"OperatorNode"}constructor(t,e,i,...s){if(super(),s.length>0){let n=new Lt(t,e,i);for(let a=0;a<s.length-1;a++)n=new Lt(t,n,s[a]);e=n,i=s[s.length-1]}this.op=t,this.aNode=e,this.bNode=i,this.isOperatorNode=!0}getOperatorMethod(t,e){return t.getMethod(I2[this.op],e)}getNodeType(t,e=null){const i=this.op,s=this.aNode,n=this.bNode,a=s.getNodeType(t),o=n?n.getNodeType(t):null;if(a==="void"||o==="void")return e||"void";if(i==="%")return a;if(i==="~"||i==="&"||i==="|"||i==="^"||i===">>"||i==="<<")return t.getIntegerType(a);if(i==="!"||i==="&&"||i==="||"||i==="^^")return"bool";if(i==="=="||i==="!="||i==="<"||i===">"||i==="<="||i===">="){const h=Math.max(t.getTypeLength(a),t.getTypeLength(o));return h>1?`bvec${h}`:"bool"}if(t.isMatrix(a)){if(o==="float")return a;if(t.isVector(o))return t.getVectorFromMatrix(a);if(t.isMatrix(o))return a}else if(t.isMatrix(o)){if(a==="float")return o;if(t.isVector(a))return t.getVectorFromMatrix(o)}return t.getTypeLength(o)>t.getTypeLength(a)?o:a}generate(t,e){const i=this.op,{aNode:s,bNode:n}=this,a=this.getNodeType(t,e);let o=null,h=null;a!=="void"?(o=s.getNodeType(t),h=n?n.getNodeType(t):null,i==="<"||i===">"||i==="<="||i===">="||i==="=="||i==="!="?t.isVector(o)?h=o:t.isVector(h)?o=h:o!==h&&(o=h="float"):i===">>"||i==="<<"?(o=a,h=t.changeComponentType(h,"uint")):i==="%"?(o=a,h=t.isInteger(o)&&t.isInteger(h)?h:o):t.isMatrix(o)?h==="float"?h="float":t.isVector(h)?h=t.getVectorFromMatrix(o):t.isMatrix(h)||(o=h=a):o=t.isMatrix(h)?o==="float"?"float":t.isVector(o)?t.getVectorFromMatrix(h):h=a:h=a):o=h=a;const l=s.build(t,o),u=n?n.build(t,h):null,c=t.getFunctionOperator(i);if(e!=="void"){const d=t.renderer.coordinateSystem===2e3;if(i==="=="||i==="!="||i==="<"||i===">"||i==="<="||i===">=")return d&&t.isVector(o)?t.format(`${this.getOperatorMethod(t,e)}( ${l}, ${u} )`,a,e):t.format(`( ${l} ${i} ${u} )`,a,e);if(i==="%")return t.isInteger(h)?t.format(`( ${l} % ${u} )`,a,e):t.format(`${this.getOperatorMethod(t,a)}( ${l}, ${u} )`,a,e);if(i==="!"||i==="~")return t.format(`(${i}${l})`,o,e);if(c)return t.format(`${c}( ${l}, ${u} )`,a,e);if(t.isMatrix(o)&&h==="float")return t.format(`( ${u} ${i} ${l} )`,a,e);if(o==="float"&&t.isMatrix(h))return t.format(`${l} ${i} ${u}`,a,e);{let p=`( ${l} ${i} ${u} )`;return!d&&a==="bool"&&t.isVector(o)&&t.isVector(h)&&(p=`all${p}`),t.format(p,a,e)}}if(o!=="void")return c?t.format(`${c}( ${l}, ${u} )`,a,e):t.isMatrix(o)&&h==="float"?t.format(`${u} ${i} ${l}`,a,e):t.format(`${l} ${i} ${u}`,a,e)}serialize(t){super.serialize(t),t.op=this.op}deserialize(t){super.deserialize(t),this.op=t.op}}const ie=k(Lt,"+").setParameterLength(2,1/0).setName("add"),yt=k(Lt,"-").setParameterLength(2,1/0).setName("sub"),tt=k(Lt,"*").setParameterLength(2,1/0).setName("mul"),es=k(Lt,"/").setParameterLength(2,1/0).setName("div"),Zu=k(Lt,"%").setParameterLength(2).setName("mod"),qp=k(Lt,"==").setParameterLength(2).setName("equal"),C2=k(Lt,"!=").setParameterLength(2).setName("notEqual"),z2=k(Lt,"<").setParameterLength(2).setName("lessThan"),$p=k(Lt,">").setParameterLength(2).setName("greaterThan"),L2=k(Lt,"<=").setParameterLength(2).setName("lessThanEqual"),P2=k(Lt,">=").setParameterLength(2).setName("greaterThanEqual"),B2=k(Lt,"&&").setParameterLength(2,1/0).setName("and"),O2=k(Lt,"||").setParameterLength(2,1/0).setName("or"),V2=k(Lt,"!").setParameterLength(1).setName("not"),F2=k(Lt,"^^").setParameterLength(2).setName("xor"),k2=k(Lt,"&").setParameterLength(2).setName("bitAnd"),D2=k(Lt,"~").setParameterLength(1).setName("bitNot"),U2=k(Lt,"|").setParameterLength(2).setName("bitOr"),W2=k(Lt,"^").setParameterLength(2).setName("bitXor"),H2=k(Lt,"<<").setParameterLength(2).setName("shiftLeft"),q2=k(Lt,">>").setParameterLength(2).setName("shiftRight"),$2=A(([r])=>(r.addAssign(1),r)),X2=A(([r])=>(r.subAssign(1),r)),j2=A(([r])=>{const t=w(r).toConst();return r.addAssign(1),t}),G2=A(([r])=>{const t=w(r).toConst();return r.subAssign(1),t});z("add",ie),z("sub",yt),z("mul",tt),z("div",es),z("mod",Zu),z("equal",qp),z("notEqual",C2),z("lessThan",z2),z("greaterThan",$p),z("lessThanEqual",L2),z("greaterThanEqual",P2),z("and",B2),z("or",O2),z("not",V2),z("xor",F2),z("bitAnd",k2),z("bitNot",D2),z("bitOr",U2),z("bitXor",W2),z("shiftLeft",H2),z("shiftRight",q2),z("incrementBefore",$2),z("decrementBefore",X2),z("increment",j2),z("decrement",G2),z("modInt",(r,t)=>(j('TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),Zu(w(r),w(t))));class I extends Ft{static get type(){return"MathNode"}constructor(t,e,i=null,s=null){if(super(),(t===I.MAX||t===I.MIN)&&arguments.length>3){let n=new I(t,e,i);for(let a=2;a<arguments.length-1;a++)n=new I(t,n,arguments[a]);e=n,i=arguments[arguments.length-1],s=null}this.method=t,this.aNode=e,this.bNode=i,this.cNode=s,this.isMathNode=!0}getInputType(t){const e=this.aNode.getNodeType(t),i=this.bNode?this.bNode.getNodeType(t):null,s=this.cNode?this.cNode.getNodeType(t):null,n=t.isMatrix(e)?0:t.getTypeLength(e),a=t.isMatrix(i)?0:t.getTypeLength(i),o=t.isMatrix(s)?0:t.getTypeLength(s);return n>a&&n>o?e:a>o?i:o>n?s:e}getNodeType(t){const e=this.method;return e===I.LENGTH||e===I.DISTANCE||e===I.DOT?"float":e===I.CROSS?"vec3":e===I.ALL||e===I.ANY?"bool":e===I.EQUALS?t.changeComponentType(this.aNode.getNodeType(t),"bool"):this.getInputType(t)}setup(t){const{aNode:e,bNode:i,method:s}=this;let n=null;if(s===I.ONE_MINUS)n=yt(1,e);else if(s===I.RECIPROCAL)n=es(1,e);else if(s===I.DIFFERENCE)n=Nt(yt(e,i));else if(s===I.TRANSFORM_DIRECTION){let a=e,o=i;t.isMatrix(a.getNodeType(t))?o=J(R(o),0):a=J(R(a),0);const h=tt(a,o).xyz;n=un(h)}return n!==null?n:super.setup(t)}generate(t,e){if(t.getNodeProperties(this).outputNode)return super.generate(t,e);let i=this.method;const s=this.getNodeType(t),n=this.getInputType(t),a=this.aNode,o=this.bNode,h=this.cNode,l=t.renderer.coordinateSystem;if(i===I.NEGATE)return t.format("( - "+a.build(t,n)+" )",s,e);{const u=[];return i===I.CROSS?u.push(a.build(t,s),o.build(t,s)):l===2e3&&i===I.STEP?u.push(a.build(t,t.getTypeLength(a.getNodeType(t))===1?"float":n),o.build(t,n)):l!==2e3||i!==I.MIN&&i!==I.MAX?i===I.REFRACT?u.push(a.build(t,n),o.build(t,n),h.build(t,"float")):i===I.MIX?u.push(a.build(t,n),o.build(t,n),h.build(t,t.getTypeLength(h.getNodeType(t))===1?"float":n)):(l===2001&&i===I.ATAN&&o!==null&&(i="atan2"),t.shaderStage==="fragment"||i!==I.DFDX&&i!==I.DFDY||(j(`TSL: '${i}' is not supported in the ${t.shaderStage} stage.`),i="/*"+i+"*/"),u.push(a.build(t,n)),o!==null&&u.push(o.build(t,n)),h!==null&&u.push(h.build(t,n))):u.push(a.build(t,n),o.build(t,t.getTypeLength(o.getNodeType(t))===1?"float":n)),t.format(`${t.getMethod(i,s)}( ${u.join(", ")} )`,s,e)}}serialize(t){super.serialize(t),t.method=this.method}deserialize(t){super.deserialize(t),this.method=t.method}}I.ALL="all",I.ANY="any",I.RADIANS="radians",I.DEGREES="degrees",I.EXP="exp",I.EXP2="exp2",I.LOG="log",I.LOG2="log2",I.SQRT="sqrt",I.INVERSE_SQRT="inversesqrt",I.FLOOR="floor",I.CEIL="ceil",I.NORMALIZE="normalize",I.FRACT="fract",I.SIN="sin",I.COS="cos",I.TAN="tan",I.ASIN="asin",I.ACOS="acos",I.ATAN="atan",I.ABS="abs",I.SIGN="sign",I.LENGTH="length",I.NEGATE="negate",I.ONE_MINUS="oneMinus",I.DFDX="dFdx",I.DFDY="dFdy",I.ROUND="round",I.RECIPROCAL="reciprocal",I.TRUNC="trunc",I.FWIDTH="fwidth",I.TRANSPOSE="transpose",I.DETERMINANT="determinant",I.INVERSE="inverse",I.EQUALS="equals",I.MIN="min",I.MAX="max",I.STEP="step",I.REFLECT="reflect",I.DISTANCE="distance",I.DIFFERENCE="difference",I.DOT="dot",I.CROSS="cross",I.POW="pow",I.TRANSFORM_DIRECTION="transformDirection",I.MIX="mix",I.CLAMP="clamp",I.REFRACT="refract",I.SMOOTHSTEP="smoothstep",I.FACEFORWARD="faceforward";const Y2=b(1e-6);b(1e6);const Z2=b(Math.PI);b(2*Math.PI),b(2*Math.PI),b(.5*Math.PI);const J2=k(I,I.ALL).setParameterLength(1),Q2=k(I,I.ANY).setParameterLength(1),K2=k(I,I.RADIANS).setParameterLength(1),t3=k(I,I.DEGREES).setParameterLength(1),Xp=k(I,I.EXP).setParameterLength(1),Ia=k(I,I.EXP2).setParameterLength(1),jp=k(I,I.LOG).setParameterLength(1),is=k(I,I.LOG2).setParameterLength(1),ss=k(I,I.SQRT).setParameterLength(1),e3=k(I,I.INVERSE_SQRT).setParameterLength(1),ns=k(I,I.FLOOR).setParameterLength(1),Ju=k(I,I.CEIL).setParameterLength(1),un=k(I,I.NORMALIZE).setParameterLength(1),Os=k(I,I.FRACT).setParameterLength(1),yi=k(I,I.SIN).setParameterLength(1),Vs=k(I,I.COS).setParameterLength(1),i3=k(I,I.TAN).setParameterLength(1),s3=k(I,I.ASIN).setParameterLength(1),n3=k(I,I.ACOS).setParameterLength(1),Gp=k(I,I.ATAN).setParameterLength(1,2),Nt=k(I,I.ABS).setParameterLength(1),rh=k(I,I.SIGN).setParameterLength(1),rs=k(I,I.LENGTH).setParameterLength(1),r3=k(I,I.NEGATE).setParameterLength(1),a3=k(I,I.ONE_MINUS).setParameterLength(1),Yp=k(I,I.DFDX).setParameterLength(1),Zp=k(I,I.DFDY).setParameterLength(1),o3=k(I,I.ROUND).setParameterLength(1),h3=k(I,I.RECIPROCAL).setParameterLength(1),Jp=k(I,I.TRUNC).setParameterLength(1),l3=k(I,I.FWIDTH).setParameterLength(1),u3=k(I,I.TRANSPOSE).setParameterLength(1),c3=k(I,I.DETERMINANT).setParameterLength(1),d3=k(I,I.INVERSE).setParameterLength(1),p3=(r,t)=>(j('TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),qp(r,t)),Ge=k(I,I.MIN).setParameterLength(2,1/0),kt=k(I,I.MAX).setParameterLength(2,1/0),Qu=k(I,I.STEP).setParameterLength(2),m3=k(I,I.REFLECT).setParameterLength(2),f3=k(I,I.DISTANCE).setParameterLength(2),g3=k(I,I.DIFFERENCE).setParameterLength(2),cn=k(I,I.DOT).setParameterLength(2),Ku=k(I,I.CROSS).setParameterLength(2),Ca=k(I,I.POW).setParameterLength(2),y3=r=>tt(r,r),x3=r=>tt(r,r,r),b3=r=>tt(r,r,r,r),M3=k(I,I.TRANSFORM_DIRECTION).setParameterLength(2),_3=r=>tt(rh(r),Ca(Nt(r),1/3)),Qp=r=>cn(r,r),Zt=k(I,I.MIX).setParameterLength(3),xi=(r,t=0,e=1)=>V(new I(I.CLAMP,V(r),V(t),V(e))),v3=r=>xi(r),Kp=k(I,I.REFRACT).setParameterLength(3),dn=k(I,I.SMOOTHSTEP).setParameterLength(3),w3=k(I,I.FACEFORWARD).setParameterLength(3),T3=A(([r])=>{const t=cn(r.xy,B(12.9898,78.233)),e=Zu(t,Z2);return Os(yi(e).mul(43758.5453))}),S3=(r,t,e)=>Zt(t,e,r),A3=(r,t,e)=>dn(t,e,r),N3=(r,t)=>Qu(t,r),R3=(r,t)=>(j('TSL: "atan2" is overloaded. Use "atan" instead.'),Gp(r,t));z("all",J2),z("any",Q2),z("equals",p3),z("radians",K2),z("degrees",t3),z("exp",Xp),z("exp2",Ia),z("log",jp),z("log2",is),z("sqrt",ss),z("inverseSqrt",e3),z("floor",ns),z("ceil",Ju),z("normalize",un),z("fract",Os),z("sin",yi),z("cos",Vs),z("tan",i3),z("asin",s3),z("acos",n3),z("atan",Gp),z("abs",Nt),z("sign",rh),z("length",rs),z("lengthSq",Qp),z("negate",r3),z("oneMinus",a3),z("dFdx",Yp),z("dFdy",Zp),z("round",o3),z("reciprocal",h3),z("trunc",Jp),z("fwidth",l3),z("atan2",R3),z("min",Ge),z("max",kt),z("step",N3),z("reflect",m3),z("distance",f3),z("dot",cn),z("cross",Ku),z("pow",Ca),z("pow2",y3),z("pow3",x3),z("pow4",b3),z("transformDirection",M3),z("mix",S3),z("clamp",xi),z("refract",Kp),z("smoothstep",A3),z("faceForward",w3),z("difference",g3),z("saturate",v3),z("cbrt",_3),z("transpose",u3),z("determinant",c3),z("inverse",d3),z("rand",T3);class E3 extends ${static get type(){return"ConditionalNode"}constructor(t,e,i=null){super(),this.condNode=t,this.ifNode=e,this.elseNode=i}getNodeType(t){const{ifNode:e,elseNode:i}=t.getNodeProperties(this);if(e===void 0)return t.flowBuildStage(this,"setup"),this.getNodeType(t);const s=e.getNodeType(t);if(i!==null){const n=i.getNodeType(t);if(t.getTypeLength(n)>t.getTypeLength(s))return n}return s}setup(t){const e=this.condNode.cache(),i=this.ifNode.cache(),s=this.elseNode?this.elseNode.cache():null,n=t.context.nodeBlock;t.getDataFromNode(i).parentNodeBlock=n,s!==null&&(t.getDataFromNode(s).parentNodeBlock=n);const a=t.context.uniformFlow,o=t.getNodeProperties(this);o.condNode=e,o.ifNode=a?i:i.context({nodeBlock:i}),o.elseNode=s?a?s:s.context({nodeBlock:s}):null}generate(t,e){const i=this.getNodeType(t),s=t.getDataFromNode(this);if(s.nodeProperty!==void 0)return s.nodeProperty;const{condNode:n,ifNode:a,elseNode:o}=t.getNodeProperties(this),h=t.currentFunctionNode,l=e!=="void",u=l?Bs(i).build(t):"";s.nodeProperty=u;const c=n.build(t,"bool");if(t.context.uniformFlow&&o!==null){const p=a.build(t,i),m=o.build(t,i),f=t.getTernary(c,p,m);return t.format(f,i,e)}t.addFlowCode(`
${t.tab}if ( ${c} ) {

`).addFlowTab();let d=a.build(t,i);if(d&&(l?d=u+" = "+d+";":(d="return "+d+";",h===null&&(j("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),d="// "+d))),t.removeFlowTab().addFlowCode(t.tab+"	"+d+`

`+t.tab+"}"),o!==null){t.addFlowCode(` else {

`).addFlowTab();let p=o.build(t,i);p&&(l?p=u+" = "+p+";":(p="return "+p+";",h===null&&(j("TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),p="// "+p))),t.removeFlowTab().addFlowCode(t.tab+"	"+p+`

`+t.tab+`}

`)}else t.addFlowCode(`

`);return t.format(u,i,e)}}const le=Z(E3).setParameterLength(2,3);z("select",le);class tm extends ${static get type(){return"ContextNode"}constructor(t,e={}){super(),this.isContextNode=!0,this.node=t,this.value=e}getScope(){return this.node.getScope()}getNodeType(t){return this.node.getNodeType(t)}getMemberType(t,e){return this.node.getMemberType(t,e)}analyze(t){const e=t.getContext();t.setContext({...t.context,...this.value}),this.node.build(t),t.setContext(e)}setup(t){const e=t.getContext();t.setContext({...t.context,...this.value}),this.node.build(t),t.setContext(e)}generate(t,e){const i=t.getContext();t.setContext({...t.context,...this.value});const s=this.node.build(t,e);return t.setContext(i),s}}const tc=Z(tm).setParameterLength(1,2),I3=r=>tc(r,{uniformFlow:!0}),em=(r,t)=>tc(r,{nodeName:t});function C3(r,t){return j('TSL: "label()" has been deprecated. Use "setName()" instead.'),em(r,t)}z("context",tc),z("label",C3),z("uniformFlow",I3),z("setName",em);class z3 extends ${static get type(){return"VarNode"}constructor(t,e=null,i=!1){super(),this.node=t,this.name=e,this.global=!0,this.isVarNode=!0,this.readOnly=i,this.parents=!0,this.intent=!1}setIntent(t){return this.intent=t,this}getIntent(){return this.intent}getMemberType(t,e){return this.node.getMemberType(t,e)}getElementType(t){return this.node.getElementType(t)}getNodeType(t){return this.node.getNodeType(t)}getArrayCount(t){return this.node.getArrayCount(t)}build(...t){return this.intent===!0&&t[0].getNodeProperties(this).assign!==!0?this.node.build(...t):super.build(...t)}generate(t){const{node:e,name:i,readOnly:s}=this,{renderer:n}=t,a=n.backend.isWebGPUBackend===!0;let o=!1,h=!1;s&&(o=t.isDeterministic(e),h=a?s:o);const l=t.getVectorType(this.getNodeType(t)),u=e.build(t,l),c=t.getVarFromNode(this,i,l,void 0,h),d=t.getPropertyName(c);let p=d;if(h)if(a)p=o?`const ${d}`:`let ${d}`;else{const m=e.getArrayCount(t);p=`const ${t.getVar(c.type,d,m)}`}return t.addLineFlowCode(`${p} = ${u}`,this),d}}const ec=Z(z3),L3=(r,t=null)=>ec(r,t).toStack(),P3=(r,t=null)=>ec(r,t,!0).toStack(),B3=r=>Op()===null?r:ec(r).setIntent(!0).toStack();z("toVar",L3),z("toConst",P3),z("toVarIntent",B3);class O3 extends ${static get type(){return"SubBuild"}constructor(t,e,i=null){super(i),this.node=t,this.name=e,this.isSubBuildNode=!0}getNodeType(t){if(this.nodeType!==null)return this.nodeType;t.addSubBuild(this.name);const e=this.node.getNodeType(t);return t.removeSubBuild(),e}build(t,...e){t.addSubBuild(this.name);const i=this.node.build(t,...e);return t.removeSubBuild(),i}}const ah=(r,t,e=null)=>V(new O3(V(r),t,e));class V3 extends ${static get type(){return"VaryingNode"}constructor(t,e=null){super(),this.node=t,this.name=e,this.isVaryingNode=!0,this.interpolationType=null,this.interpolationSampling=null,this.global=!0}setInterpolation(t,e=null){return this.interpolationType=t,this.interpolationSampling=e,this}getHash(t){return this.name||super.getHash(t)}getNodeType(t){return this.node.getNodeType(t)}setupVarying(t){const e=t.getNodeProperties(this);let i=e.varying;if(i===void 0){const s=this.name,n=this.getNodeType(t),a=this.interpolationType,o=this.interpolationSampling;e.varying=i=t.getVaryingFromNode(this,s,n,a,o),e.node=ah(this.node,"VERTEX")}return i.needsInterpolation||(i.needsInterpolation=t.shaderStage==="fragment"),i}setup(t){this.setupVarying(t),t.flowNodeFromShaderStage(Qo.VERTEX,this.node)}analyze(t){this.setupVarying(t),t.flowNodeFromShaderStage(Qo.VERTEX,this.node)}generate(t){const e=t.getSubBuildProperty("property",t.currentStack),i=t.getNodeProperties(this),s=this.setupVarying(t);if(i[e]===void 0){const n=this.getNodeType(t),a=t.getPropertyName(s,Qo.VERTEX);t.flowNodeFromShaderStage(Qo.VERTEX,i.node,n,a),i[e]=a}return t.getPropertyName(s)}}const pn=Z(V3).setParameterLength(1,2),F3=r=>pn(r);z("toVarying",pn),z("toVertexStage",F3),z("varying",(...r)=>(j("TSL: .varying() has been renamed to .toVarying()."),pn(...r))),z("vertexStage",(...r)=>(j("TSL: .vertexStage() has been renamed to .toVertexStage()."),pn(...r)));const k3=A(([r])=>{const t=r.mul(.9478672986).add(.0521327014).pow(2.4),e=r.mul(.0773993808),i=r.lessThanEqual(.04045);return Zt(t,e,i)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),D3=A(([r])=>{const t=r.pow(.41666).mul(1.055).sub(.055),e=r.mul(12.92),i=r.lessThanEqual(.0031308);return Zt(t,e,i)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),ic="WorkingColorSpace";class im extends Ft{static get type(){return"ColorSpaceNode"}constructor(t,e,i){super("vec4"),this.colorNode=t,this.source=e,this.target=i}resolveColorSpace(t,e){return e===ic?Vt.workingColorSpace:e==="OutputColorSpace"?t.context.outputColorSpace||t.renderer.outputColorSpace:e}setup(t){const{colorNode:e}=this,i=this.resolveColorSpace(t,this.source),s=this.resolveColorSpace(t,this.target);let n=e;return Vt.enabled!==!1&&i!==s&&i&&s&&(Vt.getTransfer(i)===na&&(n=J(k3(n.rgb),n.a)),Vt.getPrimaries(i)!==Vt.getPrimaries(s)&&(n=J(Be(Vt._getMatrix(new He,i,s)).mul(n.rgb),n.a)),Vt.getTransfer(s)===na&&(n=J(D3(n.rgb),n.a))),n}}const U3=(r,t)=>V(new im(V(r),ic,t)),sm=(r,t)=>V(new im(V(r),t,ic));z("workingToColorSpace",U3),z("colorSpaceToWorking",sm);let W3=class extends rr{static get type(){return"ReferenceElementNode"}constructor(r,t){super(r,t),this.referenceNode=r,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(r){const t=super.generate(r),e=this.referenceNode.getNodeType(),i=this.getNodeType();return r.format(t,e,i)}};class H3 extends ${static get type(){return"ReferenceBaseNode"}constructor(t,e,i=null,s=null){super(),this.property=t,this.uniformType=e,this.object=i,this.count=s,this.properties=t.split("."),this.reference=i,this.node=null,this.group=null,this.updateType=Tt.OBJECT}setGroup(t){return this.group=t,this}element(t){return V(new W3(this,V(t)))}setNodeType(t){const e=K(null,t);this.group!==null&&e.setGroup(this.group),this.node=e}getNodeType(t){return this.node===null&&(this.updateReference(t),this.updateValue()),this.node.getNodeType(t)}getValueFromReference(t=this.reference){const{properties:e}=this;let i=t[e[0]];for(let s=1;s<e.length;s++)i=i[e[s]];return i}updateReference(t){return this.reference=this.object!==null?this.object:t.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const t=this.getValueFromReference();Array.isArray(t)?this.node.array=t:this.node.value=t}}class q3 extends H3{static get type(){return"RendererReferenceNode"}constructor(t,e,i=null){super(t,e,i),this.renderer=i,this.setGroup(pt)}updateReference(t){return this.reference=this.renderer!==null?this.renderer:t.renderer,this.reference}}const $3=(r,t,e=null)=>V(new q3(r,t,e));class X3 extends Ft{static get type(){return"ToneMappingNode"}constructor(t,e=G3,i=null){super("vec3"),this.toneMapping=t,this.exposureNode=e,this.colorNode=i}customCacheKey(){return wp(this.toneMapping)}setup(t){const e=this.colorNode||t.context.color,i=this.toneMapping;if(i===0)return e;let s=null;const n=t.renderer.library.getToneMappingFunction(i);return n!==null?s=J(n(e.rgb,this.exposureNode),e.a):(et("ToneMappingNode: Unsupported Tone Mapping configuration.",i),s=e),s}}const j3=(r,t,e)=>V(new X3(r,V(t),V(e))),G3=$3("toneMappingExposure","float");z("toneMapping",(r,t,e)=>j3(t,e,r));class Y3 extends Du{static get type(){return"BufferAttributeNode"}constructor(t,e=null,i=0,s=0){super(t,e),this.isBufferNode=!0,this.bufferType=e,this.bufferStride=i,this.bufferOffset=s,this.usage=35044,this.instanced=!1,this.attribute=null,this.global=!0,t&&t.isBufferAttribute===!0&&(this.attribute=t,this.usage=t.usage,this.instanced=t.isInstancedBufferAttribute)}getHash(t){if(this.bufferStride===0&&this.bufferOffset===0){let e=t.globalCache.getData(this.value);return e===void 0&&(e={node:this},t.globalCache.setData(this.value,e)),e.node.uuid}return this.uuid}getNodeType(t){return this.bufferType===null&&(this.bufferType=t.getTypeFromAttribute(this.attribute)),this.bufferType}setup(t){if(this.attribute!==null)return;const e=this.getNodeType(t),i=this.value,s=t.getTypeLength(e),n=this.bufferStride||s,a=this.bufferOffset,o=i.isInterleavedBuffer===!0?i:new _u(i,n),h=new Z0(o,s,a);o.setUsage(this.usage),this.attribute=h,this.attribute.isInstancedBufferAttribute=this.instanced}generate(t){const e=this.getNodeType(t),i=t.getBufferAttributeFromNode(this,e),s=t.getPropertyName(i);let n=null;return t.shaderStage==="vertex"||t.shaderStage==="compute"?(this.name=s,n=s):n=pn(this).build(t,e),n}getInputType(){return"bufferAttribute"}setUsage(t){return this.usage=t,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=t),this}setInstanced(t){return this.instanced=t,this}}const sc=(r,t=null,e=0,i=0)=>V(new Y3(r,t,e,i)),Z3=(r,t=null,e=0,i=0)=>sc(r,t,e,i).setUsage(35048),nc=(r,t=null,e=0,i=0)=>sc(r,t,e,i).setInstanced(!0),nm=(r,t=null,e=0,i=0)=>Z3(r,t,e,i).setInstanced(!0);z("toAttribute",r=>sc(r.value));class J3 extends ${static get type(){return"ComputeNode"}constructor(t,e){super("void"),this.isComputeNode=!0,this.computeNode=t,this.workgroupSize=e,this.count=null,this.version=1,this.name="",this.updateBeforeType=Tt.OBJECT,this.onInitFunction=null}setCount(t){return this.count=t,this}getCount(){return this.count}dispose(){this.dispatchEvent({type:"dispose"})}setName(t){return this.name=t,this}label(t){return j('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(t)}onInit(t){return this.onInitFunction=t,this}updateBefore({renderer:t}){t.compute(this)}setup(t){const e=this.computeNode.build(t);return e&&(t.getNodeProperties(this).outputComputeNode=e.outputNode,e.outputNode=null),e}generate(t,e){const{shaderStage:i}=t;if(i==="compute"){const s=this.computeNode.build(t,"void");s!==""&&t.addLineFlowCode(s,this)}else{const s=t.getNodeProperties(this).outputComputeNode;if(s)return s.build(t,e)}}}const rm=(r,t=[64])=>{(t.length===0||t.length>3)&&et("TSL: compute() workgroupSize must have 1, 2, or 3 elements");for(let e=0;e<t.length;e++){const i=t[e];(typeof i!="number"||i<=0||!Number.isInteger(i))&&et(`TSL: compute() workgroupSize element at index [ ${e} ] must be a positive integer`)}for(;t.length<3;)t.push(1);return V(new J3(V(r),t))};z("compute",(r,t,e)=>rm(r,e).setCount(t)),z("computeKernel",rm);class Q3 extends ${static get type(){return"CacheNode"}constructor(t,e=!0){super(),this.node=t,this.parent=e,this.isCacheNode=!0}getNodeType(t){const e=t.getCache(),i=t.getCacheFromNode(this,this.parent);t.setCache(i);const s=this.node.getNodeType(t);return t.setCache(e),s}build(t,...e){const i=t.getCache(),s=t.getCacheFromNode(this,this.parent);t.setCache(s);const n=this.node.build(t,...e);return t.setCache(i),n}}z("cache",(r,t)=>V(new Q3(V(r),t)));class K3 extends ${static get type(){return"BypassNode"}constructor(t,e){super(),this.isBypassNode=!0,this.outputNode=t,this.callNode=e}getNodeType(t){return this.outputNode.getNodeType(t)}generate(t){const e=this.callNode.build(t,"void");return e!==""&&t.addLineFlowCode(e,this),this.outputNode.build(t)}}const t4=Z(K3).setParameterLength(2);z("bypass",t4);class am extends ${static get type(){return"RemapNode"}constructor(t,e,i,s=b(0),n=b(1)){super(),this.node=t,this.inLowNode=e,this.inHighNode=i,this.outLowNode=s,this.outHighNode=n,this.doClamp=!0}setup(){const{node:t,inLowNode:e,inHighNode:i,outLowNode:s,outHighNode:n,doClamp:a}=this;let o=t.sub(e).div(i.sub(e));return a===!0&&(o=o.clamp()),o.mul(n.sub(s)).add(s)}}const e4=Z(am,null,null,{doClamp:!1}).setParameterLength(3,5),i4=Z(am).setParameterLength(3,5);z("remap",e4),z("remapClamp",i4);class s4 extends ${static get type(){return"ExpressionNode"}constructor(t="",e="void"){super(e),this.snippet=t}generate(t,e){const i=this.getNodeType(t),s=this.snippet;if(i!=="void")return t.format(s,i,e);t.addLineFlowCode(s,this)}}const hr=Z(s4).setParameterLength(1,2);z("discard",r=>(r?le(r,hr("discard")):hr("discard")).toStack());class n4 extends Ft{static get type(){return"RenderOutputNode"}constructor(t,e,i){super("vec4"),this.colorNode=t,this.toneMapping=e,this.outputColorSpace=i,this.isRenderOutputNode=!0}setup({context:t}){let e=this.colorNode||t.color;const i=(this.toneMapping!==null?this.toneMapping:t.toneMapping)||0,s=(this.outputColorSpace!==null?this.outputColorSpace:t.outputColorSpace)||"";return i!==0&&(e=e.toneMapping(i)),s!==""&&s!==Vt.workingColorSpace&&(e=e.workingToColorSpace(s)),e}}z("renderOutput",(r,t=null,e=null)=>V(new n4(V(r),t,e)));class r4 extends Ft{static get type(){return"DebugNode"}constructor(t,e=null){super(),this.node=t,this.callback=e}getNodeType(t){return this.node.getNodeType(t)}setup(t){return this.node.build(t)}analyze(t){return this.node.build(t)}generate(t){const e=this.callback,i=this.node.build(t),s="--- TSL debug - "+t.shaderStage+" shader ---",n="-".repeat(s.length);let a="";return a+="// #"+s+`#
`,a+=t.flow.code.replace(/^\t/gm,"")+`
`,a+="/* ... */ "+i+` /* ... */
`,a+="// #"+n+`#
`,e!==null?e(t,a):Gl(a),i}}z("debug",(r,t=null)=>V(new r4(V(r),t)).toStack());class om extends ${static get type(){return"AttributeNode"}constructor(t,e=null){super(e),this.global=!0,this._attributeName=t}getHash(t){return this.getAttributeName(t)}getNodeType(t){let e=this.nodeType;if(e===null){const i=this.getAttributeName(t);if(t.hasGeometryAttribute(i)){const s=t.geometry.getAttribute(i);e=t.getTypeFromAttribute(s)}else e="float"}return e}setAttributeName(t){return this._attributeName=t,this}getAttributeName(){return this._attributeName}generate(t){const e=this.getAttributeName(t),i=this.getNodeType(t);if(t.hasGeometryAttribute(e)===!0){const s=t.geometry.getAttribute(e),n=t.getTypeFromAttribute(s),a=t.getAttribute(e,n);return t.shaderStage==="vertex"?t.format(a.name,n,i):pn(this).build(t,i)}return j(`AttributeNode: Vertex attribute "${e}" not found on geometry.`),t.generateConst(i)}serialize(t){super.serialize(t),t.global=this.global,t._attributeName=this._attributeName}deserialize(t){super.deserialize(t),this.global=t.global,this._attributeName=t._attributeName}}const mn=(r,t=null)=>V(new om(r,t)),fn=(r=0)=>mn("uv"+(r>0?r:""),"vec2");class a4 extends ${static get type(){return"TextureSizeNode"}constructor(t,e=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=t,this.levelNode=e}generate(t,e){const i=this.textureNode.build(t,"property"),s=this.levelNode===null?"0":this.levelNode.build(t,"int");return t.format(`${t.getMethod("textureDimensions")}( ${i}, ${s} )`,this.getNodeType(t),e)}}const gn=Z(a4).setParameterLength(1,2);class o4 extends Ea{static get type(){return"MaxMipLevelNode"}constructor(t){super(0),this._textureNode=t,this.updateType=Tt.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const t=this.texture,e=t.images,i=e&&e.length>0?e[0]&&e[0].image||e[0]:t.image;if(i&&i.width!==void 0){const{width:s,height:n}=i;this.value=Math.log2(Math.max(s,n))}}}const hm=Z(o4).setParameterLength(1),lm=new Se;class lr extends Ea{static get type(){return"TextureNode"}constructor(t=lm,e=null,i=null,s=null){super(t),this.isTextureNode=!0,this.uvNode=e,this.levelNode=i,this.biasNode=s,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.offsetNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=Tt.NONE,this.referenceNode=null,this._value=t,this._matrixUniform=null,this.setUpdateMatrix(e===null)}set value(t){this.referenceNode?this.referenceNode.value=t:this._value=t}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===1014?"uvec4":this.value.type===1013?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return fn(this.value.channel)}updateReference(){return this.value}getTransformedUV(t){return this._matrixUniform===null&&(this._matrixUniform=K(this.value.matrix)),this._matrixUniform.mul(R(t,1)).xy}setUpdateMatrix(t){return this.updateMatrix=t,this.updateType=t?Tt.OBJECT:Tt.NONE,this}setupUV(t,e){const i=this.value;return t.isFlipY()&&(i.image instanceof ImageBitmap&&i.flipY===!0||i.isRenderTargetTexture===!0||i.isFramebufferTexture===!0||i.isDepthTexture===!0)&&(e=this.sampler?e.flipY():e.setY(w(gn(this,this.levelNode).y).sub(e.y).sub(1))),e}setup(t){const e=t.getNodeProperties(this);e.referenceNode=this.referenceNode;const i=this.value;if(!i||i.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let s=this.uvNode;s!==null&&t.context.forceUVContext!==!0||!t.context.getUV||(s=t.context.getUV(this,t)),s||(s=this.getDefaultUV()),this.updateMatrix===!0&&(s=this.getTransformedUV(s)),s=this.setupUV(t,s);let n=this.levelNode;n===null&&t.context.getTextureLevel&&(n=t.context.getTextureLevel(this)),e.uvNode=s,e.levelNode=n,e.biasNode=this.biasNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.depthNode=this.depthNode,e.offsetNode=this.offsetNode}generateUV(t,e){return e.build(t,this.sampler===!0?"vec2":"ivec2")}generateOffset(t,e){return e.build(t,"ivec2")}generateSnippet(t,e,i,s,n,a,o,h,l){const u=this.value;let c;return c=n?t.generateTextureBias(u,e,i,n,a,l):h?t.generateTextureGrad(u,e,i,h,a,l):o?t.generateTextureCompare(u,e,i,o,a,l):this.sampler===!1?t.generateTextureLoad(u,e,i,s,a,l):s?t.generateTextureLevel(u,e,i,s,a,l):t.generateTexture(u,e,i,a,l),c}generate(t,e){const i=this.value,s=t.getNodeProperties(this),n=super.generate(t,"property");if(/^sampler/.test(e))return n+"_sampler";if(t.isReference(e))return n;{const a=t.getDataFromNode(this);let o=a.propertyName;if(o===void 0){const{uvNode:u,levelNode:c,biasNode:d,compareNode:p,depthNode:m,gradNode:f,offsetNode:g}=s,y=this.generateUV(t,u),x=c?c.build(t,"float"):null,_=d?d.build(t,"float"):null,M=m?m.build(t,"int"):null,v=p?p.build(t,"float"):null,N=f?[f[0].build(t,"vec2"),f[1].build(t,"vec2")]:null,T=g?this.generateOffset(t,g):null,C=t.getVarFromNode(this);o=t.getPropertyName(C);const P=this.generateSnippet(t,n,y,x,_,M,v,N,T);t.addLineFlowCode(`${o} = ${P}`,this),a.snippet=P,a.propertyName=o}let h=o;const l=this.getNodeType(t);return t.needsToWorkingColorSpace(i)&&(h=sm(hr(h,l),i.colorSpace).setup(t).build(t,l)),t.format(h,l,e)}}setSampler(t){return this.sampler=t,this}getSampler(){return this.sampler}uv(t){return j("TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(t)}sample(t){const e=this.clone();return e.uvNode=V(t),e.referenceNode=this.getBase(),V(e)}load(t){return this.sample(t).setSampler(!1)}blur(t){const e=this.clone();e.biasNode=V(t).mul(hm(e)),e.referenceNode=this.getBase();const i=e.value;return e.generateMipmaps===!1&&(i&&i.generateMipmaps===!1||i.minFilter===1003||i.magFilter===1003)&&(j("TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),e.biasNode=null),V(e)}level(t){const e=this.clone();return e.levelNode=V(t),e.referenceNode=this.getBase(),V(e)}size(t){return gn(this,t)}bias(t){const e=this.clone();return e.biasNode=V(t),e.referenceNode=this.getBase(),V(e)}getBase(){return this.referenceNode?this.referenceNode.getBase():this}compare(t){const e=this.clone();return e.compareNode=V(t),e.referenceNode=this.getBase(),V(e)}grad(t,e){const i=this.clone();return i.gradNode=[V(t),V(e)],i.referenceNode=this.getBase(),V(i)}depth(t){const e=this.clone();return e.depthNode=V(t),e.referenceNode=this.getBase(),V(e)}offset(t){const e=this.clone();return e.offsetNode=V(t),e.referenceNode=this.getBase(),V(e)}serialize(t){super.serialize(t),t.value=this.value.toJSON(t.meta).uuid,t.sampler=this.sampler,t.updateMatrix=this.updateMatrix,t.updateType=this.updateType}deserialize(t){super.deserialize(t),this.value=t.meta.textures[t.value],this.sampler=t.sampler,this.updateMatrix=t.updateMatrix,this.updateType=t.updateType}update(){const t=this.value,e=this._matrixUniform;e!==null&&(e.value=t.matrix),t.matrixAutoUpdate===!0&&t.updateMatrix()}clone(){const t=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return t.sampler=this.sampler,t.depthNode=this.depthNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.offsetNode=this.offsetNode,t}}const h4=Z(lr).setParameterLength(1,4).setName("texture"),Bt=(r=lm,t=null,e=null,i=null)=>{let s;return r&&r.isTextureNode===!0?(s=V(r.clone()),s.referenceNode=r.getBase(),t!==null&&(s.uvNode=V(t)),e!==null&&(s.levelNode=V(e)),i!==null&&(s.biasNode=V(i))):s=h4(r,t,e,i),s},Dt=(...r)=>Bt(...r).setSampler(!1);class um extends Ea{static get type(){return"BufferNode"}constructor(t,e,i=0){super(t,e),this.isBufferNode=!0,this.bufferType=e,this.bufferCount=i}getElementType(t){return this.getNodeType(t)}getInputType(){return"buffer"}}const rc=(r,t,e)=>V(new um(r,t,e));class l4 extends rr{static get type(){return"UniformArrayElementNode"}constructor(t,e){super(t,e),this.isArrayBufferElementNode=!0}generate(t){const e=super.generate(t),i=this.getNodeType(),s=this.node.getPaddedType();return t.format(e,s,i)}}class u4 extends um{static get type(){return"UniformArrayNode"}constructor(t,e=null){super(null),this.array=t,this.elementType=e===null?Ps(t[0]):e,this.paddedType=this.getPaddedType(),this.updateType=Tt.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const t=this.elementType;let e="vec4";return t==="mat2"?e="mat2":/mat/.test(t)===!0?e="mat4":t.charAt(0)==="i"?e="ivec4":t.charAt(0)==="u"&&(e="uvec4"),e}update(){const{array:t,value:e}=this,i=this.elementType;if(i==="float"||i==="int"||i==="uint")for(let s=0;s<t.length;s++)e[4*s]=t[s];else if(i==="color")for(let s=0;s<t.length;s++){const n=4*s,a=t[s];e[n]=a.r,e[n+1]=a.g,e[n+2]=a.b||0}else if(i==="mat2")for(let s=0;s<t.length;s++){const n=4*s,a=t[s];e[n]=a.elements[0],e[n+1]=a.elements[1],e[n+2]=a.elements[2],e[n+3]=a.elements[3]}else if(i==="mat3")for(let s=0;s<t.length;s++){const n=16*s,a=t[s];e[n]=a.elements[0],e[n+1]=a.elements[1],e[n+2]=a.elements[2],e[n+4]=a.elements[3],e[n+5]=a.elements[4],e[n+6]=a.elements[5],e[n+8]=a.elements[6],e[n+9]=a.elements[7],e[n+10]=a.elements[8],e[n+15]=1}else if(i==="mat4")for(let s=0;s<t.length;s++){const n=16*s,a=t[s];for(let o=0;o<a.elements.length;o++)e[n+o]=a.elements[o]}else for(let s=0;s<t.length;s++){const n=4*s,a=t[s];e[n]=a.x,e[n+1]=a.y,e[n+2]=a.z||0,e[n+3]=a.w||0}}setup(t){const e=this.array.length,i=this.elementType;let s=Float32Array;const n=this.paddedType,a=t.getTypeLength(n);return i.charAt(0)==="i"&&(s=Int32Array),i.charAt(0)==="u"&&(s=Uint32Array),this.value=new s(e*a),this.bufferCount=e,this.bufferType=n,super.setup(t)}element(t){return V(new l4(this,V(t)))}}const Ne=(r,t)=>V(new u4(r,t)),yn=Z(class extends ${constructor(r){super("float"),this.name=r,this.isBuiltinNode=!0}generate(){return this.name}}).setParameterLength(1);let za,La;class At extends ${static get type(){return"ScreenNode"}constructor(t){super(),this.scope=t,this._output=null,this.isViewportNode=!0}getNodeType(){return this.scope===At.DPR?"float":this.scope===At.VIEWPORT?"vec4":"vec2"}getUpdateType(){let t=Tt.NONE;return this.scope!==At.SIZE&&this.scope!==At.VIEWPORT&&this.scope!==At.DPR||(t=Tt.RENDER),this.updateType=t,t}update({renderer:t}){const e=t.getRenderTarget();this.scope===At.VIEWPORT?e!==null?La.copy(e.viewport):(t.getViewport(La),La.multiplyScalar(t.getPixelRatio())):this.scope===At.DPR?this._output.value=t.getPixelRatio():e!==null?(za.width=e.width,za.height=e.height):t.getDrawingBufferSize(za)}setup(){const t=this.scope;let e=null;return e=t===At.SIZE?K(za||(za=new nt)):t===At.VIEWPORT?K(La||(La=new wt)):t===At.DPR?K(1):B(oh.div(ur)),this._output=e,e}generate(t){if(this.scope===At.COORDINATE){let e=t.getFragCoord();if(t.isFlipY()){const i=t.getNodeProperties(ur).outputNode.build(t);e=`${t.getType("vec2")}( ${e}.x, ${i}.y - ${e}.y )`}return e}return super.generate(t)}}At.COORDINATE="coordinate",At.VIEWPORT="viewport",At.SIZE="size",At.UV="uv",At.DPR="dpr",U(At,At.DPR);const Pa=U(At,At.UV),ur=U(At,At.SIZE),oh=U(At,At.COORDINATE),cm=U(At,At.VIEWPORT),c4=cm.zw;oh.sub(cm.xy).div(c4),A(()=>(j('TSL: "viewportResolution" is deprecated. Use "screenSize" instead.'),ur),"vec2").once()();const xn=K(0,"uint").setName("u_cameraIndex").setGroup(Yu("cameraIndex")).toVarying("v_cameraIndex"),bn=K("float").setName("cameraNear").setGroup(pt).onRenderUpdate(({camera:r})=>r.near),Mn=K("float").setName("cameraFar").setGroup(pt).onRenderUpdate(({camera:r})=>r.far),ac=A(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(const i of r.cameras)e.push(i.projectionMatrix);t=Ne(e).setGroup(pt).setName("cameraProjectionMatrices").element(r.isMultiViewCamera?yn("gl_ViewID_OVR"):xn).toConst("cameraProjectionMatrix")}else t=K("mat4").setName("cameraProjectionMatrix").setGroup(pt).onRenderUpdate(({camera:e})=>e.projectionMatrix);return t}).once()();A(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(const i of r.cameras)e.push(i.projectionMatrixInverse);t=Ne(e).setGroup(pt).setName("cameraProjectionMatricesInverse").element(r.isMultiViewCamera?yn("gl_ViewID_OVR"):xn).toConst("cameraProjectionMatrixInverse")}else t=K("mat4").setName("cameraProjectionMatrixInverse").setGroup(pt).onRenderUpdate(({camera:e})=>e.projectionMatrixInverse);return t}).once()();const Fs=A(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(const i of r.cameras)e.push(i.matrixWorldInverse);t=Ne(e).setGroup(pt).setName("cameraViewMatrices").element(r.isMultiViewCamera?yn("gl_ViewID_OVR"):xn).toConst("cameraViewMatrix")}else t=K("mat4").setName("cameraViewMatrix").setGroup(pt).onRenderUpdate(({camera:e})=>e.matrixWorldInverse);return t}).once()();A(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(const i of r.cameras)e.push(i.matrixWorld);t=Ne(e).setGroup(pt).setName("cameraWorldMatrices").element(r.isMultiViewCamera?yn("gl_ViewID_OVR"):xn).toConst("cameraWorldMatrix")}else t=K("mat4").setName("cameraWorldMatrix").setGroup(pt).onRenderUpdate(({camera:e})=>e.matrixWorld);return t}).once()(),A(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(const i of r.cameras)e.push(i.normalMatrix);t=Ne(e).setGroup(pt).setName("cameraNormalMatrices").element(r.isMultiViewCamera?yn("gl_ViewID_OVR"):xn).toConst("cameraNormalMatrix")}else t=K("mat3").setName("cameraNormalMatrix").setGroup(pt).onRenderUpdate(({camera:e})=>e.normalMatrix);return t}).once()(),A(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(let s=0,n=r.cameras.length;s<n;s++)e.push(new S);t=Ne(e).setGroup(pt).setName("cameraPositions").onRenderUpdate(({camera:s},n)=>{const a=s.cameras,o=n.array;for(let h=0,l=a.length;h<l;h++)o[h].setFromMatrixPosition(a[h].matrixWorld)}).element(r.isMultiViewCamera?yn("gl_ViewID_OVR"):xn).toConst("cameraPosition")}else t=K(new S).setName("cameraPosition").setGroup(pt).onRenderUpdate(({camera:e},i)=>i.value.setFromMatrixPosition(e.matrixWorld));return t}).once()(),A(({camera:r})=>{let t;if(r.isArrayCamera&&r.cameras.length>0){const e=[];for(const i of r.cameras)e.push(i.viewport);t=Ne(e,"vec4").setGroup(pt).setName("cameraViewports").element(xn).toConst("cameraViewport")}else t=J(0,0,ur.x,ur.y).toConst("cameraViewport");return t}).once()();const dm=new qe;class at extends ${static get type(){return"Object3DNode"}constructor(t,e=null){super(),this.scope=t,this.object3d=e,this.updateType=Tt.OBJECT,this.uniformNode=new Ea(null)}getNodeType(){const t=this.scope;return t===at.WORLD_MATRIX?"mat4":t===at.POSITION||t===at.VIEW_POSITION||t===at.DIRECTION||t===at.SCALE?"vec3":t===at.RADIUS?"float":void 0}update(t){const e=this.object3d,i=this.uniformNode,s=this.scope;if(s===at.WORLD_MATRIX)i.value=e.matrixWorld;else if(s===at.POSITION)i.value=i.value||new S,i.value.setFromMatrixPosition(e.matrixWorld);else if(s===at.SCALE)i.value=i.value||new S,i.value.setFromMatrixScale(e.matrixWorld);else if(s===at.DIRECTION)i.value=i.value||new S,e.getWorldDirection(i.value);else if(s===at.VIEW_POSITION){const n=t.camera;i.value=i.value||new S,i.value.setFromMatrixPosition(e.matrixWorld),i.value.applyMatrix4(n.matrixWorldInverse)}else if(s===at.RADIUS){const n=t.object.geometry;n.boundingSphere===null&&n.computeBoundingSphere(),dm.copy(n.boundingSphere).applyMatrix4(e.matrixWorld),i.value=dm.radius}}generate(t){const e=this.scope;return e===at.WORLD_MATRIX?this.uniformNode.nodeType="mat4":e===at.POSITION||e===at.VIEW_POSITION||e===at.DIRECTION||e===at.SCALE?this.uniformNode.nodeType="vec3":e===at.RADIUS&&(this.uniformNode.nodeType="float"),this.uniformNode.build(t)}serialize(t){super.serialize(t),t.scope=this.scope}deserialize(t){super.deserialize(t),this.scope=t.scope}}at.WORLD_MATRIX="worldMatrix",at.POSITION="position",at.SCALE="scale",at.VIEW_POSITION="viewPosition",at.DIRECTION="direction",at.RADIUS="radius",Z(at,at.DIRECTION).setParameterLength(1),Z(at,at.WORLD_MATRIX).setParameterLength(1),Z(at,at.POSITION).setParameterLength(1),Z(at,at.SCALE).setParameterLength(1),Z(at,at.VIEW_POSITION).setParameterLength(1),Z(at,at.RADIUS).setParameterLength(1);class Ye extends at{static get type(){return"ModelNode"}constructor(t){super(t)}update(t){this.object3d=t.object,super.update(t)}}U(Ye,Ye.DIRECTION);const ks=U(Ye,Ye.WORLD_MATRIX);U(Ye,Ye.POSITION),U(Ye,Ye.SCALE),U(Ye,Ye.VIEW_POSITION),U(Ye,Ye.RADIUS);const d4=K(new He).onObjectUpdate(({object:r},t)=>t.value.getNormalMatrix(r.matrixWorld));K(new G).onObjectUpdate(({object:r},t)=>t.value.copy(r.matrixWorld).invert());const oc=A(r=>r.renderer.overrideNodes.modelViewMatrix||p4).once()().toVar("modelViewMatrix"),p4=Fs.mul(ks);A(r=>(r.context.isHighPrecisionModelViewMatrix=!0,K("mat4").onObjectUpdate(({object:t,camera:e})=>t.modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,t.matrixWorld)))).once()().toVar("highpModelViewMatrix"),A(r=>{const t=r.context.isHighPrecisionModelViewMatrix;return K("mat3").onObjectUpdate(({object:e,camera:i})=>(t!==!0&&e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix");const pm=mn("position","vec3"),se=pm.toVarying("positionLocal"),hc=pm.toVarying("positionPrevious"),hh=A(r=>ks.mul(se).xyz.toVarying(r.getSubBuildProperty("v_positionWorld")),"vec3").once(["POSITION"])(),mm=A(()=>se.transformDirection(ks).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),"vec3").once(["POSITION"])(),ne=A(r=>r.context.setupPositionView().toVarying("v_positionView"),"vec3").once(["POSITION"])(),pe=ne.negate().toVarying("v_positionViewDirection").normalize().toVar("positionViewDirection");class m4 extends ${static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(t){if(t.shaderStage!=="fragment")return"true";const{material:e}=t;return e.side===1?"false":t.getFrontFacing()}}const f4=U(m4),fm=b(f4).mul(2).sub(1),lh=A(([r],{material:t})=>{const e=t.side;return e===1?r=r.mul(-1):e===2&&(r=r.mul(fm)),r}),gm=mn("normal","vec3"),Ze=A(r=>r.geometry.hasAttribute("normal")===!1?(j('TSL: Vertex attribute "normal" not found on geometry.'),R(0,1,0)):gm,"vec3").once()().toVar("normalLocal"),g4=ne.dFdx().cross(ne.dFdy()).normalize().toVar("normalFlat"),uh=A(r=>{let t;return t=r.material.flatShading===!0?g4:xm(Ze).toVarying("v_normalViewGeometry").normalize(),t},"vec3").once()().toVar("normalViewGeometry");A(r=>{let t=uh.transformDirection(Fs);return r.material.flatShading!==!0&&(t=t.toVarying("v_normalWorldGeometry")),t.normalize().toVar("normalWorldGeometry")},"vec3").once()();const $t=A(({subBuildFn:r,material:t,context:e})=>{let i;return r==="NORMAL"||r==="VERTEX"?(i=uh,t.flatShading!==!0&&(i=lh(i))):i=e.setupNormal().context({getUV:null}),i},"vec3").once(["NORMAL","VERTEX"])().toVar("normalView"),ym=$t.transformDirection(Fs).toVar("normalWorld"),y4=A(({subBuildFn:r,context:t})=>{let e;return e=r==="NORMAL"||r==="VERTEX"?$t:t.setupClearcoatNormal().context({getUV:null}),e},"vec3").once(["NORMAL","VERTEX"])().toVar("clearcoatNormalView"),x4=A(([r,t=ks])=>{const e=Be(t),i=r.div(R(e[0].dot(e[0]),e[1].dot(e[1]),e[2].dot(e[2])));return e.mul(i).xyz}),xm=A(([r],t)=>{const e=t.renderer.overrideNodes.modelNormalViewMatrix;if(e!==null)return e.transformDirection(r);const i=d4.mul(r);return Fs.transformDirection(i)});A(()=>(j('TSL: "transformedNormalView" is deprecated. Use "normalView" instead.'),$t)).once(["NORMAL","VERTEX"])(),A(()=>(j('TSL: "transformedNormalWorld" is deprecated. Use "normalWorld" instead.'),ym)).once(["NORMAL","VERTEX"])(),A(()=>(j('TSL: "transformedClearcoatNormalView" is deprecated. Use "clearcoatNormalView" instead.'),y4)).once(["NORMAL","VERTEX"])();const bm=new $e,lc=new G,b4=K(0).onReference(({material:r})=>r).onObjectUpdate(({material:r})=>r.refractionRatio);K(1).onReference(({material:r})=>r).onObjectUpdate(function({material:r,scene:t}){return r.envMap?r.envMapIntensity:t.environmentIntensity});const Mm=K(new G).onReference(function(r){return r.material}).onObjectUpdate(function({material:r,scene:t}){const e=t.environment!==null&&r.envMap===null?t.environmentRotation:r.envMapRotation;return e?(bm.copy(e),lc.makeRotationFromEuler(bm)):lc.identity(),lc}),M4=pe.negate().reflect($t),_4=pe.negate().refract($t,b4),v4=M4.transformDirection(Fs).toVar("reflectVector"),w4=_4.transformDirection(Fs).toVar("reflectVector"),T4=new xu;class S4 extends lr{static get type(){return"CubeTextureNode"}constructor(t,e=null,i=null,s=null){super(t,e,i,s),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const t=this.value;return t.mapping===301?v4:t.mapping===302?w4:(et('CubeTextureNode: Mapping "%s" not supported.',t.mapping),R(0,0,0))}setUpdateMatrix(){}setupUV(t,e){const i=this.value;return t.renderer.coordinateSystem!==2001&&i.isRenderTargetTexture||(e=R(e.x.negate(),e.yz)),Mm.mul(e)}generateUV(t,e){return e.build(t,this.sampler===!0?"vec3":"ivec3")}}const A4=Z(S4).setParameterLength(1,4).setName("cubeTexture"),uc=(r=T4,t=null,e=null,i=null)=>{let s;return r&&r.isCubeTextureNode===!0?(s=V(r.clone()),s.referenceNode=r,t!==null&&(s.uvNode=V(t)),e!==null&&(s.levelNode=V(e)),i!==null&&(s.biasNode=V(i))):s=A4(r,t,e,i),s};class N4 extends rr{static get type(){return"ReferenceElementNode"}constructor(t,e){super(t,e),this.referenceNode=t,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(t){const e=super.generate(t),i=this.referenceNode.getNodeType(),s=this.getNodeType();return t.format(e,i,s)}}class cc extends ${static get type(){return"ReferenceNode"}constructor(t,e,i=null,s=null){super(),this.property=t,this.uniformType=e,this.object=i,this.count=s,this.properties=t.split("."),this.reference=i,this.node=null,this.group=null,this.name=null,this.updateType=Tt.OBJECT}element(t){return V(new N4(this,V(t)))}setGroup(t){return this.group=t,this}setName(t){return this.name=t,this}label(t){return j('TSL: "label()" has been deprecated. Use "setName()" instead.'),this.setName(t)}setNodeType(t){let e=null;e=this.count!==null?rc(null,t,this.count):Array.isArray(this.getValueFromReference())?Ne(null,t):t==="texture"?Bt(null):t==="cubeTexture"?uc(null):K(null,t),this.group!==null&&e.setGroup(this.group),this.name!==null&&e.setName(this.name),this.node=e}getNodeType(t){return this.node===null&&(this.updateReference(t),this.updateValue()),this.node.getNodeType(t)}getValueFromReference(t=this.reference){const{properties:e}=this;let i=t[e[0]];for(let s=1;s<e.length;s++)i=i[e[s]];return i}updateReference(t){return this.reference=this.object!==null?this.object:t.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const t=this.getValueFromReference();Array.isArray(t)?this.node.array=t:this.node.value=t}}const Je=(r,t,e)=>V(new cc(r,t,e)),_m=(r,t,e,i)=>V(new cc(r,t,i,e));class R4 extends cc{static get type(){return"MaterialReferenceNode"}constructor(t,e,i=null){super(t,e,i),this.material=i,this.isMaterialReferenceNode=!0}updateReference(t){return this.reference=this.material!==null?this.material:t.material,this.reference}}const _n=(r,t,e=null)=>V(new R4(r,t,e)),vm=fn(),E4=ne.dFdx(),I4=ne.dFdy(),wm=vm.dFdx(),Tm=vm.dFdy(),Sm=$t,Am=I4.cross(Sm),Nm=Sm.cross(E4),dc=Am.mul(wm.x).add(Nm.mul(Tm.x)),pc=Am.mul(wm.y).add(Nm.mul(Tm.y)),Rm=dc.dot(dc).max(pc.dot(pc)),Em=Rm.equal(0).select(0,Rm.inverseSqrt()),C4=dc.mul(Em).toVar("tangentViewFrame"),z4=pc.mul(Em).toVar("bitangentViewFrame"),mc=A(r=>(r.geometry.hasAttribute("tangent")===!1&&r.geometry.computeTangents(),mn("tangent","vec4")))(),ch=mc.xyz.toVar("tangentLocal"),fc=A(({subBuildFn:r,geometry:t,material:e})=>{let i;return i=r==="VERTEX"||t.hasAttribute("tangent")?oc.mul(J(ch,0)).xyz.toVarying("v_tangentView").normalize():C4,e.flatShading!==!0&&(i=lh(i)),i},"vec3").once(["NORMAL","VERTEX"])().toVar("tangentView"),L4=fc.transformDirection(Fs).toVarying("v_tangentWorld").normalize().toVar("tangentWorld"),dh=A(([r,t],{subBuildFn:e,material:i})=>{let s=r.mul(mc.w).xyz;return e==="NORMAL"&&i.flatShading!==!0&&(s=s.toVarying(t)),s}).once(["NORMAL"]);dh(gm.cross(mc),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),dh(Ze.cross(ch),"v_bitangentLocal").normalize().toVar("bitangentLocal");const P4=A(({subBuildFn:r,geometry:t,material:e})=>{let i;return i=r==="VERTEX"||t.hasAttribute("tangent")?dh($t.cross(fc),"v_bitangentView").normalize():z4,e.flatShading!==!0&&(i=lh(i)),i},"vec3").once(["NORMAL","VERTEX"])().toVar("bitangentView");dh(ym.cross(L4),"v_bitangentWorld").normalize().toVar("bitangentWorld");const Im=Be(fc,P4,$t).toVar("TBNViewMatrix");pe.mul(Im),A(()=>{let r=Na.cross(pe);return r=r.cross(Na).normalize(),r=Zt(r,$t,v2.mul(x2.oneMinus()).oneMinus().pow2().pow2()).normalize(),r}).once()();class B4 extends Ft{static get type(){return"NormalMapNode"}constructor(t,e=null){super("vec3"),this.node=t,this.scaleNode=e,this.normalMapType=0}setup({material:t}){const{normalMapType:e,scaleNode:i}=this;let s=this.node.mul(2).sub(1);if(i!==null){let a=i;t.flatShading===!0&&(a=lh(a)),s=R(s.xy.mul(a),s.z)}let n=null;return e===1?n=xm(s):e===0?n=Im.mul(s).normalize():(et(`NodeMaterial: Unsupported normal map type: ${e}`),n=$t),n}}const Cm=Z(B4).setParameterLength(1,2),O4=A(({textureNode:r,bumpScale:t})=>{const e=s=>r.cache().context({getUV:n=>s(n.uvNode||fn()),forceUVContext:!0}),i=b(e(s=>s));return B(b(e(s=>s.add(s.dFdx()))).sub(i),b(e(s=>s.add(s.dFdy()))).sub(i)).mul(t)}),V4=A(r=>{const{surf_pos:t,surf_norm:e,dHdxy:i}=r,s=t.dFdx().normalize(),n=e,a=t.dFdy().normalize().cross(n),o=n.cross(s),h=s.dot(a).mul(fm),l=h.sign().mul(i.x.mul(a).add(i.y.mul(o)));return h.abs().mul(e).sub(l).normalize()});class F4 extends Ft{static get type(){return"BumpMapNode"}constructor(t,e=null){super("vec3"),this.textureNode=t,this.scaleNode=e}setup(){const t=this.scaleNode!==null?this.scaleNode:1,e=O4({textureNode:this.textureNode,bumpScale:t});return V4({surf_pos:ne,surf_norm:$t,dHdxy:e})}}const k4=Z(F4).setParameterLength(1,2),zm=new Map;class L extends ${static get type(){return"MaterialNode"}constructor(t){super(),this.scope=t}getCache(t,e){let i=zm.get(t);return i===void 0&&(i=_n(t,e),zm.set(t,i)),i}getFloat(t){return this.getCache(t,"float")}getColor(t){return this.getCache(t,"color")}getTexture(t){return this.getCache(t==="map"?"map":t+"Map","texture")}setup(t){const e=t.context.material,i=this.scope;let s=null;if(i===L.COLOR){const n=e.color!==void 0?this.getColor(i):R();s=e.map&&e.map.isTexture===!0?n.mul(this.getTexture("map")):n}else if(i===L.OPACITY){const n=this.getFloat(i);s=e.alphaMap&&e.alphaMap.isTexture===!0?n.mul(this.getTexture("alpha")):n}else if(i===L.SPECULAR_STRENGTH)s=e.specularMap&&e.specularMap.isTexture===!0?this.getTexture("specular").r:b(1);else if(i===L.SPECULAR_INTENSITY){const n=this.getFloat(i);s=e.specularIntensityMap&&e.specularIntensityMap.isTexture===!0?n.mul(this.getTexture(i).a):n}else if(i===L.SPECULAR_COLOR){const n=this.getColor(i);s=e.specularColorMap&&e.specularColorMap.isTexture===!0?n.mul(this.getTexture(i).rgb):n}else if(i===L.ROUGHNESS){const n=this.getFloat(i);s=e.roughnessMap&&e.roughnessMap.isTexture===!0?n.mul(this.getTexture(i).g):n}else if(i===L.METALNESS){const n=this.getFloat(i);s=e.metalnessMap&&e.metalnessMap.isTexture===!0?n.mul(this.getTexture(i).b):n}else if(i===L.EMISSIVE){const n=this.getFloat("emissiveIntensity"),a=this.getColor(i).mul(n);s=e.emissiveMap&&e.emissiveMap.isTexture===!0?a.mul(this.getTexture(i)):a}else if(i===L.NORMAL)e.normalMap?(s=Cm(this.getTexture("normal"),this.getCache("normalScale","vec2")),s.normalMapType=e.normalMapType):s=e.bumpMap?k4(this.getTexture("bump").r,this.getFloat("bumpScale")):$t;else if(i===L.CLEARCOAT){const n=this.getFloat(i);s=e.clearcoatMap&&e.clearcoatMap.isTexture===!0?n.mul(this.getTexture(i).r):n}else if(i===L.CLEARCOAT_ROUGHNESS){const n=this.getFloat(i);s=e.clearcoatRoughnessMap&&e.clearcoatRoughnessMap.isTexture===!0?n.mul(this.getTexture(i).r):n}else if(i===L.CLEARCOAT_NORMAL)s=e.clearcoatNormalMap?Cm(this.getTexture(i),this.getCache(i+"Scale","vec2")):$t;else if(i===L.SHEEN){const n=this.getColor("sheenColor").mul(this.getFloat("sheen"));s=e.sheenColorMap&&e.sheenColorMap.isTexture===!0?n.mul(this.getTexture("sheenColor").rgb):n}else if(i===L.SHEEN_ROUGHNESS){const n=this.getFloat(i);s=e.sheenRoughnessMap&&e.sheenRoughnessMap.isTexture===!0?n.mul(this.getTexture(i).a):n,s=s.clamp(.07,1)}else if(i===L.ANISOTROPY)if(e.anisotropyMap&&e.anisotropyMap.isTexture===!0){const n=this.getTexture(i);s=ju(Ba.x,Ba.y,Ba.y.negate(),Ba.x).mul(n.rg.mul(2).sub(B(1)).normalize().mul(n.b))}else s=Ba;else if(i===L.IRIDESCENCE_THICKNESS){const n=Je("1","float",e.iridescenceThicknessRange);if(e.iridescenceThicknessMap){const a=Je("0","float",e.iridescenceThicknessRange);s=n.sub(a).mul(this.getTexture(i).g).add(a)}else s=n}else if(i===L.TRANSMISSION){const n=this.getFloat(i);s=e.transmissionMap?n.mul(this.getTexture(i).r):n}else if(i===L.THICKNESS){const n=this.getFloat(i);s=e.thicknessMap?n.mul(this.getTexture(i).g):n}else if(i===L.IOR)s=this.getFloat(i);else if(i===L.LIGHT_MAP)s=this.getTexture(i).rgb.mul(this.getFloat("lightMapIntensity"));else if(i===L.AO)s=this.getTexture(i).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else if(i===L.LINE_DASH_OFFSET)s=e.dashOffset?this.getFloat(i):b(0);else{const n=this.getNodeType(t);s=this.getCache(i,n)}return s}}L.ALPHA_TEST="alphaTest",L.COLOR="color",L.OPACITY="opacity",L.SHININESS="shininess",L.SPECULAR="specular",L.SPECULAR_STRENGTH="specularStrength",L.SPECULAR_INTENSITY="specularIntensity",L.SPECULAR_COLOR="specularColor",L.REFLECTIVITY="reflectivity",L.ROUGHNESS="roughness",L.METALNESS="metalness",L.NORMAL="normal",L.CLEARCOAT="clearcoat",L.CLEARCOAT_ROUGHNESS="clearcoatRoughness",L.CLEARCOAT_NORMAL="clearcoatNormal",L.EMISSIVE="emissive",L.ROTATION="rotation",L.SHEEN="sheen",L.SHEEN_ROUGHNESS="sheenRoughness",L.ANISOTROPY="anisotropy",L.IRIDESCENCE="iridescence",L.IRIDESCENCE_IOR="iridescenceIOR",L.IRIDESCENCE_THICKNESS="iridescenceThickness",L.IOR="ior",L.TRANSMISSION="transmission",L.THICKNESS="thickness",L.ATTENUATION_DISTANCE="attenuationDistance",L.ATTENUATION_COLOR="attenuationColor",L.LINE_SCALE="scale",L.LINE_DASH_SIZE="dashSize",L.LINE_GAP_SIZE="gapSize",L.LINE_WIDTH="linewidth",L.LINE_DASH_OFFSET="dashOffset",L.POINT_SIZE="size",L.DISPERSION="dispersion",L.LIGHT_MAP="light",L.AO="ao";const D4=U(L,L.ALPHA_TEST),U4=U(L,L.COLOR);U(L,L.SHININESS);const W4=U(L,L.EMISSIVE),H4=U(L,L.OPACITY);U(L,L.SPECULAR),U(L,L.SPECULAR_INTENSITY),U(L,L.SPECULAR_COLOR),U(L,L.SPECULAR_STRENGTH),U(L,L.REFLECTIVITY),U(L,L.ROUGHNESS),U(L,L.METALNESS);const q4=U(L,L.NORMAL);U(L,L.CLEARCOAT),U(L,L.CLEARCOAT_ROUGHNESS),U(L,L.CLEARCOAT_NORMAL),U(L,L.ROTATION),U(L,L.SHEEN),U(L,L.SHEEN_ROUGHNESS),U(L,L.ANISOTROPY),U(L,L.IRIDESCENCE),U(L,L.IRIDESCENCE_IOR),U(L,L.IRIDESCENCE_THICKNESS),U(L,L.TRANSMISSION),U(L,L.THICKNESS),U(L,L.IOR),U(L,L.ATTENUATION_DISTANCE),U(L,L.ATTENUATION_COLOR),U(L,L.LINE_SCALE),U(L,L.LINE_DASH_SIZE),U(L,L.LINE_GAP_SIZE),U(L,L.LINE_WIDTH),U(L,L.LINE_DASH_OFFSET),U(L,L.POINT_SIZE),U(L,L.DISPERSION);const $4=U(L,L.LIGHT_MAP),X4=U(L,L.AO),Ba=K(new nt).onReference(function(r){return r.material}).onRenderUpdate(function({material:r}){this.value.set(r.anisotropy*Math.cos(r.anisotropyRotation),r.anisotropy*Math.sin(r.anisotropyRotation))}),j4=A(r=>r.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class Et extends ${static get type(){return"IndexNode"}constructor(t){super("uint"),this.scope=t,this.isIndexNode=!0}generate(t){const e=this.getNodeType(t),i=this.scope;let s,n;if(i===Et.VERTEX)s=t.getVertexIndex();else if(i===Et.INSTANCE)s=t.getInstanceIndex();else if(i===Et.DRAW)s=t.getDrawIndex();else if(i===Et.INVOCATION_LOCAL)s=t.getInvocationLocalIndex();else if(i===Et.INVOCATION_SUBGROUP)s=t.getInvocationSubgroupIndex();else{if(i!==Et.SUBGROUP)throw new Error("THREE.IndexNode: Unknown scope: "+i);s=t.getSubgroupIndex()}return t.shaderStage==="vertex"||t.shaderStage==="compute"?n=s:n=pn(this).build(t,e),n}}Et.VERTEX="vertex",Et.INSTANCE="instance",Et.SUBGROUP="subgroup",Et.INVOCATION_LOCAL="invocationLocal",Et.INVOCATION_SUBGROUP="invocationSubgroup",Et.DRAW="draw";const G4=U(Et,Et.VERTEX),ph=U(Et,Et.INSTANCE);U(Et,Et.SUBGROUP),U(Et,Et.INVOCATION_SUBGROUP),U(Et,Et.INVOCATION_LOCAL);const Y4=U(Et,Et.DRAW);class Lm extends ${static get type(){return"InstanceNode"}constructor(t,e,i=null){super("void"),this.count=t,this.instanceMatrix=e,this.instanceColor=i,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=Tt.FRAME,this.buffer=null,this.bufferColor=null}setup(t){const{instanceMatrix:e,instanceColor:i}=this,{count:s}=e;let{instanceMatrixNode:n,instanceColorNode:a}=this;if(n===null){if(s<=1e3)n=rc(e.array,"mat4",Math.max(s,1)).element(ph);else{const h=new kx(e.array,16,1);this.buffer=h;const l=e.usage===35048?nm:nc,u=[l(h,"vec4",16,0),l(h,"vec4",16,4),l(h,"vec4",16,8),l(h,"vec4",16,12)];n=or(...u)}this.instanceMatrixNode=n}if(i&&a===null){const h=new ma(i.array,3),l=i.usage===35048?nm:nc;this.bufferColor=h,a=R(l(h,"vec3",3,0)),this.instanceColorNode=a}const o=n.mul(se).xyz;if(se.assign(o),t.hasGeometryAttribute("normal")){const h=x4(Ze,n);Ze.assign(h)}this.instanceColorNode!==null&&nh("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.buffer!==null&&(this.buffer.clearUpdateRanges(),this.buffer.updateRanges.push(...this.instanceMatrix.updateRanges),this.instanceMatrix.usage!==35048&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version)),this.instanceColor&&this.bufferColor!==null&&(this.bufferColor.clearUpdateRanges(),this.bufferColor.updateRanges.push(...this.instanceColor.updateRanges),this.instanceColor.usage!==35048&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version))}}Z(Lm).setParameterLength(2,3);class Z4 extends Lm{static get type(){return"InstancedMeshNode"}constructor(t){const{count:e,instanceMatrix:i,instanceColor:s}=t;super(e,i,s),this.instancedMesh=t}}const J4=Z(Z4).setParameterLength(1);class Q4 extends ${static get type(){return"BatchNode"}constructor(t){super("void"),this.batchMesh=t,this.batchingIdNode=null}setup(t){this.batchingIdNode===null&&(t.getDrawIndex()===null?this.batchingIdNode=ph:this.batchingIdNode=Y4);const e=A(([m])=>{const f=w(gn(Dt(this.batchMesh._indirectTexture),0).x),g=w(m).mod(f),y=w(m).div(f);return Dt(this.batchMesh._indirectTexture,ee(g,y)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]}),i=e(w(this.batchingIdNode)),s=this.batchMesh._matricesTexture,n=w(gn(Dt(s),0).x),a=b(i).mul(4).toInt().toVar(),o=a.mod(n),h=a.div(n),l=or(Dt(s,ee(o,h)),Dt(s,ee(o.add(1),h)),Dt(s,ee(o.add(2),h)),Dt(s,ee(o.add(3),h))),u=this.batchMesh._colorsTexture;if(u!==null){const m=A(([g])=>{const y=w(gn(Dt(u),0).x),x=g,_=x.mod(y),M=x.div(y);return Dt(u,ee(_,M)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]}),f=m(i);nh("vec3","vBatchColor").assign(f)}const c=Be(l);se.assign(l.mul(se));const d=Ze.div(R(c[0].dot(c[0]),c[1].dot(c[1]),c[2].dot(c[2]))),p=c.mul(d).xyz;Ze.assign(p),t.hasGeometryAttribute("tangent")&&ch.mulAssign(c)}}const K4=Z(Q4).setParameterLength(1);class t5 extends rr{static get type(){return"StorageArrayElementNode"}constructor(t,e){super(t,e),this.isStorageArrayElementNode=!0}set storageBufferNode(t){this.node=t}get storageBufferNode(){return this.node}getMemberType(t,e){const i=this.storageBufferNode.structTypeNode;return i?i.getMemberType(t,e):"void"}setup(t){return t.isAvailable("storageBuffer")===!1&&this.node.isPBO===!0&&t.setupPBO(this.node),super.setup(t)}generate(t,e){let i;const s=t.context.assign;if(i=t.isAvailable("storageBuffer")===!1?this.node.isPBO!==!0||s===!0||!this.node.value.isInstancedBufferAttribute&&t.shaderStage==="compute"?this.node.build(t):t.generatePBO(this):super.generate(t),s!==!0){const n=this.getNodeType(t);i=t.format(i,n,e)}return i}}Z(t5).setParameterLength(2);const Pm=new WeakMap;class e5 extends ${static get type(){return"SkinningNode"}constructor(t){super("void"),this.skinnedMesh=t,this.updateType=Tt.OBJECT,this.skinIndexNode=mn("skinIndex","uvec4"),this.skinWeightNode=mn("skinWeight","vec4"),this.bindMatrixNode=Je("bindMatrix","mat4"),this.bindMatrixInverseNode=Je("bindMatrixInverse","mat4"),this.boneMatricesNode=_m("skeleton.boneMatrices","mat4",t.skeleton.bones.length),this.positionNode=se,this.toPositionNode=se,this.previousBoneMatricesNode=null}getSkinnedPosition(t=this.boneMatricesNode,e=this.positionNode){const{skinIndexNode:i,skinWeightNode:s,bindMatrixNode:n,bindMatrixInverseNode:a}=this,o=t.element(i.x),h=t.element(i.y),l=t.element(i.z),u=t.element(i.w),c=n.mul(e),d=ie(o.mul(s.x).mul(c),h.mul(s.y).mul(c),l.mul(s.z).mul(c),u.mul(s.w).mul(c));return a.mul(d).xyz}getSkinnedNormal(t=this.boneMatricesNode,e=Ze){const{skinIndexNode:i,skinWeightNode:s,bindMatrixNode:n,bindMatrixInverseNode:a}=this,o=t.element(i.x),h=t.element(i.y),l=t.element(i.z),u=t.element(i.w);let c=ie(s.x.mul(o),s.y.mul(h),s.z.mul(l),s.w.mul(u));return c=a.mul(c).mul(n),c.transformDirection(e).xyz}getPreviousSkinnedPosition(t){const e=t.object;return this.previousBoneMatricesNode===null&&(e.skeleton.previousBoneMatrices=new Float32Array(e.skeleton.boneMatrices),this.previousBoneMatricesNode=_m("skeleton.previousBoneMatrices","mat4",e.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,hc)}needsPreviousBoneMatrices(t){const e=t.renderer.getMRT();return e&&e.has("velocity")||Hx(t.object).useVelocity===!0}setup(t){this.needsPreviousBoneMatrices(t)&&hc.assign(this.getPreviousSkinnedPosition(t));const e=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(e),t.hasGeometryAttribute("normal")){const i=this.getSkinnedNormal();Ze.assign(i),t.hasGeometryAttribute("tangent")&&ch.assign(i)}return e}generate(t,e){if(e!=="void")return super.generate(t,e)}update(t){const e=t.object&&t.object.skeleton?t.object.skeleton:this.skinnedMesh.skeleton;Pm.get(e)!==t.frameId&&(Pm.set(e,t.frameId),this.previousBoneMatricesNode!==null&&e.previousBoneMatrices.set(e.boneMatrices),e.update())}}const i5=r=>V(new e5(r));class s5 extends ${static get type(){return"LoopNode"}constructor(t=[]){super(),this.params=t}getVarName(t){return String.fromCharCode(105+t)}getProperties(t){const e=t.getNodeProperties(this);if(e.stackNode!==void 0)return e;const i={};for(let a=0,o=this.params.length-1;a<o;a++){const h=this.params[a],l=h.isNode!==!0&&h.name||this.getVarName(a),u=h.isNode!==!0&&h.type||"int";i[l]=hr(l,u)}const s=t.addStack();e.returnsNode=this.params[this.params.length-1](i,t),e.stackNode=s;const n=this.params[0];return n.isNode!==!0&&typeof n.update=="function"&&(e.updateNode=A(this.params[0].update)(i)),t.removeStack(),e}getNodeType(t){const{returnsNode:e}=this.getProperties(t);return e?e.getNodeType(t):"void"}setup(t){this.getProperties(t)}generate(t){const e=this.getProperties(t),i=this.params,s=e.stackNode;for(let o=0,h=i.length-1;o<h;o++){const l=i[o];let u,c=!1,d=null,p=null,m=null,f=null,g=null,y=null;if(l.isNode?l.getNodeType(t)==="bool"?(c=!0,f="bool",p=l.build(t,f)):(f="int",m=this.getVarName(o),d="0",p=l.build(t,f),g="<"):(f=l.type||"int",m=l.name||this.getVarName(o),d=l.start,p=l.end,g=l.condition,y=l.update,typeof d=="number"?d=t.generateConst(f,d):d&&d.isNode&&(d=d.build(t,f)),typeof p=="number"?p=t.generateConst(f,p):p&&p.isNode&&(p=p.build(t,f)),d!==void 0&&p===void 0?(d+=" - 1",p="0",g=">="):p!==void 0&&d===void 0&&(d="0",g="<"),g===void 0&&(g=Number(d)>Number(p)?">=":"<")),c)u=`while ( ${p} )`;else{const x={start:d,end:p},_=x.start,M=x.end;let v;const N=()=>g.includes("<")?"+=":"-=";if(y!=null)switch(typeof y){case"function":v=t.flowStagesNode(e.updateNode,"void").code.replace(/\t|;/g,"");break;case"number":v=m+" "+N()+" "+t.generateConst(f,y);break;case"string":v=m+" "+y;break;default:y.isNode?v=m+" "+N()+" "+y.build(t):(et("TSL: 'Loop( { update: ... } )' is not a function, string or number."),v="break /* invalid update */")}else y=f==="int"||f==="uint"?g.includes("<")?"++":"--":N()+" 1.",v=m+" "+y;u=`for ( ${t.getVar(f,m)+" = "+_}; ${m+" "+g+" "+M}; ${v} )`}t.addFlowCode((o===0?`
`:"")+t.tab+u+` {

`).addFlowTab()}const n=s.build(t,"void"),a=e.returnsNode?e.returnsNode.build(t):"";t.removeFlowTab().addFlowCode(`
`+t.tab+n);for(let o=0,h=this.params.length-1;o<h;o++)t.addFlowCode((o===0?"":t.tab)+`}

`).removeFlowTab();return t.addFlowTab(),a}}const vt=(...r)=>V(new s5(ar(r,"int"))).toStack(),n5=()=>hr("break").toStack(),gc=new WeakMap,Oe=new wt,Bm=A(({bufferMap:r,influence:t,stride:e,width:i,depth:s,offset:n})=>{const a=w(G4).mul(e).add(n),o=a.div(i),h=a.sub(o.mul(i));return Dt(r,ee(h,o)).depth(s).xyz.mul(t)});class r5 extends ${static get type(){return"MorphNode"}constructor(t){super("void"),this.mesh=t,this.morphBaseInfluence=K(1),this.updateType=Tt.OBJECT}setup(t){const{geometry:e}=t,i=e.morphAttributes.position!==void 0,s=e.hasAttribute("normal")&&e.morphAttributes.normal!==void 0,n=e.morphAttributes.position||e.morphAttributes.normal||e.morphAttributes.color,a=n!==void 0?n.length:0,{texture:o,stride:h,size:l}=(function(c){const d=c.morphAttributes.position!==void 0,p=c.morphAttributes.normal!==void 0,m=c.morphAttributes.color!==void 0,f=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,g=f!==void 0?f.length:0;let y=gc.get(c);if(y===void 0||y.count!==g){let q=function(){F.dispose(),gc.delete(c),c.removeEventListener("dispose",q)};y!==void 0&&y.texture.dispose();const x=c.morphAttributes.position||[],_=c.morphAttributes.normal||[],M=c.morphAttributes.color||[];let v=0;d===!0&&(v=1),p===!0&&(v=2),m===!0&&(v=3);let N=c.attributes.position.count*v,T=1;const C=4096;N>C&&(T=Math.ceil(N/C),N=C);const P=new Float32Array(N*T*4*g),F=new zy(P,N,T,g);F.type=1015,F.needsUpdate=!0;const D=4*v;for(let X=0;X<g;X++){const it=x[X],mt=_[X],xt=M[X],Q=N*T*4*X;for(let gt=0;gt<it.count;gt++){const st=gt*D;d===!0&&(Oe.fromBufferAttribute(it,gt),P[Q+st+0]=Oe.x,P[Q+st+1]=Oe.y,P[Q+st+2]=Oe.z,P[Q+st+3]=0),p===!0&&(Oe.fromBufferAttribute(mt,gt),P[Q+st+4]=Oe.x,P[Q+st+5]=Oe.y,P[Q+st+6]=Oe.z,P[Q+st+7]=0),m===!0&&(Oe.fromBufferAttribute(xt,gt),P[Q+st+8]=Oe.x,P[Q+st+9]=Oe.y,P[Q+st+10]=Oe.z,P[Q+st+11]=xt.itemSize===4?Oe.w:1)}}y={count:g,texture:F,stride:v,size:new nt(N,T)},gc.set(c,y),c.addEventListener("dispose",q)}return y})(e);i===!0&&se.mulAssign(this.morphBaseInfluence),s===!0&&Ze.mulAssign(this.morphBaseInfluence);const u=w(l.width);vt(a,({i:c})=>{const d=b(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?d.assign(Dt(this.mesh.morphTexture,ee(w(c).add(1),w(ph))).r):d.assign(Je("morphTargetInfluences","float").element(c).toVar()),Y(d.notEqual(0),()=>{i===!0&&se.addAssign(Bm({bufferMap:o,influence:d,stride:h,width:u,depth:c,offset:w(0)})),s===!0&&Ze.addAssign(Bm({bufferMap:o,influence:d,stride:h,width:u,depth:c,offset:w(1)}))})})}update(){const t=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?t.value=1:t.value=1-this.mesh.morphTargetInfluences.reduce((e,i)=>e+i,0)}}const a5=Z(r5).setParameterLength(1);class Om extends ${static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class o5 extends Om{static get type(){return"AONode"}constructor(t=null){super(),this.aoNode=t}setup(t){t.context.ambientOcclusion.mulAssign(this.aoNode)}}class h5 extends tm{static get type(){return"LightingContextNode"}constructor(t,e=null,i=null,s=null){super(t),this.lightingModel=e,this.backdropNode=i,this.backdropAlphaNode=s,this._value=null}getContext(){const{backdropNode:t,backdropAlphaNode:e}=this,i={directDiffuse:R().toVar("directDiffuse"),directSpecular:R().toVar("directSpecular"),indirectDiffuse:R().toVar("indirectDiffuse"),indirectSpecular:R().toVar("indirectSpecular")};return{radiance:R().toVar("radiance"),irradiance:R().toVar("irradiance"),iblIrradiance:R().toVar("iblIrradiance"),ambientOcclusion:b(1).toVar("ambientOcclusion"),reflectedLight:i,backdrop:t,backdropAlpha:e}}setup(t){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||t.context.lightingModel,super.setup(t)}}const l5=Z(h5);class u5 extends Om{static get type(){return"IrradianceNode"}constructor(t){super(),this.node=t}setup(t){t.context.irradiance.addAssign(this.node)}}const cr=new nt;class mh extends lr{static get type(){return"ViewportTextureNode"}constructor(t=Pa,e=null,i=null){let s=null;i===null?(s=new dp,s.minFilter=1008,i=s):s=i,super(i,t,e),this.generateMipmaps=!1,this.defaultFramebuffer=s,this.isOutputTextureNode=!0,this.updateBeforeType=Tt.FRAME,this._cacheTextures=new WeakMap}getTextureForReference(t=null){let e,i;if(this.referenceNode?(e=this.referenceNode.defaultFramebuffer,i=this.referenceNode._cacheTextures):(e=this.defaultFramebuffer,i=this._cacheTextures),t===null)return e;if(i.has(t)===!1){const s=e.clone();i.set(t,s)}return i.get(t)}updateReference(t){const e=t.renderer.getRenderTarget();return this.value=this.getTextureForReference(e),this.value}updateBefore(t){const e=t.renderer,i=e.getRenderTarget();i===null?e.getDrawingBufferSize(cr):cr.set(i.width,i.height);const s=this.getTextureForReference(i);s.image.width===cr.width&&s.image.height===cr.height||(s.image.width=cr.width,s.image.height=cr.height,s.needsUpdate=!0);const n=s.generateMipmaps;s.generateMipmaps=this.generateMipmaps,e.copyFramebufferToTexture(s),s.generateMipmaps=n}clone(){const t=new this.constructor(this.uvNode,this.levelNode,this.value);return t.generateMipmaps=this.generateMipmaps,t}}Z(mh).setParameterLength(0,3);const Vm=Z(mh,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let fh=null;class c5 extends mh{static get type(){return"ViewportDepthTextureNode"}constructor(t=Pa,e=null){fh===null&&(fh=new Eu),super(t,e,fh)}getTextureForReference(){return fh}}const Fm=Z(c5).setParameterLength(0,2);class Re extends ${static get type(){return"ViewportDepthNode"}constructor(t,e=null){super("float"),this.scope=t,this.valueNode=e,this.isViewportDepthNode=!0}generate(t){const{scope:e}=this;return e===Re.DEPTH_BASE?t.getFragDepth():super.generate(t)}setup({camera:t}){const{scope:e}=this,i=this.valueNode;let s=null;if(e===Re.DEPTH_BASE)i!==null&&(s=Dm().assign(i));else if(e===Re.DEPTH)s=t.isPerspectiveCamera?d5(ne.z,bn,Mn):Oa(ne.z,bn,Mn);else if(e===Re.LINEAR_DEPTH)if(i!==null)if(t.isPerspectiveCamera){const n=km(i,bn,Mn);s=Oa(n,bn,Mn)}else s=i;else s=Oa(ne.z,bn,Mn);return s}}Re.DEPTH_BASE="depthBase",Re.DEPTH="depth",Re.LINEAR_DEPTH="linearDepth";const Oa=(r,t,e)=>r.add(t).div(t.sub(e)),d5=(r,t,e)=>t.add(r).mul(e).div(e.sub(t).mul(r)),km=(r,t,e)=>t.mul(e).div(e.sub(t).mul(r).sub(e)),p5=(r,t,e)=>{t=t.max(1e-6).toVar();const i=is(r.negate().div(t)),s=is(e.div(t));return i.div(s)},Dm=Z(Re,Re.DEPTH_BASE),Um=U(Re,Re.DEPTH),yc=Z(Re,Re.LINEAR_DEPTH).setParameterLength(0,1);yc(Fm()),Um.assign=r=>Dm(r);class Qe extends ${static get type(){return"ClippingNode"}constructor(t=Qe.DEFAULT){super(),this.scope=t}setup(t){super.setup(t);const e=t.clippingContext,{intersectionPlanes:i,unionPlanes:s}=e;return this.hardwareClipping=t.material.hardwareClipping,this.scope===Qe.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(i,s):this.scope===Qe.HARDWARE?this.setupHardwareClipping(s,t):this.setupDefault(i,s)}setupAlphaToCoverage(t,e){return A(()=>{const i=b().toVar("distanceToPlane"),s=b().toVar("distanceToGradient"),n=b(1).toVar("clipOpacity"),a=e.length;if(this.hardwareClipping===!1&&a>0){const h=Ne(e).setGroup(pt);vt(a,({i:l})=>{const u=h.element(l);i.assign(ne.dot(u.xyz).negate().add(u.w)),s.assign(i.fwidth().div(2)),n.mulAssign(dn(s.negate(),s,i))})}const o=t.length;if(o>0){const h=Ne(t).setGroup(pt),l=b(1).toVar("intersectionClipOpacity");vt(o,({i:u})=>{const c=h.element(u);i.assign(ne.dot(c.xyz).negate().add(c.w)),s.assign(i.fwidth().div(2)),l.mulAssign(dn(s.negate(),s,i).oneMinus())}),n.mulAssign(l.oneMinus())}gi.a.mulAssign(n),gi.a.equal(0).discard()})()}setupDefault(t,e){return A(()=>{const i=e.length;if(this.hardwareClipping===!1&&i>0){const n=Ne(e).setGroup(pt);vt(i,({i:a})=>{const o=n.element(a);ne.dot(o.xyz).greaterThan(o.w).discard()})}const s=t.length;if(s>0){const n=Ne(t).setGroup(pt),a=fi(!0).toVar("clipped");vt(s,({i:o})=>{const h=n.element(o);a.assign(ne.dot(h.xyz).greaterThan(h.w).and(a))}),a.discard()}})()}setupHardwareClipping(t,e){const i=t.length;return e.enableHardwareClipping(i),A(()=>{const s=Ne(t).setGroup(pt),n=yn(e.getClipDistance());vt(i,({i:a})=>{const o=s.element(a),h=ne.dot(o.xyz).sub(o.w).negate();n.element(a).assign(h)})})()}}Qe.ALPHA_TO_COVERAGE="alphaToCoverage",Qe.DEFAULT="default",Qe.HARDWARE="hardware";const Wm=A(([r])=>Os(tt(1e4,yi(tt(17,r.x).add(tt(.1,r.y)))).mul(ie(.1,Nt(yi(tt(13,r.y).add(r.x))))))),Hm=A(([r])=>Wm(B(Wm(r.xy),r.z))),m5=A(([r])=>{const t=kt(rs(Yp(r.xyz)),rs(Zp(r.xyz))),e=b(1).div(b(.05).mul(t)).toVar("pixScale"),i=B(Ia(ns(is(e))),Ia(Ju(is(e)))),s=B(Hm(ns(i.x.mul(r.xyz))),Hm(ns(i.y.mul(r.xyz)))),n=Os(is(e)),a=ie(tt(n.oneMinus(),s.x),tt(n,s.y)),o=Ge(n,n.oneMinus()),h=R(a.mul(a).div(tt(2,o).mul(yt(1,o))),a.sub(tt(.5,o)).div(yt(1,o)),yt(1,yt(1,a).mul(yt(1,a)).div(tt(2,o).mul(yt(1,o))))),l=a.lessThan(o.oneMinus()).select(a.lessThan(o).select(h.x,h.y),h.z);return xi(l,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class f5 extends om{static get type(){return"VertexColorNode"}constructor(t){super(null,"vec4"),this.isVertexColorNode=!0,this.index=t}getAttributeName(){const t=this.index;return"color"+(t>0?t:"")}generate(t){const e=this.getAttributeName(t);let i;return i=t.hasGeometryAttribute(e)===!0?super.generate(t):t.generateConst(this.nodeType,new wt(1,1,1,1)),i}serialize(t){super.serialize(t),t.index=this.index}deserialize(t){super.deserialize(t),this.index=t.index}}const g5=(r=0)=>V(new f5(r));A(([r,t])=>Ge(1,r.oneMinus().div(t)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),A(([r,t])=>Ge(r.div(t.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),A(([r,t])=>r.oneMinus().mul(t.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),A(([r,t])=>Zt(r.mul(2).mul(t),r.oneMinus().mul(2).mul(t.oneMinus()).oneMinus(),Qu(.5,r))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),A(([r,t])=>{const e=t.a.add(r.a.mul(t.a.oneMinus()));return J(t.rgb.mul(t.a).add(r.rgb.mul(r.a).mul(t.a.oneMinus())).div(e),e)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]});const y5=A(([r])=>J(r.rgb.mul(r.a),r.a),{color:"vec4",return:"vec4"});A(([r])=>(Y(r.a.equal(0),()=>J(0)),J(r.rgb.div(r.a),r.a)),{color:"vec4",return:"vec4"});class qm extends he{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(t){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.maskNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.receivedShadowPositionNode=null,this.castShadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null,Object.defineProperty(this,"shadowPositionNode",{get:()=>this.receivedShadowPositionNode,set:t=>{j('NodeMaterial: ".shadowPositionNode" was renamed to ".receivedShadowPositionNode".'),this.receivedShadowPositionNode=t}})}customProgramCacheKey(){return this.type+Tp(this)}build(t){this.setup(t)}setupObserver(t){return new Ux(t)}setup(t){t.context.setupNormal=()=>ah(this.setupNormal(t),"NORMAL","vec3"),t.context.setupPositionView=()=>this.setupPositionView(t),t.context.setupModelViewProjection=()=>this.setupModelViewProjection(t);const e=t.renderer,i=e.getRenderTarget();t.addStack();const s=ah(this.setupVertex(t),"VERTEX"),n=this.vertexNode||s;let a;t.stack.outputNode=n,this.setupHardwareClipping(t),this.geometryNode!==null&&(t.stack.outputNode=t.stack.outputNode.bypass(this.geometryNode)),t.addFlow("vertex",t.removeStack()),t.addStack();const o=this.setupClipping(t);if(this.depthWrite!==!0&&this.depthTest!==!0||(i!==null?i.depthBuffer===!0&&this.setupDepth(t):e.depth===!0&&this.setupDepth(t)),this.fragmentNode===null){this.setupDiffuseColor(t),this.setupVariants(t);const h=this.setupLighting(t);o!==null&&t.stack.add(o);const l=J(h,gi.a).max(0);a=this.setupOutput(t,l),Ra.assign(a);const u=this.outputNode!==null;if(u&&(a=this.outputNode),i!==null){const c=e.getMRT(),d=this.mrtNode;c!==null?(u&&Ra.assign(a),a=c,d!==null&&(a=c.merge(d))):d!==null&&(a=d)}}else{let h=this.fragmentNode;h.isOutputStructNode!==!0&&(h=J(h)),a=this.setupOutput(t,h)}t.stack.outputNode=a,t.addFlow("fragment",t.removeStack()),t.observer=this.setupObserver(t)}setupClipping(t){if(t.clippingContext===null)return null;const{unionPlanes:e,intersectionPlanes:i}=t.clippingContext;let s=null;if(e.length>0||i.length>0){const n=t.renderer.samples;this.alphaToCoverage&&n>1?s=V(new Qe(Qe.ALPHA_TO_COVERAGE)):t.stack.add(V(new Qe))}return s}setupHardwareClipping(t){if(this.hardwareClipping=!1,t.clippingContext===null)return;const e=t.clippingContext.unionPlanes.length;e>0&&e<=8&&t.isAvailable("clipDistance")&&(t.stack.add(V(new Qe(Qe.HARDWARE))),this.hardwareClipping=!0)}setupDepth(t){const{renderer:e,camera:i}=t;let s=this.depthNode;if(s===null){const n=e.getMRT();n&&n.has("depth")?s=n.get("depth"):e.logarithmicDepthBuffer===!0&&(s=i.isPerspectiveCamera?p5(ne.z,bn,Mn):Oa(ne.z,bn,Mn))}s!==null&&Um.assign(s).toStack()}setupPositionView(){return oc.mul(se).xyz}setupModelViewProjection(){return ac.mul(ne)}setupVertex(t){return t.addStack(),this.setupPosition(t),t.context.vertex=t.removeStack(),j4}setupPosition(t){const{object:e,geometry:i}=t;if((i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color)&&a5(e).toStack(),e.isSkinnedMesh===!0&&i5(e).toStack(),this.displacementMap){const s=_n("displacementMap","texture"),n=_n("displacementScale","float"),a=_n("displacementBias","float");se.addAssign(Ze.normalize().mul(s.x.mul(n).add(a)))}return e.isBatchedMesh&&K4(e).toStack(),e.isInstancedMesh&&e.instanceMatrix&&e.instanceMatrix.isInstancedBufferAttribute===!0&&J4(e).toStack(),this.positionNode!==null&&se.assign(ah(this.positionNode,"POSITION","vec3")),se}setupDiffuseColor({object:t,geometry:e}){this.maskNode!==null&&fi(this.maskNode).not().discard();let i=this.colorNode?J(this.colorNode):U4;this.vertexColors===!0&&e.hasAttribute("color")&&(i=i.mul(g5())),t.instanceColor&&(i=nh("vec3","vInstanceColor").mul(i)),t.isBatchedMesh&&t._colorsTexture&&(i=nh("vec3","vBatchColor").mul(i)),gi.assign(i);const s=this.opacityNode?b(this.opacityNode):H4;gi.a.assign(gi.a.mul(s));let n=null;(this.alphaTestNode!==null||this.alphaTest>0)&&(n=this.alphaTestNode!==null?b(this.alphaTestNode):D4,gi.a.lessThanEqual(n).discard()),this.alphaHash===!0&&gi.a.lessThan(m5(se)).discard(),this.transparent===!1&&this.blending===1&&this.alphaToCoverage===!1?gi.a.assign(1):n===null&&gi.a.lessThanEqual(0).discard()}setupVariants(){}setupOutgoingLight(){return this.lights===!0?R(0):gi.rgb}setupNormal(){return this.normalNode?R(this.normalNode):q4}setupEnvironment(){let t=null;return this.envNode?t=this.envNode:this.envMap&&(t=this.envMap.isCubeTexture?_n("envMap","cubeTexture"):_n("envMap","texture")),t}setupLightMap(t){let e=null;return t.material.lightMap&&(e=new u5($4)),e}setupLights(t){const e=[],i=this.setupEnvironment(t);i&&i.isLightingNode&&e.push(i);const s=this.setupLightMap(t);if(s&&s.isLightingNode&&e.push(s),this.aoNode!==null||t.material.aoMap){const a=this.aoNode!==null?this.aoNode:X4;e.push(new o5(a))}let n=this.lightsNode||t.lightsNode;return e.length>0&&(n=t.renderer.lighting.createNode([...n.getLights(),...e])),n}setupLightingModel(){}setupLighting(t){const{material:e}=t,{backdropNode:i,backdropAlphaNode:s,emissiveNode:n}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(t):null;let o=this.setupOutgoingLight(t);if(a&&a.getScope().hasLights){const h=this.setupLightingModel(t)||null;o=l5(a,h,i,s)}else i!==null&&(o=R(s!==null?Zt(o,i,s):i));return(n&&n.isNode===!0||e.emissive&&e.emissive.isColor===!0)&&(kp.assign(R(n||W4)),o=o.add(kp)),o}setupFog(t,e){const i=t.fogNode;return i&&(Ra.assign(e),e=J(i.toVar())),e}setupPremultipliedAlpha(t,e){return y5(e)}setupOutput(t,e){return this.fog===!0&&(e=this.setupFog(t,e)),this.premultipliedAlpha===!0&&(e=this.setupPremultipliedAlpha(t,e)),e}setDefaultValues(t){for(const i in t){const s=t[i];this[i]===void 0&&(this[i]=s,s&&s.clone&&(this[i]=s.clone()))}const e=Object.getOwnPropertyDescriptors(t.constructor.prototype);for(const i in e)Object.getOwnPropertyDescriptor(this.constructor.prototype,i)===void 0&&e[i].get!==void 0&&Object.defineProperty(this.constructor.prototype,i,e[i])}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{},nodes:{}});const i=he.prototype.toJSON.call(this,t),s=Jo(this);i.inputNodes={};for(const{property:a,childNode:o}of s)i.inputNodes[a]=o.toJSON(t).uuid;function n(a){const o=[];for(const h in a){const l=a[h];delete l.metadata,o.push(l)}return o}if(e){const a=n(t.textures),o=n(t.images),h=n(t.nodes);a.length>0&&(i.textures=a),o.length>0&&(i.images=o),h.length>0&&(i.nodes=h)}return i}copy(t){return this.lightsNode=t.lightsNode,this.envNode=t.envNode,this.colorNode=t.colorNode,this.normalNode=t.normalNode,this.opacityNode=t.opacityNode,this.backdropNode=t.backdropNode,this.backdropAlphaNode=t.backdropAlphaNode,this.alphaTestNode=t.alphaTestNode,this.maskNode=t.maskNode,this.positionNode=t.positionNode,this.geometryNode=t.geometryNode,this.depthNode=t.depthNode,this.receivedShadowPositionNode=t.receivedShadowPositionNode,this.castShadowPositionNode=t.castShadowPositionNode,this.receivedShadowNode=t.receivedShadowNode,this.castShadowNode=t.castShadowNode,this.outputNode=t.outputNode,this.mrtNode=t.mrtNode,this.fragmentNode=t.fragmentNode,this.vertexNode=t.vertexNode,super.copy(t)}}new Uo,new pp;let gh=null;class x5 extends mh{static get type(){return"ViewportSharedTextureNode"}constructor(t=Pa,e=null){gh===null&&(gh=new dp),super(t,e,gh)}getTextureForReference(){return gh}updateReference(){return this}}Z(x5).setParameterLength(0,2),new pp,new ux;const $m=A(([r=mm])=>{const t=r.z.atan(r.x).mul(1/(2*Math.PI)).add(.5),e=r.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return B(t,e)});class b5 extends Gy{constructor(t=1,e={}){super(t,e),this.isCubeRenderTarget=!0}fromEquirectangularTexture(t,e){const i=e.minFilter,s=e.generateMipmaps;e.generateMipmaps=!0,this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n=new da(5,5,5),a=$m(mm),o=new qm;o.colorNode=Bt(e,a,0),o.side=1,o.blending=0;const h=new di(n,o),l=new Mu;l.add(h),e.minFilter===1008&&(e.minFilter=1006);const u=new Y0(1,10,this),c=t.getMRT();return t.setMRT(null),u.update(t,l),t.setMRT(c),e.minFilter=i,e.currentGenerateMipmaps=s,h.geometry.dispose(),h.material.dispose(),this}}const Va=new WeakMap;class M5 extends Ft{static get type(){return"CubeMapNode"}constructor(t){super("vec3"),this.envNode=t,this._cubeTexture=null,this._cubeTextureNode=uc(null);const e=new xu;e.isRenderTargetTexture=!0,this._defaultTexture=e,this.updateBeforeType=Tt.RENDER}updateBefore(t){const{renderer:e,material:i}=t,s=this.envNode;if(s.isTextureNode||s.isMaterialReferenceNode){const n=s.isTextureNode?s.value:i[s.property];if(n&&n.isTexture){const a=n.mapping;if(a===303||a===304){if(Va.has(n)){const o=Va.get(n);jm(o,n.mapping),this._cubeTexture=o}else{const o=n.image;if((function(h){return h!=null&&h.height>0})(o)){const h=new b5(o.height);h.fromEquirectangularTexture(e,n),jm(h.texture,n.mapping),this._cubeTexture=h.texture,Va.set(n,h.texture),n.addEventListener("dispose",Xm)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(t){return this.updateBefore(t),this._cubeTextureNode}}function Xm(r){const t=r.target;t.removeEventListener("dispose",Xm);const e=Va.get(t);e!==void 0&&(Va.delete(t),e.dispose())}function jm(r,t){t===303?r.mapping=301:t===304&&(r.mapping=302)}Z(M5).setParameterLength(1),new Rs;const yh=A(({f0:r,f90:t,dotVH:e})=>{const i=e.mul(-5.55473).sub(6.98316).mul(e).exp2();return r.mul(i.oneMinus()).add(t.mul(i))});A(r=>r.diffuseColor.mul(1/Math.PI));const _5=A(({dotNH:r})=>Up.mul(b(.5)).add(1).mul(b(1/Math.PI)).mul(r.pow(Up)));A(({lightDirection:r})=>{const t=r.add(pe).normalize(),e=$t.dot(t).clamp(),i=pe.dot(t).clamp(),s=yh({f0:w2,f90:1,dotVH:i}),n=b(.25),a=_5({dotNH:e});return s.mul(n).mul(a)}),new cx,new hx;const v5=A(r=>{if(r.geometry.hasAttribute("normal")===!1)return b(0);const t=uh.dFdx().abs().max(uh.dFdy().abs());return t.x.max(t.y).max(t.z)});A(r=>{const{roughness:t}=r,e=v5();let i=t.max(.0525);return i=i.add(e),i=i.min(1),i});const w5=A(({alpha:r,dotNL:t,dotNV:e})=>{const i=r.pow2(),s=t.mul(i.add(i.oneMinus().mul(e.pow2())).sqrt()),n=e.mul(i.add(i.oneMinus().mul(t.pow2())).sqrt());return es(.5,s.add(n).max(Y2))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),T5=A(({alphaT:r,alphaB:t,dotTV:e,dotBV:i,dotTL:s,dotBL:n,dotNV:a,dotNL:o})=>{const h=o.mul(R(r.mul(e),t.mul(i),a).length()),l=a.mul(R(r.mul(s),t.mul(n),o).length());return es(.5,h.add(l)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),S5=A(({alpha:r,dotNH:t})=>{const e=r.pow2(),i=t.pow2().mul(e.oneMinus()).oneMinus();return e.div(i.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),A5=b(1/Math.PI),N5=A(({alphaT:r,alphaB:t,dotNH:e,dotTH:i,dotBH:s})=>{const n=r.mul(t),a=R(t.mul(i),r.mul(s),n.mul(e)),o=a.dot(a),h=n.div(o);return A5.mul(n.mul(h.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]});A(({lightDirection:r,f0:t,f90:e,roughness:i,f:s,normalView:n=$t,USE_IRIDESCENCE:a,USE_ANISOTROPY:o})=>{const h=i.pow2(),l=r.add(pe).normalize(),u=n.dot(r).clamp(),c=n.dot(pe).clamp(),d=n.dot(l).clamp(),p=pe.dot(l).clamp();let m,f,g=yh({f0:t,f90:e,dotVH:p});if(ih(a)&&(g=_2.mix(g,s)),ih(o)){const y=Gu.dot(r),x=Gu.dot(pe),_=Gu.dot(l),M=Na.dot(r),v=Na.dot(pe),N=Na.dot(l);m=T5({alphaT:Dp,alphaB:h,dotTV:x,dotBV:v,dotTL:y,dotBL:M,dotNV:c,dotNL:u}),f=N5({alphaT:Dp,alphaB:h,dotNH:d,dotTH:_,dotBH:N})}else m=w5({alpha:h,dotNL:u,dotNV:c}),f=S5({alpha:h,dotNH:d});return g.mul(m).mul(f)});const R5=A(({roughness:r,dotNV:t})=>{const e=J(-1,-.0275,-.572,.022),i=J(1,.0425,1.04,-.04),s=r.mul(e).add(i),n=s.x.mul(s.x).min(t.mul(-9.28).exp2()).mul(s.x).add(s.y);return B(-1.04,1.04).mul(n).add(s.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),E5=A(r=>{const{dotNV:t,specularColor:e,specularF90:i,roughness:s}=r,n=R5({dotNV:t,roughness:s});return e.mul(n.x).add(i.mul(n.y))});A(({f:r,f90:t,dotVH:e})=>{const i=e.oneMinus().saturate(),s=i.mul(i),n=i.mul(s,s).clamp(0,.9999);return r.sub(R(t).mul(n)).div(n.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]});const I5=A(({roughness:r,dotNH:t})=>{const e=r.pow2(),i=b(1).div(e),s=t.pow2().oneMinus().max(.0078125);return b(2).add(i).mul(s.pow(i.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),C5=A(({dotNV:r,dotNL:t})=>b(1).div(b(4).mul(t.add(r).sub(t.mul(r))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]});A(({lightDirection:r})=>{const t=r.add(pe).normalize(),e=$t.dot(r).clamp(),i=$t.dot(pe).clamp(),s=$t.dot(t).clamp(),n=I5({roughness:M2,dotNH:s}),a=C5({dotNV:i,dotNL:e});return b2.mul(n).mul(a)}),A(({N:r,V:t,roughness:e})=>{const i=r.dot(t).saturate(),s=B(e,i.oneMinus().sqrt());return s.assign(s.mul(.984375).add(.0078125)),s}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]});const Gm=A(({f:r})=>{const t=r.length();return kt(t.mul(t).add(r.z).div(t.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),Ds=A(({v1:r,v2:t})=>{const e=r.dot(t),i=e.abs().toVar(),s=i.mul(.0145206).add(.4965155).mul(i).add(.8543985).toVar(),n=i.add(4.1616724).mul(i).add(3.417594).toVar(),a=s.div(n),o=e.greaterThan(0).select(a,kt(e.mul(e).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(a));return r.cross(t).mul(o)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]});A(({N:r,V:t,P:e,mInv:i,p0:s,p1:n,p2:a,p3:o})=>{const h=n.sub(s).toVar(),l=o.sub(s).toVar(),u=h.cross(l),c=R().toVar();return Y(u.dot(e.sub(s)).greaterThanEqual(0),()=>{const d=t.sub(r.mul(t.dot(r))).normalize(),p=r.cross(d).negate(),m=i.mul(Be(d,p,r).transpose()).toVar(),f=m.mul(s.sub(e)).normalize().toVar(),g=m.mul(n.sub(e)).normalize().toVar(),y=m.mul(a.sub(e)).normalize().toVar(),x=m.mul(o.sub(e)).normalize().toVar(),_=R(0).toVar();_.addAssign(Ds({v1:f,v2:g})),_.addAssign(Ds({v1:g,v2:y})),_.addAssign(Ds({v1:y,v2:x})),_.addAssign(Ds({v1:x,v2:f})),c.assign(R(Gm({f:_})))}),c}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),A(({P:r,p0:t,p1:e,p2:i,p3:s})=>{const n=e.sub(t).toVar(),a=s.sub(t).toVar(),o=n.cross(a),h=R().toVar();return Y(o.dot(r.sub(t)).greaterThanEqual(0),()=>{const l=t.sub(r).normalize().toVar(),u=e.sub(r).normalize().toVar(),c=i.sub(r).normalize().toVar(),d=s.sub(r).normalize().toVar(),p=R(0).toVar();p.addAssign(Ds({v1:l,v2:u})),p.addAssign(Ds({v1:u,v2:c})),p.addAssign(Ds({v1:c,v2:d})),p.addAssign(Ds({v1:d,v2:l})),h.assign(R(Gm({f:p.abs()})))}),h}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"P",type:"vec3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]});const xh=1/6,Ym=r=>tt(xh,tt(r,tt(r,r.negate().add(3)).sub(3)).add(1)),xc=r=>tt(xh,tt(r,tt(r,tt(3,r).sub(6))).add(4)),Zm=r=>tt(xh,tt(r,tt(r,tt(-3,r).add(3)).add(3)).add(1)),bc=r=>tt(xh,Ca(r,3)),Jm=r=>Ym(r).add(xc(r)),Qm=r=>Zm(r).add(bc(r)),Km=r=>ie(-1,xc(r).div(Ym(r).add(xc(r)))),tf=r=>ie(1,bc(r).div(Zm(r).add(bc(r)))),ef=(r,t,e)=>{const i=r.uvNode,s=tt(i,t.zw).add(.5),n=ns(s),a=Os(s),o=Jm(a.x),h=Qm(a.x),l=Km(a.x),u=tf(a.x),c=Km(a.y),d=tf(a.y),p=B(n.x.add(l),n.y.add(c)).sub(.5).mul(t.xy),m=B(n.x.add(u),n.y.add(c)).sub(.5).mul(t.xy),f=B(n.x.add(l),n.y.add(d)).sub(.5).mul(t.xy),g=B(n.x.add(u),n.y.add(d)).sub(.5).mul(t.xy),y=Jm(a.y).mul(ie(o.mul(r.sample(p).level(e)),h.mul(r.sample(m).level(e)))),x=Qm(a.y).mul(ie(o.mul(r.sample(f).level(e)),h.mul(r.sample(g).level(e))));return y.add(x)},sf=A(([r,t])=>{const e=B(r.size(w(t))),i=B(r.size(w(t.add(1)))),s=es(1,e),n=es(1,i),a=ef(r,J(s,e),ns(t)),o=ef(r,J(n,i),Ju(t));return Os(t).mix(a,o)});A(([r,t])=>{const e=t.mul(hm(r));return sf(r,e)});const nf=A(([r,t,e,i,s])=>{const n=R(Kp(t.negate(),un(r),es(1,i))),a=R(rs(s[0].xyz),rs(s[1].xyz),rs(s[2].xyz));return un(n).mul(e.mul(a))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),z5=A(([r,t])=>r.mul(xi(t.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),L5=Vm(),P5=Vm(),rf=A(([r,t,e],{material:i})=>{const s=(i.side===1?L5:P5).sample(r),n=is(ur.x).mul(z5(t,e));return sf(s,n)}),af=A(([r,t,e])=>(Y(e.notEqual(0),()=>{const i=jp(t).negate().div(e);return Xp(i.negate().mul(r))}),R(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]});A(([r,t,e,i,s,n,a,o,h,l,u,c,d,p,m])=>{let f,g;if(m){f=J().toVar(),g=R().toVar();const v=u.sub(1).mul(m.mul(.025)),N=R(u.sub(v),u,u.add(v));vt({start:0,end:3},({i:T})=>{const C=N.element(T),P=nf(r,t,c,C,o),F=a.add(P),D=l.mul(h.mul(J(F,1))),q=B(D.xy.div(D.w)).toVar();q.addAssign(1),q.divAssign(2),q.assign(B(q.x,q.y.oneMinus()));const X=rf(q,e,C);f.element(T).assign(X.element(T)),f.a.addAssign(X.a),g.element(T).assign(i.element(T).mul(af(rs(P),d,p).element(T)))}),f.a.divAssign(3)}else{const v=nf(r,t,c,u,o),N=a.add(v),T=l.mul(h.mul(J(N,1))),C=B(T.xy.div(T.w)).toVar();C.addAssign(1),C.divAssign(2),C.assign(B(C.x,C.y.oneMinus())),f=rf(C,e,u),g=i.mul(af(rs(v),d,p))}const y=g.rgb.mul(f.rgb),x=r.dot(t).clamp(),_=R(E5({dotNV:x,specularColor:s,specularF90:n,roughness:e})),M=g.r.add(g.g,g.b).div(3);return J(_.oneMinus().mul(y),f.a.oneMinus().mul(M).oneMinus())});const B5=Be(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),of=(r,t)=>r.sub(t).div(r.add(t)).pow2();A(({outsideIOR:r,eta2:t,cosTheta1:e,thinFilmThickness:i,baseF0:s})=>{const n=Zt(r,t,dn(0,.03,i)),a=r.div(n).pow2().mul(e.pow2().oneMinus()).oneMinus();Y(a.lessThan(0),()=>R(1));const o=a.sqrt(),h=of(n,r),l=yh({f0:h,f90:1,dotVH:e}),u=l.oneMinus(),c=n.lessThan(r).select(Math.PI,0),d=b(Math.PI).sub(c),p=(C=>{const P=C.sqrt();return R(1).add(P).div(R(1).sub(P))})(s.clamp(0,.9999)),m=of(p,n.toVec3()),f=yh({f0:m,f90:1,dotVH:o}),g=R(p.x.lessThan(n).select(Math.PI,0),p.y.lessThan(n).select(Math.PI,0),p.z.lessThan(n).select(Math.PI,0)),y=n.mul(i,o,2),x=R(d).add(g),_=l.mul(f).clamp(1e-5,.9999),M=_.sqrt(),v=u.pow2().mul(f).div(R(1).sub(_)),N=l.add(v).toVar(),T=v.sub(u).toVar();return vt({start:1,end:2,condition:"<=",name:"m"},({m:C})=>{T.mulAssign(M);const P=((F,D)=>{const q=F.mul(2*Math.PI*1e-9),X=R(54856e-17,44201e-17,52481e-17),it=R(1681e3,1795300,2208400),mt=R(43278e5,93046e5,66121e5),xt=b(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(q.mul(2239900).add(D.x).cos()).mul(q.pow2().mul(-45282e5).exp());let Q=X.mul(mt.mul(2*Math.PI).sqrt()).mul(it.mul(q).add(D).cos()).mul(q.pow2().negate().mul(mt).exp());return Q=R(Q.x.add(xt),Q.y,Q.z).div(10685e-11),B5.mul(Q)})(b(C).mul(y),b(C).mul(x)).mul(2);N.addAssign(T.mul(P))}),N.max(R(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),A(({normal:r,viewDir:t,roughness:e})=>{const i=r.dot(t).saturate(),s=e.pow2(),n=le(e.lessThan(.25),b(-339.2).mul(s).add(b(161.4).mul(e)).sub(25.9),b(-8.48).mul(s).add(b(14.3).mul(e)).sub(9.95)),a=le(e.lessThan(.25),b(44).mul(s).sub(b(23.7).mul(e)).add(3.26),b(1.97).mul(s).sub(b(3.27).mul(e)).add(.72));return le(e.lessThan(.25),0,b(.1).mul(e).sub(.025)).add(n.mul(i).add(a).exp()).mul(1/Math.PI).saturate()}),R(.04),b(1);const hf=b(1),Mc=b(-2),bh=b(.8),_c=b(-1),Mh=b(.4),vc=b(2),_h=b(.305),wc=b(3),lf=b(.21),O5=b(4),uf=b(4),V5=b(16),F5=A(([r])=>{const t=R(Nt(r)).toVar(),e=b(-1).toVar();return Y(t.x.greaterThan(t.z),()=>{Y(t.x.greaterThan(t.y),()=>{e.assign(le(r.x.greaterThan(0),0,3))}).Else(()=>{e.assign(le(r.y.greaterThan(0),1,4))})}).Else(()=>{Y(t.z.greaterThan(t.y),()=>{e.assign(le(r.z.greaterThan(0),2,5))}).Else(()=>{e.assign(le(r.y.greaterThan(0),1,4))})}),e}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),k5=A(([r,t])=>{const e=B().toVar();return Y(t.equal(0),()=>{e.assign(B(r.z,r.y).div(Nt(r.x)))}).ElseIf(t.equal(1),()=>{e.assign(B(r.x.negate(),r.z.negate()).div(Nt(r.y)))}).ElseIf(t.equal(2),()=>{e.assign(B(r.x.negate(),r.y).div(Nt(r.z)))}).ElseIf(t.equal(3),()=>{e.assign(B(r.z.negate(),r.y).div(Nt(r.x)))}).ElseIf(t.equal(4),()=>{e.assign(B(r.x.negate(),r.z).div(Nt(r.y)))}).Else(()=>{e.assign(B(r.x,r.y).div(Nt(r.z)))}),tt(.5,e.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),D5=A(([r])=>{const t=b(0).toVar();return Y(r.greaterThanEqual(bh),()=>{t.assign(hf.sub(r).mul(_c.sub(Mc)).div(hf.sub(bh)).add(Mc))}).ElseIf(r.greaterThanEqual(Mh),()=>{t.assign(bh.sub(r).mul(vc.sub(_c)).div(bh.sub(Mh)).add(_c))}).ElseIf(r.greaterThanEqual(_h),()=>{t.assign(Mh.sub(r).mul(wc.sub(vc)).div(Mh.sub(_h)).add(vc))}).ElseIf(r.greaterThanEqual(lf),()=>{t.assign(_h.sub(r).mul(O5.sub(wc)).div(_h.sub(lf)).add(wc))}).Else(()=>{t.assign(b(-2).mul(is(tt(1.16,r))))}),t}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),U5=A(([r,t])=>{const e=r.toVar();e.assign(tt(2,e).sub(1));const i=R(e,1).toVar();return Y(t.equal(0),()=>{i.assign(i.zyx)}).ElseIf(t.equal(1),()=>{i.assign(i.xzy),i.xz.mulAssign(-1)}).ElseIf(t.equal(2),()=>{i.x.mulAssign(-1)}).ElseIf(t.equal(3),()=>{i.assign(i.zyx),i.xz.mulAssign(-1)}).ElseIf(t.equal(4),()=>{i.assign(i.xzy),i.xy.mulAssign(-1)}).ElseIf(t.equal(5),()=>{i.z.mulAssign(-1)}),i}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),W5=A(([r,t,e,i,s,n])=>{const a=b(e),o=R(t),h=xi(D5(a),Mc,n),l=Os(h),u=ns(h),c=R(Tc(r,o,u,i,s,n)).toVar();return Y(l.notEqual(0),()=>{const d=R(Tc(r,o,u.add(1),i,s,n)).toVar();c.assign(Zt(c,d,l))}),c}),Tc=A(([r,t,e,i,s,n])=>{const a=b(e).toVar(),o=R(t),h=b(F5(o)).toVar(),l=b(kt(uf.sub(a),0)).toVar();a.assign(kt(a,uf));const u=b(Ia(a)).toVar(),c=B(k5(o,h).mul(u.sub(2)).add(1)).toVar();return Y(h.greaterThan(2),()=>{c.y.addAssign(u),h.subAssign(3)}),c.x.addAssign(h.mul(u)),c.x.addAssign(l.mul(tt(3,V5))),c.y.addAssign(tt(4,Ia(n).sub(u))),c.x.mulAssign(i),c.y.mulAssign(s),r.sample(c).grad(B(),B())}),Sc=A(({envMap:r,mipInt:t,outputDirection:e,theta:i,axis:s,CUBEUV_TEXEL_WIDTH:n,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:o})=>{const h=Vs(i),l=e.mul(h).add(s.cross(e).mul(yi(i))).add(s.mul(s.dot(e).mul(h.oneMinus())));return Tc(r,l,t,n,a,o)}),H5=A(({n:r,latitudinal:t,poleAxis:e,outputDirection:i,weights:s,samples:n,dTheta:a,mipInt:o,envMap:h,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:c})=>{const d=R(le(t,e,Ku(e,i))).toVar();Y(d.equal(R(0)),()=>{d.assign(R(i.z,0,i.x.negate()))}),d.assign(un(d));const p=R().toVar();return p.addAssign(s.element(0).mul(Sc({theta:0,axis:d,outputDirection:i,mipInt:o,envMap:h,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:c}))),vt({start:w(1),end:r},({i:m})=>{Y(m.greaterThanEqual(n),()=>{n5()});const f=b(a.mul(b(m))).toVar();p.addAssign(s.element(m).mul(Sc({theta:f.mul(-1),axis:d,outputDirection:i,mipInt:o,envMap:h,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:c}))),p.addAssign(s.element(m).mul(Sc({theta:f,axis:d,outputDirection:i,mipInt:o,envMap:h,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:c})))}),J(p,1)}),cf=[.125,.215,.35,.446,.526,.582],Fa=20,Ac=new Zo(-1,1,1,-1,0,1),q5=new Li(90,1),df=new ut;let Nc=null,Rc=0,Ec=0;const vn=(1+Math.sqrt(5))/2,dr=1/vn,pf=[new S(-vn,dr,0),new S(vn,dr,0),new S(-dr,0,vn),new S(dr,0,vn),new S(0,vn,-dr),new S(0,vn,dr),new S(-1,1,-1),new S(1,1,-1),new S(-1,1,1),new S(1,1,1)],$5=new S,mf=new WeakMap,X5=[3,1,5,0,4,2],Ic=U5(fn(),mn("faceIndex")).normalize(),Cc=R(Ic.x,Ic.y,Ic.z);class j5{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(t,e=0,i=.1,s=100,n={}){const{size:a=256,position:o=$5,renderTarget:h=null}=n;if(this._setSize(a),this._hasInitialized===!1){j("PMREMGenerator: .fromScene() called before the backend is initialized. Try using .fromSceneAsync() instead.");const u=h||this._allocateTarget();return n.renderTarget=u,this.fromSceneAsync(t,e,i,s,n),u}Nc=this._renderer.getRenderTarget(),Rc=this._renderer.getActiveCubeFace(),Ec=this._renderer.getActiveMipmapLevel();const l=h||this._allocateTarget();return l.depthBuffer=!0,this._init(l),this._sceneToCubeUV(t,i,s,l,o),e>0&&this._blur(l,0,0,e),this._applyPMREM(l),this._cleanup(l),l}async fromSceneAsync(t,e=0,i=.1,s=100,n={}){return this._hasInitialized===!1&&await this._renderer.init(),this.fromScene(t,e,i,s,n)}fromEquirectangular(t,e=null){if(this._hasInitialized===!1){j("PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using .fromEquirectangularAsync() instead."),this._setSizeFromTexture(t);const i=e||this._allocateTarget();return this.fromEquirectangularAsync(t,i),i}return this._fromTexture(t,e)}async fromEquirectangularAsync(t,e=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(t,e)}fromCubemap(t,e=null){if(this._hasInitialized===!1){j("PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(t);const i=e||this._allocateTarget();return this.fromCubemapAsync(t,e),i}return this._fromTexture(t,e)}async fromCubemapAsync(t,e=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(t,e)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=gf(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=yf(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(t){t.mapping===301||t.mapping===302?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4)}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Nc,Rc,Ec),t.scissorTest=!1,vh(t,0,0,t.width,t.height)}_fromTexture(t,e){this._setSizeFromTexture(t),Nc=this._renderer.getRenderTarget(),Rc=this._renderer.getActiveCubeFace(),Ec=this._renderer.getActiveMipmapLevel();const i=e||this._allocateTarget();return this._init(i),this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTarget(){return ff(3*Math.max(this._cubeSize,112),4*this._cubeSize)}_init(t){if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t.width||this._pingPongRenderTarget.height!==t.height){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=ff(t.width,t.height);const{_lodMax:e}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=(function(i){const s=[],n=[],a=[],o=[];let h=i;const l=i-4+1+cf.length;for(let u=0;u<l;u++){const c=Math.pow(2,h);n.push(c);let d=1/c;u>i-4?d=cf[u-i+4-1]:u===0&&(d=0),a.push(d);const p=1/(c-2),m=-p,f=1+p,g=[m,m,f,m,f,f,m,m,f,f,m,f],y=6,x=6,_=3,M=2,v=1,N=new Float32Array(_*x*y),T=new Float32Array(M*x*y),C=new Float32Array(v*x*y);for(let F=0;F<y;F++){const D=F%3*2/3-1,q=F>2?0:-1,X=[D,q,0,D+2/3,q,0,D+2/3,q+1,0,D,q,0,D+2/3,q+1,0,D,q+1,0],it=X5[F];N.set(X,_*x*it),T.set(g,M*x*it);const mt=[it,it,it,it,it,it];C.set(mt,v*x*it)}const P=new rn;P.setAttribute("position",new Ae(N,_)),P.setAttribute("uv",new Ae(T,M)),P.setAttribute("faceIndex",new Ae(C,v)),s.push(P),o.push(new di(P,null)),h>4&&h--}return{lodPlanes:s,sizeLods:n,sigmas:a,lodMeshes:o}})(e)),this._blurMaterial=(function(i,s,n){const a=Ne(new Array(Fa).fill(0)),o=K(new S(0,1,0)),h=K(0),l=b(Fa),u=K(0),c=K(1),d=Bt(null),p=K(0),m=b(1/s),f=b(1/n),g=b(i),y={n:l,latitudinal:u,weights:a,poleAxis:o,outputDirection:Cc,dTheta:h,samples:c,envMap:d,mipInt:p,CUBEUV_TEXEL_WIDTH:m,CUBEUV_TEXEL_HEIGHT:f,CUBEUV_MAX_MIP:g},x=zc("blur");return x.fragmentNode=H5({...y,latitudinal:u.equal(1)}),mf.set(x,y),x})(e,t.width,t.height)}}async _compileMaterial(t){const e=new di(this._lodPlanes[0],t);await this._renderer.compile(e,Ac)}_sceneToCubeUV(t,e,i,s,n){const a=q5;a.near=e,a.far=i;const o=[1,1,1,1,-1,1],h=[1,-1,1,-1,1,-1],l=this._renderer,u=l.autoClear;l.getClearColor(df),l.autoClear=!1;let c=this._backgroundBox;if(c===null){const m=new Rs({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1});c=new di(new da,m)}let d=!1;const p=t.background;p?p.isColor&&(c.material.color.copy(p),t.background=null,d=!0):(c.material.color.copy(df),d=!0),l.setRenderTarget(s),l.clear(),d&&l.render(c,a);for(let m=0;m<6;m++){const f=m%3;f===0?(a.up.set(0,o[m],0),a.position.set(n.x,n.y,n.z),a.lookAt(n.x+h[m],n.y,n.z)):f===1?(a.up.set(0,0,o[m]),a.position.set(n.x,n.y,n.z),a.lookAt(n.x,n.y+h[m],n.z)):(a.up.set(0,o[m],0),a.position.set(n.x,n.y,n.z),a.lookAt(n.x,n.y,n.z+h[m]));const g=this._cubeSize;vh(s,f*g,m>2?g:0,g,g),l.render(t,a)}l.autoClear=u,t.background=p}_textureToCubeUV(t,e){const i=this._renderer,s=t.mapping===301||t.mapping===302;s?this._cubemapMaterial===null&&(this._cubemapMaterial=gf(t)):this._equirectMaterial===null&&(this._equirectMaterial=yf(t));const n=s?this._cubemapMaterial:this._equirectMaterial;n.fragmentNode.value=t;const a=this._lodMeshes[0];a.material=n;const o=this._cubeSize;vh(e,0,0,3*o,2*o),i.setRenderTarget(e),i.render(a,Ac)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;const s=this._lodPlanes.length;for(let n=1;n<s;n++){const a=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),o=pf[(s-n-1)%pf.length];this._blur(t,n-1,n,a,o)}e.autoClear=i}_blur(t,e,i,s,n){const a=this._pingPongRenderTarget;this._halfBlur(t,a,e,i,s,"latitudinal",n),this._halfBlur(a,t,i,i,s,"longitudinal",n)}_halfBlur(t,e,i,s,n,a,o){const h=this._renderer,l=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&et("blur direction must be either latitudinal or longitudinal!");const u=this._lodMeshes[s];u.material=l;const c=mf.get(l),d=this._sizeLods[i]-1,p=isFinite(n)?Math.PI/(2*d):2*Math.PI/39,m=n/p,f=isFinite(n)?1+Math.floor(3*m):Fa;f>Fa&&j(`sigmaRadians, ${n}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const g=[];let y=0;for(let M=0;M<Fa;++M){const v=M/m,N=Math.exp(-v*v/2);g.push(N),M===0?y+=N:M<f&&(y+=2*N)}for(let M=0;M<g.length;M++)g[M]=g[M]/y;t.texture.frame=(t.texture.frame||0)+1,c.envMap.value=t.texture,c.samples.value=f,c.weights.array=g,c.latitudinal.value=a==="latitudinal"?1:0,o&&(c.poleAxis.value=o);const{_lodMax:x}=this;c.dTheta.value=p,c.mipInt.value=x-i;const _=this._sizeLods[s];vh(e,3*_*(s>x-4?s-x+4:0),4*(this._cubeSize-_),3*_,2*_),h.setRenderTarget(e),h.render(u,Ac)}}function ff(r,t){const e=new yo(r,t,{magFilter:1006,minFilter:1006,generateMipmaps:!1,type:1016,format:1023,colorSpace:ze});return e.texture.mapping=306,e.texture.name="PMREM.cubeUv",e.texture.isPMREMTexture=!0,e.scissorTest=!0,e}function vh(r,t,e,i,s){r.viewport.set(t,e,i,s),r.scissor.set(t,e,i,s)}function zc(r){const t=new qm;return t.depthTest=!1,t.depthWrite=!1,t.blending=0,t.name=`PMREM_${r}`,t}function gf(r){const t=zc("cubemap");return t.fragmentNode=uc(r,Cc),t}function yf(r){const t=zc("equirect");return t.fragmentNode=Bt(r,$m(Cc),0),t}const xf=new WeakMap;function G5(r,t,e){const i=(function(n){let a=xf.get(n);return a===void 0&&(a=new WeakMap,xf.set(n,a)),a})(t);let s=i.get(r);if((s!==void 0?s.pmremVersion:-1)!==r.pmremVersion){const n=r.image;if(r.isCubeTexture){if(!(function(a){if(a==null)return!1;let o=0;const h=6;for(let l=0;l<h;l++)a[l]!==void 0&&o++;return o===h})(n))return null;s=e.fromCubemap(r,s)}else{if(!(function(a){return a!=null&&a.height>0})(n))return null;s=e.fromEquirectangular(r,s)}s.pmremVersion=r.pmremVersion,i.set(r,s)}return s.texture}class Y5 extends Ft{static get type(){return"PMREMNode"}constructor(t,e=null,i=null){super("vec3"),this._value=t,this._pmrem=null,this.uvNode=e,this.levelNode=i,this._generator=null;const s=new Se;s.isRenderTargetTexture=!0,this._texture=Bt(s),this._width=K(0),this._height=K(0),this._maxMip=K(0),this.updateBeforeType=Tt.RENDER}set value(t){this._value=t,this._pmrem=null}get value(){return this._value}updateFromTexture(t){const e=(function(i){const s=Math.log2(i)-2,n=1/i;return{texelWidth:1/(3*Math.max(Math.pow(2,s),112)),texelHeight:n,maxMip:s}})(t.image.height);this._texture.value=t,this._width.value=e.texelWidth,this._height.value=e.texelHeight,this._maxMip.value=e.maxMip}updateBefore(t){let e=this._pmrem;const i=e?e.pmremVersion:-1,s=this._value;i!==s.pmremVersion&&(e=s.isPMREMTexture===!0?s:G5(s,t.renderer,this._generator),e!==null&&(this._pmrem=e,this.updateFromTexture(e)))}setup(t){this._generator===null&&(this._generator=new j5(t.renderer)),this.updateBefore(t);let e=this.uvNode;e===null&&t.context.getUV&&(e=t.context.getUV(this)),e=Mm.mul(R(e.x,e.y.negate(),e.z));let i=this.levelNode;return i===null&&t.context.getTextureLevel&&(i=t.context.getTextureLevel(this)),W5(this._texture,e,i,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}Z(Y5).setParameterLength(1,3),new Go,new pi,A(({normal:r,lightDirection:t,builder:e})=>{const i=r.dot(t),s=B(i.mul(.5).add(.5),0);if(e.material.gradientMap){const n=_n("gradientMap","texture").context({getUV:()=>s});return R(n.r)}{const n=s.fwidth().mul(.5);return Zt(R(.7),R(1),dn(b(.7).sub(n.x),b(.7).add(n.x),s.x))}}),new lx,A(()=>{const r=R(pe.z,0,pe.x.negate()).normalize(),t=pe.cross(r);return B(r.dot($t),t.dot($t)).mul(.495).add(.5)}).once(["NORMAL","VERTEX"])().toVar("matcapUV"),new dx;class Z5 extends Ft{static get type(){return"RotateNode"}constructor(t,e){super(),this.positionNode=t,this.rotationNode=e}getNodeType(t){return this.positionNode.getNodeType(t)}setup(t){const{rotationNode:e,positionNode:i}=this;if(this.getNodeType(t)==="vec2"){const s=e.cos(),n=e.sin();return ju(s,n,n.negate(),s).mul(i)}{const s=e,n=or(J(1,0,0,0),J(0,Vs(s.x),yi(s.x).negate(),0),J(0,yi(s.x),Vs(s.x),0),J(0,0,0,1)),a=or(J(Vs(s.y),0,yi(s.y),0),J(0,1,0,0),J(yi(s.y).negate(),0,Vs(s.y),0),J(0,0,0,1)),o=or(J(Vs(s.z),yi(s.z).negate(),0,0),J(yi(s.z),Vs(s.z),0,0),J(0,0,1,0),J(0,0,0,1));return n.mul(a).mul(o).mul(J(i,1)).xyz}}}const J5=Z(Z5).setParameterLength(2);new Yy,new Nu;const Q5=new nt;K(1).onFrameUpdate(function({renderer:r}){const t=r.getSize(Q5);this.value=.5*t.y}),new ox,Bs("vec3"),Bs("vec3"),Bs("vec3"),new Mu,new Bo,new S;class K5 extends ut{constructor(t,e,i,s=1){super(t,e,i),this.a=s}set(t,e,i,s=1){return this.a=s,super.set(t,e,i)}copy(t){return t.a!==void 0&&(this.a=t.a),super.copy(t)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class tb extends ${static get type(){return"StackNode"}constructor(t=null){super(),this.nodes=[],this.outputNode=null,this.parent=t,this._currentCond=null,this._expressionNode=null,this.isStackNode=!0}getNodeType(t){return this.hasOutput?this.outputNode.getNodeType(t):"void"}getMemberType(t,e){return this.hasOutput?this.outputNode.getMemberType(t,e):"void"}add(t){return t.isNode!==!0?(et("TSL: Invalid node added to stack."),this):(this.nodes.push(t),this)}If(t,e){const i=new Sa(e);return this._currentCond=le(t,i),this.add(this._currentCond)}ElseIf(t,e){const i=new Sa(e),s=le(t,i);return this._currentCond.elseNode=s,this._currentCond=s,this}Else(t){return this._currentCond.elseNode=new Sa(t),this}Switch(t){return this._expressionNode=V(t),this}Case(...t){const e=[];if(t.length>=2)for(let a=0;a<t.length-1;a++)e.push(this._expressionNode.equal(V(t[a])));else et("TSL: Invalid parameter length. Case() requires at least two parameters.");const i=new Sa(t[t.length-1]);let s=e[0];for(let a=1;a<e.length;a++)s=s.or(e[a]);const n=le(s,i);return this._currentCond===null?(this._currentCond=n,this.add(this._currentCond)):(this._currentCond.elseNode=n,this._currentCond=n,this)}Default(t){return this.Else(t),this}setup(t){const e=t.getNodeProperties(this);let i=0;for(const s of this.getChildren())s.isVarNode&&s.intent===!0&&t.getNodeProperties(s).assign!==!0||(e["node"+i++]=s);return e.outputNode||null}get hasOutput(){return this.outputNode&&this.outputNode.isNode}build(t,...e){const i=t.currentStack,s=Op();Bp(this),t.currentStack=this;const n=t.buildStage;for(const o of this.nodes)if(!(o.isVarNode&&o.intent===!0&&t.getNodeProperties(o).assign!==!0)){if(n==="setup")o.build(t);else if(n==="analyze")o.build(t,this);else if(n==="generate"){const h=t.getDataFromNode(o,"any").stages,l=h&&h[t.shaderStage];if(o.isVarNode&&l&&l.length===1&&l[0]&&l[0].isStackNode)continue;o.build(t,"void")}}let a;return a=this.hasOutput?this.outputNode.build(t,...e):super.build(t,...e),Bp(s),t.currentStack=i,a}}Z(tb).setParameterLength(0,1);class bf extends ${static get type(){return"OutputStructNode"}constructor(...t){super(),this.members=t,this.isOutputStructNode=!0}getNodeType(t){const e=t.getNodeProperties(this);if(e.membersLayout===void 0){const i=this.members,s=[];for(let n=0;n<i.length;n++){const a="m"+n,o=i[n].getNodeType(t);s.push({name:a,type:o,index:n})}e.membersLayout=s,e.structType=t.getOutputStructTypeFromNode(this,e.membersLayout)}return e.structType.name}generate(t){const e=t.getOutputStructName(),i=this.members,s=e!==""?e+".":"";for(let n=0;n<i.length;n++){const a=i[n].build(t);t.addLineFlowCode(`${s}m${n} = ${a}`,this)}return e}}Z(bf);function eb(r,t){for(let e=0;e<r.length;e++)if(r[e].name===t)return e;return-1}const ib=Z(class extends bf{static get type(){return"MRTNode"}constructor(t){super(),this.outputNodes=t,this.isMRTNode=!0}has(t){return this.outputNodes[t]!==void 0}get(t){return this.outputNodes[t]}merge(t){const e={...this.outputNodes,...t.outputNodes};return ib(e)}setup(t){const e=this.outputNodes,i=[],s=t.renderer.getRenderTarget().textures;for(const n in e)i[eb(s,n)]=J(e[n]);return this.members=i,super.setup(t)}});class sb extends Ft{static get type(){return"BitcastNode"}constructor(t,e,i=null){super(),this.valueNode=t,this.conversionType=e,this.inputType=i,this.isBitcastNode=!0}getNodeType(t){if(this.inputType!==null){const e=this.valueNode.getNodeType(t),i=t.getTypeLength(e);return t.getTypeFromLength(i,this.conversionType)}return this.conversionType}generate(t){const e=this.getNodeType(t);let i="";if(this.inputType!==null){const s=this.valueNode.getNodeType(t);i=t.getTypeLength(s)===1?this.inputType:t.changeComponentType(s,this.inputType)}else i=this.valueNode.getNodeType(t);return`${t.getBitcastMethod(e,i)}( ${this.valueNode.build(t,i)} )`}}k(sb).setParameterLength(2),A(([r])=>{const t=r.toUint().mul(747796405).add(2891336453),e=t.shiftRight(t.shiftRight(28).add(4)).bitXor(t).mul(277803737);return e.shiftRight(22).bitXor(e).toFloat().mul(1/2**32)});const as=A(([r])=>r.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),nb=A(([r])=>R(as(r.z.add(as(r.y.mul(1)))),as(r.z.add(as(r.x.mul(1)))),as(r.y.add(as(r.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]});A(([r,t,e])=>{const i=R(r).toVar(),s=b(1.4).toVar(),n=b(0).toVar(),a=R(i).toVar();return vt({start:b(0),end:b(3),type:"float",condition:"<="},()=>{const o=R(nb(a.mul(2))).toVar();i.addAssign(o.add(e.mul(b(.1).mul(t)))),a.mulAssign(1.8),s.mulAssign(1.5),i.mulAssign(1.2);const h=b(as(i.z.add(as(i.x.add(as(i.y)))))).toVar();n.addAssign(h.div(s)),a.addAssign(.14)}),n}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"position",type:"vec3"},{name:"speed",type:"float"},{name:"time",type:"float"}]});class rb extends ${static get type(){return"FunctionOverloadingNode"}constructor(t=[],...e){super(),this.functionNodes=t,this.parametersNodes=e,this._candidateFnCall=null,this.global=!0}getNodeType(){return this.functionNodes[0].shaderNode.layout.type}setup(t){const e=this.parametersNodes;let i=this._candidateFnCall;if(i===null){let s=null,n=-1;for(const a of this.functionNodes){const o=a.shaderNode.layout;if(o===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const h=o.inputs;if(e.length===h.length){let l=0;for(let u=0;u<e.length;u++){const c=e[u],d=h[u];c.getNodeType(t)===d.type?l++:l=0}l>n&&(s=a,n=l)}}this._candidateFnCall=i=s(...e)}return i}}const ab=Z(rb),me=r=>(...t)=>ab(r,...t);K(0).setGroup(pt).onRenderUpdate(r=>r.time),K(0).setGroup(pt).onRenderUpdate(r=>r.deltaTime),K(0,"uint").setGroup(pt).onRenderUpdate(r=>r.frameId),A(([r,t,e=B(.5)])=>J5(r.sub(e),t).add(e)),A(([r,t,e=B(.5)])=>{const i=r.sub(e),s=i.dot(i),n=s.mul(s).mul(t);return r.add(i.mul(n))}),A(({position:r=null,horizontal:t=!0,vertical:e=!1})=>{let i;r!==null?(i=ks.toVar(),i[3][0]=r.x,i[3][1]=r.y,i[3][2]=r.z):i=ks;const s=Fs.mul(i);return ih(t)&&(s[0][0]=ks[0].length(),s[0][1]=0,s[0][2]=0),ih(e)&&(s[1][0]=0,s[1][1]=ks[1].length(),s[1][2]=0),s[2][0]=0,s[2][1]=0,s[2][2]=1,ac.mul(s).mul(se)}),A(([r=null])=>{const t=yc();return yc(Fm(r)).sub(t).lessThan(0).select(Pa,r)});class ob extends ${static get type(){return"SpriteSheetUVNode"}constructor(t,e=fn(),i=b(0)){super("vec2"),this.countNode=t,this.uvNode=e,this.frameNode=i}setup(){const{frameNode:t,uvNode:e,countNode:i}=this,{width:s,height:n}=i,a=t.mod(s.mul(n)).floor(),o=a.mod(s),h=n.sub(a.add(1).div(s).ceil()),l=i.reciprocal(),u=B(o,h);return e.add(u).mul(l)}}Z(ob).setParameterLength(3),A(([r,t=null,e=null,i=b(1),s=se,n=Ze])=>{let a=n.abs().normalize();a=a.div(a.dot(R(1)));const o=s.yz.mul(i),h=s.zx.mul(i),l=s.xy.mul(i),u=r.value,c=t!==null?t.value:u,d=e!==null?e.value:u,p=Bt(u,o).mul(a.x),m=Bt(c,h).mul(a.y),f=Bt(d,l).mul(a.z);return ie(p,m,f)}),new Cs,new S,new S,new S,new G,new S(0,0,-1),new wt,new S,new S,new wt,new nt;const hb=new yo;Pa.flipX(),hb.depthTexture=new Eu(1,1);const Lc=new Zo(-1,1,1,-1,0,1);class lb extends rn{constructor(t=!1){super();const e=t===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new Es([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Es(e,2))}}const ub=new lb;class cb extends di{constructor(t=null){super(ub,t),this.camera=Lc,this.isQuadMesh=!0}async renderAsync(t){return t.renderAsync(this,Lc)}render(t){t.render(this,Lc)}}new nt;const ka=A(([r,t,e],i)=>{let s;i.renderer.coordinateSystem===2001?(r=B(r.x,r.y.oneMinus()).mul(2).sub(1),s=J(R(r,t),1)):s=J(R(r.x,r.y.oneMinus(),t).mul(2).sub(1),1);const n=J(e.mul(s));return n.xyz.div(n.w)});A(([r,t])=>{const e=t.mul(J(r,1)),i=e.xy.div(e.w).mul(.5).add(.5).toVar();return B(i.x,i.y.oneMinus())}),A(([r,t,e])=>{const i=gn(Dt(t)),s=ee(r.mul(i)).toVar(),n=Dt(t,s).toVar(),a=Dt(t,s.sub(ee(2,0))).toVar(),o=Dt(t,s.sub(ee(1,0))).toVar(),h=Dt(t,s.add(ee(1,0))).toVar(),l=Dt(t,s.add(ee(2,0))).toVar(),u=Dt(t,s.add(ee(0,2))).toVar(),c=Dt(t,s.add(ee(0,1))).toVar(),d=Dt(t,s.sub(ee(0,1))).toVar(),p=Dt(t,s.sub(ee(0,2))).toVar(),m=Nt(yt(b(2).mul(o).sub(a),n)).toVar(),f=Nt(yt(b(2).mul(h).sub(l),n)).toVar(),g=Nt(yt(b(2).mul(c).sub(u),n)).toVar(),y=Nt(yt(b(2).mul(d).sub(p),n)).toVar(),x=ka(r,n,e).toVar(),_=m.lessThan(f).select(x.sub(ka(r.sub(B(b(1).div(i.x),0)),o,e)),x.negate().add(ka(r.add(B(b(1).div(i.x),0)),h,e))),M=g.lessThan(y).select(x.sub(ka(r.add(B(0,b(1).div(i.y))),c,e)),x.negate().add(ka(r.sub(B(0,b(1).div(i.y))),d,e)));return un(Ku(_,M))});class Da extends ${static get type(){return"EventNode"}constructor(t,e){super("void"),this.eventType=t,this.callback=e,t===Da.OBJECT?this.updateType=Tt.OBJECT:t===Da.MATERIAL&&(this.updateType=Tt.RENDER)}update(t){this.callback(t)}}Da.OBJECT="object",Da.MATERIAL="material";class db extends ${static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}U(db);const Ua=new $e,Pc=new G;class Ee extends ${static get type(){return"SceneNode"}constructor(t=Ee.BACKGROUND_BLURRINESS,e=null){super(),this.scope=t,this.scene=e}setup(t){const e=this.scope,i=this.scene!==null?this.scene:t.scene;let s;return e===Ee.BACKGROUND_BLURRINESS?s=Je("backgroundBlurriness","float",i):e===Ee.BACKGROUND_INTENSITY?s=Je("backgroundIntensity","float",i):e===Ee.BACKGROUND_ROTATION?s=K("mat4").setName("backgroundRotation").setGroup(pt).onRenderUpdate(()=>{const n=i.background;return n!==null&&n.isTexture&&n.mapping!==300?(Ua.copy(i.backgroundRotation),Ua.x*=-1,Ua.y*=-1,Ua.z*=-1,Pc.makeRotationFromEuler(Ua)):Pc.identity(),Pc}):et("SceneNode: Unknown scope:",e),s}}Ee.BACKGROUND_BLURRINESS="backgroundBlurriness",Ee.BACKGROUND_INTENSITY="backgroundIntensity",Ee.BACKGROUND_ROTATION="backgroundRotation",U(Ee,Ee.BACKGROUND_BLURRINESS),U(Ee,Ee.BACKGROUND_INTENSITY),U(Ee,Ee.BACKGROUND_ROTATION);class pb extends lr{static get type(){return"StorageTextureNode"}constructor(t,e,i=null){super(t,e),this.storeNode=i,this.isStorageTextureNode=!0,this.access=hn.WRITE_ONLY}getInputType(){return"storageTexture"}setup(t){super.setup(t);const e=t.getNodeProperties(this);return e.storeNode=this.storeNode,e}setAccess(t){return this.access=t,this}generate(t,e){let i;return i=this.storeNode!==null?this.generateStore(t):super.generate(t,e),i}toReadWrite(){return this.setAccess(hn.READ_WRITE)}toReadOnly(){return this.setAccess(hn.READ_ONLY)}toWriteOnly(){return this.setAccess(hn.WRITE_ONLY)}generateStore(t){const e=t.getNodeProperties(this),{uvNode:i,storeNode:s,depthNode:n}=e,a=super.generate(t,"property"),o=i.build(t,this.value.is3DTexture===!0?"uvec3":"uvec2"),h=s.build(t,"vec4"),l=n?n.build(t,"int"):null,u=t.generateTextureStore(t,a,o,l,h);t.addLineFlowCode(u,this)}clone(){const t=super.clone();return t.storeNode=this.storeNode,t}}Z(pb).setParameterLength(1,3);const mb=A(({texture:r,uv:t})=>{const i=R().toVar();return Y(t.x.lessThan(1e-4),()=>{i.assign(R(1,0,0))}).ElseIf(t.y.lessThan(1e-4),()=>{i.assign(R(0,1,0))}).ElseIf(t.z.lessThan(1e-4),()=>{i.assign(R(0,0,1))}).ElseIf(t.x.greaterThan(.9999),()=>{i.assign(R(-1,0,0))}).ElseIf(t.y.greaterThan(.9999),()=>{i.assign(R(0,-1,0))}).ElseIf(t.z.greaterThan(.9999),()=>{i.assign(R(0,0,-1))}).Else(()=>{const n=r.sample(t.add(R(-.01,0,0))).r.sub(r.sample(t.add(R(.01,0,0))).r),a=r.sample(t.add(R(0,-.01,0))).r.sub(r.sample(t.add(R(0,.01,0))).r),o=r.sample(t.add(R(0,0,-.01))).r.sub(r.sample(t.add(R(0,0,.01))).r);i.assign(R(n,a,o))}),i.normalize()});class fb extends lr{static get type(){return"Texture3DNode"}constructor(t,e=null,i=null){super(t,e,i),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return R(.5,.5,.5)}setUpdateMatrix(){}setupUV(t,e){const i=this.value;return!t.isFlipY()||i.isRenderTargetTexture!==!0&&i.isFramebufferTexture!==!0||(e=this.sampler?e.flipY():e.setY(w(gn(this,this.levelNode).y).sub(e.y).sub(1))),e}generateUV(t,e){return e.build(t,this.sampler===!0?"vec3":"ivec3")}generateOffset(t,e){return e.build(t,"ivec3")}normal(t){return mb({texture:this,uv:t})}}Z(fb).setParameterLength(1,3);const Mf=new WeakMap;class gb extends Ft{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=Tt.OBJECT,this.updateAfterType=Tt.OBJECT,this.previousModelWorldMatrix=K(new G),this.previousProjectionMatrix=K(new G).setGroup(pt),this.previousCameraViewMatrix=K(new G)}setProjectionMatrix(t){this.projectionMatrix=t}update({frameId:t,camera:e,object:i}){const s=vf(i);this.previousModelWorldMatrix.value.copy(s);const n=_f(e);n.frameId!==t&&(n.frameId=t,n.previousProjectionMatrix===void 0?(n.previousProjectionMatrix=new G,n.previousCameraViewMatrix=new G,n.currentProjectionMatrix=new G,n.currentCameraViewMatrix=new G,n.previousProjectionMatrix.copy(this.projectionMatrix||e.projectionMatrix),n.previousCameraViewMatrix.copy(e.matrixWorldInverse)):(n.previousProjectionMatrix.copy(n.currentProjectionMatrix),n.previousCameraViewMatrix.copy(n.currentCameraViewMatrix)),n.currentProjectionMatrix.copy(this.projectionMatrix||e.projectionMatrix),n.currentCameraViewMatrix.copy(e.matrixWorldInverse),this.previousProjectionMatrix.value.copy(n.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(n.previousCameraViewMatrix))}updateAfter({object:t}){vf(t).copy(t.matrixWorld)}setup(){const t=this.projectionMatrix===null?ac:K(this.projectionMatrix),e=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),i=t.mul(oc).mul(se),s=this.previousProjectionMatrix.mul(e).mul(hc),n=i.xy.div(i.w),a=s.xy.div(s.w);return yt(n,a)}}function _f(r){let t=Mf.get(r);return t===void 0&&(t={},Mf.set(r,t)),t}function vf(r,t=0){const e=_f(r);let i=e[t];return i===void 0&&(e[t]=i=new G,e[t].copy(r.matrixWorld)),i}U(gb),A(([r])=>wf(r.rgb)),A(([r,t=b(1)])=>t.mix(wf(r.rgb),r.rgb)),A(([r,t=b(1)])=>{const e=ie(r.r,r.g,r.b).div(3),i=r.r.max(r.g.max(r.b)),s=i.sub(e).mul(t).mul(-3);return Zt(r.rgb,i,s)}),A(([r,t=b(1)])=>{const e=R(.57735,.57735,.57735),i=t.cos();return R(r.rgb.mul(i).add(e.cross(r.rgb).mul(t.sin()).add(e.mul(cn(e,r.rgb).mul(i.oneMinus())))))});const wf=(r,t=R(Vt.getLuminanceCoefficients(new S)))=>cn(r,t);A(([r,t=R(1),e=R(0),i=R(1),s=b(1),n=R(Vt.getLuminanceCoefficients(new S,ze))])=>{const a=r.rgb.dot(R(n)),o=kt(r.rgb.mul(t).add(e),0).toVar(),h=o.pow(i).toVar();return Y(o.r.greaterThan(0),()=>{o.r.assign(h.r)}),Y(o.g.greaterThan(0),()=>{o.g.assign(h.g)}),Y(o.b.greaterThan(0),()=>{o.b.assign(h.b)}),o.assign(a.add(o.sub(a).mul(s))),J(o.rgb,r.a)});class yb extends Ft{static get type(){return"PosterizeNode"}constructor(t,e){super(),this.sourceNode=t,this.stepsNode=e}setup(){const{sourceNode:t,stepsNode:e}=this;return t.mul(e).floor().div(e)}}Z(yb).setParameterLength(2);const wh=new nt;class xb extends lr{static get type(){return"PassTextureNode"}constructor(t,e){super(e),this.passNode=t,this.setUpdateMatrix(!1)}setup(t){return this.passNode.build(t),super.setup(t)}clone(){return new this.constructor(this.passNode,this.value)}}class Tf extends xb{static get type(){return"PassMultipleTextureNode"}constructor(t,e,i=!1){super(t,null),this.textureName=e,this.previousTexture=i}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(t){return this.updateTexture(),super.setup(t)}clone(){const t=new this.constructor(this.passNode,this.textureName,this.previousTexture);return t.uvNode=this.uvNode,t.levelNode=this.levelNode,t.biasNode=this.biasNode,t.sampler=this.sampler,t.depthNode=this.depthNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t}}class Th extends Ft{static get type(){return"PassNode"}constructor(t,e,i,s={}){super("vec4"),this.scope=t,this.scene=e,this.camera=i,this.options=s,this._pixelRatio=1,this._width=1,this._height=1;const n=new Eu;n.isRenderTargetTexture=!0,n.name="depth";const a=new yo(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:1016,...s});a.texture.name="output",a.depthTexture=n,this.renderTarget=a,this._textures={output:a.texture,depth:n},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=K(0),this._cameraFar=K(0),this._mrt=null,this._layers=null,this._resolution=1,this._viewport=null,this._scissor=null,this.isPassNode=!0,this.updateBeforeType=Tt.FRAME,this.global=!0}setResolution(t){return this._resolution=t,this}getResolution(){return this._resolution}setLayers(t){return this._layers=t,this}getLayers(){return this._layers}setMRT(t){return this._mrt=t,this}getMRT(){return this._mrt}getTexture(t){let e=this._textures[t];return e===void 0&&(e=this.renderTarget.texture.clone(),e.name=t,this._textures[t]=e,this.renderTarget.textures.push(e)),e}getPreviousTexture(t){let e=this._previousTextures[t];return e===void 0&&(e=this.getTexture(t).clone(),this._previousTextures[t]=e),e}toggleTexture(t){const e=this._previousTextures[t];if(e!==void 0){const i=this._textures[t],s=this.renderTarget.textures.indexOf(i);this.renderTarget.textures[s]=e,this._textures[t]=e,this._previousTextures[t]=i,this._textureNodes[t].updateTexture(),this._previousTextureNodes[t].updateTexture()}}getTextureNode(t="output"){let e=this._textureNodes[t];return e===void 0&&(e=V(new Tf(this,t)),e.updateTexture(),this._textureNodes[t]=e),e}getPreviousTextureNode(t="output"){let e=this._previousTextureNodes[t];return e===void 0&&(this._textureNodes[t]===void 0&&this.getTextureNode(t),e=V(new Tf(this,t,!0)),e.updateTexture(),this._previousTextureNodes[t]=e),e}getViewZNode(t="depth"){let e=this._viewZNodes[t];if(e===void 0){const i=this._cameraNear,s=this._cameraFar;this._viewZNodes[t]=e=km(this.getTextureNode(t),i,s)}return e}getLinearDepthNode(t="depth"){let e=this._linearDepthNodes[t];if(e===void 0){const i=this._cameraNear,s=this._cameraFar,n=this.getViewZNode(t);this._linearDepthNodes[t]=e=Oa(n,i,s)}return e}async compileAsync(t){const e=t.getRenderTarget(),i=t.getMRT();t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),await t.compileAsync(this.scene,this.camera),t.setRenderTarget(e),t.setMRT(i)}setup({renderer:t}){return this.renderTarget.samples=this.options.samples===void 0?t.samples:this.options.samples,this.renderTarget.texture.type=t.getColorBufferType(),this.scope===Th.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(t){const{renderer:e}=t,{scene:i}=this;let s,n;const a=e.getOutputRenderTarget();a&&a.isXRRenderTarget===!0?(n=1,s=e.xr.getCamera(),e.xr.updateCamera(s),wh.set(a.width,a.height)):(s=this.camera,n=e.getPixelRatio(),e.getSize(wh)),this._pixelRatio=n,this.setSize(wh.width,wh.height);const o=e.getRenderTarget(),h=e.getMRT(),l=s.layers.mask;this._cameraNear.value=s.near,this._cameraFar.value=s.far,this._layers!==null&&(s.layers.mask=this._layers.mask);for(const u in this._previousTextures)this.toggleTexture(u);e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),e.render(i,s),e.setRenderTarget(o),e.setMRT(h),s.layers.mask=l}setSize(t,e){this._width=t,this._height=e;const i=this._width*this._pixelRatio*this._resolution,s=this._height*this._pixelRatio*this._resolution;this.renderTarget.setSize(i,s),this._scissor!==null&&this.renderTarget.scissor.copy(this._scissor),this._viewport!==null&&this.renderTarget.viewport.copy(this._viewport)}setScissor(t,e,i,s){t===null?this._scissor=null:(this._scissor===null&&(this._scissor=new wt),t.isVector4?this._scissor.copy(t):this._scissor.set(t,e,i,s),this._scissor.multiplyScalar(this._pixelRatio*this._resolution).floor())}setViewport(t,e,i,s){t===null?this._viewport=null:(this._viewport===null&&(this._viewport=new wt),t.isVector4?this._viewport.copy(t):this._viewport.set(t,e,i,s),this._viewport.multiplyScalar(this._pixelRatio*this._resolution).floor())}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Th.COLOR="color",Th.DEPTH="depth",A(([r,t])=>r.mul(t).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),A(([r,t])=>(r=r.mul(t)).div(r.add(1)).clamp()).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),A(([r,t])=>{const e=(r=(r=r.mul(t)).sub(.004).max(0)).mul(r.mul(6.2).add(.5)),i=r.mul(r.mul(6.2).add(1.7)).add(.06);return e.div(i).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});const bb=A(([r])=>{const t=r.mul(r.add(.0245786)).sub(90537e-9),e=r.mul(r.add(.432951).mul(.983729)).add(.238081);return t.div(e)});A(([r,t])=>{const e=Be(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),i=Be(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return r=r.mul(t).div(.6),r=e.mul(r),r=bb(r),(r=i.mul(r)).clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});const Mb=Be(R(1.6605,-.1246,-.0182),R(-.5876,1.1329,-.1006),R(-.0728,-.0083,1.1187)),_b=Be(R(.6274,.0691,.0164),R(.3293,.9195,.088),R(.0433,.0113,.8956)),vb=A(([r])=>{const t=R(r).toVar(),e=R(t.mul(t)).toVar(),i=R(e.mul(e)).toVar();return b(15.5).mul(i.mul(e)).sub(tt(40.14,i.mul(t))).add(tt(31.96,i).sub(tt(6.868,e.mul(t))).add(tt(.4298,e).add(tt(.1191,t).sub(.00232))))});A(([r,t])=>{const e=R(r).toVar(),i=Be(R(.856627153315983,.137318972929847,.11189821299995),R(.0951212405381588,.761241990602591,.0767994186031903),R(.0482516061458583,.101439036467562,.811302368396859)),s=Be(R(1.1271005818144368,-.1413297634984383,-.14132976349843826),R(-.11060664309660323,1.157823702216272,-.11060664309660294),R(-.016493938717834573,-.016493938717834257,1.2519364065950405)),n=b(-12.47393),a=b(4.026069);return e.mulAssign(t),e.assign(_b.mul(e)),e.assign(i.mul(e)),e.assign(kt(e,1e-10)),e.assign(is(e)),e.assign(e.sub(n).div(a.sub(n))),e.assign(xi(e,0,1)),e.assign(vb(e)),e.assign(s.mul(e)),e.assign(Ca(kt(R(0),e),R(2.2))),e.assign(Mb.mul(e)),e.assign(xi(e,0,1)),e}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),A(([r,t])=>{const e=b(.76),i=b(.15);r=r.mul(t);const s=Ge(r.r,Ge(r.g,r.b)),n=le(s.lessThan(.08),s.sub(tt(6.25,s.mul(s))),.04);r.subAssign(n);const a=kt(r.r,kt(r.g,r.b));Y(a.lessThan(e),()=>r);const o=yt(1,e),h=yt(1,o.mul(o).div(a.add(o.sub(e))));r.mulAssign(h.div(a));const l=yt(1,es(1,i.mul(a.sub(h)).add(1)));return Zt(r,R(h),l)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class Ie extends ${static get type(){return"CodeNode"}constructor(t="",e=[],i=""){super("code"),this.isCodeNode=!0,this.global=!0,this.code=t,this.includes=e,this.language=i}setIncludes(t){return this.includes=t,this}getIncludes(){return this.includes}generate(t){const e=this.getIncludes(t);for(const s of e)s.build(t);const i=t.getCodeFromNode(this,this.getNodeType(t));return i.code=this.code,i.code}serialize(t){super.serialize(t),t.code=this.code,t.language=this.language}deserialize(t){super.deserialize(t),this.code=t.code,this.language=t.language}}Z(Ie).setParameterLength(1,3);class wb extends ${static get type(){return"ScriptableValueNode"}constructor(t=null){super(),this._value=t,this._cache=null,this.inputType=null,this.outputType=null,this.events=new vs,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(t){this._value!==t&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=t,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const t=this.value;if(t&&this._cache===null&&this.inputType==="URL"&&t.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([t.value]));else if(t&&t.value!==null&&t.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof t.value=="string"||this.inputType==="Number"&&typeof t.value=="number"||this.inputType==="Vector2"&&t.value.isVector2||this.inputType==="Vector3"&&t.value.isVector3||this.inputType==="Vector4"&&t.value.isVector4||this.inputType==="Color"&&t.value.isColor||this.inputType==="Matrix3"&&t.value.isMatrix3||this.inputType==="Matrix4"&&t.value.isMatrix4))return t.value;return this._cache||t}getNodeType(t){return this.value&&this.value.isNode?this.value.getNodeType(t):"float"}setup(){return this.value&&this.value.isNode?this.value:b()}serialize(t){super.serialize(t),this.value!==null?this.inputType==="ArrayBuffer"?t.value=Ap(this.value):t.value=this.value?this.value.toJSON(t.meta).uuid:null:t.value=null,t.inputType=this.inputType,t.outputType=this.outputType}deserialize(t){super.deserialize(t);let e=null;t.value!==null&&(e=t.inputType==="ArrayBuffer"?Np(t.value):t.inputType==="Texture"?t.meta.textures[t.value]:t.meta.nodes[t.value]||null),this.value=e,this.inputType=t.inputType,this.outputType=t.outputType}}const Bc=Z(wb).setParameterLength(1);class Sf extends Map{get(t,e=null,...i){if(this.has(t))return super.get(t);if(e!==null){const s=e(...i);return this.set(t,s),s}}}class Tb{constructor(t){this.scriptableNode=t}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(t){return this.scriptableNode.getInputLayout(t)}get(t){const e=this.parameters[t];return e?e.getValue():null}}const Oc=new Sf;class Sb extends ${static get type(){return"ScriptableNode"}constructor(t=null,e={}){super(),this.codeNode=t,this.parameters=e,this._local=new Sf,this._output=Bc(null),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(t,e){return this._local.set(t,e)}getLocal(t){return this._local.get(t)}onRefresh(){this._refresh()}getInputLayout(t){for(const e of this.getLayout())if(e.inputType&&(e.id===t||e.name===t))return e}getOutputLayout(t){for(const e of this.getLayout())if(e.outputType&&(e.id===t||e.name===t))return e}setOutput(t,e){const i=this._outputs;return i[t]===void 0?i[t]=Bc(e):i[t].value=e,this}getOutput(t){return this._outputs[t]}getParameter(t){return this.parameters[t]}setParameter(t,e){const i=this.parameters;return e&&e.isScriptableNode?(this.deleteParameter(t),i[t]=e,i[t].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):e&&e.isScriptableValueNode?(this.deleteParameter(t),i[t]=e,i[t].events.addEventListener("refresh",this.onRefresh)):i[t]===void 0?(i[t]=Bc(e),i[t].events.addEventListener("refresh",this.onRefresh)):i[t].value=e,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(t){let e=this.parameters[t];return e&&(e.isScriptableNode&&(e=e.getDefaultOutput()),e.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const t of Object.keys(this.parameters))this.deleteParameter(t);return this.needsUpdate=!0,this}call(t,...e){const i=this.getObject()[t];if(typeof i=="function")return i(...e)}async callAsync(t,...e){const i=this.getObject()[t];if(typeof i=="function")return i.constructor.name==="AsyncFunction"?await i(...e):i(...e)}getNodeType(t){return this.getDefaultOutputNode().getNodeType(t)}refresh(t=null){t!==null?this.getOutput(t).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const t=new Tb(this),e=Oc.get("THREE"),i=Oc.get("TSL"),s=this.getMethod(),n=[t,this._local,Oc,()=>this.refresh(),(o,h)=>this.setOutput(o,h),e,i];this._object=s(...n);const a=this._object.layout;if(a&&(a.cache===!1&&this._local.clear(),this._output.outputType=a.outputType||null,Array.isArray(a.elements)))for(const o of a.elements){const h=o.id||o.name;o.inputType&&(this.getParameter(h)===void 0&&this.setParameter(h,null),this.getParameter(h).inputType=o.inputType),o.outputType&&(this.getOutput(h)===void 0&&this.setOutput(h,null),this.getOutput(h).outputType=o.outputType)}return this._object}deserialize(t){super.deserialize(t);for(const e in this.parameters){let i=this.parameters[e];i.isScriptableNode&&(i=i.getDefaultOutput()),i.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const t=this.getDefaultOutput().value;return t&&t.isNode?t:b()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const t=["layout","init","main","dispose"].join(", "),e=`
return { ...output, `+t+" };",i="var "+t+`; var output = {};
`+this.codeNode.code+e;return this._method=new Function("parameters","local","global","refresh","setOutput","THREE","TSL",i),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}getCacheKey(t){const e=[Wx(this.source),this.getDefaultOutputNode().getCacheKey(t)];for(const i in this.parameters)e.push(this.parameters[i].getCacheKey(t));return vp(e)}set needsUpdate(t){t===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null||(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value),this}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}Z(Sb).setParameterLength(1,2);function Af(r){let t;const e=r.context.getViewZ;return e!==void 0&&(t=e(this)),(t||ne.z).negate()}A(([r,t],e)=>{const i=Af(e);return dn(r,t,i)}),A(([r],t)=>{const e=Af(t);return r.mul(r,e,e).negate().exp().oneMinus()}),A(([r,t])=>J(t.toFloat().mix(Ra.rgb,r.toVec3()),Ra.a));let wn=null,Tn=null;class Ab extends ${static get type(){return"RangeNode"}constructor(t=b(),e=b()){super(),this.minNode=t,this.maxNode=e}getVectorLength(t){const e=t.getTypeLength(Ps(this.minNode.value)),i=t.getTypeLength(Ps(this.maxNode.value));return e>i?e:i}getNodeType(t){return t.object.count>1?t.getTypeFromLength(this.getVectorLength(t)):"float"}setup(t){const e=t.object;let i=null;if(e.count>1){const s=this.minNode.value,n=this.maxNode.value,a=t.getTypeLength(Ps(s)),o=t.getTypeLength(Ps(n));wn=wn||new wt,Tn=Tn||new wt,wn.setScalar(0),Tn.setScalar(0),a===1?wn.setScalar(s):s.isColor?wn.set(s.r,s.g,s.b,1):wn.set(s.x,s.y,s.z||0,s.w||0),o===1?Tn.setScalar(n):n.isColor?Tn.set(n.r,n.g,n.b,1):Tn.set(n.x,n.y,n.z||0,n.w||0);const h=4,l=h*e.count,u=new Float32Array(l);for(let d=0;d<l;d++){const p=d%h,m=wn.getComponent(p),f=Tn.getComponent(p);u[d]=Zl.lerp(m,f,Math.random())}const c=this.getNodeType(t);if(e.count<=4096)i=rc(u,"vec4",e.count).element(ph).convert(c);else{const d=new ma(u,4);t.geometry.setAttribute("__range"+this.id,d),i=nc(d).convert(c)}}else i=b(0);return i}}Z(Ab).setParameterLength(2);class Nb extends ${static get type(){return"ComputeBuiltinNode"}constructor(t,e){super(e),this._builtinName=t}getHash(t){return this.getBuiltinName(t)}getNodeType(){return this.nodeType}setBuiltinName(t){return this._builtinName=t,this}getBuiltinName(){return this._builtinName}hasBuiltin(t){return t.hasBuiltin(this._builtinName)}generate(t,e){const i=this.getBuiltinName(t),s=this.getNodeType(t);return t.shaderStage==="compute"?t.format(i,s,e):(j(`ComputeBuiltinNode: Compute built-in value ${i} can not be accessed in the ${t.shaderStage} stage`),t.generateConst(s))}serialize(t){super.serialize(t),t.global=this.global,t._builtinName=this._builtinName}deserialize(t){super.deserialize(t),this.global=t.global,this._builtinName=t._builtinName}}const Wa=(r,t)=>V(new Nb(r,t));Wa("numWorkgroups","uvec3"),Wa("workgroupId","uvec3"),Wa("globalId","uvec3"),Wa("localId","uvec3"),Wa("subgroupSize","uint"),Z(class extends ${constructor(r){super(),this.scope=r}generate(r){const{scope:t}=this,{renderer:e}=r;e.backend.isWebGLBackend===!0?r.addFlowCode(`	// ${t}Barrier 
`):r.addLineFlowCode(`${t}Barrier()`,this)}});class Fi extends ${static get type(){return"AtomicFunctionNode"}constructor(t,e,i){super("uint"),this.method=t,this.pointerNode=e,this.valueNode=i,this.parents=!0}getInputType(t){return this.pointerNode.getNodeType(t)}getNodeType(t){return this.getInputType(t)}generate(t){const e=t.getNodeProperties(this),i=e.parents,s=this.method,n=this.getNodeType(t),a=this.getInputType(t),o=this.pointerNode,h=this.valueNode,l=[];l.push(`&${o.build(t,a)}`),h!==null&&l.push(h.build(t,a));const u=`${t.getMethod(s,n)}( ${l.join(", ")} )`;if(!(i&&i.length===1&&i[0].isStackNode===!0))return e.constNode===void 0&&(e.constNode=hr(u,n).toConst()),e.constNode.build(t);t.addLineFlowCode(u,this)}}Fi.ATOMIC_LOAD="atomicLoad",Fi.ATOMIC_STORE="atomicStore",Fi.ATOMIC_ADD="atomicAdd",Fi.ATOMIC_SUB="atomicSub",Fi.ATOMIC_MAX="atomicMax",Fi.ATOMIC_MIN="atomicMin",Fi.ATOMIC_AND="atomicAnd",Fi.ATOMIC_OR="atomicOr",Fi.ATOMIC_XOR="atomicXor",Z(Fi);class W extends Ft{static get type(){return"SubgroupFunctionNode"}constructor(t,e=null,i=null){super(),this.method=t,this.aNode=e,this.bNode=i}getInputType(t){const e=this.aNode?this.aNode.getNodeType(t):null,i=this.bNode?this.bNode.getNodeType(t):null;return(t.isMatrix(e)?0:t.getTypeLength(e))>(t.isMatrix(i)?0:t.getTypeLength(i))?e:i}getNodeType(t){const e=this.method;return e===W.SUBGROUP_ELECT?"bool":e===W.SUBGROUP_BALLOT?"uvec4":this.getInputType(t)}generate(t,e){const i=this.method,s=this.getNodeType(t),n=this.getInputType(t),a=this.aNode,o=this.bNode,h=[];if(i===W.SUBGROUP_BROADCAST||i===W.SUBGROUP_SHUFFLE||i===W.QUAD_BROADCAST){const u=o.getNodeType(t);h.push(a.build(t,s),o.build(t,u==="float"?"int":s))}else i===W.SUBGROUP_SHUFFLE_XOR||i===W.SUBGROUP_SHUFFLE_DOWN||i===W.SUBGROUP_SHUFFLE_UP?h.push(a.build(t,s),o.build(t,"uint")):(a!==null&&h.push(a.build(t,n)),o!==null&&h.push(o.build(t,n)));const l=h.length===0?"()":`( ${h.join(", ")} )`;return t.format(`${t.getMethod(i,s)}${l}`,s,e)}serialize(t){super.serialize(t),t.method=this.method}deserialize(t){super.deserialize(t),this.method=t.method}}W.SUBGROUP_ELECT="subgroupElect",W.SUBGROUP_BALLOT="subgroupBallot",W.SUBGROUP_ADD="subgroupAdd",W.SUBGROUP_INCLUSIVE_ADD="subgroupInclusiveAdd",W.SUBGROUP_EXCLUSIVE_AND="subgroupExclusiveAdd",W.SUBGROUP_MUL="subgroupMul",W.SUBGROUP_INCLUSIVE_MUL="subgroupInclusiveMul",W.SUBGROUP_EXCLUSIVE_MUL="subgroupExclusiveMul",W.SUBGROUP_AND="subgroupAnd",W.SUBGROUP_OR="subgroupOr",W.SUBGROUP_XOR="subgroupXor",W.SUBGROUP_MIN="subgroupMin",W.SUBGROUP_MAX="subgroupMax",W.SUBGROUP_ALL="subgroupAll",W.SUBGROUP_ANY="subgroupAny",W.SUBGROUP_BROADCAST_FIRST="subgroupBroadcastFirst",W.QUAD_SWAP_X="quadSwapX",W.QUAD_SWAP_Y="quadSwapY",W.QUAD_SWAP_DIAGONAL="quadSwapDiagonal",W.SUBGROUP_BROADCAST="subgroupBroadcast",W.SUBGROUP_SHUFFLE="subgroupShuffle",W.SUBGROUP_SHUFFLE_XOR="subgroupShuffleXor",W.SUBGROUP_SHUFFLE_UP="subgroupShuffleUp",W.SUBGROUP_SHUFFLE_DOWN="subgroupShuffleDown",W.QUAD_BROADCAST="quadBroadcast",k(W,W.SUBGROUP_ELECT).setParameterLength(0),k(W,W.SUBGROUP_BALLOT).setParameterLength(1),k(W,W.SUBGROUP_ADD).setParameterLength(1),k(W,W.SUBGROUP_INCLUSIVE_ADD).setParameterLength(1),k(W,W.SUBGROUP_EXCLUSIVE_AND).setParameterLength(1),k(W,W.SUBGROUP_MUL).setParameterLength(1),k(W,W.SUBGROUP_INCLUSIVE_MUL).setParameterLength(1),k(W,W.SUBGROUP_EXCLUSIVE_MUL).setParameterLength(1),k(W,W.SUBGROUP_AND).setParameterLength(1),k(W,W.SUBGROUP_OR).setParameterLength(1),k(W,W.SUBGROUP_XOR).setParameterLength(1),k(W,W.SUBGROUP_MIN).setParameterLength(1),k(W,W.SUBGROUP_MAX).setParameterLength(1),k(W,W.SUBGROUP_ALL).setParameterLength(0),k(W,W.SUBGROUP_ANY).setParameterLength(0),k(W,W.SUBGROUP_BROADCAST_FIRST).setParameterLength(2),k(W,W.QUAD_SWAP_X).setParameterLength(1),k(W,W.QUAD_SWAP_Y).setParameterLength(1),k(W,W.QUAD_SWAP_DIAGONAL).setParameterLength(1),k(W,W.SUBGROUP_BROADCAST).setParameterLength(2),k(W,W.SUBGROUP_SHUFFLE).setParameterLength(2),k(W,W.SUBGROUP_SHUFFLE_XOR).setParameterLength(2),k(W,W.SUBGROUP_SHUFFLE_UP).setParameterLength(2),k(W,W.SUBGROUP_SHUFFLE_DOWN).setParameterLength(2),k(W,W.QUAD_BROADCAST).setParameterLength(1);const Rb=(r,t)=>{for(const e of t)if(e.isAnalyticLightNode&&e.light.id===r)return e;return null},Vc=new WeakMap,Ha=[];class Eb extends ${static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=Bs("vec3","totalDiffuse"),this.totalSpecularNode=Bs("vec3","totalSpecular"),this.outgoingLightNode=Bs("vec3","outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const t=this._lights;for(let i=0;i<t.length;i++){const s=t[i];if(Ha.push(s.id),Ha.push(s.castShadow?1:0),s.isSpotLight===!0){const n=s.map!==null?s.map.id:-1,a=s.colorNode?s.colorNode.getCacheKey():-1;Ha.push(n,a)}}const e=vp(Ha);return Ha.length=0,e}getHash(t){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(t);const e=[];for(const i of this._lightNodes)e.push(i.getHash());this._lightNodesHash="lights-"+e.join(",")}return this._lightNodesHash}analyze(t){const e=t.getNodeProperties(this);for(const i of e.nodes)i.build(t);e.outputNode.build(t)}setupLightsNode(t){const e=[],i=this._lightNodes,s=(a=>a.sort((o,h)=>o.id-h.id))(this._lights),n=t.renderer.library;for(const a of s)if(a.isNode)e.push(V(a));else{let o=null;if(i!==null&&(o=Rb(a.id,i)),o===null){const h=n.getLightNodeClass(a.constructor);if(h===null){j(`LightsNode.setupNodeLights: Light node not found for ${a.constructor.name}`);continue}let l=null;Vc.has(a)?l=Vc.get(a):(l=V(new h(a)),Vc.set(a,l)),e.push(l)}}this._lightNodes=e}setupDirectLight(t,e,i){const{lightingModel:s,reflectedLight:n}=t.context;s.direct({...i,lightNode:e,reflectedLight:n},t)}setupDirectRectAreaLight(t,e,i){const{lightingModel:s,reflectedLight:n}=t.context;s.directRectArea({...i,lightNode:e,reflectedLight:n},t)}setupLights(t,e){for(const i of e)i.build(t)}getLightNodes(t){return this._lightNodes===null&&this.setupLightsNode(t),this._lightNodes}setup(t){const e=t.lightsNode;t.lightsNode=this;let i=this.outgoingLightNode;const s=t.context,n=s.lightingModel,a=t.getNodeProperties(this);if(n){const{totalDiffuseNode:o,totalSpecularNode:h}=this;s.outgoingLight=i;const l=t.addStack();a.nodes=l.nodes,n.start(t);const{backdrop:u,backdropAlpha:c}=s,{directDiffuse:d,directSpecular:p,indirectDiffuse:m,indirectSpecular:f}=s.reflectedLight;let g=d.add(m);u!==null&&(g=R(c!==null?c.mix(g,u):u),s.material.transparent=!0),o.assign(g),h.assign(p.add(f)),i.assign(o.add(h)),n.finish(t),i=i.bypass(t.removeStack())}else a.nodes=[];return t.lightsNode=e,i}setLights(t){return this._lights=t,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}Bs("vec3","shadowPositionWorld"),A(({depthTexture:r,shadowCoord:t,depthLayer:e})=>{let i=Bt(r,t.xy).setName("t_basic");return r.isArrayTexture&&(i=i.depth(e)),i.compare(t.z)}),A(({depthTexture:r,shadowCoord:t,shadow:e,depthLayer:i})=>{const s=(g,y)=>{let x=Bt(r,g);return r.isArrayTexture&&(x=x.depth(i)),x.compare(y)},n=Je("mapSize","vec2",e).setGroup(pt),a=Je("radius","float",e).setGroup(pt),o=B(1).div(n),h=o.x.negate().mul(a),l=o.y.negate().mul(a),u=o.x.mul(a),c=o.y.mul(a),d=h.div(2),p=l.div(2),m=u.div(2),f=c.div(2);return ie(s(t.xy.add(B(h,l)),t.z),s(t.xy.add(B(0,l)),t.z),s(t.xy.add(B(u,l)),t.z),s(t.xy.add(B(d,p)),t.z),s(t.xy.add(B(0,p)),t.z),s(t.xy.add(B(m,p)),t.z),s(t.xy.add(B(h,0)),t.z),s(t.xy.add(B(d,0)),t.z),s(t.xy,t.z),s(t.xy.add(B(m,0)),t.z),s(t.xy.add(B(u,0)),t.z),s(t.xy.add(B(d,f)),t.z),s(t.xy.add(B(0,f)),t.z),s(t.xy.add(B(m,f)),t.z),s(t.xy.add(B(h,c)),t.z),s(t.xy.add(B(0,c)),t.z),s(t.xy.add(B(u,c)),t.z)).mul(1/17)}),A(({depthTexture:r,shadowCoord:t,shadow:e,depthLayer:i})=>{const s=(c,d)=>{let p=Bt(r,c);return r.isArrayTexture&&(p=p.depth(i)),p.compare(d)},n=Je("mapSize","vec2",e).setGroup(pt),a=B(1).div(n),o=a.x,h=a.y,l=t.xy,u=Os(l.mul(n).add(.5));return l.subAssign(u.mul(a)),ie(s(l,t.z),s(l.add(B(o,0)),t.z),s(l.add(B(0,h)),t.z),s(l.add(a),t.z),Zt(s(l.add(B(o.negate(),0)),t.z),s(l.add(B(o.mul(2),0)),t.z),u.x),Zt(s(l.add(B(o.negate(),h)),t.z),s(l.add(B(o.mul(2),h)),t.z),u.x),Zt(s(l.add(B(0,h.negate())),t.z),s(l.add(B(0,h.mul(2))),t.z),u.y),Zt(s(l.add(B(o,h.negate())),t.z),s(l.add(B(o,h.mul(2))),t.z),u.y),Zt(Zt(s(l.add(B(o.negate(),h.negate())),t.z),s(l.add(B(o.mul(2),h.negate())),t.z),u.x),Zt(s(l.add(B(o.negate(),h.mul(2))),t.z),s(l.add(B(o.mul(2),h.mul(2))),t.z),u.x),u.y)).mul(1/9)}),A(({depthTexture:r,shadowCoord:t,depthLayer:e})=>{const i=b(1).toVar();let s=Bt(r).sample(t.xy);r.isArrayTexture&&(s=s.depth(e)),s=s.rg;const n=Qu(t.z,s.x);return Y(n.notEqual(b(1)),()=>{const a=t.z.sub(s.x),o=kt(0,s.y.mul(s.y));let h=o.div(o.add(a.mul(a)));h=xi(yt(h,.3).div(.95-.3)),i.assign(xi(kt(n,h)))}),i}),A(([r,t,e])=>{let i=hh.sub(r).length();return i=i.sub(t).div(e.sub(t)),i=i.saturate(),i}),A(({samples:r,radius:t,size:e,shadowPass:i,depthLayer:s})=>{const n=b(0).toVar("meanVertical"),a=b(0).toVar("squareMeanVertical"),o=r.lessThanEqual(b(1)).select(b(0),b(2).div(r.sub(1))),h=r.lessThanEqual(b(1)).select(b(0),b(-1));vt({start:w(0),end:w(r),type:"int",condition:"<"},({i:u})=>{const c=h.add(b(u).mul(o));let d=i.sample(ie(oh.xy,B(0,c).mul(t)).div(e));i.value.isArrayTexture&&(d=d.depth(s)),d=d.x,n.addAssign(d),a.addAssign(d.mul(d))}),n.divAssign(r),a.divAssign(r);const l=ss(a.sub(n.mul(n)));return B(n,l)}),A(({samples:r,radius:t,size:e,shadowPass:i,depthLayer:s})=>{const n=b(0).toVar("meanHorizontal"),a=b(0).toVar("squareMeanHorizontal"),o=r.lessThanEqual(b(1)).select(b(0),b(2).div(r.sub(1))),h=r.lessThanEqual(b(1)).select(b(0),b(-1));vt({start:w(0),end:w(r),type:"int",condition:"<"},({i:u})=>{const c=h.add(b(u).mul(o));let d=i.sample(ie(oh.xy,B(c,0).mul(t)).div(e));i.value.isArrayTexture&&(d=d.depth(s)),n.addAssign(d.x),a.addAssign(ie(d.y.mul(d.y),d.x.mul(d.x)))}),n.divAssign(r),a.divAssign(r);const l=ss(a.sub(n.mul(n)));return B(n,l)}),new cb,new ut;const ki=A(([r,t])=>{const e=r.toVar(),i=Nt(e),s=es(1,kt(i.x,kt(i.y,i.z)));i.mulAssign(s),e.mulAssign(s.mul(t.mul(2).oneMinus()));const n=B(e.xy).toVar(),a=t.mul(1.5).oneMinus();return Y(i.z.greaterThanEqual(a),()=>{Y(e.z.greaterThan(0),()=>{n.x.assign(yt(4,e.x))})}).ElseIf(i.x.greaterThanEqual(a),()=>{const o=rh(e.x);n.x.assign(e.z.mul(o).add(o.mul(2)))}).ElseIf(i.y.greaterThanEqual(a),()=>{const o=rh(e.y);n.x.assign(e.x.add(o.mul(2)).add(2)),n.y.assign(e.z.mul(o).sub(2))}),B(.125,.25).mul(n).add(B(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]});A(({depthTexture:r,bd3D:t,dp:e,texelSize:i})=>Bt(r,ki(t,i.y)).compare(e)),A(({depthTexture:r,bd3D:t,dp:e,texelSize:i,shadow:s})=>{const n=Je("radius","float",s).setGroup(pt),a=B(-1,1).mul(n).mul(i.y);return Bt(r,ki(t.add(a.xyy),i.y)).compare(e).add(Bt(r,ki(t.add(a.yyy),i.y)).compare(e)).add(Bt(r,ki(t.add(a.xyx),i.y)).compare(e)).add(Bt(r,ki(t.add(a.yyx),i.y)).compare(e)).add(Bt(r,ki(t,i.y)).compare(e)).add(Bt(r,ki(t.add(a.xxy),i.y)).compare(e)).add(Bt(r,ki(t.add(a.yxy),i.y)).compare(e)).add(Bt(r,ki(t.add(a.xxx),i.y)).compare(e)).add(Bt(r,ki(t.add(a.yxx),i.y)).compare(e)).mul(1/9)}),A(({filterFn:r,depthTexture:t,shadowCoord:e,shadow:i})=>{const s=e.xyz.toVar(),n=s.length(),a=K("float").setGroup(pt).onRenderUpdate(()=>i.camera.near),o=K("float").setGroup(pt).onRenderUpdate(()=>i.camera.far),h=Je("bias","float",i).setGroup(pt),l=K(i.mapSize).setGroup(pt),u=b(1).toVar();return Y(n.sub(o).lessThanEqual(0).and(n.sub(a).greaterThanEqual(0)),()=>{const c=n.sub(a).div(o.sub(a)).toVar();c.addAssign(h);const d=s.normalize(),p=B(1).div(l.mul(B(4,2)));u.assign(r({depthTexture:t,bd3D:d,dp:c,texelSize:p,shadow:i}))}),u}),new wt,new nt,new nt,A(({lightDistance:r,cutoffDistance:t,decayExponent:e})=>{const i=r.pow(e).max(.01).reciprocal();return t.greaterThan(0).select(i.mul(r.div(t).pow4().oneMinus().clamp().pow2()),i)}),A(([r=fn()])=>{const t=r.mul(2),e=t.x.floor(),i=t.y.floor();return e.add(i).mod(2).sign()}),A(([r=fn()],{renderer:t,material:e})=>{const i=Qp(r.mul(2).sub(1));let s;if(e.alphaToCoverage&&t.samples>1){const n=b(i.fwidth()).toVar();s=dn(n.oneMinus(),n.add(1),i).oneMinus()}else s=le(i.greaterThan(1),0,1);return s});const qa=A(([r,t,e])=>{const i=b(e).toVar(),s=b(t).toVar(),n=fi(r).toVar();return le(n,s,i)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),Sh=A(([r,t])=>{const e=fi(t).toVar(),i=b(r).toVar();return le(e,i.negate(),i)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),Ut=A(([r])=>{const t=b(r).toVar();return w(ns(t))}).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),It=A(([r,t])=>{const e=b(r).toVar();return t.assign(Ut(e)),e.sub(b(t))}),Nf=me([A(([r,t,e,i,s,n])=>{const a=b(n).toVar(),o=b(s).toVar(),h=b(i).toVar(),l=b(e).toVar(),u=b(t).toVar(),c=b(r).toVar(),d=b(yt(1,o)).toVar();return yt(1,a).mul(c.mul(d).add(u.mul(o))).add(a.mul(l.mul(d).add(h.mul(o))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),A(([r,t,e,i,s,n])=>{const a=b(n).toVar(),o=b(s).toVar(),h=R(i).toVar(),l=R(e).toVar(),u=R(t).toVar(),c=R(r).toVar(),d=b(yt(1,o)).toVar();return yt(1,a).mul(c.mul(d).add(u.mul(o))).add(a.mul(l.mul(d).add(h.mul(o))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]})]),Rf=me([A(([r,t,e,i,s,n,a,o,h,l,u])=>{const c=b(u).toVar(),d=b(l).toVar(),p=b(h).toVar(),m=b(o).toVar(),f=b(a).toVar(),g=b(n).toVar(),y=b(s).toVar(),x=b(i).toVar(),_=b(e).toVar(),M=b(t).toVar(),v=b(r).toVar(),N=b(yt(1,p)).toVar(),T=b(yt(1,d)).toVar();return b(yt(1,c)).toVar().mul(T.mul(v.mul(N).add(M.mul(p))).add(d.mul(_.mul(N).add(x.mul(p))))).add(c.mul(T.mul(y.mul(N).add(g.mul(p))).add(d.mul(f.mul(N).add(m.mul(p))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),A(([r,t,e,i,s,n,a,o,h,l,u])=>{const c=b(u).toVar(),d=b(l).toVar(),p=b(h).toVar(),m=R(o).toVar(),f=R(a).toVar(),g=R(n).toVar(),y=R(s).toVar(),x=R(i).toVar(),_=R(e).toVar(),M=R(t).toVar(),v=R(r).toVar(),N=b(yt(1,p)).toVar(),T=b(yt(1,d)).toVar();return b(yt(1,c)).toVar().mul(T.mul(v.mul(N).add(M.mul(p))).add(d.mul(_.mul(N).add(x.mul(p))))).add(c.mul(T.mul(y.mul(N).add(g.mul(p))).add(d.mul(f.mul(N).add(m.mul(p))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]})]),Ib=A(([r,t,e])=>{const i=b(e).toVar(),s=b(t).toVar(),n=H(r).toVar(),a=H(n.bitAnd(H(7))).toVar(),o=b(qa(a.lessThan(H(4)),s,i)).toVar(),h=b(tt(2,qa(a.lessThan(H(4)),i,s))).toVar();return Sh(o,fi(a.bitAnd(H(1)))).add(Sh(h,fi(a.bitAnd(H(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),Cb=A(([r,t,e,i])=>{const s=b(i).toVar(),n=b(e).toVar(),a=b(t).toVar(),o=H(r).toVar(),h=H(o.bitAnd(H(15))).toVar(),l=b(qa(h.lessThan(H(8)),a,n)).toVar(),u=b(qa(h.lessThan(H(4)),n,qa(h.equal(H(12)).or(h.equal(H(14))),a,s))).toVar();return Sh(l,fi(h.bitAnd(H(1)))).add(Sh(u,fi(h.bitAnd(H(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),re=me([Ib,Cb]),zb=A(([r,t,e])=>{const i=b(e).toVar(),s=b(t).toVar(),n=Aa(r).toVar();return R(re(n.x,s,i),re(n.y,s,i),re(n.z,s,i))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),Lb=A(([r,t,e,i])=>{const s=b(i).toVar(),n=b(e).toVar(),a=b(t).toVar(),o=Aa(r).toVar();return R(re(o.x,a,n,s),re(o.y,a,n,s),re(o.z,a,n,s))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),Ke=me([zb,Lb]),Pb=A(([r])=>{const t=b(r).toVar();return tt(.6616,t)}).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),Bb=A(([r])=>{const t=b(r).toVar();return tt(.982,t)}).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),Ef=me([Pb,A(([r])=>{const t=R(r).toVar();return tt(.6616,t)}).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]})]),If=me([Bb,A(([r])=>{const t=R(r).toVar();return tt(.982,t)}).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]})]),Ve=A(([r,t])=>{const e=w(t).toVar(),i=H(r).toVar();return i.shiftLeft(e).bitOr(i.shiftRight(w(32).sub(e)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),Cf=A(([r,t,e])=>{r.subAssign(e),r.bitXorAssign(Ve(e,w(4))),e.addAssign(t),t.subAssign(r),t.bitXorAssign(Ve(r,w(6))),r.addAssign(e),e.subAssign(t),e.bitXorAssign(Ve(t,w(8))),t.addAssign(r),r.subAssign(e),r.bitXorAssign(Ve(e,w(16))),e.addAssign(t),t.subAssign(r),t.bitXorAssign(Ve(r,w(19))),r.addAssign(e),e.subAssign(t),e.bitXorAssign(Ve(t,w(4))),t.addAssign(r)}),$a=A(([r,t,e])=>{const i=H(e).toVar(),s=H(t).toVar(),n=H(r).toVar();return i.bitXorAssign(s),i.subAssign(Ve(s,w(14))),n.bitXorAssign(i),n.subAssign(Ve(i,w(11))),s.bitXorAssign(n),s.subAssign(Ve(n,w(25))),i.bitXorAssign(s),i.subAssign(Ve(s,w(16))),n.bitXorAssign(i),n.subAssign(Ve(i,w(4))),s.bitXorAssign(n),s.subAssign(Ve(n,w(14))),i.bitXorAssign(s),i.subAssign(Ve(s,w(24))),i}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),fe=A(([r])=>{const t=H(r).toVar();return b(t).div(b(H(w(4294967295))))}).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),Di=A(([r])=>{const t=b(r).toVar();return t.mul(t).mul(t).mul(t.mul(t.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),Mt=me([A(([r])=>{const t=w(r).toVar(),e=H(H(1)).toVar(),i=H(H(w(3735928559)).add(e.shiftLeft(H(2))).add(H(13))).toVar();return $a(i.add(H(t)),i,i)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),A(([r,t])=>{const e=w(t).toVar(),i=w(r).toVar(),s=H(H(2)).toVar(),n=H().toVar(),a=H().toVar(),o=H().toVar();return n.assign(a.assign(o.assign(H(w(3735928559)).add(s.shiftLeft(H(2))).add(H(13))))),n.addAssign(H(i)),a.addAssign(H(e)),$a(n,a,o)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),A(([r,t,e])=>{const i=w(e).toVar(),s=w(t).toVar(),n=w(r).toVar(),a=H(H(3)).toVar(),o=H().toVar(),h=H().toVar(),l=H().toVar();return o.assign(h.assign(l.assign(H(w(3735928559)).add(a.shiftLeft(H(2))).add(H(13))))),o.addAssign(H(n)),h.addAssign(H(s)),l.addAssign(H(i)),$a(o,h,l)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),A(([r,t,e,i])=>{const s=w(i).toVar(),n=w(e).toVar(),a=w(t).toVar(),o=w(r).toVar(),h=H(H(4)).toVar(),l=H().toVar(),u=H().toVar(),c=H().toVar();return l.assign(u.assign(c.assign(H(w(3735928559)).add(h.shiftLeft(H(2))).add(H(13))))),l.addAssign(H(o)),u.addAssign(H(a)),c.addAssign(H(n)),Cf(l,u,c),l.addAssign(H(s)),$a(l,u,c)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),A(([r,t,e,i,s])=>{const n=w(s).toVar(),a=w(i).toVar(),o=w(e).toVar(),h=w(t).toVar(),l=w(r).toVar(),u=H(H(5)).toVar(),c=H().toVar(),d=H().toVar(),p=H().toVar();return c.assign(d.assign(p.assign(H(w(3735928559)).add(u.shiftLeft(H(2))).add(H(13))))),c.addAssign(H(l)),d.addAssign(H(h)),p.addAssign(H(o)),Cf(c,d,p),c.addAssign(H(a)),d.addAssign(H(n)),$a(c,d,p)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]})]),ti=me([A(([r,t])=>{const e=w(t).toVar(),i=w(r).toVar(),s=H(Mt(i,e)).toVar(),n=Aa().toVar();return n.x.assign(s.bitAnd(w(255))),n.y.assign(s.shiftRight(w(8)).bitAnd(w(255))),n.z.assign(s.shiftRight(w(16)).bitAnd(w(255))),n}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),A(([r,t,e])=>{const i=w(e).toVar(),s=w(t).toVar(),n=w(r).toVar(),a=H(Mt(n,s,i)).toVar(),o=Aa().toVar();return o.x.assign(a.bitAnd(w(255))),o.y.assign(a.shiftRight(w(8)).bitAnd(w(255))),o.z.assign(a.shiftRight(w(16)).bitAnd(w(255))),o}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]})]),Ob=me([A(([r])=>{const t=B(r).toVar(),e=w().toVar(),i=w().toVar(),s=b(It(t.x,e)).toVar(),n=b(It(t.y,i)).toVar(),a=b(Di(s)).toVar(),o=b(Di(n)).toVar(),h=b(Nf(re(Mt(e,i),s,n),re(Mt(e.add(w(1)),i),s.sub(1),n),re(Mt(e,i.add(w(1))),s,n.sub(1)),re(Mt(e.add(w(1)),i.add(w(1))),s.sub(1),n.sub(1)),a,o)).toVar();return Ef(h)}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),A(([r])=>{const t=R(r).toVar(),e=w().toVar(),i=w().toVar(),s=w().toVar(),n=b(It(t.x,e)).toVar(),a=b(It(t.y,i)).toVar(),o=b(It(t.z,s)).toVar(),h=b(Di(n)).toVar(),l=b(Di(a)).toVar(),u=b(Di(o)).toVar(),c=b(Rf(re(Mt(e,i,s),n,a,o),re(Mt(e.add(w(1)),i,s),n.sub(1),a,o),re(Mt(e,i.add(w(1)),s),n,a.sub(1),o),re(Mt(e.add(w(1)),i.add(w(1)),s),n.sub(1),a.sub(1),o),re(Mt(e,i,s.add(w(1))),n,a,o.sub(1)),re(Mt(e.add(w(1)),i,s.add(w(1))),n.sub(1),a,o.sub(1)),re(Mt(e,i.add(w(1)),s.add(w(1))),n,a.sub(1),o.sub(1)),re(Mt(e.add(w(1)),i.add(w(1)),s.add(w(1))),n.sub(1),a.sub(1),o.sub(1)),h,l,u)).toVar();return If(c)}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]})]),Fc=me([A(([r])=>{const t=B(r).toVar(),e=w().toVar(),i=w().toVar(),s=b(It(t.x,e)).toVar(),n=b(It(t.y,i)).toVar(),a=b(Di(s)).toVar(),o=b(Di(n)).toVar(),h=R(Nf(Ke(ti(e,i),s,n),Ke(ti(e.add(w(1)),i),s.sub(1),n),Ke(ti(e,i.add(w(1))),s,n.sub(1)),Ke(ti(e.add(w(1)),i.add(w(1))),s.sub(1),n.sub(1)),a,o)).toVar();return Ef(h)}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),A(([r])=>{const t=R(r).toVar(),e=w().toVar(),i=w().toVar(),s=w().toVar(),n=b(It(t.x,e)).toVar(),a=b(It(t.y,i)).toVar(),o=b(It(t.z,s)).toVar(),h=b(Di(n)).toVar(),l=b(Di(a)).toVar(),u=b(Di(o)).toVar(),c=R(Rf(Ke(ti(e,i,s),n,a,o),Ke(ti(e.add(w(1)),i,s),n.sub(1),a,o),Ke(ti(e,i.add(w(1)),s),n,a.sub(1),o),Ke(ti(e.add(w(1)),i.add(w(1)),s),n.sub(1),a.sub(1),o),Ke(ti(e,i,s.add(w(1))),n,a,o.sub(1)),Ke(ti(e.add(w(1)),i,s.add(w(1))),n.sub(1),a,o.sub(1)),Ke(ti(e,i.add(w(1)),s.add(w(1))),n,a.sub(1),o.sub(1)),Ke(ti(e.add(w(1)),i.add(w(1)),s.add(w(1))),n.sub(1),a.sub(1),o.sub(1)),h,l,u)).toVar();return If(c)}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]})]);me([A(([r])=>{const t=b(r).toVar(),e=w(Ut(t)).toVar();return fe(Mt(e))}).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),A(([r])=>{const t=B(r).toVar(),e=w(Ut(t.x)).toVar(),i=w(Ut(t.y)).toVar();return fe(Mt(e,i))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),A(([r])=>{const t=R(r).toVar(),e=w(Ut(t.x)).toVar(),i=w(Ut(t.y)).toVar(),s=w(Ut(t.z)).toVar();return fe(Mt(e,i,s))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),A(([r])=>{const t=J(r).toVar(),e=w(Ut(t.x)).toVar(),i=w(Ut(t.y)).toVar(),s=w(Ut(t.z)).toVar(),n=w(Ut(t.w)).toVar();return fe(Mt(e,i,s,n))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]})]);const Ah=me([A(([r])=>{const t=b(r).toVar(),e=w(Ut(t)).toVar();return R(fe(Mt(e,w(0))),fe(Mt(e,w(1))),fe(Mt(e,w(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),A(([r])=>{const t=B(r).toVar(),e=w(Ut(t.x)).toVar(),i=w(Ut(t.y)).toVar();return R(fe(Mt(e,i,w(0))),fe(Mt(e,i,w(1))),fe(Mt(e,i,w(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),A(([r])=>{const t=R(r).toVar(),e=w(Ut(t.x)).toVar(),i=w(Ut(t.y)).toVar(),s=w(Ut(t.z)).toVar();return R(fe(Mt(e,i,s,w(0))),fe(Mt(e,i,s,w(1))),fe(Mt(e,i,s,w(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),A(([r])=>{const t=J(r).toVar(),e=w(Ut(t.x)).toVar(),i=w(Ut(t.y)).toVar(),s=w(Ut(t.z)).toVar(),n=w(Ut(t.w)).toVar();return R(fe(Mt(e,i,s,n,w(0))),fe(Mt(e,i,s,n,w(1))),fe(Mt(e,i,s,n,w(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]})]),kc=A(([r,t,e,i])=>{const s=b(i).toVar(),n=b(e).toVar(),a=w(t).toVar(),o=R(r).toVar(),h=b(0).toVar(),l=b(1).toVar();return vt(a,()=>{h.addAssign(l.mul(Ob(o))),l.mulAssign(s),o.mulAssign(n)}),h}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Dc=A(([r,t,e,i])=>{const s=b(i).toVar(),n=b(e).toVar(),a=w(t).toVar(),o=R(r).toVar(),h=R(0).toVar(),l=b(1).toVar();return vt(a,()=>{h.addAssign(l.mul(Fc(o))),l.mulAssign(s),o.mulAssign(n)}),h}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});A(([r,t,e,i])=>{const s=b(i).toVar(),n=b(e).toVar(),a=w(t).toVar(),o=R(r).toVar();return B(kc(o,a,n,s),kc(o.add(R(w(19),w(193),w(17))),a,n,s))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),A(([r,t,e,i])=>{const s=b(i).toVar(),n=b(e).toVar(),a=w(t).toVar(),o=R(r).toVar(),h=R(Dc(o,a,n,s)).toVar(),l=b(kc(o.add(R(w(19),w(193),w(17))),a,n,s)).toVar();return J(h,l)}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]});const pr=me([A(([r,t,e,i,s,n,a])=>{const o=w(a).toVar(),h=b(n).toVar(),l=w(s).toVar(),u=w(i).toVar(),c=w(e).toVar(),d=w(t).toVar(),p=B(r).toVar(),m=R(Ah(B(d.add(u),c.add(l)))).toVar(),f=B(m.x,m.y).toVar();f.subAssign(.5),f.mulAssign(h),f.addAssign(.5);const g=B(B(b(d),b(c)).add(f)).toVar(),y=B(g.sub(p)).toVar();return Y(o.equal(w(2)),()=>Nt(y.x).add(Nt(y.y))),Y(o.equal(w(3)),()=>kt(Nt(y.x),Nt(y.y))),cn(y,y)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),A(([r,t,e,i,s,n,a,o,h])=>{const l=w(h).toVar(),u=b(o).toVar(),c=w(a).toVar(),d=w(n).toVar(),p=w(s).toVar(),m=w(i).toVar(),f=w(e).toVar(),g=w(t).toVar(),y=R(r).toVar(),x=R(Ah(R(g.add(p),f.add(d),m.add(c)))).toVar();x.subAssign(.5),x.mulAssign(u),x.addAssign(.5);const _=R(R(b(g),b(f),b(m)).add(x)).toVar(),M=R(_.sub(y)).toVar();return Y(l.equal(w(2)),()=>Nt(M.x).add(Nt(M.y)).add(Nt(M.z))),Y(l.equal(w(3)),()=>kt(Nt(M.x),Nt(M.y),Nt(M.z))),cn(M,M)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]})]),Vb=A(([r,t,e])=>{const i=w(e).toVar(),s=b(t).toVar(),n=B(r).toVar(),a=w().toVar(),o=w().toVar(),h=B(It(n.x,a),It(n.y,o)).toVar(),l=b(1e6).toVar();return vt({start:-1,end:w(1),name:"x",condition:"<="},({x:u})=>{vt({start:-1,end:w(1),name:"y",condition:"<="},({y:c})=>{const d=b(pr(h,u,c,a,o,s,i)).toVar();l.assign(Ge(l,d))})}),Y(i.equal(w(0)),()=>{l.assign(ss(l))}),l}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Fb=A(([r,t,e])=>{const i=w(e).toVar(),s=b(t).toVar(),n=B(r).toVar(),a=w().toVar(),o=w().toVar(),h=B(It(n.x,a),It(n.y,o)).toVar(),l=B(1e6,1e6).toVar();return vt({start:-1,end:w(1),name:"x",condition:"<="},({x:u})=>{vt({start:-1,end:w(1),name:"y",condition:"<="},({y:c})=>{const d=b(pr(h,u,c,a,o,s,i)).toVar();Y(d.lessThan(l.x),()=>{l.y.assign(l.x),l.x.assign(d)}).ElseIf(d.lessThan(l.y),()=>{l.y.assign(d)})})}),Y(i.equal(w(0)),()=>{l.assign(ss(l))}),l}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),kb=A(([r,t,e])=>{const i=w(e).toVar(),s=b(t).toVar(),n=B(r).toVar(),a=w().toVar(),o=w().toVar(),h=B(It(n.x,a),It(n.y,o)).toVar(),l=R(1e6,1e6,1e6).toVar();return vt({start:-1,end:w(1),name:"x",condition:"<="},({x:u})=>{vt({start:-1,end:w(1),name:"y",condition:"<="},({y:c})=>{const d=b(pr(h,u,c,a,o,s,i)).toVar();Y(d.lessThan(l.x),()=>{l.z.assign(l.y),l.y.assign(l.x),l.x.assign(d)}).ElseIf(d.lessThan(l.y),()=>{l.z.assign(l.y),l.y.assign(d)}).ElseIf(d.lessThan(l.z),()=>{l.z.assign(d)})})}),Y(i.equal(w(0)),()=>{l.assign(ss(l))}),l}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]});me([Vb,A(([r,t,e])=>{const i=w(e).toVar(),s=b(t).toVar(),n=R(r).toVar(),a=w().toVar(),o=w().toVar(),h=w().toVar(),l=R(It(n.x,a),It(n.y,o),It(n.z,h)).toVar(),u=b(1e6).toVar();return vt({start:-1,end:w(1),name:"x",condition:"<="},({x:c})=>{vt({start:-1,end:w(1),name:"y",condition:"<="},({y:d})=>{vt({start:-1,end:w(1),name:"z",condition:"<="},({z:p})=>{const m=b(pr(l,c,d,p,a,o,h,s,i)).toVar();u.assign(Ge(u,m))})})}),Y(i.equal(w(0)),()=>{u.assign(ss(u))}),u}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]})]),me([Fb,A(([r,t,e])=>{const i=w(e).toVar(),s=b(t).toVar(),n=R(r).toVar(),a=w().toVar(),o=w().toVar(),h=w().toVar(),l=R(It(n.x,a),It(n.y,o),It(n.z,h)).toVar(),u=B(1e6,1e6).toVar();return vt({start:-1,end:w(1),name:"x",condition:"<="},({x:c})=>{vt({start:-1,end:w(1),name:"y",condition:"<="},({y:d})=>{vt({start:-1,end:w(1),name:"z",condition:"<="},({z:p})=>{const m=b(pr(l,c,d,p,a,o,h,s,i)).toVar();Y(m.lessThan(u.x),()=>{u.y.assign(u.x),u.x.assign(m)}).ElseIf(m.lessThan(u.y),()=>{u.y.assign(m)})})})}),Y(i.equal(w(0)),()=>{u.assign(ss(u))}),u}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]})]);const zf=me([kb,A(([r,t,e])=>{const i=w(e).toVar(),s=b(t).toVar(),n=R(r).toVar(),a=w().toVar(),o=w().toVar(),h=w().toVar(),l=R(It(n.x,a),It(n.y,o),It(n.z,h)).toVar(),u=R(1e6,1e6,1e6).toVar();return vt({start:-1,end:w(1),name:"x",condition:"<="},({x:c})=>{vt({start:-1,end:w(1),name:"y",condition:"<="},({y:d})=>{vt({start:-1,end:w(1),name:"z",condition:"<="},({z:p})=>{const m=b(pr(l,c,d,p,a,o,h,s,i)).toVar();Y(m.lessThan(u.x),()=>{u.z.assign(u.y),u.y.assign(u.x),u.x.assign(m)}).ElseIf(m.lessThan(u.y),()=>{u.z.assign(u.y),u.y.assign(m)}).ElseIf(m.lessThan(u.z),()=>{u.z.assign(m)})})})}),Y(i.equal(w(0)),()=>{u.assign(ss(u))}),u}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]})]);A(([r,t,e,i,s,n,a,o,h,l,u])=>{const c=w(r).toVar(),d=B(t).toVar(),p=B(e).toVar(),m=B(i).toVar(),f=b(s).toVar(),g=b(n).toVar(),y=b(a).toVar(),x=fi(o).toVar(),_=w(h).toVar(),M=b(l).toVar(),v=b(u).toVar(),N=d.mul(p).add(m),T=b(0).toVar();return Y(c.equal(w(0)),()=>{T.assign(Fc(N))}),Y(c.equal(w(1)),()=>{T.assign(Ah(N))}),Y(c.equal(w(2)),()=>{T.assign(zf(N,f,w(0)))}),Y(c.equal(w(3)),()=>{T.assign(Dc(R(N,0),_,M,v))}),T.assign(T.mul(y.sub(g)).add(g)),Y(x,()=>{T.assign(xi(T,g,y))}),T}).setLayout({name:"mx_unifiednoise2d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"texcoord",type:"vec2"},{name:"freq",type:"vec2"},{name:"offset",type:"vec2"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),A(([r,t,e,i,s,n,a,o,h,l,u])=>{const c=w(r).toVar(),d=R(t).toVar(),p=R(e).toVar(),m=R(i).toVar(),f=b(s).toVar(),g=b(n).toVar(),y=b(a).toVar(),x=fi(o).toVar(),_=w(h).toVar(),M=b(l).toVar(),v=b(u).toVar(),N=d.mul(p).add(m),T=b(0).toVar();return Y(c.equal(w(0)),()=>{T.assign(Fc(N))}),Y(c.equal(w(1)),()=>{T.assign(Ah(N))}),Y(c.equal(w(2)),()=>{T.assign(zf(N,f,w(0)))}),Y(c.equal(w(3)),()=>{T.assign(Dc(N,_,M,v))}),T.assign(T.mul(y.sub(g)).add(g)),Y(x,()=>{T.assign(xi(T,g,y))}),T}).setLayout({name:"mx_unifiednoise3d",type:"float",inputs:[{name:"noiseType",type:"int"},{name:"position",type:"vec3"},{name:"freq",type:"vec3"},{name:"offset",type:"vec3"},{name:"jitter",type:"float"},{name:"outmin",type:"float"},{name:"outmax",type:"float"},{name:"clampoutput",type:"bool"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),A(([r])=>{const t=r.y,e=r.z,i=R().toVar();return Y(t.lessThan(1e-4),()=>{i.assign(R(e,e,e))}).Else(()=>{let s=r.x;s=s.sub(ns(s)).mul(6).toVar();const n=w(Jp(s)),a=s.sub(b(n)),o=e.mul(t.oneMinus()),h=e.mul(t.mul(a).oneMinus()),l=e.mul(t.mul(a.oneMinus()).oneMinus());Y(n.equal(w(0)),()=>{i.assign(R(e,l,o))}).ElseIf(n.equal(w(1)),()=>{i.assign(R(h,e,o))}).ElseIf(n.equal(w(2)),()=>{i.assign(R(o,e,l))}).ElseIf(n.equal(w(3)),()=>{i.assign(R(o,h,e))}).ElseIf(n.equal(w(4)),()=>{i.assign(R(l,o,e))}).Else(()=>{i.assign(R(e,o,h))})}),i}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),A(([r])=>{const t=R(r).toVar(),e=b(t.x).toVar(),i=b(t.y).toVar(),s=b(t.z).toVar(),n=b(Ge(e,Ge(i,s))).toVar(),a=b(kt(e,kt(i,s))).toVar(),o=b(a.sub(n)).toVar(),h=b().toVar(),l=b().toVar(),u=b().toVar();return u.assign(a),Y(a.greaterThan(0),()=>{l.assign(o.div(a))}).Else(()=>{l.assign(0)}),Y(l.lessThanEqual(0),()=>{h.assign(0)}).Else(()=>{Y(e.greaterThanEqual(a),()=>{h.assign(i.sub(s).div(o))}).ElseIf(i.greaterThanEqual(a),()=>{h.assign(ie(2,s.sub(e).div(o)))}).Else(()=>{h.assign(ie(4,e.sub(i).div(o)))}),h.mulAssign(1/6),Y(h.lessThan(0),()=>{h.addAssign(1)})}),R(h,l,u)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),A(([r])=>{const t=R(r).toVar(),e=Fp($p(t,R(.04045))).toVar(),i=R(t.div(12.92)).toVar(),s=R(Ca(kt(t.add(R(.055)),R(0)).div(1.055),R(2.4))).toVar();return Zt(i,s,e)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),A(([r,t,e])=>{const i=un(r).toVar(),s=yt(b(.5).mul(t.sub(e)),hh).div(i).toVar(),n=yt(b(-.5).mul(t.sub(e)),hh).div(i).toVar(),a=R().toVar();a.x=i.x.greaterThan(b(0)).select(s.x,n.x),a.y=i.y.greaterThan(b(0)).select(s.y,n.y),a.z=i.z.greaterThan(b(0)).select(s.z,n.z);const o=Ge(a.x,a.y,a.z).toVar();return hh.add(i.mul(o)).toVar().sub(e)}),A(([r,t])=>{const e=r.x,i=r.y,s=r.z;let n=t.element(0).mul(.886227);return n=n.add(t.element(1).mul(1.023328).mul(i)),n=n.add(t.element(2).mul(1.023328).mul(s)),n=n.add(t.element(3).mul(1.023328).mul(e)),n=n.add(t.element(4).mul(.858086).mul(e).mul(i)),n=n.add(t.element(5).mul(.858086).mul(i).mul(s)),n=n.add(t.element(6).mul(s.mul(s).mul(.743125).sub(.247708))),n=n.add(t.element(7).mul(.858086).mul(e).mul(s)),n=n.add(t.element(8).mul(.429043).mul(tt(e,e).sub(tt(i,i)))),n}),new K5,new G,new G,A(([r,t])=>{const e=r.abs().sub(t);return rs(kt(e,0)).add(Ge(kt(e.x,e.y),0))}),new Cs,new Eb,new S,new S,new Mu,new nt,new wt,new Do,new G,new wt;const mr=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4};hn.READ_ONLY+"",hn.WRITE_ONLY+"",hn.READ_WRITE+"",mr&&mr.VERTEX,mr&&mr.FRAGMENT,mr&&mr.COMPUTE,new Ie("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),new Ie("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),new Ie("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),new Ie("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),new Ie("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),new Ie("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),new Ie("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),new Ie("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),new Ie("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),new Ie("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),new Ie("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),new Ie("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),new Ie(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`);const Db=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]);typeof Float16Array<"u"&&Db.set(Float16Array,["float16"]);function Lf(r,t){if(t===0)return r;if(t===2||t===1){let e=r.getIndex();if(e===null){const a=[],o=r.getAttribute("position");if(o!==void 0){for(let h=0;h<o.count;h++)a.push(h);r.setIndex(a),e=r.getIndex()}else return r}const i=e.count-2,s=[];if(t===2)for(let a=1;a<=i;a++)s.push(e.getX(0)),s.push(e.getX(a)),s.push(e.getX(a+1));else for(let a=0;a<i;a++)a%2===0?(s.push(e.getX(a)),s.push(e.getX(a+1)),s.push(e.getX(a+2))):(s.push(e.getX(a+2)),s.push(e.getX(a+1)),s.push(e.getX(a)));s.length/3;const n=r.clone();return n.setIndex(s),n.clearGroups(),n}else return r}class Ub extends sr{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new Xb(e)}),this.register(function(e){return new jb(e)}),this.register(function(e){return new iM(e)}),this.register(function(e){return new sM(e)}),this.register(function(e){return new nM(e)}),this.register(function(e){return new Yb(e)}),this.register(function(e){return new Zb(e)}),this.register(function(e){return new Jb(e)}),this.register(function(e){return new Qb(e)}),this.register(function(e){return new $b(e)}),this.register(function(e){return new Kb(e)}),this.register(function(e){return new Gb(e)}),this.register(function(e){return new eM(e)}),this.register(function(e){return new tM(e)}),this.register(function(e){return new Hb(e)}),this.register(function(e){return new rM(e)}),this.register(function(e){return new aM(e)})}load(t,e,i,s){const n=this;let a;if(this.resourcePath!=="")a=this.resourcePath;else if(this.path!==""){const l=_a.extractUrlBase(t);a=_a.resolveURL(l,this.path)}else a=_a.extractUrlBase(t);this.manager.itemStart(t);const o=function(l){s&&s(l),n.manager.itemError(t),n.manager.itemEnd(t)},h=new xp(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),h.setWithCredentials(this.withCredentials),h.load(t,function(l){try{n.parse(l,a,function(u){e(u),n.manager.itemEnd(t)},o)}catch(u){o(u)}},i,o)}setDRACOLoader(t){return this.dracoLoader=t,this}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return this.pluginCallbacks.indexOf(t)===-1&&this.pluginCallbacks.push(t),this}unregister(t){return this.pluginCallbacks.indexOf(t)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,s){let n;const a={},o={},h=new TextDecoder;if(typeof t=="string")n=JSON.parse(t);else if(t instanceof ArrayBuffer)if(h.decode(new Uint8Array(t,0,4))===Pf){try{a[lt.KHR_BINARY_GLTF]=new oM(t)}catch(c){s&&s(c);return}n=JSON.parse(a[lt.KHR_BINARY_GLTF].content)}else n=JSON.parse(h.decode(t));else n=t;if(n.asset===void 0||n.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new MM(n,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const c=this.pluginCallbacks[u](l);c.name,o[c.name]=c,a[c.name]=!0}if(n.extensionsUsed)for(let u=0;u<n.extensionsUsed.length;++u){const c=n.extensionsUsed[u],d=n.extensionsRequired||[];switch(c){case lt.KHR_MATERIALS_UNLIT:a[c]=new qb;break;case lt.KHR_DRACO_MESH_COMPRESSION:a[c]=new hM(n,this.dracoLoader);break;case lt.KHR_TEXTURE_TRANSFORM:a[c]=new lM;break;case lt.KHR_MESH_QUANTIZATION:a[c]=new uM;break;default:d.indexOf(c)>=0&&o[c]}}l.setExtensions(a),l.setPlugins(o),l.parse(i,s)}parseAsync(t,e){const i=this;return new Promise(function(s,n){i.parse(t,e,s,n)})}}function Wb(){let r={};return{get:function(t){return r[t]},add:function(t,e){r[t]=e},remove:function(t){delete r[t]},removeAll:function(){r={}}}}const lt={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Hb{constructor(t){this.parser=t,this.name=lt.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let i=0,s=e.length;i<s;i++){const n=e[i];n.extensions&&n.extensions[this.name]&&n.extensions[this.name].light!==void 0&&t._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(t){const e=this.parser,i="light:"+t;let s=e.cache.get(i);if(s)return s;const n=e.json,h=((n.extensions&&n.extensions[this.name]||{}).lights||[])[t];let l;const u=new ut(16777215);h.color!==void 0&&u.setRGB(h.color[0],h.color[1],h.color[2],ze);const c=h.range!==void 0?h.range:0;switch(h.type){case"directional":l=new Ex(u),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new Nx(u),l.distance=c;break;case"spot":l=new Sx(u),l.distance=c,h.spot=h.spot||{},h.spot.innerConeAngle=h.spot.innerConeAngle!==void 0?h.spot.innerConeAngle:0,h.spot.outerConeAngle=h.spot.outerConeAngle!==void 0?h.spot.outerConeAngle:Math.PI/4,l.angle=h.spot.outerConeAngle,l.penumbra=1-h.spot.innerConeAngle/h.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+h.type)}return l.position.set(0,0,0),os(l,h),h.intensity!==void 0&&(l.intensity=h.intensity),l.name=e.createUniqueName(h.name||"light_"+t),s=Promise.resolve(l),e.cache.add(i,s),s}getDependency(t,e){if(t==="light")return this._loadLight(e)}createNodeAttachment(t){const e=this,i=this.parser,n=i.json.nodes[t],o=(n.extensions&&n.extensions[this.name]||{}).light;return o===void 0?null:this._loadLight(o).then(function(h){return i._getNodeRef(e.cache,o,h)})}}class qb{constructor(){this.name=lt.KHR_MATERIALS_UNLIT}getMaterialType(){return Rs}extendParams(t,e,i){const s=[];t.color=new ut(1,1,1),t.opacity=1;const n=e.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){const a=n.baseColorFactor;t.color.setRGB(a[0],a[1],a[2],ze),t.opacity=a[3]}n.baseColorTexture!==void 0&&s.push(i.assignTexture(t,"map",n.baseColorTexture,ue))}return Promise.all(s)}}class $b{constructor(t){this.parser=t,this.name=lt.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=s.extensions[this.name].emissiveStrength;return n!==void 0&&(e.emissiveIntensity=n),Promise.resolve()}}class Xb{constructor(t){this.parser=t,this.name=lt.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:pi}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],a=s.extensions[this.name];if(a.clearcoatFactor!==void 0&&(e.clearcoat=a.clearcoatFactor),a.clearcoatTexture!==void 0&&n.push(i.assignTexture(e,"clearcoatMap",a.clearcoatTexture)),a.clearcoatRoughnessFactor!==void 0&&(e.clearcoatRoughness=a.clearcoatRoughnessFactor),a.clearcoatRoughnessTexture!==void 0&&n.push(i.assignTexture(e,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),a.clearcoatNormalTexture!==void 0&&(n.push(i.assignTexture(e,"clearcoatNormalMap",a.clearcoatNormalTexture)),a.clearcoatNormalTexture.scale!==void 0)){const o=a.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new nt(o,o)}return Promise.all(n)}}class jb{constructor(t){this.parser=t,this.name=lt.KHR_MATERIALS_DISPERSION}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:pi}extendMaterialParams(t,e){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=s.extensions[this.name];return e.dispersion=n.dispersion!==void 0?n.dispersion:0,Promise.resolve()}}class Gb{constructor(t){this.parser=t,this.name=lt.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:pi}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],a=s.extensions[this.name];return a.iridescenceFactor!==void 0&&(e.iridescence=a.iridescenceFactor),a.iridescenceTexture!==void 0&&n.push(i.assignTexture(e,"iridescenceMap",a.iridescenceTexture)),a.iridescenceIor!==void 0&&(e.iridescenceIOR=a.iridescenceIor),e.iridescenceThicknessRange===void 0&&(e.iridescenceThicknessRange=[100,400]),a.iridescenceThicknessMinimum!==void 0&&(e.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),a.iridescenceThicknessMaximum!==void 0&&(e.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),a.iridescenceThicknessTexture!==void 0&&n.push(i.assignTexture(e,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(n)}}class Yb{constructor(t){this.parser=t,this.name=lt.KHR_MATERIALS_SHEEN}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:pi}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[];e.sheenColor=new ut(0,0,0),e.sheenRoughness=0,e.sheen=1;const a=s.extensions[this.name];if(a.sheenColorFactor!==void 0){const o=a.sheenColorFactor;e.sheenColor.setRGB(o[0],o[1],o[2],ze)}return a.sheenRoughnessFactor!==void 0&&(e.sheenRoughness=a.sheenRoughnessFactor),a.sheenColorTexture!==void 0&&n.push(i.assignTexture(e,"sheenColorMap",a.sheenColorTexture,ue)),a.sheenRoughnessTexture!==void 0&&n.push(i.assignTexture(e,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(n)}}class Zb{constructor(t){this.parser=t,this.name=lt.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:pi}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],a=s.extensions[this.name];return a.transmissionFactor!==void 0&&(e.transmission=a.transmissionFactor),a.transmissionTexture!==void 0&&n.push(i.assignTexture(e,"transmissionMap",a.transmissionTexture)),Promise.all(n)}}class Jb{constructor(t){this.parser=t,this.name=lt.KHR_MATERIALS_VOLUME}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:pi}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],a=s.extensions[this.name];e.thickness=a.thicknessFactor!==void 0?a.thicknessFactor:0,a.thicknessTexture!==void 0&&n.push(i.assignTexture(e,"thicknessMap",a.thicknessTexture)),e.attenuationDistance=a.attenuationDistance||1/0;const o=a.attenuationColor||[1,1,1];return e.attenuationColor=new ut().setRGB(o[0],o[1],o[2],ze),Promise.all(n)}}class Qb{constructor(t){this.parser=t,this.name=lt.KHR_MATERIALS_IOR}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:pi}extendMaterialParams(t,e){const s=this.parser.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=s.extensions[this.name];return e.ior=n.ior!==void 0?n.ior:1.5,Promise.resolve()}}class Kb{constructor(t){this.parser=t,this.name=lt.KHR_MATERIALS_SPECULAR}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:pi}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],a=s.extensions[this.name];e.specularIntensity=a.specularFactor!==void 0?a.specularFactor:1,a.specularTexture!==void 0&&n.push(i.assignTexture(e,"specularIntensityMap",a.specularTexture));const o=a.specularColorFactor||[1,1,1];return e.specularColor=new ut().setRGB(o[0],o[1],o[2],ze),a.specularColorTexture!==void 0&&n.push(i.assignTexture(e,"specularColorMap",a.specularColorTexture,ue)),Promise.all(n)}}class tM{constructor(t){this.parser=t,this.name=lt.EXT_MATERIALS_BUMP}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:pi}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],a=s.extensions[this.name];return e.bumpScale=a.bumpFactor!==void 0?a.bumpFactor:1,a.bumpTexture!==void 0&&n.push(i.assignTexture(e,"bumpMap",a.bumpTexture)),Promise.all(n)}}class eM{constructor(t){this.parser=t,this.name=lt.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const i=this.parser.json.materials[t];return!i.extensions||!i.extensions[this.name]?null:pi}extendMaterialParams(t,e){const i=this.parser,s=i.json.materials[t];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const n=[],a=s.extensions[this.name];return a.anisotropyStrength!==void 0&&(e.anisotropy=a.anisotropyStrength),a.anisotropyRotation!==void 0&&(e.anisotropyRotation=a.anisotropyRotation),a.anisotropyTexture!==void 0&&n.push(i.assignTexture(e,"anisotropyMap",a.anisotropyTexture)),Promise.all(n)}}class iM{constructor(t){this.parser=t,this.name=lt.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,i=e.json,s=i.textures[t];if(!s.extensions||!s.extensions[this.name])return null;const n=s.extensions[this.name],a=e.options.ktx2Loader;if(!a){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,n.source,a)}}class sM{constructor(t){this.parser=t,this.name=lt.EXT_TEXTURE_WEBP}loadTexture(t){const e=this.name,i=this.parser,s=i.json,n=s.textures[t];if(!n.extensions||!n.extensions[e])return null;const a=n.extensions[e],o=s.images[a.source];let h=i.textureLoader;if(o.uri){const l=i.options.manager.getHandler(o.uri);l!==null&&(h=l)}return i.loadTextureImage(t,a.source,h)}}class nM{constructor(t){this.parser=t,this.name=lt.EXT_TEXTURE_AVIF}loadTexture(t){const e=this.name,i=this.parser,s=i.json,n=s.textures[t];if(!n.extensions||!n.extensions[e])return null;const a=n.extensions[e],o=s.images[a.source];let h=i.textureLoader;if(o.uri){const l=i.options.manager.getHandler(o.uri);l!==null&&(h=l)}return i.loadTextureImage(t,a.source,h)}}class rM{constructor(t){this.name=lt.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,i=e.bufferViews[t];if(i.extensions&&i.extensions[this.name]){const s=i.extensions[this.name],n=this.parser.getDependency("buffer",s.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return n.then(function(o){const h=s.byteOffset||0,l=s.byteLength||0,u=s.count,c=s.byteStride,d=new Uint8Array(o,h,l);return a.decodeGltfBufferAsync?a.decodeGltfBufferAsync(u,c,d,s.mode,s.filter).then(function(p){return p.buffer}):a.ready.then(function(){const p=new ArrayBuffer(u*c);return a.decodeGltfBuffer(new Uint8Array(p),u,c,d,s.mode,s.filter),p})})}else return null}}class aM{constructor(t){this.name=lt.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const e=this.parser.json,i=e.nodes[t];if(!i.extensions||!i.extensions[this.name]||i.mesh===void 0)return null;const s=e.meshes[i.mesh];for(const l of s.primitives)if(l.mode!==ei.TRIANGLES&&l.mode!==ei.TRIANGLE_STRIP&&l.mode!==ei.TRIANGLE_FAN&&l.mode!==void 0)return null;const a=i.extensions[this.name].attributes,o=[],h={};for(const l in a)o.push(this.parser.getDependency("accessor",a[l]).then(u=>(h[l]=u,h[l])));return o.length<1?null:(o.push(this.parser.createNodeMesh(t)),Promise.all(o).then(l=>{const u=l.pop(),c=u.isGroup?u.children:[u],d=l[0].count,p=[];for(const m of c){const f=new G,g=new S,y=new Te,x=new S(1,1,1),_=new tx(m.geometry,m.material,d);for(let M=0;M<d;M++)h.TRANSLATION&&g.fromBufferAttribute(h.TRANSLATION,M),h.ROTATION&&y.fromBufferAttribute(h.ROTATION,M),h.SCALE&&x.fromBufferAttribute(h.SCALE,M),_.setMatrixAt(M,f.compose(g,y,x));for(const M in h)if(M==="_COLOR_0"){const v=h[M];_.instanceColor=new ma(v.array,v.itemSize,v.normalized)}else M!=="TRANSLATION"&&M!=="ROTATION"&&M!=="SCALE"&&m.geometry.setAttribute(M,h[M]);Pt.prototype.copy.call(_,m),this.parser.assignFinalMaterial(_),p.push(_)}return u.isGroup?(u.clear(),u.add(...p),u):p[0]}))}}const Pf="glTF",Xa=12,Bf={JSON:1313821514,BIN:5130562};class oM{constructor(t){this.name=lt.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,Xa),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==Pf)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-Xa,n=new DataView(t,Xa);let a=0;for(;a<s;){const o=n.getUint32(a,!0);a+=4;const h=n.getUint32(a,!0);if(a+=4,h===Bf.JSON){const l=new Uint8Array(t,Xa+a,o);this.content=i.decode(l)}else if(h===Bf.BIN){const l=Xa+a;this.body=t.slice(l,l+o)}a+=o}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class hM{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=lt.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const i=this.json,s=this.dracoLoader,n=t.extensions[this.name].bufferView,a=t.extensions[this.name].attributes,o={},h={},l={};for(const u in a){const c=Wc[u]||u.toLowerCase();o[c]=a[u]}for(const u in t.attributes){const c=Wc[u]||u.toLowerCase();if(a[u]!==void 0){const d=i.accessors[t.attributes[u]],p=fr[d.componentType];l[c]=p.name,h[c]=d.normalized===!0}}return e.getDependency("bufferView",n).then(function(u){return new Promise(function(c,d){s.decodeDracoFile(u,function(p){for(const m in p.attributes){const f=p.attributes[m],g=h[m];g!==void 0&&(f.normalized=g)}c(p)},o,l,ze,d)})})}}class lM{constructor(){this.name=lt.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return(e.texCoord===void 0||e.texCoord===t.channel)&&e.offset===void 0&&e.rotation===void 0&&e.scale===void 0||(t=t.clone(),e.texCoord!==void 0&&(t.channel=e.texCoord),e.offset!==void 0&&t.offset.fromArray(e.offset),e.rotation!==void 0&&(t.rotation=e.rotation),e.scale!==void 0&&t.repeat.fromArray(e.scale),t.needsUpdate=!0),t}}class uM{constructor(){this.name=lt.KHR_MESH_QUANTIZATION}}class Of extends xa{constructor(t,e,i,s){super(t,e,i,s)}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,s=this.valueSize,n=t*s*3+s;for(let a=0;a!==s;a++)e[a]=i[n+a];return e}interpolate_(t,e,i,s){const n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,h=o*2,l=o*3,u=s-e,c=(i-e)/u,d=c*c,p=d*c,m=t*l,f=m-l,g=-2*p+3*d,y=p-d,x=1-g,_=y-d+c;for(let M=0;M!==o;M++){const v=a[f+M+o],N=a[f+M+h]*u,T=a[m+M+o],C=a[m+M]*u;n[M]=x*v+_*N+g*T+y*C}return n}}const cM=new Te;class dM extends Of{interpolate_(t,e,i,s){const n=super.interpolate_(t,e,i,s);return cM.fromArray(n).normalize().toArray(n),n}}const ei={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},fr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Vf={9728:1003,9729:1006,9984:1004,9985:1007,9986:1005,9987:1008},Ff={33071:1001,33648:1002,10497:1e3},Uc={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Wc={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Us={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},pM={CUBICSPLINE:void 0,LINEAR:2301,STEP:2300},Hc={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function mM(r){return r.DefaultMaterial===void 0&&(r.DefaultMaterial=new Go({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:0})),r.DefaultMaterial}function Sn(r,t,e){for(const i in e.extensions)r[i]===void 0&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=e.extensions[i])}function os(r,t){t.extras!==void 0&&typeof t.extras=="object"&&Object.assign(r.userData,t.extras)}function fM(r,t,e){let i=!1,s=!1,n=!1;for(let l=0,u=t.length;l<u;l++){const c=t[l];if(c.POSITION!==void 0&&(i=!0),c.NORMAL!==void 0&&(s=!0),c.COLOR_0!==void 0&&(n=!0),i&&s&&n)break}if(!i&&!s&&!n)return Promise.resolve(r);const a=[],o=[],h=[];for(let l=0,u=t.length;l<u;l++){const c=t[l];if(i){const d=c.POSITION!==void 0?e.getDependency("accessor",c.POSITION):r.attributes.position;a.push(d)}if(s){const d=c.NORMAL!==void 0?e.getDependency("accessor",c.NORMAL):r.attributes.normal;o.push(d)}if(n){const d=c.COLOR_0!==void 0?e.getDependency("accessor",c.COLOR_0):r.attributes.color;h.push(d)}}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(h)]).then(function(l){const u=l[0],c=l[1],d=l[2];return i&&(r.morphAttributes.position=u),s&&(r.morphAttributes.normal=c),n&&(r.morphAttributes.color=d),r.morphTargetsRelative=!0,r})}function gM(r,t){if(r.updateMorphTargets(),t.weights!==void 0)for(let e=0,i=t.weights.length;e<i;e++)r.morphTargetInfluences[e]=t.weights[e];if(t.extras&&Array.isArray(t.extras.targetNames)){const e=t.extras.targetNames;if(r.morphTargetInfluences.length===e.length){r.morphTargetDictionary={};for(let i=0,s=e.length;i<s;i++)r.morphTargetDictionary[e[i]]=i}}}function yM(r){let t;const e=r.extensions&&r.extensions[lt.KHR_DRACO_MESH_COMPRESSION];if(e?t="draco:"+e.bufferView+":"+e.indices+":"+qc(e.attributes):t=r.indices+":"+qc(r.attributes)+":"+r.mode,r.targets!==void 0)for(let i=0,s=r.targets.length;i<s;i++)t+=":"+qc(r.targets[i]);return t}function qc(r){let t="";const e=Object.keys(r).sort();for(let i=0,s=e.length;i<s;i++)t+=e[i]+":"+r[e[i]]+";";return t}function $c(r){switch(r){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function xM(r){return r.search(/\.jpe?g($|\?)/i)>0||r.search(/^data\:image\/jpeg/)===0?"image/jpeg":r.search(/\.webp($|\?)/i)>0||r.search(/^data\:image\/webp/)===0?"image/webp":r.search(/\.ktx2($|\?)/i)>0||r.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const bM=new G;class MM{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new Wb,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,s=-1,n=!1,a=-1;if(typeof navigator<"u"){const o=navigator.userAgent;i=/^((?!chrome|android).)*safari/i.test(o)===!0;const h=o.match(/Version\/(\d+)/);s=i&&h?parseInt(h[1],10):-1,n=o.indexOf("Firefox")>-1,a=n?o.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||i&&s<17||n&&a<98?this.textureLoader=new wx(this.options.manager):this.textureLoader=new Ix(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new xp(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const i=this,s=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(a){return a._markDefs&&a._markDefs()}),Promise.all(this._invokeAll(function(a){return a.beforeRoot&&a.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(a){const o={scene:a[0][s.scene||0],scenes:a[0],animations:a[1],cameras:a[2],asset:s.asset,parser:i,userData:{}};return Sn(n,o,s),os(o,s),Promise.all(i._invokeAll(function(h){return h.afterRoot&&h.afterRoot(o)})).then(function(){for(const h of o.scenes)h.updateMatrixWorld();t(o)})}).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let s=0,n=e.length;s<n;s++){const a=e[s].joints;for(let o=0,h=a.length;o<h;o++)t[a[o]].isBone=!0}for(let s=0,n=t.length;s<n;s++){const a=t[s];a.mesh!==void 0&&(this._addNodeRef(this.meshCache,a.mesh),a.skin!==void 0&&(i[a.mesh].isSkinnedMesh=!0)),a.camera!==void 0&&this._addNodeRef(this.cameraCache,a.camera)}}_addNodeRef(t,e){e!==void 0&&(t.refs[e]===void 0&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,i){if(t.refs[e]<=1)return i;const s=i.clone(),n=(a,o)=>{const h=this.associations.get(a);h!=null&&this.associations.set(o,h);for(const[l,u]of a.children.entries())n(u,o.children[l])};return n(i,s),s.name+="_instance_"+t.uses[e]++,s}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){const s=t(e[i]);if(s)return s}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const i=[];for(let s=0;s<e.length;s++){const n=t(e[s]);n&&i.push(n)}return i}getDependency(t,e){const i=t+":"+e;let s=this.cache.get(i);if(!s){switch(t){case"scene":s=this.loadScene(e);break;case"node":s=this._invokeOne(function(n){return n.loadNode&&n.loadNode(e)});break;case"mesh":s=this._invokeOne(function(n){return n.loadMesh&&n.loadMesh(e)});break;case"accessor":s=this.loadAccessor(e);break;case"bufferView":s=this._invokeOne(function(n){return n.loadBufferView&&n.loadBufferView(e)});break;case"buffer":s=this.loadBuffer(e);break;case"material":s=this._invokeOne(function(n){return n.loadMaterial&&n.loadMaterial(e)});break;case"texture":s=this._invokeOne(function(n){return n.loadTexture&&n.loadTexture(e)});break;case"skin":s=this.loadSkin(e);break;case"animation":s=this._invokeOne(function(n){return n.loadAnimation&&n.loadAnimation(e)});break;case"camera":s=this.loadCamera(e);break;default:if(s=this._invokeOne(function(n){return n!=this&&n.getDependency&&n.getDependency(t,e)}),!s)throw new Error("Unknown type: "+t);break}this.cache.add(i,s)}return s}getDependencies(t){let e=this.cache.get(t);if(!e){const i=this,s=this.json[t+(t==="mesh"?"es":"s")]||[];e=Promise.all(s.map(function(n,a){return i.getDependency(t,a)})),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],i=this.fileLoader;if(e.type&&e.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(e.uri===void 0&&t===0)return Promise.resolve(this.extensions[lt.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(n,a){i.load(_a.resolveURL(e.uri,s.path),n,void 0,function(){a(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))})})}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then(function(i){const s=e.byteLength||0,n=e.byteOffset||0;return i.slice(n,n+s)})}loadAccessor(t){const e=this,i=this.json,s=this.json.accessors[t];if(s.bufferView===void 0&&s.sparse===void 0){const a=Uc[s.type],o=fr[s.componentType],h=s.normalized===!0,l=new o(s.count*a);return Promise.resolve(new Ae(l,a,h))}const n=[];return s.bufferView!==void 0?n.push(this.getDependency("bufferView",s.bufferView)):n.push(null),s.sparse!==void 0&&(n.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(n).then(function(a){const o=a[0],h=Uc[s.type],l=fr[s.componentType],u=l.BYTES_PER_ELEMENT,c=u*h,d=s.byteOffset||0,p=s.bufferView!==void 0?i.bufferViews[s.bufferView].byteStride:void 0,m=s.normalized===!0;let f,g;if(p&&p!==c){const y=Math.floor(d/p),x="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+y+":"+s.count;let _=e.cache.get(x);_||(f=new l(o,y*p,s.count*p/u),_=new _u(f,p/u),e.cache.add(x,_)),g=new Z0(_,h,d%p/u,m)}else o===null?f=new l(s.count*h):f=new l(o,d,s.count*h),g=new Ae(f,h,m);if(s.sparse!==void 0){const y=Uc.SCALAR,x=fr[s.sparse.indices.componentType],_=s.sparse.indices.byteOffset||0,M=s.sparse.values.byteOffset||0,v=new x(a[1],_,s.sparse.count*y),N=new l(a[2],M,s.sparse.count*h);o!==null&&(g=new Ae(g.array.slice(),g.itemSize,g.normalized)),g.normalized=!1;for(let T=0,C=v.length;T<C;T++){const P=v[T];if(g.setX(P,N[T*h]),h>=2&&g.setY(P,N[T*h+1]),h>=3&&g.setZ(P,N[T*h+2]),h>=4&&g.setW(P,N[T*h+3]),h>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}g.normalized=m}return g})}loadTexture(t){const e=this.json,i=this.options,n=e.textures[t].source,a=e.images[n];let o=this.textureLoader;if(a.uri){const h=i.manager.getHandler(a.uri);h!==null&&(o=h)}return this.loadTextureImage(t,n,o)}loadTextureImage(t,e,i){const s=this,n=this.json,a=n.textures[t],o=n.images[e],h=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[h])return this.textureCache[h];const l=this.loadImageSource(e,i).then(function(u){u.flipY=!1,u.name=a.name||o.name||"",u.name===""&&typeof o.uri=="string"&&o.uri.startsWith("data:image/")===!1&&(u.name=o.uri);const d=(n.samplers||{})[a.sampler]||{};return u.magFilter=Vf[d.magFilter]||1006,u.minFilter=Vf[d.minFilter]||1008,u.wrapS=Ff[d.wrapS]||1e3,u.wrapT=Ff[d.wrapT]||1e3,u.generateMipmaps=!u.isCompressedTexture&&u.minFilter!==1003&&u.minFilter!==1006,s.associations.set(u,{textures:t}),u}).catch(function(){return null});return this.textureCache[h]=l,l}loadImageSource(t,e){const i=this,s=this.json,n=this.options;if(this.sourceCache[t]!==void 0)return this.sourceCache[t].then(c=>c.clone());const a=s.images[t],o=self.URL||self.webkitURL;let h=a.uri||"",l=!1;if(a.bufferView!==void 0)h=i.getDependency("bufferView",a.bufferView).then(function(c){l=!0;const d=new Blob([c],{type:a.mimeType});return h=o.createObjectURL(d),h});else if(a.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const u=Promise.resolve(h).then(function(c){return new Promise(function(d,p){let m=d;e.isImageBitmapLoader===!0&&(m=function(f){const g=new Se(f);g.needsUpdate=!0,d(g)}),e.load(_a.resolveURL(c,n.path),m,void 0,p)})}).then(function(c){return l===!0&&o.revokeObjectURL(h),os(c,a),c.userData.mimeType=a.mimeType||xM(a.uri),c}).catch(function(c){});return this.sourceCache[t]=u,u}assignTexture(t,e,i,s){const n=this;return this.getDependency("texture",i.index).then(function(a){if(!a)return null;if(i.texCoord!==void 0&&i.texCoord>0&&(a=a.clone(),a.channel=i.texCoord),n.extensions[lt.KHR_TEXTURE_TRANSFORM]){const o=i.extensions!==void 0?i.extensions[lt.KHR_TEXTURE_TRANSFORM]:void 0;if(o){const h=n.associations.get(a);a=n.extensions[lt.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),n.associations.set(a,h)}}return s!==void 0&&(a.colorSpace=s),t[e]=a,a})}assignFinalMaterial(t){const e=t.geometry;let i=t.material;const s=e.attributes.tangent===void 0,n=e.attributes.color!==void 0,a=e.attributes.normal===void 0;if(t.isPoints){const o="PointsMaterial:"+i.uuid;let h=this.cache.get(o);h||(h=new Nu,he.prototype.copy.call(h,i),h.color.copy(i.color),h.map=i.map,h.sizeAttenuation=!1,this.cache.add(o,h)),i=h}else if(t.isLine){const o="LineBasicMaterial:"+i.uuid;let h=this.cache.get(o);h||(h=new Uo,he.prototype.copy.call(h,i),h.color.copy(i.color),h.map=i.map,this.cache.add(o,h)),i=h}if(s||n||a){let o="ClonedMaterial:"+i.uuid+":";s&&(o+="derivative-tangents:"),n&&(o+="vertex-colors:"),a&&(o+="flat-shading:");let h=this.cache.get(o);h||(h=i.clone(),n&&(h.vertexColors=!0),a&&(h.flatShading=!0),s&&(h.normalScale&&(h.normalScale.y*=-1),h.clearcoatNormalScale&&(h.clearcoatNormalScale.y*=-1)),this.cache.add(o,h),this.associations.set(h,this.associations.get(i))),i=h}t.material=i}getMaterialType(){return Go}loadMaterial(t){const e=this,i=this.json,s=this.extensions,n=i.materials[t];let a;const o={},h=n.extensions||{},l=[];if(h[lt.KHR_MATERIALS_UNLIT]){const c=s[lt.KHR_MATERIALS_UNLIT];a=c.getMaterialType(),l.push(c.extendParams(o,n,e))}else{const c=n.pbrMetallicRoughness||{};if(o.color=new ut(1,1,1),o.opacity=1,Array.isArray(c.baseColorFactor)){const d=c.baseColorFactor;o.color.setRGB(d[0],d[1],d[2],ze),o.opacity=d[3]}c.baseColorTexture!==void 0&&l.push(e.assignTexture(o,"map",c.baseColorTexture,ue)),o.metalness=c.metallicFactor!==void 0?c.metallicFactor:1,o.roughness=c.roughnessFactor!==void 0?c.roughnessFactor:1,c.metallicRoughnessTexture!==void 0&&(l.push(e.assignTexture(o,"metalnessMap",c.metallicRoughnessTexture)),l.push(e.assignTexture(o,"roughnessMap",c.metallicRoughnessTexture))),a=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(t)})}n.doubleSided===!0&&(o.side=2);const u=n.alphaMode||Hc.OPAQUE;if(u===Hc.BLEND?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,u===Hc.MASK&&(o.alphaTest=n.alphaCutoff!==void 0?n.alphaCutoff:.5)),n.normalTexture!==void 0&&a!==Rs&&(l.push(e.assignTexture(o,"normalMap",n.normalTexture)),o.normalScale=new nt(1,1),n.normalTexture.scale!==void 0)){const c=n.normalTexture.scale;o.normalScale.set(c,c)}if(n.occlusionTexture!==void 0&&a!==Rs&&(l.push(e.assignTexture(o,"aoMap",n.occlusionTexture)),n.occlusionTexture.strength!==void 0&&(o.aoMapIntensity=n.occlusionTexture.strength)),n.emissiveFactor!==void 0&&a!==Rs){const c=n.emissiveFactor;o.emissive=new ut().setRGB(c[0],c[1],c[2],ze)}return n.emissiveTexture!==void 0&&a!==Rs&&l.push(e.assignTexture(o,"emissiveMap",n.emissiveTexture,ue)),Promise.all(l).then(function(){const c=new a(o);return n.name&&(c.name=n.name),os(c,n),e.associations.set(c,{materials:t}),n.extensions&&Sn(s,c,n),c})}createUniqueName(t){const e=zt.sanitizeNodeName(t||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(t){const e=this,i=this.extensions,s=this.primitiveCache;function n(o){return i[lt.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(o,e).then(function(h){return kf(h,o,e)})}const a=[];for(let o=0,h=t.length;o<h;o++){const l=t[o],u=yM(l),c=s[u];if(c)a.push(c.promise);else{let d;l.extensions&&l.extensions[lt.KHR_DRACO_MESH_COMPRESSION]?d=n(l):d=kf(new rn,l,e),s[u]={primitive:l,promise:d},a.push(d)}}return Promise.all(a)}loadMesh(t){const e=this,i=this.json,s=this.extensions,n=i.meshes[t],a=n.primitives,o=[];for(let h=0,l=a.length;h<l;h++){const u=a[h].material===void 0?mM(this.cache):this.getDependency("material",a[h].material);o.push(u)}return o.push(e.loadGeometries(a)),Promise.all(o).then(function(h){const l=h.slice(0,h.length-1),u=h[h.length-1],c=[];for(let p=0,m=u.length;p<m;p++){const f=u[p],g=a[p];let y;const x=l[p];if(g.mode===ei.TRIANGLES||g.mode===ei.TRIANGLE_STRIP||g.mode===ei.TRIANGLE_FAN||g.mode===void 0)y=n.isSkinnedMesh===!0?new Jy(f,x):new di(f,x),y.isSkinnedMesh===!0&&y.normalizeSkinWeights(),g.mode===ei.TRIANGLE_STRIP?y.geometry=Lf(y.geometry,1):g.mode===ei.TRIANGLE_FAN&&(y.geometry=Lf(y.geometry,2));else if(g.mode===ei.LINES)y=new nx(f,x);else if(g.mode===ei.LINE_STRIP)y=new Au(f,x);else if(g.mode===ei.LINE_LOOP)y=new rx(f,x);else if(g.mode===ei.POINTS)y=new ax(f,x);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+g.mode);Object.keys(y.geometry.morphAttributes).length>0&&gM(y,n),y.name=e.createUniqueName(n.name||"mesh_"+t),os(y,n),g.extensions&&Sn(s,y,g),e.assignFinalMaterial(y),c.push(y)}for(let p=0,m=c.length;p<m;p++)e.associations.set(c[p],{meshes:t,primitives:p});if(c.length===1)return n.extensions&&Sn(s,c[0],n),c[0];const d=new bu;n.extensions&&Sn(s,d,n),e.associations.set(d,{meshes:t});for(let p=0,m=c.length;p<m;p++)d.add(c[p]);return d})}loadCamera(t){let e;const i=this.json.cameras[t],s=i[i.type];if(s)return i.type==="perspective"?e=new Li(Zl.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):i.type==="orthographic"&&(e=new Zo(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),i.name&&(e.name=this.createUniqueName(i.name)),os(e,i),Promise.resolve(e)}loadSkin(t){const e=this.json.skins[t],i=[];for(let s=0,n=e.joints.length;s<n;s++)i.push(this._loadNodeShallow(e.joints[s]));return e.inverseBindMatrices!==void 0?i.push(this.getDependency("accessor",e.inverseBindMatrices)):i.push(null),Promise.all(i).then(function(s){const n=s.pop(),a=s,o=[],h=[];for(let l=0,u=a.length;l<u;l++){const c=a[l];if(c){o.push(c);const d=new G;n!==null&&d.fromArray(n.array,l*16),h.push(d)}}return new Vo(o,h)})}loadAnimation(t){const e=this.json,i=this,s=e.animations[t],n=s.name?s.name:"animation_"+t,a=[],o=[],h=[],l=[],u=[];for(let c=0,d=s.channels.length;c<d;c++){const p=s.channels[c],m=s.samplers[p.sampler],f=p.target,g=f.node,y=s.parameters!==void 0?s.parameters[m.input]:m.input,x=s.parameters!==void 0?s.parameters[m.output]:m.output;f.node!==void 0&&(a.push(this.getDependency("node",g)),o.push(this.getDependency("accessor",y)),h.push(this.getDependency("accessor",x)),l.push(m),u.push(f))}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(h),Promise.all(l),Promise.all(u)]).then(function(c){const d=c[0],p=c[1],m=c[2],f=c[3],g=c[4],y=[];for(let x=0,_=d.length;x<_;x++){const M=d[x],v=p[x],N=m[x],T=f[x],C=g[x];if(M===void 0)continue;M.updateMatrix&&M.updateMatrix();const P=i._createAnimationTracks(M,v,N,T,C);if(P)for(let F=0;F<P.length;F++)y.push(P[F])}return new ba(n,void 0,y)})}createNodeMesh(t){const e=this.json,i=this,s=e.nodes[t];return s.mesh===void 0?null:i.getDependency("mesh",s.mesh).then(function(n){const a=i._getNodeRef(i.meshCache,s.mesh,n);return s.weights!==void 0&&a.traverse(function(o){if(o.isMesh)for(let h=0,l=s.weights.length;h<l;h++)o.morphTargetInfluences[h]=s.weights[h]}),a})}loadNode(t){const e=this.json,i=this,s=e.nodes[t],n=i._loadNodeShallow(t),a=[],o=s.children||[];for(let l=0,u=o.length;l<u;l++)a.push(i.getDependency("node",o[l]));const h=s.skin===void 0?Promise.resolve(null):i.getDependency("skin",s.skin);return Promise.all([n,Promise.all(a),h]).then(function(l){const u=l[0],c=l[1],d=l[2];d!==null&&u.traverse(function(p){p.isSkinnedMesh&&p.bind(d,bM)});for(let p=0,m=c.length;p<m;p++)u.add(c[p]);return u})}_loadNodeShallow(t){const e=this.json,i=this.extensions,s=this;if(this.nodeCache[t]!==void 0)return this.nodeCache[t];const n=e.nodes[t],a=n.name?s.createUniqueName(n.name):"",o=[],h=s._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(t)});return h&&o.push(h),n.camera!==void 0&&o.push(s.getDependency("camera",n.camera).then(function(l){return s._getNodeRef(s.cameraCache,n.camera,l)})),s._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(t)}).forEach(function(l){o.push(l)}),this.nodeCache[t]=Promise.all(o).then(function(l){let u;if(n.isBone===!0?u=new ip:l.length>1?u=new bu:l.length===1?u=l[0]:u=new Pt,u!==l[0])for(let c=0,d=l.length;c<d;c++)u.add(l[c]);if(n.name&&(u.userData.name=n.name,u.name=a),os(u,n),n.extensions&&Sn(i,u,n),n.matrix!==void 0){const c=new G;c.fromArray(n.matrix),u.applyMatrix4(c)}else n.translation!==void 0&&u.position.fromArray(n.translation),n.rotation!==void 0&&u.quaternion.fromArray(n.rotation),n.scale!==void 0&&u.scale.fromArray(n.scale);return s.associations.has(u)||s.associations.set(u,{}),s.associations.get(u).nodes=t,u}),this.nodeCache[t]}loadScene(t){const e=this.extensions,i=this.json.scenes[t],s=this,n=new bu;i.name&&(n.name=s.createUniqueName(i.name)),os(n,i),i.extensions&&Sn(e,n,i);const a=i.nodes||[],o=[];for(let h=0,l=a.length;h<l;h++)o.push(s.getDependency("node",a[h]));return Promise.all(o).then(function(h){for(let u=0,c=h.length;u<c;u++)n.add(h[u]);const l=u=>{const c=new Map;for(const[d,p]of s.associations)(d instanceof he||d instanceof Se)&&c.set(d,p);return u.traverse(d=>{const p=s.associations.get(d);p!=null&&c.set(d,p)}),c};return s.associations=l(n),n})}_createAnimationTracks(t,e,i,s,n){const a=[],o=t.name?t.name:t.uuid,h=[];Us[n.path]===Us.weights?t.traverse(function(d){d.morphTargetInfluences&&h.push(d.name?d.name:d.uuid)}):h.push(o);let l;switch(Us[n.path]){case Us.weights:l=er;break;case Us.rotation:l=zs;break;case Us.translation:case Us.scale:l=Ls;break;default:switch(i.itemSize){case 1:l=er;break;case 2:case 3:default:l=Ls;break}break}const u=s.interpolation!==void 0?pM[s.interpolation]:2301,c=this._getArrayFromAccessor(i);for(let d=0,p=h.length;d<p;d++){const m=new l(h[d]+"."+Us[n.path],e.array,c,u);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),a.push(m)}return a}_getArrayFromAccessor(t){let e=t.array;if(t.normalized){const i=$c(e.constructor),s=new Float32Array(e.length);for(let n=0,a=e.length;n<a;n++)s[n]=e[n]*i;e=s}return e}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(i){const s=this instanceof zs?dM:Of;return new s(this.times,this.values,this.getValueSize()/3,i)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function _M(r,t,e){const i=t.attributes,s=new hi;if(i.POSITION!==void 0){const o=e.json.accessors[i.POSITION],h=o.min,l=o.max;if(h!==void 0&&l!==void 0){if(s.set(new S(h[0],h[1],h[2]),new S(l[0],l[1],l[2])),o.normalized){const u=$c(fr[o.componentType]);s.min.multiplyScalar(u),s.max.multiplyScalar(u)}}else return}else return;const n=t.targets;if(n!==void 0){const o=new S,h=new S;for(let l=0,u=n.length;l<u;l++){const c=n[l];if(c.POSITION!==void 0){const d=e.json.accessors[c.POSITION],p=d.min,m=d.max;if(p!==void 0&&m!==void 0){if(h.setX(Math.max(Math.abs(p[0]),Math.abs(m[0]))),h.setY(Math.max(Math.abs(p[1]),Math.abs(m[1]))),h.setZ(Math.max(Math.abs(p[2]),Math.abs(m[2]))),d.normalized){const f=$c(fr[d.componentType]);h.multiplyScalar(f)}o.max(h)}}}s.expandByVector(o)}r.boundingBox=s;const a=new qe;s.getCenter(a.center),a.radius=s.min.distanceTo(s.max)/2,r.boundingSphere=a}function kf(r,t,e){const i=t.attributes,s=[];function n(a,o){return e.getDependency("accessor",a).then(function(h){r.setAttribute(o,h)})}for(const a in i){const o=Wc[a]||a.toLowerCase();o in r.attributes||s.push(n(i[a],o))}if(t.indices!==void 0&&!r.index){const a=e.getDependency("accessor",t.indices).then(function(o){r.setIndex(o)});s.push(a)}return Vt.workingColorSpace!==ze&&"COLOR_0"in i,os(r,t),_M(r,t,e),Promise.all(s).then(function(){return t.targets!==void 0?fM(r,t.targets,e):r})}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const gr="181dev",Xc=0,Df=1,Uf=2,Wf=1,Hf=100,qf=204,$f=205,Xf=3,vM=0,jf="attached",wM="detached",Gf=300,Yf=1e3,Nh=1001,Zf=1002,Jf=1003,TM=1006,SM=1008,AM=1009,Qf=1015,Kf=1023,NM=0,t1="",bi="srgb",e1="srgb-linear",i1="linear",jc="srgb",yr=7680,s1=519,n1=35044,RM=35048,Rh=2e3,r1=2001;function EM(r){for(let t=r.length-1;t>=0;--t)if(r[t]>=65535)return!0;return!1}function Gc(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}const a1={};function Ot(...r){const t="THREE."+r.shift()}function An(...r){const t="THREE."+r.shift()}function o1(...r){const t=r.join(" ");t in a1||(a1[t]=!0,Ot(...r))}let Eh=class{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){const i=this._listeners;return i===void 0?!1:i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){const i=this._listeners;if(i===void 0)return;const s=i[t];if(s!==void 0){const n=s.indexOf(e);n!==-1&&s.splice(n,1)}}dispatchEvent(t){const e=this._listeners;if(e===void 0)return;const i=e[t.type];if(i!==void 0){t.target=this;const s=i.slice(0);for(let n=0,a=s.length;n<a;n++)s[n].call(this,t);t.target=null}}};const ge=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let h1=1234567;const l1=Math.PI/180,u1=180/Math.PI;function Nn(){const r=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(ge[r&255]+ge[r>>8&255]+ge[r>>16&255]+ge[r>>24&255]+"-"+ge[t&255]+ge[t>>8&255]+"-"+ge[t>>16&15|64]+ge[t>>24&255]+"-"+ge[e&63|128]+ge[e>>8&255]+"-"+ge[e>>16&255]+ge[e>>24&255]+ge[i&255]+ge[i>>8&255]+ge[i>>16&255]+ge[i>>24&255]).toLowerCase()}function ct(r,t,e){return Math.max(t,Math.min(e,r))}function Yc(r,t){return(r%t+t)%t}function IM(r,t,e,i,s){return i+(r-t)*(s-i)/(e-t)}function CM(r,t,e){return r!==t?(e-r)/(t-r):0}function ja(r,t,e){return(1-e)*r+e*t}function zM(r,t,e,i){return ja(r,t,1-Math.exp(-e*i))}function LM(r,t=1){return t-Math.abs(Yc(r,t*2)-t)}function PM(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*(3-2*r))}function BM(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*r*(r*(r*6-15)+10))}function OM(r,t){return r+Math.floor(Math.random()*(t-r+1))}function VM(r,t){return r+Math.random()*(t-r)}function FM(r){return r*(.5-Math.random())}function kM(r){r!==void 0&&(h1=r);let t=h1+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function DM(r){return r*l1}function UM(r){return r*u1}function WM(r){return(r&r-1)===0&&r!==0}function HM(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function qM(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function $M(r,t,e,i,s){const n=Math.cos,a=Math.sin,o=n(e/2),h=a(e/2),l=n((t+i)/2),u=a((t+i)/2),c=n((t-i)/2),d=a((t-i)/2),p=n((i-t)/2),m=a((i-t)/2);switch(s){case"XYX":r.set(o*u,h*c,h*d,o*l);break;case"YZY":r.set(h*d,o*u,h*c,o*l);break;case"ZXZ":r.set(h*c,h*d,o*u,o*l);break;case"XZX":r.set(o*u,h*m,h*p,o*l);break;case"YXY":r.set(h*p,o*u,h*m,o*l);break;case"ZYZ":r.set(h*m,h*p,o*u,o*l);break;default:Ot("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function xr(r,t){switch(t.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function _e(r,t){switch(t.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const Jt={DEG2RAD:l1,RAD2DEG:u1,generateUUID:Nn,clamp:ct,euclideanModulo:Yc,mapLinear:IM,inverseLerp:CM,lerp:ja,damp:zM,pingpong:LM,smoothstep:PM,smootherstep:BM,randInt:OM,randFloat:VM,randFloatSpread:FM,seededRandom:kM,degToRad:DM,radToDeg:UM,isPowerOfTwo:WM,ceilPowerOfTwo:HM,floorPowerOfTwo:qM,setQuaternionFromProperEuler:$M,normalize:_e,denormalize:xr};let ve=class cy{constructor(t=0,e=0){cy.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6],this.y=s[1]*e+s[4]*i+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=ct(this.x,t.x,e.x),this.y=ct(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=ct(this.x,t,e),this.y=ct(this.y,t,e),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(ct(i,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(ct(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),s=Math.sin(e),n=this.x-t.x,a=this.y-t.y;return this.x=n*i-a*s+t.x,this.y=n*s+a*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},ot=class{constructor(t=0,e=0,i=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=s}static slerpFlat(t,e,i,s,n,a,o){let h=i[s+0],l=i[s+1],u=i[s+2],c=i[s+3];const d=n[a+0],p=n[a+1],m=n[a+2],f=n[a+3];if(o===0){t[e+0]=h,t[e+1]=l,t[e+2]=u,t[e+3]=c;return}if(o===1){t[e+0]=d,t[e+1]=p,t[e+2]=m,t[e+3]=f;return}if(c!==f||h!==d||l!==p||u!==m){let g=1-o;const y=h*d+l*p+u*m+c*f,x=y>=0?1:-1,_=1-y*y;if(_>Number.EPSILON){const v=Math.sqrt(_),N=Math.atan2(v,y*x);g=Math.sin(g*N)/v,o=Math.sin(o*N)/v}const M=o*x;if(h=h*g+d*M,l=l*g+p*M,u=u*g+m*M,c=c*g+f*M,g===1-o){const v=1/Math.sqrt(h*h+l*l+u*u+c*c);h*=v,l*=v,u*=v,c*=v}}t[e]=h,t[e+1]=l,t[e+2]=u,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,s,n,a){const o=i[s],h=i[s+1],l=i[s+2],u=i[s+3],c=n[a],d=n[a+1],p=n[a+2],m=n[a+3];return t[e]=o*m+u*c+h*p-l*d,t[e+1]=h*m+u*d+l*c-o*p,t[e+2]=l*m+u*p+o*d-h*c,t[e+3]=u*m-o*c-h*d-l*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,s){return this._x=t,this._y=e,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const i=t._x,s=t._y,n=t._z,a=t._order,o=Math.cos,h=Math.sin,l=o(i/2),u=o(s/2),c=o(n/2),d=h(i/2),p=h(s/2),m=h(n/2);switch(a){case"XYZ":this._x=d*u*c+l*p*m,this._y=l*p*c-d*u*m,this._z=l*u*m+d*p*c,this._w=l*u*c-d*p*m;break;case"YXZ":this._x=d*u*c+l*p*m,this._y=l*p*c-d*u*m,this._z=l*u*m-d*p*c,this._w=l*u*c+d*p*m;break;case"ZXY":this._x=d*u*c-l*p*m,this._y=l*p*c+d*u*m,this._z=l*u*m+d*p*c,this._w=l*u*c-d*p*m;break;case"ZYX":this._x=d*u*c-l*p*m,this._y=l*p*c+d*u*m,this._z=l*u*m-d*p*c,this._w=l*u*c+d*p*m;break;case"YZX":this._x=d*u*c+l*p*m,this._y=l*p*c+d*u*m,this._z=l*u*m-d*p*c,this._w=l*u*c-d*p*m;break;case"XZY":this._x=d*u*c-l*p*m,this._y=l*p*c-d*u*m,this._z=l*u*m+d*p*c,this._w=l*u*c+d*p*m;break;default:Ot("Quaternion: .setFromEuler() encountered an unknown order: "+a)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],n=e[8],a=e[1],o=e[5],h=e[9],l=e[2],u=e[6],c=e[10],d=i+o+c;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(u-h)*p,this._y=(n-l)*p,this._z=(a-s)*p}else if(i>o&&i>c){const p=2*Math.sqrt(1+i-o-c);this._w=(u-h)/p,this._x=.25*p,this._y=(s+a)/p,this._z=(n+l)/p}else if(o>c){const p=2*Math.sqrt(1+o-i-c);this._w=(n-l)/p,this._x=(s+a)/p,this._y=.25*p,this._z=(h+u)/p}else{const p=2*Math.sqrt(1+c-i-o);this._w=(a-s)/p,this._x=(n+l)/p,this._y=(h+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<1e-8?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(ct(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(i===0)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,n=t._z,a=t._w,o=e._x,h=e._y,l=e._z,u=e._w;return this._x=i*u+a*o+s*l-n*h,this._y=s*u+a*h+n*o-i*l,this._z=n*u+a*l+i*h-s*o,this._w=a*u-i*o-s*h-n*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const i=this._x,s=this._y,n=this._z,a=this._w;let o=a*t._w+i*t._x+s*t._y+n*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=i,this._y=s,this._z=n,this;const h=1-o*o;if(h<=Number.EPSILON){const p=1-e;return this._w=p*a+e*this._w,this._x=p*i+e*this._x,this._y=p*s+e*this._y,this._z=p*n+e*this._z,this.normalize(),this}const l=Math.sqrt(h),u=Math.atan2(l,o),c=Math.sin((1-e)*u)/l,d=Math.sin(e*u)/l;return this._w=a*c+this._w*d,this._x=i*c+this._x*d,this._y=s*c+this._y*d,this._z=n*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),i=Math.random(),s=Math.sqrt(1-i),n=Math.sqrt(i);return this.set(s*Math.sin(t),s*Math.cos(t),n*Math.sin(e),n*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},E=class dy{constructor(t=0,e=0,i=0){dy.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(c1.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(c1.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,s=this.z,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6]*s,this.y=n[1]*e+n[4]*i+n[7]*s,this.z=n[2]*e+n[5]*i+n[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,n=t.elements,a=1/(n[3]*e+n[7]*i+n[11]*s+n[15]);return this.x=(n[0]*e+n[4]*i+n[8]*s+n[12])*a,this.y=(n[1]*e+n[5]*i+n[9]*s+n[13])*a,this.z=(n[2]*e+n[6]*i+n[10]*s+n[14])*a,this}applyQuaternion(t){const e=this.x,i=this.y,s=this.z,n=t.x,a=t.y,o=t.z,h=t.w,l=2*(a*s-o*i),u=2*(o*e-n*s),c=2*(n*i-a*e);return this.x=e+h*l+a*c-o*u,this.y=i+h*u+o*l-n*c,this.z=s+h*c+n*u-a*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,s=this.z,n=t.elements;return this.x=n[0]*e+n[4]*i+n[8]*s,this.y=n[1]*e+n[5]*i+n[9]*s,this.z=n[2]*e+n[6]*i+n[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=ct(this.x,t.x,e.x),this.y=ct(this.y,t.y,e.y),this.z=ct(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=ct(this.x,t,e),this.y=ct(this.y,t,e),this.z=ct(this.z,t,e),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(ct(i,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,n=t.z,a=e.x,o=e.y,h=e.z;return this.x=s*h-n*o,this.y=n*a-i*h,this.z=i*o-s*a,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return Zc.copy(this).projectOnVector(t),this.sub(Zc)}reflect(t){return this.sub(Zc.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(ct(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this.x=s*Math.sin(i),this.y=Math.cos(e)*t,this.z=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=Math.random()*2-1,i=Math.sqrt(1-e*e);return this.x=i*Math.cos(t),this.y=e,this.z=i*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const Zc=new E,c1=new ot;let Xt=class py{constructor(t,e,i,s,n,a,o,h,l){py.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,i,s,n,a,o,h,l)}set(t,e,i,s,n,a,o,h,l){const u=this.elements;return u[0]=t,u[1]=s,u[2]=o,u[3]=e,u[4]=n,u[5]=h,u[6]=i,u[7]=a,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,n=this.elements,a=i[0],o=i[3],h=i[6],l=i[1],u=i[4],c=i[7],d=i[2],p=i[5],m=i[8],f=s[0],g=s[3],y=s[6],x=s[1],_=s[4],M=s[7],v=s[2],N=s[5],T=s[8];return n[0]=a*f+o*x+h*v,n[3]=a*g+o*_+h*N,n[6]=a*y+o*M+h*T,n[1]=l*f+u*x+c*v,n[4]=l*g+u*_+c*N,n[7]=l*y+u*M+c*T,n[2]=d*f+p*x+m*v,n[5]=d*g+p*_+m*N,n[8]=d*y+p*M+m*T,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],s=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=t[8];return e*a*u-e*o*l-i*n*u+i*o*h+s*n*l-s*a*h}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=t[8],c=u*a-o*l,d=o*h-u*n,p=l*n-a*h,m=e*c+i*d+s*p;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const f=1/m;return t[0]=c*f,t[1]=(s*l-u*i)*f,t[2]=(o*i-s*a)*f,t[3]=d*f,t[4]=(u*e-s*h)*f,t[5]=(s*n-o*e)*f,t[6]=p*f,t[7]=(i*h-l*e)*f,t[8]=(a*e-i*n)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,s,n,a,o){const h=Math.cos(n),l=Math.sin(n);return this.set(i*h,i*l,-i*(h*a+l*o)+a+t,-s*l,s*h,-s*(-l*a+h*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(Jc.makeScale(t,e)),this}rotate(t){return this.premultiply(Jc.makeRotation(-t)),this}translate(t,e){return this.premultiply(Jc.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,i=t.elements;for(let s=0;s<9;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}};const Jc=new Xt,d1=new Xt().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),p1=new Xt().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function XM(){const r={enabled:!0,workingColorSpace:e1,spaces:{},convert:function(s,n,a){return this.enabled===!1||n===a||!n||!a||(this.spaces[n].transfer===jc&&(s.r=hs(s.r),s.g=hs(s.g),s.b=hs(s.b)),this.spaces[n].primaries!==this.spaces[a].primaries&&(s.applyMatrix3(this.spaces[n].toXYZ),s.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===jc&&(s.r=br(s.r),s.g=br(s.g),s.b=br(s.b))),s},workingToColorSpace:function(s,n){return this.convert(s,this.workingColorSpace,n)},colorSpaceToWorking:function(s,n){return this.convert(s,n,this.workingColorSpace)},getPrimaries:function(s){return this.spaces[s].primaries},getTransfer:function(s){return s===t1?i1:this.spaces[s].transfer},getToneMappingMode:function(s){return this.spaces[s].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(s,n=this.workingColorSpace){return s.fromArray(this.spaces[n].luminanceCoefficients)},define:function(s){Object.assign(this.spaces,s)},_getMatrix:function(s,n,a){return s.copy(this.spaces[n].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(s){return this.spaces[s].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(s=this.workingColorSpace){return this.spaces[s].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(s,n){return o1("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),r.workingToColorSpace(s,n)},toWorkingColorSpace:function(s,n){return o1("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),r.colorSpaceToWorking(s,n)}},t=[.64,.33,.3,.6,.15,.06],e=[.2126,.7152,.0722],i=[.3127,.329];return r.define({[e1]:{primaries:t,whitePoint:i,transfer:i1,toXYZ:d1,fromXYZ:p1,luminanceCoefficients:e,workingColorSpaceConfig:{unpackColorSpace:bi},outputColorSpaceConfig:{drawingBufferColorSpace:bi}},[bi]:{primaries:t,whitePoint:i,transfer:jc,toXYZ:d1,fromXYZ:p1,luminanceCoefficients:e,outputColorSpaceConfig:{drawingBufferColorSpace:bi}}}),r}const Mi=XM();function hs(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function br(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}let Mr,jM=class{static getDataURL(t,e="image/png"){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let i;if(t instanceof HTMLCanvasElement)i=t;else{Mr===void 0&&(Mr=Gc("canvas")),Mr.width=t.width,Mr.height=t.height;const s=Mr.getContext("2d");t instanceof ImageData?s.putImageData(t,0,0):s.drawImage(t,0,0,t.width,t.height),i=Mr}return i.toDataURL(e)}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=Gc("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const s=i.getImageData(0,0,t.width,t.height),n=s.data;for(let a=0;a<n.length;a++)n[a]=hs(n[a]/255)*255;return i.putImageData(s,0,0),e}else if(t.data){const e=t.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(hs(e[i]/255)*255):e[i]=hs(e[i]);return{data:e,width:t.width,height:t.height}}else return Ot("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}},GM=0,YM=class{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:GM++}),this.uuid=Nn(),this.data=t,this.dataReady=!0,this.version=0}getSize(t){const e=this.data;return typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?t.set(e.videoWidth,e.videoHeight,0):e instanceof VideoFrame?t.set(e.displayHeight,e.displayWidth,0):e!==null?t.set(e.width,e.height,e.depth||0):t.set(0,0,0),t}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let n;if(Array.isArray(s)){n=[];for(let a=0,o=s.length;a<o;a++)s[a].isDataTexture?n.push(Qc(s[a].image)):n.push(Qc(s[a]))}else n=Qc(s);i.url=n}return e||(t.images[this.uuid]=i),i}};function Qc(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?jM.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(Ot("Texture: Unable to serialize Texture."),{})}let ZM=0;const Kc=new E;let Ih=class Hl extends Eh{constructor(t=Hl.DEFAULT_IMAGE,e=Hl.DEFAULT_MAPPING,i=Nh,s=Nh,n=TM,a=SM,o=Kf,h=AM,l=Hl.DEFAULT_ANISOTROPY,u=t1){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:ZM++}),this.uuid=Nn(),this.name="",this.source=new YM(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=n,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=h,this.offset=new ve(0,0),this.repeat=new ve(1,1),this.center=new ve(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Xt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(t&&t.depth&&t.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(Kc).x}get height(){return this.source.getSize(Kc).y}get depth(){return this.source.getSize(Kc).z}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.isArrayTexture=t.isArrayTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}setValues(t){for(const e in t){const i=t[e];if(i===void 0){Ot(`Texture.setValues(): parameter '${e}' has value of undefined.`);continue}const s=this[e];if(s===void 0){Ot(`Texture.setValues(): property '${e}' does not exist.`);continue}s&&i&&s.isVector2&&i.isVector2||s&&i&&s.isVector3&&i.isVector3||s&&i&&s.isMatrix3&&i.isMatrix3?s.copy(i):this[e]=i}}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const i={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==Gf)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Yf:t.x=t.x-Math.floor(t.x);break;case Nh:t.x=t.x<0?0:1;break;case Zf:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Yf:t.y=t.y-Math.floor(t.y);break;case Nh:t.y=t.y<0?0:1;break;case Zf:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}};Ih.DEFAULT_IMAGE=null,Ih.DEFAULT_MAPPING=Gf,Ih.DEFAULT_ANISOTROPY=1;let _r=class my{constructor(t=0,e=0,i=0,s=1){my.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=s}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,s){return this.x=t,this.y=e,this.z=i,this.w=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,n=this.w,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*s+a[12]*n,this.y=a[1]*e+a[5]*i+a[9]*s+a[13]*n,this.z=a[2]*e+a[6]*i+a[10]*s+a[14]*n,this.w=a[3]*e+a[7]*i+a[11]*s+a[15]*n,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,s,n;const h=t.elements,l=h[0],u=h[4],c=h[8],d=h[1],p=h[5],m=h[9],f=h[2],g=h[6],y=h[10];if(Math.abs(u-d)<.01&&Math.abs(c-f)<.01&&Math.abs(m-g)<.01){if(Math.abs(u+d)<.1&&Math.abs(c+f)<.1&&Math.abs(m+g)<.1&&Math.abs(l+p+y-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const _=(l+1)/2,M=(p+1)/2,v=(y+1)/2,N=(u+d)/4,T=(c+f)/4,C=(m+g)/4;return _>M&&_>v?_<.01?(i=0,s=.707106781,n=.707106781):(i=Math.sqrt(_),s=N/i,n=T/i):M>v?M<.01?(i=.707106781,s=0,n=.707106781):(s=Math.sqrt(M),i=N/s,n=C/s):v<.01?(i=.707106781,s=.707106781,n=0):(n=Math.sqrt(v),i=T/n,s=C/n),this.set(i,s,n,e),this}let x=Math.sqrt((g-m)*(g-m)+(c-f)*(c-f)+(d-u)*(d-u));return Math.abs(x)<.001&&(x=1),this.x=(g-m)/x,this.y=(c-f)/x,this.z=(d-u)/x,this.w=Math.acos((l+p+y-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=ct(this.x,t.x,e.x),this.y=ct(this.y,t.y,e.y),this.z=ct(this.z,t.z,e.z),this.w=ct(this.w,t.w,e.w),this}clampScalar(t,e){return this.x=ct(this.x,t,e),this.y=ct(this.y,t,e),this.z=ct(this.z,t,e),this.w=ct(this.w,t,e),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(ct(i,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}},vr=class{constructor(t=new E(1/0,1/0,1/0),e=new E(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e+=3)this.expandByPoint(_i.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,i=t.count;e<i;e++)this.expandByPoint(_i.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=_i.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(i!==void 0){const n=i.getAttribute("position");if(e===!0&&n!==void 0&&t.isInstancedMesh!==!0)for(let a=0,o=n.count;a<o;a++)t.isMesh===!0?t.getVertexPosition(a,_i):_i.fromBufferAttribute(n,a),_i.applyMatrix4(t.matrixWorld),this.expandByPoint(_i);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),Ch.copy(t.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),Ch.copy(i.boundingBox)),Ch.applyMatrix4(t.matrixWorld),this.union(Ch)}const s=t.children;for(let n=0,a=s.length;n<a;n++)this.expandByObject(s[n],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,_i),_i.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Ga),zh.subVectors(this.max,Ga),wr.subVectors(t.a,Ga),Tr.subVectors(t.b,Ga),Sr.subVectors(t.c,Ga),Ws.subVectors(Tr,wr),Hs.subVectors(Sr,Tr),Rn.subVectors(wr,Sr);let e=[0,-Ws.z,Ws.y,0,-Hs.z,Hs.y,0,-Rn.z,Rn.y,Ws.z,0,-Ws.x,Hs.z,0,-Hs.x,Rn.z,0,-Rn.x,-Ws.y,Ws.x,0,-Hs.y,Hs.x,0,-Rn.y,Rn.x,0];return!td(e,wr,Tr,Sr,zh)||(e=[1,0,0,0,1,0,0,0,1],!td(e,wr,Tr,Sr,zh))?!1:(Lh.crossVectors(Ws,Hs),e=[Lh.x,Lh.y,Lh.z],td(e,wr,Tr,Sr,zh))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,_i).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(_i).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(ls[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ls[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ls[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ls[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ls[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ls[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ls[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ls[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ls),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(t){return this.min.fromArray(t.min),this.max.fromArray(t.max),this}};const ls=[new E,new E,new E,new E,new E,new E,new E,new E],_i=new E,Ch=new vr,wr=new E,Tr=new E,Sr=new E,Ws=new E,Hs=new E,Rn=new E,Ga=new E,zh=new E,Lh=new E,En=new E;function td(r,t,e,i,s){for(let n=0,a=r.length-3;n<=a;n+=3){En.fromArray(r,n);const o=s.x*Math.abs(En.x)+s.y*Math.abs(En.y)+s.z*Math.abs(En.z),h=t.dot(En),l=e.dot(En),u=i.dot(En);if(Math.max(-Math.max(h,l,u),Math.min(h,l,u))>o)return!1}return!0}const JM=new vr,Ya=new E,ed=new E;let Za=class{constructor(t=new E,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;e!==void 0?i.copy(e):JM.setFromPoints(t).getCenter(i);let s=0;for(let n=0,a=t.length;n<a;n++)s=Math.max(s,i.distanceToSquared(t[n]));return this.radius=Math.sqrt(s),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Ya.subVectors(t,this.center);const e=Ya.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),s=(i-this.radius)*.5;this.center.addScaledVector(Ya,s/i),this.radius+=s}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(ed.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Ya.copy(t.center).add(ed)),this.expandByPoint(Ya.copy(t.center).sub(ed))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(t){return this.radius=t.radius,this.center.fromArray(t.center),this}};const us=new E,id=new E,Ph=new E,qs=new E,sd=new E,Bh=new E,nd=new E;let rd=class{constructor(t=new E,e=new E(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,us)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=us.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(us.copy(this.origin).addScaledVector(this.direction,e),us.distanceToSquared(t))}distanceSqToSegment(t,e,i,s){id.copy(t).add(e).multiplyScalar(.5),Ph.copy(e).sub(t).normalize(),qs.copy(this.origin).sub(id);const n=t.distanceTo(e)*.5,a=-this.direction.dot(Ph),o=qs.dot(this.direction),h=-qs.dot(Ph),l=qs.lengthSq(),u=Math.abs(1-a*a);let c,d,p,m;if(u>0)if(c=a*h-o,d=a*o-h,m=n*u,c>=0)if(d>=-m)if(d<=m){const f=1/u;c*=f,d*=f,p=c*(c+a*d+2*o)+d*(a*c+d+2*h)+l}else d=n,c=Math.max(0,-(a*d+o)),p=-c*c+d*(d+2*h)+l;else d=-n,c=Math.max(0,-(a*d+o)),p=-c*c+d*(d+2*h)+l;else d<=-m?(c=Math.max(0,-(-a*n+o)),d=c>0?-n:Math.min(Math.max(-n,-h),n),p=-c*c+d*(d+2*h)+l):d<=m?(c=0,d=Math.min(Math.max(-n,-h),n),p=d*(d+2*h)+l):(c=Math.max(0,-(a*n+o)),d=c>0?n:Math.min(Math.max(-n,-h),n),p=-c*c+d*(d+2*h)+l);else d=a>0?-n:n,c=Math.max(0,-(a*d+o)),p=-c*c+d*(d+2*h)+l;return i&&i.copy(this.origin).addScaledVector(this.direction,c),s&&s.copy(id).addScaledVector(Ph,d),p}intersectSphere(t,e){us.subVectors(t.center,this.origin);const i=us.dot(this.direction),s=us.dot(us)-i*i,n=t.radius*t.radius;if(s>n)return null;const a=Math.sqrt(n-s),o=i-a,h=i+a;return h<0?null:o<0?this.at(h,e):this.at(o,e)}intersectsSphere(t){return t.radius<0?!1:this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return i===null?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,s,n,a,o,h;const l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,d=this.origin;return l>=0?(i=(t.min.x-d.x)*l,s=(t.max.x-d.x)*l):(i=(t.max.x-d.x)*l,s=(t.min.x-d.x)*l),u>=0?(n=(t.min.y-d.y)*u,a=(t.max.y-d.y)*u):(n=(t.max.y-d.y)*u,a=(t.min.y-d.y)*u),i>a||n>s||((n>i||isNaN(i))&&(i=n),(a<s||isNaN(s))&&(s=a),c>=0?(o=(t.min.z-d.z)*c,h=(t.max.z-d.z)*c):(o=(t.max.z-d.z)*c,h=(t.min.z-d.z)*c),i>h||o>s)||((o>i||i!==i)&&(i=o),(h<s||s!==s)&&(s=h),s<0)?null:this.at(i>=0?i:s,e)}intersectsBox(t){return this.intersectBox(t,us)!==null}intersectTriangle(t,e,i,s,n){sd.subVectors(e,t),Bh.subVectors(i,t),nd.crossVectors(sd,Bh);let a=this.direction.dot(nd),o;if(a>0){if(s)return null;o=1}else if(a<0)o=-1,a=-a;else return null;qs.subVectors(this.origin,t);const h=o*this.direction.dot(Bh.crossVectors(qs,Bh));if(h<0)return null;const l=o*this.direction.dot(sd.cross(qs));if(l<0||h+l>a)return null;const u=-o*qs.dot(nd);return u<0?null:this.at(u/a,n)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},Ct=class v0{constructor(t,e,i,s,n,a,o,h,l,u,c,d,p,m,f,g){v0.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,i,s,n,a,o,h,l,u,c,d,p,m,f,g)}set(t,e,i,s,n,a,o,h,l,u,c,d,p,m,f,g){const y=this.elements;return y[0]=t,y[4]=e,y[8]=i,y[12]=s,y[1]=n,y[5]=a,y[9]=o,y[13]=h,y[2]=l,y[6]=u,y[10]=c,y[14]=d,y[3]=p,y[7]=m,y[11]=f,y[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new v0().fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,s=1/Ar.setFromMatrixColumn(t,0).length(),n=1/Ar.setFromMatrixColumn(t,1).length(),a=1/Ar.setFromMatrixColumn(t,2).length();return e[0]=i[0]*s,e[1]=i[1]*s,e[2]=i[2]*s,e[3]=0,e[4]=i[4]*n,e[5]=i[5]*n,e[6]=i[6]*n,e[7]=0,e[8]=i[8]*a,e[9]=i[9]*a,e[10]=i[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,s=t.y,n=t.z,a=Math.cos(i),o=Math.sin(i),h=Math.cos(s),l=Math.sin(s),u=Math.cos(n),c=Math.sin(n);if(t.order==="XYZ"){const d=a*u,p=a*c,m=o*u,f=o*c;e[0]=h*u,e[4]=-h*c,e[8]=l,e[1]=p+m*l,e[5]=d-f*l,e[9]=-o*h,e[2]=f-d*l,e[6]=m+p*l,e[10]=a*h}else if(t.order==="YXZ"){const d=h*u,p=h*c,m=l*u,f=l*c;e[0]=d+f*o,e[4]=m*o-p,e[8]=a*l,e[1]=a*c,e[5]=a*u,e[9]=-o,e[2]=p*o-m,e[6]=f+d*o,e[10]=a*h}else if(t.order==="ZXY"){const d=h*u,p=h*c,m=l*u,f=l*c;e[0]=d-f*o,e[4]=-a*c,e[8]=m+p*o,e[1]=p+m*o,e[5]=a*u,e[9]=f-d*o,e[2]=-a*l,e[6]=o,e[10]=a*h}else if(t.order==="ZYX"){const d=a*u,p=a*c,m=o*u,f=o*c;e[0]=h*u,e[4]=m*l-p,e[8]=d*l+f,e[1]=h*c,e[5]=f*l+d,e[9]=p*l-m,e[2]=-l,e[6]=o*h,e[10]=a*h}else if(t.order==="YZX"){const d=a*h,p=a*l,m=o*h,f=o*l;e[0]=h*u,e[4]=f-d*c,e[8]=m*c+p,e[1]=c,e[5]=a*u,e[9]=-o*u,e[2]=-l*u,e[6]=p*c+m,e[10]=d-f*c}else if(t.order==="XZY"){const d=a*h,p=a*l,m=o*h,f=o*l;e[0]=h*u,e[4]=-c,e[8]=l*u,e[1]=d*c+f,e[5]=a*u,e[9]=p*c-m,e[2]=m*c-p,e[6]=o*u,e[10]=f*c+d}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(QM,t,KM)}lookAt(t,e,i){const s=this.elements;return Fe.subVectors(t,e),Fe.lengthSq()===0&&(Fe.z=1),Fe.normalize(),$s.crossVectors(i,Fe),$s.lengthSq()===0&&(Math.abs(i.z)===1?Fe.x+=1e-4:Fe.z+=1e-4,Fe.normalize(),$s.crossVectors(i,Fe)),$s.normalize(),Oh.crossVectors(Fe,$s),s[0]=$s.x,s[4]=Oh.x,s[8]=Fe.x,s[1]=$s.y,s[5]=Oh.y,s[9]=Fe.y,s[2]=$s.z,s[6]=Oh.z,s[10]=Fe.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,n=this.elements,a=i[0],o=i[4],h=i[8],l=i[12],u=i[1],c=i[5],d=i[9],p=i[13],m=i[2],f=i[6],g=i[10],y=i[14],x=i[3],_=i[7],M=i[11],v=i[15],N=s[0],T=s[4],C=s[8],P=s[12],F=s[1],D=s[5],q=s[9],X=s[13],it=s[2],mt=s[6],xt=s[10],Q=s[14],gt=s[3],st=s[7],rt=s[11],Rt=s[15];return n[0]=a*N+o*F+h*it+l*gt,n[4]=a*T+o*D+h*mt+l*st,n[8]=a*C+o*q+h*xt+l*rt,n[12]=a*P+o*X+h*Q+l*Rt,n[1]=u*N+c*F+d*it+p*gt,n[5]=u*T+c*D+d*mt+p*st,n[9]=u*C+c*q+d*xt+p*rt,n[13]=u*P+c*X+d*Q+p*Rt,n[2]=m*N+f*F+g*it+y*gt,n[6]=m*T+f*D+g*mt+y*st,n[10]=m*C+f*q+g*xt+y*rt,n[14]=m*P+f*X+g*Q+y*Rt,n[3]=x*N+_*F+M*it+v*gt,n[7]=x*T+_*D+M*mt+v*st,n[11]=x*C+_*q+M*xt+v*rt,n[15]=x*P+_*X+M*Q+v*Rt,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],s=t[8],n=t[12],a=t[1],o=t[5],h=t[9],l=t[13],u=t[2],c=t[6],d=t[10],p=t[14],m=t[3],f=t[7],g=t[11],y=t[15];return m*(+n*h*c-s*l*c-n*o*d+i*l*d+s*o*p-i*h*p)+f*(+e*h*p-e*l*d+n*a*d-s*a*p+s*l*u-n*h*u)+g*(+e*l*c-e*o*p-n*a*c+i*a*p+n*o*u-i*l*u)+y*(-s*o*u-e*h*c+e*o*d+s*a*c-i*a*d+i*h*u)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=t[8],c=t[9],d=t[10],p=t[11],m=t[12],f=t[13],g=t[14],y=t[15],x=c*g*l-f*d*l+f*h*p-o*g*p-c*h*y+o*d*y,_=m*d*l-u*g*l-m*h*p+a*g*p+u*h*y-a*d*y,M=u*f*l-m*c*l+m*o*p-a*f*p-u*o*y+a*c*y,v=m*c*h-u*f*h-m*o*d+a*f*d+u*o*g-a*c*g,N=e*x+i*_+s*M+n*v;if(N===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/N;return t[0]=x*T,t[1]=(f*d*n-c*g*n-f*s*p+i*g*p+c*s*y-i*d*y)*T,t[2]=(o*g*n-f*h*n+f*s*l-i*g*l-o*s*y+i*h*y)*T,t[3]=(c*h*n-o*d*n-c*s*l+i*d*l+o*s*p-i*h*p)*T,t[4]=_*T,t[5]=(u*g*n-m*d*n+m*s*p-e*g*p-u*s*y+e*d*y)*T,t[6]=(m*h*n-a*g*n-m*s*l+e*g*l+a*s*y-e*h*y)*T,t[7]=(a*d*n-u*h*n+u*s*l-e*d*l-a*s*p+e*h*p)*T,t[8]=M*T,t[9]=(m*c*n-u*f*n-m*i*p+e*f*p+u*i*y-e*c*y)*T,t[10]=(a*f*n-m*o*n+m*i*l-e*f*l-a*i*y+e*o*y)*T,t[11]=(u*o*n-a*c*n-u*i*l+e*c*l+a*i*p-e*o*p)*T,t[12]=v*T,t[13]=(u*f*s-m*c*s+m*i*d-e*f*d-u*i*g+e*c*g)*T,t[14]=(m*o*s-a*f*s-m*i*h+e*f*h+a*i*g-e*o*g)*T,t[15]=(a*c*s-u*o*s+u*i*h-e*c*h-a*i*d+e*o*d)*T,this}scale(t){const e=this.elements,i=t.x,s=t.y,n=t.z;return e[0]*=i,e[4]*=s,e[8]*=n,e[1]*=i,e[5]*=s,e[9]*=n,e[2]*=i,e[6]*=s,e[10]*=n,e[3]*=i,e[7]*=s,e[11]*=n,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,s))}makeTranslation(t,e,i){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),s=Math.sin(e),n=1-i,a=t.x,o=t.y,h=t.z,l=n*a,u=n*o;return this.set(l*a+i,l*o-s*h,l*h+s*o,0,l*o+s*h,u*o+i,u*h-s*a,0,l*h-s*o,u*h+s*a,n*h*h+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,s,n,a){return this.set(1,i,n,0,t,1,a,0,e,s,1,0,0,0,0,1),this}compose(t,e,i){const s=this.elements,n=e._x,a=e._y,o=e._z,h=e._w,l=n+n,u=a+a,c=o+o,d=n*l,p=n*u,m=n*c,f=a*u,g=a*c,y=o*c,x=h*l,_=h*u,M=h*c,v=i.x,N=i.y,T=i.z;return s[0]=(1-(f+y))*v,s[1]=(p+M)*v,s[2]=(m-_)*v,s[3]=0,s[4]=(p-M)*N,s[5]=(1-(d+y))*N,s[6]=(g+x)*N,s[7]=0,s[8]=(m+_)*T,s[9]=(g-x)*T,s[10]=(1-(d+f))*T,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,i){const s=this.elements;let n=Ar.set(s[0],s[1],s[2]).length();const a=Ar.set(s[4],s[5],s[6]).length(),o=Ar.set(s[8],s[9],s[10]).length();this.determinant()<0&&(n=-n),t.x=s[12],t.y=s[13],t.z=s[14],vi.copy(this);const l=1/n,u=1/a,c=1/o;return vi.elements[0]*=l,vi.elements[1]*=l,vi.elements[2]*=l,vi.elements[4]*=u,vi.elements[5]*=u,vi.elements[6]*=u,vi.elements[8]*=c,vi.elements[9]*=c,vi.elements[10]*=c,e.setFromRotationMatrix(vi),i.x=n,i.y=a,i.z=o,this}makePerspective(t,e,i,s,n,a,o=Rh,h=!1){const l=this.elements,u=2*n/(e-t),c=2*n/(i-s),d=(e+t)/(e-t),p=(i+s)/(i-s);let m,f;if(h)m=n/(a-n),f=a*n/(a-n);else if(o===Rh)m=-(a+n)/(a-n),f=-2*a*n/(a-n);else if(o===r1)m=-a/(a-n),f=-a*n/(a-n);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return l[0]=u,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=c,l[9]=p,l[13]=0,l[2]=0,l[6]=0,l[10]=m,l[14]=f,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,e,i,s,n,a,o=Rh,h=!1){const l=this.elements,u=2/(e-t),c=2/(i-s),d=-(e+t)/(e-t),p=-(i+s)/(i-s);let m,f;if(h)m=1/(a-n),f=a/(a-n);else if(o===Rh)m=-2/(a-n),f=-(a+n)/(a-n);else if(o===r1)m=-1/(a-n),f=-n/(a-n);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return l[0]=u,l[4]=0,l[8]=0,l[12]=d,l[1]=0,l[5]=c,l[9]=0,l[13]=p,l[2]=0,l[6]=0,l[10]=m,l[14]=f,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let s=0;s<16;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}};const Ar=new E,vi=new Ct,QM=new E(0,0,0),KM=new E(1,1,1),$s=new E,Oh=new E,Fe=new E,m1=new Ct,f1=new ot;let Nr=class fy{constructor(t=0,e=0,i=0,s=fy.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,s=this._order){return this._x=t,this._y=e,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const s=t.elements,n=s[0],a=s[4],o=s[8],h=s[1],l=s[5],u=s[9],c=s[2],d=s[6],p=s[10];switch(e){case"XYZ":this._y=Math.asin(ct(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-a,n)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ct(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(h,l)):(this._y=Math.atan2(-c,n),this._z=0);break;case"ZXY":this._x=Math.asin(ct(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-c,p),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(h,n));break;case"ZYX":this._y=Math.asin(-ct(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(h,n)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(ct(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-c,n)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-ct(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-u,p),this._y=0);break;default:Ot("Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return m1.makeRotationFromQuaternion(t),this.setFromRotationMatrix(m1,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return f1.setFromEuler(this),this.setFromQuaternion(f1,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};Nr.DEFAULT_ORDER="XYZ";let t_=class{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}},e_=0;const g1=new E,Rr=new ot,cs=new Ct,Vh=new E,Ja=new E,i_=new E,s_=new ot,y1=new E(1,0,0),x1=new E(0,1,0),b1=new E(0,0,1),M1={type:"added"},n_={type:"removed"},Er={type:"childadded",child:null},ad={type:"childremoved",child:null};let ii=class ql extends Eh{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:e_++}),this.uuid=Nn(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ql.DEFAULT_UP.clone();const t=new E,e=new Nr,i=new ot,s=new E(1,1,1);function n(){i.setFromEuler(e,!1)}function a(){e.setFromQuaternion(i,void 0,!1)}e._onChange(n),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Ct},normalMatrix:{value:new Xt}}),this.matrix=new Ct,this.matrixWorld=new Ct,this.matrixAutoUpdate=ql.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=ql.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new t_,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Rr.setFromAxisAngle(t,e),this.quaternion.multiply(Rr),this}rotateOnWorldAxis(t,e){return Rr.setFromAxisAngle(t,e),this.quaternion.premultiply(Rr),this}rotateX(t){return this.rotateOnAxis(y1,t)}rotateY(t){return this.rotateOnAxis(x1,t)}rotateZ(t){return this.rotateOnAxis(b1,t)}translateOnAxis(t,e){return g1.copy(t).applyQuaternion(this.quaternion),this.position.add(g1.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(y1,t)}translateY(t){return this.translateOnAxis(x1,t)}translateZ(t){return this.translateOnAxis(b1,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(cs.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?Vh.copy(t):Vh.set(t,e,i);const s=this.parent;this.updateWorldMatrix(!0,!1),Ja.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?cs.lookAt(Ja,Vh,this.up):cs.lookAt(Vh,Ja,this.up),this.quaternion.setFromRotationMatrix(cs),s&&(cs.extractRotation(s.matrixWorld),Rr.setFromRotationMatrix(cs),this.quaternion.premultiply(Rr.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(An("Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(M1),Er.child=t,this.dispatchEvent(Er),Er.child=null):An("Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(n_),ad.child=t,this.dispatchEvent(ad),ad.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),cs.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),cs.multiply(t.parent.matrixWorld)),t.applyMatrix4(cs),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(M1),Er.child=t,this.dispatchEvent(Er),Er.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,s=this.children.length;i<s;i++){const a=this.children[i].getObjectByProperty(t,e);if(a!==void 0)return a}}getObjectsByProperty(t,e,i=[]){this[t]===e&&i.push(this);const s=this.children;for(let n=0,a=s.length;n<a;n++)s[n].getObjectsByProperty(t,e,i);return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ja,t,i_),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ja,s_,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(t===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),e===!0){const s=this.children;for(let n=0,a=s.length;n<a;n++)s[n].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),s.instanceInfo=this._instanceInfo.map(o=>({...o})),s.availableInstanceIds=this._availableInstanceIds.slice(),s.availableGeometryIds=this._availableGeometryIds.slice(),s.nextIndexStart=this._nextIndexStart,s.nextVertexStart=this._nextVertexStart,s.geometryCount=this._geometryCount,s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.matricesTexture=this._matricesTexture.toJSON(t),s.indirectTexture=this._indirectTexture.toJSON(t),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(s.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(s.boundingBox=this.boundingBox.toJSON()));function n(o,h){return o[h.uuid]===void 0&&(o[h.uuid]=h.toJSON(t)),h.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=n(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const h=o.shapes;if(Array.isArray(h))for(let l=0,u=h.length;l<u;l++){const c=h[l];n(t.shapes,c)}else n(t.shapes,h)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let h=0,l=this.material.length;h<l;h++)o.push(n(t.materials,this.material[h]));s.material=o}else s.material=n(t.materials,this.material);if(this.children.length>0){s.children=[];for(let o=0;o<this.children.length;o++)s.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let o=0;o<this.animations.length;o++){const h=this.animations[o];s.animations.push(n(t.animations,h))}}if(e){const o=a(t.geometries),h=a(t.materials),l=a(t.textures),u=a(t.images),c=a(t.shapes),d=a(t.skeletons),p=a(t.animations),m=a(t.nodes);o.length>0&&(i.geometries=o),h.length>0&&(i.materials=h),l.length>0&&(i.textures=l),u.length>0&&(i.images=u),c.length>0&&(i.shapes=c),d.length>0&&(i.skeletons=d),p.length>0&&(i.animations=p),m.length>0&&(i.nodes=m)}return i.object=s,i;function a(o){const h=[];for(const l in o){const u=o[l];delete u.metadata,h.push(u)}return h}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){const s=t.children[i];this.add(s.clone())}return this}};ii.DEFAULT_UP=new E(0,1,0),ii.DEFAULT_MATRIX_AUTO_UPDATE=!0,ii.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const wi=new E,ds=new E,od=new E,ps=new E,Ir=new E,Cr=new E,_1=new E,hd=new E,ld=new E,ud=new E,cd=new _r,dd=new _r,pd=new _r;let Qa=class ia{constructor(t=new E,e=new E,i=new E){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,s){s.subVectors(i,e),wi.subVectors(t,e),s.cross(wi);const n=s.lengthSq();return n>0?s.multiplyScalar(1/Math.sqrt(n)):s.set(0,0,0)}static getBarycoord(t,e,i,s,n){wi.subVectors(s,e),ds.subVectors(i,e),od.subVectors(t,e);const a=wi.dot(wi),o=wi.dot(ds),h=wi.dot(od),l=ds.dot(ds),u=ds.dot(od),c=a*l-o*o;if(c===0)return n.set(0,0,0),null;const d=1/c,p=(l*h-o*u)*d,m=(a*u-o*h)*d;return n.set(1-p-m,m,p)}static containsPoint(t,e,i,s){return this.getBarycoord(t,e,i,s,ps)===null?!1:ps.x>=0&&ps.y>=0&&ps.x+ps.y<=1}static getInterpolation(t,e,i,s,n,a,o,h){return this.getBarycoord(t,e,i,s,ps)===null?(h.x=0,h.y=0,"z"in h&&(h.z=0),"w"in h&&(h.w=0),null):(h.setScalar(0),h.addScaledVector(n,ps.x),h.addScaledVector(a,ps.y),h.addScaledVector(o,ps.z),h)}static getInterpolatedAttribute(t,e,i,s,n,a){return cd.setScalar(0),dd.setScalar(0),pd.setScalar(0),cd.fromBufferAttribute(t,e),dd.fromBufferAttribute(t,i),pd.fromBufferAttribute(t,s),a.setScalar(0),a.addScaledVector(cd,n.x),a.addScaledVector(dd,n.y),a.addScaledVector(pd,n.z),a}static isFrontFacing(t,e,i,s){return wi.subVectors(i,e),ds.subVectors(t,e),wi.cross(ds).dot(s)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,s){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[s]),this}setFromAttributeAndIndices(t,e,i,s){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,s),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return wi.subVectors(this.c,this.b),ds.subVectors(this.a,this.b),wi.cross(ds).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return ia.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return ia.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,i,s,n){return ia.getInterpolation(t,this.a,this.b,this.c,e,i,s,n)}containsPoint(t){return ia.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return ia.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,s=this.b,n=this.c;let a,o;Ir.subVectors(s,i),Cr.subVectors(n,i),hd.subVectors(t,i);const h=Ir.dot(hd),l=Cr.dot(hd);if(h<=0&&l<=0)return e.copy(i);ld.subVectors(t,s);const u=Ir.dot(ld),c=Cr.dot(ld);if(u>=0&&c<=u)return e.copy(s);const d=h*c-u*l;if(d<=0&&h>=0&&u<=0)return a=h/(h-u),e.copy(i).addScaledVector(Ir,a);ud.subVectors(t,n);const p=Ir.dot(ud),m=Cr.dot(ud);if(m>=0&&p<=m)return e.copy(n);const f=p*l-h*m;if(f<=0&&l>=0&&m<=0)return o=l/(l-m),e.copy(i).addScaledVector(Cr,o);const g=u*m-p*c;if(g<=0&&c-u>=0&&p-m>=0)return _1.subVectors(n,s),o=(c-u)/(c-u+(p-m)),e.copy(s).addScaledVector(_1,o);const y=1/(g+f+d);return a=f*y,o=d*y,e.copy(i).addScaledVector(Ir,a).addScaledVector(Cr,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}};const v1={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Xs={h:0,s:0,l:0},Fh={h:0,s:0,l:0};function md(r,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+(t-r)*6*e:e<1/2?t:e<2/3?r+(t-r)*6*(2/3-e):r}let Qt=class{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,i)}set(t,e,i){if(e===void 0&&i===void 0){const s=t;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(t,e,i);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=bi){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Mi.colorSpaceToWorking(this,e),this}setRGB(t,e,i,s=Mi.workingColorSpace){return this.r=t,this.g=e,this.b=i,Mi.colorSpaceToWorking(this,s),this}setHSL(t,e,i,s=Mi.workingColorSpace){if(t=Yc(t,1),e=ct(e,0,1),i=ct(i,0,1),e===0)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,a=2*i-n;this.r=md(a,n,t+1/3),this.g=md(a,n,t),this.b=md(a,n,t-1/3)}return Mi.colorSpaceToWorking(this,s),this}setStyle(t,e=bi){function i(n){n!==void 0&&parseFloat(n)<1&&Ot("Color: Alpha component of "+t+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(t)){let n;const a=s[1],o=s[2];switch(a){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(n[4]),this.setRGB(Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255,e);if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(n[4]),this.setRGB(Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100,e);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(n[4]),this.setHSL(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,e);break;default:Ot("Color: Unknown color model "+t)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(t)){const n=s[1],a=n.length;if(a===3)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,e);if(a===6)return this.setHex(parseInt(n,16),e);Ot("Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=bi){const i=v1[t.toLowerCase()];return i!==void 0?this.setHex(i,e):Ot("Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=hs(t.r),this.g=hs(t.g),this.b=hs(t.b),this}copyLinearToSRGB(t){return this.r=br(t.r),this.g=br(t.g),this.b=br(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=bi){return Mi.workingToColorSpace(ye.copy(this),t),Math.round(ct(ye.r*255,0,255))*65536+Math.round(ct(ye.g*255,0,255))*256+Math.round(ct(ye.b*255,0,255))}getHexString(t=bi){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Mi.workingColorSpace){Mi.workingToColorSpace(ye.copy(this),e);const i=ye.r,s=ye.g,n=ye.b,a=Math.max(i,s,n),o=Math.min(i,s,n);let h,l;const u=(o+a)/2;if(o===a)h=0,l=0;else{const c=a-o;switch(l=u<=.5?c/(a+o):c/(2-a-o),a){case i:h=(s-n)/c+(s<n?6:0);break;case s:h=(n-i)/c+2;break;case n:h=(i-s)/c+4;break}h/=6}return t.h=h,t.s=l,t.l=u,t}getRGB(t,e=Mi.workingColorSpace){return Mi.workingToColorSpace(ye.copy(this),e),t.r=ye.r,t.g=ye.g,t.b=ye.b,t}getStyle(t=bi){Mi.workingToColorSpace(ye.copy(this),t);const e=ye.r,i=ye.g,s=ye.b;return t!==bi?`color(${t} ${e.toFixed(3)} ${i.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(i*255)},${Math.round(s*255)})`}offsetHSL(t,e,i){return this.getHSL(Xs),this.setHSL(Xs.h+t,Xs.s+e,Xs.l+i)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(Xs),t.getHSL(Fh);const i=ja(Xs.h,Fh.h,e),s=ja(Xs.s,Fh.s,e),n=ja(Xs.l,Fh.l,e);return this.setHSL(i,s,n),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,i=this.g,s=this.b,n=t.elements;return this.r=n[0]*e+n[3]*i+n[6]*s,this.g=n[1]*e+n[4]*i+n[7]*s,this.b=n[2]*e+n[5]*i+n[8]*s,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const ye=new Qt;Qt.NAMES=v1;let r_=0,kh=class extends Eh{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:r_++}),this.uuid=Nn(),this.name="",this.type="Material",this.blending=Wf,this.side=Xc,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=qf,this.blendDst=$f,this.blendEquation=Hf,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Qt(0,0,0),this.blendAlpha=0,this.depthFunc=Xf,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=s1,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=yr,this.stencilZFail=yr,this.stencilZPass=yr,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const i=t[e];if(i===void 0){Ot(`Material: parameter '${e}' has value of undefined.`);continue}const s=this[e];if(s===void 0){Ot(`Material: '${e}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[e]=i}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const i={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(i.sheenColorMap=this.sheenColorMap.toJSON(t).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(i.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(t).uuid),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Wf&&(i.blending=this.blending),this.side!==Xc&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==qf&&(i.blendSrc=this.blendSrc),this.blendDst!==$f&&(i.blendDst=this.blendDst),this.blendEquation!==Hf&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==Xf&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==s1&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==yr&&(i.stencilFail=this.stencilFail),this.stencilZFail!==yr&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==yr&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function s(n){const a=[];for(const o in n){const h=n[o];delete h.metadata,a.push(h)}return a}if(e){const n=s(t.textures),a=s(t.images);n.length>0&&(i.textures=n),a.length>0&&(i.images=a)}return i}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(e!==null){const s=e.length;i=new Array(s);for(let n=0;n!==s;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}},fd=class extends kh{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Qt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Nr,this.combine=vM,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}};const jt=new E,Dh=new ve;let a_=0,Kt=class{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:a_++}),this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=i,this.usage=n1,this.updateRanges=[],this.gpuType=Qf,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let s=0,n=this.itemSize;s<n;s++)this.array[t+s]=e.array[i+s];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)Dh.fromBufferAttribute(this,e),Dh.applyMatrix3(t),this.setXY(e,Dh.x,Dh.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)jt.fromBufferAttribute(this,e),jt.applyMatrix3(t),this.setXYZ(e,jt.x,jt.y,jt.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)jt.fromBufferAttribute(this,e),jt.applyMatrix4(t),this.setXYZ(e,jt.x,jt.y,jt.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)jt.fromBufferAttribute(this,e),jt.applyNormalMatrix(t),this.setXYZ(e,jt.x,jt.y,jt.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)jt.fromBufferAttribute(this,e),jt.transformDirection(t),this.setXYZ(e,jt.x,jt.y,jt.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let i=this.array[t*this.itemSize+e];return this.normalized&&(i=xr(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=_e(i,this.array)),this.array[t*this.itemSize+e]=i,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=xr(e,this.array)),e}setX(t,e){return this.normalized&&(e=_e(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=xr(e,this.array)),e}setY(t,e){return this.normalized&&(e=_e(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=xr(e,this.array)),e}setZ(t,e){return this.normalized&&(e=_e(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=xr(e,this.array)),e}setW(t,e){return this.normalized&&(e=_e(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=_e(e,this.array),i=_e(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,s){return t*=this.itemSize,this.normalized&&(e=_e(e,this.array),i=_e(i,this.array),s=_e(s,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this}setXYZW(t,e,i,s,n){return t*=this.itemSize,this.normalized&&(e=_e(e,this.array),i=_e(i,this.array),s=_e(s,this.array),n=_e(n,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==n1&&(t.usage=this.usage),t}},o_=class extends Kt{constructor(t,e,i){super(new Uint16Array(t),e,i)}},h_=class extends Kt{constructor(t,e,i){super(new Uint32Array(t),e,i)}},Ka=class extends Kt{constructor(t,e,i){super(new Float32Array(t),e,i)}},l_=0;const si=new Ct,gd=new ii,zr=new E,ke=new vr,to=new vr,ae=new E;let Ui=class gy extends Eh{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:l_++}),this.uuid=Nn(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(EM(t)?h_:o_)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const n=new Xt().getNormalMatrix(t);i.applyNormalMatrix(n),i.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(t),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return si.makeRotationFromQuaternion(t),this.applyMatrix4(si),this}rotateX(t){return si.makeRotationX(t),this.applyMatrix4(si),this}rotateY(t){return si.makeRotationY(t),this.applyMatrix4(si),this}rotateZ(t){return si.makeRotationZ(t),this.applyMatrix4(si),this}translate(t,e,i){return si.makeTranslation(t,e,i),this.applyMatrix4(si),this}scale(t,e,i){return si.makeScale(t,e,i),this.applyMatrix4(si),this}lookAt(t){return gd.lookAt(t),gd.updateMatrix(),this.applyMatrix4(gd.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(zr).negate(),this.translate(zr.x,zr.y,zr.z),this}setFromPoints(t){const e=this.getAttribute("position");if(e===void 0){const i=[];for(let s=0,n=t.length;s<n;s++){const a=t[s];i.push(a.x,a.y,a.z||0)}this.setAttribute("position",new Ka(i,3))}else{const i=Math.min(t.length,e.count);for(let s=0;s<i;s++){const n=t[s];e.setXYZ(s,n.x,n.y,n.z||0)}t.length>e.count&&Ot("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new vr);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){An("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new E(-1/0,-1/0,-1/0),new E(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,s=e.length;i<s;i++){const n=e[i];ke.setFromBufferAttribute(n),this.morphTargetsRelative?(ae.addVectors(this.boundingBox.min,ke.min),this.boundingBox.expandByPoint(ae),ae.addVectors(this.boundingBox.max,ke.max),this.boundingBox.expandByPoint(ae)):(this.boundingBox.expandByPoint(ke.min),this.boundingBox.expandByPoint(ke.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&An('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Za);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){An("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new E,1/0);return}if(t){const i=this.boundingSphere.center;if(ke.setFromBufferAttribute(t),e)for(let n=0,a=e.length;n<a;n++){const o=e[n];to.setFromBufferAttribute(o),this.morphTargetsRelative?(ae.addVectors(ke.min,to.min),ke.expandByPoint(ae),ae.addVectors(ke.max,to.max),ke.expandByPoint(ae)):(ke.expandByPoint(to.min),ke.expandByPoint(to.max))}ke.getCenter(i);let s=0;for(let n=0,a=t.count;n<a;n++)ae.fromBufferAttribute(t,n),s=Math.max(s,i.distanceToSquared(ae));if(e)for(let n=0,a=e.length;n<a;n++){const o=e[n],h=this.morphTargetsRelative;for(let l=0,u=o.count;l<u;l++)ae.fromBufferAttribute(o,l),h&&(zr.fromBufferAttribute(t,l),ae.add(zr)),s=Math.max(s,i.distanceToSquared(ae))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&An('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){An("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.position,s=e.normal,n=e.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Kt(new Float32Array(4*i.count),4));const a=this.getAttribute("tangent"),o=[],h=[];for(let C=0;C<i.count;C++)o[C]=new E,h[C]=new E;const l=new E,u=new E,c=new E,d=new ve,p=new ve,m=new ve,f=new E,g=new E;function y(C,P,F){l.fromBufferAttribute(i,C),u.fromBufferAttribute(i,P),c.fromBufferAttribute(i,F),d.fromBufferAttribute(n,C),p.fromBufferAttribute(n,P),m.fromBufferAttribute(n,F),u.sub(l),c.sub(l),p.sub(d),m.sub(d);const D=1/(p.x*m.y-m.x*p.y);isFinite(D)&&(f.copy(u).multiplyScalar(m.y).addScaledVector(c,-p.y).multiplyScalar(D),g.copy(c).multiplyScalar(p.x).addScaledVector(u,-m.x).multiplyScalar(D),o[C].add(f),o[P].add(f),o[F].add(f),h[C].add(g),h[P].add(g),h[F].add(g))}let x=this.groups;x.length===0&&(x=[{start:0,count:t.count}]);for(let C=0,P=x.length;C<P;++C){const F=x[C],D=F.start,q=F.count;for(let X=D,it=D+q;X<it;X+=3)y(t.getX(X+0),t.getX(X+1),t.getX(X+2))}const _=new E,M=new E,v=new E,N=new E;function T(C){v.fromBufferAttribute(s,C),N.copy(v);const P=o[C];_.copy(P),_.sub(v.multiplyScalar(v.dot(P))).normalize(),M.crossVectors(N,P);const D=M.dot(h[C])<0?-1:1;a.setXYZW(C,_.x,_.y,_.z,D)}for(let C=0,P=x.length;C<P;++C){const F=x[C],D=F.start,q=F.count;for(let X=D,it=D+q;X<it;X+=3)T(t.getX(X+0)),T(t.getX(X+1)),T(t.getX(X+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Kt(new Float32Array(e.count*3),3),this.setAttribute("normal",i);else for(let d=0,p=i.count;d<p;d++)i.setXYZ(d,0,0,0);const s=new E,n=new E,a=new E,o=new E,h=new E,l=new E,u=new E,c=new E;if(t)for(let d=0,p=t.count;d<p;d+=3){const m=t.getX(d+0),f=t.getX(d+1),g=t.getX(d+2);s.fromBufferAttribute(e,m),n.fromBufferAttribute(e,f),a.fromBufferAttribute(e,g),u.subVectors(a,n),c.subVectors(s,n),u.cross(c),o.fromBufferAttribute(i,m),h.fromBufferAttribute(i,f),l.fromBufferAttribute(i,g),o.add(u),h.add(u),l.add(u),i.setXYZ(m,o.x,o.y,o.z),i.setXYZ(f,h.x,h.y,h.z),i.setXYZ(g,l.x,l.y,l.z)}else for(let d=0,p=e.count;d<p;d+=3)s.fromBufferAttribute(e,d+0),n.fromBufferAttribute(e,d+1),a.fromBufferAttribute(e,d+2),u.subVectors(a,n),c.subVectors(s,n),u.cross(c),i.setXYZ(d+0,u.x,u.y,u.z),i.setXYZ(d+1,u.x,u.y,u.z),i.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)ae.fromBufferAttribute(t,e),ae.normalize(),t.setXYZ(e,ae.x,ae.y,ae.z)}toNonIndexed(){function t(o,h){const l=o.array,u=o.itemSize,c=o.normalized,d=new l.constructor(h.length*u);let p=0,m=0;for(let f=0,g=h.length;f<g;f++){o.isInterleavedBufferAttribute?p=h[f]*o.data.stride+o.offset:p=h[f]*u;for(let y=0;y<u;y++)d[m++]=l[p++]}return new Kt(d,u,c)}if(this.index===null)return Ot("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new gy,i=this.index.array,s=this.attributes;for(const o in s){const h=s[o],l=t(h,i);e.setAttribute(o,l)}const n=this.morphAttributes;for(const o in n){const h=[],l=n[o];for(let u=0,c=l.length;u<c;u++){const d=l[u],p=t(d,i);h.push(p)}e.morphAttributes[o]=h}e.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,h=a.length;o<h;o++){const l=a[o];e.addGroup(l.start,l.count,l.materialIndex)}return e}toJSON(){const t={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const h=this.parameters;for(const l in h)h[l]!==void 0&&(t[l]=h[l]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const h in i){const l=i[h];t.data.attributes[h]=l.toJSON(t.data)}const s={};let n=!1;for(const h in this.morphAttributes){const l=this.morphAttributes[h],u=[];for(let c=0,d=l.length;c<d;c++){const p=l[c];u.push(p.toJSON(t.data))}u.length>0&&(s[h]=u,n=!0)}n&&(t.data.morphAttributes=s,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(t.data.boundingSphere=o.toJSON()),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;i!==null&&this.setIndex(i.clone());const s=t.attributes;for(const l in s){const u=s[l];this.setAttribute(l,u.clone(e))}const n=t.morphAttributes;for(const l in n){const u=[],c=n[l];for(let d=0,p=c.length;d<p;d++)u.push(c[d].clone(e));this.morphAttributes[l]=u}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let l=0,u=a.length;l<u;l++){const c=a[l];this.addGroup(c.start,c.count,c.materialIndex)}const o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());const h=t.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}};const w1=new Ct,In=new rd,Uh=new Za,T1=new E,Wh=new E,Hh=new E,qh=new E,yd=new E,$h=new E,S1=new E,Xh=new E;let xd=class extends ii{constructor(t=new Ui,e=new fd){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,a=s.length;n<a;n++){const o=s[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}getVertexPosition(t,e){const i=this.geometry,s=i.attributes.position,n=i.morphAttributes.position,a=i.morphTargetsRelative;e.fromBufferAttribute(s,t);const o=this.morphTargetInfluences;if(n&&o){$h.set(0,0,0);for(let h=0,l=n.length;h<l;h++){const u=o[h],c=n[h];u!==0&&(yd.fromBufferAttribute(c,t),a?$h.addScaledVector(yd,u):$h.addScaledVector(yd.sub(e),u))}e.add($h)}return e}raycast(t,e){const i=this.geometry,s=this.material,n=this.matrixWorld;s!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Uh.copy(i.boundingSphere),Uh.applyMatrix4(n),In.copy(t.ray).recast(t.near),!(Uh.containsPoint(In.origin)===!1&&(In.intersectSphere(Uh,T1)===null||In.origin.distanceToSquared(T1)>(t.far-t.near)**2))&&(w1.copy(n).invert(),In.copy(t.ray).applyMatrix4(w1),!(i.boundingBox!==null&&In.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(t,e,In)))}_computeIntersections(t,e,i){let s;const n=this.geometry,a=this.material,o=n.index,h=n.attributes.position,l=n.attributes.uv,u=n.attributes.uv1,c=n.attributes.normal,d=n.groups,p=n.drawRange;if(o!==null)if(Array.isArray(a))for(let m=0,f=d.length;m<f;m++){const g=d[m],y=a[g.materialIndex],x=Math.max(g.start,p.start),_=Math.min(o.count,Math.min(g.start+g.count,p.start+p.count));for(let M=x,v=_;M<v;M+=3){const N=o.getX(M),T=o.getX(M+1),C=o.getX(M+2);s=jh(this,y,t,i,l,u,c,N,T,C),s&&(s.faceIndex=Math.floor(M/3),s.face.materialIndex=g.materialIndex,e.push(s))}}else{const m=Math.max(0,p.start),f=Math.min(o.count,p.start+p.count);for(let g=m,y=f;g<y;g+=3){const x=o.getX(g),_=o.getX(g+1),M=o.getX(g+2);s=jh(this,a,t,i,l,u,c,x,_,M),s&&(s.faceIndex=Math.floor(g/3),e.push(s))}}else if(h!==void 0)if(Array.isArray(a))for(let m=0,f=d.length;m<f;m++){const g=d[m],y=a[g.materialIndex],x=Math.max(g.start,p.start),_=Math.min(h.count,Math.min(g.start+g.count,p.start+p.count));for(let M=x,v=_;M<v;M+=3){const N=M,T=M+1,C=M+2;s=jh(this,y,t,i,l,u,c,N,T,C),s&&(s.faceIndex=Math.floor(M/3),s.face.materialIndex=g.materialIndex,e.push(s))}}else{const m=Math.max(0,p.start),f=Math.min(h.count,p.start+p.count);for(let g=m,y=f;g<y;g+=3){const x=g,_=g+1,M=g+2;s=jh(this,a,t,i,l,u,c,x,_,M),s&&(s.faceIndex=Math.floor(g/3),e.push(s))}}}};function u_(r,t,e,i,s,n,a,o){let h;if(t.side===Df?h=i.intersectTriangle(a,n,s,!0,o):h=i.intersectTriangle(s,n,a,t.side===Xc,o),h===null)return null;Xh.copy(o),Xh.applyMatrix4(r.matrixWorld);const l=e.ray.origin.distanceTo(Xh);return l<e.near||l>e.far?null:{distance:l,point:Xh.clone(),object:r}}function jh(r,t,e,i,s,n,a,o,h,l){r.getVertexPosition(o,Wh),r.getVertexPosition(h,Hh),r.getVertexPosition(l,qh);const u=u_(r,t,e,i,Wh,Hh,qh,S1);if(u){const c=new E;Qa.getBarycoord(S1,Wh,Hh,qh,c),s&&(u.uv=Qa.getInterpolatedAttribute(s,o,h,l,c,new ve)),n&&(u.uv1=Qa.getInterpolatedAttribute(n,o,h,l,c,new ve)),a&&(u.normal=Qa.getInterpolatedAttribute(a,o,h,l,c,new E),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const d={a:o,b:h,c:l,normal:new E,materialIndex:0};Qa.getNormal(Wh,Hh,qh,d.normal),u.face=d,u.barycoord=c}return u}function bd(r){const t={};for(const e in r){t[e]={};for(const i in r[e]){const s=r[e][i];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(Ot("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[e][i]=null):t[e][i]=s.clone():Array.isArray(s)?t[e][i]=s.slice():t[e][i]=s}}return t}function c_(r){const t={};for(let e=0;e<r.length;e++){const i=bd(r[e]);for(const s in i)t[s]=i[s]}return t}function d_(r){const t=[];for(let e=0;e<r.length;e++)t.push(r[e].clone());return t}const p_={clone:bd,merge:c_};var m_=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,f_=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class g_ extends kh{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=m_,this.fragmentShader=f_,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=bd(t.uniforms),this.uniformsGroups=d_(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const s in this.uniforms){const a=this.uniforms[s].value;a&&a.isTexture?e.uniforms[s]={type:"t",value:a.toJSON(t).uuid}:a&&a.isColor?e.uniforms[s]={type:"c",value:a.getHex()}:a&&a.isVector2?e.uniforms[s]={type:"v2",value:a.toArray()}:a&&a.isVector3?e.uniforms[s]={type:"v3",value:a.toArray()}:a&&a.isVector4?e.uniforms[s]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?e.uniforms[s]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?e.uniforms[s]={type:"m4",value:a.toArray()}:e.uniforms[s]={value:a}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const i={};for(const s in this.extensions)this.extensions[s]===!0&&(i[s]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}let Lr=class extends ii{constructor(){super(),this.isGroup=!0,this.type="Group"}};const A1=new E,N1=new _r,R1=new _r,y_=new E,E1=new Ct,Gh=new E,Md=new Za,I1=new Ct,_d=new rd;let x_=class extends xd{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=jf,this.bindMatrix=new Ct,this.bindMatrixInverse=new Ct,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new vr),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let i=0;i<e.count;i++)this.getVertexPosition(i,Gh),this.boundingBox.expandByPoint(Gh)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Za),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let i=0;i<e.count;i++)this.getVertexPosition(i,Gh),this.boundingSphere.expandByPoint(Gh)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const i=this.material,s=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Md.copy(this.boundingSphere),Md.applyMatrix4(s),t.ray.intersectsSphere(Md)!==!1&&(I1.copy(s).invert(),_d.copy(t.ray).applyMatrix4(I1),!(this.boundingBox!==null&&_d.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(t,e,_d)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new _r,e=this.geometry.attributes.skinWeight;for(let i=0,s=e.count;i<s;i++){t.fromBufferAttribute(e,i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===jf?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===wM?this.bindMatrixInverse.copy(this.bindMatrix).invert():Ot("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const i=this.skeleton,s=this.geometry;N1.fromBufferAttribute(s.attributes.skinIndex,t),R1.fromBufferAttribute(s.attributes.skinWeight,t),A1.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let n=0;n<4;n++){const a=R1.getComponent(n);if(a!==0){const o=N1.getComponent(n);E1.multiplyMatrices(i.bones[o].matrixWorld,i.boneInverses[o]),e.addScaledVector(y_.copy(A1).applyMatrix4(E1),a)}}return e.applyMatrix4(this.bindMatrixInverse)}},b_=class extends ii{constructor(){super(),this.isBone=!0,this.type="Bone"}},M_=class extends Ih{constructor(t=null,e=1,i=1,s,n,a,o,h,l=Jf,u=Jf,c,d){super(null,a,o,h,l,u,s,n,c,d),this.isDataTexture=!0,this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};const C1=new Ct,__=new Ct;let v_=class yy{constructor(t=[],e=[]){this.uuid=Nn(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),e.length===0)this.calculateInverses();else if(t.length!==e.length){Ot("Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,s=this.bones.length;i<s;i++)this.boneInverses.push(new Ct)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const i=new Ct;this.bones[t]&&i.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const i=this.bones[t];i&&i.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const i=this.bones[t];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,s=this.boneTexture;for(let n=0,a=t.length;n<a;n++){const o=t[n]?t[n].matrixWorld:__;C1.multiplyMatrices(o,e[n]),C1.toArray(i,n*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new yy(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new M_(e,t,t,Kf,Qf);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){const s=this.bones[e];if(s.name===t)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,s=t.bones.length;i<s;i++){const n=t.bones[i];let a=e[n];a===void 0&&(Ot("Skeleton: No bone found with UUID:",n),a=new b_),this.bones.push(a),this.boneInverses.push(new Ct().fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let s=0,n=e.length;s<n;s++){const a=e[s];t.bones.push(a.uuid);const o=i[s];t.boneInverses.push(o.toArray())}return t}};class Pr extends kh{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new Qt(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const Yh=new E,Zh=new E,z1=new Ct,eo=new rd,Jh=new Za,vd=new E,L1=new E;class P1 extends ii{constructor(t=new Ui,e=new Pr){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,i=[0];for(let s=1,n=e.count;s<n;s++)Yh.fromBufferAttribute(e,s-1),Zh.fromBufferAttribute(e,s),i[s]=i[s-1],i[s]+=Yh.distanceTo(Zh);t.setAttribute("lineDistance",new Ka(i,1))}else Ot("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const i=this.geometry,s=this.matrixWorld,n=t.params.Line.threshold,a=i.drawRange;if(i.boundingSphere===null&&i.computeBoundingSphere(),Jh.copy(i.boundingSphere),Jh.applyMatrix4(s),Jh.radius+=n,t.ray.intersectsSphere(Jh)===!1)return;z1.copy(s).invert(),eo.copy(t.ray).applyMatrix4(z1);const o=n/((this.scale.x+this.scale.y+this.scale.z)/3),h=o*o,l=this.isLineSegments?2:1,u=i.index,d=i.attributes.position;if(u!==null){const p=Math.max(0,a.start),m=Math.min(u.count,a.start+a.count);for(let f=p,g=m-1;f<g;f+=l){const y=u.getX(f),x=u.getX(f+1),_=Qh(this,t,eo,h,y,x,f);_&&e.push(_)}if(this.isLineLoop){const f=u.getX(m-1),g=u.getX(p),y=Qh(this,t,eo,h,f,g,m-1);y&&e.push(y)}}else{const p=Math.max(0,a.start),m=Math.min(d.count,a.start+a.count);for(let f=p,g=m-1;f<g;f+=l){const y=Qh(this,t,eo,h,f,f+1,f);y&&e.push(y)}if(this.isLineLoop){const f=Qh(this,t,eo,h,m-1,p,m-1);f&&e.push(f)}}}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,a=s.length;n<a;n++){const o=s[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}}function Qh(r,t,e,i,s,n,a){const o=r.geometry.attributes.position;if(Yh.fromBufferAttribute(o,s),Zh.fromBufferAttribute(o,n),e.distanceSqToSegment(Yh,Zh,vd,L1)>i)return;vd.applyMatrix4(r.matrixWorld);const l=t.ray.origin.distanceTo(vd);if(!(l<t.near||l>t.far))return{distance:l,point:L1.clone().applyMatrix4(r.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:r}}const B1=new E,O1=new E;class Kh extends P1{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(t.index===null){const e=t.attributes.position,i=[];for(let s=0,n=e.count;s<n;s+=2)B1.fromBufferAttribute(e,s),O1.fromBufferAttribute(e,s+1),i[s]=s===0?0:i[s-1],i[s+1]=i[s]+B1.distanceTo(O1);t.setAttribute("lineDistance",new Ka(i,1))}else Ot("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}const wd={enabled:!1,files:{},add:function(r,t){this.enabled!==!1&&(this.files[r]=t)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};let w_=class{constructor(t,e,i){const s=this;let n=!1,a=0,o=0,h;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.abortController=new AbortController,this.itemStart=function(u){o++,n===!1&&s.onStart!==void 0&&s.onStart(u,a,o),n=!0},this.itemEnd=function(u){a++,s.onProgress!==void 0&&s.onProgress(u,a,o),a===o&&(n=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(u){s.onError!==void 0&&s.onError(u)},this.resolveURL=function(u){return h?h(u):u},this.setURLModifier=function(u){return h=u,this},this.addHandler=function(u,c){return l.push(u,c),this},this.removeHandler=function(u){const c=l.indexOf(u);return c!==-1&&l.splice(c,2),this},this.getHandler=function(u){for(let c=0,d=l.length;c<d;c+=2){const p=l[c],m=l[c+1];if(p.global&&(p.lastIndex=0),p.test(u))return m}return null},this.abort=function(){return this.abortController.abort(),this.abortController=new AbortController,this}}};const T_=new w_;let V1=class{constructor(t){this.manager=t!==void 0?t:T_,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise(function(s,n){i.load(t,s,e,n)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}abort(){return this}};V1.DEFAULT_MATERIAL_NAME="__DEFAULT";const Br=new WeakMap;class S_ extends V1{constructor(t){super(t)}load(t,e,i,s){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const n=this,a=wd.get(`image:${t}`);if(a!==void 0){if(a.complete===!0)n.manager.itemStart(t),setTimeout(function(){e&&e(a),n.manager.itemEnd(t)},0);else{let c=Br.get(a);c===void 0&&(c=[],Br.set(a,c)),c.push({onLoad:e,onError:s})}return a}const o=Gc("img");function h(){u(),e&&e(this);const c=Br.get(this)||[];for(let d=0;d<c.length;d++){const p=c[d];p.onLoad&&p.onLoad(this)}Br.delete(this),n.manager.itemEnd(t)}function l(c){u(),s&&s(c),wd.remove(`image:${t}`);const d=Br.get(this)||[];for(let p=0;p<d.length;p++){const m=d[p];m.onError&&m.onError(c)}Br.delete(this),n.manager.itemError(t),n.manager.itemEnd(t)}function u(){o.removeEventListener("load",h,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",h,!1),o.addEventListener("error",l,!1),t.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),wd.add(`image:${t}`,o),n.manager.itemStart(t),o.src=t,o}}class F1{constructor(t,e,i,s,n,a=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=t,this.type=e,this.itemSize=i,this.elementSize=s,this.count=n,this.normalized=a,this.version=0}set needsUpdate(t){t===!0&&this.version++}setBuffer(t){return this.buffer=t,this}setType(t,e){return this.type=t,this.elementSize=e,this}setItemSize(t){return this.itemSize=t,this}setCount(t){return this.count=t,this}}class A_ extends Kh{constructor(t=1){const e=[0,0,0,t,0,0,0,0,0,0,t,0,0,0,0,0,0,t],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],s=new Ui;s.setAttribute("position",new Ka(e,3)),s.setAttribute("color",new Ka(i,3));const n=new Pr({vertexColors:!0,toneMapped:!1});super(s,n),this.type="AxesHelper"}setColors(t,e,i){const s=new Qt,n=this.geometry.attributes.color.array;return s.set(t),s.toArray(n,0),s.toArray(n,3),s.set(e),s.toArray(n,6),s.toArray(n,9),s.set(i),s.toArray(n,12),s.toArray(n,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:gr}})),typeof window<"u"&&(window.__THREE__?Ot("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=gr);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const io={common:{diffuse:{value:new Qt(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Xt},alphaMap:{value:null},alphaMapTransform:{value:new Xt},alphaTest:{value:0}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Xt},normalScale:{value:new ve(1,1)}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Xt}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Qt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}}};/*!
 * @pixiv/three-vrm v3.4.2
 * VRM file loader for three.js.
 *
 * Copyright (c) 2019-2025 pixiv Inc.
 * @pixiv/three-vrm is distributed under MIT License
 * https://github.com/pixiv/three-vrm/blob/release/LICENSE
 */var tl=(r,t,e)=>new Promise((i,s)=>{var n=h=>{try{o(e.next(h))}catch(l){s(l)}},a=h=>{try{o(e.throw(h))}catch(l){s(l)}},o=h=>h.done?i(h.value):Promise.resolve(h.value).then(n,a);o((e=e.apply(r,t)).next())}),ft=(r,t,e)=>new Promise((i,s)=>{var n=h=>{try{o(e.next(h))}catch(l){s(l)}},a=h=>{try{o(e.throw(h))}catch(l){s(l)}},o=h=>h.done?i(h.value):Promise.resolve(h.value).then(n,a);o((e=e.apply(r,t)).next())}),k1=class extends ii{constructor(r){super(),this.weight=0,this.isBinary=!1,this.overrideBlink="none",this.overrideLookAt="none",this.overrideMouth="none",this._binds=[],this.name=`VRMExpression_${r}`,this.expressionName=r,this.type="VRMExpression",this.visible=!1}get binds(){return this._binds}get overrideBlinkAmount(){return this.overrideBlink==="block"?0<this.outputWeight?1:0:this.overrideBlink==="blend"?this.outputWeight:0}get overrideLookAtAmount(){return this.overrideLookAt==="block"?0<this.outputWeight?1:0:this.overrideLookAt==="blend"?this.outputWeight:0}get overrideMouthAmount(){return this.overrideMouth==="block"?0<this.outputWeight?1:0:this.overrideMouth==="blend"?this.outputWeight:0}get outputWeight(){return this.isBinary?this.weight>.5?1:0:this.weight}addBind(r){this._binds.push(r)}deleteBind(r){const t=this._binds.indexOf(r);t>=0&&this._binds.splice(t,1)}applyWeight(r){var t;let e=this.outputWeight;e*=(t=r?.multiplier)!=null?t:1,this.isBinary&&e<1&&(e=0),this._binds.forEach(i=>i.applyWeight(e))}clearAppliedWeight(){this._binds.forEach(r=>r.clearAppliedWeight())}};function D1(r,t,e){var i,s;const n=r.parser.json,a=(i=n.nodes)==null?void 0:i[t];if(a==null)return null;const o=a.mesh;if(o==null)return null;const h=(s=n.meshes)==null?void 0:s[o];if(h==null)return null;const l=h.primitives.length,u=[];return e.traverse(c=>{u.length<l&&c.isMesh&&u.push(c)}),u}function U1(r,t){return ft(this,null,function*(){const e=yield r.parser.getDependency("node",t);return D1(r,t,e)})}function W1(r){return ft(this,null,function*(){const t=yield r.parser.getDependencies("node"),e=new Map;return t.forEach((i,s)=>{const n=D1(r,s,i);n!=null&&e.set(s,n)}),e})}var Td={Aa:"aa",Ih:"ih",Ou:"ou",Ee:"ee",Oh:"oh",Blink:"blink",Happy:"happy",Angry:"angry",Sad:"sad",Relaxed:"relaxed",LookUp:"lookUp",Surprised:"surprised",LookDown:"lookDown",LookLeft:"lookLeft",LookRight:"lookRight",BlinkLeft:"blinkLeft",BlinkRight:"blinkRight",Neutral:"neutral"};function H1(r){return Math.max(Math.min(r,1),0)}var q1=class xy{constructor(){this.blinkExpressionNames=["blink","blinkLeft","blinkRight"],this.lookAtExpressionNames=["lookLeft","lookRight","lookUp","lookDown"],this.mouthExpressionNames=["aa","ee","ih","oh","ou"],this._expressions=[],this._expressionMap={}}get expressions(){return this._expressions.concat()}get expressionMap(){return Object.assign({},this._expressionMap)}get presetExpressionMap(){const t={},e=new Set(Object.values(Td));return Object.entries(this._expressionMap).forEach(([i,s])=>{e.has(i)&&(t[i]=s)}),t}get customExpressionMap(){const t={},e=new Set(Object.values(Td));return Object.entries(this._expressionMap).forEach(([i,s])=>{e.has(i)||(t[i]=s)}),t}copy(t){return this._expressions.concat().forEach(i=>{this.unregisterExpression(i)}),t._expressions.forEach(i=>{this.registerExpression(i)}),this.blinkExpressionNames=t.blinkExpressionNames.concat(),this.lookAtExpressionNames=t.lookAtExpressionNames.concat(),this.mouthExpressionNames=t.mouthExpressionNames.concat(),this}clone(){return new xy().copy(this)}getExpression(t){var e;return(e=this._expressionMap[t])!=null?e:null}registerExpression(t){this._expressions.push(t),this._expressionMap[t.expressionName]=t}unregisterExpression(t){const e=this._expressions.indexOf(t);this._expressions.splice(e,1),delete this._expressionMap[t.expressionName]}getValue(t){var e;const i=this.getExpression(t);return(e=i?.weight)!=null?e:null}setValue(t,e){const i=this.getExpression(t);i&&(i.weight=H1(e))}resetValues(){this._expressions.forEach(t=>{t.weight=0})}getExpressionTrackName(t){const e=this.getExpression(t);return e?`${e.name}.weight`:null}update(){const t=this._calculateWeightMultipliers();this._expressions.forEach(e=>{e.clearAppliedWeight()}),this._expressions.forEach(e=>{let i=1;const s=e.expressionName;this.blinkExpressionNames.indexOf(s)!==-1&&(i*=t.blink),this.lookAtExpressionNames.indexOf(s)!==-1&&(i*=t.lookAt),this.mouthExpressionNames.indexOf(s)!==-1&&(i*=t.mouth),e.applyWeight({multiplier:i})})}_calculateWeightMultipliers(){let t=1,e=1,i=1;return this._expressions.forEach(s=>{t-=s.overrideBlinkAmount,e-=s.overrideLookAtAmount,i-=s.overrideMouthAmount}),t=Math.max(0,t),e=Math.max(0,e),i=Math.max(0,i),{blink:t,lookAt:e,mouth:i}}},so={Color:"color",EmissionColor:"emissionColor",ShadeColor:"shadeColor",RimColor:"rimColor",OutlineColor:"outlineColor"},N_={_Color:so.Color,_EmissionColor:so.EmissionColor,_ShadeColor:so.ShadeColor,_RimColor:so.RimColor,_OutlineColor:so.OutlineColor},R_=new Qt,$1=class by{constructor({material:t,type:e,targetValue:i,targetAlpha:s}){this.material=t,this.type=e,this.targetValue=i,this.targetAlpha=s??1;const n=this._initColorBindState(),a=this._initAlphaBindState();this._state={color:n,alpha:a}}applyWeight(t){const{color:e,alpha:i}=this._state;if(e!=null){const{propertyName:s,deltaValue:n}=e,a=this.material[s];a?.add(R_.copy(n).multiplyScalar(t))}if(i!=null){const{propertyName:s,deltaValue:n}=i;this.material[s]!=null&&(this.material[s]+=n*t)}}clearAppliedWeight(){const{color:t,alpha:e}=this._state;if(t!=null){const{propertyName:i,initialValue:s}=t,n=this.material[i];n?.copy(s)}if(e!=null){const{propertyName:i,initialValue:s}=e;this.material[i]!=null&&(this.material[i]=s)}}_initColorBindState(){var t,e,i;const{material:s,type:n,targetValue:a}=this,o=this._getPropertyNameMap(),h=(e=(t=o?.[n])==null?void 0:t[0])!=null?e:null;if(h==null)return null;const u=s[h].clone(),c=new Qt(a.r-u.r,a.g-u.g,a.b-u.b);return{propertyName:h,initialValue:u,deltaValue:c}}_initAlphaBindState(){var t,e,i;const{material:s,type:n,targetAlpha:a}=this,o=this._getPropertyNameMap(),h=(e=(t=o?.[n])==null?void 0:t[1])!=null?e:null;if(h==null&&a!==1||h==null)return null;const l=s[h],u=a-l;return{propertyName:h,initialValue:l,deltaValue:u}}_getPropertyNameMap(){var t,e;return(e=(t=Object.entries(by._propertyNameMapMap).find(([i])=>this.material[i]===!0))==null?void 0:t[1])!=null?e:null}};$1._propertyNameMapMap={isMeshStandardMaterial:{color:["color","opacity"],emissionColor:["emissive",null]},isMeshBasicMaterial:{color:["color","opacity"]},isMToonMaterial:{color:["color","opacity"],emissionColor:["emissive",null],outlineColor:["outlineColorFactor",null],matcapColor:["matcapFactor",null],rimColor:["parametricRimColorFactor",null],shadeColor:["shadeColorFactor",null]}};var X1=$1,j1=class{constructor({primitives:r,index:t,weight:e}){this.primitives=r,this.index=t,this.weight=e}applyWeight(r){this.primitives.forEach(t=>{var e;((e=t.morphTargetInfluences)==null?void 0:e[this.index])!=null&&(t.morphTargetInfluences[this.index]+=this.weight*r)})}clearAppliedWeight(){this.primitives.forEach(r=>{var t;((t=r.morphTargetInfluences)==null?void 0:t[this.index])!=null&&(r.morphTargetInfluences[this.index]=0)})}},G1=new ve,Y1=class My{constructor({material:t,scale:e,offset:i}){var s,n;this.material=t,this.scale=e,this.offset=i;const a=(s=Object.entries(My._propertyNamesMap).find(([o])=>t[o]===!0))==null?void 0:s[1];a==null?this._properties=[]:(this._properties=[],a.forEach(o=>{var h;const l=(h=t[o])==null?void 0:h.clone();if(!l)return null;t[o]=l;const u=l.offset.clone(),c=l.repeat.clone(),d=i.clone().sub(u),p=e.clone().sub(c);this._properties.push({name:o,initialOffset:u,deltaOffset:d,initialScale:c,deltaScale:p})}))}applyWeight(t){this._properties.forEach(e=>{const i=this.material[e.name];i!==void 0&&(i.offset.add(G1.copy(e.deltaOffset).multiplyScalar(t)),i.repeat.add(G1.copy(e.deltaScale).multiplyScalar(t)))})}clearAppliedWeight(){this._properties.forEach(t=>{const e=this.material[t.name];e!==void 0&&(e.offset.copy(t.initialOffset),e.repeat.copy(t.initialScale))})}};Y1._propertyNamesMap={isMeshStandardMaterial:["map","emissiveMap","bumpMap","normalMap","displacementMap","roughnessMap","metalnessMap","alphaMap"],isMeshBasicMaterial:["map","specularMap","alphaMap"],isMToonMaterial:["map","normalMap","emissiveMap","shadeMultiplyTexture","rimMultiplyTexture","outlineWidthMultiplyTexture","uvAnimationMaskTexture"]};var Z1=Y1,E_=new Set(["1.0","1.0-beta"]),J1=class _y{get name(){return"VRMExpressionLoaderPlugin"}constructor(t){this.parser=t}afterRoot(t){return ft(this,null,function*(){t.userData.vrmExpressionManager=yield this._import(t)})}_import(t){return ft(this,null,function*(){const e=yield this._v1Import(t);if(e)return e;const i=yield this._v0Import(t);return i||null})}_v1Import(t){return ft(this,null,function*(){var e,i;const s=this.parser.json;if(!(((e=s.extensionsUsed)==null?void 0:e.indexOf("VRMC_vrm"))!==-1))return null;const a=(i=s.extensions)==null?void 0:i.VRMC_vrm;if(!a)return null;const o=a.specVersion;if(!E_.has(o))return null;const h=a.expressions;if(!h)return null;const l=new Set(Object.values(Td)),u=new Map;h.preset!=null&&Object.entries(h.preset).forEach(([d,p])=>{p!=null&&l.has(d)&&u.set(d,p)}),h.custom!=null&&Object.entries(h.custom).forEach(([d,p])=>{l.has(d)||u.set(d,p)});const c=new q1;return yield Promise.all(Array.from(u.entries()).map(d=>ft(this,[d],function*([p,m]){var f,g,y,x,_,M,v;const N=new k1(p);if(t.scene.add(N),N.isBinary=(f=m.isBinary)!=null?f:!1,N.overrideBlink=(g=m.overrideBlink)!=null?g:"none",N.overrideLookAt=(y=m.overrideLookAt)!=null?y:"none",N.overrideMouth=(x=m.overrideMouth)!=null?x:"none",(_=m.morphTargetBinds)==null||_.forEach(T=>ft(this,null,function*(){var C;if(T.node===void 0||T.index===void 0)return;const P=yield U1(t,T.node),F=T.index;P.every(D=>Array.isArray(D.morphTargetInfluences)&&F<D.morphTargetInfluences.length)&&N.addBind(new j1({primitives:P,index:F,weight:(C=T.weight)!=null?C:1}))})),m.materialColorBinds||m.textureTransformBinds){const T=[];t.scene.traverse(C=>{const P=C.material;P&&(Array.isArray(P)?T.push(...P):T.push(P))}),(M=m.materialColorBinds)==null||M.forEach(C=>ft(this,null,function*(){T.filter(F=>{var D;const q=(D=this.parser.associations.get(F))==null?void 0:D.materials;return C.material===q}).forEach(F=>{N.addBind(new X1({material:F,type:C.type,targetValue:new Qt().fromArray(C.targetValue),targetAlpha:C.targetValue[3]}))})})),(v=m.textureTransformBinds)==null||v.forEach(C=>ft(this,null,function*(){T.filter(F=>{var D;const q=(D=this.parser.associations.get(F))==null?void 0:D.materials;return C.material===q}).forEach(F=>{var D,q;N.addBind(new Z1({material:F,offset:new ve().fromArray((D=C.offset)!=null?D:[0,0]),scale:new ve().fromArray((q=C.scale)!=null?q:[1,1])}))})}))}c.registerExpression(N)}))),c})}_v0Import(t){return ft(this,null,function*(){var e;const i=this.parser.json,s=(e=i.extensions)==null?void 0:e.VRM;if(!s)return null;const n=s.blendShapeMaster;if(!n)return null;const a=new q1,o=n.blendShapeGroups;if(!o)return a;const h=new Set;return yield Promise.all(o.map(l=>ft(this,null,function*(){var u;const c=l.presetName,d=c!=null&&_y.v0v1PresetNameMap[c]||null,p=d??l.name;if(p==null||h.has(p))return;h.add(p);const m=new k1(p);t.scene.add(m),m.isBinary=(u=l.isBinary)!=null?u:!1,l.binds&&l.binds.forEach(g=>ft(this,null,function*(){var y;if(g.mesh===void 0||g.index===void 0)return;const x=[];(y=i.nodes)==null||y.forEach((M,v)=>{M.mesh===g.mesh&&x.push(v)});const _=g.index;yield Promise.all(x.map(M=>ft(this,null,function*(){var v;const N=yield U1(t,M);N.every(T=>Array.isArray(T.morphTargetInfluences)&&_<T.morphTargetInfluences.length)&&m.addBind(new j1({primitives:N,index:_,weight:.01*((v=g.weight)!=null?v:100)}))})))}));const f=l.materialValues;f&&f.length!==0&&f.forEach(g=>{if(g.materialName===void 0||g.propertyName===void 0||g.targetValue===void 0)return;const y=[];t.scene.traverse(_=>{if(_.material){const M=_.material;Array.isArray(M)?y.push(...M.filter(v=>(v.name===g.materialName||v.name===g.materialName+" (Outline)")&&y.indexOf(v)===-1)):M.name===g.materialName&&y.indexOf(M)===-1&&y.push(M)}});const x=g.propertyName;y.forEach(_=>{if(x==="_MainTex_ST"){const v=new ve(g.targetValue[0],g.targetValue[1]),N=new ve(g.targetValue[2],g.targetValue[3]);N.y=1-N.y-v.y,m.addBind(new Z1({material:_,scale:v,offset:N}));return}const M=N_[x];if(M){m.addBind(new X1({material:_,type:M,targetValue:new Qt().fromArray(g.targetValue),targetAlpha:g.targetValue[3]}));return}})}),a.registerExpression(m)}))),a})}};J1.v0v1PresetNameMap={a:"aa",e:"ee",i:"ih",o:"oh",u:"ou",blink:"blink",joy:"happy",angry:"angry",sorrow:"sad",fun:"relaxed",lookup:"lookUp",lookdown:"lookDown",lookleft:"lookLeft",lookright:"lookRight",blink_l:"blinkLeft",blink_r:"blinkRight",neutral:"neutral"};var I_=J1,Sd=class sa{constructor(t,e){this._firstPersonOnlyLayer=sa.DEFAULT_FIRSTPERSON_ONLY_LAYER,this._thirdPersonOnlyLayer=sa.DEFAULT_THIRDPERSON_ONLY_LAYER,this._initializedLayers=!1,this.humanoid=t,this.meshAnnotations=e}copy(t){if(this.humanoid!==t.humanoid)throw new Error("VRMFirstPerson: humanoid must be same in order to copy");return this.meshAnnotations=t.meshAnnotations.map(e=>({meshes:e.meshes.concat(),type:e.type})),this}clone(){return new sa(this.humanoid,this.meshAnnotations).copy(this)}get firstPersonOnlyLayer(){return this._firstPersonOnlyLayer}get thirdPersonOnlyLayer(){return this._thirdPersonOnlyLayer}setup({firstPersonOnlyLayer:t=sa.DEFAULT_FIRSTPERSON_ONLY_LAYER,thirdPersonOnlyLayer:e=sa.DEFAULT_THIRDPERSON_ONLY_LAYER}={}){this._initializedLayers||(this._firstPersonOnlyLayer=t,this._thirdPersonOnlyLayer=e,this.meshAnnotations.forEach(i=>{i.meshes.forEach(s=>{i.type==="firstPersonOnly"?(s.layers.set(this._firstPersonOnlyLayer),s.traverse(n=>n.layers.set(this._firstPersonOnlyLayer))):i.type==="thirdPersonOnly"?(s.layers.set(this._thirdPersonOnlyLayer),s.traverse(n=>n.layers.set(this._thirdPersonOnlyLayer))):i.type==="auto"&&this._createHeadlessModel(s)})}),this._initializedLayers=!0)}_excludeTriangles(t,e,i,s){let n=0;if(e!=null&&e.length>0)for(let a=0;a<t.length;a+=3){const o=t[a],h=t[a+1],l=t[a+2],u=e[o],c=i[o];if(u[0]>0&&s.includes(c[0])||u[1]>0&&s.includes(c[1])||u[2]>0&&s.includes(c[2])||u[3]>0&&s.includes(c[3]))continue;const d=e[h],p=i[h];if(d[0]>0&&s.includes(p[0])||d[1]>0&&s.includes(p[1])||d[2]>0&&s.includes(p[2])||d[3]>0&&s.includes(p[3]))continue;const m=e[l],f=i[l];m[0]>0&&s.includes(f[0])||m[1]>0&&s.includes(f[1])||m[2]>0&&s.includes(f[2])||m[3]>0&&s.includes(f[3])||(t[n++]=o,t[n++]=h,t[n++]=l)}return n}_createErasedMesh(t,e){const i=new x_(t.geometry.clone(),t.material);i.name=`${t.name}(erase)`,i.frustumCulled=t.frustumCulled,i.layers.set(this._firstPersonOnlyLayer);const s=i.geometry,n=s.getAttribute("skinIndex"),a=n instanceof F1?[]:n.array,o=[];for(let f=0;f<a.length;f+=4)o.push([a[f],a[f+1],a[f+2],a[f+3]]);const h=s.getAttribute("skinWeight"),l=h instanceof F1?[]:h.array,u=[];for(let f=0;f<l.length;f+=4)u.push([l[f],l[f+1],l[f+2],l[f+3]]);const c=s.getIndex();if(!c)throw new Error("The geometry doesn't have an index buffer");const d=Array.from(c.array),p=this._excludeTriangles(d,u,o,e),m=[];for(let f=0;f<p;f++)m[f]=d[f];return s.setIndex(m),t.onBeforeRender&&(i.onBeforeRender=t.onBeforeRender),i.bind(new v_(t.skeleton.bones,t.skeleton.boneInverses),new Ct),i}_createHeadlessModelForSkinnedMesh(t,e){const i=[];if(e.skeleton.bones.forEach((n,a)=>{this._isEraseTarget(n)&&i.push(a)}),!i.length){e.layers.enable(this._thirdPersonOnlyLayer),e.layers.enable(this._firstPersonOnlyLayer);return}e.layers.set(this._thirdPersonOnlyLayer);const s=this._createErasedMesh(e,i);t.add(s)}_createHeadlessModel(t){if(t.type==="Group")if(t.layers.set(this._thirdPersonOnlyLayer),this._isEraseTarget(t))t.traverse(e=>e.layers.set(this._thirdPersonOnlyLayer));else{const e=new Lr;e.name=`_headless_${t.name}`,e.layers.set(this._firstPersonOnlyLayer),t.parent.add(e),t.children.filter(i=>i.type==="SkinnedMesh").forEach(i=>{const s=i;this._createHeadlessModelForSkinnedMesh(e,s)})}else if(t.type==="SkinnedMesh"){const e=t;this._createHeadlessModelForSkinnedMesh(t.parent,e)}else this._isEraseTarget(t)&&(t.layers.set(this._thirdPersonOnlyLayer),t.traverse(e=>e.layers.set(this._thirdPersonOnlyLayer)))}_isEraseTarget(t){return t===this.humanoid.getRawBoneNode("head")?!0:t.parent?this._isEraseTarget(t.parent):!1}};Sd.DEFAULT_FIRSTPERSON_ONLY_LAYER=9,Sd.DEFAULT_THIRDPERSON_ONLY_LAYER=10;var Q1=Sd,C_=new Set(["1.0","1.0-beta"]),z_=class{get name(){return"VRMFirstPersonLoaderPlugin"}constructor(r){this.parser=r}afterRoot(r){return ft(this,null,function*(){const t=r.userData.vrmHumanoid;if(t!==null){if(t===void 0)throw new Error("VRMFirstPersonLoaderPlugin: vrmHumanoid is undefined. VRMHumanoidLoaderPlugin have to be used first");r.userData.vrmFirstPerson=yield this._import(r,t)}})}_import(r,t){return ft(this,null,function*(){if(t==null)return null;const e=yield this._v1Import(r,t);if(e)return e;const i=yield this._v0Import(r,t);return i||null})}_v1Import(r,t){return ft(this,null,function*(){var e,i;const s=this.parser.json;if(!(((e=s.extensionsUsed)==null?void 0:e.indexOf("VRMC_vrm"))!==-1))return null;const a=(i=s.extensions)==null?void 0:i.VRMC_vrm;if(!a)return null;const o=a.specVersion;if(!C_.has(o))return null;const h=a.firstPerson,l=[],u=yield W1(r);return Array.from(u.entries()).forEach(([c,d])=>{var p,m;const f=(p=h?.meshAnnotations)==null?void 0:p.find(g=>g.node===c);l.push({meshes:d,type:(m=f?.type)!=null?m:"auto"})}),new Q1(t,l)})}_v0Import(r,t){return ft(this,null,function*(){var e;const i=this.parser.json,s=(e=i.extensions)==null?void 0:e.VRM;if(!s)return null;const n=s.firstPerson;if(!n)return null;const a=[],o=yield W1(r);return Array.from(o.entries()).forEach(([h,l])=>{const u=i.nodes[h],c=n.meshAnnotations?n.meshAnnotations.find(d=>d.mesh===u.mesh):void 0;a.push({meshes:l,type:this._convertV0FlagToV1Type(c?.firstPersonFlag)})}),new Q1(t,a)})}_convertV0FlagToV1Type(r){return r==="FirstPersonOnly"?"firstPersonOnly":r==="ThirdPersonOnly"?"thirdPersonOnly":r==="Both"?"both":"auto"}},K1=new E,tg=new E,L_=new ot,eg=class extends Lr{constructor(r){super(),this.vrmHumanoid=r,this._boneAxesMap=new Map,Object.values(r.humanBones).forEach(t=>{const e=new A_(1);e.matrixAutoUpdate=!1,e.material.depthTest=!1,e.material.depthWrite=!1,this.add(e),this._boneAxesMap.set(t,e)})}dispose(){Array.from(this._boneAxesMap.values()).forEach(r=>{r.geometry.dispose(),r.material.dispose()})}updateMatrixWorld(r){Array.from(this._boneAxesMap.entries()).forEach(([t,e])=>{t.node.updateWorldMatrix(!0,!1),t.node.matrixWorld.decompose(K1,L_,tg);const i=K1.set(.1,.1,.1).divide(tg);e.matrix.copy(t.node.matrixWorld).scale(i)}),super.updateMatrixWorld(r)}},Ad=["hips","spine","chest","upperChest","neck","head","leftEye","rightEye","jaw","leftUpperLeg","leftLowerLeg","leftFoot","leftToes","rightUpperLeg","rightLowerLeg","rightFoot","rightToes","leftShoulder","leftUpperArm","leftLowerArm","leftHand","rightShoulder","rightUpperArm","rightLowerArm","rightHand","leftThumbMetacarpal","leftThumbProximal","leftThumbDistal","leftIndexProximal","leftIndexIntermediate","leftIndexDistal","leftMiddleProximal","leftMiddleIntermediate","leftMiddleDistal","leftRingProximal","leftRingIntermediate","leftRingDistal","leftLittleProximal","leftLittleIntermediate","leftLittleDistal","rightThumbMetacarpal","rightThumbProximal","rightThumbDistal","rightIndexProximal","rightIndexIntermediate","rightIndexDistal","rightMiddleProximal","rightMiddleIntermediate","rightMiddleDistal","rightRingProximal","rightRingIntermediate","rightRingDistal","rightLittleProximal","rightLittleIntermediate","rightLittleDistal"],P_={hips:null,spine:"hips",chest:"spine",upperChest:"chest",neck:"upperChest",head:"neck",leftEye:"head",rightEye:"head",jaw:"head",leftUpperLeg:"hips",leftLowerLeg:"leftUpperLeg",leftFoot:"leftLowerLeg",leftToes:"leftFoot",rightUpperLeg:"hips",rightLowerLeg:"rightUpperLeg",rightFoot:"rightLowerLeg",rightToes:"rightFoot",leftShoulder:"upperChest",leftUpperArm:"leftShoulder",leftLowerArm:"leftUpperArm",leftHand:"leftLowerArm",rightShoulder:"upperChest",rightUpperArm:"rightShoulder",rightLowerArm:"rightUpperArm",rightHand:"rightLowerArm",leftThumbMetacarpal:"leftHand",leftThumbProximal:"leftThumbMetacarpal",leftThumbDistal:"leftThumbProximal",leftIndexProximal:"leftHand",leftIndexIntermediate:"leftIndexProximal",leftIndexDistal:"leftIndexIntermediate",leftMiddleProximal:"leftHand",leftMiddleIntermediate:"leftMiddleProximal",leftMiddleDistal:"leftMiddleIntermediate",leftRingProximal:"leftHand",leftRingIntermediate:"leftRingProximal",leftRingDistal:"leftRingIntermediate",leftLittleProximal:"leftHand",leftLittleIntermediate:"leftLittleProximal",leftLittleDistal:"leftLittleIntermediate",rightThumbMetacarpal:"rightHand",rightThumbProximal:"rightThumbMetacarpal",rightThumbDistal:"rightThumbProximal",rightIndexProximal:"rightHand",rightIndexIntermediate:"rightIndexProximal",rightIndexDistal:"rightIndexIntermediate",rightMiddleProximal:"rightHand",rightMiddleIntermediate:"rightMiddleProximal",rightMiddleDistal:"rightMiddleIntermediate",rightRingProximal:"rightHand",rightRingIntermediate:"rightRingProximal",rightRingDistal:"rightRingIntermediate",rightLittleProximal:"rightHand",rightLittleIntermediate:"rightLittleProximal",rightLittleDistal:"rightLittleIntermediate"};function ig(r){return r.invert?r.invert():r.inverse(),r}var Cn=new E,zn=new ot,Nd=class{constructor(r){this.humanBones=r,this.restPose=this.getAbsolutePose()}getAbsolutePose(){const r={};return Object.keys(this.humanBones).forEach(t=>{const e=t,i=this.getBoneNode(e);i&&(Cn.copy(i.position),zn.copy(i.quaternion),r[e]={position:Cn.toArray(),rotation:zn.toArray()})}),r}getPose(){const r={};return Object.keys(this.humanBones).forEach(t=>{const e=t,i=this.getBoneNode(e);if(!i)return;Cn.set(0,0,0),zn.identity();const s=this.restPose[e];s?.position&&Cn.fromArray(s.position).negate(),s?.rotation&&ig(zn.fromArray(s.rotation)),Cn.add(i.position),zn.premultiply(i.quaternion),r[e]={position:Cn.toArray(),rotation:zn.toArray()}}),r}setPose(r){Object.entries(r).forEach(([t,e])=>{const i=t,s=this.getBoneNode(i);if(!s)return;const n=this.restPose[i];n&&(e?.position&&(s.position.fromArray(e.position),n.position&&s.position.add(Cn.fromArray(n.position))),e?.rotation&&(s.quaternion.fromArray(e.rotation),n.rotation&&s.quaternion.multiply(zn.fromArray(n.rotation))))})}resetPose(){Object.entries(this.restPose).forEach(([r,t])=>{const e=this.getBoneNode(r);e&&(t?.position&&e.position.fromArray(t.position),t?.rotation&&e.quaternion.fromArray(t.rotation))})}getBone(r){var t;return(t=this.humanBones[r])!=null?t:void 0}getBoneNode(r){var t,e;return(e=(t=this.humanBones[r])==null?void 0:t.node)!=null?e:null}},Rd=new E,B_=new ot,O_=new E,sg=class vy extends Nd{static _setupTransforms(t){const e=new ii;e.name="VRMHumanoidRig";const i={},s={},n={};Ad.forEach(o=>{var h;const l=t.getBoneNode(o);if(l){const u=new E,c=new ot;l.updateWorldMatrix(!0,!1),l.matrixWorld.decompose(u,c,Rd),i[o]=u,s[o]=l.quaternion.clone();const d=new ot;(h=l.parent)==null||h.matrixWorld.decompose(Rd,d,Rd),n[o]=d}});const a={};return Ad.forEach(o=>{var h;const l=t.getBoneNode(o);if(l){const u=i[o];let c=o,d;for(;d==null&&(c=P_[c],c!=null);)d=i[c];const p=new ii;p.name="Normalized_"+l.name,(c?(h=a[c])==null?void 0:h.node:e).add(p),p.position.copy(u),d&&p.position.sub(d),a[o]={node:p}}}),{rigBones:a,root:e,parentWorldRotations:n,boneRotations:s}}constructor(t){const{rigBones:e,root:i,parentWorldRotations:s,boneRotations:n}=vy._setupTransforms(t);super(e),this.original=t,this.root=i,this._parentWorldRotations=s,this._boneRotations=n}update(){Ad.forEach(t=>{const e=this.original.getBoneNode(t);if(e!=null){const i=this.getBoneNode(t),s=this._parentWorldRotations[t],n=B_.copy(s).invert(),a=this._boneRotations[t];if(e.quaternion.copy(i.quaternion).multiply(s).premultiply(n).multiply(a),t==="hips"){const o=i.getWorldPosition(O_);e.parent.updateWorldMatrix(!0,!1);const h=e.parent.matrixWorld,l=o.applyMatrix4(h.invert());e.position.copy(l)}}})}},ng=class wy{get restPose(){return this.rawRestPose}get rawRestPose(){return this._rawHumanBones.restPose}get normalizedRestPose(){return this._normalizedHumanBones.restPose}get humanBones(){return this._rawHumanBones.humanBones}get rawHumanBones(){return this._rawHumanBones.humanBones}get normalizedHumanBones(){return this._normalizedHumanBones.humanBones}get normalizedHumanBonesRoot(){return this._normalizedHumanBones.root}constructor(t,e){var i;this.autoUpdateHumanBones=(i=e?.autoUpdateHumanBones)!=null?i:!0,this._rawHumanBones=new Nd(t),this._normalizedHumanBones=new sg(this._rawHumanBones)}copy(t){return this.autoUpdateHumanBones=t.autoUpdateHumanBones,this._rawHumanBones=new Nd(t.humanBones),this._normalizedHumanBones=new sg(this._rawHumanBones),this}clone(){return new wy(this.humanBones,{autoUpdateHumanBones:this.autoUpdateHumanBones}).copy(this)}getAbsolutePose(){return this.getRawAbsolutePose()}getRawAbsolutePose(){return this._rawHumanBones.getAbsolutePose()}getNormalizedAbsolutePose(){return this._normalizedHumanBones.getAbsolutePose()}getPose(){return this.getRawPose()}getRawPose(){return this._rawHumanBones.getPose()}getNormalizedPose(){return this._normalizedHumanBones.getPose()}setPose(t){return this.setRawPose(t)}setRawPose(t){return this._rawHumanBones.setPose(t)}setNormalizedPose(t){return this._normalizedHumanBones.setPose(t)}resetPose(){return this.resetRawPose()}resetRawPose(){return this._rawHumanBones.resetPose()}resetNormalizedPose(){return this._normalizedHumanBones.resetPose()}getBone(t){return this.getRawBone(t)}getRawBone(t){return this._rawHumanBones.getBone(t)}getNormalizedBone(t){return this._normalizedHumanBones.getBone(t)}getBoneNode(t){return this.getRawBoneNode(t)}getRawBoneNode(t){return this._rawHumanBones.getBoneNode(t)}getNormalizedBoneNode(t){return this._normalizedHumanBones.getBoneNode(t)}update(){this.autoUpdateHumanBones&&this._normalizedHumanBones.update()}},V_={Hips:"hips",Spine:"spine",Head:"head",LeftUpperLeg:"leftUpperLeg",LeftLowerLeg:"leftLowerLeg",LeftFoot:"leftFoot",RightUpperLeg:"rightUpperLeg",RightLowerLeg:"rightLowerLeg",RightFoot:"rightFoot",LeftUpperArm:"leftUpperArm",LeftLowerArm:"leftLowerArm",LeftHand:"leftHand",RightUpperArm:"rightUpperArm",RightLowerArm:"rightLowerArm",RightHand:"rightHand"},F_=new Set(["1.0","1.0-beta"]),rg={leftThumbProximal:"leftThumbMetacarpal",leftThumbIntermediate:"leftThumbProximal",rightThumbProximal:"rightThumbMetacarpal",rightThumbIntermediate:"rightThumbProximal"},k_=class{get name(){return"VRMHumanoidLoaderPlugin"}constructor(r,t){this.parser=r,this.helperRoot=t?.helperRoot,this.autoUpdateHumanBones=t?.autoUpdateHumanBones}afterRoot(r){return ft(this,null,function*(){r.userData.vrmHumanoid=yield this._import(r)})}_import(r){return ft(this,null,function*(){const t=yield this._v1Import(r);if(t)return t;const e=yield this._v0Import(r);return e||null})}_v1Import(r){return ft(this,null,function*(){var t,e;const i=this.parser.json;if(!(((t=i.extensionsUsed)==null?void 0:t.indexOf("VRMC_vrm"))!==-1))return null;const n=(e=i.extensions)==null?void 0:e.VRMC_vrm;if(!n)return null;const a=n.specVersion;if(!F_.has(a))return null;const o=n.humanoid;if(!o)return null;const h=o.humanBones.leftThumbIntermediate!=null||o.humanBones.rightThumbIntermediate!=null,l={};o.humanBones!=null&&(yield Promise.all(Object.entries(o.humanBones).map(c=>ft(this,[c],function*([d,p]){let m=d;const f=p.node;if(h){const y=rg[m];y!=null&&(m=y)}const g=yield this.parser.getDependency("node",f);g!=null&&(l[m]={node:g})}))));const u=new ng(this._ensureRequiredBonesExist(l),{autoUpdateHumanBones:this.autoUpdateHumanBones});if(r.scene.add(u.normalizedHumanBonesRoot),this.helperRoot){const c=new eg(u);this.helperRoot.add(c),c.renderOrder=this.helperRoot.renderOrder}return u})}_v0Import(r){return ft(this,null,function*(){var t;const i=(t=this.parser.json.extensions)==null?void 0:t.VRM;if(!i)return null;const s=i.humanoid;if(!s)return null;const n={};s.humanBones!=null&&(yield Promise.all(s.humanBones.map(o=>ft(this,null,function*(){const h=o.bone,l=o.node;if(h==null||l==null)return;const u=yield this.parser.getDependency("node",l);if(u==null)return;const c=rg[h],d=c??h;n[d]==null&&(n[d]={node:u})}))));const a=new ng(this._ensureRequiredBonesExist(n),{autoUpdateHumanBones:this.autoUpdateHumanBones});if(r.scene.add(a.normalizedHumanBonesRoot),this.helperRoot){const o=new eg(a);this.helperRoot.add(o),o.renderOrder=this.helperRoot.renderOrder}return a})}_ensureRequiredBonesExist(r){const t=Object.values(V_).filter(e=>r[e]==null);if(t.length>0)throw new Error(`VRMHumanoidLoaderPlugin: These humanoid bones are required but not exist: ${t.join(", ")}`);return r}},ag=class extends Ui{constructor(){super(),this._currentTheta=0,this._currentRadius=0,this.theta=0,this.radius=0,this._currentTheta=0,this._currentRadius=0,this._attrPos=new Kt(new Float32Array(195),3),this.setAttribute("position",this._attrPos),this._attrIndex=new Kt(new Uint16Array(189),1),this.setIndex(this._attrIndex),this._buildIndex(),this.update()}update(){let r=!1;this._currentTheta!==this.theta&&(this._currentTheta=this.theta,r=!0),this._currentRadius!==this.radius&&(this._currentRadius=this.radius,r=!0),r&&this._buildPosition()}_buildPosition(){this._attrPos.setXYZ(0,0,0,0);for(let r=0;r<64;r++){const t=r/63*this._currentTheta;this._attrPos.setXYZ(r+1,this._currentRadius*Math.sin(t),0,this._currentRadius*Math.cos(t))}this._attrPos.needsUpdate=!0}_buildIndex(){for(let r=0;r<63;r++)this._attrIndex.setXYZ(r*3,0,r+1,r+2);this._attrIndex.needsUpdate=!0}},D_=class extends Ui{constructor(){super(),this.radius=0,this._currentRadius=0,this.tail=new E,this._currentTail=new E,this._attrPos=new Kt(new Float32Array(294),3),this.setAttribute("position",this._attrPos),this._attrIndex=new Kt(new Uint16Array(194),1),this.setIndex(this._attrIndex),this._buildIndex(),this.update()}update(){let r=!1;this._currentRadius!==this.radius&&(this._currentRadius=this.radius,r=!0),this._currentTail.equals(this.tail)||(this._currentTail.copy(this.tail),r=!0),r&&this._buildPosition()}_buildPosition(){for(let r=0;r<32;r++){const t=r/16*Math.PI;this._attrPos.setXYZ(r,Math.cos(t),Math.sin(t),0),this._attrPos.setXYZ(32+r,0,Math.cos(t),Math.sin(t)),this._attrPos.setXYZ(64+r,Math.sin(t),0,Math.cos(t))}this.scale(this._currentRadius,this._currentRadius,this._currentRadius),this.translate(this._currentTail.x,this._currentTail.y,this._currentTail.z),this._attrPos.setXYZ(96,0,0,0),this._attrPos.setXYZ(97,this._currentTail.x,this._currentTail.y,this._currentTail.z),this._attrPos.needsUpdate=!0}_buildIndex(){for(let r=0;r<32;r++){const t=(r+1)%32;this._attrIndex.setXY(r*2,r,t),this._attrIndex.setXY(64+r*2,32+r,32+t),this._attrIndex.setXY(128+r*2,64+r,64+t)}this._attrIndex.setXY(192,96,97),this._attrIndex.needsUpdate=!0}},el=new ot,og=new ot,no=new E,hg=new E,lg=Math.sqrt(2)/2,U_=new ot(0,0,-lg,lg),W_=new E(0,1,0),H_=class extends Lr{constructor(r){super(),this.matrixAutoUpdate=!1,this.vrmLookAt=r;{const t=new ag;t.radius=.5;const e=new fd({color:65280,transparent:!0,opacity:.5,side:Uf,depthTest:!1,depthWrite:!1});this._meshPitch=new xd(t,e),this.add(this._meshPitch)}{const t=new ag;t.radius=.5;const e=new fd({color:16711680,transparent:!0,opacity:.5,side:Uf,depthTest:!1,depthWrite:!1});this._meshYaw=new xd(t,e),this.add(this._meshYaw)}{const t=new D_;t.radius=.1;const e=new Pr({color:16777215,depthTest:!1,depthWrite:!1});this._lineTarget=new Kh(t,e),this._lineTarget.frustumCulled=!1,this.add(this._lineTarget)}}dispose(){this._meshYaw.geometry.dispose(),this._meshYaw.material.dispose(),this._meshPitch.geometry.dispose(),this._meshPitch.material.dispose(),this._lineTarget.geometry.dispose(),this._lineTarget.material.dispose()}updateMatrixWorld(r){const t=Jt.DEG2RAD*this.vrmLookAt.yaw;this._meshYaw.geometry.theta=t,this._meshYaw.geometry.update();const e=Jt.DEG2RAD*this.vrmLookAt.pitch;this._meshPitch.geometry.theta=e,this._meshPitch.geometry.update(),this.vrmLookAt.getLookAtWorldPosition(no),this.vrmLookAt.getLookAtWorldQuaternion(el),el.multiply(this.vrmLookAt.getFaceFrontQuaternion(og)),this._meshYaw.position.copy(no),this._meshYaw.quaternion.copy(el),this._meshPitch.position.copy(no),this._meshPitch.quaternion.copy(el),this._meshPitch.quaternion.multiply(og.setFromAxisAngle(W_,t)),this._meshPitch.quaternion.multiply(U_);const{target:i,autoUpdate:s}=this.vrmLookAt;i!=null&&s&&(i.getWorldPosition(hg).sub(no),this._lineTarget.geometry.tail.copy(hg),this._lineTarget.geometry.update(),this._lineTarget.position.copy(no)),super.updateMatrixWorld(r)}},q_=new E,$_=new E;function Ed(r,t){return r.matrixWorld.decompose(q_,t,$_),t}function il(r){return[Math.atan2(-r.z,r.x),Math.atan2(r.y,Math.sqrt(r.x*r.x+r.z*r.z))]}function ug(r){const t=Math.round(r/2/Math.PI);return r-2*Math.PI*t}var cg=new E(0,0,1),X_=new E,j_=new E,G_=new E,Y_=new ot,Id=new ot,dg=new ot,Z_=new ot,Cd=new Nr,pg=class Ty{constructor(t,e){this.offsetFromHeadBone=new E,this.autoUpdate=!0,this.faceFront=new E(0,0,1),this.humanoid=t,this.applier=e,this._yaw=0,this._pitch=0,this._needsUpdate=!0,this._restHeadWorldQuaternion=this.getLookAtWorldQuaternion(new ot)}get yaw(){return this._yaw}set yaw(t){this._yaw=t,this._needsUpdate=!0}get pitch(){return this._pitch}set pitch(t){this._pitch=t,this._needsUpdate=!0}get euler(){return this.getEuler(new Nr)}getEuler(t){return t.set(Jt.DEG2RAD*this._pitch,Jt.DEG2RAD*this._yaw,0,"YXZ")}copy(t){if(this.humanoid!==t.humanoid)throw new Error("VRMLookAt: humanoid must be same in order to copy");return this.offsetFromHeadBone.copy(t.offsetFromHeadBone),this.applier=t.applier,this.autoUpdate=t.autoUpdate,this.target=t.target,this.faceFront.copy(t.faceFront),this}clone(){return new Ty(this.humanoid,this.applier).copy(this)}reset(){this._yaw=0,this._pitch=0,this._needsUpdate=!0}getLookAtWorldPosition(t){const e=this.humanoid.getRawBoneNode("head");return t.copy(this.offsetFromHeadBone).applyMatrix4(e.matrixWorld)}getLookAtWorldQuaternion(t){const e=this.humanoid.getRawBoneNode("head");return Ed(e,t)}getFaceFrontQuaternion(t){if(this.faceFront.distanceToSquared(cg)<.01)return t.copy(this._restHeadWorldQuaternion).invert();const[e,i]=il(this.faceFront);return Cd.set(0,.5*Math.PI+e,i,"YZX"),t.setFromEuler(Cd).premultiply(Z_.copy(this._restHeadWorldQuaternion).invert())}getLookAtWorldDirection(t){return this.getLookAtWorldQuaternion(Id),this.getFaceFrontQuaternion(dg),t.copy(cg).applyQuaternion(Id).applyQuaternion(dg).applyEuler(this.getEuler(Cd))}lookAt(t){const e=Y_.copy(this._restHeadWorldQuaternion).multiply(ig(this.getLookAtWorldQuaternion(Id))),i=this.getLookAtWorldPosition(j_),s=G_.copy(t).sub(i).applyQuaternion(e).normalize(),[n,a]=il(this.faceFront),[o,h]=il(s),l=ug(o-n),u=ug(a-h);this._yaw=Jt.RAD2DEG*l,this._pitch=Jt.RAD2DEG*u,this._needsUpdate=!0}update(t){this.target!=null&&this.autoUpdate&&this.lookAt(this.target.getWorldPosition(X_)),this._needsUpdate&&(this._needsUpdate=!1,this.applier.applyYawPitch(this._yaw,this._pitch))}};pg.EULER_ORDER="YXZ";var J_=pg,Q_=new E(0,0,1),Wi=new ot,Or=new ot,ni=new Nr(0,0,0,"YXZ"),sl=class{constructor(r,t,e,i,s){this.humanoid=r,this.rangeMapHorizontalInner=t,this.rangeMapHorizontalOuter=e,this.rangeMapVerticalDown=i,this.rangeMapVerticalUp=s,this.faceFront=new E(0,0,1),this._restQuatLeftEye=new ot,this._restQuatRightEye=new ot,this._restLeftEyeParentWorldQuat=new ot,this._restRightEyeParentWorldQuat=new ot;const n=this.humanoid.getRawBoneNode("leftEye"),a=this.humanoid.getRawBoneNode("rightEye");n&&(this._restQuatLeftEye.copy(n.quaternion),Ed(n.parent,this._restLeftEyeParentWorldQuat)),a&&(this._restQuatRightEye.copy(a.quaternion),Ed(a.parent,this._restRightEyeParentWorldQuat))}applyYawPitch(r,t){const e=this.humanoid.getRawBoneNode("leftEye"),i=this.humanoid.getRawBoneNode("rightEye"),s=this.humanoid.getNormalizedBoneNode("leftEye"),n=this.humanoid.getNormalizedBoneNode("rightEye");e&&(t<0?ni.x=-Jt.DEG2RAD*this.rangeMapVerticalDown.map(-t):ni.x=Jt.DEG2RAD*this.rangeMapVerticalUp.map(t),r<0?ni.y=-Jt.DEG2RAD*this.rangeMapHorizontalInner.map(-r):ni.y=Jt.DEG2RAD*this.rangeMapHorizontalOuter.map(r),Wi.setFromEuler(ni),this._getWorldFaceFrontQuat(Or),s.quaternion.copy(Or).multiply(Wi).multiply(Or.invert()),Wi.copy(this._restLeftEyeParentWorldQuat),e.quaternion.copy(s.quaternion).multiply(Wi).premultiply(Wi.invert()).multiply(this._restQuatLeftEye)),i&&(t<0?ni.x=-Jt.DEG2RAD*this.rangeMapVerticalDown.map(-t):ni.x=Jt.DEG2RAD*this.rangeMapVerticalUp.map(t),r<0?ni.y=-Jt.DEG2RAD*this.rangeMapHorizontalOuter.map(-r):ni.y=Jt.DEG2RAD*this.rangeMapHorizontalInner.map(r),Wi.setFromEuler(ni),this._getWorldFaceFrontQuat(Or),n.quaternion.copy(Or).multiply(Wi).multiply(Or.invert()),Wi.copy(this._restRightEyeParentWorldQuat),i.quaternion.copy(n.quaternion).multiply(Wi).premultiply(Wi.invert()).multiply(this._restQuatRightEye))}lookAt(r){const t=Jt.RAD2DEG*r.y,e=Jt.RAD2DEG*r.x;this.applyYawPitch(t,e)}_getWorldFaceFrontQuat(r){if(this.faceFront.distanceToSquared(Q_)<.01)return r.identity();const[t,e]=il(this.faceFront);return ni.set(0,.5*Math.PI+t,e,"YZX"),r.setFromEuler(ni)}};sl.type="bone";var zd=class{constructor(r,t,e,i,s){this.expressions=r,this.rangeMapHorizontalInner=t,this.rangeMapHorizontalOuter=e,this.rangeMapVerticalDown=i,this.rangeMapVerticalUp=s}applyYawPitch(r,t){t<0?(this.expressions.setValue("lookDown",0),this.expressions.setValue("lookUp",this.rangeMapVerticalUp.map(-t))):(this.expressions.setValue("lookUp",0),this.expressions.setValue("lookDown",this.rangeMapVerticalDown.map(t))),r<0?(this.expressions.setValue("lookLeft",0),this.expressions.setValue("lookRight",this.rangeMapHorizontalOuter.map(-r))):(this.expressions.setValue("lookRight",0),this.expressions.setValue("lookLeft",this.rangeMapHorizontalOuter.map(r)))}lookAt(r){const t=Jt.RAD2DEG*r.y,e=Jt.RAD2DEG*r.x;this.applyYawPitch(t,e)}};zd.type="expression";var mg=class{constructor(r,t){this.inputMaxValue=r,this.outputScale=t}map(r){return this.outputScale*H1(r/this.inputMaxValue)}},K_=new Set(["1.0","1.0-beta"]),nl=.01,t8=class{get name(){return"VRMLookAtLoaderPlugin"}constructor(r,t){this.parser=r,this.helperRoot=t?.helperRoot}afterRoot(r){return ft(this,null,function*(){const t=r.userData.vrmHumanoid;if(t===null)return;if(t===void 0)throw new Error("VRMLookAtLoaderPlugin: vrmHumanoid is undefined. VRMHumanoidLoaderPlugin have to be used first");const e=r.userData.vrmExpressionManager;if(e!==null){if(e===void 0)throw new Error("VRMLookAtLoaderPlugin: vrmExpressionManager is undefined. VRMExpressionLoaderPlugin have to be used first");r.userData.vrmLookAt=yield this._import(r,t,e)}})}_import(r,t,e){return ft(this,null,function*(){if(t==null||e==null)return null;const i=yield this._v1Import(r,t,e);if(i)return i;const s=yield this._v0Import(r,t,e);return s||null})}_v1Import(r,t,e){return ft(this,null,function*(){var i,s,n;const a=this.parser.json;if(!(((i=a.extensionsUsed)==null?void 0:i.indexOf("VRMC_vrm"))!==-1))return null;const h=(s=a.extensions)==null?void 0:s.VRMC_vrm;if(!h)return null;const l=h.specVersion;if(!K_.has(l))return null;const u=h.lookAt;if(!u)return null;const c=u.type==="expression"?1:10,d=this._v1ImportRangeMap(u.rangeMapHorizontalInner,c),p=this._v1ImportRangeMap(u.rangeMapHorizontalOuter,c),m=this._v1ImportRangeMap(u.rangeMapVerticalDown,c),f=this._v1ImportRangeMap(u.rangeMapVerticalUp,c);let g;u.type==="expression"?g=new zd(e,d,p,m,f):g=new sl(t,d,p,m,f);const y=this._importLookAt(t,g);return y.offsetFromHeadBone.fromArray((n=u.offsetFromHeadBone)!=null?n:[0,.06,0]),y})}_v1ImportRangeMap(r,t){var e,i;let s=(e=r?.inputMaxValue)!=null?e:90;const n=(i=r?.outputScale)!=null?i:t;return s<nl&&(s=nl),new mg(s,n)}_v0Import(r,t,e){return ft(this,null,function*(){var i,s,n,a;const h=(i=this.parser.json.extensions)==null?void 0:i.VRM;if(!h)return null;const l=h.firstPerson;if(!l)return null;const u=l.lookAtTypeName==="BlendShape"?1:10,c=this._v0ImportDegreeMap(l.lookAtHorizontalInner,u),d=this._v0ImportDegreeMap(l.lookAtHorizontalOuter,u),p=this._v0ImportDegreeMap(l.lookAtVerticalDown,u),m=this._v0ImportDegreeMap(l.lookAtVerticalUp,u);let f;l.lookAtTypeName==="BlendShape"?f=new zd(e,c,d,p,m):f=new sl(t,c,d,p,m);const g=this._importLookAt(t,f);return l.firstPersonBoneOffset?g.offsetFromHeadBone.set((s=l.firstPersonBoneOffset.x)!=null?s:0,(n=l.firstPersonBoneOffset.y)!=null?n:.06,-((a=l.firstPersonBoneOffset.z)!=null?a:0)):g.offsetFromHeadBone.set(0,.06,0),g.faceFront.set(0,0,-1),f instanceof sl&&f.faceFront.set(0,0,-1),g})}_v0ImportDegreeMap(r,t){var e,i;const s=r?.curve;JSON.stringify(s);let n=(e=r?.xRange)!=null?e:90;const a=(i=r?.yRange)!=null?i:t;return n<nl&&(n=nl),new mg(n,a)}_importLookAt(r,t){const e=new J_(r,t);if(this.helperRoot){const i=new H_(e);this.helperRoot.add(i),i.renderOrder=this.helperRoot.renderOrder}return e}};function e8(r,t){return typeof r!="string"||r===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(r)&&(t=t.replace(/(^https?:\/\/[^/]+).*/i,"$1")),/^(https?:)?\/\//i.test(r)||/^data:.*,.*$/i.test(r)||/^blob:.*$/i.test(r)?r:t+r)}var i8=new Set(["1.0","1.0-beta"]),s8=class{get name(){return"VRMMetaLoaderPlugin"}constructor(r,t){var e,i,s;this.parser=r,this.needThumbnailImage=(e=t?.needThumbnailImage)!=null?e:!1,this.acceptLicenseUrls=(i=t?.acceptLicenseUrls)!=null?i:["https://vrm.dev/licenses/1.0/"],this.acceptV0Meta=(s=t?.acceptV0Meta)!=null?s:!0}afterRoot(r){return ft(this,null,function*(){r.userData.vrmMeta=yield this._import(r)})}_import(r){return ft(this,null,function*(){const t=yield this._v1Import(r);if(t!=null)return t;const e=yield this._v0Import(r);return e??null})}_v1Import(r){return ft(this,null,function*(){var t,e,i;const s=this.parser.json;if(!(((t=s.extensionsUsed)==null?void 0:t.indexOf("VRMC_vrm"))!==-1))return null;const a=(e=s.extensions)==null?void 0:e.VRMC_vrm;if(a==null)return null;const o=a.specVersion;if(!i8.has(o))return null;const h=a.meta;if(!h)return null;const l=h.licenseUrl;if(!new Set(this.acceptLicenseUrls).has(l))throw new Error(`VRMMetaLoaderPlugin: The license url "${l}" is not accepted`);let c;return this.needThumbnailImage&&h.thumbnailImage!=null&&(c=(i=yield this._extractGLTFImage(h.thumbnailImage))!=null?i:void 0),{metaVersion:"1",name:h.name,version:h.version,authors:h.authors,copyrightInformation:h.copyrightInformation,contactInformation:h.contactInformation,references:h.references,thirdPartyLicenses:h.thirdPartyLicenses,thumbnailImage:c,licenseUrl:h.licenseUrl,avatarPermission:h.avatarPermission,allowExcessivelyViolentUsage:h.allowExcessivelyViolentUsage,allowExcessivelySexualUsage:h.allowExcessivelySexualUsage,commercialUsage:h.commercialUsage,allowPoliticalOrReligiousUsage:h.allowPoliticalOrReligiousUsage,allowAntisocialOrHateUsage:h.allowAntisocialOrHateUsage,creditNotation:h.creditNotation,allowRedistribution:h.allowRedistribution,modification:h.modification,otherLicenseUrl:h.otherLicenseUrl}})}_v0Import(r){return ft(this,null,function*(){var t;const i=(t=this.parser.json.extensions)==null?void 0:t.VRM;if(!i)return null;const s=i.meta;if(!s)return null;if(!this.acceptV0Meta)throw new Error("VRMMetaLoaderPlugin: Attempted to load VRM0.0 meta but acceptV0Meta is false");let n;return this.needThumbnailImage&&s.texture!=null&&s.texture!==-1&&(n=yield this.parser.getDependency("texture",s.texture)),{metaVersion:"0",allowedUserName:s.allowedUserName,author:s.author,commercialUssageName:s.commercialUssageName,contactInformation:s.contactInformation,licenseName:s.licenseName,otherLicenseUrl:s.otherLicenseUrl,otherPermissionUrl:s.otherPermissionUrl,reference:s.reference,sexualUssageName:s.sexualUssageName,texture:n??void 0,title:s.title,version:s.version,violentUssageName:s.violentUssageName}})}_extractGLTFImage(r){return ft(this,null,function*(){var t;const i=(t=this.parser.json.images)==null?void 0:t[r];if(i==null)return null;let s=i.uri;if(i.bufferView!=null){const a=yield this.parser.getDependency("bufferView",i.bufferView),o=new Blob([a],{type:i.mimeType});s=URL.createObjectURL(o)}return s==null?null:yield new S_().loadAsync(e8(s,this.parser.options.path)).catch(a=>null)})}},n8=class{constructor(r){this.scene=r.scene,this.meta=r.meta,this.humanoid=r.humanoid,this.expressionManager=r.expressionManager,this.firstPerson=r.firstPerson,this.lookAt=r.lookAt}update(r){this.humanoid.update(),this.lookAt&&this.lookAt.update(r),this.expressionManager&&this.expressionManager.update()}},r8=class extends n8{constructor(r){super(r),this.materials=r.materials,this.springBoneManager=r.springBoneManager,this.nodeConstraintManager=r.nodeConstraintManager}update(r){super.update(r),this.nodeConstraintManager&&this.nodeConstraintManager.update(),this.springBoneManager&&this.springBoneManager.update(r),this.materials&&this.materials.forEach(t=>{t.update&&t.update(r)})}},a8=Object.defineProperty,fg=Object.getOwnPropertySymbols,o8=Object.prototype.hasOwnProperty,h8=Object.prototype.propertyIsEnumerable,gg=(r,t,e)=>t in r?a8(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,yg=(r,t)=>{for(var e in t||(t={}))o8.call(t,e)&&gg(r,e,t[e]);if(fg)for(var e of fg(t))h8.call(t,e)&&gg(r,e,t[e]);return r},Ln=(r,t,e)=>new Promise((i,s)=>{var n=h=>{try{o(e.next(h))}catch(l){s(l)}},a=h=>{try{o(e.throw(h))}catch(l){s(l)}},o=h=>h.done?i(h.value):Promise.resolve(h.value).then(n,a);o((e=e.apply(r,t)).next())}),l8={"":3e3,srgb:3001};function u8(r,t){parseInt(gr,10)>=152?r.colorSpace=t:r.encoding=l8[t]}var c8=class{get pending(){return Promise.all(this._pendings)}constructor(r,t){this._parser=r,this._materialParams=t,this._pendings=[]}assignPrimitive(r,t){t!=null&&(this._materialParams[r]=t)}assignColor(r,t,e){t!=null&&(this._materialParams[r]=new Qt().fromArray(t),e&&this._materialParams[r].convertSRGBToLinear())}assignTexture(r,t,e){return Ln(this,null,function*(){const i=Ln(this,null,function*(){t!=null&&(yield this._parser.assignTexture(this._materialParams,r,t),e&&u8(this._materialParams[r],"srgb"))});return this._pendings.push(i),i})}assignTextureByIndex(r,t,e){return Ln(this,null,function*(){return this.assignTexture(r,t!=null?{index:t}:void 0,e)})}},d8=`// #define PHONG

varying vec3 vViewPosition;

#ifndef FLAT_SHADED
  varying vec3 vNormal;
#endif

#include <common>

// #include <uv_pars_vertex>
#ifdef MTOON_USE_UV
  varying vec2 vUv;

  // COMPAT: pre-r151 uses a common uvTransform
  #if THREE_VRM_THREE_REVISION < 151
    uniform mat3 uvTransform;
  #endif
#endif

// #include <uv2_pars_vertex>
// COMAPT: pre-r151 uses uv2 for lightMap and aoMap
#if THREE_VRM_THREE_REVISION < 151
  #if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
    attribute vec2 uv2;
    varying vec2 vUv2;
    uniform mat3 uv2Transform;
  #endif
#endif

// #include <displacementmap_pars_vertex>
// #include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

#ifdef USE_OUTLINEWIDTHMULTIPLYTEXTURE
  uniform sampler2D outlineWidthMultiplyTexture;
  uniform mat3 outlineWidthMultiplyTextureUvTransform;
#endif

uniform float outlineWidthFactor;

void main() {

  // #include <uv_vertex>
  #ifdef MTOON_USE_UV
    // COMPAT: pre-r151 uses a common uvTransform
    #if THREE_VRM_THREE_REVISION >= 151
      vUv = uv;
    #else
      vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
    #endif
  #endif

  // #include <uv2_vertex>
  // COMAPT: pre-r151 uses uv2 for lightMap and aoMap
  #if THREE_VRM_THREE_REVISION < 151
    #if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
      vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
    #endif
  #endif

  #include <color_vertex>

  #include <beginnormal_vertex>
  #include <morphnormal_vertex>
  #include <skinbase_vertex>
  #include <skinnormal_vertex>

  // we need this to compute the outline properly
  objectNormal = normalize( objectNormal );

  #include <defaultnormal_vertex>

  #ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED
    vNormal = normalize( transformedNormal );
  #endif

  #include <begin_vertex>

  #include <morphtarget_vertex>
  #include <skinning_vertex>
  // #include <displacementmap_vertex>
  #include <project_vertex>
  #include <logdepthbuf_vertex>
  #include <clipping_planes_vertex>

  vViewPosition = - mvPosition.xyz;

  #ifdef OUTLINE
    float worldNormalLength = length( transformedNormal );
    vec3 outlineOffset = outlineWidthFactor * worldNormalLength * objectNormal;

    #ifdef USE_OUTLINEWIDTHMULTIPLYTEXTURE
      vec2 outlineWidthMultiplyTextureUv = ( outlineWidthMultiplyTextureUvTransform * vec3( vUv, 1 ) ).xy;
      float outlineTex = texture2D( outlineWidthMultiplyTexture, outlineWidthMultiplyTextureUv ).g;
      outlineOffset *= outlineTex;
    #endif

    #ifdef OUTLINE_WIDTH_SCREEN
      outlineOffset *= vViewPosition.z / projectionMatrix[ 1 ].y;
    #endif

    gl_Position = projectionMatrix * modelViewMatrix * vec4( outlineOffset + transformed, 1.0 );

    gl_Position.z += 1E-6 * gl_Position.w; // anti-artifact magic
  #endif

  #include <worldpos_vertex>
  // #include <envmap_vertex>
  #include <shadowmap_vertex>
  #include <fog_vertex>

}`,p8=`// #define PHONG

uniform vec3 litFactor;

uniform float opacity;

uniform vec3 shadeColorFactor;
#ifdef USE_SHADEMULTIPLYTEXTURE
  uniform sampler2D shadeMultiplyTexture;
  uniform mat3 shadeMultiplyTextureUvTransform;
#endif

uniform float shadingShiftFactor;
uniform float shadingToonyFactor;

#ifdef USE_SHADINGSHIFTTEXTURE
  uniform sampler2D shadingShiftTexture;
  uniform mat3 shadingShiftTextureUvTransform;
  uniform float shadingShiftTextureScale;
#endif

uniform float giEqualizationFactor;

uniform vec3 parametricRimColorFactor;
#ifdef USE_RIMMULTIPLYTEXTURE
  uniform sampler2D rimMultiplyTexture;
  uniform mat3 rimMultiplyTextureUvTransform;
#endif
uniform float rimLightingMixFactor;
uniform float parametricRimFresnelPowerFactor;
uniform float parametricRimLiftFactor;

#ifdef USE_MATCAPTEXTURE
  uniform vec3 matcapFactor;
  uniform sampler2D matcapTexture;
  uniform mat3 matcapTextureUvTransform;
#endif

uniform vec3 emissive;
uniform float emissiveIntensity;

uniform vec3 outlineColorFactor;
uniform float outlineLightingMixFactor;

#ifdef USE_UVANIMATIONMASKTEXTURE
  uniform sampler2D uvAnimationMaskTexture;
  uniform mat3 uvAnimationMaskTextureUvTransform;
#endif

uniform float uvAnimationScrollXOffset;
uniform float uvAnimationScrollYOffset;
uniform float uvAnimationRotationPhase;

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>

// #include <uv_pars_fragment>
#if ( defined( MTOON_USE_UV ) && !defined( MTOON_UVS_VERTEX_ONLY ) )
  varying vec2 vUv;
#endif

// #include <uv2_pars_fragment>
// COMAPT: pre-r151 uses uv2 for lightMap and aoMap
#if THREE_VRM_THREE_REVISION < 151
  #if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
    varying vec2 vUv2;
  #endif
#endif

#include <map_pars_fragment>

#ifdef USE_MAP
  uniform mat3 mapUvTransform;
#endif

// #include <alphamap_pars_fragment>

#include <alphatest_pars_fragment>

#include <aomap_pars_fragment>
// #include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>

#ifdef USE_EMISSIVEMAP
  uniform mat3 emissiveMapUvTransform;
#endif

// #include <envmap_common_pars_fragment>
// #include <envmap_pars_fragment>
// #include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>

// #include <bsdfs>
// COMPAT: pre-r151 doesn't have BRDF_Lambert in <common>
#if THREE_VRM_THREE_REVISION < 151
  vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
    return RECIPROCAL_PI * diffuseColor;
  }
#endif

#include <lights_pars_begin>

#include <normal_pars_fragment>

// #include <lights_phong_pars_fragment>
varying vec3 vViewPosition;

struct MToonMaterial {
  vec3 diffuseColor;
  vec3 shadeColor;
  float shadingShift;
};

float linearstep( float a, float b, float t ) {
  return clamp( ( t - a ) / ( b - a ), 0.0, 1.0 );
}

/**
 * Convert NdotL into toon shading factor using shadingShift and shadingToony
 */
float getShading(
  const in float dotNL,
  const in float shadow,
  const in float shadingShift
) {
  float shading = dotNL;
  shading = shading + shadingShift;
  shading = linearstep( -1.0 + shadingToonyFactor, 1.0 - shadingToonyFactor, shading );
  shading *= shadow;
  return shading;
}

/**
 * Mix diffuseColor and shadeColor using shading factor and light color
 */
vec3 getDiffuse(
  const in MToonMaterial material,
  const in float shading,
  in vec3 lightColor
) {
  #ifdef DEBUG_LITSHADERATE
    return vec3( BRDF_Lambert( shading * lightColor ) );
  #endif

  vec3 col = lightColor * BRDF_Lambert( mix( material.shadeColor, material.diffuseColor, shading ) );

  // The "comment out if you want to PBR absolutely" line
  #ifdef V0_COMPAT_SHADE
    col = min( col, material.diffuseColor );
  #endif

  return col;
}

// COMPAT: pre-r156 uses a struct GeometricContext
#if THREE_VRM_THREE_REVISION >= 157
  void RE_Direct_MToon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in MToonMaterial material, const in float shadow, inout ReflectedLight reflectedLight ) {
    float dotNL = clamp( dot( geometryNormal, directLight.direction ), -1.0, 1.0 );
    vec3 irradiance = directLight.color;

    // directSpecular will be used for rim lighting, not an actual specular
    reflectedLight.directSpecular += irradiance;

    irradiance *= dotNL;

    float shading = getShading( dotNL, shadow, material.shadingShift );

    // toon shaded diffuse
    reflectedLight.directDiffuse += getDiffuse( material, shading, directLight.color );
  }

  void RE_IndirectDiffuse_MToon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in MToonMaterial material, inout ReflectedLight reflectedLight ) {
    // indirect diffuse will use diffuseColor, no shadeColor involved
    reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

    // directSpecular will be used for rim lighting, not an actual specular
    reflectedLight.directSpecular += irradiance;
  }
#else
  void RE_Direct_MToon( const in IncidentLight directLight, const in GeometricContext geometry, const in MToonMaterial material, const in float shadow, inout ReflectedLight reflectedLight ) {
    float dotNL = clamp( dot( geometry.normal, directLight.direction ), -1.0, 1.0 );
    vec3 irradiance = directLight.color;

    // directSpecular will be used for rim lighting, not an actual specular
    reflectedLight.directSpecular += irradiance;

    irradiance *= dotNL;

    float shading = getShading( dotNL, shadow, material.shadingShift );

    // toon shaded diffuse
    reflectedLight.directDiffuse += getDiffuse( material, shading, directLight.color );
  }

  void RE_IndirectDiffuse_MToon( const in vec3 irradiance, const in GeometricContext geometry, const in MToonMaterial material, inout ReflectedLight reflectedLight ) {
    // indirect diffuse will use diffuseColor, no shadeColor involved
    reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

    // directSpecular will be used for rim lighting, not an actual specular
    reflectedLight.directSpecular += irradiance;
  }
#endif

#define RE_Direct RE_Direct_MToon
#define RE_IndirectDiffuse RE_IndirectDiffuse_MToon
#define Material_LightProbeLOD( material ) (0)

#include <shadowmap_pars_fragment>
// #include <bumpmap_pars_fragment>

// #include <normalmap_pars_fragment>
#ifdef USE_NORMALMAP

  uniform sampler2D normalMap;
  uniform mat3 normalMapUvTransform;
  uniform vec2 normalScale;

#endif

// COMPAT: pre-r151
// USE_NORMALMAP_OBJECTSPACE used to be OBJECTSPACE_NORMALMAP in pre-r151
#if defined( USE_NORMALMAP_OBJECTSPACE ) || defined( OBJECTSPACE_NORMALMAP )

  uniform mat3 normalMatrix;

#endif

// COMPAT: pre-r151
// USE_NORMALMAP_TANGENTSPACE used to be TANGENTSPACE_NORMALMAP in pre-r151
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( TANGENTSPACE_NORMALMAP ) )

  // Per-Pixel Tangent Space Normal Mapping
  // http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html

  // three-vrm specific change: it requires \`uv\` as an input in order to support uv scrolls

  // Temporary compat against shader change @ Three.js r126, r151
  #if THREE_VRM_THREE_REVISION >= 151

    mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {

      vec3 q0 = dFdx( eye_pos.xyz );
      vec3 q1 = dFdy( eye_pos.xyz );
      vec2 st0 = dFdx( uv.st );
      vec2 st1 = dFdy( uv.st );

      vec3 N = surf_norm;

      vec3 q1perp = cross( q1, N );
      vec3 q0perp = cross( N, q0 );

      vec3 T = q1perp * st0.x + q0perp * st1.x;
      vec3 B = q1perp * st0.y + q0perp * st1.y;

      float det = max( dot( T, T ), dot( B, B ) );
      float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );

      return mat3( T * scale, B * scale, N );

    }

  #else

    vec3 perturbNormal2Arb( vec2 uv, vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {

      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
      vec2 st0 = dFdx( uv.st );
      vec2 st1 = dFdy( uv.st );

      vec3 N = normalize( surf_norm );

      vec3 q1perp = cross( q1, N );
      vec3 q0perp = cross( N, q0 );

      vec3 T = q1perp * st0.x + q0perp * st1.x;
      vec3 B = q1perp * st0.y + q0perp * st1.y;

      // three-vrm specific change: Workaround for the issue that happens when delta of uv = 0.0
      // TODO: Is this still required? Or shall I make a PR about it?
      if ( length( T ) == 0.0 || length( B ) == 0.0 ) {
        return surf_norm;
      }

      float det = max( dot( T, T ), dot( B, B ) );
      float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );

      return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );

    }

  #endif

#endif

// #include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

// == post correction ==========================================================
void postCorrection() {
  #include <tonemapping_fragment>
  #include <colorspace_fragment>
  #include <fog_fragment>
  #include <premultiplied_alpha_fragment>
  #include <dithering_fragment>
}

// == main procedure ===========================================================
void main() {
  #include <clipping_planes_fragment>

  vec2 uv = vec2(0.5, 0.5);

  #if ( defined( MTOON_USE_UV ) && !defined( MTOON_UVS_VERTEX_ONLY ) )
    uv = vUv;

    float uvAnimMask = 1.0;
    #ifdef USE_UVANIMATIONMASKTEXTURE
      vec2 uvAnimationMaskTextureUv = ( uvAnimationMaskTextureUvTransform * vec3( uv, 1 ) ).xy;
      uvAnimMask = texture2D( uvAnimationMaskTexture, uvAnimationMaskTextureUv ).b;
    #endif

    float uvRotCos = cos( uvAnimationRotationPhase * uvAnimMask );
    float uvRotSin = sin( uvAnimationRotationPhase * uvAnimMask );
    uv = mat2( uvRotCos, -uvRotSin, uvRotSin, uvRotCos ) * ( uv - 0.5 ) + 0.5;
    uv = uv + vec2( uvAnimationScrollXOffset, uvAnimationScrollYOffset ) * uvAnimMask;
  #endif

  #ifdef DEBUG_UV
    gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
    #if ( defined( MTOON_USE_UV ) && !defined( MTOON_UVS_VERTEX_ONLY ) )
      gl_FragColor = vec4( uv, 0.0, 1.0 );
    #endif
    return;
  #endif

  vec4 diffuseColor = vec4( litFactor, opacity );
  ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
  vec3 totalEmissiveRadiance = emissive * emissiveIntensity;

  #include <logdepthbuf_fragment>

  // #include <map_fragment>
  #ifdef USE_MAP
    vec2 mapUv = ( mapUvTransform * vec3( uv, 1 ) ).xy;
    vec4 sampledDiffuseColor = texture2D( map, mapUv );
    #ifdef DECODE_VIDEO_TEXTURE
      sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
    #endif
    diffuseColor *= sampledDiffuseColor;
  #endif

  // #include <color_fragment>
  #if ( defined( USE_COLOR ) && !defined( IGNORE_VERTEX_COLOR ) )
    diffuseColor.rgb *= vColor;
  #endif

  // #include <alphamap_fragment>

  #include <alphatest_fragment>

  // #include <specularmap_fragment>

  // #include <normal_fragment_begin>
  float faceDirection = gl_FrontFacing ? 1.0 : -1.0;

  #ifdef FLAT_SHADED

    vec3 fdx = dFdx( vViewPosition );
    vec3 fdy = dFdy( vViewPosition );
    vec3 normal = normalize( cross( fdx, fdy ) );

  #else

    vec3 normal = normalize( vNormal );

    #ifdef DOUBLE_SIDED

      normal *= faceDirection;

    #endif

  #endif

  #ifdef USE_NORMALMAP

    vec2 normalMapUv = ( normalMapUvTransform * vec3( uv, 1 ) ).xy;

  #endif

  #ifdef USE_NORMALMAP_TANGENTSPACE

    #ifdef USE_TANGENT

      mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );

    #else

      mat3 tbn = getTangentFrame( - vViewPosition, normal, normalMapUv );

    #endif

    #if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )

      tbn[0] *= faceDirection;
      tbn[1] *= faceDirection;

    #endif

  #endif

  #ifdef USE_CLEARCOAT_NORMALMAP

    #ifdef USE_TANGENT

      mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );

    #else

      mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );

    #endif

    #if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )

      tbn2[0] *= faceDirection;
      tbn2[1] *= faceDirection;

    #endif

  #endif

  // non perturbed normal for clearcoat among others

  vec3 nonPerturbedNormal = normal;

  #ifdef OUTLINE
    normal *= -1.0;
  #endif

  // #include <normal_fragment_maps>

  // COMPAT: pre-r151
  // USE_NORMALMAP_OBJECTSPACE used to be OBJECTSPACE_NORMALMAP in pre-r151
  #if defined( USE_NORMALMAP_OBJECTSPACE ) || defined( OBJECTSPACE_NORMALMAP )

    normal = texture2D( normalMap, normalMapUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals

    #ifdef FLIP_SIDED

      normal = - normal;

    #endif

    #ifdef DOUBLE_SIDED

      normal = normal * faceDirection;

    #endif

    normal = normalize( normalMatrix * normal );

  // COMPAT: pre-r151
  // USE_NORMALMAP_TANGENTSPACE used to be TANGENTSPACE_NORMALMAP in pre-r151
  #elif defined( USE_NORMALMAP_TANGENTSPACE ) || defined( TANGENTSPACE_NORMALMAP )

    vec3 mapN = texture2D( normalMap, normalMapUv ).xyz * 2.0 - 1.0;
    mapN.xy *= normalScale;

    // COMPAT: pre-r151
    #if THREE_VRM_THREE_REVISION >= 151 || defined( USE_TANGENT )

      normal = normalize( tbn * mapN );

    #else

      normal = perturbNormal2Arb( uv, -vViewPosition, normal, mapN, faceDirection );

    #endif

  #endif

  // #include <emissivemap_fragment>
  #ifdef USE_EMISSIVEMAP
    vec2 emissiveMapUv = ( emissiveMapUvTransform * vec3( uv, 1 ) ).xy;
    totalEmissiveRadiance *= texture2D( emissiveMap, emissiveMapUv ).rgb;
  #endif

  #ifdef DEBUG_NORMAL
    gl_FragColor = vec4( 0.5 + 0.5 * normal, 1.0 );
    return;
  #endif

  // -- MToon: lighting --------------------------------------------------------
  // accumulation
  // #include <lights_phong_fragment>
  MToonMaterial material;

  material.diffuseColor = diffuseColor.rgb;

  material.shadeColor = shadeColorFactor;
  #ifdef USE_SHADEMULTIPLYTEXTURE
    vec2 shadeMultiplyTextureUv = ( shadeMultiplyTextureUvTransform * vec3( uv, 1 ) ).xy;
    material.shadeColor *= texture2D( shadeMultiplyTexture, shadeMultiplyTextureUv ).rgb;
  #endif

  #if ( defined( USE_COLOR ) && !defined( IGNORE_VERTEX_COLOR ) )
    material.shadeColor.rgb *= vColor;
  #endif

  material.shadingShift = shadingShiftFactor;
  #ifdef USE_SHADINGSHIFTTEXTURE
    vec2 shadingShiftTextureUv = ( shadingShiftTextureUvTransform * vec3( uv, 1 ) ).xy;
    material.shadingShift += texture2D( shadingShiftTexture, shadingShiftTextureUv ).r * shadingShiftTextureScale;
  #endif

  // #include <lights_fragment_begin>

  // MToon Specific changes:
  // Since we want to take shadows into account of shading instead of irradiance,
  // we had to modify the codes that multiplies the results of shadowmap into color of direct lights.

  // COMPAT: pre-r156 uses a struct GeometricContext
  #if THREE_VRM_THREE_REVISION >= 157
    vec3 geometryPosition = - vViewPosition;
    vec3 geometryNormal = normal;
    vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );

    vec3 geometryClearcoatNormal;

    #ifdef USE_CLEARCOAT

      geometryClearcoatNormal = clearcoatNormal;

    #endif
  #else
    GeometricContext geometry;

    geometry.position = - vViewPosition;
    geometry.normal = normal;
    geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );

    #ifdef USE_CLEARCOAT

      geometry.clearcoatNormal = clearcoatNormal;

    #endif
  #endif

  IncidentLight directLight;

  // since these variables will be used in unrolled loop, we have to define in prior
  float shadow;

  #if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )

    PointLight pointLight;
    #if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
    PointLightShadow pointLightShadow;
    #endif

    #pragma unroll_loop_start
    for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {

      pointLight = pointLights[ i ];

      // COMPAT: pre-r156 uses a struct GeometricContext
      #if THREE_VRM_THREE_REVISION >= 157
        getPointLightInfo( pointLight, geometryPosition, directLight );
      #else
        getPointLightInfo( pointLight, geometry, directLight );
      #endif

      shadow = 1.0;
      #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
      pointLightShadow = pointLightShadows[ i ];
      // COMPAT: pre-r166
      // r166 introduced shadowIntensity
      #if THREE_VRM_THREE_REVISION >= 166
        shadow = all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
      #else
        shadow = all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
      #endif
      #endif

      // COMPAT: pre-r156 uses a struct GeometricContext
      #if THREE_VRM_THREE_REVISION >= 157
        RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, shadow, reflectedLight );
      #else
        RE_Direct( directLight, geometry, material, shadow, reflectedLight );
      #endif

    }
    #pragma unroll_loop_end

  #endif

  #if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )

    SpotLight spotLight;
    #if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
    SpotLightShadow spotLightShadow;
    #endif

    #pragma unroll_loop_start
    for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {

      spotLight = spotLights[ i ];

      // COMPAT: pre-r156 uses a struct GeometricContext
      #if THREE_VRM_THREE_REVISION >= 157
        getSpotLightInfo( spotLight, geometryPosition, directLight );
      #else
        getSpotLightInfo( spotLight, geometry, directLight );
      #endif

      shadow = 1.0;
      #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
      spotLightShadow = spotLightShadows[ i ];
      // COMPAT: pre-r166
      // r166 introduced shadowIntensity
      #if THREE_VRM_THREE_REVISION >= 166
        shadow = all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
      #else
        shadow = all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
      #endif
      #endif

      // COMPAT: pre-r156 uses a struct GeometricContext
      #if THREE_VRM_THREE_REVISION >= 157
        RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, shadow, reflectedLight );
      #else
        RE_Direct( directLight, geometry, material, shadow, reflectedLight );
      #endif

    }
    #pragma unroll_loop_end

  #endif

  #if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )

    DirectionalLight directionalLight;
    #if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
    DirectionalLightShadow directionalLightShadow;
    #endif

    #pragma unroll_loop_start
    for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

      directionalLight = directionalLights[ i ];

      // COMPAT: pre-r156 uses a struct GeometricContext
      #if THREE_VRM_THREE_REVISION >= 157
        getDirectionalLightInfo( directionalLight, directLight );
      #else
        getDirectionalLightInfo( directionalLight, geometry, directLight );
      #endif

      shadow = 1.0;
      #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
      directionalLightShadow = directionalLightShadows[ i ];
      // COMPAT: pre-r166
      // r166 introduced shadowIntensity
      #if THREE_VRM_THREE_REVISION >= 166
        shadow = all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
      #else
        shadow = all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
      #endif
      #endif

      // COMPAT: pre-r156 uses a struct GeometricContext
      #if THREE_VRM_THREE_REVISION >= 157
        RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, shadow, reflectedLight );
      #else
        RE_Direct( directLight, geometry, material, shadow, reflectedLight );
      #endif

    }
    #pragma unroll_loop_end

  #endif

  // #if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )

  //   RectAreaLight rectAreaLight;

  //   #pragma unroll_loop_start
  //   for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {

  //     rectAreaLight = rectAreaLights[ i ];
  //     RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );

  //   }
  //   #pragma unroll_loop_end

  // #endif

  #if defined( RE_IndirectDiffuse )

    vec3 iblIrradiance = vec3( 0.0 );

    vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );

    // COMPAT: pre-r156 uses a struct GeometricContext
    // COMPAT: pre-r156 doesn't have a define USE_LIGHT_PROBES
    #if THREE_VRM_THREE_REVISION >= 157
      #if defined( USE_LIGHT_PROBES )
        irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
      #endif
    #else
      irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
    #endif

    #if ( NUM_HEMI_LIGHTS > 0 )

      #pragma unroll_loop_start
      for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {

        // COMPAT: pre-r156 uses a struct GeometricContext
        #if THREE_VRM_THREE_REVISION >= 157
          irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
        #else
          irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
        #endif

      }
      #pragma unroll_loop_end

    #endif

  #endif

  // #if defined( RE_IndirectSpecular )

  //   vec3 radiance = vec3( 0.0 );
  //   vec3 clearcoatRadiance = vec3( 0.0 );

  // #endif

  #include <lights_fragment_maps>
  #include <lights_fragment_end>

  // modulation
  #include <aomap_fragment>

  vec3 col = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;

  #ifdef DEBUG_LITSHADERATE
    gl_FragColor = vec4( col, diffuseColor.a );
    postCorrection();
    return;
  #endif

  // -- MToon: rim lighting -----------------------------------------
  vec3 viewDir = normalize( vViewPosition );

  #ifndef PHYSICALLY_CORRECT_LIGHTS
    reflectedLight.directSpecular /= PI;
  #endif
  vec3 rimMix = mix( vec3( 1.0 ), reflectedLight.directSpecular, 1.0 );

  vec3 rim = parametricRimColorFactor * pow( saturate( 1.0 - dot( viewDir, normal ) + parametricRimLiftFactor ), parametricRimFresnelPowerFactor );

  #ifdef USE_MATCAPTEXTURE
    {
      vec3 x = normalize( vec3( viewDir.z, 0.0, -viewDir.x ) );
      vec3 y = cross( viewDir, x ); // guaranteed to be normalized
      vec2 sphereUv = 0.5 + 0.5 * vec2( dot( x, normal ), -dot( y, normal ) );
      sphereUv = ( matcapTextureUvTransform * vec3( sphereUv, 1 ) ).xy;
      vec3 matcap = texture2D( matcapTexture, sphereUv ).rgb;
      rim += matcapFactor * matcap;
    }
  #endif

  #ifdef USE_RIMMULTIPLYTEXTURE
    vec2 rimMultiplyTextureUv = ( rimMultiplyTextureUvTransform * vec3( uv, 1 ) ).xy;
    rim *= texture2D( rimMultiplyTexture, rimMultiplyTextureUv ).rgb;
  #endif

  col += rimMix * rim;

  // -- MToon: Emission --------------------------------------------------------
  col += totalEmissiveRadiance;

  // #include <envmap_fragment>

  // -- Almost done! -----------------------------------------------------------
  #if defined( OUTLINE )
    col = outlineColorFactor.rgb * mix( vec3( 1.0 ), col, outlineLightingMixFactor );
  #endif

  #ifdef OPAQUE
    diffuseColor.a = 1.0;
  #endif

  gl_FragColor = vec4( col, diffuseColor.a );
  postCorrection();
}
`,m8={None:"none"},xg={None:"none",ScreenCoordinates:"screenCoordinates"},f8={3e3:"",3001:"srgb"};function Ld(r){return parseInt(gr,10)>=152?r.colorSpace:f8[r.encoding]}var g8=class extends g_{constructor(r={}){var t;super({vertexShader:d8,fragmentShader:p8}),this.uvAnimationScrollXSpeedFactor=0,this.uvAnimationScrollYSpeedFactor=0,this.uvAnimationRotationSpeedFactor=0,this.fog=!0,this.normalMapType=NM,this._ignoreVertexColor=!0,this._v0CompatShade=!1,this._debugMode=m8.None,this._outlineWidthMode=xg.None,this._isOutline=!1,r.transparentWithZWrite&&(r.depthWrite=!0),delete r.transparentWithZWrite,r.fog=!0,r.lights=!0,r.clipping=!0,this.uniforms=p_.merge([io.common,io.normalmap,io.emissivemap,io.fog,io.lights,{litFactor:{value:new Qt(1,1,1)},mapUvTransform:{value:new Xt},colorAlpha:{value:1},normalMapUvTransform:{value:new Xt},shadeColorFactor:{value:new Qt(0,0,0)},shadeMultiplyTexture:{value:null},shadeMultiplyTextureUvTransform:{value:new Xt},shadingShiftFactor:{value:0},shadingShiftTexture:{value:null},shadingShiftTextureUvTransform:{value:new Xt},shadingShiftTextureScale:{value:1},shadingToonyFactor:{value:.9},giEqualizationFactor:{value:.9},matcapFactor:{value:new Qt(1,1,1)},matcapTexture:{value:null},matcapTextureUvTransform:{value:new Xt},parametricRimColorFactor:{value:new Qt(0,0,0)},rimMultiplyTexture:{value:null},rimMultiplyTextureUvTransform:{value:new Xt},rimLightingMixFactor:{value:1},parametricRimFresnelPowerFactor:{value:5},parametricRimLiftFactor:{value:0},emissive:{value:new Qt(0,0,0)},emissiveIntensity:{value:1},emissiveMapUvTransform:{value:new Xt},outlineWidthMultiplyTexture:{value:null},outlineWidthMultiplyTextureUvTransform:{value:new Xt},outlineWidthFactor:{value:0},outlineColorFactor:{value:new Qt(0,0,0)},outlineLightingMixFactor:{value:1},uvAnimationMaskTexture:{value:null},uvAnimationMaskTextureUvTransform:{value:new Xt},uvAnimationScrollXOffset:{value:0},uvAnimationScrollYOffset:{value:0},uvAnimationRotationPhase:{value:0}},(t=r.uniforms)!=null?t:{}]),this.setValues(r),this._uploadUniformsWorkaround(),this.customProgramCacheKey=()=>[...Object.entries(this._generateDefines()).map(([e,i])=>`${e}:${i}`),this.matcapTexture?`matcapTextureColorSpace:${Ld(this.matcapTexture)}`:"",this.shadeMultiplyTexture?`shadeMultiplyTextureColorSpace:${Ld(this.shadeMultiplyTexture)}`:"",this.rimMultiplyTexture?`rimMultiplyTextureColorSpace:${Ld(this.rimMultiplyTexture)}`:""].join(","),this.onBeforeCompile=e=>{const i=parseInt(gr,10),s=Object.entries(yg(yg({},this._generateDefines()),this.defines)).filter(([n,a])=>!!a).map(([n,a])=>`#define ${n} ${a}`).join(`
`)+`
`;e.vertexShader=s+e.vertexShader,e.fragmentShader=s+e.fragmentShader,i<154&&(e.fragmentShader=e.fragmentShader.replace("#include <colorspace_fragment>","#include <encodings_fragment>"))}}get color(){return this.uniforms.litFactor.value}set color(r){this.uniforms.litFactor.value=r}get map(){return this.uniforms.map.value}set map(r){this.uniforms.map.value=r}get normalMap(){return this.uniforms.normalMap.value}set normalMap(r){this.uniforms.normalMap.value=r}get normalScale(){return this.uniforms.normalScale.value}set normalScale(r){this.uniforms.normalScale.value=r}get emissive(){return this.uniforms.emissive.value}set emissive(r){this.uniforms.emissive.value=r}get emissiveIntensity(){return this.uniforms.emissiveIntensity.value}set emissiveIntensity(r){this.uniforms.emissiveIntensity.value=r}get emissiveMap(){return this.uniforms.emissiveMap.value}set emissiveMap(r){this.uniforms.emissiveMap.value=r}get shadeColorFactor(){return this.uniforms.shadeColorFactor.value}set shadeColorFactor(r){this.uniforms.shadeColorFactor.value=r}get shadeMultiplyTexture(){return this.uniforms.shadeMultiplyTexture.value}set shadeMultiplyTexture(r){this.uniforms.shadeMultiplyTexture.value=r}get shadingShiftFactor(){return this.uniforms.shadingShiftFactor.value}set shadingShiftFactor(r){this.uniforms.shadingShiftFactor.value=r}get shadingShiftTexture(){return this.uniforms.shadingShiftTexture.value}set shadingShiftTexture(r){this.uniforms.shadingShiftTexture.value=r}get shadingShiftTextureScale(){return this.uniforms.shadingShiftTextureScale.value}set shadingShiftTextureScale(r){this.uniforms.shadingShiftTextureScale.value=r}get shadingToonyFactor(){return this.uniforms.shadingToonyFactor.value}set shadingToonyFactor(r){this.uniforms.shadingToonyFactor.value=r}get giEqualizationFactor(){return this.uniforms.giEqualizationFactor.value}set giEqualizationFactor(r){this.uniforms.giEqualizationFactor.value=r}get matcapFactor(){return this.uniforms.matcapFactor.value}set matcapFactor(r){this.uniforms.matcapFactor.value=r}get matcapTexture(){return this.uniforms.matcapTexture.value}set matcapTexture(r){this.uniforms.matcapTexture.value=r}get parametricRimColorFactor(){return this.uniforms.parametricRimColorFactor.value}set parametricRimColorFactor(r){this.uniforms.parametricRimColorFactor.value=r}get rimMultiplyTexture(){return this.uniforms.rimMultiplyTexture.value}set rimMultiplyTexture(r){this.uniforms.rimMultiplyTexture.value=r}get rimLightingMixFactor(){return this.uniforms.rimLightingMixFactor.value}set rimLightingMixFactor(r){this.uniforms.rimLightingMixFactor.value=r}get parametricRimFresnelPowerFactor(){return this.uniforms.parametricRimFresnelPowerFactor.value}set parametricRimFresnelPowerFactor(r){this.uniforms.parametricRimFresnelPowerFactor.value=r}get parametricRimLiftFactor(){return this.uniforms.parametricRimLiftFactor.value}set parametricRimLiftFactor(r){this.uniforms.parametricRimLiftFactor.value=r}get outlineWidthMultiplyTexture(){return this.uniforms.outlineWidthMultiplyTexture.value}set outlineWidthMultiplyTexture(r){this.uniforms.outlineWidthMultiplyTexture.value=r}get outlineWidthFactor(){return this.uniforms.outlineWidthFactor.value}set outlineWidthFactor(r){this.uniforms.outlineWidthFactor.value=r}get outlineColorFactor(){return this.uniforms.outlineColorFactor.value}set outlineColorFactor(r){this.uniforms.outlineColorFactor.value=r}get outlineLightingMixFactor(){return this.uniforms.outlineLightingMixFactor.value}set outlineLightingMixFactor(r){this.uniforms.outlineLightingMixFactor.value=r}get uvAnimationMaskTexture(){return this.uniforms.uvAnimationMaskTexture.value}set uvAnimationMaskTexture(r){this.uniforms.uvAnimationMaskTexture.value=r}get uvAnimationScrollXOffset(){return this.uniforms.uvAnimationScrollXOffset.value}set uvAnimationScrollXOffset(r){this.uniforms.uvAnimationScrollXOffset.value=r}get uvAnimationScrollYOffset(){return this.uniforms.uvAnimationScrollYOffset.value}set uvAnimationScrollYOffset(r){this.uniforms.uvAnimationScrollYOffset.value=r}get uvAnimationRotationPhase(){return this.uniforms.uvAnimationRotationPhase.value}set uvAnimationRotationPhase(r){this.uniforms.uvAnimationRotationPhase.value=r}get ignoreVertexColor(){return this._ignoreVertexColor}set ignoreVertexColor(r){this._ignoreVertexColor=r,this.needsUpdate=!0}get v0CompatShade(){return this._v0CompatShade}set v0CompatShade(r){this._v0CompatShade=r,this.needsUpdate=!0}get debugMode(){return this._debugMode}set debugMode(r){this._debugMode=r,this.needsUpdate=!0}get outlineWidthMode(){return this._outlineWidthMode}set outlineWidthMode(r){this._outlineWidthMode=r,this.needsUpdate=!0}get isOutline(){return this._isOutline}set isOutline(r){this._isOutline=r,this.needsUpdate=!0}get isMToonMaterial(){return!0}update(r){this._uploadUniformsWorkaround(),this._updateUVAnimation(r)}copy(r){return super.copy(r),this.map=r.map,this.normalMap=r.normalMap,this.emissiveMap=r.emissiveMap,this.shadeMultiplyTexture=r.shadeMultiplyTexture,this.shadingShiftTexture=r.shadingShiftTexture,this.matcapTexture=r.matcapTexture,this.rimMultiplyTexture=r.rimMultiplyTexture,this.outlineWidthMultiplyTexture=r.outlineWidthMultiplyTexture,this.uvAnimationMaskTexture=r.uvAnimationMaskTexture,this.normalMapType=r.normalMapType,this.uvAnimationScrollXSpeedFactor=r.uvAnimationScrollXSpeedFactor,this.uvAnimationScrollYSpeedFactor=r.uvAnimationScrollYSpeedFactor,this.uvAnimationRotationSpeedFactor=r.uvAnimationRotationSpeedFactor,this.ignoreVertexColor=r.ignoreVertexColor,this.v0CompatShade=r.v0CompatShade,this.debugMode=r.debugMode,this.outlineWidthMode=r.outlineWidthMode,this.isOutline=r.isOutline,this.needsUpdate=!0,this}_updateUVAnimation(r){this.uniforms.uvAnimationScrollXOffset.value+=r*this.uvAnimationScrollXSpeedFactor,this.uniforms.uvAnimationScrollYOffset.value+=r*this.uvAnimationScrollYSpeedFactor,this.uniforms.uvAnimationRotationPhase.value+=r*this.uvAnimationRotationSpeedFactor,this.uniforms.alphaTest.value=this.alphaTest,this.uniformsNeedUpdate=!0}_uploadUniformsWorkaround(){this.uniforms.opacity.value=this.opacity,this._updateTextureMatrix(this.uniforms.map,this.uniforms.mapUvTransform),this._updateTextureMatrix(this.uniforms.normalMap,this.uniforms.normalMapUvTransform),this._updateTextureMatrix(this.uniforms.emissiveMap,this.uniforms.emissiveMapUvTransform),this._updateTextureMatrix(this.uniforms.shadeMultiplyTexture,this.uniforms.shadeMultiplyTextureUvTransform),this._updateTextureMatrix(this.uniforms.shadingShiftTexture,this.uniforms.shadingShiftTextureUvTransform),this._updateTextureMatrix(this.uniforms.matcapTexture,this.uniforms.matcapTextureUvTransform),this._updateTextureMatrix(this.uniforms.rimMultiplyTexture,this.uniforms.rimMultiplyTextureUvTransform),this._updateTextureMatrix(this.uniforms.outlineWidthMultiplyTexture,this.uniforms.outlineWidthMultiplyTextureUvTransform),this._updateTextureMatrix(this.uniforms.uvAnimationMaskTexture,this.uniforms.uvAnimationMaskTextureUvTransform),this.uniformsNeedUpdate=!0}_generateDefines(){const r=parseInt(gr,10),t=this.outlineWidthMultiplyTexture!==null,e=this.map!==null||this.normalMap!==null||this.emissiveMap!==null||this.shadeMultiplyTexture!==null||this.shadingShiftTexture!==null||this.rimMultiplyTexture!==null||this.uvAnimationMaskTexture!==null;return{THREE_VRM_THREE_REVISION:r,OUTLINE:this._isOutline,MTOON_USE_UV:t||e,MTOON_UVS_VERTEX_ONLY:t&&!e,V0_COMPAT_SHADE:this._v0CompatShade,USE_SHADEMULTIPLYTEXTURE:this.shadeMultiplyTexture!==null,USE_SHADINGSHIFTTEXTURE:this.shadingShiftTexture!==null,USE_MATCAPTEXTURE:this.matcapTexture!==null,USE_RIMMULTIPLYTEXTURE:this.rimMultiplyTexture!==null,USE_OUTLINEWIDTHMULTIPLYTEXTURE:this._isOutline&&this.outlineWidthMultiplyTexture!==null,USE_UVANIMATIONMASKTEXTURE:this.uvAnimationMaskTexture!==null,IGNORE_VERTEX_COLOR:this._ignoreVertexColor===!0,DEBUG_NORMAL:this._debugMode==="normal",DEBUG_LITSHADERATE:this._debugMode==="litShadeRate",DEBUG_UV:this._debugMode==="uv",OUTLINE_WIDTH_SCREEN:this._isOutline&&this._outlineWidthMode===xg.ScreenCoordinates}}_updateTextureMatrix(r,t){r.value&&(r.value.matrixAutoUpdate&&r.value.updateMatrix(),t.value.copy(r.value.matrix))}},y8=new Set(["1.0","1.0-beta"]),bg=class w0{get name(){return w0.EXTENSION_NAME}constructor(t,e={}){var i,s,n,a;this.parser=t,this.materialType=(i=e.materialType)!=null?i:g8,this.renderOrderOffset=(s=e.renderOrderOffset)!=null?s:0,this.v0CompatShade=(n=e.v0CompatShade)!=null?n:!1,this.debugMode=(a=e.debugMode)!=null?a:"none",this._mToonMaterialSet=new Set}beforeRoot(){return Ln(this,null,function*(){this._removeUnlitExtensionIfMToonExists()})}afterRoot(t){return Ln(this,null,function*(){t.userData.vrmMToonMaterials=Array.from(this._mToonMaterialSet)})}getMaterialType(t){return this._getMToonExtension(t)?this.materialType:null}extendMaterialParams(t,e){const i=this._getMToonExtension(t);return i?this._extendMaterialParams(i,e):null}loadMesh(t){return Ln(this,null,function*(){var e;const i=this.parser,n=(e=i.json.meshes)==null?void 0:e[t];if(n==null)throw new Error(`MToonMaterialLoaderPlugin: Attempt to use meshes[${t}] of glTF but the mesh doesn't exist`);const a=n.primitives,o=yield i.loadMesh(t);if(a.length===1){const h=o,l=a[0].material;l!=null&&this._setupPrimitive(h,l)}else{const h=o;for(let l=0;l<a.length;l++){const u=h.children[l],c=a[l].material;c!=null&&this._setupPrimitive(u,c)}}return o})}_removeUnlitExtensionIfMToonExists(){const i=this.parser.json.materials;i?.map((s,n)=>{var a;this._getMToonExtension(n)&&((a=s.extensions)!=null&&a.KHR_materials_unlit)&&delete s.extensions.KHR_materials_unlit})}_getMToonExtension(t){var e,i;const a=(e=this.parser.json.materials)==null?void 0:e[t];if(a==null)return;const o=(i=a.extensions)==null?void 0:i[w0.EXTENSION_NAME];if(o==null)return;const h=o.specVersion;if(y8.has(h))return o}_extendMaterialParams(t,e){return Ln(this,null,function*(){var i;delete e.metalness,delete e.roughness;const s=new c8(this.parser,e);s.assignPrimitive("transparentWithZWrite",t.transparentWithZWrite),s.assignColor("shadeColorFactor",t.shadeColorFactor),s.assignTexture("shadeMultiplyTexture",t.shadeMultiplyTexture,!0),s.assignPrimitive("shadingShiftFactor",t.shadingShiftFactor),s.assignTexture("shadingShiftTexture",t.shadingShiftTexture,!0),s.assignPrimitive("shadingShiftTextureScale",(i=t.shadingShiftTexture)==null?void 0:i.scale),s.assignPrimitive("shadingToonyFactor",t.shadingToonyFactor),s.assignPrimitive("giEqualizationFactor",t.giEqualizationFactor),s.assignColor("matcapFactor",t.matcapFactor),s.assignTexture("matcapTexture",t.matcapTexture,!0),s.assignColor("parametricRimColorFactor",t.parametricRimColorFactor),s.assignTexture("rimMultiplyTexture",t.rimMultiplyTexture,!0),s.assignPrimitive("rimLightingMixFactor",t.rimLightingMixFactor),s.assignPrimitive("parametricRimFresnelPowerFactor",t.parametricRimFresnelPowerFactor),s.assignPrimitive("parametricRimLiftFactor",t.parametricRimLiftFactor),s.assignPrimitive("outlineWidthMode",t.outlineWidthMode),s.assignPrimitive("outlineWidthFactor",t.outlineWidthFactor),s.assignTexture("outlineWidthMultiplyTexture",t.outlineWidthMultiplyTexture,!1),s.assignColor("outlineColorFactor",t.outlineColorFactor),s.assignPrimitive("outlineLightingMixFactor",t.outlineLightingMixFactor),s.assignTexture("uvAnimationMaskTexture",t.uvAnimationMaskTexture,!1),s.assignPrimitive("uvAnimationScrollXSpeedFactor",t.uvAnimationScrollXSpeedFactor),s.assignPrimitive("uvAnimationScrollYSpeedFactor",t.uvAnimationScrollYSpeedFactor),s.assignPrimitive("uvAnimationRotationSpeedFactor",t.uvAnimationRotationSpeedFactor),s.assignPrimitive("v0CompatShade",this.v0CompatShade),s.assignPrimitive("debugMode",this.debugMode),yield s.pending})}_setupPrimitive(t,e){const i=this._getMToonExtension(e);if(i){const s=this._parseRenderOrder(i);t.renderOrder=s+this.renderOrderOffset,this._generateOutline(t),this._addToMaterialSet(t);return}}_shouldGenerateOutline(t){return typeof t.outlineWidthMode=="string"&&t.outlineWidthMode!=="none"&&typeof t.outlineWidthFactor=="number"&&t.outlineWidthFactor>0}_generateOutline(t){const e=t.material;if(!(e instanceof kh)||!this._shouldGenerateOutline(e))return;t.material=[e];const i=e.clone();i.name+=" (Outline)",i.isOutline=!0,i.side=Df,t.material.push(i);const s=t.geometry,n=s.index?s.index.count:s.attributes.position.count/3;s.addGroup(0,n,0),s.addGroup(0,n,1)}_addToMaterialSet(t){const e=t.material,i=new Set;Array.isArray(e)?e.forEach(s=>i.add(s)):i.add(e);for(const s of i)this._mToonMaterialSet.add(s)}_parseRenderOrder(t){var e;return(t.transparentWithZWrite?0:19)+((e=t.renderQueueOffsetNumber)!=null?e:0)}};bg.EXTENSION_NAME="VRMC_materials_mtoon";var x8=bg,b8=(r,t,e)=>new Promise((i,s)=>{var n=h=>{try{o(e.next(h))}catch(l){s(l)}},a=h=>{try{o(e.throw(h))}catch(l){s(l)}},o=h=>h.done?i(h.value):Promise.resolve(h.value).then(n,a);o((e=e.apply(r,t)).next())}),Mg=class T0{get name(){return T0.EXTENSION_NAME}constructor(t){this.parser=t}extendMaterialParams(t,e){return b8(this,null,function*(){const i=this._getHDREmissiveMultiplierExtension(t);if(i==null)return;const s=i.emissiveMultiplier;e.emissiveIntensity=s})}_getHDREmissiveMultiplierExtension(t){var e,i;const a=(e=this.parser.json.materials)==null?void 0:e[t];if(a==null)return;const o=(i=a.extensions)==null?void 0:i[T0.EXTENSION_NAME];if(o!=null)return o}};Mg.EXTENSION_NAME="VRMC_materials_hdr_emissiveMultiplier";var M8=Mg,_8=Object.defineProperty,v8=Object.defineProperties,w8=Object.getOwnPropertyDescriptors,_g=Object.getOwnPropertySymbols,T8=Object.prototype.hasOwnProperty,S8=Object.prototype.propertyIsEnumerable,vg=(r,t,e)=>t in r?_8(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e,Hi=(r,t)=>{for(var e in t||(t={}))T8.call(t,e)&&vg(r,e,t[e]);if(_g)for(var e of _g(t))S8.call(t,e)&&vg(r,e,t[e]);return r},wg=(r,t)=>v8(r,w8(t)),A8=(r,t,e)=>new Promise((i,s)=>{var n=h=>{try{o(e.next(h))}catch(l){s(l)}},a=h=>{try{o(e.throw(h))}catch(l){s(l)}},o=h=>h.done?i(h.value):Promise.resolve(h.value).then(n,a);o((e=e.apply(r,t)).next())});function Vr(r){return Math.pow(r,2.2)}var N8=class{get name(){return"VRMMaterialsV0CompatPlugin"}constructor(r){var t;this.parser=r,this._renderQueueMapTransparent=new Map,this._renderQueueMapTransparentZWrite=new Map;const e=this.parser.json;e.extensionsUsed=(t=e.extensionsUsed)!=null?t:[],e.extensionsUsed.indexOf("KHR_texture_transform")===-1&&e.extensionsUsed.push("KHR_texture_transform")}beforeRoot(){return A8(this,null,function*(){var r;const t=this.parser.json,e=(r=t.extensions)==null?void 0:r.VRM,i=e?.materialProperties;i&&(this._populateRenderQueueMap(i),i.forEach((s,n)=>{var a,o;const h=(a=t.materials)==null?void 0:a[n];if(h!=null)if(s.shader==="VRM/MToon"){const l=this._parseV0MToonProperties(s,h);t.materials[n]=l}else if((o=s.shader)!=null&&o.startsWith("VRM/Unlit")){const l=this._parseV0UnlitProperties(s,h);t.materials[n]=l}else s.shader}))})}_parseV0MToonProperties(r,t){var e,i,s,n,a,o,h,l,u,c,d,p,m,f,g,y,x,_,M,v,N,T,C,P,F,D,q,X,it,mt,xt,Q,gt,st,rt,Rt,_s,kn,Fl,go,O9,V9,F9,k9,D9,U9,W9,H9,q9,$9,X9,j9,G9,Y9,Z9;const J9=(i=(e=r.keywordMap)==null?void 0:e._ALPHABLEND_ON)!=null?i:!1,S6=((s=r.floatProperties)==null?void 0:s._ZWrite)===1&&J9,A6=this._v0ParseRenderQueue(r),Q9=(a=(n=r.keywordMap)==null?void 0:n._ALPHATEST_ON)!=null?a:!1,N6=J9?"BLEND":Q9?"MASK":"OPAQUE",R6=Q9?(h=(o=r.floatProperties)==null?void 0:o._Cutoff)!=null?h:.5:void 0,E6=((u=(l=r.floatProperties)==null?void 0:l._CullMode)!=null?u:2)===0,Dn=this._portTextureTransform(r),I6=((d=(c=r.vectorProperties)==null?void 0:c._Color)!=null?d:[1,1,1,1]).map((oy,tv)=>tv===3?oy:Vr(oy)),K9=(p=r.textureProperties)==null?void 0:p._MainTex,C6=K9!=null?{index:K9,extensions:Hi({},Dn)}:void 0,z6=(f=(m=r.floatProperties)==null?void 0:m._BumpScale)!=null?f:1,ty=(g=r.textureProperties)==null?void 0:g._BumpMap,L6=ty!=null?{index:ty,scale:z6,extensions:Hi({},Dn)}:void 0,P6=((x=(y=r.vectorProperties)==null?void 0:y._EmissionColor)!=null?x:[0,0,0,1]).map(Vr),ey=(_=r.textureProperties)==null?void 0:_._EmissionMap,B6=ey!=null?{index:ey,extensions:Hi({},Dn)}:void 0,O6=((v=(M=r.vectorProperties)==null?void 0:M._ShadeColor)!=null?v:[.97,.81,.86,1]).map(Vr),iy=(N=r.textureProperties)==null?void 0:N._ShadeTexture,V6=iy!=null?{index:iy,extensions:Hi({},Dn)}:void 0;let kl=(C=(T=r.floatProperties)==null?void 0:T._ShadeShift)!=null?C:0,Dl=(F=(P=r.floatProperties)==null?void 0:P._ShadeToony)!=null?F:.9;Dl=Jt.lerp(Dl,1,.5+.5*kl),kl=-kl-(1-Dl);const sy=(q=(D=r.floatProperties)==null?void 0:D._IndirectLightIntensity)!=null?q:.1,F6=sy?1-sy:void 0,M0=(X=r.textureProperties)==null?void 0:X._SphereAdd,k6=M0!=null?[1,1,1]:void 0,D6=M0!=null?{index:M0}:void 0,U6=(mt=(it=r.floatProperties)==null?void 0:it._RimLightingMix)!=null?mt:0,ny=(xt=r.textureProperties)==null?void 0:xt._RimTexture,W6=ny!=null?{index:ny,extensions:Hi({},Dn)}:void 0,H6=((gt=(Q=r.vectorProperties)==null?void 0:Q._RimColor)!=null?gt:[0,0,0,1]).map(Vr),q6=(rt=(st=r.floatProperties)==null?void 0:st._RimFresnelPower)!=null?rt:1,$6=(_s=(Rt=r.floatProperties)==null?void 0:Rt._RimLift)!=null?_s:0,X6=["none","worldCoordinates","screenCoordinates"][(Fl=(kn=r.floatProperties)==null?void 0:kn._OutlineWidthMode)!=null?Fl:0];let _0=(O9=(go=r.floatProperties)==null?void 0:go._OutlineWidth)!=null?O9:0;_0=.01*_0;const ry=(V9=r.textureProperties)==null?void 0:V9._OutlineWidthTexture,j6=ry!=null?{index:ry,extensions:Hi({},Dn)}:void 0,G6=((k9=(F9=r.vectorProperties)==null?void 0:F9._OutlineColor)!=null?k9:[0,0,0]).map(Vr),Y6=((U9=(D9=r.floatProperties)==null?void 0:D9._OutlineColorMode)!=null?U9:0)===1?(H9=(W9=r.floatProperties)==null?void 0:W9._OutlineLightingMix)!=null?H9:1:0,ay=(q9=r.textureProperties)==null?void 0:q9._UvAnimMaskTexture,Z6=ay!=null?{index:ay,extensions:Hi({},Dn)}:void 0,J6=(X9=($9=r.floatProperties)==null?void 0:$9._UvAnimScrollX)!=null?X9:0;let Ul=(G9=(j9=r.floatProperties)==null?void 0:j9._UvAnimScrollY)!=null?G9:0;Ul!=null&&(Ul=-Ul);const Q6=(Z9=(Y9=r.floatProperties)==null?void 0:Y9._UvAnimRotation)!=null?Z9:0,K6={specVersion:"1.0",transparentWithZWrite:S6,renderQueueOffsetNumber:A6,shadeColorFactor:O6,shadeMultiplyTexture:V6,shadingShiftFactor:kl,shadingToonyFactor:Dl,giEqualizationFactor:F6,matcapFactor:k6,matcapTexture:D6,rimLightingMixFactor:U6,rimMultiplyTexture:W6,parametricRimColorFactor:H6,parametricRimFresnelPowerFactor:q6,parametricRimLiftFactor:$6,outlineWidthMode:X6,outlineWidthFactor:_0,outlineWidthMultiplyTexture:j6,outlineColorFactor:G6,outlineLightingMixFactor:Y6,uvAnimationMaskTexture:Z6,uvAnimationScrollXSpeedFactor:J6,uvAnimationScrollYSpeedFactor:Ul,uvAnimationRotationSpeedFactor:Q6};return wg(Hi({},t),{pbrMetallicRoughness:{baseColorFactor:I6,baseColorTexture:C6},normalTexture:L6,emissiveTexture:B6,emissiveFactor:P6,alphaMode:N6,alphaCutoff:R6,doubleSided:E6,extensions:{VRMC_materials_mtoon:K6}})}_parseV0UnlitProperties(r,t){var e,i,s,n,a;const o=r.shader==="VRM/UnlitTransparentZWrite",h=r.shader==="VRM/UnlitTransparent"||o,l=this._v0ParseRenderQueue(r),u=r.shader==="VRM/UnlitCutout",c=h?"BLEND":u?"MASK":"OPAQUE",d=u?(i=(e=r.floatProperties)==null?void 0:e._Cutoff)!=null?i:.5:void 0,p=this._portTextureTransform(r),m=((n=(s=r.vectorProperties)==null?void 0:s._Color)!=null?n:[1,1,1,1]).map(Vr),f=(a=r.textureProperties)==null?void 0:a._MainTex,g=f!=null?{index:f,extensions:Hi({},p)}:void 0,y={specVersion:"1.0",transparentWithZWrite:o,renderQueueOffsetNumber:l,shadeColorFactor:m,shadeMultiplyTexture:g};return wg(Hi({},t),{pbrMetallicRoughness:{baseColorFactor:m,baseColorTexture:g},alphaMode:c,alphaCutoff:d,extensions:{VRMC_materials_mtoon:y}})}_portTextureTransform(r){var t,e,i,s,n;const a=(t=r.vectorProperties)==null?void 0:t._MainTex;if(a==null)return{};const o=[(e=a?.[0])!=null?e:0,(i=a?.[1])!=null?i:0],h=[(s=a?.[2])!=null?s:1,(n=a?.[3])!=null?n:1];return o[1]=1-h[1]-o[1],{KHR_texture_transform:{offset:o,scale:h}}}_v0ParseRenderQueue(r){var t,e;const i=r.shader==="VRM/UnlitTransparentZWrite",s=((t=r.keywordMap)==null?void 0:t._ALPHABLEND_ON)!=null||r.shader==="VRM/UnlitTransparent"||i,n=((e=r.floatProperties)==null?void 0:e._ZWrite)===1||i;let a=0;if(s){const o=r.renderQueue;o!=null&&(n?a=this._renderQueueMapTransparentZWrite.get(o):a=this._renderQueueMapTransparent.get(o))}return a}_populateRenderQueueMap(r){const t=new Set,e=new Set;r.forEach(i=>{var s,n;const a=i.shader==="VRM/UnlitTransparentZWrite",o=((s=i.keywordMap)==null?void 0:s._ALPHABLEND_ON)!=null||i.shader==="VRM/UnlitTransparent"||a,h=((n=i.floatProperties)==null?void 0:n._ZWrite)===1||a;if(o){const l=i.renderQueue;l!=null&&(h?e.add(l):t.add(l))}}),t.size>10,e.size>10,Array.from(t).sort().forEach((i,s)=>{const n=Math.min(Math.max(s-t.size+1,-9),0);this._renderQueueMapTransparent.set(i,n)}),Array.from(e).sort().forEach((i,s)=>{const n=Math.min(Math.max(s,0),9);this._renderQueueMapTransparentZWrite.set(i,n)})}},Tg=(r,t,e)=>new Promise((i,s)=>{var n=h=>{try{o(e.next(h))}catch(l){s(l)}},a=h=>{try{o(e.throw(h))}catch(l){s(l)}},o=h=>h.done?i(h.value):Promise.resolve(h.value).then(n,a);o((e=e.apply(r,t)).next())}),js=new E,Pd=class extends Lr{constructor(r){super(),this._attrPosition=new Kt(new Float32Array([0,0,0,0,0,0]),3),this._attrPosition.setUsage(RM);const t=new Ui;t.setAttribute("position",this._attrPosition);const e=new Pr({color:16711935,depthTest:!1,depthWrite:!1});this._line=new P1(t,e),this.add(this._line),this.constraint=r}updateMatrixWorld(r){js.setFromMatrixPosition(this.constraint.destination.matrixWorld),this._attrPosition.setXYZ(0,js.x,js.y,js.z),this.constraint.source&&js.setFromMatrixPosition(this.constraint.source.matrixWorld),this._attrPosition.setXYZ(1,js.x,js.y,js.z),this._attrPosition.needsUpdate=!0,super.updateMatrixWorld(r)}};function Sg(r,t){return t.set(r.elements[12],r.elements[13],r.elements[14])}var R8=new E,E8=new E;function I8(r,t){return r.decompose(R8,t,E8),t}function rl(r){return r.invert?r.invert():r.inverse(),r}var Bd=class{constructor(r,t){this.destination=r,this.source=t,this.weight=1}},C8=new E,z8=new E,L8=new E,P8=new ot,B8=new ot,O8=new ot,V8=class extends Bd{get aimAxis(){return this._aimAxis}set aimAxis(r){this._aimAxis=r,this._v3AimAxis.set(r==="PositiveX"?1:r==="NegativeX"?-1:0,r==="PositiveY"?1:r==="NegativeY"?-1:0,r==="PositiveZ"?1:r==="NegativeZ"?-1:0)}get dependencies(){const r=new Set([this.source]);return this.destination.parent&&r.add(this.destination.parent),r}constructor(r,t){super(r,t),this._aimAxis="PositiveX",this._v3AimAxis=new E(1,0,0),this._dstRestQuat=new ot}setInitState(){this._dstRestQuat.copy(this.destination.quaternion)}update(){this.destination.updateWorldMatrix(!0,!1),this.source.updateWorldMatrix(!0,!1);const r=P8.identity(),t=B8.identity();this.destination.parent&&(I8(this.destination.parent.matrixWorld,r),rl(t.copy(r)));const e=C8.copy(this._v3AimAxis).applyQuaternion(this._dstRestQuat).applyQuaternion(r),i=Sg(this.source.matrixWorld,z8).sub(Sg(this.destination.matrixWorld,L8)).normalize(),s=O8.setFromUnitVectors(e,i).premultiply(t).multiply(r).multiply(this._dstRestQuat);this.destination.quaternion.copy(this._dstRestQuat).slerp(s,this.weight)}};function F8(r,t){const e=[r];let i=r.parent;for(;i!==null;)e.unshift(i),i=i.parent;e.forEach(s=>{t(s)})}var k8=class{constructor(){this._constraints=new Set,this._objectConstraintsMap=new Map}get constraints(){return this._constraints}addConstraint(r){this._constraints.add(r);let t=this._objectConstraintsMap.get(r.destination);t==null&&(t=new Set,this._objectConstraintsMap.set(r.destination,t)),t.add(r)}deleteConstraint(r){this._constraints.delete(r),this._objectConstraintsMap.get(r.destination).delete(r)}setInitState(){const r=new Set,t=new Set;for(const e of this._constraints)this._processConstraint(e,r,t,i=>i.setInitState())}update(){const r=new Set,t=new Set;for(const e of this._constraints)this._processConstraint(e,r,t,i=>i.update())}_processConstraint(r,t,e,i){if(e.has(r))return;if(t.has(r))throw new Error("VRMNodeConstraintManager: Circular dependency detected while updating constraints");t.add(r);const s=r.dependencies;for(const n of s)F8(n,a=>{const o=this._objectConstraintsMap.get(a);if(o)for(const h of o)this._processConstraint(h,t,e,i)});i(r),e.add(r)}},D8=new ot,U8=new ot,W8=class extends Bd{get dependencies(){return new Set([this.source])}constructor(r,t){super(r,t),this._dstRestQuat=new ot,this._invSrcRestQuat=new ot}setInitState(){this._dstRestQuat.copy(this.destination.quaternion),rl(this._invSrcRestQuat.copy(this.source.quaternion))}update(){const r=D8.copy(this._invSrcRestQuat).multiply(this.source.quaternion),t=U8.copy(this._dstRestQuat).multiply(r);this.destination.quaternion.copy(this._dstRestQuat).slerp(t,this.weight)}},H8=new E,q8=new ot,$8=new ot,X8=class extends Bd{get rollAxis(){return this._rollAxis}set rollAxis(r){this._rollAxis=r,this._v3RollAxis.set(r==="X"?1:0,r==="Y"?1:0,r==="Z"?1:0)}get dependencies(){return new Set([this.source])}constructor(r,t){super(r,t),this._rollAxis="X",this._v3RollAxis=new E(1,0,0),this._dstRestQuat=new ot,this._invDstRestQuat=new ot,this._invSrcRestQuatMulDstRestQuat=new ot}setInitState(){this._dstRestQuat.copy(this.destination.quaternion),rl(this._invDstRestQuat.copy(this._dstRestQuat)),rl(this._invSrcRestQuatMulDstRestQuat.copy(this.source.quaternion)).multiply(this._dstRestQuat)}update(){const r=q8.copy(this._invDstRestQuat).multiply(this.source.quaternion).multiply(this._invSrcRestQuatMulDstRestQuat),t=H8.copy(this._v3RollAxis).applyQuaternion(r),i=$8.setFromUnitVectors(t,this._v3RollAxis).premultiply(this._dstRestQuat).multiply(r);this.destination.quaternion.copy(this._dstRestQuat).slerp(i,this.weight)}},j8=new Set(["1.0","1.0-beta"]),Ag=class $l{get name(){return $l.EXTENSION_NAME}constructor(t,e){this.parser=t,this.helperRoot=e?.helperRoot}afterRoot(t){return Tg(this,null,function*(){t.userData.vrmNodeConstraintManager=yield this._import(t)})}_import(t){return Tg(this,null,function*(){var e;const i=this.parser.json;if(!(((e=i.extensionsUsed)==null?void 0:e.indexOf($l.EXTENSION_NAME))!==-1))return null;const n=new k8,a=yield this.parser.getDependencies("node");return a.forEach((o,h)=>{var l;const u=i.nodes[h],c=(l=u?.extensions)==null?void 0:l[$l.EXTENSION_NAME];if(c==null)return;const d=c.specVersion;if(!j8.has(d))return;const p=c.constraint;if(p.roll!=null){const m=this._importRollConstraint(o,a,p.roll);n.addConstraint(m)}else if(p.aim!=null){const m=this._importAimConstraint(o,a,p.aim);n.addConstraint(m)}else if(p.rotation!=null){const m=this._importRotationConstraint(o,a,p.rotation);n.addConstraint(m)}}),t.scene.updateMatrixWorld(),n.setInitState(),n})}_importRollConstraint(t,e,i){const{source:s,rollAxis:n,weight:a}=i,o=e[s],h=new X8(t,o);if(n!=null&&(h.rollAxis=n),a!=null&&(h.weight=a),this.helperRoot){const l=new Pd(h);this.helperRoot.add(l)}return h}_importAimConstraint(t,e,i){const{source:s,aimAxis:n,weight:a}=i,o=e[s],h=new V8(t,o);if(n!=null&&(h.aimAxis=n),a!=null&&(h.weight=a),this.helperRoot){const l=new Pd(h);this.helperRoot.add(l)}return h}_importRotationConstraint(t,e,i){const{source:s,weight:n}=i,a=e[s],o=new W8(t,a);if(n!=null&&(o.weight=n),this.helperRoot){const h=new Pd(o);this.helperRoot.add(h)}return o}};Ag.EXTENSION_NAME="VRMC_node_constraint";var G8=Ag,al=(r,t,e)=>new Promise((i,s)=>{var n=h=>{try{o(e.next(h))}catch(l){s(l)}},a=h=>{try{o(e.throw(h))}catch(l){s(l)}},o=h=>h.done?i(h.value):Promise.resolve(h.value).then(n,a);o((e=e.apply(r,t)).next())}),Od=class{},Vd=new E,Pn=new E,Ng=class extends Od{get type(){return"capsule"}constructor(r){var t,e,i,s;super(),this.offset=(t=r?.offset)!=null?t:new E(0,0,0),this.tail=(e=r?.tail)!=null?e:new E(0,0,0),this.radius=(i=r?.radius)!=null?i:0,this.inside=(s=r?.inside)!=null?s:!1}calculateCollision(r,t,e,i){Vd.setFromMatrixPosition(r),Pn.subVectors(this.tail,this.offset).applyMatrix4(r),Pn.sub(Vd);const s=Pn.lengthSq();i.copy(t).sub(Vd);const n=Pn.dot(i);n<=0||(s<=n||Pn.multiplyScalar(n/s),i.sub(Pn));const a=i.length(),o=this.inside?this.radius-e-a:a-e-this.radius;return o<0&&(i.multiplyScalar(1/a),this.inside&&i.negate()),o}},Fd=new E,Rg=new Xt,Eg=class extends Od{get type(){return"plane"}constructor(r){var t,e;super(),this.offset=(t=r?.offset)!=null?t:new E(0,0,0),this.normal=(e=r?.normal)!=null?e:new E(0,0,1)}calculateCollision(r,t,e,i){i.setFromMatrixPosition(r),i.negate().add(t),Rg.getNormalMatrix(r),Fd.copy(this.normal).applyNormalMatrix(Rg).normalize();const s=i.dot(Fd)-e;return i.copy(Fd),s}},Y8=new E,Ig=class extends Od{get type(){return"sphere"}constructor(r){var t,e,i;super(),this.offset=(t=r?.offset)!=null?t:new E(0,0,0),this.radius=(e=r?.radius)!=null?e:0,this.inside=(i=r?.inside)!=null?i:!1}calculateCollision(r,t,e,i){i.subVectors(t,Y8.setFromMatrixPosition(r));const s=i.length(),n=this.inside?this.radius-e-s:s-e-this.radius;return n<0&&(i.multiplyScalar(1/s),this.inside&&i.negate()),n}},qi=new E,Z8=class extends Ui{constructor(r){super(),this.worldScale=1,this._currentRadius=0,this._currentOffset=new E,this._currentTail=new E,this._shape=r,this._attrPos=new Kt(new Float32Array(396),3),this.setAttribute("position",this._attrPos),this._attrIndex=new Kt(new Uint16Array(264),1),this.setIndex(this._attrIndex),this._buildIndex(),this.update()}update(){let r=!1;const t=this._shape.radius/this.worldScale;this._currentRadius!==t&&(this._currentRadius=t,r=!0),this._currentOffset.equals(this._shape.offset)||(this._currentOffset.copy(this._shape.offset),r=!0);const e=qi.copy(this._shape.tail).divideScalar(this.worldScale);this._currentTail.distanceToSquared(e)>1e-10&&(this._currentTail.copy(e),r=!0),r&&this._buildPosition()}_buildPosition(){qi.copy(this._currentTail).sub(this._currentOffset);const r=qi.length()/this._currentRadius;for(let i=0;i<=16;i++){const s=i/16*Math.PI;this._attrPos.setXYZ(i,-Math.sin(s),-Math.cos(s),0),this._attrPos.setXYZ(17+i,r+Math.sin(s),Math.cos(s),0),this._attrPos.setXYZ(34+i,-Math.sin(s),0,-Math.cos(s)),this._attrPos.setXYZ(51+i,r+Math.sin(s),0,Math.cos(s))}for(let i=0;i<32;i++){const s=i/16*Math.PI;this._attrPos.setXYZ(68+i,0,Math.sin(s),Math.cos(s)),this._attrPos.setXYZ(100+i,r,Math.sin(s),Math.cos(s))}const t=Math.atan2(qi.y,Math.sqrt(qi.x*qi.x+qi.z*qi.z)),e=-Math.atan2(qi.z,qi.x);this.rotateZ(t),this.rotateY(e),this.scale(this._currentRadius,this._currentRadius,this._currentRadius),this.translate(this._currentOffset.x,this._currentOffset.y,this._currentOffset.z),this._attrPos.needsUpdate=!0}_buildIndex(){for(let r=0;r<34;r++){const t=(r+1)%34;this._attrIndex.setXY(r*2,r,t),this._attrIndex.setXY(68+r*2,34+r,34+t)}for(let r=0;r<32;r++){const t=(r+1)%32;this._attrIndex.setXY(136+r*2,68+r,68+t),this._attrIndex.setXY(200+r*2,100+r,100+t)}this._attrIndex.needsUpdate=!0}},J8=class extends Ui{constructor(r){super(),this.worldScale=1,this._currentOffset=new E,this._currentNormal=new E,this._shape=r,this._attrPos=new Kt(new Float32Array(18),3),this.setAttribute("position",this._attrPos),this._attrIndex=new Kt(new Uint16Array(10),1),this.setIndex(this._attrIndex),this._buildIndex(),this.update()}update(){let r=!1;this._currentOffset.equals(this._shape.offset)||(this._currentOffset.copy(this._shape.offset),r=!0),this._currentNormal.equals(this._shape.normal)||(this._currentNormal.copy(this._shape.normal),r=!0),r&&this._buildPosition()}_buildPosition(){this._attrPos.setXYZ(0,-.5,-.5,0),this._attrPos.setXYZ(1,.5,-.5,0),this._attrPos.setXYZ(2,.5,.5,0),this._attrPos.setXYZ(3,-.5,.5,0),this._attrPos.setXYZ(4,0,0,0),this._attrPos.setXYZ(5,0,0,.25),this.translate(this._currentOffset.x,this._currentOffset.y,this._currentOffset.z),this.lookAt(this._currentNormal),this._attrPos.needsUpdate=!0}_buildIndex(){this._attrIndex.setXY(0,0,1),this._attrIndex.setXY(2,1,2),this._attrIndex.setXY(4,2,3),this._attrIndex.setXY(6,3,0),this._attrIndex.setXY(8,4,5),this._attrIndex.needsUpdate=!0}},Q8=class extends Ui{constructor(r){super(),this.worldScale=1,this._currentRadius=0,this._currentOffset=new E,this._shape=r,this._attrPos=new Kt(new Float32Array(288),3),this.setAttribute("position",this._attrPos),this._attrIndex=new Kt(new Uint16Array(192),1),this.setIndex(this._attrIndex),this._buildIndex(),this.update()}update(){let r=!1;const t=this._shape.radius/this.worldScale;this._currentRadius!==t&&(this._currentRadius=t,r=!0),this._currentOffset.equals(this._shape.offset)||(this._currentOffset.copy(this._shape.offset),r=!0),r&&this._buildPosition()}_buildPosition(){for(let r=0;r<32;r++){const t=r/16*Math.PI;this._attrPos.setXYZ(r,Math.cos(t),Math.sin(t),0),this._attrPos.setXYZ(32+r,0,Math.cos(t),Math.sin(t)),this._attrPos.setXYZ(64+r,Math.sin(t),0,Math.cos(t))}this.scale(this._currentRadius,this._currentRadius,this._currentRadius),this.translate(this._currentOffset.x,this._currentOffset.y,this._currentOffset.z),this._attrPos.needsUpdate=!0}_buildIndex(){for(let r=0;r<32;r++){const t=(r+1)%32;this._attrIndex.setXY(r*2,r,t),this._attrIndex.setXY(64+r*2,32+r,32+t),this._attrIndex.setXY(128+r*2,64+r,64+t)}this._attrIndex.needsUpdate=!0}},K8=new E,kd=class extends Lr{constructor(r){if(super(),this.matrixAutoUpdate=!1,this.collider=r,this.collider.shape instanceof Ig)this._geometry=new Q8(this.collider.shape);else if(this.collider.shape instanceof Ng)this._geometry=new Z8(this.collider.shape);else if(this.collider.shape instanceof Eg)this._geometry=new J8(this.collider.shape);else throw new Error("VRMSpringBoneColliderHelper: Unknown collider shape type detected");const t=new Pr({color:16711935,depthTest:!1,depthWrite:!1});this._line=new Kh(this._geometry,t),this.add(this._line)}dispose(){this._geometry.dispose()}updateMatrixWorld(r){this.collider.updateWorldMatrix(!0,!1),this.matrix.copy(this.collider.matrixWorld);const t=this.matrix.elements;this._geometry.worldScale=K8.set(t[0],t[1],t[2]).length(),this._geometry.update(),super.updateMatrixWorld(r)}},t7=class extends Ui{constructor(r){super(),this.worldScale=1,this._currentRadius=0,this._currentTail=new E,this._springBone=r,this._attrPos=new Kt(new Float32Array(294),3),this.setAttribute("position",this._attrPos),this._attrIndex=new Kt(new Uint16Array(194),1),this.setIndex(this._attrIndex),this._buildIndex(),this.update()}update(){let r=!1;const t=this._springBone.settings.hitRadius/this.worldScale;this._currentRadius!==t&&(this._currentRadius=t,r=!0),this._currentTail.equals(this._springBone.initialLocalChildPosition)||(this._currentTail.copy(this._springBone.initialLocalChildPosition),r=!0),r&&this._buildPosition()}_buildPosition(){for(let r=0;r<32;r++){const t=r/16*Math.PI;this._attrPos.setXYZ(r,Math.cos(t),Math.sin(t),0),this._attrPos.setXYZ(32+r,0,Math.cos(t),Math.sin(t)),this._attrPos.setXYZ(64+r,Math.sin(t),0,Math.cos(t))}this.scale(this._currentRadius,this._currentRadius,this._currentRadius),this.translate(this._currentTail.x,this._currentTail.y,this._currentTail.z),this._attrPos.setXYZ(96,0,0,0),this._attrPos.setXYZ(97,this._currentTail.x,this._currentTail.y,this._currentTail.z),this._attrPos.needsUpdate=!0}_buildIndex(){for(let r=0;r<32;r++){const t=(r+1)%32;this._attrIndex.setXY(r*2,r,t),this._attrIndex.setXY(64+r*2,32+r,32+t),this._attrIndex.setXY(128+r*2,64+r,64+t)}this._attrIndex.setXY(192,96,97),this._attrIndex.needsUpdate=!0}},e7=new E,i7=class extends Lr{constructor(r){super(),this.matrixAutoUpdate=!1,this.springBone=r,this._geometry=new t7(this.springBone);const t=new Pr({color:16776960,depthTest:!1,depthWrite:!1});this._line=new Kh(this._geometry,t),this.add(this._line)}dispose(){this._geometry.dispose()}updateMatrixWorld(r){this.springBone.bone.updateWorldMatrix(!0,!1),this.matrix.copy(this.springBone.bone.matrixWorld);const t=this.matrix.elements;this._geometry.worldScale=e7.set(t[0],t[1],t[2]).length(),this._geometry.update(),super.updateMatrixWorld(r)}},Dd=class extends ii{constructor(r){super(),this.colliderMatrix=new Ct,this.shape=r}updateWorldMatrix(r,t){super.updateWorldMatrix(r,t),s7(this.colliderMatrix,this.matrixWorld,this.shape.offset)}};function s7(r,t,e){const i=t.elements;r.copy(t),e&&(r.elements[12]=i[0]*e.x+i[4]*e.y+i[8]*e.z+i[12],r.elements[13]=i[1]*e.x+i[5]*e.y+i[9]*e.z+i[13],r.elements[14]=i[2]*e.x+i[6]*e.y+i[10]*e.z+i[14])}var n7=new Ct;function r7(r){return r.invert?r.invert():r.getInverse(n7.copy(r)),r}var a7=class{constructor(r){this._inverseCache=new Ct,this._shouldUpdateInverse=!0,this.matrix=r;const t={set:(e,i,s)=>(this._shouldUpdateInverse=!0,e[i]=s,!0)};this._originalElements=r.elements,r.elements=new Proxy(r.elements,t)}get inverse(){return this._shouldUpdateInverse&&(r7(this._inverseCache.copy(this.matrix)),this._shouldUpdateInverse=!1),this._inverseCache}revert(){this.matrix.elements=this._originalElements}},Ud=new Ct,Fr=new E,ro=new E,ao=new E,oo=new E,o7=new Ct,h7=class{constructor(r,t,e={},i=[]){this._currentTail=new E,this._prevTail=new E,this._boneAxis=new E,this._worldSpaceBoneLength=0,this._center=null,this._initialLocalMatrix=new Ct,this._initialLocalRotation=new ot,this._initialLocalChildPosition=new E;var s,n,a,o,h,l;this.bone=r,this.bone.matrixAutoUpdate=!1,this.child=t,this.settings={hitRadius:(s=e.hitRadius)!=null?s:0,stiffness:(n=e.stiffness)!=null?n:1,gravityPower:(a=e.gravityPower)!=null?a:0,gravityDir:(h=(o=e.gravityDir)==null?void 0:o.clone())!=null?h:new E(0,-1,0),dragForce:(l=e.dragForce)!=null?l:.4},this.colliderGroups=i}get dependencies(){const r=new Set,t=this.bone.parent;t&&r.add(t);for(let e=0;e<this.colliderGroups.length;e++)for(let i=0;i<this.colliderGroups[e].colliders.length;i++)r.add(this.colliderGroups[e].colliders[i]);return r}get center(){return this._center}set center(r){var t;(t=this._center)!=null&&t.userData.inverseCacheProxy&&(this._center.userData.inverseCacheProxy.revert(),delete this._center.userData.inverseCacheProxy),this._center=r,this._center&&(this._center.userData.inverseCacheProxy||(this._center.userData.inverseCacheProxy=new a7(this._center.matrixWorld)))}get initialLocalChildPosition(){return this._initialLocalChildPosition}get _parentMatrixWorld(){return this.bone.parent?this.bone.parent.matrixWorld:Ud}setInitState(){this._initialLocalMatrix.copy(this.bone.matrix),this._initialLocalRotation.copy(this.bone.quaternion),this.child?this._initialLocalChildPosition.copy(this.child.position):this._initialLocalChildPosition.copy(this.bone.position).normalize().multiplyScalar(.07);const r=this._getMatrixWorldToCenter();this.bone.localToWorld(this._currentTail.copy(this._initialLocalChildPosition)).applyMatrix4(r),this._prevTail.copy(this._currentTail),this._boneAxis.copy(this._initialLocalChildPosition).normalize()}reset(){this.bone.quaternion.copy(this._initialLocalRotation),this.bone.updateMatrix(),this.bone.matrixWorld.multiplyMatrices(this._parentMatrixWorld,this.bone.matrix);const r=this._getMatrixWorldToCenter();this.bone.localToWorld(this._currentTail.copy(this._initialLocalChildPosition)).applyMatrix4(r),this._prevTail.copy(this._currentTail)}update(r){if(r<=0)return;this._calcWorldSpaceBoneLength();const t=ro.copy(this._boneAxis).transformDirection(this._initialLocalMatrix).transformDirection(this._parentMatrixWorld);oo.copy(this._currentTail).add(Fr.subVectors(this._currentTail,this._prevTail).multiplyScalar(1-this.settings.dragForce)).applyMatrix4(this._getMatrixCenterToWorld()).addScaledVector(t,this.settings.stiffness*r).addScaledVector(this.settings.gravityDir,this.settings.gravityPower*r),ao.setFromMatrixPosition(this.bone.matrixWorld),oo.sub(ao).normalize().multiplyScalar(this._worldSpaceBoneLength).add(ao),this._collision(oo),this._prevTail.copy(this._currentTail),this._currentTail.copy(oo).applyMatrix4(this._getMatrixWorldToCenter());const e=o7.multiplyMatrices(this._parentMatrixWorld,this._initialLocalMatrix).invert();this.bone.quaternion.setFromUnitVectors(this._boneAxis,Fr.copy(oo).applyMatrix4(e).normalize()).premultiply(this._initialLocalRotation),this.bone.updateMatrix(),this.bone.matrixWorld.multiplyMatrices(this._parentMatrixWorld,this.bone.matrix)}_collision(r){for(let t=0;t<this.colliderGroups.length;t++)for(let e=0;e<this.colliderGroups[t].colliders.length;e++){const i=this.colliderGroups[t].colliders[e],s=i.shape.calculateCollision(i.colliderMatrix,r,this.settings.hitRadius,Fr);if(s<0){r.addScaledVector(Fr,-s),r.sub(ao);const n=r.length();r.multiplyScalar(this._worldSpaceBoneLength/n).add(ao)}}}_calcWorldSpaceBoneLength(){Fr.setFromMatrixPosition(this.bone.matrixWorld),this.child?ro.setFromMatrixPosition(this.child.matrixWorld):(ro.copy(this._initialLocalChildPosition),ro.applyMatrix4(this.bone.matrixWorld)),this._worldSpaceBoneLength=Fr.sub(ro).length()}_getMatrixCenterToWorld(){return this._center?this._center.matrixWorld:Ud}_getMatrixWorldToCenter(){return this._center?this._center.userData.inverseCacheProxy.inverse:Ud}};function l7(r,t){const e=[];let i=r;for(;i!==null;)e.unshift(i),i=i.parent;e.forEach(s=>{t(s)})}function Wd(r,t){r.children.forEach(e=>{t(e)||Wd(e,t)})}function u7(r){var t;const e=new Map;for(const i of r){let s=i;do{const n=((t=e.get(s))!=null?t:0)+1;if(n===r.size)return s;e.set(s,n),s=s.parent}while(s!==null)}return null}var Cg=class{constructor(){this._joints=new Set,this._sortedJoints=[],this._hasWarnedCircularDependency=!1,this._ancestors=[],this._objectSpringBonesMap=new Map,this._isSortedJointsDirty=!1,this._relevantChildrenUpdated=this._relevantChildrenUpdated.bind(this)}get joints(){return this._joints}get springBones(){return this._joints}get colliderGroups(){const r=new Set;return this._joints.forEach(t=>{t.colliderGroups.forEach(e=>{r.add(e)})}),Array.from(r)}get colliders(){const r=new Set;return this.colliderGroups.forEach(t=>{t.colliders.forEach(e=>{r.add(e)})}),Array.from(r)}addJoint(r){this._joints.add(r);let t=this._objectSpringBonesMap.get(r.bone);t==null&&(t=new Set,this._objectSpringBonesMap.set(r.bone,t)),t.add(r),this._isSortedJointsDirty=!0}addSpringBone(r){this.addJoint(r)}deleteJoint(r){this._joints.delete(r),this._objectSpringBonesMap.get(r.bone).delete(r),this._isSortedJointsDirty=!0}deleteSpringBone(r){this.deleteJoint(r)}setInitState(){this._sortJoints();for(let r=0;r<this._sortedJoints.length;r++){const t=this._sortedJoints[r];t.bone.updateMatrix(),t.bone.updateWorldMatrix(!1,!1),t.setInitState()}}reset(){this._sortJoints();for(let r=0;r<this._sortedJoints.length;r++){const t=this._sortedJoints[r];t.bone.updateMatrix(),t.bone.updateWorldMatrix(!1,!1),t.reset()}}update(r){this._sortJoints();for(let t=0;t<this._ancestors.length;t++)this._ancestors[t].updateWorldMatrix(t===0,!1);for(let t=0;t<this._sortedJoints.length;t++){const e=this._sortedJoints[t];e.bone.updateMatrix(),e.bone.updateWorldMatrix(!1,!1),e.update(r),Wd(e.bone,this._relevantChildrenUpdated)}}_sortJoints(){if(!this._isSortedJointsDirty)return;const r=[],t=new Set,e=new Set,i=new Set;for(const n of this._joints)this._insertJointSort(n,t,e,r,i);this._sortedJoints=r;const s=u7(i);this._ancestors=[],s&&(this._ancestors.push(s),Wd(s,n=>{var a,o;return((o=(a=this._objectSpringBonesMap.get(n))==null?void 0:a.size)!=null?o:0)>0?!0:(this._ancestors.push(n),!1)})),this._isSortedJointsDirty=!1}_insertJointSort(r,t,e,i,s){if(e.has(r))return;if(t.has(r)){this._hasWarnedCircularDependency||(this._hasWarnedCircularDependency=!0);return}t.add(r);const n=r.dependencies;for(const a of n){let o=!1,h=null;l7(a,l=>{const u=this._objectSpringBonesMap.get(l);if(u)for(const c of u)o=!0,this._insertJointSort(c,t,e,i,s);else o||(h=l)}),h&&s.add(h)}i.push(r),e.add(r)}_relevantChildrenUpdated(r){var t,e;return((e=(t=this._objectSpringBonesMap.get(r))==null?void 0:t.size)!=null?e:0)>0?!0:(r.updateWorldMatrix(!1,!1),!1)}},c7="VRMC_springBone_extended_collider",d7=new Set(["1.0","1.0-beta"]),p7=new Set(["1.0"]),zg=class Xl{get name(){return Xl.EXTENSION_NAME}constructor(t,e){var i;this.parser=t,this.jointHelperRoot=e?.jointHelperRoot,this.colliderHelperRoot=e?.colliderHelperRoot,this.useExtendedColliders=(i=e?.useExtendedColliders)!=null?i:!0}afterRoot(t){return al(this,null,function*(){t.userData.vrmSpringBoneManager=yield this._import(t)})}_import(t){return al(this,null,function*(){const e=yield this._v1Import(t);if(e!=null)return e;const i=yield this._v0Import(t);return i??null})}_v1Import(t){return al(this,null,function*(){var e,i,s,n,a;const o=t.parser.json;if(!(((e=o.extensionsUsed)==null?void 0:e.indexOf(Xl.EXTENSION_NAME))!==-1))return null;const l=new Cg,u=yield t.parser.getDependencies("node"),c=(i=o.extensions)==null?void 0:i[Xl.EXTENSION_NAME];if(!c)return null;const d=c.specVersion;if(!d7.has(d))return null;const p=(s=c.colliders)==null?void 0:s.map((f,g)=>{var y,x,_,M,v,N,T,C,P,F,D,q,X,it,mt;const xt=u[f.node];if(xt==null)return null;const Q=f.shape,gt=(y=f.extensions)==null?void 0:y[c7];if(this.useExtendedColliders&&gt!=null){const st=gt.specVersion;if(p7.has(st)){const rt=gt.shape;if(rt.sphere)return this._importSphereCollider(xt,{offset:new E().fromArray((x=rt.sphere.offset)!=null?x:[0,0,0]),radius:(_=rt.sphere.radius)!=null?_:0,inside:(M=rt.sphere.inside)!=null?M:!1});if(rt.capsule)return this._importCapsuleCollider(xt,{offset:new E().fromArray((v=rt.capsule.offset)!=null?v:[0,0,0]),radius:(N=rt.capsule.radius)!=null?N:0,tail:new E().fromArray((T=rt.capsule.tail)!=null?T:[0,0,0]),inside:(C=rt.capsule.inside)!=null?C:!1});if(rt.plane)return this._importPlaneCollider(xt,{offset:new E().fromArray((P=rt.plane.offset)!=null?P:[0,0,0]),normal:new E().fromArray((F=rt.plane.normal)!=null?F:[0,0,1])})}}if(Q.sphere)return this._importSphereCollider(xt,{offset:new E().fromArray((D=Q.sphere.offset)!=null?D:[0,0,0]),radius:(q=Q.sphere.radius)!=null?q:0,inside:!1});if(Q.capsule)return this._importCapsuleCollider(xt,{offset:new E().fromArray((X=Q.capsule.offset)!=null?X:[0,0,0]),radius:(it=Q.capsule.radius)!=null?it:0,tail:new E().fromArray((mt=Q.capsule.tail)!=null?mt:[0,0,0]),inside:!1});throw new Error(`VRMSpringBoneLoaderPlugin: The collider #${g} has no valid shape`)}),m=(n=c.colliderGroups)==null?void 0:n.map((f,g)=>{var y;return{colliders:((y=f.colliders)!=null?y:[]).flatMap(_=>{const M=p?.[_];return M??[]}),name:f.name}});return(a=c.springs)==null||a.forEach((f,g)=>{var y;const x=f.joints,_=(y=f.colliderGroups)==null?void 0:y.map(N=>{const T=m?.[N];if(T==null)throw new Error(`VRMSpringBoneLoaderPlugin: The spring #${g} attempted to use a colliderGroup ${N} but not found`);return T}),M=f.center!=null?u[f.center]:void 0;let v;x.forEach(N=>{if(v){const T=v.node,C=u[T],P=N.node,F=u[P],D={hitRadius:v.hitRadius,dragForce:v.dragForce,gravityPower:v.gravityPower,stiffness:v.stiffness,gravityDir:v.gravityDir!=null?new E().fromArray(v.gravityDir):void 0},q=this._importJoint(C,F,D,_);M&&(q.center=M),l.addJoint(q)}v=N})}),l.setInitState(),l})}_v0Import(t){return al(this,null,function*(){var e,i,s;const n=t.parser.json;if(!(((e=n.extensionsUsed)==null?void 0:e.indexOf("VRM"))!==-1))return null;const o=(i=n.extensions)==null?void 0:i.VRM,h=o?.secondaryAnimation;if(!h)return null;const l=h?.boneGroups;if(!l)return null;const u=new Cg,c=yield t.parser.getDependencies("node"),d=(s=h.colliderGroups)==null?void 0:s.map(p=>{var m;const f=c[p.node];return{colliders:((m=p.colliders)!=null?m:[]).map((y,x)=>{var _,M,v;const N=new E(0,0,0);return y.offset&&N.set((_=y.offset.x)!=null?_:0,(M=y.offset.y)!=null?M:0,y.offset.z?-y.offset.z:0),this._importSphereCollider(f,{offset:N,radius:(v=y.radius)!=null?v:0,inside:!1})})}});return l?.forEach((p,m)=>{const f=p.bones;f&&f.forEach(g=>{var y,x,_,M;const v=c[g],N=new E;p.gravityDir?N.set((y=p.gravityDir.x)!=null?y:0,(x=p.gravityDir.y)!=null?x:0,(_=p.gravityDir.z)!=null?_:0):N.set(0,-1,0);const T=p.center!=null?c[p.center]:void 0,C={hitRadius:p.hitRadius,dragForce:p.dragForce,gravityPower:p.gravityPower,stiffness:p.stiffiness,gravityDir:N},P=(M=p.colliderGroups)==null?void 0:M.map(F=>{const D=d?.[F];if(D==null)throw new Error(`VRMSpringBoneLoaderPlugin: The spring #${m} attempted to use a colliderGroup ${F} but not found`);return D});v.traverse(F=>{var D;const q=(D=F.children[0])!=null?D:null,X=this._importJoint(F,q,C,P);T&&(X.center=T),u.addJoint(X)})})}),t.scene.updateMatrixWorld(),u.setInitState(),u})}_importJoint(t,e,i,s){const n=new h7(t,e,i,s);if(this.jointHelperRoot){const a=new i7(n);this.jointHelperRoot.add(a),a.renderOrder=this.jointHelperRoot.renderOrder}return n}_importSphereCollider(t,e){const i=new Ig(e),s=new Dd(i);if(t.add(s),this.colliderHelperRoot){const n=new kd(s);this.colliderHelperRoot.add(n),n.renderOrder=this.colliderHelperRoot.renderOrder}return s}_importCapsuleCollider(t,e){const i=new Ng(e),s=new Dd(i);if(t.add(s),this.colliderHelperRoot){const n=new kd(s);this.colliderHelperRoot.add(n),n.renderOrder=this.colliderHelperRoot.renderOrder}return s}_importPlaneCollider(t,e){const i=new Eg(e),s=new Dd(i);if(t.add(s),this.colliderHelperRoot){const n=new kd(s);this.colliderHelperRoot.add(n),n.renderOrder=this.colliderHelperRoot.renderOrder}return s}};zg.EXTENSION_NAME="VRMC_springBone";var m7=zg,f7=class{get name(){return"VRMLoaderPlugin"}constructor(r,t){var e,i,s,n,a,o,h,l,u,c;this.parser=r;const d=t?.helperRoot,p=t?.autoUpdateHumanBones;this.expressionPlugin=(e=t?.expressionPlugin)!=null?e:new I_(r),this.firstPersonPlugin=(i=t?.firstPersonPlugin)!=null?i:new z_(r),this.humanoidPlugin=(s=t?.humanoidPlugin)!=null?s:new k_(r,{helperRoot:d,autoUpdateHumanBones:p}),this.lookAtPlugin=(n=t?.lookAtPlugin)!=null?n:new t8(r,{helperRoot:d}),this.metaPlugin=(a=t?.metaPlugin)!=null?a:new s8(r),this.mtoonMaterialPlugin=(o=t?.mtoonMaterialPlugin)!=null?o:new x8(r),this.materialsHDREmissiveMultiplierPlugin=(h=t?.materialsHDREmissiveMultiplierPlugin)!=null?h:new M8(r),this.materialsV0CompatPlugin=(l=t?.materialsV0CompatPlugin)!=null?l:new N8(r),this.springBonePlugin=(u=t?.springBonePlugin)!=null?u:new m7(r,{colliderHelperRoot:d,jointHelperRoot:d}),this.nodeConstraintPlugin=(c=t?.nodeConstraintPlugin)!=null?c:new G8(r,{helperRoot:d})}beforeRoot(){return tl(this,null,function*(){yield this.materialsV0CompatPlugin.beforeRoot(),yield this.mtoonMaterialPlugin.beforeRoot()})}loadMesh(r){return tl(this,null,function*(){return yield this.mtoonMaterialPlugin.loadMesh(r)})}getMaterialType(r){const t=this.mtoonMaterialPlugin.getMaterialType(r);return t??null}extendMaterialParams(r,t){return tl(this,null,function*(){yield this.materialsHDREmissiveMultiplierPlugin.extendMaterialParams(r,t),yield this.mtoonMaterialPlugin.extendMaterialParams(r,t)})}afterRoot(r){return tl(this,null,function*(){yield this.metaPlugin.afterRoot(r),yield this.humanoidPlugin.afterRoot(r),yield this.expressionPlugin.afterRoot(r),yield this.lookAtPlugin.afterRoot(r),yield this.firstPersonPlugin.afterRoot(r),yield this.springBonePlugin.afterRoot(r),yield this.nodeConstraintPlugin.afterRoot(r),yield this.mtoonMaterialPlugin.afterRoot(r);const t=r.userData.vrmMeta,e=r.userData.vrmHumanoid;if(t&&e){const i=new r8({scene:r.scene,expressionManager:r.userData.vrmExpressionManager,firstPerson:r.userData.vrmFirstPerson,humanoid:e,lookAt:r.userData.vrmLookAt,meta:t,materials:r.userData.vrmMToonMaterials,springBoneManager:r.userData.vrmSpringBoneManager,nodeConstraintManager:r.userData.vrmNodeConstraintManager});r.userData.vrm=i}})}};/*!
 * @pixiv/three-vrm-core v3.4.2
 * The implementation of core features of VRM, for @pixiv/three-vrm
 *
 * Copyright (c) 2019-2025 pixiv Inc.
 * @pixiv/three-vrm-core is distributed under MIT License
 * https://github.com/pixiv/three-vrm/blob/release/LICENSE
 *//*!
 * @pixiv/three-vrm-materials-mtoon v3.4.2
 * MToon (toon material) module for @pixiv/three-vrm
 *
 * Copyright (c) 2019-2025 pixiv Inc.
 * @pixiv/three-vrm-materials-mtoon is distributed under MIT License
 * https://github.com/pixiv/three-vrm/blob/release/LICENSE
 *//*!
 * @pixiv/three-vrm-materials-hdr-emissive-multiplier v3.4.2
 * Support VRMC_hdr_emissiveMultiplier for @pixiv/three-vrm
 *
 * Copyright (c) 2019-2025 pixiv Inc.
 * @pixiv/three-vrm-materials-hdr-emissive-multiplier is distributed under MIT License
 * https://github.com/pixiv/three-vrm/blob/release/LICENSE
 *//*!
 * @pixiv/three-vrm-materials-v0compat v3.4.2
 * VRM0.0 materials compatibility layer plugin for @pixiv/three-vrm
 *
 * Copyright (c) 2019-2025 pixiv Inc.
 * @pixiv/three-vrm-materials-v0compat is distributed under MIT License
 * https://github.com/pixiv/three-vrm/blob/release/LICENSE
 *//*!
 * @pixiv/three-vrm-node-constraint v3.4.2
 * Node constraint module for @pixiv/three-vrm
 *
 * Copyright (c) 2019-2025 pixiv Inc.
 * @pixiv/three-vrm-node-constraint is distributed under MIT License
 * https://github.com/pixiv/three-vrm/blob/release/LICENSE
 *//*!
 * @pixiv/three-vrm-springbone v3.4.2
 * Spring bone module for @pixiv/three-vrm
 *
 * Copyright (c) 2019-2025 pixiv Inc.
 * @pixiv/three-vrm-springbone is distributed under MIT License
 * https://github.com/pixiv/three-vrm/blob/release/LICENSE
 */const Hd=0,g7=1,Lg=1,Pg=100,Bg=204,Og=205,Vg=3,y7=0,Fg="attached",x7="detached",kg=300,Dg=1e3,ol=1001,Ug=1002,hl=1003,b7=1006,M7=1008,_7=1009,Wg=1015,v7=1016,qd=1023,ll=2300,$d=2301,Xd=2302,Hg=2400,qg=2401,$g=2402,w7=2500,Xg="",Ti="srgb",jg="srgb-linear",Gg="linear",jd="srgb",kr=7680,Yg=519,Gd=35044,ul=2e3,Zg=2001;function T7(r){for(let t=r.length-1;t>=0;--t)if(r[t]>=65535)return!0;return!1}const S7={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function cl(r,t){return new S7[r](t)}function Jg(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}const Qg={};function Kg(...r){const t="THREE."+r.shift()}function Wt(...r){const t="THREE."+r.shift()}function Ce(...r){const t="THREE."+r.shift()}function t9(...r){const t=r.join(" ");t in Qg||(Qg[t]=!0,Wt(...r))}class dl{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(e)===-1&&i[t].push(e)}hasEventListener(t,e){const i=this._listeners;return i===void 0?!1:i[t]!==void 0&&i[t].indexOf(e)!==-1}removeEventListener(t,e){const i=this._listeners;if(i===void 0)return;const s=i[t];if(s!==void 0){const n=s.indexOf(e);n!==-1&&s.splice(n,1)}}dispatchEvent(t){const e=this._listeners;if(e===void 0)return;const i=e[t.type];if(i!==void 0){t.target=this;const s=i.slice(0);for(let n=0,a=s.length;n<a;n++)s[n].call(this,t);t.target=null}}}const xe=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function $i(){const r=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(xe[r&255]+xe[r>>8&255]+xe[r>>16&255]+xe[r>>24&255]+"-"+xe[t&255]+xe[t>>8&255]+"-"+xe[t>>16&15|64]+xe[t>>24&255]+"-"+xe[e&63|128]+xe[e>>8&255]+"-"+xe[e>>16&255]+xe[e>>24&255]+xe[i&255]+xe[i>>8&255]+xe[i>>16&255]+xe[i>>24&255]).toLowerCase()}function dt(r,t,e){return Math.max(t,Math.min(e,r))}function A7(r,t){return(r%t+t)%t}function Yd(r,t,e){return(1-e)*r+e*t}function Xi(r,t){switch(t.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function St(r,t){switch(t.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}class Si{constructor(t=0,e=0){Si.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6],this.y=s[1]*e+s[4]*i+s[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=dt(this.x,t.x,e.x),this.y=dt(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=dt(this.x,t,e),this.y=dt(this.y,t,e),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(dt(i,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(dt(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),s=Math.sin(e),n=this.x-t.x,a=this.y-t.y;return this.x=n*i-a*s+t.x,this.y=n*s+a*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Dr{constructor(t=0,e=0,i=0,s=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=s}static slerpFlat(t,e,i,s,n,a,o){let h=i[s+0],l=i[s+1],u=i[s+2],c=i[s+3];const d=n[a+0],p=n[a+1],m=n[a+2],f=n[a+3];if(o===0){t[e+0]=h,t[e+1]=l,t[e+2]=u,t[e+3]=c;return}if(o===1){t[e+0]=d,t[e+1]=p,t[e+2]=m,t[e+3]=f;return}if(c!==f||h!==d||l!==p||u!==m){let g=1-o;const y=h*d+l*p+u*m+c*f,x=y>=0?1:-1,_=1-y*y;if(_>Number.EPSILON){const v=Math.sqrt(_),N=Math.atan2(v,y*x);g=Math.sin(g*N)/v,o=Math.sin(o*N)/v}const M=o*x;if(h=h*g+d*M,l=l*g+p*M,u=u*g+m*M,c=c*g+f*M,g===1-o){const v=1/Math.sqrt(h*h+l*l+u*u+c*c);h*=v,l*=v,u*=v,c*=v}}t[e]=h,t[e+1]=l,t[e+2]=u,t[e+3]=c}static multiplyQuaternionsFlat(t,e,i,s,n,a){const o=i[s],h=i[s+1],l=i[s+2],u=i[s+3],c=n[a],d=n[a+1],p=n[a+2],m=n[a+3];return t[e]=o*m+u*c+h*p-l*d,t[e+1]=h*m+u*d+l*c-o*p,t[e+2]=l*m+u*p+o*d-h*c,t[e+3]=u*m-o*c-h*d-l*p,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,s){return this._x=t,this._y=e,this._z=i,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const i=t._x,s=t._y,n=t._z,a=t._order,o=Math.cos,h=Math.sin,l=o(i/2),u=o(s/2),c=o(n/2),d=h(i/2),p=h(s/2),m=h(n/2);switch(a){case"XYZ":this._x=d*u*c+l*p*m,this._y=l*p*c-d*u*m,this._z=l*u*m+d*p*c,this._w=l*u*c-d*p*m;break;case"YXZ":this._x=d*u*c+l*p*m,this._y=l*p*c-d*u*m,this._z=l*u*m-d*p*c,this._w=l*u*c+d*p*m;break;case"ZXY":this._x=d*u*c-l*p*m,this._y=l*p*c+d*u*m,this._z=l*u*m+d*p*c,this._w=l*u*c-d*p*m;break;case"ZYX":this._x=d*u*c-l*p*m,this._y=l*p*c+d*u*m,this._z=l*u*m-d*p*c,this._w=l*u*c+d*p*m;break;case"YZX":this._x=d*u*c+l*p*m,this._y=l*p*c+d*u*m,this._z=l*u*m-d*p*c,this._w=l*u*c-d*p*m;break;case"XZY":this._x=d*u*c-l*p*m,this._y=l*p*c-d*u*m,this._z=l*u*m+d*p*c,this._w=l*u*c+d*p*m;break;default:Wt("Quaternion: .setFromEuler() encountered an unknown order: "+a)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,s=Math.sin(i);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],s=e[4],n=e[8],a=e[1],o=e[5],h=e[9],l=e[2],u=e[6],c=e[10],d=i+o+c;if(d>0){const p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(u-h)*p,this._y=(n-l)*p,this._z=(a-s)*p}else if(i>o&&i>c){const p=2*Math.sqrt(1+i-o-c);this._w=(u-h)/p,this._x=.25*p,this._y=(s+a)/p,this._z=(n+l)/p}else if(o>c){const p=2*Math.sqrt(1+o-i-c);this._w=(n-l)/p,this._x=(s+a)/p,this._y=.25*p,this._z=(h+u)/p}else{const p=2*Math.sqrt(1+c-i-o);this._w=(a-s)/p,this._x=(n+l)/p,this._y=(h+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<1e-8?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(dt(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(i===0)return this;const s=Math.min(1,e/i);return this.slerp(t,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,s=t._y,n=t._z,a=t._w,o=e._x,h=e._y,l=e._z,u=e._w;return this._x=i*u+a*o+s*l-n*h,this._y=s*u+a*h+n*o-i*l,this._z=n*u+a*l+i*h-s*o,this._w=a*u-i*o-s*h-n*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const i=this._x,s=this._y,n=this._z,a=this._w;let o=a*t._w+i*t._x+s*t._y+n*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=a,this._x=i,this._y=s,this._z=n,this;const h=1-o*o;if(h<=Number.EPSILON){const p=1-e;return this._w=p*a+e*this._w,this._x=p*i+e*this._x,this._y=p*s+e*this._y,this._z=p*n+e*this._z,this.normalize(),this}const l=Math.sqrt(h),u=Math.atan2(l,o),c=Math.sin((1-e)*u)/l,d=Math.sin(e*u)/l;return this._w=a*c+this._w*d,this._x=i*c+this._x*d,this._y=s*c+this._y*d,this._z=n*c+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),i=Math.random(),s=Math.sqrt(1-i),n=Math.sqrt(i);return this.set(s*Math.sin(t),s*Math.cos(t),n*Math.sin(e),n*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class O{constructor(t=0,e=0,i=0){O.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return i===void 0&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(e9.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(e9.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,s=this.z,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6]*s,this.y=n[1]*e+n[4]*i+n[7]*s,this.z=n[2]*e+n[5]*i+n[8]*s,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,n=t.elements,a=1/(n[3]*e+n[7]*i+n[11]*s+n[15]);return this.x=(n[0]*e+n[4]*i+n[8]*s+n[12])*a,this.y=(n[1]*e+n[5]*i+n[9]*s+n[13])*a,this.z=(n[2]*e+n[6]*i+n[10]*s+n[14])*a,this}applyQuaternion(t){const e=this.x,i=this.y,s=this.z,n=t.x,a=t.y,o=t.z,h=t.w,l=2*(a*s-o*i),u=2*(o*e-n*s),c=2*(n*i-a*e);return this.x=e+h*l+a*c-o*u,this.y=i+h*u+o*l-n*c,this.z=s+h*c+n*u-a*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,s=this.z,n=t.elements;return this.x=n[0]*e+n[4]*i+n[8]*s,this.y=n[1]*e+n[5]*i+n[9]*s,this.z=n[2]*e+n[6]*i+n[10]*s,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=dt(this.x,t.x,e.x),this.y=dt(this.y,t.y,e.y),this.z=dt(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=dt(this.x,t,e),this.y=dt(this.y,t,e),this.z=dt(this.z,t,e),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(dt(i,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,s=t.y,n=t.z,a=e.x,o=e.y,h=e.z;return this.x=s*h-n*o,this.y=n*a-i*h,this.z=i*o-s*a,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return Zd.copy(this).projectOnVector(t),this.sub(Zd)}reflect(t){return this.sub(Zd.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(dt(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,s=this.z-t.z;return e*e+i*i+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const s=Math.sin(e)*t;return this.x=s*Math.sin(i),this.y=Math.cos(e)*t,this.z=s*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),s=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=s,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=Math.random()*2-1,i=Math.sqrt(1-e*e);return this.x=i*Math.cos(t),this.y=e,this.z=i*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Zd=new O,e9=new Dr;class Gs{constructor(t,e,i,s,n,a,o,h,l){Gs.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,i,s,n,a,o,h,l)}set(t,e,i,s,n,a,o,h,l){const u=this.elements;return u[0]=t,u[1]=s,u[2]=o,u[3]=e,u[4]=n,u[5]=h,u[6]=i,u[7]=a,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,n=this.elements,a=i[0],o=i[3],h=i[6],l=i[1],u=i[4],c=i[7],d=i[2],p=i[5],m=i[8],f=s[0],g=s[3],y=s[6],x=s[1],_=s[4],M=s[7],v=s[2],N=s[5],T=s[8];return n[0]=a*f+o*x+h*v,n[3]=a*g+o*_+h*N,n[6]=a*y+o*M+h*T,n[1]=l*f+u*x+c*v,n[4]=l*g+u*_+c*N,n[7]=l*y+u*M+c*T,n[2]=d*f+p*x+m*v,n[5]=d*g+p*_+m*N,n[8]=d*y+p*M+m*T,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],s=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=t[8];return e*a*u-e*o*l-i*n*u+i*o*h+s*n*l-s*a*h}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=t[8],c=u*a-o*l,d=o*h-u*n,p=l*n-a*h,m=e*c+i*d+s*p;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const f=1/m;return t[0]=c*f,t[1]=(s*l-u*i)*f,t[2]=(o*i-s*a)*f,t[3]=d*f,t[4]=(u*e-s*h)*f,t[5]=(s*n-o*e)*f,t[6]=p*f,t[7]=(i*h-l*e)*f,t[8]=(a*e-i*n)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,s,n,a,o){const h=Math.cos(n),l=Math.sin(n);return this.set(i*h,i*l,-i*(h*a+l*o)+a+t,-s*l,s*h,-s*(-l*a+h*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(Jd.makeScale(t,e)),this}rotate(t){return this.premultiply(Jd.makeRotation(-t)),this}translate(t,e){return this.premultiply(Jd.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,i=t.elements;for(let s=0;s<9;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Jd=new Gs,i9=new Gs().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),s9=new Gs().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function N7(){const r={enabled:!0,workingColorSpace:jg,spaces:{},convert:function(s,n,a){return this.enabled===!1||n===a||!n||!a||(this.spaces[n].transfer===jd&&(s.r=ms(s.r),s.g=ms(s.g),s.b=ms(s.b)),this.spaces[n].primaries!==this.spaces[a].primaries&&(s.applyMatrix3(this.spaces[n].toXYZ),s.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===jd&&(s.r=Ur(s.r),s.g=Ur(s.g),s.b=Ur(s.b))),s},workingToColorSpace:function(s,n){return this.convert(s,this.workingColorSpace,n)},colorSpaceToWorking:function(s,n){return this.convert(s,n,this.workingColorSpace)},getPrimaries:function(s){return this.spaces[s].primaries},getTransfer:function(s){return s===Xg?Gg:this.spaces[s].transfer},getToneMappingMode:function(s){return this.spaces[s].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(s,n=this.workingColorSpace){return s.fromArray(this.spaces[n].luminanceCoefficients)},define:function(s){Object.assign(this.spaces,s)},_getMatrix:function(s,n,a){return s.copy(this.spaces[n].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(s){return this.spaces[s].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(s=this.workingColorSpace){return this.spaces[s].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(s,n){return t9("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),r.workingToColorSpace(s,n)},toWorkingColorSpace:function(s,n){return t9("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),r.colorSpaceToWorking(s,n)}},t=[.64,.33,.3,.6,.15,.06],e=[.2126,.7152,.0722],i=[.3127,.329];return r.define({[jg]:{primaries:t,whitePoint:i,transfer:Gg,toXYZ:i9,fromXYZ:s9,luminanceCoefficients:e,workingColorSpaceConfig:{unpackColorSpace:Ti},outputColorSpaceConfig:{drawingBufferColorSpace:Ti}},[Ti]:{primaries:t,whitePoint:i,transfer:jd,toXYZ:i9,fromXYZ:s9,luminanceCoefficients:e,outputColorSpaceConfig:{drawingBufferColorSpace:Ti}}}),r}const Ai=N7();function ms(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function Ur(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}let Wr;class R7{static getDataURL(t,e="image/png"){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let i;if(t instanceof HTMLCanvasElement)i=t;else{Wr===void 0&&(Wr=Jg("canvas")),Wr.width=t.width,Wr.height=t.height;const s=Wr.getContext("2d");t instanceof ImageData?s.putImageData(t,0,0):s.drawImage(t,0,0,t.width,t.height),i=Wr}return i.toDataURL(e)}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=Jg("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const s=i.getImageData(0,0,t.width,t.height),n=s.data;for(let a=0;a<n.length;a++)n[a]=ms(n[a]/255)*255;return i.putImageData(s,0,0),e}else if(t.data){const e=t.data.slice(0);for(let i=0;i<e.length;i++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[i]=Math.floor(ms(e[i]/255)*255):e[i]=ms(e[i]);return{data:e,width:t.width,height:t.height}}else return Wt("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let E7=0;class I7{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:E7++}),this.uuid=$i(),this.data=t,this.dataReady=!0,this.version=0}getSize(t){const e=this.data;return typeof HTMLVideoElement<"u"&&e instanceof HTMLVideoElement?t.set(e.videoWidth,e.videoHeight,0):e instanceof VideoFrame?t.set(e.displayHeight,e.displayWidth,0):e!==null?t.set(e.width,e.height,e.depth||0):t.set(0,0,0),t}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const i={uuid:this.uuid,url:""},s=this.data;if(s!==null){let n;if(Array.isArray(s)){n=[];for(let a=0,o=s.length;a<o;a++)s[a].isDataTexture?n.push(Qd(s[a].image)):n.push(Qd(s[a]))}else n=Qd(s);i.url=n}return e||(t.images[this.uuid]=i),i}}function Qd(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?R7.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(Wt("Texture: Unable to serialize Texture."),{})}let C7=0;const Kd=new O;class Ys extends dl{constructor(t=Ys.DEFAULT_IMAGE,e=Ys.DEFAULT_MAPPING,i=ol,s=ol,n=b7,a=M7,o=qd,h=_7,l=Ys.DEFAULT_ANISOTROPY,u=Xg){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:C7++}),this.uuid=$i(),this.name="",this.source=new I7(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=i,this.wrapT=s,this.magFilter=n,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=h,this.offset=new Si(0,0),this.repeat=new Si(1,1),this.center=new Si(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Gs,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(t&&t.depth&&t.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(Kd).x}get height(){return this.source.getSize(Kd).y}get depth(){return this.source.getSize(Kd).z}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.isArrayTexture=t.isArrayTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}setValues(t){for(const e in t){const i=t[e];if(i===void 0){Wt(`Texture.setValues(): parameter '${e}' has value of undefined.`);continue}const s=this[e];if(s===void 0){Wt(`Texture.setValues(): property '${e}' does not exist.`);continue}s&&i&&s.isVector2&&i.isVector2||s&&i&&s.isVector3&&i.isVector3||s&&i&&s.isMatrix3&&i.isMatrix3?s.copy(i):this[e]=i}}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const i={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==kg)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Dg:t.x=t.x-Math.floor(t.x);break;case ol:t.x=t.x<0?0:1;break;case Ug:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Dg:t.y=t.y-Math.floor(t.y);break;case ol:t.y=t.y<0?0:1;break;case Ug:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}Ys.DEFAULT_IMAGE=null,Ys.DEFAULT_MAPPING=kg,Ys.DEFAULT_ANISOTROPY=1;class Zs{constructor(t=0,e=0,i=0,s=1){Zs.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=s}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,s){return this.x=t,this.y=e,this.z=i,this.w=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,s=this.z,n=this.w,a=t.elements;return this.x=a[0]*e+a[4]*i+a[8]*s+a[12]*n,this.y=a[1]*e+a[5]*i+a[9]*s+a[13]*n,this.z=a[2]*e+a[6]*i+a[10]*s+a[14]*n,this.w=a[3]*e+a[7]*i+a[11]*s+a[15]*n,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,s,n;const h=t.elements,l=h[0],u=h[4],c=h[8],d=h[1],p=h[5],m=h[9],f=h[2],g=h[6],y=h[10];if(Math.abs(u-d)<.01&&Math.abs(c-f)<.01&&Math.abs(m-g)<.01){if(Math.abs(u+d)<.1&&Math.abs(c+f)<.1&&Math.abs(m+g)<.1&&Math.abs(l+p+y-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const _=(l+1)/2,M=(p+1)/2,v=(y+1)/2,N=(u+d)/4,T=(c+f)/4,C=(m+g)/4;return _>M&&_>v?_<.01?(i=0,s=.707106781,n=.707106781):(i=Math.sqrt(_),s=N/i,n=T/i):M>v?M<.01?(i=.707106781,s=0,n=.707106781):(s=Math.sqrt(M),i=N/s,n=C/s):v<.01?(i=.707106781,s=.707106781,n=0):(n=Math.sqrt(v),i=T/n,s=C/n),this.set(i,s,n,e),this}let x=Math.sqrt((g-m)*(g-m)+(c-f)*(c-f)+(d-u)*(d-u));return Math.abs(x)<.001&&(x=1),this.x=(g-m)/x,this.y=(c-f)/x,this.z=(d-u)/x,this.w=Math.acos((l+p+y-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=dt(this.x,t.x,e.x),this.y=dt(this.y,t.y,e.y),this.z=dt(this.z,t.z,e.z),this.w=dt(this.w,t.w,e.w),this}clampScalar(t,e){return this.x=dt(this.x,t,e),this.y=dt(this.y,t,e),this.z=dt(this.z,t,e),this.w=dt(this.w,t,e),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(dt(i,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Hr{constructor(t=new O(1/0,1/0,1/0),e=new O(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e+=3)this.expandByPoint(Ni.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,i=t.count;e<i;e++)this.expandByPoint(Ni.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=Ni.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(i!==void 0){const n=i.getAttribute("position");if(e===!0&&n!==void 0&&t.isInstancedMesh!==!0)for(let a=0,o=n.count;a<o;a++)t.isMesh===!0?t.getVertexPosition(a,Ni):Ni.fromBufferAttribute(n,a),Ni.applyMatrix4(t.matrixWorld),this.expandByPoint(Ni);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),pl.copy(t.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),pl.copy(i.boundingBox)),pl.applyMatrix4(t.matrixWorld),this.union(pl)}const s=t.children;for(let n=0,a=s.length;n<a;n++)this.expandByObject(s[n],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Ni),Ni.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(ho),ml.subVectors(this.max,ho),qr.subVectors(t.a,ho),$r.subVectors(t.b,ho),Xr.subVectors(t.c,ho),Js.subVectors($r,qr),Qs.subVectors(Xr,$r),Bn.subVectors(qr,Xr);let e=[0,-Js.z,Js.y,0,-Qs.z,Qs.y,0,-Bn.z,Bn.y,Js.z,0,-Js.x,Qs.z,0,-Qs.x,Bn.z,0,-Bn.x,-Js.y,Js.x,0,-Qs.y,Qs.x,0,-Bn.y,Bn.x,0];return!t0(e,qr,$r,Xr,ml)||(e=[1,0,0,0,1,0,0,0,1],!t0(e,qr,$r,Xr,ml))?!1:(fl.crossVectors(Js,Qs),e=[fl.x,fl.y,fl.z],t0(e,qr,$r,Xr,ml))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Ni).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(Ni).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(fs[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),fs[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),fs[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),fs[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),fs[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),fs[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),fs[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),fs[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(fs),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(t){return this.min.fromArray(t.min),this.max.fromArray(t.max),this}}const fs=[new O,new O,new O,new O,new O,new O,new O,new O],Ni=new O,pl=new Hr,qr=new O,$r=new O,Xr=new O,Js=new O,Qs=new O,Bn=new O,ho=new O,ml=new O,fl=new O,On=new O;function t0(r,t,e,i,s){for(let n=0,a=r.length-3;n<=a;n+=3){On.fromArray(r,n);const o=s.x*Math.abs(On.x)+s.y*Math.abs(On.y)+s.z*Math.abs(On.z),h=t.dot(On),l=e.dot(On),u=i.dot(On);if(Math.max(-Math.max(h,l,u),Math.min(h,l,u))>o)return!1}return!0}const z7=new Hr,lo=new O,e0=new O;class uo{constructor(t=new O,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;e!==void 0?i.copy(e):z7.setFromPoints(t).getCenter(i);let s=0;for(let n=0,a=t.length;n<a;n++)s=Math.max(s,i.distanceToSquared(t[n]));return this.radius=Math.sqrt(s),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;lo.subVectors(t,this.center);const e=lo.lengthSq();if(e>this.radius*this.radius){const i=Math.sqrt(e),s=(i-this.radius)*.5;this.center.addScaledVector(lo,s/i),this.radius+=s}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(e0.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(lo.copy(t.center).add(e0)),this.expandByPoint(lo.copy(t.center).sub(e0))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(t){return this.radius=t.radius,this.center.fromArray(t.center),this}}const gs=new O,i0=new O,gl=new O,Ks=new O,s0=new O,yl=new O,n0=new O;class n9{constructor(t=new O,e=new O(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,gs)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=gs.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(gs.copy(this.origin).addScaledVector(this.direction,e),gs.distanceToSquared(t))}distanceSqToSegment(t,e,i,s){i0.copy(t).add(e).multiplyScalar(.5),gl.copy(e).sub(t).normalize(),Ks.copy(this.origin).sub(i0);const n=t.distanceTo(e)*.5,a=-this.direction.dot(gl),o=Ks.dot(this.direction),h=-Ks.dot(gl),l=Ks.lengthSq(),u=Math.abs(1-a*a);let c,d,p,m;if(u>0)if(c=a*h-o,d=a*o-h,m=n*u,c>=0)if(d>=-m)if(d<=m){const f=1/u;c*=f,d*=f,p=c*(c+a*d+2*o)+d*(a*c+d+2*h)+l}else d=n,c=Math.max(0,-(a*d+o)),p=-c*c+d*(d+2*h)+l;else d=-n,c=Math.max(0,-(a*d+o)),p=-c*c+d*(d+2*h)+l;else d<=-m?(c=Math.max(0,-(-a*n+o)),d=c>0?-n:Math.min(Math.max(-n,-h),n),p=-c*c+d*(d+2*h)+l):d<=m?(c=0,d=Math.min(Math.max(-n,-h),n),p=d*(d+2*h)+l):(c=Math.max(0,-(a*n+o)),d=c>0?n:Math.min(Math.max(-n,-h),n),p=-c*c+d*(d+2*h)+l);else d=a>0?-n:n,c=Math.max(0,-(a*d+o)),p=-c*c+d*(d+2*h)+l;return i&&i.copy(this.origin).addScaledVector(this.direction,c),s&&s.copy(i0).addScaledVector(gl,d),p}intersectSphere(t,e){gs.subVectors(t.center,this.origin);const i=gs.dot(this.direction),s=gs.dot(gs)-i*i,n=t.radius*t.radius;if(s>n)return null;const a=Math.sqrt(n-s),o=i-a,h=i+a;return h<0?null:o<0?this.at(h,e):this.at(o,e)}intersectsSphere(t){return t.radius<0?!1:this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return i===null?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,s,n,a,o,h;const l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,d=this.origin;return l>=0?(i=(t.min.x-d.x)*l,s=(t.max.x-d.x)*l):(i=(t.max.x-d.x)*l,s=(t.min.x-d.x)*l),u>=0?(n=(t.min.y-d.y)*u,a=(t.max.y-d.y)*u):(n=(t.max.y-d.y)*u,a=(t.min.y-d.y)*u),i>a||n>s||((n>i||isNaN(i))&&(i=n),(a<s||isNaN(s))&&(s=a),c>=0?(o=(t.min.z-d.z)*c,h=(t.max.z-d.z)*c):(o=(t.max.z-d.z)*c,h=(t.min.z-d.z)*c),i>h||o>s)||((o>i||i!==i)&&(i=o),(h<s||s!==s)&&(s=h),s<0)?null:this.at(i>=0?i:s,e)}intersectsBox(t){return this.intersectBox(t,gs)!==null}intersectTriangle(t,e,i,s,n){s0.subVectors(e,t),yl.subVectors(i,t),n0.crossVectors(s0,yl);let a=this.direction.dot(n0),o;if(a>0){if(s)return null;o=1}else if(a<0)o=-1,a=-a;else return null;Ks.subVectors(this.origin,t);const h=o*this.direction.dot(yl.crossVectors(Ks,yl));if(h<0)return null;const l=o*this.direction.dot(s0.cross(Ks));if(l<0||h+l>a)return null;const u=-o*Ks.dot(n0);return u<0?null:this.at(u/a,n)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Gt{constructor(t,e,i,s,n,a,o,h,l,u,c,d,p,m,f,g){Gt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,i,s,n,a,o,h,l,u,c,d,p,m,f,g)}set(t,e,i,s,n,a,o,h,l,u,c,d,p,m,f,g){const y=this.elements;return y[0]=t,y[4]=e,y[8]=i,y[12]=s,y[1]=n,y[5]=a,y[9]=o,y[13]=h,y[2]=l,y[6]=u,y[10]=c,y[14]=d,y[3]=p,y[7]=m,y[11]=f,y[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Gt().fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,s=1/jr.setFromMatrixColumn(t,0).length(),n=1/jr.setFromMatrixColumn(t,1).length(),a=1/jr.setFromMatrixColumn(t,2).length();return e[0]=i[0]*s,e[1]=i[1]*s,e[2]=i[2]*s,e[3]=0,e[4]=i[4]*n,e[5]=i[5]*n,e[6]=i[6]*n,e[7]=0,e[8]=i[8]*a,e[9]=i[9]*a,e[10]=i[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,s=t.y,n=t.z,a=Math.cos(i),o=Math.sin(i),h=Math.cos(s),l=Math.sin(s),u=Math.cos(n),c=Math.sin(n);if(t.order==="XYZ"){const d=a*u,p=a*c,m=o*u,f=o*c;e[0]=h*u,e[4]=-h*c,e[8]=l,e[1]=p+m*l,e[5]=d-f*l,e[9]=-o*h,e[2]=f-d*l,e[6]=m+p*l,e[10]=a*h}else if(t.order==="YXZ"){const d=h*u,p=h*c,m=l*u,f=l*c;e[0]=d+f*o,e[4]=m*o-p,e[8]=a*l,e[1]=a*c,e[5]=a*u,e[9]=-o,e[2]=p*o-m,e[6]=f+d*o,e[10]=a*h}else if(t.order==="ZXY"){const d=h*u,p=h*c,m=l*u,f=l*c;e[0]=d-f*o,e[4]=-a*c,e[8]=m+p*o,e[1]=p+m*o,e[5]=a*u,e[9]=f-d*o,e[2]=-a*l,e[6]=o,e[10]=a*h}else if(t.order==="ZYX"){const d=a*u,p=a*c,m=o*u,f=o*c;e[0]=h*u,e[4]=m*l-p,e[8]=d*l+f,e[1]=h*c,e[5]=f*l+d,e[9]=p*l-m,e[2]=-l,e[6]=o*h,e[10]=a*h}else if(t.order==="YZX"){const d=a*h,p=a*l,m=o*h,f=o*l;e[0]=h*u,e[4]=f-d*c,e[8]=m*c+p,e[1]=c,e[5]=a*u,e[9]=-o*u,e[2]=-l*u,e[6]=p*c+m,e[10]=d-f*c}else if(t.order==="XZY"){const d=a*h,p=a*l,m=o*h,f=o*l;e[0]=h*u,e[4]=-c,e[8]=l*u,e[1]=d*c+f,e[5]=a*u,e[9]=p*c-m,e[2]=m*c-p,e[6]=o*u,e[10]=f*c+d}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(L7,t,P7)}lookAt(t,e,i){const s=this.elements;return De.subVectors(t,e),De.lengthSq()===0&&(De.z=1),De.normalize(),tn.crossVectors(i,De),tn.lengthSq()===0&&(Math.abs(i.z)===1?De.x+=1e-4:De.z+=1e-4,De.normalize(),tn.crossVectors(i,De)),tn.normalize(),xl.crossVectors(De,tn),s[0]=tn.x,s[4]=xl.x,s[8]=De.x,s[1]=tn.y,s[5]=xl.y,s[9]=De.y,s[2]=tn.z,s[6]=xl.z,s[10]=De.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,s=e.elements,n=this.elements,a=i[0],o=i[4],h=i[8],l=i[12],u=i[1],c=i[5],d=i[9],p=i[13],m=i[2],f=i[6],g=i[10],y=i[14],x=i[3],_=i[7],M=i[11],v=i[15],N=s[0],T=s[4],C=s[8],P=s[12],F=s[1],D=s[5],q=s[9],X=s[13],it=s[2],mt=s[6],xt=s[10],Q=s[14],gt=s[3],st=s[7],rt=s[11],Rt=s[15];return n[0]=a*N+o*F+h*it+l*gt,n[4]=a*T+o*D+h*mt+l*st,n[8]=a*C+o*q+h*xt+l*rt,n[12]=a*P+o*X+h*Q+l*Rt,n[1]=u*N+c*F+d*it+p*gt,n[5]=u*T+c*D+d*mt+p*st,n[9]=u*C+c*q+d*xt+p*rt,n[13]=u*P+c*X+d*Q+p*Rt,n[2]=m*N+f*F+g*it+y*gt,n[6]=m*T+f*D+g*mt+y*st,n[10]=m*C+f*q+g*xt+y*rt,n[14]=m*P+f*X+g*Q+y*Rt,n[3]=x*N+_*F+M*it+v*gt,n[7]=x*T+_*D+M*mt+v*st,n[11]=x*C+_*q+M*xt+v*rt,n[15]=x*P+_*X+M*Q+v*Rt,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],s=t[8],n=t[12],a=t[1],o=t[5],h=t[9],l=t[13],u=t[2],c=t[6],d=t[10],p=t[14],m=t[3],f=t[7],g=t[11],y=t[15];return m*(+n*h*c-s*l*c-n*o*d+i*l*d+s*o*p-i*h*p)+f*(+e*h*p-e*l*d+n*a*d-s*a*p+s*l*u-n*h*u)+g*(+e*l*c-e*o*p-n*a*c+i*a*p+n*o*u-i*l*u)+y*(-s*o*u-e*h*c+e*o*d+s*a*c-i*a*d+i*h*u)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const s=this.elements;return t.isVector3?(s[12]=t.x,s[13]=t.y,s[14]=t.z):(s[12]=t,s[13]=e,s[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],s=t[2],n=t[3],a=t[4],o=t[5],h=t[6],l=t[7],u=t[8],c=t[9],d=t[10],p=t[11],m=t[12],f=t[13],g=t[14],y=t[15],x=c*g*l-f*d*l+f*h*p-o*g*p-c*h*y+o*d*y,_=m*d*l-u*g*l-m*h*p+a*g*p+u*h*y-a*d*y,M=u*f*l-m*c*l+m*o*p-a*f*p-u*o*y+a*c*y,v=m*c*h-u*f*h-m*o*d+a*f*d+u*o*g-a*c*g,N=e*x+i*_+s*M+n*v;if(N===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/N;return t[0]=x*T,t[1]=(f*d*n-c*g*n-f*s*p+i*g*p+c*s*y-i*d*y)*T,t[2]=(o*g*n-f*h*n+f*s*l-i*g*l-o*s*y+i*h*y)*T,t[3]=(c*h*n-o*d*n-c*s*l+i*d*l+o*s*p-i*h*p)*T,t[4]=_*T,t[5]=(u*g*n-m*d*n+m*s*p-e*g*p-u*s*y+e*d*y)*T,t[6]=(m*h*n-a*g*n-m*s*l+e*g*l+a*s*y-e*h*y)*T,t[7]=(a*d*n-u*h*n+u*s*l-e*d*l-a*s*p+e*h*p)*T,t[8]=M*T,t[9]=(m*c*n-u*f*n-m*i*p+e*f*p+u*i*y-e*c*y)*T,t[10]=(a*f*n-m*o*n+m*i*l-e*f*l-a*i*y+e*o*y)*T,t[11]=(u*o*n-a*c*n-u*i*l+e*c*l+a*i*p-e*o*p)*T,t[12]=v*T,t[13]=(u*f*s-m*c*s+m*i*d-e*f*d-u*i*g+e*c*g)*T,t[14]=(m*o*s-a*f*s-m*i*h+e*f*h+a*i*g-e*o*g)*T,t[15]=(a*c*s-u*o*s+u*i*h-e*c*h-a*i*d+e*o*d)*T,this}scale(t){const e=this.elements,i=t.x,s=t.y,n=t.z;return e[0]*=i,e[4]*=s,e[8]*=n,e[1]*=i,e[5]*=s,e[9]*=n,e[2]*=i,e[6]*=s,e[10]*=n,e[3]*=i,e[7]*=s,e[11]*=n,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],s=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,s))}makeTranslation(t,e,i){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),s=Math.sin(e),n=1-i,a=t.x,o=t.y,h=t.z,l=n*a,u=n*o;return this.set(l*a+i,l*o-s*h,l*h+s*o,0,l*o+s*h,u*o+i,u*h-s*a,0,l*h-s*o,u*h+s*a,n*h*h+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,s,n,a){return this.set(1,i,n,0,t,1,a,0,e,s,1,0,0,0,0,1),this}compose(t,e,i){const s=this.elements,n=e._x,a=e._y,o=e._z,h=e._w,l=n+n,u=a+a,c=o+o,d=n*l,p=n*u,m=n*c,f=a*u,g=a*c,y=o*c,x=h*l,_=h*u,M=h*c,v=i.x,N=i.y,T=i.z;return s[0]=(1-(f+y))*v,s[1]=(p+M)*v,s[2]=(m-_)*v,s[3]=0,s[4]=(p-M)*N,s[5]=(1-(d+y))*N,s[6]=(g+x)*N,s[7]=0,s[8]=(m+_)*T,s[9]=(g-x)*T,s[10]=(1-(d+f))*T,s[11]=0,s[12]=t.x,s[13]=t.y,s[14]=t.z,s[15]=1,this}decompose(t,e,i){const s=this.elements;let n=jr.set(s[0],s[1],s[2]).length();const a=jr.set(s[4],s[5],s[6]).length(),o=jr.set(s[8],s[9],s[10]).length();this.determinant()<0&&(n=-n),t.x=s[12],t.y=s[13],t.z=s[14],Ri.copy(this);const l=1/n,u=1/a,c=1/o;return Ri.elements[0]*=l,Ri.elements[1]*=l,Ri.elements[2]*=l,Ri.elements[4]*=u,Ri.elements[5]*=u,Ri.elements[6]*=u,Ri.elements[8]*=c,Ri.elements[9]*=c,Ri.elements[10]*=c,e.setFromRotationMatrix(Ri),i.x=n,i.y=a,i.z=o,this}makePerspective(t,e,i,s,n,a,o=ul,h=!1){const l=this.elements,u=2*n/(e-t),c=2*n/(i-s),d=(e+t)/(e-t),p=(i+s)/(i-s);let m,f;if(h)m=n/(a-n),f=a*n/(a-n);else if(o===ul)m=-(a+n)/(a-n),f=-2*a*n/(a-n);else if(o===Zg)m=-a/(a-n),f=-a*n/(a-n);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return l[0]=u,l[4]=0,l[8]=d,l[12]=0,l[1]=0,l[5]=c,l[9]=p,l[13]=0,l[2]=0,l[6]=0,l[10]=m,l[14]=f,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this}makeOrthographic(t,e,i,s,n,a,o=ul,h=!1){const l=this.elements,u=2/(e-t),c=2/(i-s),d=-(e+t)/(e-t),p=-(i+s)/(i-s);let m,f;if(h)m=1/(a-n),f=a/(a-n);else if(o===ul)m=-2/(a-n),f=-(a+n)/(a-n);else if(o===Zg)m=-1/(a-n),f=-n/(a-n);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return l[0]=u,l[4]=0,l[8]=0,l[12]=d,l[1]=0,l[5]=c,l[9]=0,l[13]=p,l[2]=0,l[6]=0,l[10]=m,l[14]=f,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let s=0;s<16;s++)if(e[s]!==i[s])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const jr=new O,Ri=new Gt,L7=new O(0,0,0),P7=new O(1,1,1),tn=new O,xl=new O,De=new O,r9=new Gt,a9=new Dr;class Vn{constructor(t=0,e=0,i=0,s=Vn.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,s=this._order){return this._x=t,this._y=e,this._z=i,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const s=t.elements,n=s[0],a=s[4],o=s[8],h=s[1],l=s[5],u=s[9],c=s[2],d=s[6],p=s[10];switch(e){case"XYZ":this._y=Math.asin(dt(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-a,n)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-dt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(o,p),this._z=Math.atan2(h,l)):(this._y=Math.atan2(-c,n),this._z=0);break;case"ZXY":this._x=Math.asin(dt(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-c,p),this._z=Math.atan2(-a,l)):(this._y=0,this._z=Math.atan2(h,n));break;case"ZYX":this._y=Math.asin(-dt(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(h,n)):(this._x=0,this._z=Math.atan2(-a,l));break;case"YZX":this._z=Math.asin(dt(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-c,n)):(this._x=0,this._y=Math.atan2(o,p));break;case"XZY":this._z=Math.asin(-dt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-u,p),this._y=0);break;default:Wt("Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,i===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return r9.makeRotationFromQuaternion(t),this.setFromRotationMatrix(r9,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return a9.setFromEuler(this),this.setFromQuaternion(a9,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Vn.DEFAULT_ORDER="XYZ";class B7{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let O7=0;const o9=new O,Gr=new Dr,ys=new Gt,bl=new O,co=new O,V7=new O,F7=new Dr,h9=new O(1,0,0),l9=new O(0,1,0),u9=new O(0,0,1),c9={type:"added"},k7={type:"removed"},Yr={type:"childadded",child:null},r0={type:"childremoved",child:null};class Ue extends dl{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:O7++}),this.uuid=$i(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Ue.DEFAULT_UP.clone();const t=new O,e=new Vn,i=new Dr,s=new O(1,1,1);function n(){i.setFromEuler(e,!1)}function a(){e.setFromQuaternion(i,void 0,!1)}e._onChange(n),i._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Gt},normalMatrix:{value:new Gs}}),this.matrix=new Gt,this.matrixWorld=new Gt,this.matrixAutoUpdate=Ue.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Ue.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new B7,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Gr.setFromAxisAngle(t,e),this.quaternion.multiply(Gr),this}rotateOnWorldAxis(t,e){return Gr.setFromAxisAngle(t,e),this.quaternion.premultiply(Gr),this}rotateX(t){return this.rotateOnAxis(h9,t)}rotateY(t){return this.rotateOnAxis(l9,t)}rotateZ(t){return this.rotateOnAxis(u9,t)}translateOnAxis(t,e){return o9.copy(t).applyQuaternion(this.quaternion),this.position.add(o9.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(h9,t)}translateY(t){return this.translateOnAxis(l9,t)}translateZ(t){return this.translateOnAxis(u9,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(ys.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?bl.copy(t):bl.set(t,e,i);const s=this.parent;this.updateWorldMatrix(!0,!1),co.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ys.lookAt(co,bl,this.up):ys.lookAt(bl,co,this.up),this.quaternion.setFromRotationMatrix(ys),s&&(ys.extractRotation(s.matrixWorld),Gr.setFromRotationMatrix(ys),this.quaternion.premultiply(Gr.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(Ce("Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(c9),Yr.child=t,this.dispatchEvent(Yr),Yr.child=null):Ce("Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(k7),r0.child=t,this.dispatchEvent(r0),r0.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),ys.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),ys.multiply(t.parent.matrixWorld)),t.applyMatrix4(ys),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(c9),Yr.child=t,this.dispatchEvent(Yr),Yr.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,s=this.children.length;i<s;i++){const a=this.children[i].getObjectByProperty(t,e);if(a!==void 0)return a}}getObjectsByProperty(t,e,i=[]){this[t]===e&&i.push(this);const s=this.children;for(let n=0,a=s.length;n<a;n++)s[n].getObjectsByProperty(t,e,i);return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(co,t,V7),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(co,F7,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,s=e.length;i<s;i++)e[i].updateMatrixWorld(t)}updateWorldMatrix(t,e){const i=this.parent;if(t===!0&&i!==null&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),e===!0){const s=this.children;for(let n=0,a=s.length;n<a;n++)s[n].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.geometryInfo=this._geometryInfo.map(o=>({...o,boundingBox:o.boundingBox?o.boundingBox.toJSON():void 0,boundingSphere:o.boundingSphere?o.boundingSphere.toJSON():void 0})),s.instanceInfo=this._instanceInfo.map(o=>({...o})),s.availableInstanceIds=this._availableInstanceIds.slice(),s.availableGeometryIds=this._availableGeometryIds.slice(),s.nextIndexStart=this._nextIndexStart,s.nextVertexStart=this._nextVertexStart,s.geometryCount=this._geometryCount,s.maxInstanceCount=this._maxInstanceCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.matricesTexture=this._matricesTexture.toJSON(t),s.indirectTexture=this._indirectTexture.toJSON(t),this._colorsTexture!==null&&(s.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(s.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(s.boundingBox=this.boundingBox.toJSON()));function n(o,h){return o[h.uuid]===void 0&&(o[h.uuid]=h.toJSON(t)),h.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=n(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const h=o.shapes;if(Array.isArray(h))for(let l=0,u=h.length;l<u;l++){const c=h[l];n(t.shapes,c)}else n(t.shapes,h)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let h=0,l=this.material.length;h<l;h++)o.push(n(t.materials,this.material[h]));s.material=o}else s.material=n(t.materials,this.material);if(this.children.length>0){s.children=[];for(let o=0;o<this.children.length;o++)s.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let o=0;o<this.animations.length;o++){const h=this.animations[o];s.animations.push(n(t.animations,h))}}if(e){const o=a(t.geometries),h=a(t.materials),l=a(t.textures),u=a(t.images),c=a(t.shapes),d=a(t.skeletons),p=a(t.animations),m=a(t.nodes);o.length>0&&(i.geometries=o),h.length>0&&(i.materials=h),l.length>0&&(i.textures=l),u.length>0&&(i.images=u),c.length>0&&(i.shapes=c),d.length>0&&(i.skeletons=d),p.length>0&&(i.animations=p),m.length>0&&(i.nodes=m)}return i.object=s,i;function a(o){const h=[];for(const l in o){const u=o[l];delete u.metadata,h.push(u)}return h}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let i=0;i<t.children.length;i++){const s=t.children[i];this.add(s.clone())}return this}}Ue.DEFAULT_UP=new O(0,1,0),Ue.DEFAULT_MATRIX_AUTO_UPDATE=!0,Ue.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Ei=new O,xs=new O,a0=new O,bs=new O,Zr=new O,Jr=new O,d9=new O,o0=new O,h0=new O,l0=new O,u0=new Zs,c0=new Zs,d0=new Zs;class Ii{constructor(t=new O,e=new O,i=new O){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,s){s.subVectors(i,e),Ei.subVectors(t,e),s.cross(Ei);const n=s.lengthSq();return n>0?s.multiplyScalar(1/Math.sqrt(n)):s.set(0,0,0)}static getBarycoord(t,e,i,s,n){Ei.subVectors(s,e),xs.subVectors(i,e),a0.subVectors(t,e);const a=Ei.dot(Ei),o=Ei.dot(xs),h=Ei.dot(a0),l=xs.dot(xs),u=xs.dot(a0),c=a*l-o*o;if(c===0)return n.set(0,0,0),null;const d=1/c,p=(l*h-o*u)*d,m=(a*u-o*h)*d;return n.set(1-p-m,m,p)}static containsPoint(t,e,i,s){return this.getBarycoord(t,e,i,s,bs)===null?!1:bs.x>=0&&bs.y>=0&&bs.x+bs.y<=1}static getInterpolation(t,e,i,s,n,a,o,h){return this.getBarycoord(t,e,i,s,bs)===null?(h.x=0,h.y=0,"z"in h&&(h.z=0),"w"in h&&(h.w=0),null):(h.setScalar(0),h.addScaledVector(n,bs.x),h.addScaledVector(a,bs.y),h.addScaledVector(o,bs.z),h)}static getInterpolatedAttribute(t,e,i,s,n,a){return u0.setScalar(0),c0.setScalar(0),d0.setScalar(0),u0.fromBufferAttribute(t,e),c0.fromBufferAttribute(t,i),d0.fromBufferAttribute(t,s),a.setScalar(0),a.addScaledVector(u0,n.x),a.addScaledVector(c0,n.y),a.addScaledVector(d0,n.z),a}static isFrontFacing(t,e,i,s){return Ei.subVectors(i,e),xs.subVectors(t,e),Ei.cross(xs).dot(s)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,s){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[s]),this}setFromAttributeAndIndices(t,e,i,s){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,s),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Ei.subVectors(this.c,this.b),xs.subVectors(this.a,this.b),Ei.cross(xs).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Ii.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Ii.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,i,s,n){return Ii.getInterpolation(t,this.a,this.b,this.c,e,i,s,n)}containsPoint(t){return Ii.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Ii.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,s=this.b,n=this.c;let a,o;Zr.subVectors(s,i),Jr.subVectors(n,i),o0.subVectors(t,i);const h=Zr.dot(o0),l=Jr.dot(o0);if(h<=0&&l<=0)return e.copy(i);h0.subVectors(t,s);const u=Zr.dot(h0),c=Jr.dot(h0);if(u>=0&&c<=u)return e.copy(s);const d=h*c-u*l;if(d<=0&&h>=0&&u<=0)return a=h/(h-u),e.copy(i).addScaledVector(Zr,a);l0.subVectors(t,n);const p=Zr.dot(l0),m=Jr.dot(l0);if(m>=0&&p<=m)return e.copy(n);const f=p*l-h*m;if(f<=0&&l>=0&&m<=0)return o=l/(l-m),e.copy(i).addScaledVector(Jr,o);const g=u*m-p*c;if(g<=0&&c-u>=0&&p-m>=0)return d9.subVectors(n,s),o=(c-u)/(c-u+(p-m)),e.copy(s).addScaledVector(d9,o);const y=1/(g+f+d);return a=f*y,o=d*y,e.copy(i).addScaledVector(Zr,a).addScaledVector(Jr,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const p9={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},en={h:0,s:0,l:0},Ml={h:0,s:0,l:0};function p0(r,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+(t-r)*6*e:e<1/2?t:e<2/3?r+(t-r)*6*(2/3-e):r}class po{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,i)}set(t,e,i){if(e===void 0&&i===void 0){const s=t;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(t,e,i);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=Ti){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,Ai.colorSpaceToWorking(this,e),this}setRGB(t,e,i,s=Ai.workingColorSpace){return this.r=t,this.g=e,this.b=i,Ai.colorSpaceToWorking(this,s),this}setHSL(t,e,i,s=Ai.workingColorSpace){if(t=A7(t,1),e=dt(e,0,1),i=dt(i,0,1),e===0)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,a=2*i-n;this.r=p0(a,n,t+1/3),this.g=p0(a,n,t),this.b=p0(a,n,t-1/3)}return Ai.colorSpaceToWorking(this,s),this}setStyle(t,e=Ti){function i(n){n!==void 0&&parseFloat(n)<1&&Wt("Color: Alpha component of "+t+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(t)){let n;const a=s[1],o=s[2];switch(a){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(n[4]),this.setRGB(Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255,e);if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(n[4]),this.setRGB(Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100,e);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(n[4]),this.setHSL(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,e);break;default:Wt("Color: Unknown color model "+t)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(t)){const n=s[1],a=n.length;if(a===3)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,e);if(a===6)return this.setHex(parseInt(n,16),e);Wt("Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=Ti){const i=p9[t.toLowerCase()];return i!==void 0?this.setHex(i,e):Wt("Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=ms(t.r),this.g=ms(t.g),this.b=ms(t.b),this}copyLinearToSRGB(t){return this.r=Ur(t.r),this.g=Ur(t.g),this.b=Ur(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Ti){return Ai.workingToColorSpace(be.copy(this),t),Math.round(dt(be.r*255,0,255))*65536+Math.round(dt(be.g*255,0,255))*256+Math.round(dt(be.b*255,0,255))}getHexString(t=Ti){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Ai.workingColorSpace){Ai.workingToColorSpace(be.copy(this),e);const i=be.r,s=be.g,n=be.b,a=Math.max(i,s,n),o=Math.min(i,s,n);let h,l;const u=(o+a)/2;if(o===a)h=0,l=0;else{const c=a-o;switch(l=u<=.5?c/(a+o):c/(2-a-o),a){case i:h=(s-n)/c+(s<n?6:0);break;case s:h=(n-i)/c+2;break;case n:h=(i-s)/c+4;break}h/=6}return t.h=h,t.s=l,t.l=u,t}getRGB(t,e=Ai.workingColorSpace){return Ai.workingToColorSpace(be.copy(this),e),t.r=be.r,t.g=be.g,t.b=be.b,t}getStyle(t=Ti){Ai.workingToColorSpace(be.copy(this),t);const e=be.r,i=be.g,s=be.b;return t!==Ti?`color(${t} ${e.toFixed(3)} ${i.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(i*255)},${Math.round(s*255)})`}offsetHSL(t,e,i){return this.getHSL(en),this.setHSL(en.h+t,en.s+e,en.l+i)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL(en),t.getHSL(Ml);const i=Yd(en.h,Ml.h,e),s=Yd(en.s,Ml.s,e),n=Yd(en.l,Ml.l,e);return this.setHSL(i,s,n),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,i=this.g,s=this.b,n=t.elements;return this.r=n[0]*e+n[3]*i+n[6]*s,this.g=n[1]*e+n[4]*i+n[7]*s,this.b=n[2]*e+n[5]*i+n[8]*s,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const be=new po;po.NAMES=p9;let D7=0;class U7 extends dl{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:D7++}),this.uuid=$i(),this.name="",this.type="Material",this.blending=Lg,this.side=Hd,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Bg,this.blendDst=Og,this.blendEquation=Pg,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new po(0,0,0),this.blendAlpha=0,this.depthFunc=Vg,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Yg,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=kr,this.stencilZFail=kr,this.stencilZPass=kr,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const i=t[e];if(i===void 0){Wt(`Material: parameter '${e}' has value of undefined.`);continue}const s=this[e];if(s===void 0){Wt(`Material: '${e}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(i):s&&s.isVector3&&i&&i.isVector3?s.copy(i):this[e]=i}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const i={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(i.sheenColorMap=this.sheenColorMap.toJSON(t).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(i.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(t).uuid),this.dispersion!==void 0&&(i.dispersion=this.dispersion),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Lg&&(i.blending=this.blending),this.side!==Hd&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==Bg&&(i.blendSrc=this.blendSrc),this.blendDst!==Og&&(i.blendDst=this.blendDst),this.blendEquation!==Pg&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==Vg&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Yg&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==kr&&(i.stencilFail=this.stencilFail),this.stencilZFail!==kr&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==kr&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function s(n){const a=[];for(const o in n){const h=n[o];delete h.metadata,a.push(h)}return a}if(e){const n=s(t.textures),a=s(t.images);n.length>0&&(i.textures=n),a.length>0&&(i.images=a)}return i}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(e!==null){const s=e.length;i=new Array(s);for(let n=0;n!==s;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}}class m9 extends U7{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new po(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Vn,this.combine=y7,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Yt=new O,_l=new Si;let W7=0;class Ci{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:W7++}),this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=i,this.usage=Gd,this.updateRanges=[],this.gpuType=Wg,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let s=0,n=this.itemSize;s<n;s++)this.array[t+s]=e.array[i+s];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,i=this.count;e<i;e++)_l.fromBufferAttribute(this,e),_l.applyMatrix3(t),this.setXY(e,_l.x,_l.y);else if(this.itemSize===3)for(let e=0,i=this.count;e<i;e++)Yt.fromBufferAttribute(this,e),Yt.applyMatrix3(t),this.setXYZ(e,Yt.x,Yt.y,Yt.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)Yt.fromBufferAttribute(this,e),Yt.applyMatrix4(t),this.setXYZ(e,Yt.x,Yt.y,Yt.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)Yt.fromBufferAttribute(this,e),Yt.applyNormalMatrix(t),this.setXYZ(e,Yt.x,Yt.y,Yt.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)Yt.fromBufferAttribute(this,e),Yt.transformDirection(t),this.setXYZ(e,Yt.x,Yt.y,Yt.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let i=this.array[t*this.itemSize+e];return this.normalized&&(i=Xi(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=St(i,this.array)),this.array[t*this.itemSize+e]=i,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Xi(e,this.array)),e}setX(t,e){return this.normalized&&(e=St(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Xi(e,this.array)),e}setY(t,e){return this.normalized&&(e=St(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Xi(e,this.array)),e}setZ(t,e){return this.normalized&&(e=St(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Xi(e,this.array)),e}setW(t,e){return this.normalized&&(e=St(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=St(e,this.array),i=St(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,s){return t*=this.itemSize,this.normalized&&(e=St(e,this.array),i=St(i,this.array),s=St(s,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this}setXYZW(t,e,i,s,n){return t*=this.itemSize,this.normalized&&(e=St(e,this.array),i=St(i,this.array),s=St(s,this.array),n=St(n,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=s,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==Gd&&(t.usage=this.usage),t}}class H7 extends Ci{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class q7 extends Ci{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class $7 extends Ci{constructor(t,e,i){super(new Float32Array(t),e,i)}}let X7=0;const ri=new Gt,m0=new Ue,Qr=new O,We=new Hr,mo=new Hr,oe=new O;class fo extends dl{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:X7++}),this.uuid=$i(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(T7(t)?q7:H7)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const n=new Gs().getNormalMatrix(t);i.applyNormalMatrix(n),i.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(t),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return ri.makeRotationFromQuaternion(t),this.applyMatrix4(ri),this}rotateX(t){return ri.makeRotationX(t),this.applyMatrix4(ri),this}rotateY(t){return ri.makeRotationY(t),this.applyMatrix4(ri),this}rotateZ(t){return ri.makeRotationZ(t),this.applyMatrix4(ri),this}translate(t,e,i){return ri.makeTranslation(t,e,i),this.applyMatrix4(ri),this}scale(t,e,i){return ri.makeScale(t,e,i),this.applyMatrix4(ri),this}lookAt(t){return m0.lookAt(t),m0.updateMatrix(),this.applyMatrix4(m0.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Qr).negate(),this.translate(Qr.x,Qr.y,Qr.z),this}setFromPoints(t){const e=this.getAttribute("position");if(e===void 0){const i=[];for(let s=0,n=t.length;s<n;s++){const a=t[s];i.push(a.x,a.y,a.z||0)}this.setAttribute("position",new $7(i,3))}else{const i=Math.min(t.length,e.count);for(let s=0;s<i;s++){const n=t[s];e.setXYZ(s,n.x,n.y,n.z||0)}t.length>e.count&&Wt("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Hr);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){Ce("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new O(-1/0,-1/0,-1/0),new O(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,s=e.length;i<s;i++){const n=e[i];We.setFromBufferAttribute(n),this.morphTargetsRelative?(oe.addVectors(this.boundingBox.min,We.min),this.boundingBox.expandByPoint(oe),oe.addVectors(this.boundingBox.max,We.max),this.boundingBox.expandByPoint(oe)):(this.boundingBox.expandByPoint(We.min),this.boundingBox.expandByPoint(We.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&Ce('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new uo);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){Ce("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new O,1/0);return}if(t){const i=this.boundingSphere.center;if(We.setFromBufferAttribute(t),e)for(let n=0,a=e.length;n<a;n++){const o=e[n];mo.setFromBufferAttribute(o),this.morphTargetsRelative?(oe.addVectors(We.min,mo.min),We.expandByPoint(oe),oe.addVectors(We.max,mo.max),We.expandByPoint(oe)):(We.expandByPoint(mo.min),We.expandByPoint(mo.max))}We.getCenter(i);let s=0;for(let n=0,a=t.count;n<a;n++)oe.fromBufferAttribute(t,n),s=Math.max(s,i.distanceToSquared(oe));if(e)for(let n=0,a=e.length;n<a;n++){const o=e[n],h=this.morphTargetsRelative;for(let l=0,u=o.count;l<u;l++)oe.fromBufferAttribute(o,l),h&&(Qr.fromBufferAttribute(t,l),oe.add(Qr)),s=Math.max(s,i.distanceToSquared(oe))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&Ce('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){Ce("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=e.position,s=e.normal,n=e.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ci(new Float32Array(4*i.count),4));const a=this.getAttribute("tangent"),o=[],h=[];for(let C=0;C<i.count;C++)o[C]=new O,h[C]=new O;const l=new O,u=new O,c=new O,d=new Si,p=new Si,m=new Si,f=new O,g=new O;function y(C,P,F){l.fromBufferAttribute(i,C),u.fromBufferAttribute(i,P),c.fromBufferAttribute(i,F),d.fromBufferAttribute(n,C),p.fromBufferAttribute(n,P),m.fromBufferAttribute(n,F),u.sub(l),c.sub(l),p.sub(d),m.sub(d);const D=1/(p.x*m.y-m.x*p.y);isFinite(D)&&(f.copy(u).multiplyScalar(m.y).addScaledVector(c,-p.y).multiplyScalar(D),g.copy(c).multiplyScalar(p.x).addScaledVector(u,-m.x).multiplyScalar(D),o[C].add(f),o[P].add(f),o[F].add(f),h[C].add(g),h[P].add(g),h[F].add(g))}let x=this.groups;x.length===0&&(x=[{start:0,count:t.count}]);for(let C=0,P=x.length;C<P;++C){const F=x[C],D=F.start,q=F.count;for(let X=D,it=D+q;X<it;X+=3)y(t.getX(X+0),t.getX(X+1),t.getX(X+2))}const _=new O,M=new O,v=new O,N=new O;function T(C){v.fromBufferAttribute(s,C),N.copy(v);const P=o[C];_.copy(P),_.sub(v.multiplyScalar(v.dot(P))).normalize(),M.crossVectors(N,P);const D=M.dot(h[C])<0?-1:1;a.setXYZW(C,_.x,_.y,_.z,D)}for(let C=0,P=x.length;C<P;++C){const F=x[C],D=F.start,q=F.count;for(let X=D,it=D+q;X<it;X+=3)T(t.getX(X+0)),T(t.getX(X+1)),T(t.getX(X+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Ci(new Float32Array(e.count*3),3),this.setAttribute("normal",i);else for(let d=0,p=i.count;d<p;d++)i.setXYZ(d,0,0,0);const s=new O,n=new O,a=new O,o=new O,h=new O,l=new O,u=new O,c=new O;if(t)for(let d=0,p=t.count;d<p;d+=3){const m=t.getX(d+0),f=t.getX(d+1),g=t.getX(d+2);s.fromBufferAttribute(e,m),n.fromBufferAttribute(e,f),a.fromBufferAttribute(e,g),u.subVectors(a,n),c.subVectors(s,n),u.cross(c),o.fromBufferAttribute(i,m),h.fromBufferAttribute(i,f),l.fromBufferAttribute(i,g),o.add(u),h.add(u),l.add(u),i.setXYZ(m,o.x,o.y,o.z),i.setXYZ(f,h.x,h.y,h.z),i.setXYZ(g,l.x,l.y,l.z)}else for(let d=0,p=e.count;d<p;d+=3)s.fromBufferAttribute(e,d+0),n.fromBufferAttribute(e,d+1),a.fromBufferAttribute(e,d+2),u.subVectors(a,n),c.subVectors(s,n),u.cross(c),i.setXYZ(d+0,u.x,u.y,u.z),i.setXYZ(d+1,u.x,u.y,u.z),i.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)oe.fromBufferAttribute(t,e),oe.normalize(),t.setXYZ(e,oe.x,oe.y,oe.z)}toNonIndexed(){function t(o,h){const l=o.array,u=o.itemSize,c=o.normalized,d=new l.constructor(h.length*u);let p=0,m=0;for(let f=0,g=h.length;f<g;f++){o.isInterleavedBufferAttribute?p=h[f]*o.data.stride+o.offset:p=h[f]*u;for(let y=0;y<u;y++)d[m++]=l[p++]}return new Ci(d,u,c)}if(this.index===null)return Wt("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new fo,i=this.index.array,s=this.attributes;for(const o in s){const h=s[o],l=t(h,i);e.setAttribute(o,l)}const n=this.morphAttributes;for(const o in n){const h=[],l=n[o];for(let u=0,c=l.length;u<c;u++){const d=l[u],p=t(d,i);h.push(p)}e.morphAttributes[o]=h}e.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let o=0,h=a.length;o<h;o++){const l=a[o];e.addGroup(l.start,l.count,l.materialIndex)}return e}toJSON(){const t={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const h=this.parameters;for(const l in h)h[l]!==void 0&&(t[l]=h[l]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const h in i){const l=i[h];t.data.attributes[h]=l.toJSON(t.data)}const s={};let n=!1;for(const h in this.morphAttributes){const l=this.morphAttributes[h],u=[];for(let c=0,d=l.length;c<d;c++){const p=l[c];u.push(p.toJSON(t.data))}u.length>0&&(s[h]=u,n=!0)}n&&(t.data.morphAttributes=s,t.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(t.data.groups=JSON.parse(JSON.stringify(a)));const o=this.boundingSphere;return o!==null&&(t.data.boundingSphere=o.toJSON()),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;i!==null&&this.setIndex(i.clone());const s=t.attributes;for(const l in s){const u=s[l];this.setAttribute(l,u.clone(e))}const n=t.morphAttributes;for(const l in n){const u=[],c=n[l];for(let d=0,p=c.length;d<p;d++)u.push(c[d].clone(e));this.morphAttributes[l]=u}this.morphTargetsRelative=t.morphTargetsRelative;const a=t.groups;for(let l=0,u=a.length;l<u;l++){const c=a[l];this.addGroup(c.start,c.count,c.materialIndex)}const o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());const h=t.boundingSphere;return h!==null&&(this.boundingSphere=h.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const f9=new Gt,Fn=new n9,vl=new uo,g9=new O,wl=new O,Tl=new O,Sl=new O,f0=new O,Al=new O,y9=new O,Nl=new O;class x9 extends Ue{constructor(t=new fo,e=new m9){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,i=Object.keys(e);if(i.length>0){const s=e[i[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,a=s.length;n<a;n++){const o=s[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=n}}}}getVertexPosition(t,e){const i=this.geometry,s=i.attributes.position,n=i.morphAttributes.position,a=i.morphTargetsRelative;e.fromBufferAttribute(s,t);const o=this.morphTargetInfluences;if(n&&o){Al.set(0,0,0);for(let h=0,l=n.length;h<l;h++){const u=o[h],c=n[h];u!==0&&(f0.fromBufferAttribute(c,t),a?Al.addScaledVector(f0,u):Al.addScaledVector(f0.sub(e),u))}e.add(Al)}return e}raycast(t,e){const i=this.geometry,s=this.material,n=this.matrixWorld;s!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),vl.copy(i.boundingSphere),vl.applyMatrix4(n),Fn.copy(t.ray).recast(t.near),!(vl.containsPoint(Fn.origin)===!1&&(Fn.intersectSphere(vl,g9)===null||Fn.origin.distanceToSquared(g9)>(t.far-t.near)**2))&&(f9.copy(n).invert(),Fn.copy(t.ray).applyMatrix4(f9),!(i.boundingBox!==null&&Fn.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(t,e,Fn)))}_computeIntersections(t,e,i){let s;const n=this.geometry,a=this.material,o=n.index,h=n.attributes.position,l=n.attributes.uv,u=n.attributes.uv1,c=n.attributes.normal,d=n.groups,p=n.drawRange;if(o!==null)if(Array.isArray(a))for(let m=0,f=d.length;m<f;m++){const g=d[m],y=a[g.materialIndex],x=Math.max(g.start,p.start),_=Math.min(o.count,Math.min(g.start+g.count,p.start+p.count));for(let M=x,v=_;M<v;M+=3){const N=o.getX(M),T=o.getX(M+1),C=o.getX(M+2);s=Rl(this,y,t,i,l,u,c,N,T,C),s&&(s.faceIndex=Math.floor(M/3),s.face.materialIndex=g.materialIndex,e.push(s))}}else{const m=Math.max(0,p.start),f=Math.min(o.count,p.start+p.count);for(let g=m,y=f;g<y;g+=3){const x=o.getX(g),_=o.getX(g+1),M=o.getX(g+2);s=Rl(this,a,t,i,l,u,c,x,_,M),s&&(s.faceIndex=Math.floor(g/3),e.push(s))}}else if(h!==void 0)if(Array.isArray(a))for(let m=0,f=d.length;m<f;m++){const g=d[m],y=a[g.materialIndex],x=Math.max(g.start,p.start),_=Math.min(h.count,Math.min(g.start+g.count,p.start+p.count));for(let M=x,v=_;M<v;M+=3){const N=M,T=M+1,C=M+2;s=Rl(this,y,t,i,l,u,c,N,T,C),s&&(s.faceIndex=Math.floor(M/3),s.face.materialIndex=g.materialIndex,e.push(s))}}else{const m=Math.max(0,p.start),f=Math.min(h.count,p.start+p.count);for(let g=m,y=f;g<y;g+=3){const x=g,_=g+1,M=g+2;s=Rl(this,a,t,i,l,u,c,x,_,M),s&&(s.faceIndex=Math.floor(g/3),e.push(s))}}}}function j7(r,t,e,i,s,n,a,o){let h;if(t.side===g7?h=i.intersectTriangle(a,n,s,!0,o):h=i.intersectTriangle(s,n,a,t.side===Hd,o),h===null)return null;Nl.copy(o),Nl.applyMatrix4(r.matrixWorld);const l=e.ray.origin.distanceTo(Nl);return l<e.near||l>e.far?null:{distance:l,point:Nl.clone(),object:r}}function Rl(r,t,e,i,s,n,a,o,h,l){r.getVertexPosition(o,wl),r.getVertexPosition(h,Tl),r.getVertexPosition(l,Sl);const u=j7(r,t,e,i,wl,Tl,Sl,y9);if(u){const c=new O;Ii.getBarycoord(y9,wl,Tl,Sl,c),s&&(u.uv=Ii.getInterpolatedAttribute(s,o,h,l,c,new Si)),n&&(u.uv1=Ii.getInterpolatedAttribute(n,o,h,l,c,new Si)),a&&(u.normal=Ii.getInterpolatedAttribute(a,o,h,l,c,new O),u.normal.dot(i.direction)>0&&u.normal.multiplyScalar(-1));const d={a:o,b:h,c:l,normal:new O,materialIndex:0};Ii.getNormal(wl,Tl,Sl,d.normal),u.face=d,u.barycoord=c}return u}class G7 extends Ue{constructor(){super(),this.isGroup=!0,this.type="Group"}}class Y7 extends Ue{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Vn,this.environmentIntensity=1,this.environmentRotation=new Vn,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class Z7{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=Gd,this.updateRanges=[],this.version=0,this.uuid=$i()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let s=0,n=this.stride;s<n;s++)this.array[t+s]=e.array[i+s];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=$i()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=$i()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const we=new O;class El{constructor(t,e,i,s=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=s}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)we.fromBufferAttribute(this,e),we.applyMatrix4(t),this.setXYZ(e,we.x,we.y,we.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)we.fromBufferAttribute(this,e),we.applyNormalMatrix(t),this.setXYZ(e,we.x,we.y,we.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)we.fromBufferAttribute(this,e),we.transformDirection(t),this.setXYZ(e,we.x,we.y,we.z);return this}getComponent(t,e){let i=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(i=Xi(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=St(i,this.array)),this.data.array[t*this.data.stride+this.offset+e]=i,this}setX(t,e){return this.normalized&&(e=St(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=St(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=St(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=St(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=Xi(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=Xi(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=Xi(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=Xi(e,this.array)),e}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=St(e,this.array),i=St(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=St(e,this.array),i=St(i,this.array),s=St(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=s,this}setXYZW(t,e,i,s,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=St(e,this.array),i=St(i,this.array),s=St(s,this.array),n=St(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=s,this.data.array[t+3]=n,this}clone(t){if(t===void 0){Kg("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)e.push(this.data.array[s+n])}return new Ci(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new El(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){Kg("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let i=0;i<this.count;i++){const s=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)e.push(this.data.array[s+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const b9=new O,M9=new Zs,_9=new Zs,J7=new O,v9=new Gt,Il=new O,g0=new uo,w9=new Gt,y0=new n9;class Q7 extends x9{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=Fg,this.bindMatrix=new Gt,this.bindMatrixInverse=new Gt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;this.boundingBox===null&&(this.boundingBox=new Hr),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let i=0;i<e.count;i++)this.getVertexPosition(i,Il),this.boundingBox.expandByPoint(Il)}computeBoundingSphere(){const t=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new uo),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let i=0;i<e.count;i++)this.getVertexPosition(i,Il),this.boundingSphere.expandByPoint(Il)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const i=this.material,s=this.matrixWorld;i!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),g0.copy(this.boundingSphere),g0.applyMatrix4(s),t.ray.intersectsSphere(g0)!==!1&&(w9.copy(s).invert(),y0.copy(t.ray).applyMatrix4(w9),!(this.boundingBox!==null&&y0.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(t,e,y0)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,e===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Zs,e=this.geometry.attributes.skinWeight;for(let i=0,s=e.count;i<s;i++){t.fromBufferAttribute(e,i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===Fg?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===x7?this.bindMatrixInverse.copy(this.bindMatrix).invert():Wt("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const i=this.skeleton,s=this.geometry;M9.fromBufferAttribute(s.attributes.skinIndex,t),_9.fromBufferAttribute(s.attributes.skinWeight,t),b9.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let n=0;n<4;n++){const a=_9.getComponent(n);if(a!==0){const o=M9.getComponent(n);v9.multiplyMatrices(i.bones[o].matrixWorld,i.boneInverses[o]),e.addScaledVector(J7.copy(b9).applyMatrix4(v9),a)}}return e.applyMatrix4(this.bindMatrixInverse)}}class T9 extends Ue{constructor(){super(),this.isBone=!0,this.type="Bone"}}class S9 extends Ys{constructor(t=null,e=1,i=1,s,n,a,o,h,l=hl,u=hl,c,d){super(null,a,o,h,l,u,s,n,c,d),this.isDataTexture=!0,this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const A9=new Gt,K7=new Gt;class x0{constructor(t=[],e=[]){this.uuid=$i(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(t.length*16),e.length===0)this.calculateInverses();else if(t.length!==e.length){Wt("Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let i=0,s=this.bones.length;i<s;i++)this.boneInverses.push(new Gt)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const i=new Gt;this.bones[t]&&i.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(i)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const i=this.bones[t];i&&i.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const i=this.bones[t];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}update(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,s=this.boneTexture;for(let n=0,a=t.length;n<a;n++){const o=t[n]?t[n].matrixWorld:K7;A9.multiplyMatrices(o,e[n]),A9.toArray(i,n*16)}s!==null&&(s.needsUpdate=!0)}clone(){return new x0(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(this.bones.length*4);t=Math.ceil(t/4)*4,t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new S9(e,t,t,qd,Wg);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){const s=this.bones[e];if(s.name===t)return s}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,s=t.bones.length;i<s;i++){const n=t.bones[i];let a=e[n];a===void 0&&(Wt("Skeleton: No bone found with UUID:",n),a=new T9),this.bones.push(a),this.boneInverses.push(new Gt().fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let s=0,n=e.length;s<n;s++){const a=e[s];t.bones.push(a.uuid);const o=i[s];t.boneInverses.push(o.toArray())}return t}}class t6 extends Ci{constructor(t,e,i,s=1){super(t,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=s}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}function Cl(r,t){return!r||r.constructor===t?r:typeof t.BYTES_PER_ELEMENT=="number"?new t(r):Array.prototype.slice.call(r)}function e6(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function i6(r){function t(s,n){return r[s]-r[n]}const e=r.length,i=new Array(e);for(let s=0;s!==e;++s)i[s]=s;return i.sort(t),i}function N9(r,t,e){const i=r.length,s=new r.constructor(i);for(let n=0,a=0;a!==i;++n){const o=e[n]*t;for(let h=0;h!==t;++h)s[a++]=r[o+h]}return s}function R9(r,t,e,i){let s=1,n=r[0];for(;n!==void 0&&n[i]===void 0;)n=r[s++];if(n===void 0)return;let a=n[i];if(a!==void 0)if(Array.isArray(a))do a=n[i],a!==void 0&&(t.push(n.time),e.push(...a)),n=r[s++];while(n!==void 0);else if(a.toArray!==void 0)do a=n[i],a!==void 0&&(t.push(n.time),a.toArray(e,e.length)),n=r[s++];while(n!==void 0);else do a=n[i],a!==void 0&&(t.push(n.time),e.push(a)),n=r[s++];while(n!==void 0)}class zl{constructor(t,e,i,s){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,s=e[i],n=e[i-1];i:{t:{let a;e:{s:if(!(t<s)){for(let o=i+2;;){if(s===void 0){if(t<n)break s;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===o)break;if(n=s,s=e[++i],t<s)break t}a=e.length;break e}if(!(t>=n)){const o=e[1];t<o&&(i=2,n=o);for(let h=i-2;;){if(n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===h)break;if(s=n,n=e[--i-1],t>=n)break t}a=i,i=0;break e}break i}for(;i<a;){const o=i+a>>>1;t<e[o]?a=o:i=o+1}if(s=e[i],n=e[i-1],n===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(s===void 0)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,n,s)}return this.interpolate_(i,n,t,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,s=this.valueSize,n=t*s;for(let a=0;a!==s;++a)e[a]=i[n+a];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class s6 extends zl{constructor(t,e,i,s){super(t,e,i,s),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Hg,endingEnd:Hg}}intervalChanged_(t,e,i){const s=this.parameterPositions;let n=t-2,a=t+1,o=s[n],h=s[a];if(o===void 0)switch(this.getSettings_().endingStart){case qg:n=t,o=2*e-i;break;case $g:n=s.length-2,o=e+s[n]-s[n+1];break;default:n=t,o=i}if(h===void 0)switch(this.getSettings_().endingEnd){case qg:a=t,h=2*i-e;break;case $g:a=1,h=i+s[1]-s[0];break;default:a=t-1,h=e}const l=(i-e)*.5,u=this.valueSize;this._weightPrev=l/(e-o),this._weightNext=l/(h-i),this._offsetPrev=n*u,this._offsetNext=a*u}interpolate_(t,e,i,s){const n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,h=t*o,l=h-o,u=this._offsetPrev,c=this._offsetNext,d=this._weightPrev,p=this._weightNext,m=(i-e)/(s-e),f=m*m,g=f*m,y=-d*g+2*d*f-d*m,x=(1+d)*g+(-1.5-2*d)*f+(-.5+d)*m+1,_=(-1-p)*g+(1.5+p)*f+.5*m,M=p*g-p*f;for(let v=0;v!==o;++v)n[v]=y*a[u+v]+x*a[l+v]+_*a[h+v]+M*a[c+v];return n}}class n6 extends zl{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t,e,i,s){const n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,h=t*o,l=h-o,u=(i-e)/(s-e),c=1-u;for(let d=0;d!==o;++d)n[d]=a[l+d]*c+a[h+d]*u;return n}}class r6 extends zl{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t){return this.copySampleValue_(t-1)}}class zi{constructor(t,e,i,s){if(t===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(e===void 0||e.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Cl(e,this.TimeBufferType),this.values=Cl(i,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:Cl(t.times,Array),values:Cl(t.values,Array)};const s=t.getInterpolation();s!==t.DefaultInterpolation&&(i.interpolation=s)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new r6(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new n6(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new s6(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case ll:e=this.InterpolantFactoryMethodDiscrete;break;case $d:e=this.InterpolantFactoryMethodLinear;break;case Xd:e=this.InterpolantFactoryMethodSmooth;break}if(e===void 0){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(t!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(i);return Wt("KeyframeTrack:",i),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return ll;case this.InterpolantFactoryMethodLinear:return $d;case this.InterpolantFactoryMethodSmooth:return Xd}}getValueSize(){return this.values.length/this.times.length}shift(t){if(t!==0){const e=this.times;for(let i=0,s=e.length;i!==s;++i)e[i]+=t}return this}scale(t){if(t!==1){const e=this.times;for(let i=0,s=e.length;i!==s;++i)e[i]*=t}return this}trim(t,e){const i=this.times,s=i.length;let n=0,a=s-1;for(;n!==s&&i[n]<t;)++n;for(;a!==-1&&i[a]>e;)--a;if(++a,n!==0||a!==s){n>=a&&(a=Math.max(a,1),n=a-1);const o=this.getValueSize();this.times=i.slice(n,a),this.values=this.values.slice(n*o,a*o)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!==0&&(Ce("KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,s=this.values,n=i.length;n===0&&(Ce("KeyframeTrack: Track is empty.",this),t=!1);let a=null;for(let o=0;o!==n;o++){const h=i[o];if(typeof h=="number"&&isNaN(h)){Ce("KeyframeTrack: Time is not a valid number.",this,o,h),t=!1;break}if(a!==null&&a>h){Ce("KeyframeTrack: Out of order keys.",this,o,h,a),t=!1;break}a=h}if(s!==void 0&&e6(s))for(let o=0,h=s.length;o!==h;++o){const l=s[o];if(isNaN(l)){Ce("KeyframeTrack: Value is not a valid number.",this,o,l),t=!1;break}}return t}optimize(){const t=this.times.slice(),e=this.values.slice(),i=this.getValueSize(),s=this.getInterpolation()===Xd,n=t.length-1;let a=1;for(let o=1;o<n;++o){let h=!1;const l=t[o],u=t[o+1];if(l!==u&&(o!==1||l!==t[0]))if(s)h=!0;else{const c=o*i,d=c-i,p=c+i;for(let m=0;m!==i;++m){const f=e[c+m];if(f!==e[d+m]||f!==e[p+m]){h=!0;break}}}if(h){if(o!==a){t[a]=t[o];const c=o*i,d=a*i;for(let p=0;p!==i;++p)e[d+p]=e[c+p]}++a}}if(n>0){t[a]=t[n];for(let o=n*i,h=a*i,l=0;l!==i;++l)e[h+l]=e[o+l];++a}return a!==t.length?(this.times=t.slice(0,a),this.values=e.slice(0,a*i)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),i=this.constructor,s=new i(this.name,t,e);return s.createInterpolant=this.createInterpolant,s}}zi.prototype.ValueTypeName="",zi.prototype.TimeBufferType=Float32Array,zi.prototype.ValueBufferType=Float32Array,zi.prototype.DefaultInterpolation=$d;class Kr extends zi{constructor(t,e,i){super(t,e,i)}}Kr.prototype.ValueTypeName="bool",Kr.prototype.ValueBufferType=Array,Kr.prototype.DefaultInterpolation=ll,Kr.prototype.InterpolantFactoryMethodLinear=void 0,Kr.prototype.InterpolantFactoryMethodSmooth=void 0;class E9 extends zi{constructor(t,e,i,s){super(t,e,i,s)}}E9.prototype.ValueTypeName="color";class Ll extends zi{constructor(t,e,i,s){super(t,e,i,s)}}Ll.prototype.ValueTypeName="number";class a6 extends zl{constructor(t,e,i,s){super(t,e,i,s)}interpolate_(t,e,i,s){const n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,h=(i-e)/(s-e);let l=t*o;for(let u=l+o;l!==u;l+=4)Dr.slerpFlat(n,0,a,l-o,a,l,h);return n}}class Pl extends zi{constructor(t,e,i,s){super(t,e,i,s)}InterpolantFactoryMethodLinear(t){return new a6(this.times,this.values,this.getValueSize(),t)}}Pl.prototype.ValueTypeName="quaternion",Pl.prototype.InterpolantFactoryMethodSmooth=void 0;class ta extends zi{constructor(t,e,i){super(t,e,i)}}ta.prototype.ValueTypeName="string",ta.prototype.ValueBufferType=Array,ta.prototype.DefaultInterpolation=ll,ta.prototype.InterpolantFactoryMethodLinear=void 0,ta.prototype.InterpolantFactoryMethodSmooth=void 0;class Bl extends zi{constructor(t,e,i,s){super(t,e,i,s)}}Bl.prototype.ValueTypeName="vector";class o6{constructor(t="",e=-1,i=[],s=w7){this.name=t,this.tracks=i,this.duration=e,this.blendMode=s,this.uuid=$i(),this.userData={},this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,s=1/(t.fps||1);for(let a=0,o=i.length;a!==o;++a)e.push(l6(i[a]).scale(s));const n=new this(t.name,t.duration,e,t.blendMode);return n.uuid=t.uuid,n.userData=JSON.parse(t.userData||"{}"),n}static toJSON(t){const e=[],i=t.tracks,s={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode,userData:JSON.stringify(t.userData)};for(let n=0,a=i.length;n!==a;++n)e.push(zi.toJSON(i[n]));return s}static CreateFromMorphTargetSequence(t,e,i,s){const n=e.length,a=[];for(let o=0;o<n;o++){let h=[],l=[];h.push((o+n-1)%n,o,(o+1)%n),l.push(0,1,0);const u=i6(h);h=N9(h,1,u),l=N9(l,1,u),!s&&h[0]===0&&(h.push(n),l.push(l[0])),a.push(new Ll(".morphTargetInfluences["+e[o].name+"]",h,l).scale(1/i))}return new this(t,-1,a)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const s=t;i=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<i.length;s++)if(i[s].name===e)return i[s];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const s={},n=/^([\w-]*?)([\d]+)$/;for(let o=0,h=t.length;o<h;o++){const l=t[o],u=l.name.match(n);if(u&&u.length>1){const c=u[1];let d=s[c];d||(s[c]=d=[]),d.push(l)}}const a=[];for(const o in s)a.push(this.CreateFromMorphTargetSequence(o,s[o],e,i));return a}static parseAnimation(t,e){if(Wt("AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!t)return Ce("AnimationClip: No animation in JSONLoader data."),null;const i=function(c,d,p,m,f){if(p.length!==0){const g=[],y=[];R9(p,g,y,m),g.length!==0&&f.push(new c(d,g,y))}},s=[],n=t.name||"default",a=t.fps||30,o=t.blendMode;let h=t.length||-1;const l=t.hierarchy||[];for(let c=0;c<l.length;c++){const d=l[c].keys;if(!(!d||d.length===0))if(d[0].morphTargets){const p={};let m;for(m=0;m<d.length;m++)if(d[m].morphTargets)for(let f=0;f<d[m].morphTargets.length;f++)p[d[m].morphTargets[f]]=-1;for(const f in p){const g=[],y=[];for(let x=0;x!==d[m].morphTargets.length;++x){const _=d[m];g.push(_.time),y.push(_.morphTarget===f?1:0)}s.push(new Ll(".morphTargetInfluence["+f+"]",g,y))}h=p.length*a}else{const p=".bones["+e[c].name+"]";i(Bl,p+".position",d,"pos",s),i(Pl,p+".quaternion",d,"rot",s),i(Bl,p+".scale",d,"scl",s)}}return s.length===0?null:new this(n,h,s,o)}resetDuration(){const t=this.tracks;let e=0;for(let i=0,s=t.length;i!==s;++i){const n=this.tracks[i];e=Math.max(e,n.times[n.times.length-1])}return this.duration=e,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let i=0;i<this.tracks.length;i++)t.push(this.tracks[i].clone());const e=new this.constructor(this.name,this.duration,t,this.blendMode);return e.userData=JSON.parse(JSON.stringify(this.userData)),e}toJSON(){return this.constructor.toJSON(this)}}function h6(r){switch(r.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ll;case"vector":case"vector2":case"vector3":case"vector4":return Bl;case"color":return E9;case"quaternion":return Pl;case"bool":case"boolean":return Kr;case"string":return ta}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+r)}function l6(r){if(r.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=h6(r.type);if(r.times===void 0){const e=[],i=[];R9(r.keys,e,i,"value"),r.times=e,r.values=i}return t.parse!==void 0?t.parse(r):new t(r.name,r.times,r.values,r.interpolation)}const I9={enabled:!1,files:{},add:function(r,t){this.enabled!==!1&&(this.files[r]=t)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};class u6{constructor(t,e,i){const s=this;let n=!1,a=0,o=0,h;const l=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.abortController=new AbortController,this.itemStart=function(u){o++,n===!1&&s.onStart!==void 0&&s.onStart(u,a,o),n=!0},this.itemEnd=function(u){a++,s.onProgress!==void 0&&s.onProgress(u,a,o),a===o&&(n=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(u){s.onError!==void 0&&s.onError(u)},this.resolveURL=function(u){return h?h(u):u},this.setURLModifier=function(u){return h=u,this},this.addHandler=function(u,c){return l.push(u,c),this},this.removeHandler=function(u){const c=l.indexOf(u);return c!==-1&&l.splice(c,2),this},this.getHandler=function(u){for(let c=0,d=l.length;c<d;c+=2){const p=l[c],m=l[c+1];if(p.global&&(p.lastIndex=0),p.test(u))return m}return null},this.abort=function(){return this.abortController.abort(),this.abortController=new AbortController,this}}}const c6=new u6;class Ol{constructor(t){this.manager=t!==void 0?t:c6,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise(function(s,n){i.load(t,s,e,n)})}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}abort(){return this}}Ol.DEFAULT_MATERIAL_NAME="__DEFAULT";const Ms={};class d6 extends Error{constructor(t,e){super(t),this.response=e}}class p6 extends Ol{constructor(t){super(t),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(t,e,i,s){t===void 0&&(t=""),this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const n=I9.get(`file:${t}`);if(n!==void 0)return this.manager.itemStart(t),setTimeout(()=>{e&&e(n),this.manager.itemEnd(t)},0),n;if(Ms[t]!==void 0){Ms[t].push({onLoad:e,onProgress:i,onError:s});return}Ms[t]=[],Ms[t].push({onLoad:e,onProgress:i,onError:s});const a=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),o=this.mimeType,h=this.responseType;fetch(a).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&Wt("FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;const u=Ms[t],c=l.body.getReader(),d=l.headers.get("X-File-Size")||l.headers.get("Content-Length"),p=d?parseInt(d):0,m=p!==0;let f=0;const g=new ReadableStream({start(y){x();function x(){c.read().then(({done:_,value:M})=>{if(_)y.close();else{f+=M.byteLength;const v=new ProgressEvent("progress",{lengthComputable:m,loaded:f,total:p});for(let N=0,T=u.length;N<T;N++){const C=u[N];C.onProgress&&C.onProgress(v)}y.enqueue(M),x()}},_=>{y.error(_)})}}});return new Response(g)}else throw new d6(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`,l)}).then(l=>{switch(h){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(u=>new DOMParser().parseFromString(u,o));case"json":return l.json();default:if(o==="")return l.text();{const c=/charset="?([^;"\s]*)"?/i.exec(o),d=c&&c[1]?c[1].toLowerCase():void 0,p=new TextDecoder(d);return l.arrayBuffer().then(m=>p.decode(m))}}}).then(l=>{I9.add(`file:${t}`,l);const u=Ms[t];delete Ms[t];for(let c=0,d=u.length;c<d;c++){const p=u[c];p.onLoad&&p.onLoad(l)}}).catch(l=>{const u=Ms[t];if(u===void 0)throw this.manager.itemError(t),l;delete Ms[t];for(let c=0,d=u.length;c<d;c++){const p=u[c];p.onError&&p.onError(l)}this.manager.itemError(t)}).finally(()=>{this.manager.itemEnd(t)}),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class m6 extends fo{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(t){return super.copy(t),this.instanceCount=t.instanceCount,this}toJSON(){const t=super.toJSON();return t.instanceCount=this.instanceCount,t.isInstancedBufferGeometry=!0,t}}class f6 extends Ol{constructor(t){super(t)}load(t,e,i,s){const n=this,a=new p6(n.manager);a.setPath(n.path),a.setRequestHeader(n.requestHeader),a.setWithCredentials(n.withCredentials),a.load(t,function(o){try{e(n.parse(JSON.parse(o)))}catch(h){s?s(h):Ce(h),n.manager.itemError(t)}},i,s)}parse(t){const e={},i={};function s(p,m){if(e[m]!==void 0)return e[m];const g=p.interleavedBuffers[m],y=n(p,g.buffer),x=cl(g.type,y),_=new Z7(x,g.stride);return _.uuid=g.uuid,e[m]=_,_}function n(p,m){if(i[m]!==void 0)return i[m];const g=p.arrayBuffers[m],y=new Uint32Array(g).buffer;return i[m]=y,y}const a=t.isInstancedBufferGeometry?new m6:new fo,o=t.data.index;if(o!==void 0){const p=cl(o.type,o.array);a.setIndex(new Ci(p,1))}const h=t.data.attributes;for(const p in h){const m=h[p];let f;if(m.isInterleavedBufferAttribute){const g=s(t.data,m.data);f=new El(g,m.itemSize,m.offset,m.normalized)}else{const g=cl(m.type,m.array),y=m.isInstancedBufferAttribute?t6:Ci;f=new y(g,m.itemSize,m.normalized)}m.name!==void 0&&(f.name=m.name),m.usage!==void 0&&f.setUsage(m.usage),a.setAttribute(p,f)}const l=t.data.morphAttributes;if(l)for(const p in l){const m=l[p],f=[];for(let g=0,y=m.length;g<y;g++){const x=m[g];let _;if(x.isInterleavedBufferAttribute){const M=s(t.data,x.data);_=new El(M,x.itemSize,x.offset,x.normalized)}else{const M=cl(x.type,x.array);_=new Ci(M,x.itemSize,x.normalized)}x.name!==void 0&&(_.name=x.name),f.push(_)}a.morphAttributes[p]=f}t.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const c=t.data.groups||t.data.drawcalls||t.data.offsets;if(c!==void 0)for(let p=0,m=c.length;p!==m;++p){const f=c[p];a.addGroup(f.start,f.count,f.materialIndex)}const d=t.data.boundingSphere;return d!==void 0&&(a.boundingSphere=new uo().fromJSON(d)),t.name&&(a.name=t.name),t.userData&&(a.userData=t.userData),a}}class g6 extends S9{constructor(t,e){super(new Uint16Array(t*e*4),t,e),this.format=qd,this.type=v7,this.minFilter=hl,this.magFilter=hl,this.needsUpdate=!0}update(t,e,i){const s=t.source.data.width,n=t.source.data.height,a=this.source.data.width;this.source.data.height;const o=e,h=i;for(let l=0;l<n;l++)for(let u=0;u<s;u++){const c=(l*s+u)*4,d=((h+l)*a+(o+u))*4;this.source.data.data[d]=t.source.data.data[c],this.source.data.data[d+1]=t.source.data.data[c+1],this.source.data.data[d+2]=t.source.data.data[c+2],this.source.data.data[d+3]=t.source.data.data[c+3],this.source.data.data[d]!=0}this.needsUpdate=!0}}var C9=function(r,t){this.init(r,t)};const z9={textureIndex:5,fit:{dummy:!0,x:0,y:0,w:1024,h:1024,used:!0,down:{x:0,y:256,w:1024,h:768},right:{x:256,y:0,w:768,h:256}}};C9.prototype={init:function(r,t){this.root={x:0,y:0,w:r,h:t},this.loop=0,this.size={w:r,h:t},this.seen={},this.index=0,this.packingNB=0,this.maxSize={w:0,h:0}},setSize:function(r,t){this.size.w=r,this.size.h=t},reset:function(r,t){this.seen={},this.root={x:0,y:0,w:this.size.w,h:this.size.h},this.loop=0,this.index=0,this.packingNB=0,this.maxSize={w:0,h:0}},fit:function(r,t={}){var e,i;const s=t.needsFitData;var n=[{x:0,y:0,w:this.size.w,h:this.size.h}],a=r;for(a=[...r].sort((o,h)=>h.w*h.h-o.w*o.h),e=0;e<a.length;e++)i=a[e],t.max==null||t.max>=this.loop+1?(delete i.textureIndex,delete i.fit,t.sort?this.refitWaste(i,n):this.refit(i)):(i=Object.assign(i,z9),i.textureIndex=z9.textureIndex),this.maxSize.w=Math.max(this.maxSize.w,i.fit.x+i.w),this.maxSize.h=Math.max(this.maxSize.h,i.fit.y+i.h),t.needsFitData!=null&&(i.uvScale={x:i.w/s,y:i.h/s},i.uvPos={x:i.fit.x/s,y:i.fit.y/s});return this.loop},refitWaste:function(r,t){this.packingNB++;var e=!1;t.sort((s,n)=>n.w*n.h-s.w*s.h);for(let s=0;s<t.length&&!e;s++){var i=t[s];r.w<=i.w&&r.h<=i.h&&(r.fit={x:i.x,y:i.y},r.textureIndex=this.loop,i.w-r.w>0&&t.push({x:i.x+r.w,y:i.y,w:i.w-r.w,h:r.h}),i.h-r.h>0&&t.push({x:i.x,y:i.y+r.h,w:r.w,h:i.h-r.h}),t.splice(s,1),e=!0)}e||(this.loop++,this.root={x:0,y:0,w:this.size.w,h:this.size.h},t=[{x:0,y:0,w:this.size.w,h:this.size.h}],this.refit(r))},refit:function(r){if(this.seen[r.url]){const n=this.seen[r.url];r.fit=Object.assign({},n.fit),r.textureIndex=n.textureIndex;return}this.packingNB++;let t=null,e=Number.MAX_SAFE_INTEGER;const i=n=>{let o=Math.max(this.maxSize.w,n.x+r.w)-this.maxSize.w;o<e&&(t=n,e=o)},s=n=>{n&&(!n.used&&r.w<=n.w&&r.h<=n.h&&i(n),s(n.right),s(n.down))};s(this.root),t?(r.fit=this.splitNode(t,r.w,r.h),r.textureIndex=this.loop,this.seen[r.url]=r):(this.loop++,this.root={x:0,y:0,w:this.size.w,h:this.size.h},this.refit(r))},findNode:function(r,t,e){return r.used?this.findNode(r.right,t,e)||this.findNode(r.down,t,e):t<=r.w&&e<=r.h?r:null},splitNode:function(r,t,e){return r.used=!0,r.down={x:r.x,y:r.y+e,w:r.w,h:r.h-e},r.right={x:r.x+t,y:r.y,w:r.w-t,h:e},r}};class y6 extends Ol{constructor(t){super(t)}parse(t,e){const i=this.parseAnimations(t.animations),s=this.parseShapes(t.shapes),n=this.parseGeometries(t.geometries,s),a=this.parseImages(t.images,function(){e!==void 0&&e(l)}),o=this.parseTextures(t.textures,a),h=this.parseMaterials(t.materials,o),l=this.parseObject(t.object,n,h,o,i),u=this.parseSkeletons(t.skeletons,l);if(this.bindSkeletons(l,u),e!==void 0){let c=!1;for(const d in a)if(a[d].data instanceof HTMLImageElement){c=!0;break}c===!1&&e(l)}return l}async parseAsync(t){const e=this.parseAnimations(t.animations),i=this.parseShapes(t.shapes),s=this.parseGeometries(t.geometries,i),n=await this.parseImagesAsync(t.images),a=this.parseTextures(t.textures,n),o=this.parseMaterials(t.materials,a),h=this.parseObject(t.object,s,o,a,e),l=this.parseSkeletons(t.skeletons,h);return this.bindSkeletons(h,l),h}parseShapes(t){return{}}parseSkeletons(t,e){const i={},s={};if(e.traverse(function(n){n.isBone&&(s[n.uuid]=n)}),t!==void 0)for(let n=0,a=t.length;n<a;n++){const o=new x0().fromJSON(t[n],s);i[o.uuid]=o}return i}parseGeometries(t,e){const i={};if(t!==void 0){const s=new f6;for(let n=0,a=t.length;n<a;n++){let o;const h=t[n];switch(h.type){case"BufferGeometry":case"InstancedBufferGeometry":o=s.parse(h);break;default:}o.uuid=h.uuid,h.name!==void 0&&(o.name=h.name),h.userData!==void 0&&(o.userData=h.userData),i[h.uuid]=o}}return i}parseMaterials(t,e){const i={},s={};if(t!==void 0)for(let n=0,a=t.length;n<a;n++){const o=t[n];i[o.uuid]===void 0&&(i[o.uuid]=new m9),s[o.uuid]=i[o.uuid]}return s}parseAnimations(t){const e={};if(t!==void 0)for(let i=0;i<t.length;i++){const s=t[i],n=o6.parse(s);e[n.uuid]=n}return e}parseImages(t,e){return{}}async parseImagesAsync(t){return{}}parseTextures(t,e){return{}}parseObject(t,e,i,s,n){let a;function o(d){return e[d],e[d]}function h(d){if(d!==void 0){if(Array.isArray(d)){const p=[];for(let m=0,f=d.length;m<f;m++){const g=d[m];i[g],p.push(i[g])}return p}return i[d],i[d]}}function l(d){return s[d],s[d]}let u,c;switch(t.type){case"Scene":a=new Y7,t.background!==void 0&&(Number.isInteger(t.background)?a.background=new po(t.background):a.background=l(t.background)),t.environment!==void 0&&(a.environment=l(t.environment)),t.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=t.backgroundBlurriness),t.backgroundIntensity!==void 0&&(a.backgroundIntensity=t.backgroundIntensity),t.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(t.backgroundRotation),t.environmentRotation!==void 0&&a.environmentRotation.fromArray(t.environmentRotation);break;case"SkinnedMesh":u=o(t.geometry),c=h(t.material),a=new Q7(u,c),t.bindMode!==void 0&&(a.bindMode=t.bindMode),t.bindMatrix!==void 0&&a.bindMatrix.fromArray(t.bindMatrix),t.skeleton!==void 0&&(a.skeleton=t.skeleton);break;case"Mesh":u=o(t.geometry),c=h(t.material),a=new x9(u,c);break;case"Group":a=new G7;break;case"Bone":a=new T9;break;default:a=new Ue}if(a.uuid=t.uuid,t.name!==void 0&&(a.name=t.name),t.matrix!==void 0?(a.matrix.fromArray(t.matrix),t.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=t.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(t.position!==void 0&&a.position.fromArray(t.position),t.rotation!==void 0&&a.rotation.fromArray(t.rotation),t.quaternion!==void 0&&a.quaternion.fromArray(t.quaternion),t.scale!==void 0&&a.scale.fromArray(t.scale)),t.up!==void 0&&a.up.fromArray(t.up),t.castShadow!==void 0&&(a.castShadow=t.castShadow),t.receiveShadow!==void 0&&(a.receiveShadow=t.receiveShadow),t.shadow&&(t.shadow.bias!==void 0&&(a.shadow.bias=t.shadow.bias),t.shadow.normalBias!==void 0&&(a.shadow.normalBias=t.shadow.normalBias),t.shadow.radius!==void 0&&(a.shadow.radius=t.shadow.radius),t.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(t.shadow.mapSize),t.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(t.shadow.camera))),t.visible!==void 0&&(a.visible=t.visible),t.frustumCulled!==void 0&&(a.frustumCulled=t.frustumCulled),t.renderOrder!==void 0&&(a.renderOrder=t.renderOrder),t.userData!==void 0&&(a.userData=t.userData),t.layers!==void 0&&(a.layers.mask=t.layers),t.children!==void 0){const d=t.children;for(let p=0;p<d.length;p++)a.add(this.parseObject(d[p],e,i,s,n))}if(t.animations!==void 0){const d=t.animations;for(let p=0;p<d.length;p++){const m=d[p];a.animations.push(n[m])}}return a}bindSkeletons(t,e){Object.keys(e).length!==0&&t.traverse(function(i){if(i.isSkinnedMesh===!0&&i.skeleton!==void 0){const s=e[i.skeleton];s===void 0||i.bind(s,i.bindMatrix)}})}}const x6={mixamorigHips:"hips",mixamorigSpine:"spine",mixamorigSpine1:"chest",mixamorigSpine2:"upperChest",mixamorigNeck:"neck",mixamorigHead:"head",mixamorigLeftShoulder:"leftShoulder",mixamorigLeftArm:"leftUpperArm",mixamorigLeftForeArm:"leftLowerArm",mixamorigLeftHand:"leftHand",mixamorigLeftHandThumb1:"leftThumbMetacarpal",mixamorigLeftHandThumb2:"leftThumbProximal",mixamorigLeftHandThumb3:"leftThumbDistal",mixamorigLeftHandIndex1:"leftIndexProximal",mixamorigLeftHandIndex2:"leftIndexIntermediate",mixamorigLeftHandIndex3:"leftIndexDistal",mixamorigLeftHandMiddle1:"leftMiddleProximal",mixamorigLeftHandMiddle2:"leftMiddleIntermediate",mixamorigLeftHandMiddle3:"leftMiddleDistal",mixamorigLeftHandRing1:"leftRingProximal",mixamorigLeftHandRing2:"leftRingIntermediate",mixamorigLeftHandRing3:"leftRingDistal",mixamorigLeftHandPinky1:"leftLittleProximal",mixamorigLeftHandPinky2:"leftLittleIntermediate",mixamorigLeftHandPinky3:"leftLittleDistal",mixamorigRightShoulder:"rightShoulder",mixamorigRightArm:"rightUpperArm",mixamorigRightForeArm:"rightLowerArm",mixamorigRightHand:"rightHand",mixamorigRightHandPinky1:"rightLittleProximal",mixamorigRightHandPinky2:"rightLittleIntermediate",mixamorigRightHandPinky3:"rightLittleDistal",mixamorigRightHandRing1:"rightRingProximal",mixamorigRightHandRing2:"rightRingIntermediate",mixamorigRightHandRing3:"rightRingDistal",mixamorigRightHandMiddle1:"rightMiddleProximal",mixamorigRightHandMiddle2:"rightMiddleIntermediate",mixamorigRightHandMiddle3:"rightMiddleDistal",mixamorigRightHandIndex1:"rightIndexProximal",mixamorigRightHandIndex2:"rightIndexIntermediate",mixamorigRightHandIndex3:"rightIndexDistal",mixamorigRightHandThumb1:"rightThumbMetacarpal",mixamorigRightHandThumb2:"rightThumbProximal",mixamorigRightHandThumb3:"rightThumbDistal",mixamorigLeftUpLeg:"leftUpperLeg",mixamorigLeftLeg:"leftLowerLeg",mixamorigLeftFoot:"leftFoot",mixamorigLeftToeBase:"leftToes",mixamorigRightUpLeg:"rightUpperLeg",mixamorigRightLeg:"rightLowerLeg",mixamorigRightFoot:"rightFoot",mixamorigRightToeBase:"rightToes"};var b6={metadata:{version:4.5,type:"Object",generator:"Object3D.toJSON"},object:JSON.parse('{"uuid":"da8c50b7-a418-4c81-a9fe-5a421c1bc44d","type":"Group","name":"Armature001","userData":{"transformData":{"eulerOrder":"ZYX","parentMatrix":{"elements":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},"parentMatrixWorld":{"elements":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}}},"layers":1,"matrix":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],"children":[{"uuid":"72868336-e498-4309-8df1-97b8f74e29ca","type":"Bone","name":"mixamorigHips","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,96.74480000054845,0],"rotation":[0,0,-0.0014],"parentMatrix":{"elements":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},"parentMatrixWorld":{"elements":[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}}},"layers":1,"matrix":[0.9999999997014749,-0.000024434609525489164,0,0,0.000024434609525489164,0.9999999997014749,0,0,0,0,1,0,0,96.74480000054845,0,1],"children":[{"uuid":"ce45c995-cb4b-46ba-81cd-c4ce074a2477","type":"Bone","name":"mixamorigSpine","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,9.5226,0.023700000000000002],"rotation":[0.1424,0,0.0014],"parentMatrix":{"elements":[0.9999999997014749,-0.000024434609525489164,0,0,0.000024434609525489164,0.9999999997014749,0,0,0,0,1,0,0,96.74480000054845,0,1]},"parentMatrixWorld":{"elements":[0.9999999997014749,-0.000024434609525489164,0,0,0.000024434609525489164,0.9999999997014749,0,0,0,0,1,0,0,96.74480000054845,0,1]}}},"layers":1,"matrix":[0.9999999997014749,0.000024434609525489164,6.617444900424222e-24,0,-0.000024434534059738246,0.9999969112236002,0.002485346296191081,0,6.07284662830498e-8,-0.0024853462954491437,0.9999969115221247,0,-4.336808689942018e-19,9.522599999999997,0.023700000000000002,1],"children":[{"uuid":"253a0bab-df29-4c33-b461-fe02bc81d7ef","type":"Bone","name":"mixamorigSpine1","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,11.1097,0],"parentMatrix":{"elements":[0.9999999997014749,0.000024434609525489164,6.617444900424222e-24,0,-0.000024434534059738246,0.9999969112236002,0.002485346296191081,0,6.07284662830498e-8,-0.0024853462954491437,0.9999969115221247,0,-4.336808689942018e-19,9.522599999999997,0.023700000000000002,1]},"parentMatrixWorld":{"elements":[1,0,6.617444900424222e-24,0,0,0.9999969115221243,0.002485346296191081,0,-1.3234889800848443e-23,-0.002485346296191082,0.9999969115221247,0,0.0002326810126674226,106.26739999770571,0.023700000000000002,1]}}},"layers":1,"matrix":[1,0,0,0,0,1,-2.168404344971009e-19,0,0,2.168404344971009e-19,1,0,-2.710505431213761e-20,11.109700000000004,-5.551115123125783e-17,1],"children":[{"uuid":"de807882-a205-49bc-9846-2072d78c72a2","type":"Bone","name":"mixamorigSpine2","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,12.6968,0],"parentMatrix":{"elements":[1,0,0,0,0,1,-2.168404344971009e-19,0,0,2.168404344971009e-19,1,0,-2.710505431213761e-20,11.109700000000004,-5.551115123125783e-17,1]},"parentMatrixWorld":{"elements":[1,0,6.617444900424222e-24,0,2.8698592549372254e-42,0.9999969115221243,0.002485346296191081,0,-1.3234889800848443e-23,-0.002485346296191082,0.9999969115221247,0,0.00023268101266742258,117.37706568564306,0.05131145174679401,1]}}},"layers":1,"matrix":[1,-2.8698592549372254e-42,3.111507638930571e-61,0,2.8698592549372254e-42,1,-2.168404344971009e-19,0,3.111507638930571e-61,2.168404344971009e-19,1,0,-2.710505431213761e-20,12.696799999999982,0,1],"children":[{"uuid":"b517e80a-4cd8-408e-8f47-196ca8a1f036","type":"Bone","name":"mixamorigNeck","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,14.2839,0],"rotation":[-0.1424,0,0],"parentMatrix":{"elements":[1,-2.8698592549372254e-42,3.111507638930571e-61,0,2.8698592549372254e-42,1,-2.168404344971009e-19,0,3.111507638930571e-61,2.168404344971009e-19,1,0,-2.710505431213761e-20,12.696799999999982,0,1]},"parentMatrixWorld":{"elements":[1,-2.8698503914404102e-42,6.617444900424222e-24,0,8.609577764811676e-42,0.9999969115221243,0.002485346296191081,0,-1.3234889800848443e-23,-0.002485346296191082,0.9999969115221247,0,0.00023268101266742255,130.07382647185716,0.08286739660027288,1]}}},"layers":1,"matrix":[1,2.8698681184340424e-42,-3.566313556593716e-45,0,-2.8698681184340424e-42,0.9999969115221247,-0.002485346296191082,0,-3.566313556593716e-45,0.002485346296191082,0.9999969115221247,0,-2.710505431213761e-20,14.283899999999988,-5.551115123125783e-17,1],"children":[{"uuid":"33da5c43-1893-42f9-b38f-bb436294ee8b","type":"Bone","name":"mixamorigHead","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,13.4915,1.3775],"parentMatrix":{"elements":[1,2.8698681184340424e-42,-3.566313556593716e-45,0,-2.8698681184340424e-42,0.9999969115221247,-0.002485346296191082,0,-3.566313556593716e-45,0.002485346296191082,0.9999969115221247,0,-2.710505431213761e-20,14.283899999999988,-5.551115123125783e-17,1]},"parentMatrixWorld":{"elements":[1,1.77269936312668e-47,6.617444900424222e-24,0,3.289328434703581e-26,0.9999999999999997,-8.673617379884035e-19,0,-1.323484892518411e-23,-8.673617379884035e-19,1,0,0.00023268101266742252,144.35768235634802,0.11836783456043659,1]}}},"layers":1,"matrix":[1,2.8698415279435976e-42,-7.346839692639297e-40,0,-2.8698415279435976e-42,1,1.0542132824540315e-81,0,7.346839692639297e-40,1.0542132824540315e-81,1,0,-2.710505431213761e-20,13.491500000000002,1.3775000000000002,1],"children":[{"uuid":"51c5b160-1312-4de1-a79f-6c32acf47585","type":"Bone","name":"mixamorigHeadTop_End","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,29.6463,3.0268],"parentMatrix":{"elements":[1,2.8698415279435976e-42,-7.346839692639297e-40,0,-2.8698415279435976e-42,1,1.0542132824540315e-81,0,7.346839692639297e-40,1.0542132824540315e-81,1,0,-2.710505431213761e-20,13.491500000000002,1.3775000000000002,1]},"parentMatrixWorld":{"elements":[1,2.8698592549372285e-42,6.617444900424221e-24,0,3.289328434703581e-26,0.9999999999999997,-8.673617379884035e-19,0,-1.3234848925184109e-23,-8.673617379884035e-19,1,0,0.0002326810126674225,157.84918235634802,1.4958678345604368,1]}}},"layers":1,"matrix":[1,2.8698415279435963e-42,-1.1020259538958945e-39,0,-2.8698415279435963e-42,1,1.5813199236810466e-81,0,1.1020259538958945e-39,1.5813199236810466e-81,1,0,-2.710505431213761e-20,29.646300000000025,3.0267999999999997,1],"children":[{"uuid":"c78fe254-d400-44bb-817b-eb0f215a44a5","type":"Bone","name":"mixamorigHeadTop_End_end","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,29.8004,0],"parentMatrix":{"elements":[1,2.8698415279435963e-42,-1.1020259538958945e-39,0,-2.8698415279435963e-42,1,1.5813199236810466e-81,0,1.1020259538958945e-39,1.5813199236810466e-81,1,0,-2.710505431213761e-20,29.646300000000025,3.0267999999999997,1]},"parentMatrixWorld":{"elements":[1,5.7397007828808255e-42,6.61744490042422e-24,0,3.289328434703581e-26,0.9999999999999997,-8.673617379884035e-19,0,-1.3234848925184107e-23,-8.673617379884035e-19,1,0,0.00023268101266742247,187.49548235634805,4.522667834560437,1]}}},"layers":1,"matrix":[1,2.8698415279435963e-42,-1.1020259538958945e-39,0,-2.8698415279435963e-42,1,1.5813199236810466e-81,0,1.1020259538958945e-39,1.5813199236810466e-81,1,0,-2.710505431213761e-20,29.800399999999996,0,1]}]}]}]},{"uuid":"fb20c7d4-d183-4e98-860f-c2af5d3f6498","type":"Bone","name":"mixamorigLeftShoulder","userData":{"transformData":{"eulerOrder":"ZYX","translation":[9.0017,10.9111,-0.0172],"rotation":[-71.96187471293732,89.85139705248493,-166.41035459968032],"parentMatrix":{"elements":[1,-2.8698592549372254e-42,3.111507638930571e-61,0,2.8698592549372254e-42,1,-2.168404344971009e-19,0,3.111507638930571e-61,2.168404344971009e-19,1,0,-2.710505431213761e-20,12.696799999999982,0,1]},"parentMatrixWorld":{"elements":[1,-2.8698503914404102e-42,6.617444900424222e-24,0,8.609577764811676e-42,0.9999969115221243,0.002485346296191081,0,-1.3234889800848443e-23,-0.002485346296191082,0.9999969115221247,0,0.00023268101266742255,130.07382647185716,0.08286739660027288,1]}}},"layers":1,"matrix":[-0.0025209958118113107,-0.0006094108306226587,-0.999996636593622,0,0.9969843722061047,-0.07756339188769296,-0.0024661337503065744,0,-0.07756162812186863,-0.9969872360553651,0.0008031100604826149,0,9.0017,10.911100000000033,-0.01720000000000005,1],"children":[{"uuid":"b715f4eb-b1c2-4a2b-9bdb-1f6dd9c6df2a","type":"Bone","name":"mixamorigLeftArm","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,19.2615,0],"rotation":[-4.448438530650885,-0.15740586638254758,0.15712458866658802],"parentMatrix":{"elements":[-0.0025209958118113107,-0.0006094108306226587,-0.999996636593622,0,0.9969843722061047,-0.07756339188769296,-0.0024661337503065744,0,-0.07756162812186863,-0.9969872360553651,0.0008031100604826149,0,9.0017,10.911100000000033,-0.01720000000000005,1]},"parentMatrixWorld":{"elements":[-0.0025209958118113107,0.0018759289884907066,-0.9999950627230852,0,0.9969843722061047,-0.07755702313849092,-0.002658898022455144,0,-0.07756162812186863,-0.9969861528889584,-0.0016747509543850229,0,9.001932681012667,140.98493552112254,0.09278531169446289,1]}}},"layers":1,"matrix":[0.9999924661077078,0.002742327622072532,0.002747247174570846,0,-0.0025209958118734416,0.9969843722061053,-0.07756162812186905,0,-0.002951661894846031,0.07755411798229549,0.996983774429678,0,0,19.261500000000005,-2.842170943040401e-14,1],"children":[{"uuid":"890c4303-4756-480a-9ab2-1d6424a4b27c","type":"Bone","name":"mixamorigLeftForeArm","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,28.5167,0],"rotation":[-3.2600864395404895e-20,-0.0018000000000000125,-3.030552506805331e-17],"parentMatrix":{"elements":[0.9999924661077078,0.002742327622072532,0.002747247174570846,0,-0.0025209958118734416,0.9969843722061053,-0.07756162812186905,0,-0.002951661894846031,0.07755411798229549,0.996983774429678,0,0,19.261500000000005,-2.842170943040401e-14,1]},"parentMatrixWorld":{"elements":[6.212979891846715e-14,-0.0010757393030050913,-0.9999994213923088,0,0.9999999999999998,1.8041124150158794e-16,6.227741304425105e-14,0,1.6653345369377348e-16,-0.9999994213923087,0.0010757393030050334,0,28.20534716626056,139.4910709199405,0.04157094743494317,1]}}},"layers":1,"matrix":[0.9999999995065197,-5.289311937342569e-19,0.0000314159265307302,0,5.289312118706982e-19,1,-5.689924224030202e-22,0,-0.0000314159265307302,5.856092862141737e-22,0.9999999995065197,0,0,28.516699999999993,0,1],"children":[{"uuid":"fbb87765-967b-4ad2-b6af-4a4ca50ee9cc","type":"Bone","name":"mixamorigLeftHand","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,26.2374,0],"rotation":[-0.038545860602483606,0.33727777507723544,-6.8982612388886615],"parentMatrix":{"elements":[0.9999999995065197,-5.289311937342569e-19,0.0000314159265307302,0,5.289312118706982e-19,1,-5.689924224030202e-22,0,-0.0000314159265307302,5.856092862141737e-22,0.9999999995065197,0,0,28.516699999999993,0,1]},"parentMatrixWorld":{"elements":[6.212927518841633e-14,-0.0011071552108274686,-0.999999387103482,0,0.9999999999999998,1.8041124150158791e-16,6.227688411273313e-14,0,1.6458217402268713e-16,-0.9999993871034819,0.0011071552108274107,0,56.722047166260545,139.4910709199405,0.041570947436719116,1]}}},"layers":1,"matrix":[0.9927437866761479,-0.12010463049487524,-0.005886573671689028,0,0.12010275274986991,0.9927612382653539,-0.0006727404736605241,0,0.005924761413454173,-0.00003913477696270708,0.9999824476812893,0,0,26.237399999999994,0,1],"children":[{"uuid":"7f2e47bf-c5ee-4d11-8c78-b9a872ff8200","type":"Bone","name":"mixamorigLeftHandThumb1","userData":{"transformData":{"eulerOrder":"ZYX","translation":[-2.4392,2.3863,0.9397000000000001],"rotation":[27.447206415882494,-0.5570215165055303,55.038672555014166],"parentMatrix":{"elements":[0.9927437866761479,-0.12010463049487524,-0.005886573671689028,0,0.12010275274986991,0.9927612382653539,-0.0006727404736605241,0,0.005924761413454173,-0.00003913477696270708,0.9999824476812893,0,0,26.237399999999994,0,1]},"parentMatrixWorld":{"elements":[-0.12010463049481354,0.00478744860739341,-0.9927496955776598,0,0.9927612382653611,0.0005397676727986677,-0.12010342396737007,0,-0.00003913477696217439,-0.9999883944260007,-0.004817622004502247,0,82.95944716626053,139.4910709199405,0.0415709474383531,1]}}},"layers":1,"matrix":[0.5729963287660444,0.8195002719015779,0.009721706325332678,0,-0.7298560876485989,0.5048491719226011,0.4609093239796133,0,0.37280732093524654,-0.27119479707823374,0.8873939843692762,0,-2.4392000000000014,2.3862999999999914,0.9396999999999878,1],"children":[{"uuid":"bf0e78c8-a2c3-4919-a77d-4f42a523a788","type":"Bone","name":"mixamorigLeftHandThumb2","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0.7967000000000001,2.7171000000000003,0],"rotation":[-0.20266993247823886,0.9246846736890448,-28.70505806549271],"parentMatrix":{"elements":[0.5729963287660444,0.8195002719015779,0.009721706325332678,0,-0.7298560876485989,0.5048491719226011,0.4609093239796133,0,0.37280732093524654,-0.27119479707823374,0.8873939843692762,0,-2.4392000000000014,2.3862999999999914,0.9396999999999878,1]},"parentMatrixWorld":{"elements":[0.7447482118936715,-0.006536063268535794,-0.6673135550534919,0,0.5888357471929552,-0.4641256221101148,0.6617098077923681,0,-0.31404229605085565,-0.8857452719477806,-0.3418080594621173,0,85.62139574888619,138.54099232865286,2.1719560848804176,1]}}},"layers":1,"matrix":[0.8769895431950642,-0.48023838156541504,-0.016138091521120054,0,0.4802478561370471,0.8771256966906998,-0.0035367895928906067,0,0.01585363687874789,-0.004648556365715175,0.9998635172469449,0,0.7966999999999942,2.7170999999999843,0,1],"children":[{"uuid":"2902e8df-5bc4-467a-b4cb-6e5f48c08701","type":"Bone","name":"mixamorigLeftHandThumb3","userData":{"transformData":{"eulerOrder":"ZYX","translation":[-0.6532,2.9805,0],"rotation":[-0.029746331996539442,0.5025031768655199,8.97359811675341],"parentMatrix":{"elements":[0.8769895431950642,-0.48023838156541504,-0.016138091521120054,0,0.4802478561370471,0.8771256966906998,-0.0035367895928906067,0,0.01585363687874789,-0.004648556365715175,0.9998635172469449,0,0.7966999999999942,2.7170999999999843,0,1]},"parentMatrixWorld":{"elements":[0.3754229112193366,0.23145311672812835,-0.8974893272281487,0,0.8752573986412447,-0.4071027453578524,0.2611356751687909,0,-0.3049297031372303,-0.8835704892530841,-0.3554167506824993,0,87.81466225799984,137.27470931921144,3.438239094321937,1]}}},"layers":1,"matrix":[0.9877223322869354,0.15597332303594982,-0.008770222504563965,0,-0.15598379836390303,0.9877594773677183,-0.0005191514435217771,0,0.008581896621701703,0.0018807900933639288,0.9999614060947547,0,-0.6532000000000053,2.980499999999985,2.842170943040401e-14,1],"children":[{"uuid":"c9011511-a9ff-4feb-bc13-a70431ef7976","type":"Bone","name":"mixamorigLeftHandThumb4","userData":{"transformData":{"eulerOrder":"ZYX","translation":[-0.14350000000000002,2.4242,0],"parentMatrix":{"elements":[0.9877223322869354,0.15597332303594982,-0.008770222504563965,0,-0.15598379836390303,0.9877594773677183,-0.0005191514435217771,0,0.008581896621701703,0.0018807900933639288,0.9999614060947547,0,-0.6532000000000053,2.980499999999985,2.842170943040401e-14,1]},"parentMatrixWorld":{"elements":[0.5100046997861543,0.1728633540484809,-0.8426229684877723,0,0.8061422036548345,-0.4377638243851039,0.39811754739807026,0,-0.3000499186511503,-0.8823157569072632,-0.36261405299657207,0,90.17814068904158,135.91015441082553,4.802794002707936,1]}}},"layers":1,"matrix":[1,1.5407439555097887e-33,-2.7755575615628914e-17,0,1.5407439555097887e-33,1,1.1102230246251565e-16,0,2.7755575615628914e-17,-1.1102230246251565e-16,1,0,-0.14349999999998886,2.4242000000000097,-2.842170943040401e-14,1],"children":[{"uuid":"49f3f9d7-aed3-4376-953e-4dca2dc293ab","type":"Bone","name":"mixamorigLeftHandThumb4_end","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,2.4285,0],"parentMatrix":{"elements":[1,1.5407439555097887e-33,-2.7755575615628914e-17,0,1.5407439555097887e-33,1,1.1102230246251565e-16,0,2.7755575615628914e-17,-1.1102230246251565e-16,1,0,-0.14349999999998886,2.4242000000000097,-2.842170943040401e-14,1]},"parentMatrixWorld":{"elements":[0.5100046997861543,0.17286335404848094,-0.8426229684877723,0,0.8061422036548345,-0.43776382438510403,0.3981175473980702,0,-0.3000499186511504,-0.8823157569072632,-0.3626140529965721,0,92.05920494472234,134.82412145644523,5.888826957088337,1]}}},"layers":1,"matrix":[1,2.7755575615628907e-17,1.7105694144590048e-49,0,-2.7755575615628914e-17,1.0000000000000002,1.2325951644078312e-32,0,1.7105694144590048e-49,-1.232595164407831e-32,1,0,-1.4210854715202004e-14,2.4284999999999997,0,1]}]}]}]}]},{"uuid":"bc44ff3f-6637-4027-b363-e18206afc726","type":"Bone","name":"mixamorigLeftHandIndex1","userData":{"transformData":{"eulerOrder":"ZYX","translation":[-3.6697,10.0472,-0.028800000000000003],"rotation":[-0.002225945733885642,-0.08880002245061369,6.887618099187062],"parentMatrix":{"elements":[0.9927437866761479,-0.12010463049487524,-0.005886573671689028,0,0.12010275274986991,0.9927612382653539,-0.0006727404736605241,0,0.005924761413454173,-0.00003913477696270708,0.9999824476812893,0,0,26.237399999999994,0,1]},"parentMatrixWorld":{"elements":[-0.12010463049481354,0.00478744860739341,-0.9927496955776598,0,0.9927612382653611,0.0005397676727986677,-0.12010342396737007,0,-0.00003913477696217439,-0.9999883944260007,-0.004817622004502247,0,82.95944716626053,139.4910709199405,0.0415709474383531,1]}}},"layers":1,"matrix":[0.9927820885575362,0.11992215223910153,0.0015498521471391802,0,-0.119922236400513,0.9927832873831902,-0.0000388500353574669,0,-0.0015433262894493638,-0.00014729211633234725,0.9999987982237761,0,-3.6697000000000006,10.047199999999975,-0.028799999999989723,1],"children":[{"uuid":"f654c2df-ac3f-462f-b2ac-83c90d3fba61","type":"Bone","name":"mixamorigLeftHandIndex2","userData":{"transformData":{"eulerOrder":"ZYX","translation":[-0.0006000000000000001,3.2658,0],"rotation":[-3.0555409560334914e-13,-0.0004999999999999936,0.010526507232854783],"parentMatrix":{"elements":[0.9927820885575362,0.11992215223910153,0.0015498521471391802,0,-0.119922236400513,0.9927832873831902,-0.0000388500353574669,0,-0.0015433262894493638,-0.00014729211633234725,0.9999987982237761,0,-3.6697000000000006,10.047199999999975,-0.028799999999989723,1]},"parentMatrixWorld":{"elements":[-0.00018372220885265987,0.003267789168125607,-0.9999946438857076,0,0.9999999831230745,6.003654536030088e-7,-0.0001837212279160431,0,-5.090939063541466e-16,-0.9999946607625422,-0.0032677892232758966,0,93.37466696896864,139.50772523930758,2.478100131528464,1]}}},"layers":1,"matrix":[0.9999999830849976,0.00018372220890776244,0.000008726646259860406,0,-0.000183722208914758,0.9999999831230747,-5.332924873074638e-15,0,-0.000008726646112582428,-1.6032733943544824e-9,0.9999999999619227,0,-0.0005999999999999339,3.2657999999999703,2.842170943040401e-14,1],"children":[{"uuid":"65fe199b-a3a2-4ea8-b4be-e1291f85920e","type":"Bone","name":"mixamorigLeftHandIndex3","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,2.9871,0],"rotation":[0.0000028453498896319773,0.010799999227898593,0.01509505028682025],"parentMatrix":{"elements":[0.9999999830849976,0.00018372220890776244,0.000008726646259860406,0,-0.000183722208914758,0.9999999831230747,-5.332924873074638e-15,0,-0.000008726646112582428,-1.6032733943544824e-9,0.9999999999619227,0,-0.0005999999999999339,3.2657999999999703,2.842170943040401e-14,1]},"parentMatrixWorld":{"elements":[6.209813577234814e-14,0.0032590626234851885,-0.9999946892413062,0,0.9999999999999996,4.567826277571803e-15,6.223276934430504e-14,0,4.823289058076524e-15,-0.9999946892413056,-0.003259062623485244,0,96.64046702408527,139.50772523930755,2.478100131528667,1]}}},"layers":1,"matrix":[0.9999999475295701,0.00026345832053092894,-0.00018849554462345048,0,-0.00026345831585051604,0.9999999652948559,4.9660723063098295e-8,0,0.00018849555116521615,-1.7255587548498054e-15,0.9999999822347134,0,-4.440892098500626e-16,2.987099999999998,0,1],"children":[{"uuid":"5e3e3c08-2e35-4e91-b36b-85401d2a83de","type":"Bone","name":"mixamorigLeftHandIndex4","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0.0006000000000000001,2.2774,0],"parentMatrix":{"elements":[0.9999999475295701,0.00026345832053092894,-0.00018849554462345048,0,-0.00026345831585051604,0.9999999652948559,4.9660723063098295e-8,0,0.00018849555116521615,-1.7255587548498054e-15,0.9999999822347134,0,-4.440892098500626e-16,2.987099999999998,0,1]},"parentMatrixWorld":{"elements":[0.00026345832059302603,0.003447556996049871,-0.9999940224523708,0,0.9999999652948555,-9.082876047939277e-7,0.00026345675490180103,0,3.109435439868349e-15,-0.9999940571573079,-0.0034475571156978918,0,99.62756702408527,139.50772523930755,2.4781001315288536,1]}}},"layers":1,"matrix":[1.0000000000000002,-2.710505431213761e-20,-6.505213034913026e-19,0,2.7105054312137605e-20,1,1.0587911840678753e-22,0,6.505213034913026e-19,-1.0587911840678757e-22,1.0000000000000002,0,0.0005999999999997119,2.277399999999986,0,1],"children":[{"uuid":"833d0d5c-baec-43df-96c1-1448c8fe5cf3","type":"Bone","name":"mixamorigLeftHandIndex4_end","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,2.2774,0],"parentMatrix":{"elements":[1.0000000000000002,-2.710505431213761e-20,-6.505213034913026e-19,0,2.7105054312137605e-20,1,1.0587911840678753e-22,0,6.505213034913026e-19,-1.0587911840678757e-22,1.0000000000000002,0,0.0005999999999997119,2.277399999999986,0,1]},"parentMatrixWorld":{"elements":[0.0002634583205930261,0.0034475569960498724,-0.999994022452371,0,0.9999999652948555,-9.082876047939277e-7,0.00026345675490180103,0,3.1094355053744852e-15,-0.9999940571573082,-0.003447557115697893,0,101.90496710312274,139.50772523930755,2.4781001315289957,1]}}},"layers":1,"matrix":[1.0000000000000002,-2.710505431213761e-20,-2.168404344971009e-19,0,2.7105054312137605e-20,1,5.293955920339378e-23,0,2.168404344971009e-19,-5.29395592033938e-23,1.0000000000000002,0,0,2.2773999999999717,-2.842170943040401e-14,1]}]}]}]}]},{"uuid":"ebc5b54e-3493-4a27-acbb-d7bfec52a0ee","type":"Bone","name":"mixamorigLeftHandMiddle1","userData":{"transformData":{"eulerOrder":"ZYX","translation":[-1.2276,10.1471,-0.0004],"rotation":[-0.0022325047624279348,-0.027200011752677573,6.877597494246605],"parentMatrix":{"elements":[0.9927437866761479,-0.12010463049487524,-0.005886573671689028,0,0.12010275274986991,0.9927612382653539,-0.0006727404736605241,0,0.005924761413454173,-0.00003913477696270708,0.9999824476812893,0,0,26.237399999999994,0,1]},"parentMatrixWorld":{"elements":[-0.12010463049481354,0.00478744860739341,-0.9927496955776598,0,0.9927612382653611,0.0005397676727986677,-0.12010342396737007,0,-0.00003913477696217439,-0.9999883944260007,-0.004817622004502247,0,82.95944716626053,139.4910709199405,0.0415709474383531,1]}}},"layers":1,"matrix":[0.9928041273710065,0.11974865054256123,0.00047472974383386827,0,-0.11974864558090637,0.9928042407057406,-0.000038964554270272645,0,-0.00047597965566027186,-0.000018164073540378103,0.9999998865567105,0,-1.2276000000000007,10.147100000000009,-0.0004000000000132786,1],"children":[{"uuid":"1414365b-29b4-4ca1-b3b8-1ac0011325e0","type":"Bone","name":"mixamorigLeftHandMiddle2","userData":{"transformData":{"eulerOrder":"ZYX","translation":[-0.0012000000000000001,3.3466,0],"rotation":[-7.517118491490686e-8,-0.0001999623647883335,0.04208380272392522],"parentMatrix":{"elements":[0.9928041273710065,0.11974865054256123,0.00047472974383386827,0,-0.11974864558090637,0.9928042407057406,-0.000038964554270272645,0,-0.00047597965566027186,-0.000018164073540378103,0.9999998865567105,0,-1.2276000000000007,10.147100000000009,-0.0004000000000132786,1]},"parentMatrixWorld":{"elements":[-0.0003585728568240822,0.004342910953098197,-0.9999905052299046,0,0.9999999357127509,0.0000015572500910834207,-0.00035856947530858247,0,3.640134255220723e-15,-0.9999905695165472,-0.004342911232292071,0,93.18053518711233,139.4910709199405,0.041570947438988815,1]}}},"layers":1,"matrix":[0.999999730248122,0.0007345008532449361,0.0000034900016456235323,0,-0.0007345008532448303,0.999999730254212,-1.3119846793821689e-9,0,-0.0000034900016678641534,-1.2514248610645074e-9,0.99999999999391,0,-0.001200000000000312,3.3466000000000236,2.842170943040401e-14,1],"children":[{"uuid":"d487a7ca-100b-48a2-b521-b1f308c4cf55","type":"Bone","name":"mixamorigLeftHandMiddle3","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0.0012000000000000001,3.1921,0],"rotation":[-6.892673401181375e-8,-0.001699999997195729,-0.019216037923244243],"parentMatrix":{"elements":[0.999999730248122,0.0007345008532449361,0.0000034900016456235323,0,-0.0007345008532448303,0.999999730254212,-1.3119846793821689e-9,0,-0.0000034900016678641534,-1.2514248610645074e-9,0.99999999999391,0,-0.001200000000000312,3.3466000000000236,2.842170943040401e-14,1]},"parentMatrixWorld":{"elements":[0.00037592804592751606,0.004339420956658111,-0.999990514006941,0,0.9999999293390495,-0.0000016313101572884448,0.00037592450643995006,0,-1.2721127291888226e-15,-0.9999905846672257,-0.004339421263285799,0,96.52713540225606,139.49107091994048,0.041570947439197176,1]}}},"layers":1,"matrix":[0.9999999433189061,-0.00033538312451366037,0.000029670597230606867,0,0.0003353831246969804,0.9999999437590783,-1.2029984506230304e-9,0,-0.00002967059515843975,1.1154015993262263e-8,0.9999999995598279,0,0.0011999999999999789,3.1920999999999964,-2.842170943040401e-14,1],"children":[{"uuid":"e894f3d2-3497-481d-a457-841dbb87e2de","type":"Bone","name":"mixamorigLeftHandMiddle4","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0.0001,2.4664,0],"parentMatrix":{"elements":[0.9999999433189061,-0.00033538312451366037,0.000029670597230606867,0,0.0003353831246969804,0.9999999437590783,-1.2029984506230304e-9,0,-0.00002967059515843975,1.1154015993262263e-8,0.9999999995598279,0,0.0011999999999999789,3.1920999999999964,-2.842170943040401e-14,1]},"parentMatrixWorld":{"elements":[0.00004054492380433317,0.004309750939936822,-0.9999907121583408,0,0.9999999991780545,-1.7473851859850836e-7,0.00004054454726293894,0,5.073577489523174e-15,-0.9999907129802783,-0.004309750943479259,0,99.71923562781289,139.4910709199405,0.041570947439395954,1]}}},"layers":1,"matrix":[0.9999999999999999,6.776263578034404e-21,-9.629649721936178e-35,0,-6.776263578034403e-21,0.9999999999999996,1.175494350822287e-38,0,9.62964972193618e-35,-1.1754943508222875e-38,1,0,0.00009999999999976694,2.466399999999979,0,1],"children":[{"uuid":"b432f199-245d-42d5-a169-489d0f8302cf","type":"Bone","name":"mixamorigLeftHandMiddle4_end","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,2.4664,0],"parentMatrix":{"elements":[0.9999999999999999,6.776263578034404e-21,-9.629649721936178e-35,0,-6.776263578034403e-21,0.9999999999999996,1.175494350822287e-38,0,9.62964972193618e-35,-1.1754943508222875e-38,1,0,0.00009999999999976694,2.466399999999979,0,1]},"parentMatrixWorld":{"elements":[0.00004054492380433317,0.004309750939936821,-0.9999907121583407,0,0.999999999178054,-1.747385185985083e-7,0.00004054454726293893,0,5.073577489523174e-15,-0.9999907129802783,-0.004309750943479259,0,102.18563562984012,139.4910709199405,0.041570947439549664,1]}}},"layers":1,"matrix":[1,3.388131789017203e-21,8.673617379884035e-19,0,-3.388131789017202e-21,0.9999999999999998,-2.646977960169688e-23,0,-8.673617379884035e-19,2.6469779601696883e-23,1,0,-1.1102230246251565e-16,2.466399999999979,0,1]}]}]}]}]},{"uuid":"ff8ee32d-1ab1-406f-89e5-47a615626ec2","type":"Bone","name":"mixamorigLeftHandRing1","userData":{"transformData":{"eulerOrder":"ZYX","translation":[1.336,10.0362,-0.0029000000000000002],"rotation":[-0.0022256266154440335,0.05520000782003332,6.915402533698786],"parentMatrix":{"elements":[0.9927437866761479,-0.12010463049487524,-0.005886573671689028,0,0.12010275274986991,0.9927612382653539,-0.0006727404736605241,0,0.005924761413454173,-0.00003913477696270708,0.9999824476812893,0,0,26.237399999999994,0,1]},"parentMatrixWorld":{"elements":[-0.12010463049481354,0.00478744860739341,-0.9927496955776598,0,0.9927612382653611,0.0005397676727986677,-0.12010342396737007,0,-0.00003913477696217439,-0.9999883944260007,-0.004817622004502247,0,82.95944716626053,139.4910709199405,0.0415709474383531,1]}}},"layers":1,"matrix":[0.9927245495667124,0.12040365653139129,-0.0009634217345477748,0,-0.12040374947020221,0.992725005026378,-0.00003884449432236551,0,0.0009517358271189356,0.00015456147228995495,0.9999995351547252,0,1.3359999999999967,10.036199999999994,-0.002900000000011005,1],"children":[{"uuid":"662e7457-f9f0-4fe8-9f14-8b90fee91387","type":"Bone","name":"mixamorigLeftHandRing2","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0.0009000000000000001,2.987,0],"rotation":[-7.689572728507213e-14,0.0013999999999999766,-0.017263542015830177],"parentMatrix":{"elements":[0.9927245495667124,0.12040365653139129,-0.0009634217345477748,0,-0.12040374947020221,0.992725005026378,-0.00003884449432236551,0,0.0009517358271189356,0.00015456147228995495,0.9999995351547252,0,1.3359999999999967,10.036199999999994,-0.002900000000011005,1]},"parentMatrixWorld":{"elements":[0.00030130564423575716,0.005781018317316348,-0.9999832443806865,0,0.9999999546074533,-0.0000017418535242186647,0.0003013006093500133,0,3.339234271038105e-15,-0.9999832897724743,-0.00578101857973156,0,92.76253783288912,139.50578413394157,-2.490110658370903,1]}}},"layers":1,"matrix":[0.9999999543089283,-0.0003013056440836581,-0.000024434609525489563,0,0.00030130564417360533,0.9999999546074534,-1.3420839328398164e-15,0,0.000024434608416340814,-7.3622844211242735e-9,0.9999999997014749,0,0.0008999999999992347,2.9869999999999948,0,1],"children":[{"uuid":"56bccc3c-a7f6-4bef-9674-b1b809d9e5d3","type":"Bone","name":"mixamorigLeftHandRing3","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,3.208,0],"rotation":[-0.0000016067323856532721,0.004199999385599464,-0.021918812881398003],"parentMatrix":{"elements":[0.9999999543089283,-0.0003013056440836581,-0.000024434609525489563,0,0.00030130564417360533,0.9999999546074534,-1.3420839328398164e-15,0,0.000024434608416340814,-7.3622844211242735e-9,0.9999999997014749,0,0.0008999999999992347,2.9869999999999948,0,1]},"parentMatrixWorld":{"elements":[6.215175373473738e-14,0.005805452779223328,-0.9999831482170229,0,1,4.268978349835017e-15,6.22846024502618e-14,0,4.682836858922838e-15,-0.9999831482170225,-0.0058054527792233855,0,95.74953796847666,139.50578413394157,-2.4901106583707167,1]}}},"layers":1,"matrix":[0.999999924138939,-0.00038255544255003885,-0.00007330381779479983,0,0.00038255544152221785,0.9999999268256639,-2.8042770252729873e-8,0,0.00007330382315875601,-6.2563782899525015e-15,0.9999999973132747,0,-4.440892098500626e-16,3.2079999999999984,2.842170943040401e-14,1],"children":[{"uuid":"a257f073-0da9-41ea-a7a5-fc6d7733cf3b","type":"Bone","name":"mixamorigLeftHandRing4","userData":{"transformData":{"eulerOrder":"ZYX","translation":[-0.0009000000000000001,2.3526,0],"rotation":[0.0001,0,0],"parentMatrix":{"elements":[0.999999924138939,-0.00038255544255003885,-0.00007330381779479983,0,0.00038255544152221785,0.9999999268256639,-2.8042770252729873e-8,0,0.00007330382315875601,-6.2563782899525015e-15,0.9999999973132747,0,-4.440892098500626e-16,3.2079999999999984,2.842170943040401e-14,1]},"parentMatrixWorld":{"elements":[-0.00038255544248788745,0.00587875492131029,-0.9999826467953876,0,0.9999999268256639,0.0000022489498531431965,-0.00038254883191767757,0,-1.5689854824463818e-15,-0.9999827199684587,-0.005878755351484365,0,98.95753796847666,139.50578413394155,-2.4901106583705164,1]}}},"layers":1,"matrix":[1,-1.084198387905971e-19,-4.336809636086899e-19,0,1.0842059570650381e-19,0.9999999999984771,0.0000017453292519934438,0,4.3368077437971335e-19,-0.0000017453292519934438,0.9999999999984771,0,-0.0009000000000001229,2.3525999999999954,0,1],"children":[{"uuid":"c1d1c6b6-2d2a-4f9a-b481-b7d62cf3c2da","type":"Bone","name":"mixamorigLeftHandRing4_end","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,2.3526,0],"parentMatrix":{"elements":[1,-1.084198387905971e-19,-4.336809636086899e-19,0,1.0842059570650381e-19,0.9999999999984771,0.0000017453292519934438,0,4.3368077437971335e-19,-0.0000017453292519934438,0.9999999999984771,0,-0.0009000000000001229,2.3525999999999954,0,1]},"parentMatrixWorld":{"elements":[-0.00038255544248788756,0.00587875492131029,-0.9999826467953876,0,0.999999926824141,5.036507604908531e-7,-0.00038255909228077534,0,-0.00000174532912584912,-0.999982719970861,-0.005878754683801746,0,101.3101381406266,139.50578413394155,-2.49011065837037,1]}}},"layers":1,"matrix":[1,-5.421010862427522e-20,-4.336808689942018e-19,0,5.421010862427525e-20,1.0000000000000004,2.117582368135751e-22,0,4.336808689942019e-19,-2.1175823681357504e-22,1.0000000000000002,0,-8.881784197001252e-16,2.3526000000000096,2.842170943040401e-14,1]}]}]}]}]},{"uuid":"760da5b7-009f-42ed-ae53-d2eda9249b54","type":"Bone","name":"mixamorigLeftHandPinky1","userData":{"transformData":{"eulerOrder":"ZYX","translation":[3.5613,9.2596,0.0123],"rotation":[-0.00224216487720304,-0.0007999892314587819,6.891502612009786],"parentMatrix":{"elements":[0.9927437866761479,-0.12010463049487524,-0.005886573671689028,0,0.12010275274986991,0.9927612382653539,-0.0006727404736605241,0,0.005924761413454173,-0.00003913477696270708,0.9999824476812893,0,0,26.237399999999994,0,1]},"parentMatrixWorld":{"elements":[-0.12010463049481354,0.00478744860739341,-0.9927496955776598,0,0.9927612382653611,0.0005397676727986677,-0.12010342396737007,0,-0.00003913477696217439,-0.9999883944260007,-0.004817622004502247,0,82.95944716626053,139.4910709199405,0.0415709474383531,1]}}},"layers":1,"matrix":[0.9927751480967202,0.11998960424380713,0.000013962446069000831,0,-0.11998960362117982,0.9927751474988825,-0.000039133159465964765,0,-0.0000185571417727284,0.00003717507981491423,0.9999999991368229,0,3.561300000000001,9.259599999999992,0.012299999999981992,1],"children":[{"uuid":"f4d625c3-8c7a-47d1-9b65-56dc42f338ac","type":"Bone","name":"mixamorigLeftHandPinky2","userData":{"transformData":{"eulerOrder":"ZYX","translation":[-0.0004,3.4523,0],"rotation":[-7.045378749143571e-9,-0.00019999999974909744,0.008656801927001885],"parentMatrix":{"elements":[0.9927751480967202,0.11998960424380713,0.000013962446069000831,0,-0.11998960362117982,0.9927751474988825,-0.000039133159465964765,0,-0.0000185571417727284,0.00003717507981491423,0.9999999991368229,0,3.561300000000001,9.259599999999992,0.012299999999981992,1]},"parentMatrixWorld":{"elements":[-0.00011586478495497893,0.004803664225626342,-0.9999884556260434,0,0.9999999932876755,5.565755231081264e-7,-0.0001158634481461687,0,-3.0728525735219947e-15,-0.9999884623382899,-0.004803664257870151,0,91.72429002616353,139.50081863615765,-4.606077464741283,1]}}},"layers":1,"matrix":[0.9999999885798595,0.0001510896957434039,0.000003490658499601935,0,-0.00015108969574389512,0.9999999885859516,-1.2296505622178502e-10,0,-0.0000034906584783381426,-4.044374758331912e-10,0.9999999999939074,0,-0.00039999999999995595,3.452300000000008,0,1],"children":[{"uuid":"3d2a636f-0e01-4644-8427-f089da8063a0","type":"Bone","name":"mixamorigLeftHandPinky3","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0.0001,2.8389,0],"rotation":[-9.043870031242507e-9,-0.0000999999991871575,0.003163617043317736],"parentMatrix":{"elements":[0.9999999885798595,0.0001510896957434039,0.000003490658499601935,0,-0.00015108969574389512,0.9999999885859516,-1.2296505622178502e-10,0,-0.0000034906584783381426,-4.044374758331912e-10,0.9999999999939074,0,-0.00039999999999995595,3.452300000000008,0,1]},"parentMatrixWorld":{"elements":[0.000035224911097454006,0.004800173636635083,-0.9999884784797594,0,0.9999999993796024,-1.6908568591287857e-7,0.000035224505274931596,0,3.8479728737661746e-15,-0.9999884791001489,-0.004800173639613153,0,95.1765900493365,139.50081863615765,-4.606077464741068,1]}}},"layers":1,"matrix":[0.9999999984740991,0.000055215533649962035,0.0000017453292378059403,0,-0.00005521553364977066,0.9999999984756224,-1.57845309167421e-10,0,-0.0000017453292438609128,6.147602366656217e-11,0.9999999999984768,0,0.00009999999999976694,2.8389000000000237,0,1],"children":[{"uuid":"0ac525ac-5f3b-4ca3-8898-e00ba327547a","type":"Bone","name":"mixamorigLeftHandPinky4","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0.0002,2.2114,0],"rotation":[0.0001,0.0006000000000000001,0],"parentMatrix":{"elements":[0.9999999984740991,0.000055215533649962035,0.0000017453292378059403,0,-0.00005521553364977066,0.9999999984756224,-1.57845309167421e-10,0,-0.0000017453292438609128,6.147602366656217e-11,0.9999999999984768,0,0.00009999999999976694,2.8389000000000237,0,1]},"parentMatrixWorld":{"elements":[0.00009044044465941073,0.004798428310844295,-0.9999884833868196,0,0.9999999959102625,-4.3397199112284713e-7,0.00009043940346180316,0,8.041505090784379e-16,-0.999988487476509,-0.004798428330468661,0,98.01549005109777,139.50081863615765,-4.60607746474089,1]}}},"layers":1,"matrix":[0.9999999999451689,-2.0719043884230643e-20,-0.000010471975511774138,0,1.827704520757746e-11,0.9999999999984769,0.0000017453292518977458,0,0.000010471975511758185,-0.0000017453292519934438,0.9999999999436456,0,0.00020000000000042206,2.2113999999999976,2.842170943040401e-14,1],"children":[{"uuid":"f628820a-9443-48ba-9b6a-c39ef9d198d9","type":"Bone","name":"mixamorigLeftHandPinky4_end","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,2.2113,0],"parentMatrix":{"elements":[0.9999999999451689,-2.0719043884230643e-20,-0.000010471975511774138,0,1.827704520757746e-11,0.9999999999984769,0.0000017453292518977458,0,0.000010471975511758185,-0.0000017453292519934438,0.9999999999436456,0,0.00020000000000042206,2.2113999999999976,2.842170943040401e-14,1]},"parentMatrixWorld":{"elements":[0.00009044044465445174,0.0048089001655341026,-0.9999884330829651,0,0.999999995908741,-0.000002179281062174829,0.00009043101034750238,0,-0.0000017443821539296088,-0.9999884371703741,-0.004808900342954852,0,100.22689006014181,139.50081863615762,-4.6060774647407525,1]}}},"layers":1,"matrix":[1,-2.0328790734103208e-20,4.336808689942018e-19,0,2.0328790734103214e-20,1.0000000000000002,-1.3234889800848443e-22,0,-4.336808689942019e-19,1.3234889800848443e-22,1.0000000000000002,0,0,2.2112999999999943,2.842170943040401e-14,1]}]}]}]}]}]}]}]}]},{"uuid":"40fe2967-f37d-4b47-b777-5efca68b6668","type":"Bone","name":"mixamorigRightShoulder","userData":{"transformData":{"eulerOrder":"ZYX","translation":[-9.0017,10.911200000000001,0.034],"rotation":[112.25742751677974,-89.82339738577264,-17.809822714023927],"parentMatrix":{"elements":[1,-2.8698592549372254e-42,3.111507638930571e-61,0,2.8698592549372254e-42,1,-2.168404344971009e-19,0,3.111507638930571e-61,2.168404344971009e-19,1,0,-2.710505431213761e-20,12.696799999999982,0,1]},"parentMatrixWorld":{"elements":[1,-2.8698503914404102e-42,6.617444900424222e-24,0,8.609577764811676e-42,0.9999969115221243,0.002485346296191081,0,-1.3234889800848443e-23,-0.002485346296191082,0.9999969115221247,0,0.00023268101266742255,130.07382647185716,0.08286739660027288,1]}}},"layers":1,"matrix":[0.002934579425780237,-0.0009427453700249777,0.999995249726098,0,-0.9969844796213211,-0.07754875800415913,0.002852634959956744,0,0.077545700317917,-0.9969881149558306,-0.0011674754918835632,0,-9.0017,10.911200000000036,0.03399999999999995,1],"children":[{"uuid":"28591100-a893-42bc-a377-ff0da54bf562","type":"Bone","name":"mixamorigRightArm","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,19.2615,0],"rotation":[-4.447522622339271,-0.1548009703285238,0.18068752402760696],"parentMatrix":{"elements":[0.002934579425780237,-0.0009427453700249777,0.999995249726098,0,-0.9969844796213211,-0.07754875800415913,0.002852634959956744,0,0.077545700317917,-0.9969881149558306,-0.0011674754918835632,0,-9.0017,10.911200000000036,0.03399999999999995,1]},"parentMatrixWorld":{"elements":[0.002934579425780237,-0.0034280769484921936,0.9999898182141802,0,-0.9969844796213211,-0.07755560828226786,0.0026598906311769287,0,0.077545700317917,-0.9969821341992056,-0.0036453326050133383,0,-9.001467318987332,140.98490827108333,0.14398540209902527,1]}}},"layers":1,"matrix":[0.9999913776271085,0.003153575474370941,0.0027017833304994574,0,-0.002934579425829508,0.9969844796213215,-0.07754570031791745,0,-0.0029381822664730664,0.07753710309219847,0.9969851376670764,0,-1.1102230246251565e-16,19.261500000000005,-2.842170943040401e-14,1],"children":[{"uuid":"6520cd5d-dc9e-4f51-86f5-6bcf88e7415a","type":"Bone","name":"mixamorigRightForeArm","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,28.5169,0],"rotation":[0,0.0008,0],"parentMatrix":{"elements":[0.9999913776271085,0.003153575474370941,0.0027017833304994574,0,-0.002934579425829508,0.9969844796213215,-0.07754570031791745,0,-0.0029381822664730664,0.07753710309219847,0.9969851376670764,0,-1.1102230246251565e-16,19.261500000000005,-2.842170943040401e-14,1]},"parentMatrixWorld":{"elements":[-4.92703480011597e-14,-0.006366254565498509,0.9999797351960725,0,-0.9999999999999994,6.938893903907228e-16,-4.926652618850169e-14,0,-2.636779683484747e-16,-0.9999797351960727,-0.006366254565498497,0,-28.20488387321342,139.49107092215445,0.19521888549143968,1]}}},"layers":1,"matrix":[0.9999999999025224,-6.310887241768095e-30,-0.0000139626340155013,0,6.310887241768094e-30,0.9999999999999999,-4.4058304437088585e-35,0,0.0000139626340155013,-4.4058304437110485e-35,0.9999999999025224,0,-3.3306690738754696e-16,28.516900000000003,-2.842170943040401e-14,1],"children":[{"uuid":"cc49b173-77e9-4795-8c86-3d807ec930aa","type":"Bone","name":"mixamorigRightHand","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,26.2375,0],"rotation":[0.35388550831865573,1.0024169969733294,7.4788775099226035],"parentMatrix":{"elements":[0.9999999999025224,-6.310887241768095e-30,-0.0000139626340155013,0,6.310887241768094e-30,0.9999999999999999,-4.4058304437088585e-35,0,0.0000139626340155013,-4.4058304437110485e-35,0.9999999999025224,0,-3.3306690738754696e-16,28.516900000000003,-2.842170943040401e-14,1]},"parentMatrixWorld":{"elements":[-4.927034431471797e-14,-0.0063522922138124814,0.9999798239882794,0,-0.9999999999999993,6.938893903907227e-16,-4.926652618850168e-14,0,-2.643659121597286e-16,-0.9999798239882797,-0.006352292213812469,0,-56.72178387321341,139.4910709221545,0.1952188854900346,1]}}},"layers":1,"matrix":[0.9913411733802029,0.13014076022720394,-0.01749458455202566,0,-0.13005106272938008,0.9914880657352825,0.006175482771958604,0,0.018149353821042966,-0.003846821024342739,0.9998278866504401,0,1.1102230246251565e-16,26.237500000000004,0,1],"children":[{"uuid":"09ddf7ae-8949-47c1-8f5c-a508b1038511","type":"Bone","name":"mixamorigRightHandThumb1","userData":{"transformData":{"eulerOrder":"ZYX","translation":[2.308,2.5604,0.8250000000000001],"rotation":[27.253865325066062,2.8841884944815677,-56.55314247937525],"parentMatrix":{"elements":[0.9913411733802029,0.13014076022720394,-0.01749458455202566,0,-0.13005106272938008,0.9914880657352825,0.006175482771958604,0,0.018149353821042966,-0.003846821024342739,0.9998278866504401,0,1.1102230246251565e-16,26.237500000000004,0,1]},"parentMatrixWorld":{"elements":[-0.1301407602272527,0.011196942764187992,0.991432302782297,0,-0.9914880657352754,-0.00534923582217125,-0.13008766728879187,0,0.003846821024341578,-0.9999230041102438,0.011797788739945577,0,-82.9592838732134,139.49107092215453,0.19521888548874208,1]}}},"layers":1,"matrix":[0.5504651404655265,-0.8333404439732225,-0.050317328732569715,0,0.7544677182761075,0.4707504106529682,0.45735381593390506,0,-0.3574445288593905,-0.28972013272911246,0.8878601542359663,0,2.3079999999999963,2.560399999999973,0.8249999999999602,1],"children":[{"uuid":"94847a53-7800-407e-a3e4-115cb62cff79","type":"Bone","name":"mixamorigRightHandThumb2","userData":{"transformData":{"eulerOrder":"ZYX","translation":[-0.9055000000000001,2.6871,0],"rotation":[-0.003195014745269145,-0.00950167633965054,37.20843800858126],"parentMatrix":{"elements":[0.5504651404655265,-0.8333404439732225,-0.050317328732569715,0,0.7544677182761075,0.4707504106529682,0.45735381593390506,0,-0.3574445288593905,-0.28972013272911246,0.8878601542359663,0,2.3079999999999963,2.560399999999973,0.8249999999999602,1]},"parentMatrixWorld":{"elements":[0.7544155912771437,0.060934715731512656,0.6535626030126549,0,-0.5631710582510739,-0.4513890246709154,0.6921606082080973,0,0.33718759583697827,-0.8902442972720238,-0.3062182496003779,0,-85.79508116398138,138.6782808042643,2.1601013526945154,1]}}},"layers":1,"matrix":[0.7964408584993921,0.6047164057732576,0.00016583553582564611,0,-0.6047164057831884,0.7964408738048864,-0.00005576352615901353,0,-0.00016579931817300075,-0.00005587111852857584,0.999999984694502,0,-0.9054999999999964,2.6871000000000134,2.842170943040401e-14,1],"children":[{"uuid":"b27f29fc-0e36-4182-b660-ce25047d6025","type":"Bone","name":"mixamorigRightHandThumb3","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0.9926,2.9519,0],"rotation":[-0.003088254270823317,0.08980040394093072,-20.555268537931873],"parentMatrix":{"elements":[0.7964408584993921,0.6047164057732576,0.00016583553582564611,0,-0.6047164057831884,0.7964408738048864,-0.00005576352615901353,0,-0.00016579931817300075,-0.00005587111852857584,0.999999984694502,0,-0.9054999999999964,2.6871000000000134,2.842170943040401e-14,1]},"parentMatrixWorld":{"elements":[0.2603445406866129,-0.22457908543492375,0.9390340539724267,0,-0.9047587373283422,-0.39630324835826103,0.15606204717583314,0,0.3370939740824488,-0.890229166971013,-0.30636527693489995,0,-87.9915014325093,137.41017697097615,3.428205185982538,1]}}},"layers":1,"matrix":[0.9363327871527374,-0.3511103177573123,-0.0015673120767143516,0,0.3511106693935249,0.9363339654913758,-0.0000539001389364738,0,0.0014864524268616214,-0.0004998315250854236,0.9999987703130585,0,0.9925999999999888,2.9519000000000126,-2.842170943040401e-14,1],"children":[{"uuid":"1087d288-12a5-4524-805b-376ccd63b4af","type":"Bone","name":"mixamorigRightHandThumb4","userData":{"transformData":{"eulerOrder":"ZYX","translation":[-0.08710000000000001,2.5327,0],"parentMatrix":{"elements":[0.9363327871527374,-0.3511103177573123,-0.0015673120767143516,0,0.3511106693935249,0.9363339654913758,-0.0000539001389364738,0,0.0014864524268616214,-0.0004998315250854236,0.9999987703130585,0,0.9925999999999888,2.9519000000000126,-2.842170943040401e-14,1]},"parentMatrixWorld":{"elements":[0.5609109257015873,-0.06973933461773378,0.8249335480119989,0,-0.755764759794228,-0.44987632161546076,0.4758475838994162,0,0.33793277627622775,-0.8903638135373753,-0.3050470754841344,0,-90.40384075814332,136.01741221194473,4.8209699450139105,1]}}},"layers":1,"matrix":[1,0,0,0,0,1.0000000000000002,2.7755575615628914e-17,0,0,-2.775557561562891e-17,1,0,-0.08709999999999951,2.532699999999995,0,1],"children":[{"uuid":"3feabee3-f2d4-4e35-9978-6eda815fbb2f","type":"Bone","name":"mixamorigRightHandThumb4_end","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,2.5342000000000002,0],"parentMatrix":{"elements":[1,0,0,0,0,1.0000000000000002,2.7755575615628914e-17,0,0,-2.775557561562891e-17,1,0,-0.08709999999999951,2.532699999999995,0,1]},"parentMatrixWorld":{"elements":[0.5609109257015873,-0.06973933461773378,0.8249335480119989,0,-0.7557647597942282,-0.4498763216154609,0.47584758389941634,0,0.33793277627622775,-0.8903638135373753,-0.3050470754841344,0,-92.36682150690277,134.88408474823447,5.9542974087241145,1]}}},"layers":1,"matrix":[0.9999999999999999,-5.551115123125782e-17,-8.326672684688674e-17,0,5.551115123125783e-17,1,-2.3111159332646834e-33,0,8.326672684688675e-17,-2.3111159332646834e-33,1,0,-7.105427357601002e-15,2.534200000000004,5.684341886080802e-14,1]}]}]}]}]},{"uuid":"994f765f-32a9-4649-bd39-eee969c5a214","type":"Bone","name":"mixamorigRightHandIndex1","userData":{"transformData":{"eulerOrder":"ZYX","translation":[3.5946,10.0844,-0.0315],"rotation":[-0.22015505537467864,0.10829989275885593,-7.344300573721776],"parentMatrix":{"elements":[0.9913411733802029,0.13014076022720394,-0.01749458455202566,0,-0.13005106272938008,0.9914880657352825,0.006175482771958604,0,0.018149353821042966,-0.003846821024342739,0.9998278866504401,0,1.1102230246251565e-16,26.237500000000004,0,1]},"parentMatrixWorld":{"elements":[-0.1301407602272527,0.011196942764187992,0.991432302782297,0,-0.9914880657352754,-0.00534923582217125,-0.13008766728879187,0,0.003846821024341578,-0.9999230041102438,0.011797788739945577,0,-82.9592838732134,139.49107092215453,0.19521888548874208,1]}}},"layers":1,"matrix":[0.9917941291629331,-0.12783126591355135,-0.0018901885826486402,0,0.12782334728940917,0.9917895077789289,-0.0038424142619580535,0,0.002365849883264829,0.0035692736751795494,0.9999908314778498,0,3.594599999999998,10.084399999999988,-0.03150000000005093,1],"children":[{"uuid":"3c06d9e3-d1ed-461f-8b6c-91d95c4e88e8","type":"Bone","name":"mixamorigRightHandIndex2","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0.0077,3.2949,0],"rotation":[8.240930543946833e-7,0.008100010062074961,-0.12806758199810586],"parentMatrix":{"elements":[0.9917941291629331,-0.12783126591355135,-0.0018901885826486402,0,0.12782334728940917,0.9917895077789289,-0.0038424142619580535,0,0.002365849883264829,0.0035692736751795494,0.9999908314778498,0,3.594599999999998,10.084399999999988,-0.03150000000005093,1]},"parentMatrixWorld":{"elements":[-0.0023369385942512235,0.013678904730810215,0.99990370850566,0,-0.9999972693552741,-0.000031966847685057156,-0.0023367199476936806,0,2.557849765327802e-15,-0.999906438894903,0.013678942083141271,0,-93.42577127488934,139.5088731935191,2.446793738717585,1]}}},"layers":1,"matrix":[0.9999974919463754,-0.002235199087375582,-0.00014137184455696947,0,0.0022351991117452903,0.9999975019393451,1.4383136998271731e-8,0,0.0001413714592523522,-3.303773223041244e-7,0.9999999900070005,0,0.007700000000000706,3.294900000000027,-2.842170943040401e-14,1],"children":[{"uuid":"180e8c3d-1181-405d-9d70-3f6f4236fc13","type":"Bone","name":"mixamorigRightHandIndex3","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0.00030000000000000003,2.9487,0],"rotation":[0.00005334925755360626,-0.014999810259436015,-0.20961013188511068],"parentMatrix":{"elements":[0.9999974919463754,-0.002235199087375582,-0.00014137184455696947,0,0.0022351991117452903,0.9999975019393451,1.4383136998271731e-8,0,0.0001413714592523522,-3.303773223041244e-7,0.9999999900070005,0,0.007700000000000706,3.294900000000027,-2.842170943040401e-14,1]},"parentMatrixWorld":{"elements":[-0.00010173974924292978,0.013820300493303359,0.9999044899105604,0,-0.9999999948245106,-0.000001406073917273325,-0.00010173003259674706,0,3.4664453592653088e-15,-0.9999044950855546,0.013820300564830173,0,-96.72068027211523,139.50887319351912,2.446793738717423,1]}}},"layers":1,"matrix":[0.9999932738415735,-0.0036583786610558445,0.00026179607321112386,0,0.0036583785426597703,0.9999933081103951,9.311201658965798e-7,0,-0.0002617977276908487,2.663523375333156e-8,0.9999999657309737,0,0.0003000000000010772,2.948699999999988,-5.684341886080802e-14,1],"children":[{"uuid":"972138b7-a720-4ff0-a4cc-1375ae1bcb52","type":"Bone","name":"mixamorigRightHandIndex4","userData":{"transformData":{"eulerOrder":"ZYX","translation":[-0.008,2.2493,0],"parentMatrix":{"elements":[0.9999932738415735,-0.0036583786610558445,0.00026179607321112386,0,0.0036583785426597703,0.9999933081103951,9.311201658965798e-7,0,-0.0002617977276908487,2.663523375333156e-8,0.9999999657309737,0,0.0003000000000010772,2.948699999999988,-5.684341886080802e-14,1]},"parentMatrixWorld":{"elements":[0.003556639577196687,0.013558441609324005,0.9999017546619489,0,-0.999993675137456,0.000048222795030484555,0.003556312647127912,0,5.018599810716923e-15,-0.9999080789431037,0.013558527365145866,0,-99.66938028737619,139.50887319351918,2.446793738717278,1]}}},"layers":1,"matrix":[1,2.168404344971009e-19,3.6734198463196485e-40,0,-2.168404344971009e-19,1,3.3881317890172014e-21,0,3.6734198463196485e-40,-3.3881317890172014e-21,1,0,-0.007999999999999563,2.249299999999991,0,1],"children":[{"uuid":"86709864-2179-4ba6-a6db-3c31214c5d87","type":"Bone","name":"mixamorigRightHandIndex4_end","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,2.2493,0],"parentMatrix":{"elements":[1,2.168404344971009e-19,3.6734198463196485e-40,0,-2.168404344971009e-19,1,3.3881317890172014e-21,0,3.6734198463196485e-40,-3.3881317890172014e-21,1,0,-0.007999999999999563,2.249299999999991,0,1]},"parentMatrixWorld":{"elements":[0.003556639577196687,0.013558441609324005,0.9999017546619489,0,-0.999993675137456,0.000048222795030484555,0.003556312647127912,0,5.018603198827283e-15,-0.9999080789431037,0.013558527365145866,0,-101.91869451397947,139.50887319351918,2.4467937387171674,1]}}},"layers":1,"matrix":[1,2.168404344971009e-19,3.6734198463196485e-40,0,-2.168404344971009e-19,1,3.3881317890172014e-21,0,3.6734198463196485e-40,-3.3881317890172014e-21,1,0,0,2.249299999999991,2.842170943040401e-14,1]}]}]}]}]},{"uuid":"ab063fe0-8c77-44a1-b378-c93888e821dd","type":"Bone","name":"mixamorigRightHandMiddle1","userData":{"transformData":{"eulerOrder":"ZYX","translation":[1.2991000000000001,9.8973,-0.038400000000000004],"rotation":[-0.22030846624582956,0.05039999828765536,-7.36520477694168],"parentMatrix":{"elements":[0.9913411733802029,0.13014076022720394,-0.01749458455202566,0,-0.13005106272938008,0.9914880657352825,0.006175482771958604,0,0.018149353821042966,-0.003846821024342739,0.9998278866504401,0,1.1102230246251565e-16,26.237500000000004,0,1]},"parentMatrixWorld":{"elements":[-0.1301407602272527,0.011196942764187992,0.991432302782297,0,-0.9914880657352754,-0.00534923582217125,-0.13008766728879187,0,0.003846821024341578,-0.9999230041102438,0.011797788739945577,0,-82.9592838732134,139.49107092215453,0.19521888548874208,1]}}},"layers":1,"matrix":[0.9917488122497476,-0.12819329009149383,-0.0008796457996774761,0,0.1281890376111663,0.9917422981119037,-0.003845097143496141,0,0.0013652976004427985,0.0037006095765478348,0.9999922206953533,0,1.2990999999999975,9.897299999999987,-0.038400000000052614,1],"children":[{"uuid":"91734c2d-2c9e-48e6-98ea-58e79e9b65ce","type":"Bone","name":"mixamorigRightHandMiddle2","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0.0067,3.4041,0],"rotation":[-0.0000023015307610941934,0.004999998941471929,-0.1391438596376226],"parentMatrix":{"elements":[0.9917488122497476,-0.12819329009149383,-0.0008796457996774761,0,0.1281890376111663,0.9917422981119037,-0.003845097143496141,0,0.0013652976004427985,0.0037006095765478348,0.9999922206953533,0,1.2990999999999975,9.897299999999987,-0.038400000000052614,1]},"parentMatrixWorld":{"elements":[-0.001968210987556996,0.012669868897297716,0.9999177969051425,0,-0.9999980630708777,-0.00002493702347368485,-0.0019680530065016187,0,-2.0105445086571194e-15,-0.9999197336787942,0.012669893437983288,0,-92.94155228575369,139.4910709221546,0.19521888548824903,1]}}},"layers":1,"matrix":[0.9999970473427293,-0.0024285160882498965,-0.00008726644401415685,0,0.0024285160939915736,0.9999970511504419,-4.0169289464070846e-8,0,0.00008726628423030768,-1.717587928958682e-7,0.999999996192283,0,0.006699999999999484,3.4040999999999855,2.842170943040401e-14,1],"children":[{"uuid":"c2c15ac8-db16-4e68-8921-b804c8dbc388","type":"Bone","name":"mixamorigRightHandMiddle3","userData":{"transformData":{"eulerOrder":"ZYX","translation":[-0.0015,3.2587,0],"rotation":[0.000016263342105790965,-0.007699754273283756,-0.09464577664443743],"parentMatrix":{"elements":[0.9999970473427293,-0.0024285160882498965,-0.00008726644401415685,0,0.0024285160939915736,0.9999970511504419,-4.0169289464070846e-8,0,0.00008726628423030768,-1.717587928958682e-7,0.999999996192283,0,0.006699999999999484,3.4040999999999855,2.842170943040401e-14,1]},"parentMatrixWorld":{"elements":[0.00046030620828184783,0.012757151486937629,0.9999185182824318,0,-0.999999894059091,0.000005872196652919555,0.00046026875050273885,0,-1.2646476582263123e-15,-0.9999186242147192,0.012757152838441995,0,-96.34565887926686,139.49107092215456,0.1952188854880812,1]}}},"layers":1,"matrix":[0.9999986266160453,-0.0016518796593863836,0.000134386063258813,0,0.001651879636157192,0.9999986356458628,2.8384886456117786e-7,0,-0.0001343863487927973,-6.185887344713644e-8,0.9999999909701527,0,-0.0014999999999998348,3.258699999999976,0,1],"children":[{"uuid":"301c1694-6c5d-49aa-b849-21e28032a808","type":"Bone","name":"mixamorigRightHandMiddle4","userData":{"transformData":{"eulerOrder":"ZYX","translation":[-0.005200000000000001,2.4619,0],"parentMatrix":{"elements":[0.9999986266160453,-0.0016518796593863836,0.000134386063258813,0,0.001651879636157192,0.9999986356458628,2.8384886456117786e-7,0,-0.0001343863487927973,-6.185887344713644e-8,0.9999999909701527,0,-0.0014999999999998348,3.258699999999976,0,1]},"parentMatrixWorld":{"elements":[0.002112185060489438,0.01262274913882088,0.9999180990853445,0,-0.9999977693346465,0.000026661641631671542,0.002112016781803735,0,-5.02855089891074e-15,-0.9999203295729794,0.012622777296012867,0,-99.6043592244965,139.49107092215456,0.195218885487921,1]}}},"layers":1,"matrix":[1,4.336808689942018e-19,-1.734723475976807e-18,0,-4.336808689942018e-19,1,-6.776263578034403e-21,0,1.734723475976807e-18,6.776263578034403e-21,1,0,-0.005199999999999649,2.4619,0,1],"children":[{"uuid":"6182d1db-2abd-4546-b786-06c665d7d032","type":"Bone","name":"mixamorigRightHandMiddle4_end","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,2.4619,0],"parentMatrix":{"elements":[1,4.336808689942018e-19,-1.734723475976807e-18,0,-4.336808689942018e-19,1,-6.776263578034403e-21,0,1.734723475976807e-18,6.776263578034403e-21,1,0,-0.005199999999999649,2.4619,0,1]},"parentMatrixWorld":{"elements":[0.0021121850604894376,0.012622749138820881,0.9999180990853445,0,-0.9999977693346465,0.000026661641631671542,0.0021120167818037346,0,-5.028554011102193e-15,-0.9999203295729794,0.012622777296012869,0,-102.06626471618378,139.49107092215456,0.19521888548780017,1]}}},"layers":1,"matrix":[1,4.336808689942018e-19,-1.734723475976807e-18,0,-4.336808689942018e-19,1,-3.388131789017201e-21,0,1.734723475976807e-18,3.3881317890172014e-21,1,0,2.220446049250313e-16,2.461900000000014,2.842170943040401e-14,1]}]}]}]}]},{"uuid":"fd075f0a-d2db-42d1-ad3e-a08df55566a6","type":"Bone","name":"mixamorigRightHandRing1","userData":{"transformData":{"eulerOrder":"ZYX","translation":[-1.3443,9.969100000000001,0.0135],"rotation":[-0.2204042226781153,0.003199892109205318,-7.423553707548161],"parentMatrix":{"elements":[0.9913411733802029,0.13014076022720394,-0.01749458455202566,0,-0.13005106272938008,0.9914880657352825,0.006175482771958604,0,0.018149353821042966,-0.003846821024342739,0.9998278866504401,0,1.1102230246251565e-16,26.237500000000004,0,1]},"parentMatrixWorld":{"elements":[-0.1301407602272527,0.011196942764187992,0.991432302782297,0,-0.9914880657352754,-0.00534923582217125,-0.13008766728879187,0,0.003846821024341578,-0.9999230041102438,0.011797788739945577,0,-82.9592838732134,139.49107092215453,0.19521888548874208,1]}}},"layers":1,"matrix":[0.9916181304951827,-0.12920325132970387,-0.0000558486529851855,0,0.12920208253997573,0.9916108229687899,-0.003846769877784467,0,0.0005523953040752588,0.0038073109923810774,0.9999925995938347,0,-1.3443000000000023,9.969099999999969,0.013499999999964984,1],"children":[{"uuid":"78017c97-18a4-473d-bdc9-f254085d34ed","type":"Bone","name":"mixamorigRightHandRing2","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0.003,3.169,0],"rotation":[0.000008613344227477958,-0.004399983138752335,-0.16640148198655902],"parentMatrix":{"elements":[0.9916181304951827,-0.12920325132970387,-0.0000558486529851855,0,0.12920208253997573,0.9916108229687899,-0.003846769877784467,0,0.0005523953040752588,0.0038073109923810774,0.9999925995938347,0,-1.3443000000000023,9.969099999999969,0.013499999999964984,1]},"parentMatrixWorld":{"elements":[-0.000946670449945909,0.011850074464307964,0.9999293372785146,0,-0.9999995519074284,-0.00001121812034832496,-0.0009466039798017667,0,-3.3324037973514464e-15,-0.9999297853396231,0.01185007977424068,0,-92.66852739327757,139.40919284460637,-2.4342612529622043,1]}}},"layers":1,"matrix":[0.9999957797094073,-0.002904249649554963,0.00007679419272798141,0,0.0029042496465740996,0.9999957826580909,1.5033121593385765e-7,0,-0.00007679430545999523,7.2698925596742e-8,0.9999999970513147,0,0.0029999999999997806,3.168999999999997,2.842170943040401e-14,1],"children":[{"uuid":"0eb5b23e-aa1c-4986-a0d8-f28854156da4","type":"Bone","name":"mixamorigRightHandRing3","userData":{"transformData":{"eulerOrder":"ZYX","translation":[-0.006,3.065,0],"rotation":[0.000004408254454214349,0.00359987216715727,0.18232326462627393],"parentMatrix":{"elements":[0.9999957797094073,-0.002904249649554963,0.00007679419272798141,0,0.0029042496465740996,0.9999957826580909,1.5033121593385765e-7,0,-0.00007679430545999523,7.2698925596742e-8,0.9999999970513147,0,0.0029999999999997806,3.168999999999997,2.842170943040401e-14,1]},"parentMatrixWorld":{"elements":[0.0019575818934607536,0.01177326823312245,0.9999287764777258,0,-0.9999980839347287,0.000023047180876688706,0.00195744621817797,0,3.349799984559908e-15,-0.9999306924101985,0.011773290791516055,0,-95.83752881328355,139.40919284460634,-2.4342612529623606,1]}}},"layers":1,"matrix":[0.9999949350189683,0.0031821358940292846,-0.00006282962192646205,0,-0.0031821358954761186,0.9999949369927515,7.693855433987714e-8,0,0.00006282954864856621,1.229942305838294e-7,0.9999999980262165,0,-0.006000000000000227,3.065000000000012,-2.842170943040401e-14,1],"children":[{"uuid":"5296ba05-9fe1-406e-9765-8da78f25710e","type":"Bone","name":"mixamorigRightHandRing4","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0.0029000000000000002,2.3682,0],"parentMatrix":{"elements":[0.9999949350189683,0.0031821358940292846,-0.00006282962192646205,0,-0.0031821358954761186,0.9999949369927515,7.693855433987714e-8,0,0.00006282954864856621,1.229942305838294e-7,0.9999999980262165,0,-0.006000000000000227,3.065000000000012,-2.842170943040401e-14,1]},"parentMatrixWorld":{"elements":[-0.0012245578185036143,0.01183610720836049,0.9999292010059021,0,-0.9999992502287928,-0.00001449400848495689,-0.0012244720391157357,0,-4.7603108402039735e-15,-0.9999299507245879,0.011836116082739528,0,-98.90253468603487,139.40919284460637,-2.434261252962512,1]}}},"layers":1,"matrix":[1,-2.1684043449710086e-19,-3.851859888774472e-34,0,2.168404344971009e-19,1.0000000000000002,-3.761581922631321e-37,0,3.851859888774473e-34,3.761581922631321e-37,1.0000000000000004,0,0.0029000000000000137,2.3682000000000016,-2.842170943040401e-14,1],"children":[{"uuid":"2fe80cbe-411d-4c11-b461-5f35f413f7de","type":"Bone","name":"mixamorigRightHandRing4_end","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,2.3682,0],"parentMatrix":{"elements":[1,-2.1684043449710086e-19,-3.851859888774472e-34,0,2.168404344971009e-19,1.0000000000000002,-3.761581922631321e-37,0,3.851859888774473e-34,3.761581922631321e-37,1.0000000000000004,0,0.0029000000000000137,2.3682000000000016,-2.842170943040401e-14,1]},"parentMatrixWorld":{"elements":[-0.001224557818503614,0.01183610720836049,0.9999292010059021,0,-0.999999250228793,-0.00001449400848495689,-0.0012244720391157357,0,-4.760310840203976e-15,-0.9999299507245883,0.011836116082739533,0,-101.27073646164438,139.4091928446064,-2.4342612529626293,1]}}},"layers":1,"matrix":[1,-2.1684043449710086e-19,-1.734723475976807e-18,0,2.168404344971009e-19,1.0000000000000002,3.3881317890172006e-21,0,1.734723475976808e-18,-3.3881317890172014e-21,1.0000000000000004,0,-5.551115123125783e-16,2.3682000000000016,0,1]}]}]}]}]},{"uuid":"b3d3a031-1a7d-4762-9e73-20bc8033a31e","type":"Bone","name":"mixamorigRightHandPinky1","userData":{"transformData":{"eulerOrder":"ZYX","translation":[-3.5493,9.5063,-0.1403],"rotation":[-0.22009761184043683,0.37919988627112333,-7.431729049207745],"parentMatrix":{"elements":[0.9913411733802029,0.13014076022720394,-0.01749458455202566,0,-0.13005106272938008,0.9914880657352825,0.006175482771958604,0,0.018149353821042966,-0.003846821024342739,0.9998278866504401,0,1.1102230246251565e-16,26.237500000000004,0,1]},"parentMatrixWorld":{"elements":[-0.1301407602272527,0.011196942764187992,0.991432302782297,0,-0.9914880657352754,-0.00534923582217125,-0.13008766728879187,0,0.003846821024341578,-0.9999230041102438,0.011797788739945577,0,-82.9592838732134,139.49107092215453,0.19521888548874208,1]}}},"layers":1,"matrix":[0.9915779695658195,-0.12934190811390514,-0.00661823822333962,0,0.1293185766649014,0.9915956584612511,-0.003841334424626202,0,0.007059461813110653,0.0029531214421226093,0.9999707211077019,0,-3.549300000000004,9.506299999999968,-0.14030000000005316,1],"children":[{"uuid":"2b14717d-6458-459c-bd68-5dbe8d28c564","type":"Bone","name":"mixamorigRightHandPinky2","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0.0028,3.3767,0],"rotation":[8.630327061229454e-8,0.00009999992554657226,0.001937627389320259],"parentMatrix":{"elements":[0.9915779695658195,-0.12934190811390514,-0.00661823822333962,0,0.1293185766649014,0.9915956584612511,-0.003841334424626202,0,0.007059461813110653,0.0029531214421226093,0.9999707211077019,0,-3.549300000000004,9.506299999999968,-0.14030000000005316,1]},"parentMatrixWorld":{"elements":[-0.0008292116674675268,0.0184122507858481,0.9998301362876644,0,-0.9999996562039453,-0.00001526765842292839,-0.0008290710995267298,0,-1.8769708010069053e-15,-0.9998304800254382,0.018412257115909447,0,-91.92329798122773,139.540767370182,-4.561979408084121,1]}}},"layers":1,"matrix":[0.9999999994266489,0.00003381797761396285,-0.0000017453279525348482,0,-0.000033817977611385424,0.9999999994281722,1.5062762274276563e-9,0,0.0000017453280024760372,-1.4472527649406828e-9,0.9999999999984768,0,0.002800000000001246,3.376700000000014,0,1],"children":[{"uuid":"d86b3eb4-a746-4796-8e6d-3385408de1b3","type":"Bone","name":"mixamorigRightHandPinky3","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0.0024000000000000002,2.7809,0],"rotation":[0.000019282751539530108,-0.007599951061890417,-0.19481968005618042],"parentMatrix":{"elements":[0.9999999994266489,0.00003381797761396285,-0.0000017453279525348482,0,-0.000033817977611385424,0.9999999994281722,1.5062762274276563e-9,0,0.0000017453280024760372,-1.4472527649406828e-9,0.9999999999984768,0,0.002800000000001246,3.376700000000014,0,1]},"parentMatrixWorld":{"elements":[-0.0008630296329795729,0.018413995291054672,0.9998300755414757,0,-0.999999627589856,-0.000015891829519932464,-0.0008628833044828632,0,4.0471991683601634e-15,-0.9998304478884762,0.018414002148615858,0,-95.29999914212428,139.540767370182,-4.561979408084286,1]}}},"layers":1,"matrix":[0.9999942103758128,-0.003400238282671276,0.00013264416863146018,0,0.003400238267942983,0.999994219173095,3.365475002481174e-7,0,-0.0001326445461801757,1.1447622643560334e-7,0.9999999912027056,0,0.0023999999999997357,2.780900000000017,-5.684341886080802e-14,1],"children":[{"uuid":"76a6b70d-3c75-4420-bf71-f3cd4ca485cb","type":"Bone","name":"mixamorigRightHandPinky4","userData":{"transformData":{"eulerOrder":"ZYX","translation":[-0.0053,2.0889,0],"parentMatrix":{"elements":[0.9999942103758128,-0.003400238282671276,0.00013264416863146018,0,0.003400238267942983,0.999994219173095,3.365475002481174e-7,0,-0.0001326445461801757,1.1447622643560334e-7,0.9999999912027056,0,0.0023999999999997357,2.780900000000017,-5.684341886080802e-14,1]},"parentMatrixWorld":{"elements":[0.0025372123800257123,0.018281321038416683,0.9998296634199388,0,-0.9999967812714883,0.00004638374336444036,0.002536788365179001,0,-5.749677201455904e-15,-0.9998328816105413,0.018281379881215344,0,-98.08090017776004,139.54076737018207,-4.561979408084425,1]}}},"layers":1,"matrix":[1,4.3368086899420173e-19,-3.469446951953614e-18,0,-4.336808689942018e-19,1.0000000000000002,-1.3552527156068808e-20,0,3.469446951953614e-18,1.3552527156068805e-20,1,0,-0.005299999999999194,2.0888999999999953,2.842170943040401e-14,1],"children":[{"uuid":"54a116ac-d7bd-458c-b2a1-b3f9c4d8aa17","type":"Bone","name":"mixamorigRightHandPinky4_end","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,2.0889,0],"parentMatrix":{"elements":[1,4.3368086899420173e-19,-3.469446951953614e-18,0,-4.336808689942018e-19,1.0000000000000002,-1.3552527156068808e-20,0,3.469446951953614e-18,1.3552527156068805e-20,1,0,-0.005299999999999194,2.0888999999999953,2.842170943040401e-14,1]},"parentMatrixWorld":{"elements":[0.002537212380025712,0.018281321038416686,0.9998296634199388,0,-0.9999967812714885,0.00004638374336444038,0.002536788365179001,0,-5.74968195121568e-15,-0.9998328816105413,0.018281379881215348,0,-100.16980690138367,139.54076737018204,-4.561979408084527,1]}}},"layers":1,"matrix":[1,4.8136493666172673e-35,-3.469446951953614e-18,0,-4.816000355318913e-35,1.0000000000000002,-6.776263578034404e-21,0,3.469446951953614e-18,6.776263578034403e-21,1,0,4.440892098500626e-16,2.0888999999999953,5.684341886080802e-14,1]}]}]}]}]}]}]}]}]}]}]}]},{"uuid":"bb191530-e732-4353-b76f-56b8cc10b38d","type":"Bone","name":"mixamorigLeftUpLeg","userData":{"transformData":{"eulerOrder":"ZYX","translation":[11.1369,-5.2821,0.0974],"rotation":[-1.1472,0.0047,-179.68756402399552],"parentMatrix":{"elements":[0.9999999997014749,-0.000024434609525489164,0,0,0.000024434609525489164,0.9999999997014749,0,0,0,0,1,0,0,96.74480000054845,0,1]},"parentMatrixWorld":{"elements":[0.9999999997014749,-0.000024434609525489164,0,0,0.000024434609525489164,0.9999999997014749,0,0,0,0,1,0,0,96.74480000054845,0,1]}}},"layers":1,"matrix":[-0.9999851288689505,-0.005453009439762041,-0.00008203047475173634,0,0.005453558760770314,-0.9997846843595095,-0.020021079316537942,0,0.00002716232219978054,-0.0200212289384579,0.9997995547378495,0,11.1369,-5.2821,0.0974,1],"children":[{"uuid":"7ca0dd0b-479b-4125-90fb-af866757e510","type":"Bone","name":"mixamorigLeftLeg","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,44.8157,0],"rotation":[-1.4347,0.0082,-0.6855],"parentMatrix":{"elements":[-0.9999851288689505,-0.005453009439762041,-0.00008203047475173634,0,0.005453558760770314,-0.9997846843595095,-0.020021079316537942,0,0.00002716232219978054,-0.0200212289384579,0.9997995547378495,0,11.1369,-5.2821,0.0974,1]},"parentMatrixWorld":{"elements":[-0.9999852618125863,-0.005428575191978972,-0.00008203047475173634,0,0.005429129410770401,-0.9997848173166275,-0.020021079316537942,0,0.000026673111280340262,-0.020021229596181796,0.9997995547378495,0,11.136770930624383,91.46242787632247,0.0974,1]}}},"layers":1,"matrix":[0.9999284191892931,-0.011963946469564307,-0.00014311699817497,0,0.011956612956850823,0.999615004338708,-0.025037621842447184,0,0.00044261066619984753,0.025034118434622797,0.9996864993636755,0,1.7763568394002505e-15,44.81570000000001,-2.220446049250313e-16,1],"children":[{"uuid":"bff9b849-0b3c-435c-9d05-32fa62f0fb97","type":"Bone","name":"mixamorigLeftFoot","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,37.26,0],"rotation":[59.85499992941118,0.701292611555175,0.5657638566259754],"parentMatrix":{"elements":[0.9999284191892931,-0.011963946469564307,-0.00014311699817497,0,0.011956612956850823,0.999615004338708,-0.025037621842447184,0,0.00044261066619984753,0.025034118434622797,0.9996864993636755,0,1.7763568394002505e-15,44.81570000000001,-2.220446049250313e-16,1]},"parentMatrixWorld":{"elements":[-0.9999786396878733,0.0065360508035730925,0.000014418207211357539,0,-0.006530065349819168,-0.9989635278967626,-0.045046955264277315,0,-0.00028002592501179653,-0.0450460871990878,0.99898487056288,0,11.380081165558645,46.65637143890567,-0.7998586843261698,1]}}},"layers":1,"matrix":[0.9998763455311327,0.009873541975373906,-0.01223955947603844,0,0.00562496581011583,0.5022701009350848,0.8646924918526209,0,0.014685142387528313,-0.8646544158653908,0.5021524546564895,0,0,37.260000000000005,4.440892098500626e-16,1],"children":[{"uuid":"25f2c77e-4a92-46cc-91ed-801ac332b9b7","type":"Bone","name":"mixamorigLeftToeBase","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,16.9126,0],"rotation":[32.7353,-0.0961,0],"parentMatrix":{"elements":[0.9998763455311327,0.009873541975373906,-0.01223955947603844,0,0.00562496581011583,0.5022701009350848,0.8646924918526209,0,0.014685142387528313,-0.8646544158653908,0.5021524546564895,0,0,37.260000000000005,4.440892098500626e-16,1]},"parentMatrixWorld":{"elements":[-0.9999160353406734,-0.0027767214694377515,-0.01265749131824596,0,-0.009146838556338584,-0.5406637603132617,0.8411890593846004,0,-0.009179194573304697,0.8412342052614157,0.5405929654418196,0,11.136770930624383,9.434990389472297,-2.478308237473142,1]}}},"layers":1,"matrix":[0.9999985933974089,-2.005774019098183e-18,0.0016772606247530627,0,-0.0009069932309525283,0.8411777795319771,0.5407579131043124,0,-0.0014108743680261997,-0.5407586737368641,0.8411765963291332,0,0,16.912600000000005,1.7763568394002505e-15,1],"children":[{"uuid":"7d55d813-1267-4a2d-b730-f105e730f55b","type":"Bone","name":"mixamorigLeftToe_End","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,7.5542,0],"parentMatrix":{"elements":[0.9999985933974089,-2.005774019098183e-18,0.0016772606247530627,0,-0.0009069932309525283,0.8411777795319771,0.5407579131043124,0,-0.0014108743680261997,-0.5407586737368641,0.8411765963291332,0,0,16.912600000000005,1.7763568394002505e-15,1]},"parentMatrixWorld":{"elements":[-0.999930024757812,-0.0013657485550137283,-0.011750758219231822,0,-0.011750922372422163,0.00011223036298640965,0.9999309492298671,0,-0.001364335457163894,0.9999990610671747,-0.00012827131488979404,0,10.982074108856452,0.2909604767982259,11.748385848274857,1]}}},"layers":1,"matrix":[1,7.841890414115972e-40,-1.1572587641861883e-19,0,7.841890414115972e-40,1,1.3552527156068805e-20,0,1.1572587641861888e-19,-1.355252715606881e-20,1.0000000000000004,0,0,7.554200000000002,-5.551115123125783e-17,1],"children":[{"uuid":"30c67c46-6b7a-492b-8de5-a2eadefd362e","type":"Bone","name":"mixamorigLeftToe_End_end","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,7.5542,0],"parentMatrix":{"elements":[1,7.841890414115972e-40,-1.1572587641861883e-19,0,7.841890414115972e-40,1,1.3552527156068805e-20,0,1.1572587641861888e-19,-1.355252715606881e-20,1.0000000000000004,0,0,7.554200000000002,-5.551115123125783e-17,1]},"parentMatrixWorld":{"elements":[-0.999930024757812,-0.0013657485550137285,-0.011750758219231822,0,-0.011750922372422163,0.00011223036298640966,0.9999309492298671,0,-0.0013643354571638948,0.9999990610671752,-0.00012827131488979412,0,10.8933052910707,0.2918082874062978,19.30206422494712,1]}}},"layers":1,"matrix":[1,0,-1.1646703024746634e-19,0,0,1,0,0,1.164670302474664e-19,0,1.0000000000000004,0,3.552713678800501e-15,7.554199999999998,0,1]}]}]}]}]}]},{"uuid":"d1acbdad-8b89-4546-b087-9d33aab8a520","type":"Bone","name":"mixamorigRightUpLeg","userData":{"transformData":{"eulerOrder":"ZYX","translation":[-11.1369,-5.2821,-0.0308],"rotation":[-0.8760000000000001,-0.0015,179.69034676831905],"parentMatrix":{"elements":[0.9999999997014749,-0.000024434609525489164,0,0,0.000024434609525489164,0.9999999997014749,0,0,0,0,1,0,0,96.74480000054845,0,1]},"parentMatrixWorld":{"elements":[0.9999999997014749,-0.000024434609525489164,0,0,0.000024434609525489164,0.9999999997014749,0,0,0,0,1,0,0,96.74480000054845,0,1]}}},"layers":1,"matrix":[-0.9999853955533397,0.005404442121256182,0.000026179938776924363,0,-0.005404210720614049,-0.9998685196679236,-0.015288488596415828,0,-0.00005644925511093427,-0.015288406798405402,0.9998831238855108,0,-11.136899999999999,-5.282100000000014,-0.0308,1],"children":[{"uuid":"6d7913a4-af82-45dc-8cd7-10be963f35a9","type":"Bone","name":"mixamorigRightLeg","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,44.8163,0],"rotation":[-1.8356,-0.0079,0.6855],"parentMatrix":{"elements":[-0.9999853955533397,0.005404442121256182,0.000026179938776924363,0,-0.005404210720614049,-0.9998685196679236,-0.015288488596415828,0,-0.00005644925511093427,-0.015288406798405402,0.9998831238855108,0,-11.136899999999999,-5.282100000000014,-0.0308,1]},"parentMatrixWorld":{"elements":[-0.999985263199386,0.005428876372314358,0.000026179938776924363,0,-0.0054286421158556706,-0.999868387319659,-0.015288488596415828,0,-0.000056822821344468626,-0.015288405414525922,0.9998831238855108,0,-11.137029062726329,91.4629721279281,-0.0308,1]}}},"layers":1,"matrix":[0.9999284199248911,0.011963946478365593,0.00013788101047067214,0,-0.011953391043381173,0.9994153697545944,-0.03203178329177314,0,-0.0005210269419710631,0.032027842308683635,0.9994868412580405,0,-1.7763568394002505e-15,44.81630000000001,-2.220446049250313e-16,1],"children":[{"uuid":"0ba72991-64c3-4e8a-84d4-f159022c0dd2","type":"Bone","name":"mixamorigRightFoot","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,37.26,0],"rotation":[59.76429988917859,-0.7057883264333228,-0.5668464906608016],"parentMatrix":{"elements":[0.9999284199248911,0.011963946478365593,0.00013788101047067214,0,-0.011953391043381173,0.9994153697545944,-0.03203178329177314,0,-0.0005210269419710631,0.032027842308683635,0.9994868412580405,0,-1.7763568394002505e-15,44.81630000000001,-2.220446049250313e-16,1]},"parentMatrixWorld":{"elements":[-0.9999786399976507,-0.006535992079153288,-0.00001886769901377481,0,0.006529566657456779,-0.9988590126120965,-0.04730790296402336,0,0.00029035790784704774,-0.047307015665003296,0.9988803541771937,0,-11.38032071638315,46.65257052129405,-0.7159734914835512,1]}}},"layers":1,"matrix":[0.9998751953784789,-0.009892425633960316,0.012318018587616433,0,-0.00565997778113974,0.5036390077422157,0.8638956618318866,0,-0.014749858248990173,-0.8638575633722914,0.5035201603571813,0,0,37.260000000000005,0,1],"children":[{"uuid":"bfa40ad4-55f6-4a2d-ad0c-0eeea7b5af10","type":"Bone","name":"mixamorigRightToeBase","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,16.8121,0],"rotation":[32.9557,0.08610000000000001,0],"parentMatrix":{"elements":[0.9998751953784789,-0.009892425633960316,0.012318018587616433,0,-0.00565997778113974,0.5036390077422157,0.8638956618318866,0,-0.014749858248990173,-0.8638575633722914,0.5035201603571813,0,0,37.260000000000005,0,1]},"parentMatrixWorld":{"elements":[-0.9999148546604316,0.0027632334456544373,0.012753351337292029,0,0.009199240293316873,-0.5438956940235894,0.8391024061463674,0,0.009255128709715874,0.8391482816305604,0.5438239641915786,0,-11.13702906272631,9.435083711367334,-2.478665955923062,1]}}},"layers":1,"matrix":[0.9999988709037609,1.9515639104739076e-18,-0.0015027279203920483,0,0.0008174696049645851,0.8390914216979621,0.543989814037301,0,0.0012609261071469871,-0.5439904282548473,0.8390904742829939,0,1.7763568394002505e-15,16.8121,1.7763568394002505e-15,1],"children":[{"uuid":"234b566f-7b33-44c1-9719-1c25819a33a4","type":"Bone","name":"mixamorigRightToe_End","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,7.4359,0],"parentMatrix":{"elements":[0.9999988709037609,1.9515639104739076e-18,-0.0015027279203920483,0,0.0008174696049645851,0.8390914216979621,0.543989814037301,0,0.0012609261071469871,-0.5439904282548473,0.8390904742829939,0,1.7763568394002505e-15,16.8121,1.7763568394002505e-15,1]},"parentMatrixWorld":{"elements":[-0.9999276336006487,0.0015022187735426924,0.01193611748276203,0,0.011936299360712574,0.00011216537962899231,0.9999287535502206,0,0.001500772926639529,0.9999988653781977,-0.0001300881956108335,0,-10.98237051499104,0.2910549138733476,11.628407606450285,1]}}},"layers":1,"matrix":[1,4.336808689942018e-18,1.6135977645194421e-19,0,-4.336808689942018e-18,1,2.710505431213761e-20,0,-1.6135977645194421e-19,-2.710505431213761e-20,1,0,1.7763568394002505e-15,7.4359,-5.551115123125783e-17,1],"children":[{"uuid":"cf0ed8e6-25bb-45d1-b642-f92cb7a067a1","type":"Bone","name":"mixamorigRightToe_End_end","userData":{"transformData":{"eulerOrder":"ZYX","translation":[0,7.4359,0],"parentMatrix":{"elements":[1,4.336808689942018e-18,1.6135977645194421e-19,0,-4.336808689942018e-18,1,2.710505431213761e-20,0,-1.6135977645194421e-19,-2.710505431213761e-20,1,0,1.7763568394002505e-15,7.4359,-5.551115123125783e-17,1]},"parentMatrixWorld":{"elements":[-0.9999276336006487,0.0015022187735426926,0.011936117482762033,0,0.011936299360712577,0.00011216537962899234,0.9999287535502206,0,0.0015007729266395293,0.9999988653781977,-0.00013008819561083354,0,-10.89361338657472,0.2918889644197308,19.06377782497437,1]}}},"layers":1,"matrix":[1,4.336808689942018e-18,1.6125389733353743e-19,0,-4.336808689942018e-18,1,-1.3552527156068805e-20,0,-1.6125389733353743e-19,1.3552527156068805e-20,1,0,3.552713678800501e-15,7.4359,0,1]}]}]}]}]}]}]}]}')};const M6=new y6().parse(b6);var _6=function(r,t,e,i=!1){const s=ba.parse(e),n=[],a=new Te,o=new Te,h=new Te,l=new S,u=M6.getObjectByName("mixamorigHips").getWorldPosition(l).y,c=t.humanoid?.getNormalizedBoneNode("hips").getWorldPosition(l).y,d=t.scene.getWorldPosition(l).y,m=Math.abs(c-d)/u;return s.tracks.forEach(f=>{const g=f.name.split("."),y=g[0],x=x6[y],_=t.humanoid?.getNormalizedBoneNode(x)?.name;if(_!=null){const M=g[1];if(f instanceof zs){if(i)for(let v=0;v<f.values.length;v+=4){const N=f.values.slice(v,v+4);h.fromArray(N),h.premultiply(o).multiply(a),h.toArray(N),N.forEach((T,C)=>{f.values[C+v]=T})}n.push(new zs(`${_}.${M}`,f.times,f.values.map((v,N)=>t.meta?.metaVersion==="0"&&N%2===0?-v:v)))}else if(f instanceof Ls){const v=f.values.map((N,T)=>(t.meta?.metaVersion==="0"&&T%3!==1?-N:N)*m);n.push(new Ls(`${_}.${M}`,f.times,v))}}}),new ba("vrmAnimation",s.duration,n)};const L9=4096,P9=2048;class v6{constructor(){this.packer=new C9(L9,P9),this.packer.init(L9,P9)}setAnimationJson(t){this.jsonAnimation=t}prepare(t,e=[]){const i=this.prepareAnimations(t),{mergedSkeleton:s,boneMap:n}=this.updateSkeleton(t.scene);return t.springBoneManager=null,t.update(0),t.scene.position.copy(t.scene.position),this.bakeAll(t,i,s,n)}updateSkeleton(t,e=null){let i=[],s=[];t.traverse(o=>{o.type=="Mesh",o.type=="SkinnedMesh"&&(i.push(o.skeleton),s.push(o))});const{skeleton:n,boneMap:a}=this.mergeSkeletons(i);return s.forEach(o=>{this.updateSkinIndices(o.geometry,o.skeleton,e??a)}),{mergedSkeleton:n,boneMap:a}}prepareAnimations(t){let e=!1;t.scene.traverse(s=>{s.type=="SkinnedMesh"&&(e=!0)});var i=[];if(e)for(let s=0;s<this.jsonAnimation.length;s++){const n=this.jsonAnimation[s],a=_6(t.scene,t,n.clip);a.name=n.name,a.loop=n.emote.loop==!0,a.emote=n.emote,i.push(a)}return i}mergeSkeletons(t){const e=[],i=new Map,s=[];return t.forEach(n=>{let a=0;for(;a<n.bones.length;){const o=n.bones[a];i.has(o.name)||(i.set(o.name,e.length),s[e.length]=n.boneInverses[a].clone(),e.push(o)),a++}}),{skeleton:new Vo(e,s),boneMap:i}}updateSkinIndices(t,e,i){const s=t.attributes.skinIndex.array;for(let n=0;n<s.length;n++){const a=e.bones[s[n]]?.name;a!=null&&(s[n]=i.get(a))}}}var B9=new Float32Array(1),w6=new Int32Array(B9.buffer);class T6 extends v6{constructor(t={}){super(),this.FPS_BAKING=t.fps,this.deltaFPS=1/this.FPS_BAKING}bakeAll(t,e,i,s){const n={};this.frameCount=-1,this.boneCount=i.bones.length,this.maxBoneElements=this.boneCount*4*4;const a=new Fx(t.scene),o=[];var h=[];const l=[],u=[];let c=0;for(;c<e.length;){const x=this.getBakedClip2(t,a,i,e[c],n);h.push(x),o.push(e[c].name),l.push(e[c].emote.loop==!0?1:0),u.push(e[c].emote.timeScale!=null?e[c].emote.timeScale:1),c++}const d=h.length,p=new Float32Array(d*4);var m={w:d,h:1,url:"metadata",image:new pa(p,d,1,1023,1016)};h.push(m);const f=new Float32Array(d*4);var g={w:d,h:1,url:"metadataadditionals",image:new pa(f,d,1,1023,1016)};for(h.push(g),this.packer.reset(),this.packer.fit(h),this.bakeTexture=new g6(this.packer.maxSize.w,this.packer.maxSize.h),c=0;c<h.length;){if(h.url!="metadata"&&h.url!="metadataadditionals"){this.bakeTexture.update(h[c].image,h[c].fit.x,h[c].fit.y),h[c].uvScale={x:h[c].w/this.packer.maxSize.w,y:h[c].h/this.packer.maxSize.h},h[c].uvPos={x:h[c].fit.x/this.packer.maxSize.w,y:h[c].fit.y/this.packer.maxSize.h};const x=m.image.source.data.data;x[c*4]=h[c].uvPos.x,x[c*4+1]=h[c].uvPos.y,x[c*4+2]=h[c].uvScale.x,x[c*4+3]=h[c].uvScale.y;const _=g.image.source.data.data;_[c*4]=l[c],_[c*4+1]=u[c]}c++}this.bakeTexture.update(m.image,m.fit.x,m.fit.y),this.bakeTexture.needsUpdate=!0;let y=0;for(;y<h.length;)h[y].image.dispose(),h[y].data=null,h[y]=null,y++;return{boneMap:s,texture:this.bakeTexture,metadata:m,ids:o,metaDataArray:p,additionalMeta:g,extras:n}}getBakedClip2(t,e,i,s,n){this.delta=0;const a=s.duration,o=Math.floor(a/this.deltaFPS),h=e.clipAction(s).play(),l=this.boneCount*4*4*o,u=new Uint16Array(l);var c=0,d=0;const p=s.name=="SITTING",m=new S,f=new S;for(;d<o;){e.update(this.deltaFPS),t.update(this.deltaFPS),c+=this.deltaFPS;let x=0,_=!1;for(;x<t.scene.children.length;)t.scene.children[x].isBone&&(_=!0,t.scene.children[x].updateWorldMatrix(!1,!0)),x++;for(_==!1&&t.scene.updateWorldMatrix(!1,!0),i.update(),x=0;x<this.maxBoneElements;){const M=this.maxBoneElements*d+x;u[M]=this.toHalf(i.boneMatrices[x]),x++}p&&d==0&&(t.humanoid?.getNormalizedBoneNode("hips").getWorldPosition(m),t.humanoid?.getNormalizedBoneNode("spine").getWorldPosition(f)),d++}h.stop();const g=this.boneCount*4;let y={data:u,image:new pa(u,g,o,1023,1016),url:s.name,w:g,h:o,frames:o,duration:a};return p&&(n[s.name]={spinePosition:{x:f.x,y:f.y,z:f.z},hipsPosition:{x:m.x,y:m.y,z:m.z}}),y}toHalf(t){B9[0]=t;var e=w6[0],i=e>>16&32768,s=e>>12&2047,n=e>>23&255;return n<103?i:n>142?(i|=31744,i|=(n==255?0:1)&&e&8388607,i):n<113?(s|=2048,i|=(s>>114-n)+(s>>113-n&1),i):(i|=n-112<<10|s>>1,i+=s&1,i)}}let b0=new Ub().setCrossOrigin("anonymous");b0.register(r=>{const t=new f7(r,{helperRoot:null,autoUpdateHumanBones:!0});return t.metaPlugin.needThumbnailImage=!1,t.mtoonMaterialPlugin.getMaterialType=e=>null,t});let Vl;self.addEventListener("message",async function(r){if(r.data.init==!0){Vl=new T6(r.data),Vl.setAnimationJson(r.data.animation);return}r.data.animation&&Vl.setAnimationJson(r.data.animation);try{const t=r.data.url;let e;r.data.rawBuffer?e=await b0.parseAsync(r.data.rawBuffer,""):e=await b0.loadAsync(t);const i=Vl.prepare(e.userData.vrm);self.postMessage({done:!0,data:i,rawBuffer:r.data.rawBuffer},[i.texture.source.data.data.buffer,r.data.rawBuffer])}catch{self.postMessage({error:!0})}finally{}},!1)})();
