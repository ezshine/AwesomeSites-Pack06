//  Merci-Michel [R]
//  https://www.merci-michel.com/
//  Build 20241209-145825

import{a as e,w as t,d as a,_ as n,o as r,c as i,b as o,u as l,e as s,f as u,T as d,F as c,g as m,h as w,C as y,i as g,r as $,j as p,k as f,l as v,m as b,n as h,p as O,q as _}from"./vendor.BVNJwFO8f063f8e7.js";let E=!0;const I={guard(t,a,n,r){if(n)return;const i=e.$webgl.$scenes.list.editor,o={id:e.$editor.edition.activeItem};t.meta.loadPromise=Promise.all([o,i.item.load(o),i.preload()])},async load(t,a,n,r){const i=e.$webgl.$scenes,o=i.list.editor;let[l]=await t.meta.loadPromise;t.meta.loadPromise=null,await o.item.setInstant(l),await o.triggerInit(),e.$editor.edition.hasBeenSubmitted?e.$editor.edition.resetFromSubmit():r||"submit"!==e.$editor.step.current&&"preview"!==e.$editor.step.current||e.$editor.step.set("edition"),await o.prerender(),await i.set(o),r||await o.resetEnter(),r||await e.$webgl.$overlay.consumeSpinnerDelay()},async transitionIn(t,a,n,r){if(r)return;await e.$webgl.$overlay.gradientIn()},async transitionOut(a,n,r,i){if(i)return;!i&&E&&await t(150),E=!1,await e.$webgl.$overlay.gradientOut()}},P=Object.freeze(Object.defineProperty({__proto__:null,default:I},Symbol.toStringTag,{value:"Module"})),S={guard(t,a,n,r){if("Gallery"===a.name&&(t.meta.galleryFilter=e.$api.gallery.currentFilter),n)return;const i=e.$webgl.$scenes.list.preview;t.meta.isInitial=r,t.meta.loadPromise=Promise.all([(async()=>{const a=await e.$api.gallery.getEntry(t.params.id);return!!a&&(t.meta.entryData=a,await i.item.load(a))})(),i.preload()])},async load(t,a,n,r){const[i]=await t.meta.loadPromise;i||e.$router.push({name:"Gallery"});const o=e.$webgl.$scenes,l=o.list.preview;await l.triggerInit(),"Entry"!==(null==a?void 0:a.name)&&await l.item.setInstant(t.meta.entryData),await l.prerender(),await o.set(l),"Entry"===(null==a?void 0:a.name)||r||await l.resetEnter(),r||await e.$webgl.$overlay.consumeSpinnerDelay()},async transitionIn(t,a,n,r){if(r)return;if("Entry"===a.name)return;let i="gradient";"Editor"===a.name&&(i="fade"),await e.$webgl.$overlay[i+"In"]()},async transitionOut(t,a,n,r){if(r)return;if("Entry"===a.name)return;let i="gradient";"Editor"===a.name&&(i="fade"),await e.$webgl.$overlay[i+"Out"]()}},G=Object.freeze(Object.defineProperty({__proto__:null,default:S},Symbol.toStringTag,{value:"Module"})),j={guard(t,n,r,i){if(r)return;let o=t.query.view;const l=e.$api.status.filters,s=e.$api.status.filters[0];if(o===s)return{name:"Gallery",query:{}};if("user"===o&&!e.$api.user.isConnected)return{name:"Gallery",query:{}};if(o=o??s,!l.includes(o))return{name:"Gallery",query:{}};t.meta.filter=o,e.$api.gallery.setFilter(o);const u=e.$api.gallery.getList();"Home"===n.name||"Editor"===n.name?u.clearCache():u.clearOldCache(),t.meta.loadPromise=u.getPage(),t.meta.thumbPromise=a()},async load(t,a,n,r){const i=e.$webgl.$scenes,o=e.$webgl.$scenes.list.gallery;"Gallery"!==(null==a?void 0:a.name)&&(await t.meta.loadPromise,await o.triggerInit(),await i.set(o)),r||await o.resetEnter(),r||await e.$webgl.$overlay.consumeSpinnerDelay(),t.meta.loadPromise=null},async transitionIn(t,a,n,r){if(r)return;if("Gallery"===a.name)return;let i="gradient";"Entry"!==a.name&&"Editor"!==a.name||(i="fade"),await e.$webgl.$overlay[i+"In"]()},async transitionOut(t,a,n,r){if(r)return;if("Gallery"===a.name)return;let i="gradient";"Entry"!==a.name&&"Editor"!==a.name||(i="fade"),await t.meta.thumbPromise,await e.$webgl.$overlay[i+"Out"]()}},C=Object.freeze(Object.defineProperty({__proto__:null,default:j},Symbol.toStringTag,{value:"Module"})),D={guard(t,a,n,r){if(n)return;const i=e.$webgl.$scenes.list.preview;t.meta.isInitial=r,t.meta.loadPromise=Promise.all([(async()=>{await e.$api.gallery.getFeatureds();const t=e.$webgl.$scenes.list.preview,a=e.$api.gallery.featureds[0];return await t.item.load(a),a})(),i.preload()])},async load(t,a,n,r){const i=e.$webgl.$scenes,o=e.$webgl.$scenes.list.preview,[l]=await t.meta.loadPromise;t.meta.loadPromise=null,await o.triggerInit(),await o.item.setInstant(l),await o.prerender(),await i.set(o),r||await o.resetEnter(),r||await e.$webgl.$overlay.consumeSpinnerDelay()},async transitionIn(t,a,n,r){if(r)return;await e.$webgl.$overlay.fadeIn()},async transitionOut(t,a,n,r){if(r)return;await e.$webgl.$overlay.fadeOut()}},k=Object.freeze(Object.defineProperty({__proto__:null,default:D},Symbol.toStringTag,{value:"Module"})),R=Object.fromEntries(Object.entries(Object.assign({"./views/editor/routeGuard.js":P,"./views/entry/routeGuard.js":G,"./views/gallery/routeGuard.js":C,"./views/home/routeGuard.js":k})).map((([e,t])=>[e.match(/views\/(.+)\/routeGuard.js/)[1],t.default])));const L={class:"app-header"};const F=n({},[["render",function(e,t){return r(),i("header",L)}],["__scopeId","data-v-1dbe8c53"]]),M=["cookies","measure_content_performance"];function q(e){let t;return M.map((a=>{t=!!e.includes(a)})),t}const T=n({__name:"EntryCorners",setup(t){const a=e.$router.currentRoute.value.meta.isInitial?200:300,n=o((()=>e.$preloader.destroyed&&"Entry"===e.$router.currentRoute.value.name)),g=(t,a)=>{e.$router.push({name:t}),e.$analytics.event({name:"cocreate_undw3",category:"homepage",action:`click_${a}`})};return(t,o)=>l(e).$viewport.width>=900?(r(),i(c,{key:0},[s(d,null,{default:u((()=>[n.value?(r(),w(y,{key:0,"bottom-left":"",label:t.$l("global.corner.gallery"),index:1,delay:l(a),"is-glitch":!1,onClick:o[0]||(o[0]=e=>g("Gallery","gallery"))},null,8,["label","delay"])):m("",!0)])),_:1}),s(d,null,{default:u((()=>[n.value?(r(),w(y,{key:0,"bottom-right":"",label:t.$l("home.corner.create"),index:2,delay:l(a),"is-glitch":!1,onClick:o[1]||(o[1]=e=>g("Editor","create"))},null,8,["label","delay"])):m("",!0)])),_:1})],64)):m("",!0)}},[["__scopeId","data-v-8a624158"]]),z={class:"ui"},U={__name:"App",setup(t){!function(){if(!window.didomiOnReady&&!window.didomiEventListeners)return;window.didomiOnReady=window.didomiOnReady||[],window.didomiEventListeners=window.didomiEventListeners||[];const t=window.Didomi;let a=t.getUserStatus(),n=a.purposes.consent.enabled;window.didomiOnReady.push((function(){q(n)&&e.$analytics.init()})),window.didomiEventListeners.push({event:"consent.changed",listener:()=>{a=t.getUserStatus(),n=a.purposes.consent.enabled,q(n)?e.$analytics.init():location.reload()}},{event:"preferences.shown",listener:function(){e.$store.isCookiesOpen=!0}},{event:"preferences.hidden",listener:function(){e.$store.isCookiesOpen=!1}})}();const a=e=>e.split("?")[0];return(e,t)=>{const n=f("NiceRouterView"),o=f("WebGL"),u=f("OverlayManager");return r(),i(c,null,[s(p),g("main",z,[s(F),s(n,{"custom-key":a})]),s(o),s(T),s(u),(r(),w($(l(null))))],64)}}};let x;v(),b({component:U,router:{routerReadyOnInit:!0,guards:function(){const t={uid:-1,transition:null};let n=!0,r=null,i=0,o=null;return{beforeEach:async function(l,s){var u,d;const c=n;n&&await e.$api.user.initialGuard(l);e.$router.debug.bypass;const m=!1;R[null==(u=s.name)?void 0:u.toLowerCase()];const w=R[null==(d=l.name)?void 0:d.toLowerCase()]??null,y=r;if(await y,null==w?void 0:w.guard){const e=w.guard(l,s,m,c);if(e instanceof Object||!1===e)return e}"Game"===l.name&&"Game"!==s.name&&(e.$game.isPreviousGameSuccessful=null);e.$overlay.closeDialog(),r=a();const g=++i;if(await o,i!==g)return!1;y?await null:w.transitionIn&&await w.transitionIn(l,s,m,c);if(i!==g)return!1;let $=!0;if(w.load)try{$=await w.load(l,s,m,c)}catch(p){$=!1}if(i!==g)return!1;r&&(r.resolve(),r=null);return t.uid=g,t.transition=w.transitionOut??null,$??!0},afterEach:async function(a,r){const l=n;n=!1;const{uid:s,transition:u}=t;if(s!==i)return;u&&(o=u(a,r,null,l));"Entry"!==a.name&&e.$sessionStorage.removeItem("pendingVote")}}}()},controls:{touch:{canWheelClick:!0,canSecondaryClick:!0,preventZoom:!0},guard:(t,a)=>"Gallery"!==e.$router.currentRoute.value.name&&(!e.$store.isCommonMenuOpen&&(!1!==e.$editor.controls.guard(t,a)&&void 0))},beforePluginsInstall(){const t=new URLSearchParams(window.location.search).get("previewData");if(t){const e=new URL(window.location.href);e.searchParams.delete("previewData"),window.history.replaceState({},document.title,e),x=t}h(),_.toggleGlobalDraggingFlag=(t,a)=>{e.$editor.controls.toggleDragging(!!a,t)}},preload:async()=>{e.$store.previewData={};try{if(x){const t=JSON.parse(atob(x));e.$store.previewData=t}}catch(t){}},init:async()=>{O()}});
