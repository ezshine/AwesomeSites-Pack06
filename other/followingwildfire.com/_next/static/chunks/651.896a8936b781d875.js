(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[651],{686:function(t,e,i){"use strict";let r,s,n,o,a,l,h,c,u,d,p,f,m,g,_,y,v,x,T,E,w,b,O;i.d(e,{B:function(){return $}});var M,P=i(3238),A=i(8699),C=i(959),S=i(6426);/*!
 * camera-controls
 * https://github.com/yomotsu/camera-controls
 * (c) 2017 @yomotsu
 * Released under the MIT License.
 */let U={LEFT:1,RIGHT:2,MIDDLE:4},L=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,OFFSET:4,DOLLY:8,ZOOM:16,TOUCH_ROTATE:32,TOUCH_TRUCK:64,TOUCH_OFFSET:128,TOUCH_DOLLY:256,TOUCH_ZOOM:512,TOUCH_DOLLY_TRUCK:1024,TOUCH_DOLLY_OFFSET:2048,TOUCH_DOLLY_ROTATE:4096,TOUCH_ZOOM_TRUCK:8192,TOUCH_ZOOM_OFFSET:16384,TOUCH_ZOOM_ROTATE:32768}),B={NONE:0,IN:1,OUT:-1};function R(t){return t.isPerspectiveCamera}function D(t){return t.isOrthographicCamera}let F=2*Math.PI,V=Math.PI/2,z=Math.PI/180;function I(t,e,i){return Math.max(e,Math.min(i,t))}function H(t,e=1e-5){return Math.abs(t)<e}function k(t,e,i=1e-5){return H(t-e,i)}function N(t,e){return Math.round(t/e)*e}function Y(t){return isFinite(t)?t:t<0?-Number.MAX_VALUE:Number.MAX_VALUE}function Z(t){return Math.abs(t)<Number.MAX_VALUE?t:1/0*t}function X(t,e,i,r,s=1/0,n){let o=2/(r=Math.max(1e-4,r)),a=o*n,l=1/(1+a+.48*a*a+.235*a*a*a),h=t-e,c=e,u=s*r;e=t-(h=I(h,-u,u));let d=(i.value+o*h)*n;i.value=(i.value-o*d)*l;let p=e+(h+d)*l;return c-t>0==p>c&&(p=c,i.value=(p-c)/n),p}function G(t,e,i,r,s=1/0,n,o){let a=2/(r=Math.max(1e-4,r)),l=a*n,h=1/(1+l+.48*l*l+.235*l*l*l),c=e.x,u=e.y,d=e.z,p=t.x-c,f=t.y-u,m=t.z-d,g=c,_=u,y=d,v=s*r,x=p*p+f*f+m*m;if(x>v*v){let t=Math.sqrt(x);p=p/t*v,f=f/t*v,m=m/t*v}c=t.x-p,u=t.y-f,d=t.z-m;let T=(i.x+a*p)*n,E=(i.y+a*f)*n,w=(i.z+a*m)*n;i.x=(i.x-a*T)*h,i.y=(i.y-a*E)*h,i.z=(i.z-a*w)*h,o.x=c+(p+T)*h,o.y=u+(f+E)*h,o.z=d+(m+w)*h;let b=g-t.x,O=_-t.y,M=y-t.z;return b*(o.x-g)+O*(o.y-_)+M*(o.z-y)>0&&(o.x=g,o.y=_,o.z=y,i.x=(o.x-g)/n,i.y=(o.y-_)/n,i.z=(o.z-y)/n),o}function j(t,e){e.set(0,0),t.forEach(t=>{e.x+=t.clientX,e.y+=t.clientY}),e.x/=t.length,e.y/=t.length}function q(t,e){return!!D(t)&&(console.warn(`${e} is not supported in OrthographicCamera`),!0)}class K{constructor(){this._listeners={}}addEventListener(t,e){let i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){let i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){let i=this._listeners[t];if(void 0!==i){let t=i.indexOf(e);-1!==t&&i.splice(t,1)}}removeAllEventListeners(t){if(!t){this._listeners={};return}Array.isArray(this._listeners[t])&&(this._listeners[t].length=0)}dispatchEvent(t){let e=this._listeners[t.type];if(void 0!==e){t.target=this;let i=e.slice(0);for(let e=0,r=i.length;e<r;e++)i[e].call(this,t)}}}let W=1/8,Q=/Mac/.test(null===(M=null==globalThis?void 0:globalThis.navigator)||void 0===M?void 0:M.platform);class J extends K{static install(t){s=Object.freeze(new(r=t.THREE).Vector3(0,0,0)),n=Object.freeze(new r.Vector3(0,1,0)),o=Object.freeze(new r.Vector3(0,0,1)),a=new r.Vector2,l=new r.Vector3,h=new r.Vector3,c=new r.Vector3,u=new r.Vector3,d=new r.Vector3,p=new r.Vector3,f=new r.Vector3,m=new r.Vector3,g=new r.Vector3,_=new r.Spherical,y=new r.Spherical,v=new r.Box3,x=new r.Box3,T=new r.Sphere,E=new r.Quaternion,w=new r.Quaternion,b=new r.Matrix4,O=new r.Raycaster}static get ACTION(){return L}constructor(t,e){super(),this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.minDistance=Number.EPSILON,this.maxDistance=1/0,this.infinityDolly=!1,this.minZoom=.01,this.maxZoom=1/0,this.smoothTime=.25,this.draggingSmoothTime=.125,this.maxSpeed=1/0,this.azimuthRotateSpeed=1,this.polarRotateSpeed=1,this.dollySpeed=1,this.dollyDragInverted=!1,this.truckSpeed=2,this.dollyToCursor=!1,this.dragToOffset=!1,this.verticalDragToForward=!1,this.boundaryFriction=0,this.restThreshold=.01,this.colliderMeshes=[],this.cancel=()=>{},this._enabled=!0,this._state=L.NONE,this._viewport=null,this._changedDolly=0,this._changedZoom=0,this._hasRested=!0,this._boundaryEnclosesCamera=!1,this._needsUpdate=!0,this._updatedLastTime=!1,this._elementRect=new DOMRect,this._isDragging=!1,this._dragNeedsUpdate=!0,this._activePointers=[],this._lockedPointer=null,this._interactiveArea=new DOMRect(0,0,1,1),this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._isUserControllingOffset=!1,this._isUserControllingZoom=!1,this._lastDollyDirection=B.NONE,this._thetaVelocity={value:0},this._phiVelocity={value:0},this._radiusVelocity={value:0},this._targetVelocity=new r.Vector3,this._focalOffsetVelocity=new r.Vector3,this._zoomVelocity={value:0},this._truckInternal=(t,e,i)=>{let r,s;if(R(this._camera)){let i=l.copy(this._camera.position).sub(this._target),n=this._camera.getEffectiveFOV()*z,o=i.length()*Math.tan(.5*n);r=this.truckSpeed*t*o/this._elementRect.height,s=this.truckSpeed*e*o/this._elementRect.height}else{if(!D(this._camera))return;let i=this._camera;r=t*(i.right-i.left)/i.zoom/this._elementRect.width,s=e*(i.top-i.bottom)/i.zoom/this._elementRect.height}this.verticalDragToForward?(i?this.setFocalOffset(this._focalOffsetEnd.x+r,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(r,0,!0),this.forward(-s,!0)):i?this.setFocalOffset(this._focalOffsetEnd.x+r,this._focalOffsetEnd.y+s,this._focalOffsetEnd.z,!0):this.truck(r,s,!0)},this._rotateInternal=(t,e)=>{let i=F*this.azimuthRotateSpeed*t/this._elementRect.height,r=F*this.polarRotateSpeed*e/this._elementRect.height;this.rotate(i,r,!0)},this._dollyInternal=(t,e,i)=>{let r=Math.pow(.95,-t*this.dollySpeed),s=this._sphericalEnd.radius,n=this._sphericalEnd.radius*r,o=I(n,this.minDistance,this.maxDistance);this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(n,!0):(this.infinityDolly&&!this.dollyToCursor&&this.dollyInFixed(o-n,!0),this._dollyToNoClamp(o,!0)),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?n:o)-s,this._dollyControlCoord.set(e,i)),this._lastDollyDirection=Math.sign(-t)},this._zoomInternal=(t,e,i)=>{let r=Math.pow(.95,t*this.dollySpeed),s=this._zoom,n=this._zoom*r;this.zoomTo(n,!0),this.dollyToCursor&&(this._changedZoom+=n-s,this._dollyControlCoord.set(e,i))},void 0===r&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=t,this._yAxisUpSpace=new r.Quaternion().setFromUnitVectors(this._camera.up,n),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=L.NONE,this._target=new r.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new r.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new r.Spherical().setFromVector3(l.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new r.Vector3,new r.Vector3,new r.Vector3,new r.Vector3],this._updateNearPlaneCorners(),this._boundary=new r.Box3(new r.Vector3(-1/0,-1/0,-1/0),new r.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new r.Vector2,this.mouseButtons={left:L.ROTATE,middle:L.DOLLY,right:L.TRUCK,wheel:R(this._camera)?L.DOLLY:D(this._camera)?L.ZOOM:L.NONE},this.touches={one:L.TOUCH_ROTATE,two:R(this._camera)?L.TOUCH_DOLLY_TRUCK:D(this._camera)?L.TOUCH_ZOOM_TRUCK:L.NONE,three:L.TOUCH_TRUCK};let i=new r.Vector2,s=new r.Vector2,o=new r.Vector2,h=t=>{if(!this._enabled||!this._domElement)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){let e=this._domElement.getBoundingClientRect(),i=t.clientX/e.width,r=t.clientY/e.height;if(i<this._interactiveArea.left||i>this._interactiveArea.right||r<this._interactiveArea.top||r>this._interactiveArea.bottom)return}let e="mouse"!==t.pointerType?null:(t.buttons&U.LEFT)===U.LEFT?U.LEFT:(t.buttons&U.MIDDLE)===U.MIDDLE?U.MIDDLE:(t.buttons&U.RIGHT)===U.RIGHT?U.RIGHT:null;if(null!==e){let t=this._findPointerByMouseButton(e);t&&this._disposePointer(t)}if((t.buttons&U.LEFT)===U.LEFT&&this._lockedPointer)return;let i={pointerId:t.pointerId,clientX:t.clientX,clientY:t.clientY,deltaX:0,deltaY:0,mouseButton:e};this._activePointers.push(i),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.addEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",u),this._isDragging=!0,m(t)},c=t=>{t.cancelable&&t.preventDefault();let e=t.pointerId,i=this._lockedPointer||this._findPointerById(e);if(i){if(i.clientX=t.clientX,i.clientY=t.clientY,i.deltaX=t.movementX,i.deltaY=t.movementY,this._state=0,"touch"===t.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(t.buttons&U.LEFT)===U.LEFT)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(t.buttons&U.MIDDLE)===U.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(t.buttons&U.RIGHT)===U.RIGHT&&(this._state=this._state|this.mouseButtons.right);g()}},u=t=>{let e=this._findPointerById(t.pointerId);if(!e||e!==this._lockedPointer){if(e&&this._disposePointer(e),"touch"===t.pointerType)switch(this._activePointers.length){case 0:this._state=L.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=L.NONE;_()}},d=-1,p=t=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===L.NONE)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){let e=this._domElement.getBoundingClientRect(),i=t.clientX/e.width,r=t.clientY/e.height;if(i<this._interactiveArea.left||i>this._interactiveArea.right||r<this._interactiveArea.top||r>this._interactiveArea.bottom)return}if(t.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===L.ROTATE||this.mouseButtons.wheel===L.TRUCK){let t=performance.now();d-t<1e3&&this._getClientRect(this._elementRect),d=t}let e=Q?-1:-3,i=1===t.deltaMode?t.deltaY/e:t.deltaY/(10*e),r=this.dollyToCursor?(t.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,s=this.dollyToCursor?-((t.clientY-this._elementRect.y)/this._elementRect.height*2)+1:0;switch(this.mouseButtons.wheel){case L.ROTATE:this._rotateInternal(t.deltaX,t.deltaY),this._isUserControllingRotate=!0;break;case L.TRUCK:this._truckInternal(t.deltaX,t.deltaY,!1),this._isUserControllingTruck=!0;break;case L.OFFSET:this._truckInternal(t.deltaX,t.deltaY,!0),this._isUserControllingOffset=!0;break;case L.DOLLY:this._dollyInternal(-i,r,s),this._isUserControllingDolly=!0;break;case L.ZOOM:this._zoomInternal(-i,r,s),this._isUserControllingZoom=!0}this.dispatchEvent({type:"control"})},f=t=>{if(this._domElement&&this._enabled){if(this.mouseButtons.right===J.ACTION.NONE){let e=t instanceof PointerEvent?t.pointerId:0,i=this._findPointerById(e);i&&this._disposePointer(i),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u);return}t.preventDefault()}},m=t=>{if(this._enabled){if(j(this._activePointers,a),this._getClientRect(this._elementRect),i.copy(a),s.copy(a),this._activePointers.length>=2){let t=a.x-this._activePointers[1].clientX,e=a.y-this._activePointers[1].clientY;o.set(0,Math.sqrt(t*t+e*e));let i=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,r=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;s.set(i,r)}if(this._state=0,t){if("pointerType"in t&&"touch"===t.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._lockedPointer||(t.buttons&U.LEFT)!==U.LEFT||(this._state=this._state|this.mouseButtons.left),(t.buttons&U.MIDDLE)===U.MIDDLE&&(this._state=this._state|this.mouseButtons.middle),(t.buttons&U.RIGHT)===U.RIGHT&&(this._state=this._state|this.mouseButtons.right)}else this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);((this._state&L.ROTATE)===L.ROTATE||(this._state&L.TOUCH_ROTATE)===L.TOUCH_ROTATE||(this._state&L.TOUCH_DOLLY_ROTATE)===L.TOUCH_DOLLY_ROTATE||(this._state&L.TOUCH_ZOOM_ROTATE)===L.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&L.TRUCK)===L.TRUCK||(this._state&L.TOUCH_TRUCK)===L.TOUCH_TRUCK||(this._state&L.TOUCH_DOLLY_TRUCK)===L.TOUCH_DOLLY_TRUCK||(this._state&L.TOUCH_ZOOM_TRUCK)===L.TOUCH_ZOOM_TRUCK)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&L.DOLLY)===L.DOLLY||(this._state&L.TOUCH_DOLLY)===L.TOUCH_DOLLY||(this._state&L.TOUCH_DOLLY_TRUCK)===L.TOUCH_DOLLY_TRUCK||(this._state&L.TOUCH_DOLLY_OFFSET)===L.TOUCH_DOLLY_OFFSET||(this._state&L.TOUCH_DOLLY_ROTATE)===L.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&L.ZOOM)===L.ZOOM||(this._state&L.TOUCH_ZOOM)===L.TOUCH_ZOOM||(this._state&L.TOUCH_ZOOM_TRUCK)===L.TOUCH_ZOOM_TRUCK||(this._state&L.TOUCH_ZOOM_OFFSET)===L.TOUCH_ZOOM_OFFSET||(this._state&L.TOUCH_ZOOM_ROTATE)===L.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&L.OFFSET)===L.OFFSET||(this._state&L.TOUCH_OFFSET)===L.TOUCH_OFFSET||(this._state&L.TOUCH_DOLLY_OFFSET)===L.TOUCH_DOLLY_OFFSET||(this._state&L.TOUCH_ZOOM_OFFSET)===L.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},g=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,j(this._activePointers,a);let t=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,e=t?-t.deltaX:s.x-a.x,r=t?-t.deltaY:s.y-a.y;if(s.copy(a),((this._state&L.ROTATE)===L.ROTATE||(this._state&L.TOUCH_ROTATE)===L.TOUCH_ROTATE||(this._state&L.TOUCH_DOLLY_ROTATE)===L.TOUCH_DOLLY_ROTATE||(this._state&L.TOUCH_ZOOM_ROTATE)===L.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(e,r),this._isUserControllingRotate=!0),(this._state&L.DOLLY)===L.DOLLY||(this._state&L.ZOOM)===L.ZOOM){let t=this.dollyToCursor?(i.x-this._elementRect.x)/this._elementRect.width*2-1:0,e=this.dollyToCursor?-((i.y-this._elementRect.y)/this._elementRect.height*2)+1:0,s=this.dollyDragInverted?-1:1;(this._state&L.DOLLY)===L.DOLLY?(this._dollyInternal(s*r*W,t,e),this._isUserControllingDolly=!0):(this._zoomInternal(s*r*W,t,e),this._isUserControllingZoom=!0)}if((this._state&L.TOUCH_DOLLY)===L.TOUCH_DOLLY||(this._state&L.TOUCH_ZOOM)===L.TOUCH_ZOOM||(this._state&L.TOUCH_DOLLY_TRUCK)===L.TOUCH_DOLLY_TRUCK||(this._state&L.TOUCH_ZOOM_TRUCK)===L.TOUCH_ZOOM_TRUCK||(this._state&L.TOUCH_DOLLY_OFFSET)===L.TOUCH_DOLLY_OFFSET||(this._state&L.TOUCH_ZOOM_OFFSET)===L.TOUCH_ZOOM_OFFSET||(this._state&L.TOUCH_DOLLY_ROTATE)===L.TOUCH_DOLLY_ROTATE||(this._state&L.TOUCH_ZOOM_ROTATE)===L.TOUCH_ZOOM_ROTATE){let t=a.x-this._activePointers[1].clientX,e=a.y-this._activePointers[1].clientY,i=Math.sqrt(t*t+e*e),r=o.y-i;o.set(0,i);let n=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,l=this.dollyToCursor?-((s.y-this._elementRect.y)/this._elementRect.height*2)+1:0;(this._state&L.TOUCH_DOLLY)===L.TOUCH_DOLLY||(this._state&L.TOUCH_DOLLY_ROTATE)===L.TOUCH_DOLLY_ROTATE||(this._state&L.TOUCH_DOLLY_TRUCK)===L.TOUCH_DOLLY_TRUCK||(this._state&L.TOUCH_DOLLY_OFFSET)===L.TOUCH_DOLLY_OFFSET?(this._dollyInternal(r*W,n,l),this._isUserControllingDolly=!0):(this._zoomInternal(r*W,n,l),this._isUserControllingZoom=!0)}((this._state&L.TRUCK)===L.TRUCK||(this._state&L.TOUCH_TRUCK)===L.TOUCH_TRUCK||(this._state&L.TOUCH_DOLLY_TRUCK)===L.TOUCH_DOLLY_TRUCK||(this._state&L.TOUCH_ZOOM_TRUCK)===L.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(e,r,!1),this._isUserControllingTruck=!0),((this._state&L.OFFSET)===L.OFFSET||(this._state&L.TOUCH_OFFSET)===L.TOUCH_OFFSET||(this._state&L.TOUCH_DOLLY_OFFSET)===L.TOUCH_DOLLY_OFFSET||(this._state&L.TOUCH_ZOOM_OFFSET)===L.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(e,r,!0),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},_=()=>{j(this._activePointers,a),s.copy(a),this._dragNeedsUpdate=!1,(0===this._activePointers.length||1===this._activePointers.length&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),0===this._activePointers.length&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{this._enabled&&this._domElement&&(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",y),this._domElement.ownerDocument.addEventListener("pointerlockerror",v),this._domElement.ownerDocument.addEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",u),m())},this.unlockPointer=()=>{var t,e,i;null!==this._lockedPointer&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),null===(t=this._domElement)||void 0===t||t.ownerDocument.exitPointerLock(),null===(e=this._domElement)||void 0===e||e.ownerDocument.removeEventListener("pointerlockchange",y),null===(i=this._domElement)||void 0===i||i.ownerDocument.removeEventListener("pointerlockerror",v),this.cancel()};let y=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},v=()=>{this.unlockPointer()};this._addAllEventListeners=t=>{this._domElement=t,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",h),this._domElement.addEventListener("pointercancel",u),this._domElement.addEventListener("wheel",p,{passive:!1}),this._domElement.addEventListener("contextmenu",f)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",h),this._domElement.removeEventListener("pointercancel",u),this._domElement.removeEventListener("wheel",p,{passive:!1}),this._domElement.removeEventListener("contextmenu",f),this._domElement.ownerDocument.removeEventListener("pointermove",c,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.removeEventListener("pointerlockchange",y),this._domElement.ownerDocument.removeEventListener("pointerlockerror",v))},this.cancel=()=>{this._state!==L.NONE&&(this._state=L.NONE,this._activePointers.length=0,_())},e&&this.connect(e),this.update(0)}get camera(){return this._camera}set camera(t){this._camera=t,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(t){this._enabled=t,this._domElement&&(t?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(t){(this._spherical.radius!==t||this._sphericalEnd.radius!==t)&&(this._spherical.radius=t,this._sphericalEnd.radius=t,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(t){(this._spherical.theta!==t||this._sphericalEnd.theta!==t)&&(this._spherical.theta=t,this._sphericalEnd.theta=t,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(t){(this._spherical.phi!==t||this._sphericalEnd.phi!==t)&&(this._spherical.phi=t,this._sphericalEnd.phi=t,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(t){this._boundaryEnclosesCamera=t,this._needsUpdate=!0}set interactiveArea(t){this._interactiveArea.width=I(t.width,0,1),this._interactiveArea.height=I(t.height,0,1),this._interactiveArea.x=I(t.x,0,1-this._interactiveArea.width),this._interactiveArea.y=I(t.y,0,1-this._interactiveArea.height)}addEventListener(t,e){super.addEventListener(t,e)}removeEventListener(t,e){super.removeEventListener(t,e)}rotate(t,e,i=!1){return this.rotateTo(this._sphericalEnd.theta+t,this._sphericalEnd.phi+e,i)}rotateAzimuthTo(t,e=!1){return this.rotateTo(t,this._sphericalEnd.phi,e)}rotatePolarTo(t,e=!1){return this.rotateTo(this._sphericalEnd.theta,t,e)}rotateTo(t,e,i=!1){this._isUserControllingRotate=!1;let r=I(t,this.minAzimuthAngle,this.maxAzimuthAngle),s=I(e,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=r,this._sphericalEnd.phi=s,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,i||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);let n=!i||k(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&k(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(n)}dolly(t,e=!1){return this.dollyTo(this._sphericalEnd.radius-t,e)}dollyTo(t,e=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=B.NONE,this._changedDolly=0,this._dollyToNoClamp(I(t,this.minDistance,this.maxDistance),e)}_dollyToNoClamp(t,e=!1){let i=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){let e=this._collisionTest(),r=k(e,this._spherical.radius);if(!(i>t)&&r)return Promise.resolve();this._sphericalEnd.radius=Math.min(t,e)}else this._sphericalEnd.radius=t;this._needsUpdate=!0,e||(this._spherical.radius=this._sphericalEnd.radius);let r=!e||k(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(r)}dollyInFixed(t,e=!1){this._targetEnd.add(this._getCameraDirection(u).multiplyScalar(t)),e||this._target.copy(this._targetEnd);let i=!e||k(this._target.x,this._targetEnd.x,this.restThreshold)&&k(this._target.y,this._targetEnd.y,this.restThreshold)&&k(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(i)}zoom(t,e=!1){return this.zoomTo(this._zoomEnd+t,e)}zoomTo(t,e=!1){this._isUserControllingZoom=!1,this._zoomEnd=I(t,this.minZoom,this.maxZoom),this._needsUpdate=!0,e||(this._zoom=this._zoomEnd);let i=!e||k(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(i)}pan(t,e,i=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(t,e,i)}truck(t,e,i=!1){this._camera.updateMatrix(),d.setFromMatrixColumn(this._camera.matrix,0),p.setFromMatrixColumn(this._camera.matrix,1),d.multiplyScalar(t),p.multiplyScalar(-e);let r=l.copy(d).add(p),s=h.copy(this._targetEnd).add(r);return this.moveTo(s.x,s.y,s.z,i)}forward(t,e=!1){l.setFromMatrixColumn(this._camera.matrix,0),l.crossVectors(this._camera.up,l),l.multiplyScalar(t);let i=h.copy(this._targetEnd).add(l);return this.moveTo(i.x,i.y,i.z,e)}elevate(t,e=!1){return l.copy(this._camera.up).multiplyScalar(t),this.moveTo(this._targetEnd.x+l.x,this._targetEnd.y+l.y,this._targetEnd.z+l.z,e)}moveTo(t,e,i,r=!1){this._isUserControllingTruck=!1;let s=l.set(t,e,i).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,s,this.boundaryFriction),this._needsUpdate=!0,r||this._target.copy(this._targetEnd);let n=!r||k(this._target.x,this._targetEnd.x,this.restThreshold)&&k(this._target.y,this._targetEnd.y,this.restThreshold)&&k(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}lookInDirectionOf(t,e,i,r=!1){let s=l.set(t,e,i).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(s.x,s.y,s.z,r)}fitToBox(t,e,{cover:i=!1,paddingLeft:r=0,paddingRight:s=0,paddingBottom:a=0,paddingTop:c=0}={}){let u=[],d=t.isBox3?v.copy(t):v.setFromObject(t);d.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());let p=N(this._sphericalEnd.theta,V),f=N(this._sphericalEnd.phi,V);u.push(this.rotateTo(p,f,e));let m=l.setFromSpherical(this._sphericalEnd).normalize(),g=E.setFromUnitVectors(m,o),_=k(Math.abs(m.y),1);_&&g.multiply(w.setFromAxisAngle(n,p)),g.multiply(this._yAxisUpSpaceInverse);let y=x.makeEmpty();h.copy(d.min).applyQuaternion(g),y.expandByPoint(h),h.copy(d.min).setX(d.max.x).applyQuaternion(g),y.expandByPoint(h),h.copy(d.min).setY(d.max.y).applyQuaternion(g),y.expandByPoint(h),h.copy(d.max).setZ(d.min.z).applyQuaternion(g),y.expandByPoint(h),h.copy(d.min).setZ(d.max.z).applyQuaternion(g),y.expandByPoint(h),h.copy(d.max).setY(d.min.y).applyQuaternion(g),y.expandByPoint(h),h.copy(d.max).setX(d.min.x).applyQuaternion(g),y.expandByPoint(h),h.copy(d.max).applyQuaternion(g),y.expandByPoint(h),y.min.x-=r,y.min.y-=a,y.max.x+=s,y.max.y+=c,g.setFromUnitVectors(o,m),_&&g.premultiply(w.invert()),g.premultiply(this._yAxisUpSpace);let T=y.getSize(l),b=y.getCenter(h).applyQuaternion(g);if(R(this._camera)){let t=this.getDistanceToFitBox(T.x,T.y,T.z,i);u.push(this.moveTo(b.x,b.y,b.z,e)),u.push(this.dollyTo(t,e)),u.push(this.setFocalOffset(0,0,0,e))}else if(D(this._camera)){let t=this._camera,r=t.right-t.left,s=t.top-t.bottom,n=i?Math.max(r/T.x,s/T.y):Math.min(r/T.x,s/T.y);u.push(this.moveTo(b.x,b.y,b.z,e)),u.push(this.zoomTo(n,e)),u.push(this.setFocalOffset(0,0,0,e))}return Promise.all(u)}fitToSphere(t,e){let i=[],r="isObject3D"in t?J.createBoundingSphere(t,T):T.copy(t);if(i.push(this.moveTo(r.center.x,r.center.y,r.center.z,e)),R(this._camera)){let t=this.getDistanceToFitSphere(r.radius);i.push(this.dollyTo(t,e))}else if(D(this._camera)){let t=this._camera.right-this._camera.left,s=this._camera.top-this._camera.bottom,n=2*r.radius;i.push(this.zoomTo(Math.min(t/n,s/n),e))}return i.push(this.setFocalOffset(0,0,0,e)),Promise.all(i)}setLookAt(t,e,i,r,s,n,o=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=B.NONE,this._changedDolly=0;let a=h.set(r,s,n),c=l.set(t,e,i);this._targetEnd.copy(a),this._sphericalEnd.setFromVector3(c.sub(a).applyQuaternion(this._yAxisUpSpace)),this.normalizeRotations(),this._needsUpdate=!0,o||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let u=!o||k(this._target.x,this._targetEnd.x,this.restThreshold)&&k(this._target.y,this._targetEnd.y,this.restThreshold)&&k(this._target.z,this._targetEnd.z,this.restThreshold)&&k(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&k(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&k(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(u)}lerpLookAt(t,e,i,r,s,n,o,a,u,d,p,f,m,g=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=B.NONE,this._changedDolly=0;let v=l.set(r,s,n),x=h.set(t,e,i);_.setFromVector3(x.sub(v).applyQuaternion(this._yAxisUpSpace));let T=c.set(d,p,f),E=h.set(o,a,u);y.setFromVector3(E.sub(T).applyQuaternion(this._yAxisUpSpace)),this._targetEnd.copy(v.lerp(T,m));let w=y.theta-_.theta,b=y.phi-_.phi,O=y.radius-_.radius;this._sphericalEnd.set(_.radius+O*m,_.phi+b*m,_.theta+w*m),this.normalizeRotations(),this._needsUpdate=!0,g||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let M=!g||k(this._target.x,this._targetEnd.x,this.restThreshold)&&k(this._target.y,this._targetEnd.y,this.restThreshold)&&k(this._target.z,this._targetEnd.z,this.restThreshold)&&k(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&k(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&k(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(M)}setPosition(t,e,i,r=!1){return this.setLookAt(t,e,i,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,r)}setTarget(t,e,i,r=!1){let s=this.getPosition(l),n=this.setLookAt(s.x,s.y,s.z,t,e,i,r);return this._sphericalEnd.phi=I(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),n}setFocalOffset(t,e,i,r=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(t,e,i),this._needsUpdate=!0,r||this._focalOffset.copy(this._focalOffsetEnd);let s=!r||k(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&k(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&k(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(s)}setOrbitPoint(t,e,i){this._camera.updateMatrixWorld(),d.setFromMatrixColumn(this._camera.matrixWorldInverse,0),p.setFromMatrixColumn(this._camera.matrixWorldInverse,1),f.setFromMatrixColumn(this._camera.matrixWorldInverse,2);let r=l.set(t,e,i),s=r.distanceTo(this._camera.position),n=r.sub(this._camera.position);d.multiplyScalar(n.x),p.multiplyScalar(n.y),f.multiplyScalar(n.z),l.copy(d).add(p).add(f),l.z=l.z+s,this.dollyTo(s,!1),this.setFocalOffset(-l.x,l.y,-l.z,!1),this.moveTo(t,e,i,!1)}setBoundary(t){if(!t){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(t),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(t,e,i,s){if(null===t){this._viewport=null;return}this._viewport=this._viewport||new r.Vector4,"number"==typeof t?this._viewport.set(t,e,i,s):this._viewport.copy(t)}getDistanceToFitBox(t,e,i,r=!1){if(q(this._camera,"getDistanceToFitBox"))return this._spherical.radius;let s=t/e,n=this._camera.getEffectiveFOV()*z,o=this._camera.aspect;return .5*((r?s>o:s<o)?e:t/o)/Math.tan(.5*n)+.5*i}getDistanceToFitSphere(t){if(q(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;let e=this._camera.getEffectiveFOV()*z,i=2*Math.atan(Math.tan(.5*e)*this._camera.aspect);return t/Math.sin(.5*(1<this._camera.aspect?e:i))}getTarget(t,e=!0){return(t&&t.isVector3?t:new r.Vector3).copy(e?this._targetEnd:this._target)}getPosition(t,e=!0){return(t&&t.isVector3?t:new r.Vector3).setFromSpherical(e?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(e?this._targetEnd:this._target)}getSpherical(t,e=!0){return(t||new r.Spherical).copy(e?this._sphericalEnd:this._spherical)}getFocalOffset(t,e=!0){return(t&&t.isVector3?t:new r.Vector3).copy(e?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){this._sphericalEnd.theta=this._sphericalEnd.theta%F,this._sphericalEnd.theta<0&&(this._sphericalEnd.theta+=F),this._spherical.theta+=F*Math.round((this._sphericalEnd.theta-this._spherical.theta)/F)}reset(t=!1){if(!k(this._camera.up.x,this._cameraUp0.x)||!k(this._camera.up.y,this._cameraUp0.y)||!k(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);let t=this.getPosition(l);this.updateCameraUp(),this.setPosition(t.x,t.y,t.z)}return Promise.all([this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,t),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,t),this.zoomTo(this._zoom0,t)])}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,n),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){let t=l.subVectors(this._target,this._camera.position).normalize(),e=h.crossVectors(t,this._camera.up);this._camera.up.crossVectors(e,t).normalize(),this._camera.updateMatrixWorld();let i=this.getPosition(l);this.updateCameraUp(),this.setPosition(i.x,i.y,i.z)}update(t){let e=this._sphericalEnd.theta-this._spherical.theta,i=this._sphericalEnd.phi-this._spherical.phi,r=this._sphericalEnd.radius-this._spherical.radius,s=m.subVectors(this._targetEnd,this._target),n=g.subVectors(this._focalOffsetEnd,this._focalOffset),o=this._zoomEnd-this._zoom;if(H(e))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{let e=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=X(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,e,1/0,t),this._needsUpdate=!0}if(H(i))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{let e=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=X(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,e,1/0,t),this._needsUpdate=!0}if(H(r))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{let e=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=X(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,e,this.maxSpeed,t),this._needsUpdate=!0}if(H(s.x)&&H(s.y)&&H(s.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{let e=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;G(this._target,this._targetEnd,this._targetVelocity,e,this.maxSpeed,t,this._target),this._needsUpdate=!0}if(H(n.x)&&H(n.y)&&H(n.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{let e=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;G(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,e,this.maxSpeed,t,this._focalOffset),this._needsUpdate=!0}if(H(o))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{let e=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=X(this._zoom,this._zoomEnd,this._zoomVelocity,e,1/0,t)}if(this.dollyToCursor){if(R(this._camera)&&0!==this._changedDolly){let t=this._spherical.radius-this._lastDistance,e=this._camera,i=this._getCameraDirection(u),r=l.copy(i).cross(e.up).normalize();0===r.lengthSq()&&(r.x=1);let s=h.crossVectors(r,i),n=this._sphericalEnd.radius*Math.tan(e.getEffectiveFOV()*z*.5),o=(this._sphericalEnd.radius-t-this._sphericalEnd.radius)/this._sphericalEnd.radius,a=c.copy(this._targetEnd).add(r.multiplyScalar(this._dollyControlCoord.x*n*e.aspect)).add(s.multiplyScalar(this._dollyControlCoord.y*n)),d=l.copy(this._targetEnd).lerp(a,o),p=this._lastDollyDirection===B.IN&&this._spherical.radius<=this.minDistance,f=this._lastDollyDirection===B.OUT&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(p||f)){this._sphericalEnd.radius-=t,this._spherical.radius-=t;let e=h.copy(i).multiplyScalar(-t);d.add(e)}this._boundary.clampPoint(d,d);let m=h.subVectors(d,this._targetEnd);this._targetEnd.copy(d),this._target.add(m),this._changedDolly-=t,H(this._changedDolly)&&(this._changedDolly=0)}else if(D(this._camera)&&0!==this._changedZoom){let t=this._zoom-this._lastZoom,e=this._camera,i=l.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(e.near+e.far)/(e.near-e.far)).unproject(e),r=h.set(0,0,-1).applyQuaternion(e.quaternion),s=c.copy(i).add(r.multiplyScalar(-i.dot(e.up))),n=-(this._zoom-t-this._zoom)/this._zoom,o=this._getCameraDirection(u),a=this._targetEnd.dot(o),d=l.copy(this._targetEnd).lerp(s,n),p=d.dot(o),f=o.multiplyScalar(p-a);d.sub(f),this._boundary.clampPoint(d,d);let m=h.subVectors(d,this._targetEnd);this._targetEnd.copy(d),this._target.add(m),this._changedZoom-=t,H(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;let a=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,a),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),H(this._focalOffset.x)&&H(this._focalOffset.y)&&H(this._focalOffset.z)||(this._camera.updateMatrixWorld(),d.setFromMatrixColumn(this._camera.matrix,0),p.setFromMatrixColumn(this._camera.matrix,1),f.setFromMatrixColumn(this._camera.matrix,2),d.multiplyScalar(this._focalOffset.x),p.multiplyScalar(-this._focalOffset.y),f.multiplyScalar(this._focalOffset.z),l.copy(d).add(p).add(f),this._camera.position.add(l)),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),l.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);let _=this._needsUpdate;return _&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):_?(this.dispatchEvent({type:"update"}),H(e,this.restThreshold)&&H(i,this.restThreshold)&&H(r,this.restThreshold)&&H(s.x,this.restThreshold)&&H(s.y,this.restThreshold)&&H(s.z,this.restThreshold)&&H(n.x,this.restThreshold)&&H(n.y,this.restThreshold)&&H(n.z,this.restThreshold)&&H(o,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!_&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=_,this._needsUpdate=!1,_}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:Y(this.maxDistance),minZoom:this.minZoom,maxZoom:Y(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:Y(this.maxPolarAngle),minAzimuthAngle:Y(this.minAzimuthAngle),maxAzimuthAngle:Y(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,verticalDragToForward:this.verticalDragToForward,target:this._targetEnd.toArray(),position:l.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(t,e=!1){let i=JSON.parse(t);this.enabled=i.enabled,this.minDistance=i.minDistance,this.maxDistance=Z(i.maxDistance),this.minZoom=i.minZoom,this.maxZoom=Z(i.maxZoom),this.minPolarAngle=i.minPolarAngle,this.maxPolarAngle=Z(i.maxPolarAngle),this.minAzimuthAngle=Z(i.minAzimuthAngle),this.maxAzimuthAngle=Z(i.maxAzimuthAngle),this.smoothTime=i.smoothTime,this.draggingSmoothTime=i.draggingSmoothTime,this.dollySpeed=i.dollySpeed,this.truckSpeed=i.truckSpeed,this.dollyToCursor=i.dollyToCursor,this.verticalDragToForward=i.verticalDragToForward,this._target0.fromArray(i.target0),this._position0.fromArray(i.position0),this._zoom0=i.zoom0,this._focalOffset0.fromArray(i.focalOffset0),this.moveTo(i.target[0],i.target[1],i.target[2],e),_.setFromVector3(l.fromArray(i.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(_.theta,_.phi,e),this.dollyTo(_.radius,e),this.zoomTo(i.zoom,e),this.setFocalOffset(i.focalOffset[0],i.focalOffset[1],i.focalOffset[2],e),this._needsUpdate=!0}connect(t){if(this._domElement){console.warn("camera-controls is already connected.");return}t.setAttribute("data-camera-controls-version","2.8.5"),this._addAllEventListeners(t),this._getClientRect(this._elementRect)}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(t){return t.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(t){return this._getTargetDirection(t).negate()}_findPointerById(t){return this._activePointers.find(e=>e.pointerId===t)}_findPointerByMouseButton(t){return this._activePointers.find(e=>e.mouseButton===t)}_disposePointer(t){this._activePointers.splice(this._activePointers.indexOf(t),1)}_encloseToBoundary(t,e,i){let r=e.lengthSq();if(0===r)return t;let s=h.copy(e).add(t),n=this._boundary.clampPoint(s,c).sub(s),o=n.lengthSq();if(0===o)return t.add(e);if(o===r)return t;if(0===i)return t.add(e).add(n);{let r=1+i*o/e.dot(n);return t.add(h.copy(e).multiplyScalar(r)).add(n.multiplyScalar(1-i))}}_updateNearPlaneCorners(){if(R(this._camera)){let t=this._camera,e=t.near,i=Math.tan(t.getEffectiveFOV()*z*.5)*e,r=i*t.aspect;this._nearPlaneCorners[0].set(-r,-i,0),this._nearPlaneCorners[1].set(r,-i,0),this._nearPlaneCorners[2].set(r,i,0),this._nearPlaneCorners[3].set(-r,i,0)}else if(D(this._camera)){let t=this._camera,e=1/t.zoom,i=t.left*e,r=t.right*e,s=t.top*e,n=t.bottom*e;this._nearPlaneCorners[0].set(i,s,0),this._nearPlaneCorners[1].set(r,s,0),this._nearPlaneCorners[2].set(r,n,0),this._nearPlaneCorners[3].set(i,n,0)}}_collisionTest(){let t=1/0;if(!(this.colliderMeshes.length>=1)||q(this._camera,"_collisionTest"))return t;let e=this._getTargetDirection(u);b.lookAt(s,e,this._camera.up);for(let i=0;i<4;i++){let r=h.copy(this._nearPlaneCorners[i]);r.applyMatrix4(b);let s=c.addVectors(this._target,r);O.set(s,e),O.far=this._spherical.radius+1;let n=O.intersectObjects(this.colliderMeshes);0!==n.length&&n[0].distance<t&&(t=n[0].distance)}return t}_getClientRect(t){if(!this._domElement)return;let e=this._domElement.getBoundingClientRect();return t.x=e.left,t.y=e.top,this._viewport?(t.x+=this._viewport.x,t.y+=e.height-this._viewport.w-this._viewport.y,t.width=this._viewport.z,t.height=this._viewport.w):(t.width=e.width,t.height=e.height),t}_createOnRestPromise(t){return t?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(t=>{let e=()=>{this.removeEventListener("rest",e),t()};this.addEventListener("rest",e)}))}_addAllEventListeners(t){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(t){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(t){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(t,e=new r.Sphere){let i=e.center;v.makeEmpty(),t.traverseVisible(t=>{t.isMesh&&v.expandByObject(t)}),v.getCenter(i);let s=0;return t.traverseVisible(t=>{if(!t.isMesh)return;let e=t.geometry.clone();e.applyMatrix4(t.matrixWorld);let r=e.attributes.position;for(let t=0,e=r.count;t<e;t++)l.fromBufferAttribute(r,t),s=Math.max(s,i.distanceToSquared(l))}),e.radius=Math.sqrt(s),e}}let $=(0,C.forwardRef)((t,e)=>{(0,C.useMemo)(()=>{let t={Box3:A.Box3,MathUtils:{clamp:A.MathUtils.clamp},Matrix4:A.Matrix4,Quaternion:A.Quaternion,Raycaster:A.Raycaster,Sphere:A.Sphere,Spherical:A.Spherical,Vector2:A.Vector2,Vector3:A.Vector3,Vector4:A.Vector4};J.install({THREE:t}),(0,S.e)({CameraControlsImpl:J})},[]);let{camera:i,domElement:r,makeDefault:s,onStart:n,onEnd:o,onChange:a,regress:l,...h}=t,c=(0,S.A)(t=>t.camera),u=(0,S.A)(t=>t.gl),d=(0,S.A)(t=>t.invalidate),p=(0,S.A)(t=>t.events),f=(0,S.A)(t=>t.setEvents),m=(0,S.A)(t=>t.set),g=(0,S.A)(t=>t.get),_=(0,S.A)(t=>t.performance),y=i||c,v=r||p.connected||u.domElement,x=(0,C.useMemo)(()=>new J(y),[y]);return(0,S.C)((t,e)=>{x.enabled&&x.update(e)},-1),(0,C.useEffect)(()=>(x.connect(v),()=>void x.disconnect()),[v,x]),(0,C.useEffect)(()=>{let t=t=>{d(),l&&_.regress(),a&&a(t)},e=t=>{n&&n(t)},i=t=>{o&&o(t)};return x.addEventListener("update",t),x.addEventListener("controlstart",e),x.addEventListener("controlend",i),x.addEventListener("control",t),x.addEventListener("transitionstart",t),x.addEventListener("wake",t),()=>{x.removeEventListener("update",t),x.removeEventListener("controlstart",e),x.removeEventListener("controlend",i),x.removeEventListener("control",t),x.removeEventListener("transitionstart",t),x.removeEventListener("wake",t)}},[x,n,o,d,f,l,a]),(0,C.useEffect)(()=>{if(s){let t=g().controls;return m({controls:x}),()=>m({controls:t})}},[s,x]),C.createElement("primitive",(0,P.Z)({ref:e,object:x},h))})},1334:function(t,e,i){"use strict";i.d(e,{R:function(){return o}});var r=i(959),s=i(8699),n=i(6426);function o(t,e,i){let o=(0,n.A)(t=>t.size),a=(0,n.A)(t=>t.viewport),l="number"==typeof t?t:o.width*a.dpr,h="number"==typeof e?e:o.height*a.dpr,{samples:c=0,depth:u,...d}=("number"==typeof t?i:t)||{},p=r.useMemo(()=>{let t=new s.WebGLRenderTarget(l,h,{minFilter:s.LinearFilter,magFilter:s.LinearFilter,type:s.HalfFloatType,...d});return u&&(t.depthTexture=new s.DepthTexture(l,h,s.FloatType)),t.samples=c,t},[]);return r.useLayoutEffect(()=>{p.setSize(l,h),c&&(p.samples=c)},[c,p,l,h]),r.useEffect(()=>()=>p.dispose(),[]),p}},5264:function(t,e,i){"use strict";i.d(e,{u:function(){return a}});var r=i(8699),s=i(959),n=i(6426);function o({defaultScene:t,defaultCamera:e,renderPriority:i=1}){let r;let{gl:o,scene:a,camera:l}=(0,n.A)();return(0,n.C)(()=>{r=o.autoClear,1===i&&(o.autoClear=!0,o.render(t,e)),o.autoClear=!1,o.clearDepth(),o.render(a,l),o.autoClear=r},i),s.createElement("group",{onPointerOver:()=>null})}function a({children:t,renderPriority:e=1}){let{scene:i,camera:a}=(0,n.A)(),[l]=s.useState(()=>new r.Scene);return s.createElement(s.Fragment,null,(0,n.g)(s.createElement(s.Fragment,null,t,s.createElement(o,{defaultScene:i,defaultCamera:a,renderPriority:e})),l,{events:{priority:e+1}}))}},8174:function(t,e,i){"use strict";i.d(e,{i:function(){return l}});var r=i(3238),s=i(959),n=i(6426),o=i(1334);let a=t=>"function"==typeof t,l=s.forwardRef(({envMap:t,resolution:e=256,frames:i=1/0,children:l,makeDefault:h,...c},u)=>{let d=(0,n.A)(({set:t})=>t),p=(0,n.A)(({camera:t})=>t),f=(0,n.A)(({size:t})=>t),m=s.useRef(null);s.useImperativeHandle(u,()=>m.current,[]);let g=s.useRef(null),_=(0,o.R)(e);s.useLayoutEffect(()=>{c.manual||m.current.updateProjectionMatrix()},[f,c]),s.useLayoutEffect(()=>{m.current.updateProjectionMatrix()}),s.useLayoutEffect(()=>{if(h)return d(()=>({camera:m.current})),()=>d(()=>({camera:p}))},[m,h,d]);let y=0,v=null,x=a(l);return(0,n.C)(e=>{x&&(i===1/0||y<i)&&(g.current.visible=!1,e.gl.setRenderTarget(_),v=e.scene.background,t&&(e.scene.background=t),e.gl.render(e.scene,m.current),e.scene.background=v,e.gl.setRenderTarget(null),g.current.visible=!0,y++)}),s.createElement(s.Fragment,null,s.createElement("orthographicCamera",(0,r.Z)({left:-(f.width/2),right:f.width/2,top:f.height/2,bottom:-(f.height/2),ref:m},c),!x&&l),s.createElement("group",{ref:g},x&&l(_.texture)))})},355:function(t,e,i){"use strict";i.d(e,{c:function(){return l}});var r=i(3238),s=i(959),n=i(6426),o=i(1334);let a=t=>"function"==typeof t,l=s.forwardRef(({envMap:t,resolution:e=256,frames:i=1/0,makeDefault:l,children:h,...c},u)=>{let d=(0,n.A)(({set:t})=>t),p=(0,n.A)(({camera:t})=>t),f=(0,n.A)(({size:t})=>t),m=s.useRef(null);s.useImperativeHandle(u,()=>m.current,[]);let g=s.useRef(null),_=(0,o.R)(e);s.useLayoutEffect(()=>{c.manual||(m.current.aspect=f.width/f.height)},[f,c]),s.useLayoutEffect(()=>{m.current.updateProjectionMatrix()});let y=0,v=null,x=a(h);return(0,n.C)(e=>{x&&(i===1/0||y<i)&&(g.current.visible=!1,e.gl.setRenderTarget(_),v=e.scene.background,t&&(e.scene.background=t),e.gl.render(e.scene,m.current),e.scene.background=v,e.gl.setRenderTarget(null),g.current.visible=!0,y++)}),s.useLayoutEffect(()=>{if(l)return d(()=>({camera:m.current})),()=>d(()=>({camera:p}))},[m,l,d]),s.createElement(s.Fragment,null,s.createElement("perspectiveCamera",(0,r.Z)({ref:m},c),!x&&h),s.createElement("group",{ref:g},x&&h(_.texture)))})},2066:function(t,e,i){"use strict";i.d(e,{T:function(){return l}});var r=i(3238),s=i(8699),n=i(959),o=i(6426),a=i(1334);let l=n.forwardRef(({children:t,compute:e,width:i,height:l,samples:c=8,renderPriority:u=0,eventPriority:d=0,frames:p=1/0,stencilBuffer:f=!1,depthBuffer:m=!0,generateMipmaps:g=!1,..._},y)=>{let{size:v,viewport:x}=(0,o.A)(),T=(0,a.R)((i||v.width)*x.dpr,(l||v.height)*x.dpr,{samples:c,stencilBuffer:f,depthBuffer:m,generateMipmaps:g}),[E]=n.useState(()=>new s.Scene),w=n.useCallback((t,e,i)=>{var r,n;let o=null==(r=T.texture)?void 0:r.__r3f.parent;for(;o&&!(o instanceof s.Object3D);)o=o.__r3f.parent;if(!o)return!1;i.raycaster.camera||i.events.compute(t,i,null==(n=i.previousRoot)?void 0:n.getState());let[a]=i.raycaster.intersectObject(o);if(!a)return!1;let l=a.uv;if(!l)return!1;e.raycaster.setFromCamera(e.pointer.set(2*l.x-1,2*l.y-1),e.camera)},[]);return n.useImperativeHandle(y,()=>T.texture,[T]),n.createElement(n.Fragment,null,(0,o.g)(n.createElement(h,{renderPriority:u,frames:p,fbo:T},t,n.createElement("group",{onPointerOver:()=>null})),E,{events:{compute:e||w,priority:d}}),n.createElement("primitive",(0,r.Z)({object:T.texture},_)))});function h({frames:t,renderPriority:e,children:i,fbo:r}){let s,a,l=0;return(0,o.C)(e=>{(t===1/0||l<t)&&(s=e.gl.autoClear,a=e.gl.xr.enabled,e.gl.autoClear=!0,e.gl.xr.enabled=!1,e.gl.setRenderTarget(r),e.gl.render(e.scene,e.camera),e.gl.setRenderTarget(null),e.gl.autoClear=s,e.gl.xr.enabled=a,l++)},e),n.createElement(n.Fragment,null,i)}},8954:function(t,e,i){"use strict";i.d(e,{mE:function(){return a}});var r=i(959),s=i(8699),n=i(6426);let o=t=>t===Object(t)&&!Array.isArray(t)&&"function"!=typeof t;function a(t,e){let i=(0,n.A)(t=>t.gl),a=(0,n.F)(s.TextureLoader,o(t)?Object.values(t):t);return(0,r.useLayoutEffect)(()=>{null==e||e(a)},[e]),(0,r.useEffect)(()=>{if("initTexture"in i){let t=[];Array.isArray(a)?t=a:a instanceof s.Texture?t=[a]:o(a)&&(t=Object.values(a)),t.forEach(t=>{t instanceof s.Texture&&i.initTexture(t)})}},[i,a]),(0,r.useMemo)(()=>{if(!o(t))return a;{let e={},i=0;for(let r in t)e[r]=a[i++];return console.log("keyed",e),e}},[t,a])}a.preload=t=>n.F.preload(s.TextureLoader,t),a.clear=t=>n.F.clear(s.TextureLoader,t)},8439:function(t,e,i){"use strict";i.d(e,{g:function(){return s}});var r=i(8699);function s(t,e,i,s){let n=class extends r.ShaderMaterial{constructor(n={}){let o=Object.entries(t);super({uniforms:o.reduce((t,[e,i])=>{let s=r.UniformsUtils.clone({[e]:{value:i}});return{...t,...s}},{}),vertexShader:e,fragmentShader:i}),this.key="",o.forEach(([t])=>Object.defineProperty(this,t,{get:()=>this.uniforms[t].value,set:e=>this.uniforms[t].value=e})),Object.assign(this,n),s&&s(this)}};return n.key=r.MathUtils.generateUUID(),n}},9856:function(t,e,i){"use strict";i.d(e,{Cd:function(){return o},JO:function(){return l},Qq:function(){return a}});var r=i(3238),s=i(959);function n(t,e){let i=t+"Geometry";return s.forwardRef(({args:t,children:n,...o},a)=>{let l=s.useRef(null);return s.useImperativeHandle(a,()=>l.current),s.useLayoutEffect(()=>void(null==e||e(l.current))),s.createElement("mesh",(0,r.Z)({ref:l},o),s.createElement(i,{attach:"geometry",args:t}),n)})}let o=n("circle"),a=n("cone"),l=n("plane")},2196:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(8123);function s(t){var e=[1/0,1/0,-1/0,-1/0];return r.coordEach(t,function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])}),e}s.default=s,e.default=s},1988:function(t,e,i){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var s=r(i(2196)),n=r(i(1189)),o=r(i(8315)),a=i(2517);function l(t,e){var i,r=!1;for(i=0;i<t.coordinates.length;i++)if(g(t.coordinates[i],e.coordinates)){r=!0;break}return r}function h(t,e){for(var i=0,r=e.coordinates;i<r.length;i++){for(var s=r[i],n=!1,o=0,a=t.coordinates;o<a.length;o++)if(g(s,a[o])){n=!0;break}if(!n)return!1}return!0}function c(t,e){for(var i=!1,r=0,s=e.coordinates;r<s.length;r++){var n=s[r];if(o.default(n,t,{ignoreEndVertices:!0})&&(i=!0),!o.default(n,t))return!1}return!!i}function u(t,e){for(var i=0,r=e.coordinates;i<r.length;i++){var s=r[i];if(!n.default(s,t,{ignoreBoundary:!0}))return!1}return!0}function d(t,e){for(var i=!1,r=0,s=e.coordinates;r<s.length;r++){var n=s[r];if(o.default({type:"Point",coordinates:n},t,{ignoreEndVertices:!0})&&(i=!0),!o.default({type:"Point",coordinates:n},t,{ignoreEndVertices:!1}))return!1}return i}function p(t,e){var i=!1,r=0;if(!m(s.default(t),s.default(e)))return!1;for(;r<e.coordinates.length-1;r++){var o=_(e.coordinates[r],e.coordinates[r+1]);if(n.default({type:"Point",coordinates:o},t,{ignoreBoundary:!0})){i=!0;break}}return i}function f(t,e){if("Feature"===t.type&&null===t.geometry||"Feature"===e.type&&null===e.geometry||!m(s.default(t),s.default(e)))return!1;for(var i=a.getGeom(e).coordinates,r=0;r<i.length;r++)for(var o=i[r],l=0;l<o.length;l++){var h=o[l];if(!n.default(h,t))return!1}return!0}function m(t,e){return!(t[0]>e[0])&&!(t[2]<e[2])&&!(t[1]>e[1])&&!(t[3]<e[3])}function g(t,e){return t[0]===e[0]&&t[1]===e[1]}function _(t,e){return[(t[0]+e[0])/2,(t[1]+e[1])/2]}e.default=function(t,e){var i=a.getGeom(t),r=a.getGeom(e),s=i.type,m=r.type,_=i.coordinates,y=r.coordinates;switch(s){case"Point":if("Point"===m)return g(_,y);throw Error("feature2 "+m+" geometry not supported");case"MultiPoint":switch(m){case"Point":return l(i,r);case"MultiPoint":return h(i,r);default:throw Error("feature2 "+m+" geometry not supported")}case"LineString":switch(m){case"Point":return o.default(r,i,{ignoreEndVertices:!0});case"LineString":return d(i,r);case"MultiPoint":return c(i,r);default:throw Error("feature2 "+m+" geometry not supported")}case"Polygon":switch(m){case"Point":return n.default(r,i,{ignoreBoundary:!0});case"LineString":return p(i,r);case"Polygon":return f(i,r);case"MultiPoint":return u(i,r);default:throw Error("feature2 "+m+" geometry not supported")}default:throw Error("feature1 "+s+" geometry not supported")}},e.isPointInMultiPoint=l,e.isMultiPointInMultiPoint=h,e.isMultiPointOnLine=c,e.isMultiPointInPoly=u,e.isLineOnLine=d,e.isLineInPoly=p,e.isPolyInPoly=f,e.doBBoxOverlap=m,e.compareCoords=g,e.getMidpoint=_},1189:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(2517);function s(t,e,i){var r=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var s=0,n=e.length-1;s<e.length;n=s++){var o=e[s][0],a=e[s][1],l=e[n][0],h=e[n][1];if(t[1]*(o-l)+a*(l-t[0])+h*(t[0]-o)==0&&(o-t[0])*(l-t[0])<=0&&(a-t[1])*(h-t[1])<=0)return!i;a>t[1]!=h>t[1]&&t[0]<(l-o)*(t[1]-a)/(h-a)+o&&(r=!r)}return r}e.default=function(t,e,i){if(void 0===i&&(i={}),!t)throw Error("point is required");if(!e)throw Error("polygon is required");var n=r.getCoord(t),o=r.getGeom(e),a=o.type,l=e.bbox,h=o.coordinates;if(l&&!1==(l[0]<=n[0]&&l[1]<=n[1]&&l[2]>=n[0]&&l[3]>=n[1]))return!1;"Polygon"===a&&(h=[h]);for(var c=!1,u=0;u<h.length&&!c;u++)if(s(n,h[u][0],i.ignoreBoundary)){for(var d=!1,p=1;p<h[u].length&&!d;)s(n,h[u][p],!i.ignoreBoundary)&&(d=!0),p++;d||(c=!0)}return c}},8315:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(2517);e.default=function(t,e,i){void 0===i&&(i={});for(var s=r.getCoord(t),n=r.getCoords(e),o=0;o<n.length-1;o++){var a=!1;if(i.ignoreEndVertices&&(0===o&&(a="start"),o===n.length-2&&(a="end"),0===o&&o+1===n.length-1&&(a="both")),function(t,e,i,r,s){var n=i[0],o=i[1],a=t[0],l=t[1],h=e[0],c=e[1],u=i[0]-a,d=i[1]-l,p=h-a,f=c-l,m=u*f-d*p;if(null!==s){if(Math.abs(m)>s)return!1}else if(0!==m)return!1;return r?"start"===r?Math.abs(p)>=Math.abs(f)?p>0?a<n&&n<=h:h<=n&&n<a:f>0?l<o&&o<=c:c<=o&&o<l:"end"===r?Math.abs(p)>=Math.abs(f)?p>0?a<=n&&n<h:h<n&&n<=a:f>0?l<=o&&o<c:c<o&&o<=l:"both"===r&&(Math.abs(p)>=Math.abs(f)?p>0?a<n&&n<h:h<n&&n<a:f>0?l<o&&o<c:c<o&&o<l):Math.abs(p)>=Math.abs(f)?p>0?a<=n&&n<=h:h<=n&&n<=a:f>0?l<=o&&o<=c:c<=o&&o<=l}(n[o],n[o+1],s,a,void 0===i.epsilon?null:i.epsilon))return!0}return!1}},6769:function(t,e){"use strict";function i(t,e,i){void 0===i&&(i={});var r={type:"Feature"};return(0===i.id||i.id)&&(r.id=i.id),i.bbox&&(r.bbox=i.bbox),r.properties=e||{},r.geometry=t,r}function r(t,e,r){if(void 0===r&&(r={}),!t)throw Error("coordinates is required");if(!Array.isArray(t))throw Error("coordinates must be an Array");if(t.length<2)throw Error("coordinates must be at least 2 numbers long");if(!p(t[0])||!p(t[1]))throw Error("coordinates must contain numbers");return i({type:"Point",coordinates:t},e,r)}function s(t,e,r){void 0===r&&(r={});for(var s=0;s<t.length;s++){var n=t[s];if(n.length<4)throw Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var o=0;o<n[n.length-1].length;o++)if(n[n.length-1][o]!==n[0][o])throw Error("First and last Position are not equivalent.")}return i({type:"Polygon",coordinates:t},e,r)}function n(t,e,r){if(void 0===r&&(r={}),t.length<2)throw Error("coordinates must be an array of two or more positions");return i({type:"LineString",coordinates:t},e,r)}function o(t,e){void 0===e&&(e={});var i={type:"FeatureCollection"};return e.id&&(i.id=e.id),e.bbox&&(i.bbox=e.bbox),i.features=t,i}function a(t,e,r){return void 0===r&&(r={}),i({type:"MultiLineString",coordinates:t},e,r)}function l(t,e,r){return void 0===r&&(r={}),i({type:"MultiPoint",coordinates:t},e,r)}function h(t,e,r){return void 0===r&&(r={}),i({type:"MultiPolygon",coordinates:t},e,r)}function c(t,i){void 0===i&&(i="kilometers");var r=e.factors[i];if(!r)throw Error(i+" units is invalid");return t*r}function u(t,i){void 0===i&&(i="kilometers");var r=e.factors[i];if(!r)throw Error(i+" units is invalid");return t/r}function d(t){return t%(2*Math.PI)*180/Math.PI}function p(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.earthRadius=6371008.8,e.factors={centimeters:100*e.earthRadius,centimetres:100*e.earthRadius,degrees:e.earthRadius/111325,feet:3.28084*e.earthRadius,inches:39.37*e.earthRadius,kilometers:e.earthRadius/1e3,kilometres:e.earthRadius/1e3,meters:e.earthRadius,metres:e.earthRadius,miles:e.earthRadius/1609.344,millimeters:1e3*e.earthRadius,millimetres:1e3*e.earthRadius,nauticalmiles:e.earthRadius/1852,radians:1,yards:1.0936*e.earthRadius},e.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/e.earthRadius,yards:1.0936133},e.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},e.feature=i,e.geometry=function(t,e,i){switch(void 0===i&&(i={}),t){case"Point":return r(e).geometry;case"LineString":return n(e).geometry;case"Polygon":return s(e).geometry;case"MultiPoint":return l(e).geometry;case"MultiLineString":return a(e).geometry;case"MultiPolygon":return h(e).geometry;default:throw Error(t+" is invalid")}},e.point=r,e.points=function(t,e,i){return void 0===i&&(i={}),o(t.map(function(t){return r(t,e)}),i)},e.polygon=s,e.polygons=function(t,e,i){return void 0===i&&(i={}),o(t.map(function(t){return s(t,e)}),i)},e.lineString=n,e.lineStrings=function(t,e,i){return void 0===i&&(i={}),o(t.map(function(t){return n(t,e)}),i)},e.featureCollection=o,e.multiLineString=a,e.multiPoint=l,e.multiPolygon=h,e.geometryCollection=function(t,e,r){return void 0===r&&(r={}),i({type:"GeometryCollection",geometries:t},e,r)},e.round=function(t,e){if(void 0===e&&(e=0),e&&!(e>=0))throw Error("precision must be a positive number");var i=Math.pow(10,e||0);return Math.round(t*i)/i},e.radiansToLength=c,e.lengthToRadians=u,e.lengthToDegrees=function(t,e){return d(u(t,e))},e.bearingToAzimuth=function(t){var e=t%360;return e<0&&(e+=360),e},e.radiansToDegrees=d,e.degreesToRadians=function(t){return t%360*Math.PI/180},e.convertLength=function(t,e,i){if(void 0===e&&(e="kilometers"),void 0===i&&(i="kilometers"),!(t>=0))throw Error("length must be a positive number");return c(u(t,e),i)},e.convertArea=function(t,i,r){if(void 0===i&&(i="meters"),void 0===r&&(r="kilometers"),!(t>=0))throw Error("area must be a positive number");var s=e.areaFactors[i];if(!s)throw Error("invalid original units");var n=e.areaFactors[r];if(!n)throw Error("invalid final units");return t/s*n},e.isNumber=p,e.isObject=function(t){return!!t&&t.constructor===Object},e.validateBBox=function(t){if(!t)throw Error("bbox is required");if(!Array.isArray(t))throw Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw Error("bbox must be an Array of 4 or 6 numbers");t.forEach(function(t){if(!p(t))throw Error("bbox must only contain numbers")})},e.validateId=function(t){if(!t)throw Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw Error("id must be a number or a string")}},2517:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(6769);e.getCoord=function(t){if(!t)throw Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw Error("coord must be GeoJSON Point or an Array of numbers")},e.getCoords=function(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw Error("coords must be GeoJSON Feature, Geometry Object or an Array")},e.containsNumber=function t(e){if(e.length>1&&r.isNumber(e[0])&&r.isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return t(e[0]);throw Error("coordinates must only contain numbers")},e.geojsonType=function(t,e,i){if(!e||!i)throw Error("type and name required");if(!t||t.type!==e)throw Error("Invalid input to "+i+": must be a "+e+", given "+t.type)},e.featureOf=function(t,e,i){if(!t)throw Error("No feature passed");if(!i)throw Error(".featureOf() requires a name");if(!t||"Feature"!==t.type||!t.geometry)throw Error("Invalid input to "+i+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw Error("Invalid input to "+i+": must be a "+e+", given "+t.geometry.type)},e.collectionOf=function(t,e,i){if(!t)throw Error("No featureCollection passed");if(!i)throw Error(".collectionOf() requires a name");if(!t||"FeatureCollection"!==t.type)throw Error("Invalid input to "+i+", FeatureCollection required");for(var r=0,s=t.features;r<s.length;r++){var n=s[r];if(!n||"Feature"!==n.type||!n.geometry)throw Error("Invalid input to "+i+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw Error("Invalid input to "+i+": must be a "+e+", given "+n.geometry.type)}},e.getGeom=function(t){return"Feature"===t.type?t.geometry:t},e.getType=function(t,e){return"FeatureCollection"===t.type?"FeatureCollection":"GeometryCollection"===t.type?"GeometryCollection":"Feature"===t.type&&null!==t.geometry?t.geometry.type:t.type}},8123:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(6769);function s(t,e,i){if(null!==t)for(var r,n,o,a,l,h,c,u,d=0,p=0,f=t.type,m="FeatureCollection"===f,g="Feature"===f,_=m?t.features.length:1,y=0;y<_;y++){l=(u=!!(c=m?t.features[y].geometry:g?t.geometry:t)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var v=0;v<l;v++){var x=0,T=0;if(null!==(a=u?c.geometries[v]:c)){h=a.coordinates;var E=a.type;switch(d=i&&("Polygon"===E||"MultiPolygon"===E)?1:0,E){case null:break;case"Point":if(!1===e(h,p,y,x,T))return!1;p++,x++;break;case"LineString":case"MultiPoint":for(r=0;r<h.length;r++){if(!1===e(h[r],p,y,x,T))return!1;p++,"MultiPoint"===E&&x++}"LineString"===E&&x++;break;case"Polygon":case"MultiLineString":for(r=0;r<h.length;r++){for(n=0;n<h[r].length-d;n++){if(!1===e(h[r][n],p,y,x,T))return!1;p++}"MultiLineString"===E&&x++,"Polygon"===E&&T++}"Polygon"===E&&x++;break;case"MultiPolygon":for(r=0;r<h.length;r++){for(n=0,T=0;n<h[r].length;n++){for(o=0;o<h[r][n].length-d;o++){if(!1===e(h[r][n][o],p,y,x,T))return!1;p++}T++}x++}break;case"GeometryCollection":for(r=0;r<a.geometries.length;r++)if(!1===s(a.geometries[r],e,i))return!1;break;default:throw Error("Unknown Geometry Type")}}}}}function n(t,e){var i;switch(t.type){case"FeatureCollection":for(i=0;i<t.features.length&&!1!==e(t.features[i].properties,i);i++);break;case"Feature":e(t.properties,0)}}function o(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var i=0;i<t.features.length&&!1!==e(t.features[i],i);i++);}function a(t,e){var i,r,s,n,o,a,l,h,c,u,d=0,p="FeatureCollection"===t.type,f="Feature"===t.type,m=p?t.features.length:1;for(i=0;i<m;i++){for(s=0,a=p?t.features[i].geometry:f?t.geometry:t,h=p?t.features[i].properties:f?t.properties:{},c=p?t.features[i].bbox:f?t.bbox:void 0,u=p?t.features[i].id:f?t.id:void 0,o=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1;s<o;s++){if(null===(n=l?a.geometries[s]:a)){if(!1===e(null,d,h,c,u))return!1;continue}switch(n.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(n,d,h,c,u))return!1;break;case"GeometryCollection":for(r=0;r<n.geometries.length;r++)if(!1===e(n.geometries[r],d,h,c,u))return!1;break;default:throw Error("Unknown Geometry Type")}}d++}}function l(t,e){a(t,function(t,i,s,n,o){var a,l=null===t?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":if(!1===e(r.feature(t,s,{bbox:n,id:o}),i,0))return!1;return}switch(l){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var h=0;h<t.coordinates.length;h++){var c={type:a,coordinates:t.coordinates[h]};if(!1===e(r.feature(c,s),i,h))return!1}})}function h(t,e){l(t,function(t,i,n){var o,a=0;if(t.geometry){var l=t.geometry.type;if("Point"!==l&&"MultiPoint"!==l){var h=0,c=0,u=0;if(!1===s(t,function(s,l,d,p,f){if(void 0===o||i>h||p>c||f>u){o=s,h=i,c=p,u=f,a=0;return}if(!1===e(r.lineString([o,s],t.properties),i,n,f,a))return!1;a++,o=s}))return!1}}})}function c(t,e){if(!t)throw Error("geojson is required");l(t,function(t,i,s){if(null!==t.geometry){var n=t.geometry.type,o=t.geometry.coordinates;switch(n){case"LineString":if(!1===e(t,i,s,0,0))return!1;break;case"Polygon":for(var a=0;a<o.length;a++)if(!1===e(r.lineString(o[a],t.properties),i,s,a))return!1}}})}e.coordAll=function(t){var e=[];return s(t,function(t){e.push(t)}),e},e.coordEach=s,e.coordReduce=function(t,e,i,r){var n=i;return s(t,function(t,r,s,o,a){n=0===r&&void 0===i?t:e(n,t,r,s,o,a)},r),n},e.featureEach=o,e.featureReduce=function(t,e,i){var r=i;return o(t,function(t,s){r=0===s&&void 0===i?t:e(r,t,s)}),r},e.findPoint=function(t,e){if(e=e||{},!r.isObject(e))throw Error("options is invalid");var i,s=e.featureIndex||0,n=e.multiFeatureIndex||0,o=e.geometryIndex||0,a=e.coordIndex||0,l=e.properties;switch(t.type){case"FeatureCollection":s<0&&(s=t.features.length+s),l=l||t.features[s].properties,i=t.features[s].geometry;break;case"Feature":l=l||t.properties,i=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":i=t;break;default:throw Error("geojson is invalid")}if(null===i)return null;var h=i.coordinates;switch(i.type){case"Point":return r.point(h,l,e);case"MultiPoint":return n<0&&(n=h.length+n),r.point(h[n],l,e);case"LineString":return a<0&&(a=h.length+a),r.point(h[a],l,e);case"Polygon":return o<0&&(o=h.length+o),a<0&&(a=h[o].length+a),r.point(h[o][a],l,e);case"MultiLineString":return n<0&&(n=h.length+n),a<0&&(a=h[n].length+a),r.point(h[n][a],l,e);case"MultiPolygon":return n<0&&(n=h.length+n),o<0&&(o=h[n].length+o),a<0&&(a=h[n][o].length-a),r.point(h[n][o][a],l,e)}throw Error("geojson is invalid")},e.findSegment=function(t,e){if(e=e||{},!r.isObject(e))throw Error("options is invalid");var i,s=e.featureIndex||0,n=e.multiFeatureIndex||0,o=e.geometryIndex||0,a=e.segmentIndex||0,l=e.properties;switch(t.type){case"FeatureCollection":s<0&&(s=t.features.length+s),l=l||t.features[s].properties,i=t.features[s].geometry;break;case"Feature":l=l||t.properties,i=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":i=t;break;default:throw Error("geojson is invalid")}if(null===i)return null;var h=i.coordinates;switch(i.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=h.length+a-1),r.lineString([h[a],h[a+1]],l,e);case"Polygon":return o<0&&(o=h.length+o),a<0&&(a=h[o].length+a-1),r.lineString([h[o][a],h[o][a+1]],l,e);case"MultiLineString":return n<0&&(n=h.length+n),a<0&&(a=h[n].length+a-1),r.lineString([h[n][a],h[n][a+1]],l,e);case"MultiPolygon":return n<0&&(n=h.length+n),o<0&&(o=h[n].length+o),a<0&&(a=h[n][o].length-a-1),r.lineString([h[n][o][a],h[n][o][a+1]],l,e)}throw Error("geojson is invalid")},e.flattenEach=l,e.flattenReduce=function(t,e,i){var r=i;return l(t,function(t,s,n){r=0===s&&0===n&&void 0===i?t:e(r,t,s,n)}),r},e.geomEach=a,e.geomReduce=function(t,e,i){var r=i;return a(t,function(t,s,n,o,a){r=0===s&&void 0===i?t:e(r,t,s,n,o,a)}),r},e.lineEach=c,e.lineReduce=function(t,e,i){var r=i;return c(t,function(t,s,n,o){r=0===s&&void 0===i?t:e(r,t,s,n,o)}),r},e.propEach=n,e.propReduce=function(t,e,i){var r=i;return n(t,function(t,s){r=0===s&&void 0===i?t:e(r,t,s)}),r},e.segmentEach=h,e.segmentReduce=function(t,e,i){var r=i,s=!1;return h(t,function(t,n,o,a,l){r=!1===s&&void 0===i?t:e(r,t,n,o,a,l),s=!0}),r}},1403:function(t,e,i){"use strict";let r=i(9204),s=i(2196).default,n=i(1988).default,o=i(1555);class a{constructor(t,e){let i=new o(t,e="object"==typeof e?e:{});this.D=[,,,],this.D[0]={list:i.points.features,bboxs:null,lookup:null},this.D[1]={list:i.lines.features,bboxs:null,lookup:null},this.D[2]={list:i.polygons.features,bboxs:null,lookup:null};for(let t=0;t<3;t++){let e=this.D[t];if(e.list.length>0){e.bboxs=Array(e.list.length),e.lookup=new r;let t=e.list,i=e.bboxs,n=e.lookup;for(let e=0,r=t.length;e<r;e++){let r=s(t[e]);i[e]={minX:r[0],minY:r[1],maxX:r[2],maxY:r[3],id:e}}n.load(i)}}}forEachContainer(t,e,i){e="object"==typeof e?e:{},i="function"==typeof i?i:()=>{};let r=0,o=function(t){switch(t.type){case"Point":return 0;case"LineString":return 1;case"Polygon":return 2;default:throw TypeError("Unsupported GeoJSON type. Use one of: Point, LineString, Polygon")}}(t),a=[e.ignorePoints,e.ignoreLines,e.ignorePolygons];for(let l=o;l<3;l++){if(!0===a[l])continue;let o=this.D[l];if(null===o.lookup)continue;let h=s(t),c=o.lookup.search({minX:h[0],minY:h[1],maxX:h[2],maxY:h[3]});for(let s=0,a=c.length;s<a;s++){let a=o.list[c[s].id];if(n(a,t)&&(i(a,r),r++,e.limit>0&&e.limit===r))return r}}return r}getContainers(t,e){e="object"==typeof e?e:{};let i=[];return this.forEachContainer(t,e,t=>i.push(t)),{type:"featureCollection",features:i}}hasContainers(t,e){return(e="object"==typeof e?e:{}).limit=1,1===this.forEachContainer(t,e)}countContainers(t,e){return e="object"==typeof e?e:{},this.forEachContainer(t,e)}}t.exports=a},1555:function(t){"use strict";let e="Point",i="LineString",r="Polygon",s="Feature",n="FeatureCollection";class o{constructor(t,e){e="object"==typeof e?e:{},this.pointsList=!0===e.ignorePoints?void 0:[],this.linesList=!0===e.ignoreLines?void 0:[],this.polygonsList=!0===e.ignorePolygons?void 0:[],this._loadGeneric(t)}get points(){return{type:n,features:this.pointsList||[]}}get lines(){return{type:n,features:this.linesList||[]}}get polygons(){return{type:n,features:this.polygonsList||[]}}_loadGeneric(t,o){if(void 0!==this.pointsList)switch(t.type){case e:return this._loadPoint(t.coordinates,o);case"MultiPoint":return t.coordinates.forEach(t=>this._loadPoint(t,o))}if(void 0!==this.linesList)switch(t.type){case i:return this._loadLine(t.coordinates,o);case"MultiLineString":return t.coordinates.forEach(t=>this._loadLine(t,o))}if(void 0!==this.polygonsList)switch(t.type){case r:return this._loadPolygon(t.coordinates,o);case"MultiPolygon":return t.coordinates.forEach(t=>this._loadPolygon(t,o))}switch(t.type){case s:return this._loadGeneric(t.geometry,t.properties);case n:return t.features.forEach(t=>this._loadGeneric(t.geometry,t.properties));case"GeometryCollection":return t.geometries.forEach(t=>this._loadGeneric(t,o))}}_loadPoint(t,i){this.pointsList.push({type:s,geometry:{type:e,coordinates:t},properties:i})}_loadLine(t,e){this.linesList.push({type:s,geometry:{type:i,coordinates:t},properties:e})}_loadPolygon(t,e){this.polygonsList.push({type:s,geometry:{type:r,coordinates:t},properties:e})}}t.exports=o},9204:function(t){t.exports=function(){"use strict";function t(t,e,i){var r=t[e];t[e]=t[i],t[i]=r}function e(t,e){return t<e?-1:t>e?1:0}var i=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function r(t,e){s(t,0,t.children.length,e,t)}function s(t,e,i,r,s){s||(s=d(null)),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(var o=e;o<i;o++){var a=t.children[o];n(s,t.leaf?r(a):a)}return s}function n(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function o(t,e){return t.minX-e.minX}function a(t,e){return t.minY-e.minY}function l(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function h(t){return t.maxX-t.minX+(t.maxY-t.minY)}function c(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function u(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function d(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function p(i,r,s,n,o){for(var a=[r,s];a.length;)if(!((s=a.pop())-(r=a.pop())<=n)){var l=r+Math.ceil((s-r)/n/2)*n;(function e(i,r,s,n,o){for(;n>s;){if(n-s>600){var a=n-s+1,l=r-s+1,h=Math.log(a),c=.5*Math.exp(2*h/3),u=.5*Math.sqrt(h*c*(a-c)/a)*(l-a/2<0?-1:1),d=Math.max(s,Math.floor(r-l*c/a+u)),p=Math.min(n,Math.floor(r+(a-l)*c/a+u));e(i,r,d,p,o)}var f=i[r],m=s,g=n;for(t(i,s,r),o(i[n],f)>0&&t(i,s,n);m<g;){for(t(i,m,g),m++,g--;0>o(i[m],f);)m++;for(;o(i[g],f)>0;)g--}0===o(i[s],f)?t(i,s,g):t(i,++g,n),g<=r&&(s=g+1),r<=g&&(n=g-1)}})(i,l,r||0,s||i.length-1,o||e),a.push(r,l,l,s)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(t){var e=this.data,i=[];if(!u(t,e))return i;for(var r=this.toBBox,s=[];e;){for(var n=0;n<e.children.length;n++){var o=e.children[n],a=e.leaf?r(o):o;u(t,a)&&(e.leaf?i.push(o):c(t,a)?this._all(o,i):s.push(o))}e=s.pop()}return i},i.prototype.collides=function(t){var e=this.data;if(!u(t,e))return!1;for(var i=[];e;){for(var r=0;r<e.children.length;r++){var s=e.children[r],n=e.leaf?this.toBBox(s):s;if(u(t,n)){if(e.leaf||c(t,n))return!0;i.push(s)}}e=i.pop()}return!1},i.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length){if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var r=this.data;this.data=i,i=r}this._insert(i,this.data.height-i.height-1,!0)}}else this.data=i;return this},i.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},i.prototype.clear=function(){return this.data=d([]),this},i.prototype.remove=function(t,e){if(!t)return this;for(var i,r,s,n=this.data,o=this.toBBox(t),a=[],l=[];n||a.length;){if(n||(n=a.pop(),r=a[a.length-1],i=l.pop(),s=!0),n.leaf){var h=function(t,e,i){if(!i)return e.indexOf(t);for(var r=0;r<e.length;r++)if(i(t,e[r]))return r;return -1}(t,n.children,e);if(-1!==h)return n.children.splice(h,1),a.push(n),this._condense(a),this}s||n.leaf||!c(n,o)?r?(i++,n=r.children[i],s=!1):n=null:(a.push(n),l.push(i),i=0,r=n,n=n.children[0])}return this},i.prototype.toBBox=function(t){return t},i.prototype.compareMinX=function(t,e){return t.minX-e.minX},i.prototype.compareMinY=function(t,e){return t.minY-e.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(t){return this.data=t,this},i.prototype._all=function(t,e){for(var i=[];t;)t.leaf?e.push.apply(e,t.children):i.push.apply(i,t.children),t=i.pop();return e},i.prototype._build=function(t,e,i,s){var n,o=i-e+1,a=this._maxEntries;if(o<=a)return r(n=d(t.slice(e,i+1)),this.toBBox),n;s||(s=Math.ceil(Math.log(o)/Math.log(a)),a=Math.ceil(o/Math.pow(a,s-1))),(n=d([])).leaf=!1,n.height=s;var l=Math.ceil(o/a),h=l*Math.ceil(Math.sqrt(a));p(t,e,i,h,this.compareMinX);for(var c=e;c<=i;c+=h){var u=Math.min(c+h-1,i);p(t,c,u,l,this.compareMinY);for(var f=c;f<=u;f+=l){var m=Math.min(f+l-1,u);n.children.push(this._build(t,f,m,s-1))}}return r(n,this.toBBox),n},i.prototype._chooseSubtree=function(t,e,i,r){for(;r.push(e),!e.leaf&&r.length-1!==i;){for(var s=1/0,n=1/0,o=void 0,a=0;a<e.children.length;a++){var h=e.children[a],c=l(h),u=(Math.max(h.maxX,t.maxX)-Math.min(h.minX,t.minX))*(Math.max(h.maxY,t.maxY)-Math.min(h.minY,t.minY))-c;u<n?(n=u,s=c<s?c:s,o=h):u===n&&c<s&&(s=c,o=h)}e=o||e.children[0]}return e},i.prototype._insert=function(t,e,i){var r=i?t:this.toBBox(t),s=[],o=this._chooseSubtree(r,this.data,e,s);for(o.children.push(t),n(o,r);e>=0&&s[e].children.length>this._maxEntries;)this._split(s,e),e--;this._adjustParentBBoxes(r,s,e)},i.prototype._split=function(t,e){var i=t[e],s=i.children.length,n=this._minEntries;this._chooseSplitAxis(i,n,s);var o=this._chooseSplitIndex(i,n,s),a=d(i.children.splice(o,i.children.length-o));a.height=i.height,a.leaf=i.leaf,r(i,this.toBBox),r(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(i,a)},i.prototype._splitRoot=function(t,e){this.data=d([t,e]),this.data.height=t.height+1,this.data.leaf=!1,r(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(t,e,i){for(var r,n,o,a,h=1/0,c=1/0,u=e;u<=i-e;u++){var d=s(t,0,u,this.toBBox),p=s(t,u,i,this.toBBox),f=(n=void 0,o=void 0,n=Math.max(d.minX,p.minX),o=Math.max(d.minY,p.minY),Math.max(0,Math.min(d.maxX,p.maxX)-n)*Math.max(0,Math.min(d.maxY,p.maxY)-o)),m=l(d)+l(p);f<h?(h=f,r=u,c=m<c?m:c):f===h&&m<c&&(c=m,r=u)}return r||i-e},i.prototype._chooseSplitAxis=function(t,e,i){var r=t.leaf?this.compareMinX:o,s=t.leaf?this.compareMinY:a;this._allDistMargin(t,e,i,r)<this._allDistMargin(t,e,i,s)&&t.children.sort(r)},i.prototype._allDistMargin=function(t,e,i,r){t.children.sort(r);for(var o=this.toBBox,a=s(t,0,e,o),l=s(t,i-e,i,o),c=h(a)+h(l),u=e;u<i-e;u++){var d=t.children[u];n(a,t.leaf?o(d):d),c+=h(a)}for(var p=i-e-1;p>=e;p--){var f=t.children[p];n(l,t.leaf?o(f):f),c+=h(l)}return c},i.prototype._adjustParentBBoxes=function(t,e,i){for(var r=i;r>=0;r--)n(e[r],t)},i.prototype._condense=function(t){for(var e=t.length-1,i=void 0;e>=0;e--)0===t[e].children.length?e>0?(i=t[e-1].children).splice(i.indexOf(t[e]),1):this.clear():r(t[e],this.toBBox)},i}()},7929:function(t,e,i){"use strict";let r;i.d(e,{x:function(){return u}});var s=i(1527),n=i(8699),o=i(959),a=i(6426),l=i(8864);let h=(0,o.createContext)(null),c=t=>(t.getAttributes()&l.VB.CONVOLUTION)===l.VB.CONVOLUTION,u=o.memo((0,o.forwardRef)(({children:t,camera:e,scene:i,resolutionScale:u,enabled:d=!0,renderPriority:p=1,autoClear:f=!0,depthBuffer:m,enableNormalPass:g,stencilBuffer:_,multisampling:y=8,frameBufferType:v=n.HalfFloatType},x)=>{let{gl:T,scene:E,camera:w,size:b}=(0,a.A)(),O=i||E,M=e||w,[P,A,C]=(0,o.useMemo)(()=>{let t=function(){var t;if(void 0!==r)return r;try{let e;let i=document.createElement("canvas");return r=!!(window.WebGL2RenderingContext&&(e=i.getContext("webgl2"))),e&&(null==(t=e.getExtension("WEBGL_lose_context"))||t.loseContext()),r}catch(t){return r=!1}}(),e=new l.xC(T,{depthBuffer:m,stencilBuffer:_,multisampling:y>0&&t?y:0,frameBufferType:v});e.addPass(new l.CD(O,M));let i=null,s=null;return g&&((s=new l.gh(O,M)).enabled=!1,e.addPass(s),void 0!==u&&t&&((i=new l.xs({normalBuffer:s.texture,resolutionScale:u})).enabled=!1,e.addPass(i))),[e,s,i]},[M,T,m,_,y,v,O,g,u]);(0,o.useEffect)(()=>null==P?void 0:P.setSize(b.width,b.height),[P,b]),(0,a.C)((t,e)=>{if(d){let t=T.autoClear;T.autoClear=f,_&&!f&&T.clearStencil(),P.render(e),T.autoClear=t}},d?p:0);let S=(0,o.useRef)(null),U=(0,a.y)(S);(0,o.useLayoutEffect)(()=>{let t=[];if(S.current&&U.current&&P){let e=U.current.objects;for(let i=0;i<e.length;i++){let r=e[i];if(r instanceof l.Qm){let s=[r];if(!c(r)){let t=null;for(;(t=e[i+1])instanceof l.Qm&&!c(t);)s.push(t),i++}let n=new l.H5(M,...s);t.push(n)}else r instanceof l.w2&&t.push(r)}for(let e of t)null==P||P.addPass(e);A&&(A.enabled=!0),C&&(C.enabled=!0)}return()=>{for(let e of t)null==P||P.removePass(e);A&&(A.enabled=!1),C&&(C.enabled=!1)}},[P,t,M,A,C,U]),(0,o.useEffect)(()=>{let t=T.toneMapping;return T.toneMapping=n.NoToneMapping,()=>{T.toneMapping=t}},[]);let L=(0,o.useMemo)(()=>({composer:P,normalPass:A,downSamplingPass:C,resolutionScale:u,camera:M,scene:O}),[P,A,C,u,M,O]);return(0,o.useImperativeHandle)(x,()=>P,[P]),(0,s.jsx)(h.Provider,{value:L,children:(0,s.jsx)("group",{ref:S,children:t})})}))},468:function(t,e,i){"use strict";i.d(e,{d:function(){return u}});var r,s,n=i(8864),o=i(1527),a=i(959),l=i(6426);let h=0,c=new WeakMap,u=(r=n.rk,s={blendFunction:n.YQ.ADD},a.forwardRef(function({blendFunction:t=null==s?void 0:s.blendFunction,opacity:e=null==s?void 0:s.opacity,...i},n){let u=c.get(r);if(!u){let t=`@react-three/postprocessing/${r.name}-${h++}`;(0,l.e)({[t]:r}),c.set(r,u=t)}let d=(0,l.A)(t=>t.camera),p=a.useMemo(()=>{var t,e;return[...null!=(t=null==s?void 0:s.args)?t:[],...null!=(e=i.args)?e:[{...s,...i}]]},[JSON.stringify(i)]);return(0,o.jsx)(u,{camera:d,"blendMode-blendFunction":t,"blendMode-opacity-value":e,...i,ref:n,args:p})}))},1770:function(t,e,i){"use strict";i.d(e,{Ib:function(){return n},Ij:function(){return P},JO:function(){return u},O:function(){return l},Pc:function(){return a},VT:function(){return c},bz:function(){return b},jU:function(){return h},xC:function(){return x},z6:function(){return f}});var r=i(8699);/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function s(t,e,i,r){return new(i||(i=Promise))(function(s,n){function o(t){try{l(r.next(t))}catch(t){n(t)}}function a(t){try{l(r.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?s(t.value):((e=t.value)instanceof i?e:new i(function(t){t(e)})).then(o,a)}l((r=r.apply(t,e||[])).next())})}class n{constructor(){this.name="",this.minZoom=0,this.maxZoom=20,this.bounds=[],this.center=[]}fetchTile(t,e,i){return null}getMetaData(){return s(this,void 0,void 0,function*(){})}}class o extends n{constructor(t="https://a.tile.openstreetmap.org/"){super(),this.address=t,this.format="png",this.maxZoom=19}fetchTile(t,e,i){return new Promise((r,s)=>{let n=document.createElement("img");n.onload=function(){r(n)},n.onerror=function(){s()},n.crossOrigin="Anonymous",n.src=this.address+t+"/"+e+"/"+i+"."+this.format})}}class a{static createOffscreenCanvas(t,e){if("undefined"!=typeof OffscreenCanvas)return new OffscreenCanvas(t,e);{let i=document.createElement("canvas");return i.width=t,i.height=e,i}}}class l{static createFillTexture(t="#000000",e=1,i=1){let s=a.createOffscreenCanvas(e,i),n=s.getContext("2d");n.fillStyle=t,n.fillRect(0,0,e,i);let o=new r.Texture(s);return o.format=r.RGBAFormat,o.magFilter=r.LinearFilter,o.minFilter=r.LinearFilter,o.generateMipmaps=!1,o.needsUpdate=!0,o}}class h{}h.root=-1,h.topLeft=0,h.topRight=1,h.bottomLeft=2,h.bottomRight=3;class c extends r.Mesh{constructor(t=null,e=null,i=h.root,r=0,s=0,n=0,o=null,a=null){super(o,a),this.mapView=null,this.parentNode=null,this.subdivided=!1,this.disposed=!1,this.nodesLoaded=0,this.childrenCache=null,this.isMesh=!0,this.mapView=e,this.parentNode=t,this.disposed=!1,this.location=i,this.level=r,this.x=s,this.y=n,this.initialize()}initialize(){return s(this,void 0,void 0,function*(){})}createChildNodes(){}subdivide(){let t=this.mapView.maxZoom();this.children.length>0||this.level+1>t||null!==this.parentNode&&this.parentNode.nodesLoaded<c.childrens||(this.mapView.cacheTiles&&null!==this.childrenCache?(this.isMesh=!1,this.children=this.childrenCache,this.nodesLoaded=this.childrenCache.length):this.createChildNodes(),this.subdivided=!0)}simplify(){let t=this.mapView.minZoom();if(!(this.level-1<t)){if(this.mapView.cacheTiles)this.childrenCache=this.children;else for(let t=0;t<this.children.length;t++)this.children[t].dispose();this.subdivided=!1,this.isMesh=!0,this.children=[],this.nodesLoaded=0}}loadData(){return s(this,void 0,void 0,function*(){if(this.level<this.mapView.provider.minZoom||this.level>this.mapView.provider.maxZoom){console.warn("Geo-Three: Loading tile outside of provider range.",this),this.material.map=c.defaultTexture,this.material.needsUpdate=!0;return}try{let t=yield this.mapView.provider.fetchTile(this.level,this.x,this.y);if(this.disposed)return;let e=new r.Texture(t);e.generateMipmaps=!1,e.format=r.RGBAFormat,e.magFilter=r.LinearFilter,e.minFilter=r.LinearFilter,e.needsUpdate=!0,this.material.map=e}catch(t){if(this.disposed)return;console.warn("Geo-Three: Failed to load node tile data.",this),this.material.map=c.defaultTexture}this.material.needsUpdate=!0})}nodeReady(){if(this.disposed){console.warn("Geo-Three: nodeReady() called for disposed node.",this),this.dispose();return}if(null!==this.parentNode){if(this.parentNode.nodesLoaded++,this.parentNode.nodesLoaded===c.childrens){!0===this.parentNode.subdivided&&(this.parentNode.isMesh=!1);for(let t=0;t<this.parentNode.children.length;t++)this.parentNode.children[t].visible=!0}this.parentNode.nodesLoaded>c.childrens&&console.error("Geo-Three: Loaded more children objects than expected.",this.parentNode.nodesLoaded,this)}else this.visible=!0}dispose(){this.disposed=!0;try{let t=this.material;t.dispose(),t.map&&t.map!==c.defaultTexture&&t.map.dispose()}catch(t){}try{this.geometry.dispose()}catch(t){}}}c.defaultTexture=l.createFillTexture(),c.baseGeometry=null,c.baseScale=null,c.childrens=4;class u extends r.BufferGeometry{constructor(t=1,e=1,i=1,s=1,n=!1,o=10){super();let a=[],l=[],h=[],c=[];u.buildPlane(t,e,i,s,a,l,h,c),n&&u.buildSkirt(t,e,i,s,o,a,l,h,c),this.setIndex(a),this.setAttribute("position",new r.Float32BufferAttribute(l,3)),this.setAttribute("normal",new r.Float32BufferAttribute(h,3)),this.setAttribute("uv",new r.Float32BufferAttribute(c,2))}static buildPlane(t=1,e=1,i=1,r=1,s,n,o,a){let l=t/2,h=e/2,c=i+1,u=r+1,d=t/i,p=e/r;for(let t=0;t<u;t++){let e=t*p-h;for(let s=0;s<c;s++){let h=s*d-l;n.push(h,0,e),o.push(0,1,0),a.push(s/i,1-t/r)}}for(let t=0;t<r;t++)for(let e=0;e<i;e++){let i=e+c*t,r=e+c*(t+1),n=e+1+c*(t+1),o=e+1+c*t;s.push(i,r,o,r,n,o)}}static buildSkirt(t=1,e=1,i=1,r=1,s,n,o,a,l){let h=t/2,c=e/2,u=i+1,d=r+1,p=t/i,f=e/r,m=o.length/3;for(let t=0;t<u;t++){let e=t*p-h,r=-c;o.push(e,-s,r),a.push(0,1,0),l.push(t/i,1)}for(let t=0;t<i;t++){let e=t,i=t+1,r=t+m,s=t+m+1;n.push(i,r,e,i,s,r)}m=o.length/3;for(let t=0;t<u;t++){let e=t*p-h,n=r*f-c;o.push(e,-s,n),a.push(0,1,0),l.push(t/i,0)}let g=u*d-i-1;for(let t=0;t<i;t++){let e=g+t,i=g+t+1,r=t+m,s=t+m+1;n.push(e,r,i,r,s,i)}m=o.length/3;for(let t=0;t<d;t++){let e=t*f-c,i=-h;o.push(i,-s,e),a.push(0,1,0),l.push(0,1-t/r)}for(let t=0;t<r;t++){let e=t*d,i=(t+1)*d,r=t+m,s=t+m+1;n.push(e,r,i,r,s,i)}m=o.length/3;for(let t=0;t<d;t++){let e=t*f-c,n=i*p-h;o.push(n,-s,e),a.push(0,1,0),l.push(1,1-t/r)}for(let t=0;t<r;t++){let e=t*d+r,i=(t+1)*d+r,s=t+m,o=t+m+1;n.push(i,s,e,i,o,s)}}}class d{constructor(t,e){this.latitude=t,this.longitude=e}}class p{static datumsToSpherical(t,e){let i=e*p.EARTH_ORIGIN/180,s=Math.log(Math.tan((90+t)*Math.PI/360))/(Math.PI/180);return s=s*p.EARTH_ORIGIN/180,new r.Vector2(i,s)}static sphericalToDatums(t,e){let i=t/p.EARTH_ORIGIN*180,r=e/p.EARTH_ORIGIN*180;return new d(r=180/Math.PI*(2*Math.atan(Math.exp(r*Math.PI/180))-Math.PI/2),i)}static quadtreeToDatums(t,e,i){let r=Math.pow(2,t);return new d(Math.atan(Math.sinh(Math.PI*(1-2*i/r)))/Math.PI*180,e/r*360-180)}static vectorToDatums(t){let e=180/Math.PI;return new d(Math.atan2(t.y,Math.sqrt(Math.pow(t.x,2)+Math.pow(-t.z,2)))*e,Math.atan2(-t.z,t.x)*e)}static datumsToVector(t,e){let i=Math.PI/180,s=e*i,n=t*i;var o=Math.cos(n);return new r.Vector3(-Math.cos(s+Math.PI)*o,Math.sin(n),Math.sin(s+Math.PI)*o)}static mapboxAltitude(t){return(16711680*t.r+65280*t.g+255*t.b)*.1-1e4}}p.EARTH_RADIUS=6371008,p.EARTH_RADIUS_A=6378137,p.EARTH_RADIUS_B=6356752.314245,p.EARTH_PERIMETER=2*Math.PI*p.EARTH_RADIUS,p.EARTH_ORIGIN=p.EARTH_PERIMETER/2;class f extends c{constructor(t=null,e=null,i=h.root,s=0,n=0,o=0){super(t,e,i,s,n,o,f.geometry,new r.MeshBasicMaterial({wireframe:!1})),this.matrixAutoUpdate=!1,this.isMesh=!0,this.visible=!1}initialize(){let t=Object.create(null,{initialize:{get:()=>super.initialize}});return s(this,void 0,void 0,function*(){t.initialize.call(this),yield this.loadData(),this.nodeReady()})}createChildNodes(){let t=this.level+1,e=2*this.x,i=2*this.y,r=Object.getPrototypeOf(this).constructor,s=new r(this,this.mapView,h.topLeft,t,e,i);s.scale.set(.5,1,.5),s.position.set(-.25,0,-.25),this.add(s),s.updateMatrix(),s.updateMatrixWorld(!0),(s=new r(this,this.mapView,h.topRight,t,e+1,i)).scale.set(.5,1,.5),s.position.set(.25,0,-.25),this.add(s),s.updateMatrix(),s.updateMatrixWorld(!0),(s=new r(this,this.mapView,h.bottomLeft,t,e,i+1)).scale.set(.5,1,.5),s.position.set(-.25,0,.25),this.add(s),s.updateMatrix(),s.updateMatrixWorld(!0),(s=new r(this,this.mapView,h.bottomRight,t,e+1,i+1)).scale.set(.5,1,.5),s.position.set(.25,0,.25),this.add(s),s.updateMatrix(),s.updateMatrixWorld(!0)}raycast(t,e){!0===this.isMesh&&super.raycast(t,e)}}f.geometry=new u(1,1,1,1,!1),f.baseGeometry=f.geometry,f.baseScale=new r.Vector3(p.EARTH_PERIMETER,1,p.EARTH_PERIMETER);class m extends r.BufferGeometry{constructor(t=1,e=1,i=1,s=1,n=!1,o=10,a=null,l=!0){super();let h=[],c=[],d=[],p=[];u.buildPlane(t,e,i,s,h,c,d,p);let f=a.data;for(let t=0,e=0;t<f.length&&e<c.length;t+=4,e+=3){let i=(65536*f[t]+256*f[t+1]+f[t+2])*.1-1e4;c[e+1]=i}n&&u.buildSkirt(t,e,i,s,o,h,c,d,p),this.setIndex(h),this.setAttribute("position",new r.Float32BufferAttribute(c,3)),this.setAttribute("normal",new r.Float32BufferAttribute(d,3)),this.setAttribute("uv",new r.Float32BufferAttribute(p,2)),l&&this.computeNormals(i,s)}computeNormals(t,e){let i=this.getAttribute("position");if(void 0!==i){let s=this.getAttribute("normal"),n=e*t;for(let t=0;t<n;t++)s.setXYZ(t,0,0,0);let o=new r.Vector3,a=new r.Vector3,l=new r.Vector3,h=new r.Vector3,c=new r.Vector3,u=new r.Vector3,d=new r.Vector3,p=new r.Vector3,f=e*t*6;for(let t=0;t<f;t+=3){let e=this.index.getX(t+0),r=this.index.getX(t+1),n=this.index.getX(t+2);o.fromBufferAttribute(i,e),a.fromBufferAttribute(i,r),l.fromBufferAttribute(i,n),d.subVectors(l,a),p.subVectors(o,a),d.cross(p),h.fromBufferAttribute(s,e),c.fromBufferAttribute(s,r),u.fromBufferAttribute(s,n),h.add(d),c.add(d),u.add(d),s.setXYZ(e,h.x,h.y,h.z),s.setXYZ(r,c.x,c.y,c.z),s.setXYZ(n,u.x,u.y,u.z)}this.normalizeNormals(),s.needsUpdate=!0}}}class g extends c{constructor(t=null,e=null,i=h.root,s=0,n=0,o=0,a=g.geometry,l=new r.MeshPhongMaterial({wireframe:!1,color:16777215})){super(t,e,i,s,n,o,a,l),this.heightLoaded=!1,this.textureLoaded=!1,this.geometrySize=16,this.geometryNormals=!1,this.isMesh=!0,this.visible=!1,this.matrixAutoUpdate=!1}initialize(){let t=Object.create(null,{initialize:{get:()=>super.initialize}});return s(this,void 0,void 0,function*(){t.initialize.call(this),yield this.loadData(),yield this.loadHeightGeometry(),this.nodeReady()})}loadData(){let t=Object.create(null,{loadData:{get:()=>super.loadData}});return s(this,void 0,void 0,function*(){yield t.loadData.call(this),this.textureLoaded=!0})}loadHeightGeometry(){return s(this,void 0,void 0,function*(){if(null===this.mapView.heightProvider)throw Error("GeoThree: MapView.heightProvider provider is null.");if(this.level<this.mapView.heightProvider.minZoom||this.level>this.mapView.heightProvider.maxZoom){console.warn("Geo-Three: Loading tile outside of provider range.",this),this.geometry=f.baseGeometry;return}try{let t=yield this.mapView.heightProvider.fetchTile(this.level,this.x,this.y);if(this.disposed)return;let e=a.createOffscreenCanvas(this.geometrySize+1,this.geometrySize+1),i=e.getContext("2d");i.imageSmoothingEnabled=!1,i.drawImage(t,0,0,g.tileSize,g.tileSize,0,0,e.width,e.height);let r=i.getImageData(0,0,e.width,e.height);this.geometry=new m(1,1,this.geometrySize,this.geometrySize,!0,10,r,!0)}catch(t){if(this.disposed)return;this.geometry=f.baseGeometry}this.heightLoaded=!0})}createChildNodes(){let t=this.level+1,e=Object.getPrototypeOf(this).constructor,i=2*this.x,r=2*this.y,s=new e(this,this.mapView,h.topLeft,t,i,r);s.scale.set(.5,1,.5),s.position.set(-.25,0,-.25),this.add(s),s.updateMatrix(),s.updateMatrixWorld(!0),(s=new e(this,this.mapView,h.topRight,t,i+1,r)).scale.set(.5,1,.5),s.position.set(.25,0,-.25),this.add(s),s.updateMatrix(),s.updateMatrixWorld(!0),(s=new e(this,this.mapView,h.bottomLeft,t,i,r+1)).scale.set(.5,1,.5),s.position.set(-.25,0,.25),this.add(s),s.updateMatrix(),s.updateMatrixWorld(!0),(s=new e(this,this.mapView,h.bottomRight,t,i+1,r+1)).scale.set(.5,1,.5),s.position.set(.25,0,.25),this.add(s),s.updateMatrix(),s.updateMatrixWorld(!0)}raycast(t,e){!0===this.isMesh&&super.raycast(t,e)}}g.tileSize=256,g.geometry=new u(1,1,1,1),g.baseGeometry=f.geometry,g.baseScale=new r.Vector3(p.EARTH_PERIMETER,1,p.EARTH_PERIMETER);class _ extends r.BufferGeometry{constructor(t,e,i,s,n,o,a){super();let l=o+a,h=0,c=[],u=new r.Vector3,d=new r.Vector3,p=[],f=[],m=[],g=[];for(let r=0;r<=i;r++){let l=[],p=r/i;for(let i=0;i<=e;i++){let r=i/e;u.x=-t*Math.cos(s+r*n)*Math.sin(o+p*a),u.y=t*Math.cos(o+p*a),u.z=t*Math.sin(s+r*n)*Math.sin(o+p*a),f.push(u.x,u.y,u.z),d.set(u.x,u.y,u.z).normalize(),m.push(d.x,d.y,d.z),g.push(r,1-p),l.push(h++)}c.push(l)}for(let t=0;t<i;t++)for(let r=0;r<e;r++){let e=c[t][r+1],s=c[t][r],n=c[t+1][r],a=c[t+1][r+1];(0!==t||o>0)&&p.push(e,s,a),(t!==i-1||l<Math.PI)&&p.push(s,n,a)}this.setIndex(p),this.setAttribute("position",new r.Float32BufferAttribute(f,3)),this.setAttribute("normal",new r.Float32BufferAttribute(m,3)),this.setAttribute("uv",new r.Float32BufferAttribute(g,2))}}class y extends c{constructor(t=null,e=null,i=h.root,s=0,n=0,o=0){super(t,e,i,s,n,o,y.createGeometry(s,n,o),new r.MeshBasicMaterial({wireframe:!1})),this.applyScaleNode(),this.matrixAutoUpdate=!1,this.isMesh=!0,this.visible=!1}initialize(){let t=Object.create(null,{initialize:{get:()=>super.initialize}});return s(this,void 0,void 0,function*(){t.initialize.call(this),yield this.loadData(),this.nodeReady()})}static createGeometry(t,e,i){let r=Math.pow(2,t),s=Math.floor(y.segments*(40/(t+1))/40),n=1/r*2*Math.PI,o=1/r*Math.PI;return new _(1,s,s,e*n,n,i*o,o)}applyScaleNode(){this.geometry.computeBoundingBox();let t=this.geometry.boundingBox.clone().getCenter(new r.Vector3),e=new r.Matrix4;e.compose(new r.Vector3(-t.x,-t.y,-t.z),new r.Quaternion,new r.Vector3(p.EARTH_RADIUS,p.EARTH_RADIUS,p.EARTH_RADIUS)),this.geometry.applyMatrix4(e),this.position.copy(t),this.updateMatrix(),this.updateMatrixWorld()}updateMatrix(){this.matrix.setPosition(this.position),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t=!1){(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1)}createChildNodes(){let t=this.level+1,e=2*this.x,i=2*this.y,r=Object.getPrototypeOf(this).constructor,s=new r(this,this.mapView,h.topLeft,t,e,i);this.add(s),s=new r(this,this.mapView,h.topRight,t,e+1,i),this.add(s),s=new r(this,this.mapView,h.bottomLeft,t,e,i+1),this.add(s),s=new r(this,this.mapView,h.bottomRight,t,e+1,i+1),this.add(s)}raycast(t,e){!0===this.isMesh&&super.raycast(t,e)}}y.baseGeometry=new _(p.EARTH_RADIUS,64,64,0,2*Math.PI,0,Math.PI),y.baseScale=new r.Vector3(1,1,1),y.segments=80;class v extends g{constructor(t=null,e=null,i=h.root,s=0,n=0,o=0){super(t,e,i,s,n,o,v.geometry,v.prepareMaterial(new r.MeshPhongMaterial({map:c.defaultTexture,color:16777215}))),this.frustumCulled=!1}static prepareMaterial(t){return t.userData={heightMap:{value:v.defaultHeightTexture}},t.onBeforeCompile=e=>{for(let i in t.userData)e.uniforms[i]=t.userData[i];e.vertexShader=`
			uniform sampler2D heightMap;
			`+e.vertexShader,e.vertexShader=e.vertexShader.replace("#include <fog_vertex>",`
			#include <fog_vertex>
	
			// Calculate height of the title
			vec4 _theight = texture2D(heightMap, vUv);
			float _height = ((_theight.r * 255.0 * 65536.0 + _theight.g * 255.0 * 256.0 + _theight.b * 255.0) * 0.1) - 10000.0;
			vec3 _transformed = position + _height * normal;
	
			// Vertex position based on height
			gl_Position = projectionMatrix * modelViewMatrix * vec4(_transformed, 1.0);
			`)},t}loadData(){let t=Object.create(null,{loadData:{get:()=>super.loadData}});return s(this,void 0,void 0,function*(){yield t.loadData.call(this),this.textureLoaded=!0})}loadHeightGeometry(){return s(this,void 0,void 0,function*(){if(null===this.mapView.heightProvider)throw Error("GeoThree: MapView.heightProvider provider is null.");if(this.level<this.mapView.heightProvider.minZoom||this.level>this.mapView.heightProvider.maxZoom){console.warn("Geo-Three: Loading tile outside of provider range.",this),this.material.map=v.defaultTexture,this.material.needsUpdate=!0;return}try{let t=yield this.mapView.heightProvider.fetchTile(this.level,this.x,this.y);if(this.disposed)return;let e=new r.Texture(t);e.generateMipmaps=!1,e.format=r.RGBAFormat,e.magFilter=r.NearestFilter,e.minFilter=r.NearestFilter,e.needsUpdate=!0,this.material.userData.heightMap.value=e}catch(t){if(this.disposed)return;console.error("Geo-Three: Failed to load node tile height data.",this),this.material.userData.heightMap.value=v.defaultHeightTexture}this.material.needsUpdate=!0,this.heightLoaded=!0})}raycast(t,e){!0===this.isMesh&&(this.geometry=f.geometry,super.raycast(t,e),this.geometry=v.geometry)}dispose(){super.dispose(),this.material.userData.heightMap.value&&this.material.userData.heightMap.value!==v.defaultHeightTexture&&this.material.userData.heightMap.value.dispose()}}v.defaultHeightTexture=l.createFillTexture("#0186C0"),v.geometrySize=256,v.geometry=new u(1,1,v.geometrySize,v.geometrySize,!0),v.baseGeometry=f.geometry,v.baseScale=new r.Vector3(p.EARTH_PERIMETER,1,p.EARTH_PERIMETER);class x{constructor(){this.subdivisionRays=1,this.thresholdUp=.6,this.thresholdDown=.15,this.raycaster=new r.Raycaster,this.mouse=new r.Vector2,this.powerDistance=!1,this.scaleDistance=!0}updateLOD(t,e,i,s){let n=[];for(let i=0;i<this.subdivisionRays;i++)this.mouse.set(2*Math.random()-1,2*Math.random()-1),this.raycaster.setFromCamera(this.mouse,e),this.raycaster.intersectObjects(t.children,!0,n);for(let t=0;t<n.length;t++){let e=n[t].object,i=n[t].distance;if(this.powerDistance&&(i=Math.pow(2*i,e.level)),this.scaleDistance){let t=e.matrixWorld.elements;i=new r.Vector3(t[0],t[1],t[2]).length()/i}i>this.thresholdUp?e.subdivide():i<this.thresholdDown&&e.parentNode&&e.parentNode.simplify()}}}class T{constructor(t=257){this.gridSize=t;let e=t-1;if(e&e-1)throw Error(`Expected grid size to be 2^n+1, got ${t}.`);this.numTriangles=e*e*2-2,this.numParentTriangles=this.numTriangles-e*e,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(4*this.numTriangles);for(let t=0;t<this.numTriangles;t++){let i=t+2,r=0,s=0,n=0,o=0,a=0,l=0;for(1&i?n=o=a=e:r=s=l=e;(i>>=1)>1;){let t=r+n>>1,e=s+o>>1;1&i?(n=r,o=s,r=a,s=l):(r=n,s=o,n=a,o=l),a=t,l=e}let h=4*t;this.coords[h+0]=r,this.coords[h+1]=s,this.coords[h+2]=n,this.coords[h+3]=o}}createTile(t){return new E(t,this)}}class E{constructor(t,e){let i=e.gridSize;if(t.length!==i*i)throw Error(`Expected terrain data of length ${i*i} (${i} x ${i}), got ${t.length}.`);this.terrain=t,this.martini=e,this.errors=new Float32Array(t.length),this.update()}update(){let{numTriangles:t,numParentTriangles:e,coords:i,gridSize:r}=this.martini,{terrain:s,errors:n}=this;for(let o=t-1;o>=0;o--){let t=4*o,a=i[t+0],l=i[t+1],h=i[t+2],c=i[t+3],u=a+h>>1,d=l+c>>1,p=u+d-l,f=d+a-u,m=(s[l*r+a]+s[c*r+h])/2,g=d*r+u,_=Math.abs(m-s[g]);if(n[g]=Math.max(n[g],_),o<e){let t=(l+f>>1)*r+(a+p>>1),e=(c+f>>1)*r+(h+p>>1);n[g]=Math.max(n[g],n[t],n[e])}}}getMesh(t=0,e=!1){let{gridSize:i,indices:r}=this.martini,{errors:s}=this,n=0,o=0,a=i-1,l,h,c=0,u=[],d=[],p=[],f=[];function m(g,_,y,v,x,T){let E=g+y>>1,w=_+v>>1;Math.abs(g-x)+Math.abs(_-T)>1&&s[w*i+E]>t?(m(x,T,g,_,E,w),m(y,v,x,T,E,w)):(l=_*i+g,h=v*i+y,c=T*i+x,0===r[l]&&(e&&(0===g?u.push(n):g===a&&d.push(n),0===_?p.push(n):_===a&&f.push(n)),r[l]=++n),0===r[h]&&(e&&(0===y?u.push(n):y===a&&d.push(n),0===v?p.push(n):v===a&&f.push(n)),r[h]=++n),0===r[c]&&(e&&(0===x?u.push(n):x===a&&d.push(n),0===T?p.push(n):T===a&&f.push(n)),r[c]=++n),o++)}r.fill(0),m(0,0,a,a,a,0),m(a,a,0,0,0,a);let g=2*n,_=3*o;e&&(g+=(u.length+d.length+p.length+f.length)*2,_+=((u.length-1)*2+(d.length-1)*2+(p.length-1)*2+(f.length-1)*2)*3);let y=new Uint16Array(g),v=new Uint32Array(_),x=0;function T(e,n,o,a,l,h){let c=e+o>>1,u=n+a>>1;if(Math.abs(e-l)+Math.abs(n-h)>1&&s[u*i+c]>t)T(l,h,e,n,c,u),T(o,a,l,h,c,u);else{let t=r[n*i+e]-1,s=r[a*i+o]-1,c=r[h*i+l]-1;y[2*t]=e,y[2*t+1]=n,y[2*s]=o,y[2*s+1]=a,y[2*c]=l,y[2*c+1]=h,v[x++]=t,v[x++]=s,v[x++]=c}}if(T(0,0,a,a,a,0),T(a,a,0,0,0,a),e){u.sort((t,e)=>y[2*t+1]-y[2*e+1]),d.sort((t,e)=>y[2*e+1]-y[2*t+1]),p.sort((t,e)=>y[2*e]-y[2*t]),f.sort((t,e)=>y[2*t]-y[2*e]);let t=2*n;function E(e){let i=e.length;for(let r=0;r<i-1;r++){let i=e[r],s=e[r+1],n=t/2,o=(t+2)/2;y[t++]=y[2*i],y[t++]=y[2*i+1],v[x++]=i,v[x++]=n,v[x++]=s,v[x++]=n,v[x++]=o,v[x++]=s}y[t++]=y[2*e[i-1]],y[t++]=y[2*e[i-1]+1]}E(u),E(d),E(p),E(f)}return{vertices:y,triangles:v,numVerticesWithoutSkirts:n}}}class w extends g{constructor(t=null,e=null,i=h.root,s=0,n=0,o=0,{elevationDecoder:a=null,meshMaxError:l=10,exageration:c=1}={}){super(t,e,i,s,n,o,w.geometry,w.prepareMaterial(new r.MeshPhongMaterial({map:w.emptyTexture,color:16777215,side:r.DoubleSide}),s,c)),this.elevationDecoder={rScaler:256,gScaler:1,bScaler:1/256,offset:-32768},this.exageration=1,this.meshMaxError=10,a&&(this.elevationDecoder=a),this.meshMaxError=l,this.exageration=c,this.frustumCulled=!1}static prepareMaterial(t,e,i=1){return t.userData={heightMap:{value:w.emptyTexture},drawNormals:{value:0},drawBlack:{value:0},zoomlevel:{value:e},computeNormals:{value:1},drawTexture:{value:1}},t.onBeforeCompile=e=>{for(let i in t.userData)e.uniforms[i]=t.userData[i];e.vertexShader=`
				uniform bool computeNormals;
				uniform float zoomlevel;
				uniform sampler2D heightMap;
				`+e.vertexShader,e.fragmentShader=`
				uniform bool drawNormals;
				uniform bool drawTexture;
				uniform bool drawBlack;
				`+e.fragmentShader,e.fragmentShader=e.fragmentShader.replace("#include <dithering_fragment>",`
				if(drawBlack) {
					gl_FragColor = vec4( 0.0,0.0,0.0, 1.0 );
				} else if(drawNormals) {
					gl_FragColor = vec4( ( 0.5 * vNormal + 0.5 ), 1.0 );
				} else if (!drawTexture) {
					gl_FragColor = vec4( 0.0,0.0,0.0, 0.0 );
				}`),e.vertexShader=e.vertexShader.replace("#include <fog_vertex>",`
				#include <fog_vertex>

				// queried pixels:
				// +-----------+
				// |   |   |   |
				// | a | b | c |
				// |   |   |   |
				// +-----------+
				// |   |   |   |
				// | d | e | f |
				// |   |   |   |
				// +-----------+
				// |   |   |   |
				// | g | h | i |
				// |   |   |   |
				// +-----------+

				if (computeNormals) {
					float e = getElevation(vUv, 0.0);
					ivec2 size = textureSize(heightMap, 0);
					float offset = 1.0 / float(size.x);
					float a = getElevation(vUv + vec2(-offset, -offset), 0.0);
					float b = getElevation(vUv + vec2(0, -offset), 0.0);
					float c = getElevation(vUv + vec2(offset, -offset), 0.0);
					float d = getElevation(vUv + vec2(-offset, 0), 0.0);
					float f = getElevation(vUv + vec2(offset, 0), 0.0);
					float g = getElevation(vUv + vec2(-offset, offset), 0.0);
					float h = getElevation(vUv + vec2(0, offset), 0.0);
					float i = getElevation(vUv + vec2(offset,offset), 0.0);


					float normalLength = 500.0 / zoomlevel;

					vec3 v0 = vec3(0.0, 0.0, 0.0);
					vec3 v1 = vec3(0.0, normalLength, 0.0);
					vec3 v2 = vec3(normalLength, 0.0, 0.0);
					v0.z = (e + d + g + h) / 4.0;
					v1.z = (e+ b + a + d) / 4.0;
					v2.z = (e+ h + i + f) / 4.0;
					vNormal = (normalize(cross(v2 - v0, v1 - v0))).rbg;
				}
				`)},t}static getTerrain(t,e,i){let{rScaler:r,bScaler:s,gScaler:n,offset:o}=i,a=e+1,l=new Float32Array(a*a);for(let i=0,a=0;a<e;a++)for(let h=0;h<e;h++,i++){let e=4*i,h=t[e+0],c=t[e+1],u=t[e+2];l[i+a]=h*r+c*n+u*s+o}for(let t=a*(a-1),e=0;e<a-1;e++,t++)l[t]=l[t-a];for(let t=a-1,e=0;e<a;e++,t+=a)l[t]=l[t-1];return l}static getMeshAttributes(t,e,i,r,s){let n=i+1,o=t.length/2,a=new Float32Array(3*o),l=new Float32Array(2*o),[h,c,u,d]=r||[0,0,i,i],p=(u-h)/i,f=(d-c)/i;for(let r=0;r<o;r++){let o=t[2*r],c=t[2*r+1],u=c*n+o;a[3*r+0]=o*p+h,a[3*r+1]=-e[u]*s,a[3*r+2]=-c*f+d,l[2*r+0]=o/i,l[2*r+1]=c/i}return{position:{value:a,size:3},uv:{value:l,size:2}}}processHeight(t){return s(this,void 0,void 0,function*(){let e=t.width,i=e+1;var s=a.createOffscreenCanvas(e,e),n=s.getContext("2d");n.imageSmoothingEnabled=!1,n.drawImage(t,0,0,e,e,0,0,s.width,s.height);var o=n.getImageData(0,0,s.width,s.height).data;let l=w.getTerrain(o,e,this.elevationDecoder),{vertices:h,triangles:c}=new T(i).createTile(l).getMesh("function"==typeof this.meshMaxError?this.meshMaxError(this.level):this.meshMaxError),u=w.getMeshAttributes(h,l,e,[-.5,-.5,.5,.5],this.exageration);this.geometry=new r.BufferGeometry,this.geometry.setIndex(new r.Uint32BufferAttribute(c,1)),this.geometry.setAttribute("position",new r.Float32BufferAttribute(u.position.value,u.position.size)),this.geometry.setAttribute("uv",new r.Float32BufferAttribute(u.uv.value,u.uv.size)),this.geometry.rotateX(Math.PI);var d=new r.Texture(t);d.generateMipmaps=!1,d.format=r.RGBAFormat,d.magFilter=r.NearestFilter,d.minFilter=r.NearestFilter,d.needsUpdate=!0,this.material.userData.heightMap.value=d,this.material.map=d,this.material.needsUpdate=!0})}loadHeightGeometry(){return s(this,void 0,void 0,function*(){if(null===this.mapView.heightProvider)throw Error("GeoThree: MapView.heightProvider provider is null.");let t=yield this.mapView.heightProvider.fetchTile(this.level,this.x,this.y);this.disposed||(this.processHeight(t),this.heightLoaded=!0,this.nodeReady())})}}w.geometrySize=16,w.emptyTexture=new r.Texture,w.geometry=new u(1,1,1,1),w.tileSize=256;class b extends r.Mesh{constructor(t=b.PLANAR,e=new o,i=null){super(void 0,new r.MeshBasicMaterial({transparent:!0,opacity:0})),this.lod=null,this.provider=null,this.heightProvider=null,this.root=null,this.cacheTiles=!1,this.onBeforeRender=(t,e,i,r,s,n)=>{this.lod.updateLOD(this,i,t,e)},this.lod=new x,this.provider=e,this.heightProvider=i,this.setRoot(t),this.preSubdivide()}setRoot(t){if("number"==typeof t){if(!b.mapModes.has(t))throw Error("Map mode "+t+" does is not registered.");t=new(b.mapModes.get(t))(null,this)}null!==this.root&&(this.remove(this.root),this.root=null),this.root=t,null!==this.root&&(this.geometry=this.root.constructor.baseGeometry,this.scale.copy(this.root.constructor.baseScale),this.root.mapView=this,this.add(this.root),this.root.initialize())}preSubdivide(){var t,e;let i=Math.max(this.provider.minZoom,null!==(e=null===(t=this.heightProvider)||void 0===t?void 0:t.minZoom)&&void 0!==e?e:-1/0);i>0&&function t(e,i){if(!(i<=0)){e.subdivide();for(let r=0;r<e.children.length;r++)e.children[r]instanceof c&&t(e.children[r],i-1)}}(this.root,i)}setProvider(t){t!==this.provider&&(this.provider=t,this.clear())}setHeightProvider(t){t!==this.heightProvider&&(this.heightProvider=t,this.clear())}clear(){return this.traverse(function(t){t.childrenCache&&(t.childrenCache=null),t.initialize&&t.initialize()}),this}minZoom(){var t,e;return Math.max(this.provider.minZoom,null!==(e=null===(t=this.heightProvider)||void 0===t?void 0:t.minZoom)&&void 0!==e?e:-1/0)}maxZoom(){var t,e;return Math.min(this.provider.maxZoom,null!==(e=null===(t=this.heightProvider)||void 0===t?void 0:t.maxZoom)&&void 0!==e?e:1/0)}getMetaData(){this.provider.getMetaData()}raycast(t,e){return!1}}b.PLANAR=200,b.SPHERICAL=201,b.HEIGHT=202,b.HEIGHT_SHADER=203,b.MARTINI=204,b.mapModes=new Map([[b.PLANAR,f],[b.SPHERICAL,y],[b.HEIGHT,g],[b.HEIGHT_SHADER,v],[b.MARTINI,w]]);let O=new r.Vector3,M=new r.Vector3;class P{constructor(t=50,e=300){this.subdivideDistance=t,this.simplifyDistance=e}updateLOD(t,e,i,r){e.getWorldPosition(O),t.children[0].traverse(e=>{e.getWorldPosition(M);let i=O.distanceTo(M);(i/=Math.pow(2,t.provider.maxZoom-e.level))<this.subdivideDistance?e.subdivide():i>this.simplifyDistance&&e.parentNode&&e.parentNode.simplify()})}}new r.Matrix4,new r.Vector3,new r.Frustum,new r.Vector3;class A{static get(t){return s(this,void 0,void 0,function*(){return new Promise(function(e,i){let r=new XMLHttpRequest;r.overrideMimeType("text/plain"),r.open("GET",t,!0),r.onload=function(){e(r.response)},r.onerror=i,r.send(null)})})}static getRaw(t){return s(this,void 0,void 0,function*(){return new Promise(function(e,i){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.open("GET",t,!0),r.onload=function(){e(r.response)},r.onerror=i,r.send(null)})})}static request(t,e,i,r,s,n,o){let a=new XMLHttpRequest;if(a.overrideMimeType("text/plain"),a.open(e,t,!0),null!=i)for(let t in i)a.setRequestHeader(t,i[t]);return void 0!==s&&(a.onload=function(t){s(function(t){try{return JSON.parse(t)}catch(e){return t}}(a.response),a)}),void 0!==n&&(a.onerror=n),void 0!==o&&(a.onprogress=o),a.send(void 0!==r?r:null),a}}class C extends n{constructor(t="",e=C.AERIAL){super(),this.maxZoom=19,this.minZoom=1,this.format="jpeg",this.mapSize=512,this.subdomain="t1",this.meta=null,this.apiKey=t,this.type=e}getMetaData(){return s(this,void 0,void 0,function*(){let t=C.ADDRESS+"/REST/V1/Imagery/Metadata/RoadOnDemand?output=json&include=ImageryProviders&key="+this.apiKey,e=yield A.get(t);this.meta=JSON.parse(e)})}static quadKey(t,e,i){let r="";for(let s=t;s>0;s--){let t=1<<s-1,n=0;(e&t)!=0&&n++,(i&t)!=0&&(n+=2),r+=n}return r}fetchTile(t,e,i){return new Promise((r,s)=>{let n=document.createElement("img");n.onload=function(){r(n)},n.onerror=function(){s()},n.crossOrigin="Anonymous",n.src="http://ecn."+this.subdomain+".tiles.virtualearth.net/tiles/"+this.type+C.quadKey(t,e,i)+".jpeg?g=1173"})}}C.ADDRESS="https://dev.virtualearth.net",C.AERIAL="a",C.ROAD="r",C.AERIAL_LABELS="h",C.OBLIQUE="o",C.OBLIQUE_LABELS="b";class S extends n{constructor(t="",e="",i="base",r="normal.day",s="png",n=512){super(),this.appId=t,this.appCode=e,this.style=i,this.scheme=r,this.format=s,this.size=n,this.version="newest",this.server=1}nextServer(){this.server=this.server%4==0?1:this.server+1}getMetaData(){return s(this,void 0,void 0,function*(){})}fetchTile(t,e,i){return this.nextServer(),new Promise((r,s)=>{let n=document.createElement("img");n.onload=function(){r(n)},n.onerror=function(){s()},n.crossOrigin="Anonymous",n.src="https://"+this.server+"."+this.style+".maps.api.here.com/maptile/2.1/maptile/"+this.version+"/"+this.scheme+"/"+t+"/"+e+"/"+i+"/"+this.size+"/"+this.format+"?app_id="+this.appId+"&app_code="+this.appCode})}}S.PATH="/maptile/2.1/";class U extends n{constructor(t="",e="",i=U.STYLE,r="png",s=!1,n="v4"){super(),this.apiToken=t,this.format=r,this.useHDPI=s,this.mode=i,this.mapId=e,this.style=e,this.version=n}getMetaData(){return s(this,void 0,void 0,function*(){let t=U.ADDRESS+this.version+"/"+this.mapId+".json?access_token="+this.apiToken,e=JSON.parse((yield A.get(t)));this.name=e.name,this.minZoom=e.minZoom,this.maxZoom=e.maxZoom,this.bounds=e.bounds,this.center=e.center})}fetchTile(t,e,i){return new Promise((r,s)=>{let n=document.createElement("img");n.onload=function(){r(n)},n.onerror=function(){s()},n.crossOrigin="Anonymous",this.mode===U.STYLE?n.src=U.ADDRESS+"styles/v1/"+this.style+"/tiles/"+t+"/"+e+"/"+i+(this.useHDPI?"@2x?access_token=":"?access_token=")+this.apiToken:n.src=U.ADDRESS+"v4/"+this.mapId+"/"+t+"/"+e+"/"+i+(this.useHDPI?"@2x.":".")+this.format+"?access_token="+this.apiToken})}}U.ADDRESS="https://api.mapbox.com/",U.STYLE=100,U.MAP_ID=101},3897:function(t,e,i){"use strict";let r,s,n,o,a,l;i.d(e,{r:function(){return tW}});var h=i(8699);let c=Symbol("SKIP_GENERATION");function u(t){return(t.index?t.index.count:t.attributes.position.count)/3}function d(t){let e=u(t),i=t.drawRange,r=i.start/3,s=(i.start+i.count)/3,n=Math.max(0,r);return[{offset:Math.floor(n),count:Math.floor(Math.min(e,s)-n)}]}function p(t){if(!t.groups||!t.groups.length)return d(t);let e=[],i=new Set,r=t.drawRange,s=r.start/3,n=(r.start+r.count)/3;for(let e of t.groups){let t=e.start/3,r=(e.start+e.count)/3;i.add(Math.max(s,t)),i.add(Math.min(n,r))}let o=Array.from(i.values()).sort((t,e)=>t-e);for(let t=0;t<o.length-1;t++){let i=o[t],r=o[t+1];e.push({offset:Math.floor(i),count:Math.floor(r-i)})}return e}function f(t,e,i,r,s){let n=1/0,o=1/0,a=1/0,l=-1/0,h=-1/0,c=-1/0,u=1/0,d=1/0,p=1/0,f=-1/0,m=-1/0,g=-1/0;for(let r=6*e,s=(e+i)*6;r<s;r+=6){let e=t[r+0],i=t[r+1],s=e-i,_=e+i;s<n&&(n=s),_>l&&(l=_),e<u&&(u=e),e>f&&(f=e);let y=t[r+2],v=t[r+3],x=y-v,T=y+v;x<o&&(o=x),T>h&&(h=T),y<d&&(d=y),y>m&&(m=y);let E=t[r+4],w=t[r+5],b=E-w,O=E+w;b<a&&(a=b),O>c&&(c=O),E<p&&(p=E),E>g&&(g=E)}r[0]=n,r[1]=o,r[2]=a,r[3]=l,r[4]=h,r[5]=c,s[0]=u,s[1]=d,s[2]=p,s[3]=f,s[4]=m,s[5]=g}function m(t,e,i){return i.min.x=e[t],i.min.y=e[t+1],i.min.z=e[t+2],i.max.x=e[t+3],i.max.y=e[t+4],i.max.z=e[t+5],i}function g(t){let e=-1,i=-1/0;for(let r=0;r<3;r++){let s=t[r+3]-t[r];s>i&&(i=s,e=r)}return e}function _(t,e,i){let r,s;for(let n=0;n<3;n++){let o=n+3;r=t[n],s=e[n],i[n]=r<s?r:s,r=t[o],s=e[o],i[o]=r>s?r:s}}function y(t,e,i){for(let r=0;r<3;r++){let s=e[t+2*r],n=e[t+2*r+1],o=s-n,a=s+n;o<i[r]&&(i[r]=o),a>i[r+3]&&(i[r+3]=a)}}function v(t){let e=t[3]-t[0],i=t[4]-t[1],r=t[5]-t[2];return 2*(e*i+i*r+r*e)}let x=(t,e)=>t.candidate-e.candidate,T=Array(32).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),E=new Float32Array(6);class w{constructor(){this.boundingData=new Float32Array(6)}}function b(t,e,i,r,s,n){let o=r,a=r+s-1,l=n.pos,h=2*n.axis;for(;;){for(;o<=a&&i[6*o+h]<l;)o++;for(;o<=a&&i[6*a+h]>=l;)a--;if(!(o<a))return o;for(let t=0;t<3;t++){let i=e[3*o+t];e[3*o+t]=e[3*a+t],e[3*a+t]=i}for(let t=0;t<6;t++){let e=i[6*o+t];i[6*o+t]=i[6*a+t],i[6*a+t]=e}o++,a--}}function O(t,e,i,r,s,n){let o=r,a=r+s-1,l=n.pos,h=2*n.axis;for(;;){for(;o<=a&&i[6*o+h]<l;)o++;for(;o<=a&&i[6*a+h]>=l;)a--;if(!(o<a))return o;{let e=t[o];t[o]=t[a],t[a]=e;for(let t=0;t<6;t++){let e=i[6*o+t];i[6*o+t]=i[6*a+t],i[6*a+t]=e}o++,a--}}}function M(t,e){return 65535===e[t+15]}function P(t,e){return e[t+14]}class A{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(t,e){let i=1/0,r=-1/0;for(let s=0,n=t.length;s<n;s++){let n=t[s][e];i=n<i?n:i,r=n>r?n:r}this.min=i,this.max=r}setFromPoints(t,e){let i=1/0,r=-1/0;for(let s=0,n=e.length;s<n;s++){let n=e[s],o=t.dot(n);i=o<i?o:i,r=o>r?o:r}this.min=i,this.max=r}isSeparated(t){return this.min>t.max||t.min>this.max}}A.prototype.setFromBox=function(){let t=new h.Vector3;return function(e,i){let r=i.min,s=i.max,n=1/0,o=-1/0;for(let i=0;i<=1;i++)for(let a=0;a<=1;a++)for(let l=0;l<=1;l++){t.x=r.x*i+s.x*(1-i),t.y=r.y*a+s.y*(1-a),t.z=r.z*l+s.z*(1-l);let h=e.dot(t);n=Math.min(h,n),o=Math.max(h,o)}this.min=n,this.max=o}}(),new A;let C=function(){let t=new h.Vector3,e=new h.Vector3,i=new h.Vector3;return function(r,s,n){let o,a;let l=r.start,h=s.start;i.subVectors(l,h),t.subVectors(r.end,r.start),e.subVectors(s.end,s.start);let c=i.dot(e),u=e.dot(t),d=e.dot(e),p=i.dot(t),f=t.dot(t)*d-u*u;o=0!==f?(c*u-p*d)/f:0,a=(c+o*u)/d,n.x=o,n.y=a}}(),S=function(){let t=new h.Vector2,e=new h.Vector3,i=new h.Vector3;return function(r,s,n,o){C(r,s,t);let a=t.x,l=t.y;if(a>=0&&a<=1&&l>=0&&l<=1){r.at(a,n),s.at(l,o);return}if(a>=0&&a<=1){l<0?s.at(0,o):s.at(1,o),r.closestPointToPoint(o,!0,n);return}if(l>=0&&l<=1){a<0?r.at(0,n):r.at(1,n),s.closestPointToPoint(n,!0,o);return}{let t,h;if(t=a<0?r.start:r.end,h=l<0?s.start:s.end,r.closestPointToPoint(h,!0,e),s.closestPointToPoint(t,!0,i),e.distanceToSquared(h)<=i.distanceToSquared(t)){n.copy(e),o.copy(h);return}n.copy(t),o.copy(i);return}}}(),U=function(){let t=new h.Vector3,e=new h.Vector3,i=new h.Plane,r=new h.Line3;return function(s,n){let{radius:o,center:a}=s,{a:l,b:h,c}=n;if(r.start=l,r.end=h,r.closestPointToPoint(a,!0,t).distanceTo(a)<=o||(r.start=l,r.end=c,r.closestPointToPoint(a,!0,t).distanceTo(a)<=o)||(r.start=h,r.end=c,r.closestPointToPoint(a,!0,t).distanceTo(a)<=o))return!0;let u=n.getPlane(i);if(Math.abs(u.distanceToPoint(a))<=o){let t=u.projectPoint(a,e);if(n.containsPoint(t))return!0}return!1}}();function L(t){return 1e-15>Math.abs(t)}class B extends h.Triangle{constructor(...t){super(...t),this.isExtendedTriangle=!0,this.satAxes=[,,,,].fill().map(()=>new h.Vector3),this.satBounds=[,,,,].fill().map(()=>new A),this.points=[this.a,this.b,this.c],this.sphere=new h.Sphere,this.plane=new h.Plane,this.needsUpdate=!0}intersectsSphere(t){return U(t,this)}update(){let t=this.a,e=this.b,i=this.c,r=this.points,s=this.satAxes,n=this.satBounds,o=s[0],a=n[0];this.getNormal(o),a.setFromPoints(o,r);let l=s[1],h=n[1];l.subVectors(t,e),h.setFromPoints(l,r);let c=s[2],u=n[2];c.subVectors(e,i),u.setFromPoints(c,r);let d=s[3],p=n[3];d.subVectors(i,t),p.setFromPoints(d,r),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,t),this.needsUpdate=!1}}B.prototype.closestPointToSegment=function(){let t=new h.Vector3,e=new h.Vector3,i=new h.Line3;return function(r,s=null,n=null){let o;let{start:a,end:l}=r,h=this.points,c=1/0;for(let a=0;a<3;a++){let l=(a+1)%3;i.start.copy(h[a]),i.end.copy(h[l]),S(i,r,t,e),(o=t.distanceToSquared(e))<c&&(c=o,s&&s.copy(t),n&&n.copy(e))}return this.closestPointToPoint(a,t),(o=a.distanceToSquared(t))<c&&(c=o,s&&s.copy(t),n&&n.copy(a)),this.closestPointToPoint(l,t),(o=l.distanceToSquared(t))<c&&(c=o,s&&s.copy(t),n&&n.copy(l)),Math.sqrt(c)}}(),B.prototype.intersectsTriangle=function(){let t=new B,e=[,,,],i=[,,,],r=new A,s=new A,n=new h.Vector3,o=new h.Vector3,a=new h.Vector3,l=new h.Vector3,c=new h.Vector3,u=new h.Line3,d=new h.Line3,p=new h.Line3,f=new h.Vector3;function m(t,e,i){let r=t.points,s=0,n=-1;for(let t=0;t<3;t++){let{start:a,end:l}=u;a.copy(r[t]),l.copy(r[(t+1)%3]),u.delta(o);let h=L(e.distanceToPoint(a));if(L(e.normal.dot(o))&&h){i.copy(u),s=2;break}let c=e.intersectLine(u,f);if(!c&&h&&f.copy(a),(c||h)&&!L(f.distanceTo(l))){if(s<=1)(1===s?i.start:i.end).copy(f),h&&(n=s);else if(s>=2){(1===n?i.start:i.end).copy(f),s=2;break}if(2==++s&&-1===n)break}}return s}return function(o,h=null,u=!1){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(t.copy(o),t.update(),o=t);let f=this.plane,g=o.plane;if(Math.abs(f.normal.dot(g.normal))>1-1e-10){let t=this.satBounds,a=this.satAxes;i[0]=o.a,i[1]=o.b,i[2]=o.c;for(let e=0;e<4;e++){let s=t[e],n=a[e];if(r.setFromPoints(n,i),s.isSeparated(r))return!1}let l=o.satBounds,c=o.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let t=0;t<4;t++){let i=l[t],s=c[t];if(r.setFromPoints(s,e),i.isSeparated(r))return!1}for(let t=0;t<4;t++){let o=a[t];for(let t=0;t<4;t++){let a=c[t];if(n.crossVectors(o,a),r.setFromPoints(n,e),s.setFromPoints(n,i),r.isSeparated(s))return!1}}return h&&(u||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),h.start.set(0,0,0),h.end.set(0,0,0)),!0}{let t=m(this,g,d);if(1===t&&o.containsPoint(d.end))return h&&(h.start.copy(d.end),h.end.copy(d.end)),!0;if(2!==t)return!1;let e=m(o,f,p);if(1===e&&this.containsPoint(p.end))return h&&(h.start.copy(p.end),h.end.copy(p.end)),!0;if(2!==e)return!1;if(d.delta(a),p.delta(l),0>a.dot(l)){let t=p.start;p.start=p.end,p.end=t}let i=d.start.dot(a),r=d.end.dot(a),s=p.start.dot(a),n=p.end.dot(a);return(i===n||s===r||r<s!=i<n)&&(h&&(c.subVectors(d.start,p.start),c.dot(a)>0?h.start.copy(d.start):h.start.copy(p.start),c.subVectors(d.end,p.end),0>c.dot(a)?h.end.copy(d.end):h.end.copy(p.end)),!0)}}}(),B.prototype.distanceToPoint=function(){let t=new h.Vector3;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),B.prototype.distanceToTriangle=function(){let t=new h.Vector3,e=new h.Vector3,i=["a","b","c"],r=new h.Line3,s=new h.Line3;return function(n,o=null,a=null){let l=o||a?r:null;if(this.intersectsTriangle(n,l))return(o||a)&&(o&&l.getCenter(o),a&&l.getCenter(a)),0;let h=1/0;for(let e=0;e<3;e++){let r;let s=i[e],l=n[s];this.closestPointToPoint(l,t),(r=l.distanceToSquared(t))<h&&(h=r,o&&o.copy(t),a&&a.copy(l));let c=this[s];n.closestPointToPoint(c,t),(r=c.distanceToSquared(t))<h&&(h=r,o&&o.copy(c),a&&a.copy(t))}for(let l=0;l<3;l++){let c=i[l],u=i[(l+1)%3];r.set(this[c],this[u]);for(let l=0;l<3;l++){let c=i[l],u=i[(l+1)%3];s.set(n[c],n[u]),S(r,s,t,e);let d=t.distanceToSquared(e);d<h&&(h=d,o&&o.copy(t),a&&a.copy(e))}}return Math.sqrt(h)}}();class R{constructor(t,e,i){this.isOrientedBox=!0,this.min=new h.Vector3,this.max=new h.Vector3,this.matrix=new h.Matrix4,this.invMatrix=new h.Matrix4,this.points=Array(8).fill().map(()=>new h.Vector3),this.satAxes=[,,,].fill().map(()=>new h.Vector3),this.satBounds=[,,,].fill().map(()=>new A),this.alignedSatBounds=[,,,].fill().map(()=>new A),this.needsUpdate=!1,t&&this.min.copy(t),e&&this.max.copy(e),i&&this.matrix.copy(i)}set(t,e,i){this.min.copy(t),this.max.copy(e),this.matrix.copy(i),this.needsUpdate=!0}copy(t){this.min.copy(t.min),this.max.copy(t.max),this.matrix.copy(t.matrix),this.needsUpdate=!0}}R.prototype.update=function(){let t=this.matrix,e=this.min,i=this.max,r=this.points;for(let s=0;s<=1;s++)for(let n=0;n<=1;n++)for(let o=0;o<=1;o++){let a=r[1*s|2*n|4*o];a.x=s?i.x:e.x,a.y=n?i.y:e.y,a.z=o?i.z:e.z,a.applyMatrix4(t)}let s=this.satBounds,n=this.satAxes,o=r[0];for(let t=0;t<3;t++){let e=n[t],i=s[t],a=r[1<<t];e.subVectors(o,a),i.setFromPoints(e,r)}let a=this.alignedSatBounds;a[0].setFromPointsField(r,"x"),a[1].setFromPointsField(r,"y"),a[2].setFromPointsField(r,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},R.prototype.intersectsBox=function(){let t=new A;return function(e){this.needsUpdate&&this.update();let i=e.min,r=e.max,s=this.satBounds,n=this.satAxes,o=this.alignedSatBounds;if(t.min=i.x,t.max=r.x,o[0].isSeparated(t)||(t.min=i.y,t.max=r.y,o[1].isSeparated(t))||(t.min=i.z,t.max=r.z,o[2].isSeparated(t)))return!1;for(let i=0;i<3;i++){let r=n[i],o=s[i];if(t.setFromBox(r,e),o.isSeparated(t))return!1}return!0}}(),R.prototype.intersectsTriangle=function(){let t=new B,e=[,,,],i=new A,r=new A,s=new h.Vector3;return function(n){this.needsUpdate&&this.update(),n.isExtendedTriangle?n.needsUpdate&&n.update():(t.copy(n),t.update(),n=t);let o=this.satBounds,a=this.satAxes;e[0]=n.a,e[1]=n.b,e[2]=n.c;for(let t=0;t<3;t++){let r=o[t],s=a[t];if(i.setFromPoints(s,e),r.isSeparated(i))return!1}let l=n.satBounds,h=n.satAxes,c=this.points;for(let t=0;t<3;t++){let e=l[t],r=h[t];if(i.setFromPoints(r,c),e.isSeparated(i))return!1}for(let t=0;t<3;t++){let n=a[t];for(let t=0;t<4;t++){let o=h[t];if(s.crossVectors(n,o),i.setFromPoints(s,e),r.setFromPoints(s,c),i.isSeparated(r))return!1}}return!0}}(),R.prototype.closestPointToPoint=function(t,e){return this.needsUpdate&&this.update(),e.copy(t).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),e},R.prototype.distanceToPoint=function(){let t=new h.Vector3;return function(e){return this.closestPointToPoint(e,t),e.distanceTo(t)}}(),R.prototype.distanceToBox=function(){let t=["x","y","z"],e=Array(12).fill().map(()=>new h.Line3),i=Array(12).fill().map(()=>new h.Line3),r=new h.Vector3,s=new h.Vector3;return function(n,o=0,a=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(n))return(a||l)&&(n.getCenter(s),this.closestPointToPoint(s,r),n.closestPointToPoint(r,s),a&&a.copy(r),l&&l.copy(s)),0;let h=o*o,c=n.min,u=n.max,d=this.points,p=1/0;for(let t=0;t<8;t++){let e=d[t];s.copy(e).clamp(c,u);let i=e.distanceToSquared(s);if(i<p&&(p=i,a&&a.copy(e),l&&l.copy(s),i<h))return Math.sqrt(i)}let f=0;for(let r=0;r<3;r++)for(let s=0;s<=1;s++)for(let n=0;n<=1;n++){let o=(r+1)%3,a=(r+2)%3,l=s<<o|n<<a,h=1<<r|s<<o|n<<a,p=d[l],m=d[h];e[f].set(p,m);let g=t[r],_=t[o],y=t[a],v=i[f],x=v.start,T=v.end;x[g]=c[g],x[_]=s?c[_]:u[_],x[y]=n?c[y]:u[_],T[g]=u[g],T[_]=s?c[_]:u[_],T[y]=n?c[y]:u[_],f++}for(let t=0;t<=1;t++)for(let e=0;e<=1;e++)for(let i=0;i<=1;i++){s.x=t?u.x:c.x,s.y=e?u.y:c.y,s.z=i?u.z:c.z,this.closestPointToPoint(s,r);let n=s.distanceToSquared(r);if(n<p&&(p=n,a&&a.copy(r),l&&l.copy(s),n<h))return Math.sqrt(n)}for(let t=0;t<12;t++){let n=e[t];for(let t=0;t<12;t++){S(n,i[t],r,s);let e=r.distanceToSquared(s);if(e<p&&(p=e,a&&a.copy(r),l&&l.copy(s),e<h))return Math.sqrt(e)}}return Math.sqrt(p)}}();class D{constructor(t){this._getNewPrimitive=t,this._primitives=[]}getPrimitive(){let t=this._primitives;return 0===t.length?this._getNewPrimitive():t.pop()}releasePrimitive(t){this._primitives.push(t)}}class F extends D{constructor(){super(()=>new B)}}let V=new F;class z{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;let t=[],e=null;this.setBuffer=i=>{e&&t.push(e),e=i,this.float32Array=new Float32Array(i),this.uint16Array=new Uint16Array(i),this.uint32Array=new Uint32Array(i)},this.clearBuffer=()=>{e=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,0!==t.length&&this.setBuffer(t.pop())}}}let I=new z,H=[],k=new D(()=>new h.Box3),N=new h.Vector3,Y=new h.Vector3,Z=new h.Vector3,X=new h.Vector3,G=new h.Vector3,j=new h.Vector2,q=new h.Vector2,K=new h.Vector2,W=new h.Vector3,Q=new h.Vector3,J=new h.Vector3,$=new h.Vector3;function tt(t,e,i,r,s,n,o){let a=3*r,l=a+0,c=a+1,u=a+2,d=t.index;t.index&&(l=d.getX(l),c=d.getX(c),u=d.getX(u));let{position:p,normal:f,uv:m,uv1:g}=t.attributes,_=function(t,e,i,r,s,n,o,a,l,c,u){Z.fromBufferAttribute(e,n),X.fromBufferAttribute(e,o),G.fromBufferAttribute(e,a);let d=function(t,e,i,r,s,n,o,a){if(null===(n===h.BackSide?t.intersectTriangle(r,i,e,!0,s):t.intersectTriangle(e,i,r,n!==h.DoubleSide,s)))return null;let l=t.origin.distanceTo(s);return l<o||l>a?null:{distance:l,point:s.clone()}}(t,Z,X,G,$,l,c,u);if(d){r&&(j.fromBufferAttribute(r,n),q.fromBufferAttribute(r,o),K.fromBufferAttribute(r,a),d.uv=h.Triangle.getInterpolation($,Z,X,G,j,q,K,new h.Vector2)),s&&(j.fromBufferAttribute(s,n),q.fromBufferAttribute(s,o),K.fromBufferAttribute(s,a),d.uv1=h.Triangle.getInterpolation($,Z,X,G,j,q,K,new h.Vector2)),i&&(W.fromBufferAttribute(i,n),Q.fromBufferAttribute(i,o),J.fromBufferAttribute(i,a),d.normal=h.Triangle.getInterpolation($,Z,X,G,W,Q,J,new h.Vector3),d.normal.dot(t.direction)>0&&d.normal.multiplyScalar(-1));let e={a:n,b:o,c:a,normal:new h.Vector3,materialIndex:0};h.Triangle.getNormal(Z,X,G,e.normal),d.face=e,d.faceIndex=n}return d}(i,p,f,m,g,l,c,u,e,n,o);return _?(_.faceIndex=r,s&&s.push(_),_):null}function te(t,e,i,r){let s=t.a,n=t.b,o=t.c,a=e,l=e+1,h=e+2;i&&(a=i.getX(a),l=i.getX(l),h=i.getX(h)),s.x=r.getX(a),s.y=r.getY(a),s.z=r.getZ(a),n.x=r.getX(l),n.y=r.getY(l),n.z=r.getZ(l),o.x=r.getX(h),o.y=r.getY(h),o.z=r.getZ(h)}function ti(t,e,i,r,s,n,o){let{geometry:a}=i,{index:l}=a,h=a.attributes.position;for(let i=t,a=e+t;i<a;i++){let t;if(te(o,3*(t=i),l,h),o.needsUpdate=!0,r(o,t,s,n))return!0}return!1}function tr(t,e,i,r,s){let n,o,a,l,h,c;let u=1/i.direction.x,d=1/i.direction.y,p=1/i.direction.z,f=i.origin.x,m=i.origin.y,g=i.origin.z,_=e[t],y=e[t+3],v=e[t+1],x=e[t+3+1],T=e[t+2],E=e[t+3+2];return u>=0?(n=(_-f)*u,o=(y-f)*u):(n=(y-f)*u,o=(_-f)*u),d>=0?(a=(v-m)*d,l=(x-m)*d):(a=(x-m)*d,l=(v-m)*d),!(n>l)&&!(a>o)&&((a>n||isNaN(n))&&(n=a),(l<o||isNaN(o))&&(o=l),p>=0?(h=(T-g)*p,c=(E-g)*p):(h=(E-g)*p,c=(T-g)*p),!(n>c)&&!(h>o)&&((h>n||n!=n)&&(n=h),(c<o||o!=o)&&(o=c),n<=s&&o>=r))}function ts(t,e,i,r,s,n,o){I.setBuffer(t._roots[e]),function t(e,i,r,s,n,o,a){let{float32Array:l,uint16Array:h,uint32Array:c}=I,u=2*e;if(M(u,h))!function(t,e,i,r,s,n,o,a){let{geometry:l,_indirectBuffer:h}=t;for(let t=r,h=r+s;t<h;t++)tt(l,e,i,t,n,o,a)}(i,r,s,c[e+6],P(u,h),n,o,a);else{let h=e+8;tr(h,l,s,o,a)&&t(h,i,r,s,n,o,a);let u=c[e+6];tr(u,l,s,o,a)&&t(u,i,r,s,n,o,a)}}(0,t,i,r,s,n,o),I.clearBuffer()}let tn=["x","y","z"];function to(t,e,i,r,s,n){I.setBuffer(t._roots[e]);let o=function t(e,i,r,s,n,o){let{float32Array:a,uint16Array:l,uint32Array:h}=I,c=2*e;if(M(c,l))return function(t,e,i,r,s,n,o){let{geometry:a,_indirectBuffer:l}=t,h=1/0,c=null;for(let t=r,l=r+s;t<l;t++){let r;(r=tt(a,e,i,t,null,n,o))&&r.distance<h&&(c=r,h=r.distance)}return c}(i,r,s,h[e+6],P(c,l),n,o);{let l,c;let u=h[e+7],d=tn[u],p=s.direction[d]>=0;p?(l=e+8,c=h[e+6]):(l=h[e+6],c=e+8);let f=tr(l,a,s,n,o)?t(l,i,r,s,n,o):null;if(f){let t=f.point[d];if(p?t<=a[c+u]:t>=a[c+u+3])return f}let m=tr(c,a,s,n,o)?t(c,i,r,s,n,o):null;return f&&m?f.distance<=m.distance?f:m:f||m||null}}(0,t,i,r,s,n);return I.clearBuffer(),o}let ta=new h.Box3,tl=new B,th=new B,tc=new h.Matrix4,tu=new R,td=new R;function tp(t,e,i,r){I.setBuffer(t._roots[e]);let s=function t(e,i,r,s,n=null){let{float32Array:o,uint16Array:a,uint32Array:l}=I,h=2*e;if(null===n&&(r.boundingBox||r.computeBoundingBox(),tu.set(r.boundingBox.min,r.boundingBox.max,s),n=tu),M(h,a)){let t=i.geometry,n=t.index,c=t.attributes.position,u=r.index,d=r.attributes.position,p=l[e+6],f=P(h,a);if(tc.copy(s).invert(),r.boundsTree)return m(e,o,td),td.matrix.copy(tc),td.needsUpdate=!0,r.boundsTree.shapecast({intersectsBounds:t=>td.intersectsBox(t),intersectsTriangle:t=>{t.a.applyMatrix4(s),t.b.applyMatrix4(s),t.c.applyMatrix4(s),t.needsUpdate=!0;for(let e=3*p,i=(f+p)*3;e<i;e+=3)if(te(th,e,n,c),th.needsUpdate=!0,t.intersectsTriangle(th))return!0;return!1}});for(let t=3*p,e=(f+p)*3;t<e;t+=3){te(tl,t,n,c),tl.a.applyMatrix4(tc),tl.b.applyMatrix4(tc),tl.c.applyMatrix4(tc),tl.needsUpdate=!0;for(let t=0,e=u.count;t<e;t+=3)if(te(th,t,u,d),th.needsUpdate=!0,tl.intersectsTriangle(th))return!0}}else{let a=e+8,h=l[e+6];return m(a,o,ta),!!(n.intersectsBox(ta)&&t(a,i,r,s,n))||(m(h,o,ta),!!(n.intersectsBox(ta)&&t(h,i,r,s,n)))}}(0,t,i,r);return I.clearBuffer(),s}let tf=new h.Matrix4,tm=new R,tg=new R,t_=new h.Vector3,ty=new h.Vector3,tv=new h.Vector3,tx=new h.Vector3;function tT(t,e,i,r,s,n,o){let{geometry:a}=i,{index:l}=a,h=a.attributes.position;for(let a=t,c=e+t;a<c;a++){let t;if(te(o,3*(t=i.resolveTriangleIndex(a)),l,h),o.needsUpdate=!0,r(o,t,s,n))return!0}return!1}function tE(t,e,i,r,s,n,o){I.setBuffer(t._roots[e]),function t(e,i,r,s,n,o,a){let{float32Array:l,uint16Array:h,uint32Array:c}=I,u=2*e;if(M(u,h))!function(t,e,i,r,s,n,o,a){let{geometry:l,_indirectBuffer:h}=t;for(let t=r,c=r+s;t<c;t++)tt(l,e,i,h?h[t]:t,n,o,a)}(i,r,s,c[e+6],P(u,h),n,o,a);else{let h=e+8;tr(h,l,s,o,a)&&t(h,i,r,s,n,o,a);let u=c[e+6];tr(u,l,s,o,a)&&t(u,i,r,s,n,o,a)}}(0,t,i,r,s,n,o),I.clearBuffer()}let tw=["x","y","z"];function tb(t,e,i,r,s,n){I.setBuffer(t._roots[e]);let o=function t(e,i,r,s,n,o){let{float32Array:a,uint16Array:l,uint32Array:h}=I,c=2*e;if(M(c,l))return function(t,e,i,r,s,n,o){let{geometry:a,_indirectBuffer:l}=t,h=1/0,c=null;for(let t=r,u=r+s;t<u;t++){let r;(r=tt(a,e,i,l?l[t]:t,null,n,o))&&r.distance<h&&(c=r,h=r.distance)}return c}(i,r,s,h[e+6],P(c,l),n,o);{let l,c;let u=h[e+7],d=tw[u],p=s.direction[d]>=0;p?(l=e+8,c=h[e+6]):(l=h[e+6],c=e+8);let f=tr(l,a,s,n,o)?t(l,i,r,s,n,o):null;if(f){let t=f.point[d];if(p?t<=a[c+u]:t>=a[c+u+3])return f}let m=tr(c,a,s,n,o)?t(c,i,r,s,n,o):null;return f&&m?f.distance<=m.distance?f:m:f||m||null}}(0,t,i,r,s,n);return I.clearBuffer(),o}let tO=new h.Box3,tM=new B,tP=new B,tA=new h.Matrix4,tC=new R,tS=new R;function tU(t,e,i,r){I.setBuffer(t._roots[e]);let s=function t(e,i,r,s,n=null){let{float32Array:o,uint16Array:a,uint32Array:l}=I,h=2*e;if(null===n&&(r.boundingBox||r.computeBoundingBox(),tC.set(r.boundingBox.min,r.boundingBox.max,s),n=tC),M(h,a)){let t=i.geometry,n=t.index,c=t.attributes.position,u=r.index,d=r.attributes.position,p=l[e+6],f=P(h,a);if(tA.copy(s).invert(),r.boundsTree)return m(e,o,tS),tS.matrix.copy(tA),tS.needsUpdate=!0,r.boundsTree.shapecast({intersectsBounds:t=>tS.intersectsBox(t),intersectsTriangle:t=>{t.a.applyMatrix4(s),t.b.applyMatrix4(s),t.c.applyMatrix4(s),t.needsUpdate=!0;for(let e=p,r=f+p;e<r;e++)if(te(tP,3*i.resolveTriangleIndex(e),n,c),tP.needsUpdate=!0,t.intersectsTriangle(tP))return!0;return!1}});for(let t=p,e=f+p;t<e;t++){te(tM,3*i.resolveTriangleIndex(t),n,c),tM.a.applyMatrix4(tA),tM.b.applyMatrix4(tA),tM.c.applyMatrix4(tA),tM.needsUpdate=!0;for(let t=0,e=u.count;t<e;t+=3)if(te(tP,t,u,d),tP.needsUpdate=!0,tM.intersectsTriangle(tP))return!0}}else{let a=e+8,h=l[e+6];return m(a,o,tO),!!(n.intersectsBox(tO)&&t(a,i,r,s,n))||(m(h,o,tO),!!(n.intersectsBox(tO)&&t(h,i,r,s,n)))}}(0,t,i,r);return I.clearBuffer(),s}let tL=new h.Matrix4,tB=new R,tR=new R,tD=new h.Vector3,tF=new h.Vector3,tV=new h.Vector3,tz=new h.Vector3,tI=new I.constructor,tH=new I.constructor,tk=new D(()=>new h.Box3),tN=new h.Box3,tY=new h.Box3,tZ=new h.Box3,tX=new h.Box3,tG=!1,tj=new R,tq=new h.Box3,tK={strategy:0,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0};class tW{static serialize(t,e={}){e={cloneBuffers:!0,...e};let i=t.geometry,r=t._roots,s=t._indirectBuffer,n=i.getIndex();return e.cloneBuffers?{roots:r.map(t=>t.slice()),index:n?n.array.slice():null,indirectBuffer:s?s.slice():null}:{roots:r,index:n?n.array:null,indirectBuffer:s}}static deserialize(t,e,i={}){i={setIndex:!0,indirect:!!t.indirectBuffer,...i};let{index:r,roots:s,indirectBuffer:n}=t,o=new tW(e,{...i,[c]:!0});if(o._roots=s,o._indirectBuffer=n||null,i.setIndex){let i=e.getIndex();if(null===i){let i=new h.BufferAttribute(t.index,1,!1);e.setIndex(i)}else i.array!==r&&(i.array.set(r),i.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(t,e={}){if(t.isBufferGeometry){if(t.index&&t.index.isInterleavedBufferAttribute)throw Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw Error("MeshBVH: Only BufferGeometries are supported.");if((e=Object.assign({...tK,[c]:!1},e)).useSharedArrayBuffer&&!("undefined"!=typeof SharedArrayBuffer))throw Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=t,this._roots=null,this._indirectBuffer=null,e[c]||(function(t,e){let i=t.geometry;e.indirect&&(t._indirectBuffer=function(t,e){let i=(t.index?t.index.count:t.attributes.position.count)/3,r=i>65536,s=r?4:2,n=e?new SharedArrayBuffer(i*s):new ArrayBuffer(i*s),o=r?new Uint32Array(n):new Uint16Array(n);for(let t=0,e=o.length;t<e;t++)o[t]=t;return o}(i,e.useSharedArrayBuffer),function(t){if(0===t.groups.length)return!1;let e=u(t),i=p(t).sort((t,e)=>t.offset-e.offset),r=i[i.length-1];r.count=Math.min(e-r.offset,r.count);let s=0;return i.forEach(({count:t})=>s+=t),e!==s}(i)&&!e.verbose&&console.warn('MeshBVH: Provided geometry contains groups that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')),t._indirectBuffer||function(t,e){if(!t.index){let i=t.attributes.position.count,r=function(t,e=ArrayBuffer){return t>65535?new Uint32Array(new e(4*t)):new Uint16Array(new e(2*t))}(i,e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);t.setIndex(new h.BufferAttribute(r,1));for(let t=0;t<i;t++)r[t]=t}}(i,e);let a=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,l=function(t,e=null,i=null,r=null){let s;let n=t.attributes.position,o=t.index?t.index.array:null,a=u(t),l=n.normalized;null===e?(s=new Float32Array(24*a),i=0,r=a):(s=e,i=i||0,r=r||a);let h=n.array,c=n.offset||0,d=3;n.isInterleavedBufferAttribute&&(d=n.data.stride);let p=["getX","getY","getZ"];for(let t=i;t<i+r;t++){let e=3*t,i=6*t,r=e+0,a=e+1,u=e+2;o&&(r=o[r],a=o[a],u=o[u]),l||(r=r*d+c,a=a*d+c,u=u*d+c);for(let t=0;t<3;t++){let e,o,c;l?(e=n[p[t]](r),o=n[p[t]](a),c=n[p[t]](u)):(e=h[r+t],o=h[a+t],c=h[u+t]);let d=e;o<d&&(d=o),c<d&&(d=c);let f=e;o>f&&(f=o),c>f&&(f=c);let m=(f-d)/2,g=2*t;s[i+g+0]=d+m,s[i+g+1]=m+(Math.abs(d)+m)*5960464477539063e-23}}return s}(i),c=e.indirect?d(i):p(i);t._roots=c.map(i=>{let h=function(t,e,i,r,s){let{maxDepth:n,verbose:o,maxLeafTris:a,strategy:l,onProgress:h,indirect:c}=s,d=t._indirectBuffer,p=t.geometry,m=p.index?p.index.array:null,M=c?O:b,P=u(p),A=new Float32Array(6),C=!1,S=new w;return f(e,i,r,S.boundingData,A),function t(i,r,s,h=null,c=0){if(!C&&c>=n&&(C=!0,o&&(console.warn(`MeshBVH: Max depth of ${n} reached when generating BVH. Consider increasing maxDepth.`),console.warn(p))),s<=a||c>=n)return U(r+s),i.offset=r,i.count=s,i;let u=function(t,e,i,r,s,n){let o=-1,a=0;if(0===n)-1!==(o=g(e))&&(a=(e[o]+e[o+3])/2);else if(1===n)-1!==(o=g(t))&&(a=function(t,e,i,r){let s=0;for(let n=e,o=e+i;n<o;n++)s+=t[6*n+2*r];return s/i}(i,r,s,o));else if(2===n){let n=v(t),l=1.25*s,h=6*r,c=(r+s)*6;for(let t=0;t<3;t++){let r=e[t],u=(e[t+3]-r)/32;if(s<8){let e=[...T];e.length=s;let r=0;for(let s=h;s<c;s+=6,r++){let n=e[r];n.candidate=i[s+2*t],n.count=0;let{bounds:o,leftCacheBounds:a,rightCacheBounds:l}=n;for(let t=0;t<3;t++)l[t]=1/0,l[t+3]=-1/0,a[t]=1/0,a[t+3]=-1/0,o[t]=1/0,o[t+3]=-1/0;y(s,i,o)}e.sort(x);let u=s;for(let t=0;t<u;t++){let i=e[t];for(;t+1<u&&e[t+1].candidate===i.candidate;)e.splice(t+1,1),u--}for(let r=h;r<c;r+=6){let s=i[r+2*t];for(let t=0;t<u;t++){let n=e[t];s>=n.candidate?y(r,i,n.rightCacheBounds):(y(r,i,n.leftCacheBounds),n.count++)}}for(let i=0;i<u;i++){let r=e[i],h=r.count,c=s-r.count,u=r.leftCacheBounds,d=r.rightCacheBounds,p=0;0!==h&&(p=v(u)/n);let f=0;0!==c&&(f=v(d)/n);let m=1+1.25*(p*h+f*c);m<l&&(o=t,l=m,a=r.candidate)}}else{for(let t=0;t<32;t++){let e=T[t];e.count=0,e.candidate=r+u+t*u;let i=e.bounds;for(let t=0;t<3;t++)i[t]=1/0,i[t+3]=-1/0}for(let e=h;e<c;e+=6){let s=~~((i[e+2*t]-r)/u);s>=32&&(s=31);let n=T[s];n.count++,y(e,i,n.bounds)}let e=T[31];!function(t,e){e.set(t)}(e.bounds,e.rightCacheBounds);for(let t=30;t>=0;t--){let e=T[t],i=T[t+1];_(e.bounds,i.rightCacheBounds,e.rightCacheBounds)}let d=0;for(let e=0;e<31;e++){let i=T[e],r=i.count,h=i.bounds,c=T[e+1].rightCacheBounds;0!==r&&(0===d?function(t,e){e.set(t)}(h,E):_(h,E,E));let u=0,p=0;0!==(d+=r)&&(u=v(E)/n);let f=s-d;0!==f&&(p=v(c)/n);let m=1+1.25*(u*d+p*f);m<l&&(o=t,l=m,a=i.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${n} used.`);return{axis:o,pos:a}}(i.boundingData,h,e,r,s,l);if(-1===u.axis)return U(r+s),i.offset=r,i.count=s,i;let b=M(d,m,e,r,s,u);if(b===r||b===r+s)U(r+s),i.offset=r,i.count=s;else{i.splitAxis=u.axis;let n=new w,o=b-r;i.left=n,f(e,r,o,n.boundingData,A),t(n,r,o,A,c+1);let a=new w,l=s-o;i.right=a,f(e,b,l,a.boundingData,A),t(a,b,l,A,c+1)}return i}(S,i,r,A),S;function U(t){h&&h(t/P)}}(t,l,i.offset,i.count,e),c=new a(32*function t(e){return"count"in e?1:1+t(e.left)+t(e.right)}(h));return r=new Float32Array(c),s=new Uint32Array(c),n=new Uint16Array(c),o=new Uint8Array(c),function t(e,i){let a=e/4,l=e/2,h=i.boundingData;for(let t=0;t<6;t++)r[a+t]=h[t];if("count"in i){if(i.buffer){let t=i.buffer;o.set(new Uint8Array(t),e);for(let i=e,r=e+t.byteLength;i<r;i+=32)M(i/2,n)||(s[i/4+6]+=a);return e+t.byteLength}{let t=i.offset,r=i.count;return s[a+6]=t,n[l+14]=r,n[l+15]=65535,e+32}}{let r;let n=i.left,o=i.right,l=i.splitAxis;if((r=t(e+32,n))/4>4294967296)throw Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return s[a+6]=r/4,r=t(r,o),s[a+7]=l,r}}(0,h),c})}(this,e),!t.boundingBox&&e.setBoundingBox&&(t.boundingBox=this.getBoundingBox(new h.Box3))),this.resolveTriangleIndex=e.indirect?t=>this._indirectBuffer[t]:t=>t}refit(t=null){return(this.indirect?function(t,e=null){let i,r,s,n;e&&Array.isArray(e)&&(e=new Set(e));let o=t.geometry,a=o.index?o.index.array:null,l=o.attributes.position,h=0,c=t._roots;for(let o=0,u=c.length;o<u;o++)i=c[o],r=new Uint32Array(i),s=new Uint16Array(i),n=new Float32Array(i),function i(o,h,c=!1){let u=2*o;if(65535===s[u+15]){let e=r[o+6],i=s[u+14],h=1/0,c=1/0,d=1/0,p=-1/0,f=-1/0,m=-1/0;for(let r=e,s=e+i;r<s;r++){let e=3*t.resolveTriangleIndex(r);for(let t=0;t<3;t++){let i=e+t;i=a?a[i]:i;let r=l.getX(i),s=l.getY(i),n=l.getZ(i);r<h&&(h=r),r>p&&(p=r),s<c&&(c=s),s>f&&(f=s),n<d&&(d=n),n>m&&(m=n)}}return(n[o+0]!==h||n[o+1]!==c||n[o+2]!==d||n[o+3]!==p||n[o+4]!==f||n[o+5]!==m)&&(n[o+0]=h,n[o+1]=c,n[o+2]=d,n[o+3]=p,n[o+4]=f,n[o+5]=m,!0)}{let t=o+8,s=r[o+6],a=c,l=!1,u=!1;e?a||(l=e.has(t+h),u=e.has(s+h),a=!l&&!u):(l=!0,u=!0);let d=a||l,p=a||u,f=!1;d&&(f=i(t,h,a));let m=!1;p&&(m=i(s,h,a));let g=f||m;if(g)for(let e=0;e<3;e++){let i=t+e,r=s+e,a=n[i],l=n[i+3],h=n[r],c=n[r+3];n[o+e]=a<h?a:h,n[o+e+3]=l>c?l:c}return g}}(0,h),h+=i.byteLength}:function(t,e=null){let i,r,s,n;e&&Array.isArray(e)&&(e=new Set(e));let o=t.geometry,a=o.index?o.index.array:null,l=o.attributes.position,h=0,c=t._roots;for(let t=0,o=c.length;t<o;t++)i=c[t],r=new Uint32Array(i),s=new Uint16Array(i),n=new Float32Array(i),function t(i,o,h=!1){let c=2*i;if(65535===s[c+15]){let t=r[i+6],e=s[c+14],o=1/0,h=1/0,u=1/0,d=-1/0,p=-1/0,f=-1/0;for(let i=3*t,r=3*(t+e);i<r;i++){let t=a[i],e=l.getX(t),r=l.getY(t),s=l.getZ(t);e<o&&(o=e),e>d&&(d=e),r<h&&(h=r),r>p&&(p=r),s<u&&(u=s),s>f&&(f=s)}return(n[i+0]!==o||n[i+1]!==h||n[i+2]!==u||n[i+3]!==d||n[i+4]!==p||n[i+5]!==f)&&(n[i+0]=o,n[i+1]=h,n[i+2]=u,n[i+3]=d,n[i+4]=p,n[i+5]=f,!0)}{let s=i+8,a=r[i+6],l=h,c=!1,u=!1;e?l||(c=e.has(s+o),u=e.has(a+o),l=!c&&!u):(c=!0,u=!0);let d=l||c,p=l||u,f=!1;d&&(f=t(s,o,l));let m=!1;p&&(m=t(a,o,l));let g=f||m;if(g)for(let t=0;t<3;t++){let e=s+t,r=a+t,o=n[e],l=n[e+3],h=n[r],c=n[r+3];n[i+t]=o<h?o:h,n[i+t+3]=l>c?l:c}return g}}(0,h),h+=i.byteLength})(this,t)}traverse(t,e=0){let i=this._roots[e],r=new Uint32Array(i),s=new Uint16Array(i);!function e(n,o=0){let a=2*n,l=65535===s[a+15];if(l){let e=r[n+6],h=s[a+14];t(o,l,new Float32Array(i,4*n,6),e,h)}else{let s=r[n+6],a=r[n+7];t(o,l,new Float32Array(i,4*n,6),a)||(e(n+8,o+1),e(s,o+1))}}(0)}raycast(t,e=h.FrontSide,i=0,r=1/0){let s=this._roots,n=this.geometry,o=[],a=e.isMaterial,l=Array.isArray(e),c=n.groups,u=a?e.side:e,d=this.indirect?tE:ts;for(let n=0,a=s.length;n<a;n++){let s=l?e[c[n].materialIndex].side:u,a=o.length;if(d(this,n,s,t,o,i,r),l){let t=c[n].materialIndex;for(let e=a,i=o.length;e<i;e++)o[e].face.materialIndex=t}}return o}raycastFirst(t,e=h.FrontSide,i=0,r=1/0){let s=this._roots,n=this.geometry,o=e.isMaterial,a=Array.isArray(e),l=null,c=n.groups,u=o?e.side:e,d=this.indirect?tb:to;for(let n=0,o=s.length;n<o;n++){let s=a?e[c[n].materialIndex].side:u,o=d(this,n,s,t,i,r);null!=o&&(null==l||o.distance<l.distance)&&(l=o,a&&(o.face.materialIndex=c[n].materialIndex))}return l}intersectsGeometry(t,e){let i=!1,r=this._roots,s=this.indirect?tU:tp;for(let n=0,o=r.length;n<o&&!(i=s(this,n,t,e));n++);return i}shapecast(t){let e=V.getPrimitive(),i=this.indirect?tT:ti,{boundsTraverseOrder:r,intersectsBounds:s,intersectsRange:n,intersectsTriangle:o}=t;if(n&&o){let t=n;n=(r,s,n,a,l)=>!!t(r,s,n,a,l)||i(r,s,this,o,n,a,e)}else n||(n=o?(t,r,s,n)=>i(t,r,this,o,s,n,e):(t,e,i)=>i);let h=!1,c=0,u=this._roots;for(let t=0,e=u.length;t<e;t++){let e=u[t];if(h=function(t,e,i,r,s,n){a=k.getPrimitive(),l=k.getPrimitive(),H.push(a,l),I.setBuffer(t._roots[e]);let o=function t(e,i,r,s,n=null,o=0,h=0){let{float32Array:c,uint16Array:u,uint32Array:d}=I,p=2*e;if(M(p,u)){let t=d[e+6],i=P(p,u);return m(e,c,a),s(t,i,!1,h,o+e,a)}{let p,_,y,v,x,T;let E=e+8,w=d[e+6],b=E,O=w;if(n&&(y=a,v=l,m(b,c,y),m(O,c,v),p=n(y),(_=n(v))<p)){b=w,O=E;let t=p;p=_,_=t,y=v}y||m(b,c,y=a);let A=r(y,M(2*b,u),p,h+1,o+b);if(2===A){let t=f(b);x=s(t,g(b)-t,!0,h+1,o+b,y)}else x=A&&t(b,i,r,s,n,o,h+1);if(x)return!0;m(O,c,v=l);let C=r(v,M(2*O,u),_,h+1,o+O);if(2===C){let t=f(O);T=s(t,g(O)-t,!0,h+1,o+O,v)}else T=C&&t(O,i,r,s,n,o,h+1);if(T)return!0;return!1;function f(t){let{uint16Array:e,uint32Array:i}=I,r=2*t;for(;!M(r,e);)t+=8,r=2*t;return i[t+6]}function g(t){let{uint16Array:e,uint32Array:i}=I,r=2*t;for(;!M(r,e);)r=2*(t=i[t+6]);return i[t+6]+P(r,e)}}}(0,t.geometry,i,r,s,n);I.clearBuffer(),k.releasePrimitive(a),k.releasePrimitive(l),H.pop(),H.pop();let h=H.length;return h>0&&(l=H[h-1],a=H[h-2]),o}(this,t,s,n,r,c))break;c+=e.byteLength}return V.releasePrimitive(e),h}bvhcast(t,e,i){let{intersectsRanges:r,intersectsTriangles:s}=i,n=V.getPrimitive(),o=this.geometry.index,a=this.geometry.attributes.position,l=this.indirect?t=>{te(n,3*this.resolveTriangleIndex(t),o,a)}:t=>{te(n,3*t,o,a)},c=V.getPrimitive(),u=t.geometry.index,d=t.geometry.attributes.position,p=t.indirect?e=>{te(c,3*t.resolveTriangleIndex(e),u,d)}:t=>{te(c,3*t,u,d)};if(s){let t=(t,i,r,o,a,h,u,d)=>{for(let f=r,m=r+o;f<m;f++){p(f),c.a.applyMatrix4(e),c.b.applyMatrix4(e),c.c.applyMatrix4(e),c.needsUpdate=!0;for(let e=t,r=t+i;e<r;e++)if(l(e),n.needsUpdate=!0,s(n,c,e,f,a,h,u,d))return!0}return!1};if(r){let e=r;r=function(i,r,s,n,o,a,l,h){return!!e(i,r,s,n,o,a,l,h)||t(i,r,s,n,o,a,l,h)}}else r=t}return function(t,e,i,r){let s;if(tG)throw Error("MeshBVH: Recursive calls to bvhcast not supported.");tG=!0;let n=t._roots,o=e._roots,a=0,l=0,c=new h.Matrix4().copy(i).invert();for(let t=0,e=n.length;t<e;t++){tI.setBuffer(n[t]),l=0;let e=tk.getPrimitive();m(0,tI.float32Array,e),e.applyMatrix4(c);for(let n=0,h=o.length;n<h&&(tH.setBuffer(o[t]),s=function t(e,i,r,s,n,o=0,a=0,l=0,h=0,c=null,u=!1){let d,p;u?(d=tH,p=tI):(d=tI,p=tH);let f=d.float32Array,g=d.uint32Array,_=d.uint16Array,y=p.float32Array,v=p.uint32Array,x=p.uint16Array,T=2*i,E=M(2*e,_),w=M(T,x),b=!1;if(w&&E)b=u?n(v[i+6],P(2*i,x),g[e+6],P(2*e,_),h,a+i,l,o+e):n(g[e+6],P(2*e,_),v[i+6],P(2*i,x),l,o+e,h,a+i);else if(w){let c=tk.getPrimitive();m(i,y,c),c.applyMatrix4(r);let d=e+8,p=g[e+6];m(d,f,tN),m(p,f,tY);let _=c.intersectsBox(tN),v=c.intersectsBox(tY);b=_&&t(i,d,s,r,n,a,o,h,l+1,c,!u)||v&&t(i,p,s,r,n,a,o,h,l+1,c,!u),tk.releasePrimitive(c)}else{let d=i+8,p=v[i+6];m(d,y,tZ),m(p,y,tX);let _=c.intersectsBox(tZ),x=c.intersectsBox(tX);if(_&&x)b=t(e,d,r,s,n,o,a,l,h+1,c,u)||t(e,p,r,s,n,o,a,l,h+1,c,u);else if(_){if(E)b=t(e,d,r,s,n,o,a,l,h+1,c,u);else{let i=tk.getPrimitive();i.copy(tZ).applyMatrix4(r);let c=e+8,p=g[e+6];m(c,f,tN),m(p,f,tY);let _=i.intersectsBox(tN),y=i.intersectsBox(tY);b=_&&t(d,c,s,r,n,a,o,h,l+1,i,!u)||y&&t(d,p,s,r,n,a,o,h,l+1,i,!u),tk.releasePrimitive(i)}}else if(x){if(E)b=t(e,p,r,s,n,o,a,l,h+1,c,u);else{let i=tk.getPrimitive();i.copy(tX).applyMatrix4(r);let c=e+8,d=g[e+6];m(c,f,tN),m(d,f,tY);let _=i.intersectsBox(tN),y=i.intersectsBox(tY);b=_&&t(p,c,s,r,n,a,o,h,l+1,i,!u)||y&&t(p,d,s,r,n,a,o,h,l+1,i,!u),tk.releasePrimitive(i)}}}return b}(0,0,i,c,r,a,l,0,0,e),tH.clearBuffer(),l+=o[n].length,!s);n++);if(tk.releasePrimitive(e),tI.clearBuffer(),a+=n[t].length,s)break}return tG=!1,s}(this,t,e,r)}intersectsBox(t,e){return tj.set(t.min,t.max,e),tj.needsUpdate=!0,this.shapecast({intersectsBounds:t=>tj.intersectsBox(t),intersectsTriangle:t=>tj.intersectsTriangle(t)})}intersectsSphere(t){return this.shapecast({intersectsBounds:e=>t.intersectsBox(e),intersectsTriangle:e=>e.intersectsSphere(t)})}closestPointToGeometry(t,e,i={},r={},s=0,n=1/0){return(this.indirect?function(t,e,i,r={},s={},n=0,o=1/0){e.boundingBox||e.computeBoundingBox(),tB.set(e.boundingBox.min,e.boundingBox.max,i),tB.needsUpdate=!0;let a=t.geometry,l=a.attributes.position,h=a.index,c=e.attributes.position,d=e.index,p=V.getPrimitive(),f=V.getPrimitive(),m=null,g=null;s&&(m=tV,g=tz);let _=1/0,y=null,v=null;return(tL.copy(i).invert(),tR.matrix.copy(tL),t.shapecast({boundsTraverseOrder:t=>tB.distanceToBox(t),intersectsBounds:(t,e,i)=>i<_&&i<o&&(e&&(tR.min.copy(t.min),tR.max.copy(t.max),tR.needsUpdate=!0),!0),intersectsRange:(r,s)=>{if(e.boundsTree){let a=e.boundsTree;return a.shapecast({boundsTraverseOrder:t=>tR.distanceToBox(t),intersectsBounds:(t,e,i)=>i<_&&i<o,intersectsRange:(e,o)=>{for(let u=e,x=e+o;u<x;u++){te(f,3*a.resolveTriangleIndex(u),d,c),f.a.applyMatrix4(i),f.b.applyMatrix4(i),f.c.applyMatrix4(i),f.needsUpdate=!0;for(let e=r,i=r+s;e<i;e++){te(p,3*t.resolveTriangleIndex(e),h,l),p.needsUpdate=!0;let i=p.distanceToTriangle(f,tD,m);if(i<_&&(tF.copy(tD),g&&g.copy(m),_=i,y=e,v=u),i<n)return!0}}}})}{let o=u(e);for(let e=0;e<o;e++){te(f,3*e,d,c),f.a.applyMatrix4(i),f.b.applyMatrix4(i),f.c.applyMatrix4(i),f.needsUpdate=!0;for(let i=r,o=r+s;i<o;i++){te(p,3*t.resolveTriangleIndex(i),h,l),p.needsUpdate=!0;let r=p.distanceToTriangle(f,tD,m);if(r<_&&(tF.copy(tD),g&&g.copy(m),_=r,y=i,v=e),r<n)return!0}}}}}),V.releasePrimitive(p),V.releasePrimitive(f),_===1/0)?null:(r.point?r.point.copy(tF):r.point=tF.clone(),r.distance=_,r.faceIndex=y,s&&(s.point?s.point.copy(g):s.point=g.clone(),s.point.applyMatrix4(tL),tF.applyMatrix4(tL),s.distance=tF.sub(s.point).length(),s.faceIndex=v),r)}:function(t,e,i,r={},s={},n=0,o=1/0){e.boundingBox||e.computeBoundingBox(),tm.set(e.boundingBox.min,e.boundingBox.max,i),tm.needsUpdate=!0;let a=t.geometry,l=a.attributes.position,h=a.index,c=e.attributes.position,d=e.index,p=V.getPrimitive(),f=V.getPrimitive(),m=null,g=null;s&&(m=tv,g=tx);let _=1/0,y=null,v=null;return(tf.copy(i).invert(),tg.matrix.copy(tf),t.shapecast({boundsTraverseOrder:t=>tm.distanceToBox(t),intersectsBounds:(t,e,i)=>i<_&&i<o&&(e&&(tg.min.copy(t.min),tg.max.copy(t.max),tg.needsUpdate=!0),!0),intersectsRange:(t,r)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:t=>tg.distanceToBox(t),intersectsBounds:(t,e,i)=>i<_&&i<o,intersectsRange:(e,s)=>{for(let o=e,a=e+s;o<a;o++){te(f,3*o,d,c),f.a.applyMatrix4(i),f.b.applyMatrix4(i),f.c.applyMatrix4(i),f.needsUpdate=!0;for(let e=t,i=t+r;e<i;e++){te(p,3*e,h,l),p.needsUpdate=!0;let t=p.distanceToTriangle(f,t_,m);if(t<_&&(ty.copy(t_),g&&g.copy(m),_=t,y=e,v=o),t<n)return!0}}}});{let s=u(e);for(let e=0;e<s;e++){te(f,3*e,d,c),f.a.applyMatrix4(i),f.b.applyMatrix4(i),f.c.applyMatrix4(i),f.needsUpdate=!0;for(let i=t,s=t+r;i<s;i++){te(p,3*i,h,l),p.needsUpdate=!0;let t=p.distanceToTriangle(f,t_,m);if(t<_&&(ty.copy(t_),g&&g.copy(m),_=t,y=i,v=e),t<n)return!0}}}}}),V.releasePrimitive(p),V.releasePrimitive(f),_===1/0)?null:(r.point?r.point.copy(ty):r.point=ty.clone(),r.distance=_,r.faceIndex=y,s&&(s.point?s.point.copy(g):s.point=g.clone(),s.point.applyMatrix4(tf),ty.applyMatrix4(tf),s.distance=ty.sub(s.point).length(),s.faceIndex=v),r)})(this,t,e,i,r,s,n)}closestPointToPoint(t,e={},i=0,r=1/0){return function(t,e,i={},r=0,s=1/0){let n=r*r,o=s*s,a=1/0,l=null;if(t.shapecast({boundsTraverseOrder:t=>(N.copy(e).clamp(t.min,t.max),N.distanceToSquared(e)),intersectsBounds:(t,e,i)=>i<a&&i<o,intersectsTriangle:(t,i)=>{t.closestPointToPoint(e,N);let r=e.distanceToSquared(N);return r<a&&(Y.copy(N),a=r,l=i),r<n}}),a===1/0)return null;let h=Math.sqrt(a);return i.point?i.point.copy(Y):i.point=Y.clone(),i.distance=h,i.faceIndex=l,i}(this,t,e,i,r)}getBoundingBox(t){return t.makeEmpty(),this._roots.forEach(e=>{m(0,new Float32Array(e),tq),t.union(tq)}),t}}},6377:function(t,e,i){"use strict";i.d(e,{uL:function(){return c}});var r=i(8699);function s(t,e,i){return null===t?null:(t.point.applyMatrix4(e.matrixWorld),t.distance=t.point.distanceTo(i.ray.origin),t.object=e,t)}let n=new r.Ray,o=new r.Vector3,a=new r.Matrix4,l=new r.Vector3,h=r.Mesh.prototype.raycast;function c(t,e){if(this.geometry.boundsTree){if(void 0===this.material)return;a.copy(this.matrixWorld).invert(),n.copy(t.ray).applyMatrix4(a),this.getWorldScale(l),o.copy(n.direction).multiply(l);let i=o.length(),r=t.near/i,h=t.far/i,c=this.geometry.boundsTree;if(!0===t.firstHitOnly){let i=s(c.raycastFirst(n,this.material,r,h),this,t);i&&e.push(i)}else{let i=c.raycast(n,this.material,r,h);for(let r=0,n=i.length;r<n;r++){let n=s(i[r],this,t);n&&e.push(n)}}}else h.call(this,t,e)}}}]);