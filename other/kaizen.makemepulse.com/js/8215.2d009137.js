(self["webpackChunkgl_starter"]=self["webpackChunkgl_starter"]||[]).push([[8215],{72718:function(e,t,s){var n=function(e){var t="";return t+="#pragma SLOT version\n\n#pragma SLOT definitions\n\n#pragma SLOT precision\n\n"+s(87426)()+"\n\n#pragma SLOT pf\n\n\n#if depthFormat( D_RGB )\n  IN vec2 fragZW;\n\n  vec3 encodeDepthRGB(float depth){\n    vec4 c = vec4(1.0,255.0,65025.0,16581375.0)*depth;\n    c=fract(c);\n    c.xyz-=c.yzw*(1.0/255.0);\n    return c.xyz;\n  }\n#endif\n\n\n\nvoid main(void){\n\n  #pragma SLOT f\n  \n  #if depthFormat( D_RGB )\n    gl_FragColor.xyz = encodeDepthRGB( ( fragZW.x / fragZW.y ) * 0.5 + 0.5 );\n    gl_FragColor.w=0.0;\n  #endif\n\n  #if depthFormat( D_DEPTH )\n    gl_FragColor = vec4( 0.0 );\n  #endif\n\n}\n",t};n.toString=n,e.exports=n,n.onHmr=function(){}},67954:function(e,t,s){var n=function(e){var t="";return t+="\n#pragma SLOT version\n\n#pragma SLOT definitions\n\n\n#ifndef hasNormals\n  #define hasNormals 1\n#endif \n#ifndef hasTangents\n  #define hasTangents hasNormals\n#endif \n\n#if hasTangents && !hasNormals \n  #pragma error tan but no nrm\n  error\n#endif\n\n#pragma SLOT precision\n\n"+s(16067)()+"\n\n#pragma SLOT pv\n\n\nIN vec3 aPosition;\n\n\n// uniform mat4 uMVP;\nuniform mat4 uWorldMatrix;\nuniform mat4 uVP;\n\n\n#if depthFormat( D_RGB )\n  OUT vec2 fragZW;\n#endif\n\n\nstruct VertexData {\n  highp vec3 position;\n  highp vec3 worldPos;\n  #if hasNormals\n    vec3 normal;\n  #endif\n  #if hasTangents\n    vec3 tangent;\n  #endif\n  mat4 worldMatrix;\n};\n\n\nvoid InitVertexData( out VertexData vertex ){\n\n  vertex.position = aPosition;\n  #if hasNormals\n    vertex.normal = vec3(0.0);\n  #endif\n  #if hasTangents\n    vertex.tangent = vec3(0.0);\n  #endif\n\n  vertex.worldMatrix = uWorldMatrix;\n   \n}\n\n\n\nvoid main( void ){\n\n  #pragma SLOT v\n\n  VertexData vertex;\n  InitVertexData( vertex );\n\n  #pragma SLOT vertex_warp\n\n  vec4 worldPos = vertex.worldMatrix * vec4( vertex.position, 1.0 );\n  vertex.worldPos.xyz = worldPos.xyz / worldPos.w;\n\n  #pragma SLOT vertex_warp_world\n\n  gl_Position     = uVP * vec4( vertex.worldPos, 1.0 );\n\n  #if depthFormat( D_RGB )\n    fragZW=gl_Position.zw;\n  #endif\n\n  #pragma SLOT postv\n\n}\n",t};n.toString=n,e.exports=n,n.onHmr=function(){}},15415:function(e,t,s){"use strict";s.d(t,{Z:function(){return N}});var n=s(25410),r=s(85645),i=s(61987);const a={POSITION:{indexed:!1,attrib:"aPosition"},NORMAL:{indexed:!1,attrib:"aNormal"},TANGENT:{indexed:!1,attrib:"aTangent"},TEXCOORD:{indexed:!0,attrib:"aTexCoord"},COLOR:{indexed:!0,attrib:"aColor"},JOINTS:{indexed:!0,attrib:"aSkinJoints"},WEIGHTS:{indexed:!0,attrib:"aSkinWeights"}};class o{getMorphedAttributeName(e,t){return this.getAttributeName(e)+"_mt"+t}getAttributeName(e){const[t,s=0]=e.split("_"),n=a[t];if(void 0!==n)return s>0||n.indexed?n.attrib+s:n.attrib;throw new Error(`Invalid Semantic ${e}`)}}var c=s(75989);function l(){return{opaqueMask:1,blendedMask:2}}var h=s(24033),u=s(63887),m=s(67954),d=s.n(m),E=s(72718),g=s.n(E),p=s(17422),T=s(93497),f=s(4378);const _=u.mat4.create();class A extends f.Z{constructor(e){super({uid:"stddepth",vert:d()(),frag:g()()}),this.depthFormat=this.inputs.add(new h.Z("depthFormat",p.Z)),this.precision=this.inputs.add(new T.Z("highp"))}setLightSetup(e){this.depthFormat.proxy(null===e||void 0===e?void 0:e.depthFormat)}prepare(e,t,s){e.uMVP&&(s.modelViewProjectionMatrix(_,t._wmatrix),e.uMVP(_)),e.uWorldMatrix&&e.uWorldMatrix(t._wmatrix),e.uVP&&e.uVP(s._viewProj)}}var R=s(4638),S=s(92571);class I{constructor(){this.indexed=[],this.list=[]}addElement(e,t=-1){t>-1&&(this.indexed[t]=e),this.list.push(e)}}class N{constructor(){this.root=new i.Z,this.extras={},this._collections=new Map([[c.Z.ACCESSOR,new I],[c.Z.ACCESSOR_SPARSE,new I],[c.Z.ACCESSOR_SPARSE_INDICES,new I],[c.Z.ACCESSOR_SPARSE_VALUES,new I],[c.Z.ANIMATION,new I],[c.Z.ANIMATION_SAMPLER,new I],[c.Z.ANIMATION_CHANNEL,new I],[c.Z.ASSET,new I],[c.Z.BUFFER,new I],[c.Z.BUFFERVIEW,new I],[c.Z.CAMERA,new I],[c.Z.IMAGE,new I],[c.Z.MATERIAL,new I],[c.Z.MESH,new I],[c.Z.NODE,new I],[c.Z.NORMAL_TEXTURE_INFO,new I],[c.Z.OCCLUSION_TEXTURE_INFO,new I],[c.Z.PRIMITIVE,new I],[c.Z.SAMPLER,new I],[c.Z.SCENE,new I],[c.Z.SKIN,new I],[c.Z.TEXTURE,new I],[c.Z.TEXTURE_INFO,new I]]),this._elements=[]}static addExtension(e){N._extensionsRegistry.addExtension(e)}static getSemantics(){return this._semantics}static setSemantics(e){null!==e&&void 0!==e||(this._semantics=e)}static getRenderConfig(){return this._renderConfig}static getExtensionsRegistry(){return this._extensionsRegistry}async allocate(e,t=R.R.none){this.gl=e,this.depthPass=new A(e),this.depthPass.depthFormat.set("D_RGB");for(const s of this.textures)if(await s.allocateGl(e),t.aborted)throw new S._("Aborted");this.primitives.forEach((t=>t.allocateGl(e))),this.nodes.forEach((e=>e.allocateGl(this))),this.renderables=this.nodes.map((e=>e.renderable)).filter((e=>void 0!==e));for(const s of this.nodes)s._parent||this.root.add(s);this.createCameras()}createCameras(){this.cameraInstances=this.nodes.filter((e=>void 0!==e.camera)).map((e=>{const t=new r.Z(e.camera.lens);return e.add(t),t}))}get buffers(){return this._getCollection(c.Z.BUFFER).list}get bufferViews(){return this._getCollection(c.Z.BUFFERVIEW).list}get accessors(){return this._getCollection(c.Z.ACCESSOR).list}get animations(){return this._getCollection(c.Z.ANIMATION).list}get meshes(){return this._getCollection(c.Z.MESH).list}get nodes(){return this._getCollection(c.Z.NODE).list}get materials(){return this._getCollection(c.Z.MATERIAL).list}get cameras(){return this._getCollection(c.Z.CAMERA).list}get skins(){return this._getCollection(c.Z.SKIN).list}get primitives(){return this._getCollection(c.Z.PRIMITIVE).list}get textures(){return this._getCollection(c.Z.TEXTURE).list}get scenes(){return this._getCollection(c.Z.SCENE).list}getAllElements(){return this._elements}getElement(e,t){return this._getCollection(e).indexed[t]}getElementByName(e,t){const s=this._getCollection(e).list;for(const n of s)if(n.name===t)return n;return null}getElementsByName(e,t){const s=this._getCollection(e).list,n=[];for(const r of s)r.name===t&&n.push(r);return n}getNode(e){return this.getElementByName(c.Z.NODE,e)}getMesh(e){return this.getElementByName(c.Z.MESH,e)}getMaterial(e){return this.getElementByName(c.Z.MATERIAL,e)}getAnimation(e){return this.getElementByName(c.Z.ANIMATION,e)}getScene(e){return this.getElementByName(c.Z.SCENE,e)}_getCollection(e){return this._collections.get(e)}addElement(e,t=-1){const s=this._getCollection(e.gltftype);s.addElement(e,t),this._elements.push(e)}}N._extensionsRegistry=new n.Z,N._semantics=new o,N._renderConfig=l()},45950:function(e,t,s){"use strict";s.d(t,{ZP:function(){return m},s5:function(){return c}});var n=s(50434),r=s(75989),i=s(24352);const a=10497,o=33648;function c(e){return 256===(256&e)}function l(e){return e===a||e===o}function h(e){return 0!=e&&0===(e&e-1)}function u(e){return h(e)?e:(e%2===1&&e++,Math.pow(2,Math.round(Math.log(e)/Math.log(2))))}class m{constructor(){this.gltftype=r.Z.IMAGE}get hasAlpha(){return this.mimeType!==n.Z.ImageMimeType.JPEG}async parse(e,t){t.uri&&(this.uri=t.uri,0==this.uri.indexOf("data:")?this.resolvedUri=this.uri:this.resolvedUri=e.resolveUri(this.uri)),this.mimeType=t.mimeType,void 0!==t.bufferView&&(this.bufferView=await e.getElement(r.Z.BUFFERVIEW,t.bufferView)),await this.loadImage(e)}async loadImage(e){const t=await this.loadImageBlob(e.abortSignal);this.texImageSource=await e.gltfIO.loadImageBlob(t,e.abortSignal)}async loadImageBlob(e){if(this.bufferView){const e=new Uint8Array(this.bufferView.buffer._bytes,this.bufferView.getByteOffset(),this.bufferView.byteLength);return new Blob([e],{type:this.mimeType})}{const t=(0,i.mr)(e),s=await fetch(this.resolvedUri,{signal:t}),n=await s.blob();return n}}async setupTexture(e,t,s,n,r){const i=e.gl;let a=this.texImageSource;(l(t)||l(s)||c(n))&&(h(a.width)&&h(a.height)||(a=await this.resizeToPOT(a,i))),e.fromImage(this.texImageSource),c(n)&&i.generateMipmap(i.TEXTURE_2D),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,r),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,n),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,s)}async resizeToPOT(e,t){const s=document.createElement("canvas"),n=s.getContext("2d");if(s.width=u(e.width),s.height=u(e.height),e instanceof ImageData){const t=await createImageBitmap(e,0,0,s.width,s.height,{});n.drawImage(t,0,0,s.width,s.height)}else n.drawImage(e,0,0,s.width,s.height);return s}}},95893:function(e,t,s){"use strict";s.d(t,{Z:function(){return T},n:function(){return p}});var n=s(34686),r=s(8098),i=s(50434),a=s(75989),o=s(49500),c=s(18082),l=s(15415),h=s(96323),u=s(79e3),m=s(48752),d=s(36552);const E=770,g=771;class p{constructor(){this.gltftype=a.Z.MATERIAL}get materialPass(){return this._materialPass}createMaterialForPrimitive(e,t,s){const n=e.gl;this._materialPass.version.set((0,r.I)(n)?"300 es":"100");const i=new c.Z(n,this._materialPass.name);i.addPass(this._materialPass,"color");const a=s.attributes.getSemantic("NORMAL"),l=s.attributes.getSemantic("TANGENT");i.inputs.add(new h.Z("hasNormals",null!==a)),i.inputs.add(new h.Z("hasTangents",null!==l));const u=s.attributes.getSemantic("COLOR_0");if(null!==u){const e=new o.ZP("vertexColor",3);e.attachAttribute(u.glslname),i.inputs.add(e)}return i.addPass(e.depthPass,"depth"),i}async parse(e,t){var s,n;this.emissiveFactor=new Float32Array(t.emissiveFactor||[0,0,0]),this.alphaMode=t.alphaMode||i.Z.MaterialAlphaMode.OPAQUE,this.alphaCutoff=null!==(s=t.alphaCutoff)&&void 0!==s?s:.5,this.doubleSided=null!==(n=t.doubleSided)&&void 0!==n&&n,await this.parsePbrInputsData(e,t),void 0!==t.normalTexture&&(this.normalTexture=await e._loadElement(t.normalTexture)),void 0!==t.occlusionTexture&&(this.occlusionTexture=await e._loadElement(t.occlusionTexture)),void 0!==t.emissiveTexture&&(this.emissiveTexture=await e._loadElement(t.emissiveTexture)),this.name=t.name,this.setupMaterials()}async parsePbrInputsData(e,t){void 0!==t.pbrMetallicRoughness&&(this.pbrInputsData=this.pbrMetallicRoughness=new n.Z,await this.pbrMetallicRoughness.parse(e,t.pbrMetallicRoughness))}configurePbrSurface(e){void 0!==this.pbrInputsData?this.pbrInputsData.setupPass(e):e.setSurface(new d.ox)}configureAlpha(e){this.alphaMode===i.Z.MaterialAlphaMode.BLEND?(e.glconfig.depthMask(!1),e.glconfig.enableBlend(),e.glconfig.blendFunc(E,g),e.mask=l.Z.getRenderConfig().blendedMask):e.mask=l.Z.getRenderConfig().opaqueMask,e.alphaMode.set(this.alphaMode),this.alphaMode===i.Z.MaterialAlphaMode.MASK&&e.alphaCutoff.attachUniform("uAlphaCutoff").set(this.alphaCutoff)}}class T extends p{setupMaterials(){const e=new m.Fp(this.name);if(e.glconfig.enableDepthTest(),e.glconfig.enableCullface(!this.doubleSided),e.doubleSided.set(this.doubleSided),this.configureAlpha(e),this.configurePbrSurface(e),this.emissiveTexture){const t=this.emissiveTexture.createSampler("emissive");e.emissive.attach(t)}(0,u.D)(this.emissiveFactor)||e.emissiveFactor.attachUniform("uEmissFactor").set(...this.emissiveFactor);const t=this.normalTexture;if(t){const s=t.createSampler("nrmmap");e.normal.attach(s),1!==t.scale&&e.normalScale.attachUniform("uNormalScale").set(t.scale)}const s=this.occlusionTexture;if(s){const t=s.createSampler("occlu");e.occlusion.attach(t),1!==s.strength&&e.occlusionStrength.attachUniform("uOccluStrength").set(s.strength)}this._materialPass=e}}},34686:function(e,t,s){"use strict";s.d(t,{Z:function(){return o}});var n=s(79e3),r=s(49500),i=s(36552),a=s(65497);class o{async parse(e,t){var s,n;this.baseColorFactor=new Float32Array(t.baseColorFactor||[1,1,1,1]),this.metallicFactor=null!==(s=t.metallicFactor)&&void 0!==s?s:1,this.roughnessFactor=null!==(n=t.roughnessFactor)&&void 0!==n?n:1,void 0!==t.baseColorTexture&&(this.baseColorTexture=await e._loadElement(t.baseColorTexture)),void 0!==t.metallicRoughnessTexture&&(this.metallicRoughnessTexture=await e._loadElement(t.metallicRoughnessTexture))}setupPass(e){const t=new i.ox;if(e.setSurface(t),this.baseColorTexture){const s=this.baseColorTexture.createSampler("basecolor");s.colorspace=a.u.SRGB,t.baseColor.attach(s,"rgb"),e.alpha.attach(s,"a")}if(!(0,n.I)(this.baseColorFactor)){const s=new r.xW("uBasecolorFactor",4);s.set(...this.baseColorFactor),t.baseColorFactor.attach(s,"rgb"),e.alphaFactor.attach(s,"a")}if(this.metallicRoughnessTexture){const e=this.metallicRoughnessTexture.createSampler("metalRough");e.colorspace=a.u.LINEAR,t.metalness.attach(e,"b"),t.roughness.attach(e,"g")}1!==this.metallicFactor&&t.metalnessFactor.attachUniform("uMetalnessFactor").set(this.metallicFactor),1!==this.roughnessFactor&&t.roughnessFactor.attachUniform("uRoughnessFactor").set(this.roughnessFactor)}}},35183:function(e,t,s){"use strict";s.d(t,{Z:function(){return a}});var n=s(75989),r=s(65031);class i{constructor(){this.resolve=e=>{this._resolve(e)},this.reject=e=>{this._reject(e)},this.promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}}class a{constructor(){this.gltftype=n.Z.TEXTURE,this._glTextureDeferred=new i}get glTexturePromise(){return this._glTextureDeferred.promise}async parse(e,t){void 0!==t.sampler&&(this.sampler=await e.getElement(n.Z.SAMPLER,t.sampler)),void 0!==t.source&&(this.source=await e.getElement(n.Z.IMAGE,t.source)),this._defaultTextureFilter=e.defaultTextureFilter}async allocateGl(e){var t,s;let n=e.RGB;this.source.hasAlpha&&(n=e.RGBA);let i=this._defaultTextureFilter,a=e.LINEAR,o=e.REPEAT,c=e.REPEAT;this.sampler&&(i=null!==(t=this.sampler.minFilter)&&void 0!==t?t:i,a=null!==(s=this.sampler.magFilter)&&void 0!==s?s:e.LINEAR,o=this.sampler.wrapS,c=this.sampler.wrapT),this.glTexture=new r.Z(e,n,e.UNSIGNED_BYTE),await this.source.setupTexture(this.glTexture,o,c,i,a),this.glTexture.bind(),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,c),e.bindTexture(e.TEXTURE_2D,null),this._glTextureDeferred.resolve(this.glTexture)}}},25410:function(e,t,s){"use strict";s.d(t,{y:function(){return r}});var n=s(45338);class r{constructor(){this._map={},this._list=[]}addExtension(e){if(void 0!==this._map[e.name])throw new Error(`Extension ${e.name} already exits`);this._map[e.name]=e,this._list.push(e)}sort(){this._list.sort(((e,t)=>t.priority-e.priority))}validate(e=[],t=[]){for(const s of e)void 0===this._map[s]&&console.warn(`Missing used extension ${s}`);for(const s of t)if(void 0===this._map[s])throw new Error(`Missing required extension ${s}`)}}class i{constructor(){this._extensionFactories={}}addExtension(e){const t=e.name;n.Z.isUndefined(this._extensionFactories[t],`extension '${t}' already exist`),this._extensionFactories[t]=e}setupExtensions(e,t=[]){const s=e._extensions;for(const r in this._extensionFactories){const t=this._extensionFactories[r].createInstance(e);n.Z.isTrue(t.name===r),s.addExtension(t)}for(const n of t){const t=n.createInstance(e);s.addExtension(t)}s.sort()}}t["Z"]=i},79e3:function(e,t,s){"use strict";function n(e){for(let t=0;t<e.length;t++)if(1!==e[t])return!1;return!0}function r(e){for(let t=0;t<e.length;t++)if(0!==e[t])return!1;return!0}s.d(t,{D:function(){return r},I:function(){return n}})},45338:function(e,t){"use strict";function s(e){throw new Error(e)}const n={isDefined(e,t=""){void 0===e&&s(t)},isUndefined(e,t=""){void 0!==e&&s(t)},isTrue(e,t=""){!0!==e&&s(t)},isFalse(e,t=""){!1!==e&&s(t)}};t["Z"]=n},24352:function(e,t,s){"use strict";function n(e,t){return new Promise(((s,n)=>{t.addEventListener("abort",(e=>n(e))),e.then(s,n)}))}let r;s.d(t,{gI:function(){return n},mr:function(){return i}}),r="undefined"!==typeof window&&void 0!==window.AbortController?e=>{const t=new AbortController;return e.addEventListener("abort",(()=>t.abort())),t.signal}:e=>{};const i=r},50434:function(e,t){"use strict";var s;(function(e){let t,s,n,r,i,a,o,c,l,h,u;(function(e){e[e["BYTE"]=5120]="BYTE",e[e["UNSIGNED_BYTE"]=5121]="UNSIGNED_BYTE",e[e["SHORT"]=5122]="SHORT",e[e["UNSIGNED_SHORT"]=5123]="UNSIGNED_SHORT",e[e["UNSIGNED_INT"]=5125]="UNSIGNED_INT",e[e["FLOAT"]=5126]="FLOAT"})(t=e.AccessorComponentType||(e.AccessorComponentType={})),function(e){e["SCALAR"]="SCALAR",e["VEC2"]="VEC2",e["VEC3"]="VEC3",e["VEC4"]="VEC4",e["MAT2"]="MAT2",e["MAT3"]="MAT3",e["MAT4"]="MAT4"}(s=e.AccessorType||(e.AccessorType={})),function(e){e["TRANSLATION"]="translation",e["ROTATION"]="rotation",e["SCALE"]="scale",e["WEIGHTS"]="weights"}(n=e.AnimationChannelTargetPath||(e.AnimationChannelTargetPath={})),function(e){e["LINEAR"]="LINEAR",e["STEP"]="STEP",e["CUBICSPLINE"]="CUBICSPLINE"}(r=e.AnimationSamplerInterpolation||(e.AnimationSamplerInterpolation={})),function(e){e["PERSPECTIVE"]="perspective",e["ORTHOGRAPHIC"]="orthographic"}(i=e.CameraType||(e.CameraType={})),function(e){e["JPEG"]="image/jpeg",e["PNG"]="image/png"}(a=e.ImageMimeType||(e.ImageMimeType={})),function(e){e["OPAQUE"]="OPAQUE",e["MASK"]="MASK",e["BLEND"]="BLEND"}(o=e.MaterialAlphaMode||(e.MaterialAlphaMode={})),function(e){e[e["POINTS"]=0]="POINTS",e[e["LINES"]=1]="LINES",e[e["LINE_LOOP"]=2]="LINE_LOOP",e[e["LINE_STRIP"]=3]="LINE_STRIP",e[e["TRIANGLES"]=4]="TRIANGLES",e[e["TRIANGLE_STRIP"]=5]="TRIANGLE_STRIP",e[e["TRIANGLE_FAN"]=6]="TRIANGLE_FAN",e[e["DEFAULT"]=4]="DEFAULT"}(c=e.MeshPrimitiveMode||(e.MeshPrimitiveMode={})),function(e){e[e["NEAREST"]=9728]="NEAREST",e[e["LINEAR"]=9729]="LINEAR"}(l=e.TextureMagFilter||(e.TextureMagFilter={})),function(e){e[e["NEAREST"]=9728]="NEAREST",e[e["LINEAR"]=9729]="LINEAR",e[e["NEAREST_MIPMAP_NEAREST"]=9984]="NEAREST_MIPMAP_NEAREST",e[e["LINEAR_MIPMAP_NEAREST"]=9985]="LINEAR_MIPMAP_NEAREST",e[e["NEAREST_MIPMAP_LINEAR"]=9986]="NEAREST_MIPMAP_LINEAR",e[e["LINEAR_MIPMAP_LINEAR"]=9987]="LINEAR_MIPMAP_LINEAR"}(h=e.TextureMinFilter||(e.TextureMinFilter={})),function(e){e[e["CLAMP_TO_EDGE"]=33071]="CLAMP_TO_EDGE",e[e["MIRRORED_REPEAT"]=33648]="MIRRORED_REPEAT",e[e["REPEAT"]=10497]="REPEAT"}(u=e.TextureWrapMode||(e.TextureWrapMode={}))})(s||(s={})),t["Z"]=s},75989:function(e,t){"use strict";var s;(function(e){e["ACCESSOR"]="accessors",e["ACCESSOR_SPARSE"]="sparse",e["ACCESSOR_SPARSE_INDICES"]="sparseIndices",e["ACCESSOR_SPARSE_VALUES"]="sparseValues",e["ANIMATION"]="animations",e["ANIMATION_SAMPLER"]="animationSamplers",e["ANIMATION_CHANNEL"]="animationChannels",e["ASSET"]="asset",e["BUFFER"]="buffers",e["BUFFERVIEW"]="bufferViews",e["CAMERA"]="cameras",e["IMAGE"]="images",e["MATERIAL"]="materials",e["MESH"]="meshes",e["NODE"]="nodes",e["NORMAL_TEXTURE_INFO"]="normalTextureInfo",e["OCCLUSION_TEXTURE_INFO"]="occlusionTextureInfo",e["PRIMITIVE"]="primitives",e["SAMPLER"]="samplers",e["SCENE"]="scenes",e["SKIN"]="skins",e["TEXTURE"]="textures",e["TEXTURE_INFO"]="textureInfo"})(s||(s={})),t["Z"]=s},18082:function(e,t,s){"use strict";s.d(t,{Z:function(){return p}});var n=s(81952),r=s(80629),i=s(29845),a=s(82874);const o="#pragma SLOT",c=/^\s*#pragma SLOT\s\w+\s*$/gm;function l(e){return new RegExp(`${o}\\s+${e}\\s+`,"g")}function h(e,t){for(const{code:s,key:n}of t.slots)e=e.replace(l(n),s);return c.lastIndex=0,e=e.replace(c,""),e}class u{constructor(e){this.gl=e,this._cache={}}static getCache(e){const t=e;return void 0===t._prgcache&&(t._prgcache=new u(e)),t._prgcache}compile(e){const t=(0,a.Wu)(e.shaderSource.uid,e.slots.getHash()),s=this._cache[t];if(void 0!==s)return s;const n=h(e.shaderSource.vert,e.slots),r=h(e.shaderSource.frag,e.slots),o=new i.Z(this.gl,n,r);return this._cache[t]=o,o}release(e){}}var m=u,d=s(37362);class E{constructor(e,t){this._chunkCollections=[],this._program=null,this._revision=0,this._shaderSource=t,this._prgCache=m.getCache(e)}addChunkCollection(e){this._chunkCollections.push(e)}getSourceRevision(){let e=0;for(const t of this._chunkCollections)e+=t.getRevision();return e}setupProgram(){const e=this.getProgram();e.use();for(const t of this._chunkCollections)t.setupProgram(e);return e}getProgram(){const e=this.getSourceRevision();return null!==this._program&&this._revision===e||(this.compile(),this._revision=e),this._program}compile(){const e=this._prgCache;null!==this._program&&e.release(this._program);const t=new d.Z;for(const n of this._chunkCollections)n.getCode(t);const s={shaderSource:this._shaderSource,slots:t};this._program=e.compile(s)}}class g{constructor(e,t){this._program=null,this.programSource=new E(e.gl,t._shaderSource),this.programSource.addChunkCollection(e.inputs),this.programSource.addChunkCollection(t.inputs),this.pass=t,this.material=e}prepare(e,t){const s=this.programSource.setupProgram();return this.pass.prepare(s,e,t),s}getProgram(){return this.programSource.getProgram()}}class p{constructor(e,t=""){this.mask=-1,this.gl=e,this.name=t,this.glconfig=new n.ZP,this.inputs=new r.Z,this._passMap=new Map,this._passes=[]}addPass(e,t="color"){this._passMap.has(t)&&this.removePass(t);const s=new g(this,e);return this._passMap.set(t,s),this._passes.push(s),s}removePass(e){if(this._passMap.has(e)){const t=this.getPass(e);this._passes.splice(this._passes.indexOf(t),1),this._passMap.delete(e)}}getPass(e="color"){return this._passMap.get(e)}hasPass(e){return this._passMap.has(e)}getAllPasses(){return this._passes}getProgram(e){const t=this.getPass(e);return null===t||void 0===t?void 0:t.getProgram()}}}}]);
//# sourceMappingURL=8215.2d009137.js.map