"use strict";(self["webpackChunkgl_starter"]=self["webpackChunkgl_starter"]||[]).push([[2829],{79785:function(t,e,i){var s=i(76670),a=i(42307);class r extends a.Z{constructor(){super(),this._type=s.Z.POINT,this._radius=0,this.radius=50}set castShadows(t){}get radius(){return this._radius}set radius(t){this._radius=t}projectionFromBounds(t){throw new Error("Shadow mapping not supported on point lights")}_createCamera(){throw new Error("Shadow mapping not supported on point lights")}getTexelBiasVector(){throw new Error("Shadow mapping not supported on point lights")}}e["Z"]=r},42686:function(t,e,i){i.d(e,{CJ:function(){return s},HE:function(){return a},nF:function(){return r}});const s=[.423,.337,.47,.58],a=[.423,.36,.501,.48],r=[.043,.156,.317,.38]},62829:function(t,e,i){i.r(e),i.d(e,{default:function(){return st}});var s=i(62642),a=i(61221),r=i(63887),o=i(31148),n=i(14888),h=i(75989),c=i(63132),l=i(5434),d=i(21370),u=i(89620),p=i(55929),m=i(5839);const f=r.vec3.create(),v=r.vec3.create(),g=[0,56/60],_=[.95,1.95],w=9;class y{constructor(t,e,i,s,o,h=r.vec3.create()){this.renderer=e,this.hasTrail=o,this.trailColor=h,this.jumpFactor=0,this.xAddRandom=0,this.yAddRandom=0,this.barrelRandom=0,this.forwardOffset=0,this.craneStartPosition=r.vec3.create(),this.trailStartPosition=r.vec3.create(),this.roll={value:0},this.yNode={value:0},this.xNode={value:0},this.zNode={value:0},this.destPoint=r.vec3.create(),this.vel=r.vec3.create(),this.vChange=0,this.uChange=0,this.moveSphere=.05+.05*Math.random(),this.scaleSphere=10+2*(2*Math.random()-1),this.rotX=0,this.targetRotX=0,this.craneQuat=r.quat.create(),this.craneStartQuat=r.quat.create(),this.rollQuat=r.quat.create(),this.rollQuatLerp=r.quat.create(),this.pitchQuat=r.quat.create(),this.pitchQuatLerp=r.quat.create(),this.speed=1,this.animTime=Math.random(),this.cTexAddChunk=new p.Z(e),this.cTexAddChunk.textureOpacityU.set(.6),this.cTexAddChunk.textureRepeatU.set(.1),this.cTexAddChunk.textureLuminosityU.set(1);const c=new n.Z;c.overridePass("",((t,e)=>{const s=e.getPass("color").pass;return e.getPass("color").pass.inputs.add(i),s.mask=m.Z.OPAQUE,s.glconfig.enableBlend(!1).enableCullface(!1).depthMask(!0),s.surface.metalnessFactor.attachConstant(.75),s.surface.roughnessFactor.attachConstant(1),null})),this.res=new a.ZP(t,e.gl,{defaultTextureFilter:e.gl.LINEAR_MIPMAP_LINEAR,extensions:[c]})}async load(){return this.res.load()}onLoaded(){this.gltf=this.res.gltf,this.gltf.root.invalidate(),this.gltf.root.updateWorldMatrix(),this.craneNodePosition=r.vec3.create(),this.craneNode=new o.Z;const t=new o.Z;t.setScale(.06),t.rotateY(Math.PI/2),t.add(this.gltf.getElementByName(h.Z.NODE,"root")),this.craneNode.add(t),this.gltf.root.add(this.craneNode),r.vec3.copy(this.craneNodePosition,this.craneNode.position),this.trailNode=this.gltf.getElementByName(h.Z.NODE,"Feather.Top.Tail.002_end"),this.trailNodeLeft=this.gltf.getElementByName(h.Z.NODE,"Arm.003.l_end"),this.trailNodeRight=this.gltf.getElementByName(h.Z.NODE,"Arm.003.r_end"),r.vec3.copy(this.craneStartPosition,this.craneNode.position),r.vec3.copy(this.destPoint,this.craneNode.position),r.vec3.copy(this.trailStartPosition,this.trailNode.position),r.quat.copy(this.craneQuat,this.craneNode.rotation),r.quat.copy(this.craneStartQuat,this.craneNode.rotation),this.trailNodeX=0,r.vec3.set(this.vel,1,0,0),this.u=Math.random(),this.v=Math.random(),this.animationMixer=new u.Z;const e=this.gltf.animations[0];this.flyAnimation=new u.x(e),this.accelAnimation=new u.x(e),this.flyAnimation.range=g,this.accelAnimation.range=_,this.animationMixer.addLayer(this.flyAnimation),this.animationMixer.addLayer(this.accelAnimation)}start(){this.barrelRoll=new l.Z(this.roll,this.sheetPerfect,`barrel roll ${this.id}`),this.xAdd=new l.Z(this.xNode,this.sheetPerfect,`x add ${this.id}`),this.yAdd=new l.Z(this.yNode,this.sheetPerfect,`y add ${this.id}`),this.zAdd=new l.Z(this.zNode,this.sheetPerfect,`z add ${this.id}`),this.createTrails(),this.renderer.scene.trailManager.renderAbove=!0}stop(){this.barrelRoll.dispose(),this.yAdd.dispose(),this.xAdd.dispose(),this.zAdd.dispose(),this.renderer.scene.trailManager.removeAll(),this.renderer.scene.trailManager.renderAbove=!1}createTrails(){this.trails=[],this.hasTrail&&(this.trails.push(this.renderer.scene.trailManager.addTrail(this.trailNode,{color:[1,1,1],trailDistance:0,offset:[0,0,0],thickness:.8,drawImageFrameElapsed:1,mixBorder:1})),this.trails.push(this.renderer.scene.trailManager.addTrail(this.trailNodeLeft,{color:[1,1,1],trailDistance:0,offset:[1,1,0],thickness:.8,drawImageFrameElapsed:1,mixBorder:1})),this.trails.push(this.renderer.scene.trailManager.addTrail(this.trailNodeRight,{color:[1,1,1],trailDistance:0,offset:[1,1,0],thickness:.8,drawImageFrameElapsed:1,mixBorder:1})))}setupLighting(t){const e=[],i=this.gltf.renderables;for(const s of i)for(const t of s.materials)-1===e.indexOf(t)&&e.push(t);for(const s of e)t.setupMaterial(s)}release(t=1,e=!1){this.jumpFactor=t;const i=Math.random(),s=(Math.random()>.5?1:-1)*Math.ceil(1.2*i*Math.max(this.jumpFactor,.4));this.barrelRandom=s*(2*Math.PI),i<.1&&(this.barrelRandom=0),this.xAddRandom=-Math.random()*this.jumpFactor*15,this.yAddRandom=(2*Math.random()-1)*this.jumpFactor*15,t>.95&&(this.barrelRandom=(e?-1:1)*(2*Math.PI),this.xAddRandom=0,this.yAddRandom=0)}updateAnimation(){const t=(0,c.CW)(w-.5,w,this.speed)*(0,c.CW)(.1,.3,this.v)*(1-Math.abs(this.xNode.value));this.flyAnimation.weight=1-t,this.accelAnimation.weight=t;const e=this.animTime;this.flyAnimation.time=e,this.accelAnimation.time=e,this.animationMixer.evaluate()}preRender(){const t=this.gltf.animations[0];this.animTime+=d.Z.scaledDt/1e3*(0,c.uZ)(.2*this.speed,1,2),t.evaluate(this.animTime%t.duration),this.cTexAddChunk.timeU.set(d.Z.time),this.updateAnimation(),this.movePointOnSphere(f,this.u,this.v),this.v=.5*(Math.sin(this.vChange)+1),this.u=.5*(Math.sin(this.uChange)+1),this.vChange+=(.01+.05*Math.random())*(this.moveSphere+.05*(0,c.CW)(6.5,7,this.speed))*Math.min(3,this.speed),this.uChange+=(.01+.05*Math.random())*(this.moveSphere+.05*(0,c.CW)(6.5,7,this.speed))*Math.min(3,this.speed),r.vec3.scale(f,f,this.scaleSphere),f[1]+=this.yNode.value*this.yAddRandom,f[2]+=this.xNode.value*this.xAddRandom,f[0]+=60*this.zNode.value*(1-this.jumpFactor),r.vec3.add(v,this.craneStartPosition,f),r.vec3.copy(this.destPoint,v),r.vec3.copy(v,this.craneNodePosition),r.vec3.lerp(this.craneNodePosition,this.craneNodePosition,this.destPoint,.1),this.trailNodeX-=.05+.15*this.speed;const e=v[2]-this.craneNodePosition[2],i=(0,c.uZ)(-e*Math.PI/180*400,-.6,.6);r.quat.identity(this.rollQuat),r.quat.rotateX(this.rollQuat,this.rollQuat,i),r.quat.slerp(this.rollQuatLerp,this.rollQuatLerp,this.rollQuat,.1);const s=v[1]-this.craneNodePosition[1],a=(0,c.uZ)(-s*Math.PI/180*50,-.15,.15);r.quat.identity(this.pitchQuat),r.quat.rotateZ(this.pitchQuat,this.pitchQuat,a),r.quat.slerp(this.pitchQuatLerp,this.pitchQuatLerp,this.pitchQuat,.1),r.quat.copy(this.craneQuat,this.craneStartQuat),r.quat.rotateX(this.craneQuat,this.craneQuat,this.roll.value*this.barrelRandom),r.quat.mul(this.craneQuat,this.craneQuat,this.pitchQuatLerp),r.quat.mul(this.craneQuat,this.craneQuat,this.rollQuatLerp)}movePointOnSphere(t,e,i){const s=2*Math.PI*e,a=Math.acos(2*i-1);t[0]=Math.sin(a)*Math.cos(s),t[1]=Math.sin(a)*Math.sin(s),t[2]=Math.cos(a)}render(t){r.vec3.copy(this.craneNode.position,this.craneNodePosition),r.quat.copy(this.craneNode.rotation,this.craneQuat),0!==this.id&&(this.craneNode.position[1]+=this.id%2===0?10:-10),this.craneNode.invalidate(),this.craneNode.updateWorldMatrix(),this.gltf.root.invalidate(),this.gltf.root.updateWorldMatrix();const e=(0,c.CW)(w-2.5,w,this.speed),i=(0,c.CW)(6.5,7.5,this.speed);for(const s of this.trails)s.trailChunk.alphaU.set(.25*i+.5*e),s.trailChunk.thicknessU.set(1+1*e),s.trailChunk.colorU.set(this.trailColor[0],this.trailColor[1],this.trailColor[2]);for(const s of this.gltf.renderables)s.render(this.renderer.gl,t.camera,t.mask,t.pass,t.glConfig)}}var b=i(79763),x=i(49500),k=i(1517);class C extends b.Z{constructor(t,e){super(!0,!1),this.cloudScroll=Math.random(),this.offsetX=0,this.offsetTexture=-.8,this.cloudScroll=Math.random(),this.addChild(this.speed=new x.ZP("uSpeed",1,x.Ho.ALL)),this.addChild(this.opacity=new x.ZP("uOpacity",1,x.Ho.FRAGMENT)),this.addChild(this.speedScale=new x.ZP("uSpeedScale",1,x.Ho.ALL)),this.addChild(this.noiseInput=new x.ZP("noise",4,x.Ho.FRAGMENT)),this.opacityU=this.opacity.attachUniform(),this.speedU=this.speed.attachUniform(),this.speedU.set(this.cloudScroll),this.speedScaleU=this.speedScale.attachUniform(),this.speedScaleU.set(1);const i=k.ZP.create("aTexCoord0");this.noiseInput.attachSampler("noisecolor",i).set(e),this.transformedCode=t.getPass("color").pass.surface.baseColor.param.texCoords.getTransformCode(),this.offsetTexture+=.4*(2*Math.random()-1),this.transformedCode=this.transformedCode.split("aTexCoord0").join(`aTexCoord0 * vec2(2.44, 1.0) * vec2(mix(1., 0.05, uSpeedScale()), 1.) + vec2(${this.offsetTexture} + uSpeed(), 0.)`),this.speedRatio=(225e-6+25e-6*Math.random())*(.2+.05*(2*Math.random()-1))}_genCode(t){t.add("pv","\n      OUT vec2 vTexCoordCopy;\n    "),t.add("postv",`\n    vTexCoordCopy = aTexCoord0;\n      ${this.transformedCode}\n    `),t.add("pf","\n      IN vec2 vTexCoordCopy;\n    "),t.add("postf","\n      vec3 noise = texture2D(noisecolor, baseColor_texCoord() * 2. + vec2(uSpeed(), 0.0)).rgb;\n      // float a = FragColor.a;\n      FragColor.a *= floor(noise.r + 0.5) + floor(noise.g + 0.3);\n      FragColor.a += noise.b * 0.2;\n      float s = vTexCoordCopy.x;\n      float alpha = smoothstep(0.2 + (noise.g - 0.5) * 0.2, 0.5 - (noise.b - 0.5) * 0.2, s + vTexCoordCopy.y * (noise.r - 0.5) * 0.3);\n      FragColor.a *= alpha * uOpacity();\n      // FragColor.a = a;\n      FragColor.a = clamp(FragColor.a, 0., 1.);\n      // FragColor.rgb = vec3(vTexCoordCopy.x, alpha, 0.);\n    ")}}class T{constructor(t,e,i,s){this.renderer=e,this.speed=1,this.cloudsOpacity=1;const r=new n.Z;this._cloudsChunks=[],this._startScales=[],r.overridePass("",((t,e)=>{const s=new C(e,this._noiseTex),a=e.getPass("color").pass;return a.inputs.add(s),this._cloudsChunks.push(s),a.inputs.add(i),a.glconfig.depthMask(!0),null})),this.res=new a.ZP(t,e.gl,{defaultTextureFilter:e.gl.LINEAR_MIPMAP_LINEAR,extensions:[r]}),this._noiseTex=e.scene.texturePool.get("fractalNoise").texture}async load(){return this.res.load()}onLoaded(){this.gltf=this.res.gltf,this.gltf.root.invalidate(),this.gltf.root.updateWorldMatrix();for(const t of this.gltf.renderables){const e=r.vec3.create();r.vec3.copy(e,t.node.scale),this._startScales.push(e)}}setupLighting(t){const e=[],i=this.gltf.renderables;for(const s of i)for(const t of s.materials)-1===e.indexOf(t)&&e.push(t);for(const s of e)t.setupMaterial(s)}preRender(){for(const t of this._cloudsChunks)t.cloudScroll-=d.Z.scaledDt*t.speedRatio*Math.max(1.5,this.speed),t.opacityU.set(this.cloudsOpacity),t.speedScaleU.set((0,c.CW)(2,9,this.speed))}render(t){for(const e of this._cloudsChunks)e.speedU.set(e.cloudScroll);for(const[e,i]of this.gltf.renderables.entries())r.vec3.copy(i.node.scale,this._startScales[e]),i.node.scale[1]=this._startScales[e][1]*this.speed,i.node.invalidate();for(const e of this.gltf.renderables)e.render(this.renderer.gl,t.camera,t.mask,t.pass,t.glConfig)}}var P=i(61987),S=i(88271),M=i(79785);class O{constructor(t){this.renderer=t,this.pointLightColor={r:.9449,g:.9202,b:.5788},this.moveSmoothing=.0025,this.initialPositionSpot=r.vec3.create(),this.power=1695,this.node=new P.Z,this.point=new M.Z,this.point.radius=423}start(t){this.lighting=t,t.lightSetup.add(this.point),r.vec3.set(this.point.position,-3.91,5.87,-1.09),this.initialPositionSpot=r.vec3.clone(this.point.position),this.point._color.set([this.pointLightColor.r*this.power,this.pointLightColor.g*this.power,this.pointLightColor.b*this.power]),this.node.add(this.point),this.point.invalidate(),this.point.updateWorldMatrix()}stop(){this.lighting.lightSetup.remove(this.point),this.node.remove(this.point)}preRender(t,e){r.vec3.copy(this.point.position,t),this.point.position[1]+=20,this.point.position[0]+=10;const i=this.power+1e3*e;this.point._color.set([this.pointLightColor.r*i,this.pointLightColor.g*i,this.pointLightColor.b*i]),this.point.invalidate(),this.point.updateWorldMatrix()}}var A=i(76881),Z=i(18158),N=i(94292),V=i(31236);const L=4,R=-100,I=100;class F{constructor(t,e,i){this.renderer=t,this.count=e,this.color=i,this.time=0,this.maxDistX=1,this.boundsSize=r.vec3.create(),this.worldScroll=0,this.speedProgress=1,this.prg=(0,V["default"])(t.gl).get("clouds-particles"),this.vbuffer=new Z.Z(t.gl),this.vbuffer.attrib("aPosition",3,t.gl.FLOAT).attrib("aSettings",1,t.gl.FLOAT),this.vbuffer.attribPointer(this.prg),this.cfg=N.Z.get(t.gl).config(),this.cfg.enableDepthTest(!0).depthMask(!1).enableBlend(!0).blendFunc(t.gl.SRC_ALPHA,t.gl.ONE),this.node=new P.Z}start(){this.time=0,this.worldScroll=0,this.bounds=new A.Z,this.varray=new Float32Array(this.count*L),this.vbuffer.data(this.varray),this.addParticles()}stop(){this.varray=new Float32Array(this.count*L),this.vbuffer.data(this.varray)}addParticles(){for(let t=0;t<this.count;t++){const e=[];e[0]=R+Math.random()*(I-R),e[1]=40*Math.random()-20,e[2]=40*Math.random()-20,e[3]=.66*Math.random()+.33,this.varray.set(e,t*L)}this.vbuffer.data(this.varray)}preRender(t){this.speedProgress=t,this.time+=.02*d.Z.dt*(1+t),this.node.updateWorldMatrix()}render(t){this.prg.use(),this.prg.uVP(t.camera._viewProj),this.prg.uWorldMatrix(this.node._wmatrix),this.prg.uColor(this.color),this.prg.uTime(this.time),this.prg.uMaxSize(75+50*this.speedProgress),this.prg.uMinX(R),this.prg.uMaxX(I),this.cfg.apply(),this.vbuffer.attribPointer(this.prg),this.vbuffer.drawPoints()}}const U=[["ui_reaction_kaizen_yeah_c"],["ui_reaction_kaizen_wow_a","ui_reaction_kaizen_wow_c"],["ui_reaction_kaizen_laugh-d","ui_reaction_kaizen_laugh_a","ui_reaction_kaizen_laugh_b","ui_reaction_kaizen_laugh_c"],["ui_reaction_kaizen_love-it_c"],["ui_reaction_kaizen_brilliant_a","ui_reaction_kaizen_brilliant_b","ui_reaction_kaizen_brilliant_c"],["ui_reaction_kaizen_can-t_believe-it_a","ui_reaction_kaizen_can-t_believe-it_b","ui_reaction_kaizen_can-t_believe-it_c"],["ui_reaction_kaizen_cool_a","ui_reaction_kaizen_cool_b","ui_reaction_kaizen_cool_c"],["ui_reaction_kaizen_excited_a","ui_reaction_kaizen_excited_b","ui_reaction_kaizen_excited_c"],["ui_reaction_kaizen_hooray_b"],["ui_reaction_kaizen_yeah_a"],["ui_reaction_kaizen_yeah_a"],["ui_reaction_kaizen_yeah_a"],["ui_reaction_kaizen_wow_a"],["ui_reaction_kaizen_wow_a"],["ui_reaction_kaizen_wow_a"],["ui_reaction_kaizen_wow_a"],["ui_reaction_kaizen_wow_a"],["ui_reaction_kaizen_wow_a"],["ui_reaction_kaizen_wow_a"],["ui_reaction_kaizen_wow_a"],["ui_reaction_kaizen_wow_a"],["ui_reaction_kaizen_wow_b","ui_reaction_kaizen_wow_c"],["ui_reaction_kaizen_wow_b","ui_reaction_kaizen_wow_c"],["ui_reaction_kaizen_wow_b","ui_reaction_kaizen_wow_c"],["ui_reaction_kaizen_woah_c"],["ui_reaction_kaizen_woah_c"]];var z=i(97703),E=i(50509),q=i(39650),D=i(25409),Q=i(62551),H=i(17052),B=i(38677),X=i(68872),W=i(40549),j=i(42686);const G=r.vec3.create();r.vec3.set(G,.02,.03,.06);const Y=r.vec3.fromValues(20,60,200),$=r.vec3.fromValues(-80,10,0),J=r.vec3.create(),K=1.21,tt=.97,et=1.49,it=.75;class st extends W.ZP{constructor(t,e){super(t,e),this._cranes=[],this.stepValues=[.01,.40625,.71875,1],this.cameraTargetX=0,this.cameraTargetY=0,this.cameraSwitchIntro={value:0},this.speed={value:1,startV:0},this.cameraSwitch={value:0,startV:0},this.cameraFov={value:0,startV:0},this.ambientAdd={value:.1,startV:0},this.vignetteB={value:0,startV:0},this.chroma={value:0,startV:0},this.sat={value:0,startV:0},this.cloudOpacity={value:0,startV:0},this.cranesOffset1={value:1,startV:1},this.cranesOffset2={value:1,startV:1},this.contrastValue={value:0},this.downHillV={value:0},this.introLookAt=new P.Z,this.startRelease=0,this.quatcamx=r.quat.create(),this.quatcamy=r.quat.create(),this._startHFov=0,this.camShakeV=r.vec3.create(),this.saveTexturePass={textureRepeat:0,textureOpacity:0,textureLuminosity:0,backgroundInfluence:0},this.sceneId=4,this.changeState=async t=>{this.isIntroPlaying||this.previousState!==(0,E.toStatePaths)(t.value)[0].join(".")&&(this.previousState=(0,E.toStatePaths)(t.value)[0].join("."),t.matches("scene.interacting.perfect")&&this.release(),this.checkOutro(t))},this.stepValues=Q.L5,this.tileTexChunk=new p.Z(this.renderer),this.sheetPerfect=z["default"].state.machine.context.theatreProject.project.sheet("scene4-perfect-small"),this._ambientChunk=new H.Z,this._ambientChunk.ambientAddUniform.set(this.ambientAdd.value),this._vortex=new T("scene4/clouds_01.gltf",this.renderer,this._ambientChunk,this.tileTexChunk),this._vortex2=new T("scene4/clouds_02.gltf",this.renderer,this._ambientChunk,this.tileTexChunk),this._particles=new F(this.renderer,50,r.vec3.fromValues(.8,.3,.3)),this._cranes=[];for(let i=0;i<5;i++){const t=new y(0===i?"scene4/crane.gltf":"scene4/crane_2.gltf",this.renderer,this._ambientChunk,this.tileTexChunk,i<3,0===i?r.vec3.fromValues(1,.82,1):r.vec3.fromValues(.88,.71,.88));t.id=i,t.forwardOffset=0===i?0:Math.ceil(.5*i)*(i%2===0?-1:1),this._cranes.push(t)}this._root=new P.Z,this.background=new B.Z(this.renderer,B.E.LINEAR_3_STOPS),this.background.setUseClampedMix(!0)}async load(){this._lights=new O(this.renderer),await Promise.all([this._vortex.load(),this._vortex2.load(),this.background.load(),...this._cranes.map((t=>t.load()))]),this.onLoaded()}onLoaded(){for(const t of this._cranes)t.onLoaded(),t.sheetPerfect=this.sheetPerfect;this._vortex.onLoaded(),this._vortex2.onLoaded(),this.background.onLoaded(),this.background.sheetOutro=this.sheetOutro,this.background.sheetSuccess=this.sheetSuccess,this.background.sheetDownhill=this.sheetDownhill,super.onLoaded()}setupLighting(){for(const t of this._cranes)t.setupLighting(this.renderer.scene.lighting)}start(){var t;if(super.start(),this._startHFov=this.renderer.camera.lens._hfov,D["default"].fadeIn(D.SCENE_AUDIO_AMBIENT_ID[this.id-1],it,3),D["default"].fadeIn(D.SCENE_AUDIO_AMBIENT_LAYER_ID[this.id-1],it-.15,3),this.waitingStart)return;z["default"].glapp.quality.level.isVignetteBlur&&this.renderer.postprocess.post.add(this.renderer.postprocess.vignetteblur),this.renderer.postprocess.post.add(this.renderer.postprocess.frame);const e=this.renderer.postprocess.contrast;this.savecontrast=e.contrast,this.savebrightness=e.brightness,this.savebias=e.bias,this._root.add(this.renderer.scene.lighting.root),this._root.add(this._lights.node),this._lights.start(this.renderer.scene.lighting),this.renderer.clearColor.set([1,1,1,1]),this.renderer.cameras.use("main");const i=this.renderer.camera;i._parent&&i._parent.remove(i);for(const s of this._cranes)this._root.add(s.gltf.root);this._root.add(this._vortex.gltf.root),this._root.add(this._vortex2.gltf.root),this._root.add(this.background.gltf.root),this._root.add(this._particles.node),this._root.add(this.introLookAt),this._root.add(i),r.vec3.copy(i.position,Q.Io),r.vec3.copy(this.cameraInitialPosition,Q.z8),this.cameraFov.value=i.lens.fov,this.cameraSwitchTheatre=new l.Z(this.cameraSwitch,this.sheetSuccess,"cameraSwitch"),this.speedTheatre=new l.Z(this.speed,this.sheetSuccess,"speed"),this.cameraFovTheatre=new l.Z(this.cameraFov,this.sheetSuccess,"cameraFov"),this.ambientAddTheatre=new l.Z(this.ambientAdd,this.sheetSuccess,"ambient"),this.chromaTheatre=new l.Z(this.chroma,this.sheetSuccess,"chromatic aberation"),this.satTheatre=new l.Z(this.sat,this.sheetPerfect,"saturation boom"),this.vignetteBlurTheatre=new l.Z(this.vignetteB,this.sheetSuccess,"vignette blur"),this.opacityExtCloudsTheatre=new l.Z(this.cloudOpacity,this.sheetSuccess,"clouds opacity"),this.cranesOffset1Theatre=new l.Z(this.cranesOffset1,this.sheetSuccess,"Cranes / Group 1 Offset"),this.cranesOffset2Theatre=new l.Z(this.cranesOffset2,this.sheetSuccess,"Cranes / Group 2 Offset"),this.contrastTheatreIntro=new l.Z(this.contrastValue,this.sheetIntro,"contrast"),this.contrastTheatreOutro=new l.Z(this.contrastValue,this.sheetOutro,"contrast"),this.downHill=new l.Z(this.downHillV,this.sheetDownhill,"downhill"),this.outrocameraSwitchTheatre=new l.Z(this.cameraSwitchIntro,this.sheetOutro,"switch camera"),this.introcameraSwitchTheatre=new l.Z(this.cameraSwitchIntro,this.sheetIntro,"switch camera"),this.cameraSwitch.startV=this.cameraSwitch.value,this.speed.startV=this.speed.value,this.cameraFov.startV=this.cameraFov.value,this.ambientAdd.startV=this.ambientAdd.value,this.chroma.startV=this.chroma.value,this.vignetteB.startV=this.vignetteB.value,this.cloudOpacity.startV=this.cloudOpacity.value,this.cranesOffset1.startV=this.cranesOffset1.value,this.cranesOffset2.startV=this.cranesOffset2.value,r.vec3.copy(this._lights.point.position,null===(t=this._cranes[0])||void 0===t?void 0:t.craneNode.position),this._lights.point.y+=30,i.invalidate(),i.updateWorldMatrix(),this.background.start(),this.background.topColor=r.vec4.fromValues(...Q.XA,Q.aD),this.background.middleColor=r.vec4.fromValues(...Q.XL,Q.pc),this.background.bottomColor=r.vec4.fromValues(...Q.TC,Q.dM),this.background.setTransitionColors(r.vec4.fromValues(...Q.nA,Q.im),r.vec4.fromValues(...Q.TS,Q.uf),r.vec4.fromValues(...Q.Sq,Q.cx)),this.background.setOutroColors(r.vec4.fromValues(...j.CJ),r.vec4.fromValues(...j.HE),r.vec4.fromValues(...j.nF)),this.background.setUseClampedMix(!0),B.Z.transition.value=0;for(const s of this._cranes)s.start();this._particles.start()}stop(){super.stop(),this.renderer.postprocess.post.remove(this.renderer.postprocess.vignetteblur),this.renderer.postprocess.post.remove(this.renderer.postprocess.frame),this._lights.stop(),this._root.remove(this.renderer.scene.lighting.root),this._root.remove(this._lights.node),this._root.remove(this._vortex.gltf.root),this._root.remove(this._vortex2.gltf.root),this._root.remove(this.background.gltf.root),this._root.remove(this._particles.node),this._root.remove(this.introLookAt),this._root.remove(this.renderer.camera);for(const t of this._cranes)this._root.remove(t.gltf.root),t.stop();this._particles.stop(),this.cameraFovTheatre.dispose(),this.speedTheatre.dispose(),this.cameraSwitchTheatre.dispose(),this.chromaTheatre.dispose(),this.vignetteBlurTheatre.dispose(),this.ambientAddTheatre.dispose(),this.opacityExtCloudsTheatre.dispose(),this.satTheatre.dispose(),this.cranesOffset1Theatre.dispose(),this.cranesOffset2Theatre.dispose(),this.contrastTheatreIntro.dispose(),this.contrastTheatreOutro.dispose(),this.downHill.dispose(),this.introcameraSwitchTheatre.dispose(),this.background.stop(),this.outrocameraSwitchTheatre.dispose()}async release(){if(this.isIntroPlaying||this.renderer.scene.blockRelease)return;window.clearTimeout(this.unblockReleaseTO),window.clearTimeout(this.unblockDownReleaseTO),this.renderer.scene.blockRelease=!0,this.cameraShake(this.renderer.camera,.5,2.5*this.holdingPercent),this.startRelease=this.renderer.scene.hold;for(const[s,a]of this._cranes.entries())a.release(this.holdingPercent,0!==s);this.jumpCounter++,D["default"].stopHold(this.id);const t=this.holdingPercent<Q.L5[1]?0:this.holdingPercent<Q.L5[2]?1:2,e=Math.floor(Math.random()*U.length),i=Math.floor(Math.random()*U[e].length);0===t&&D["default"].playReactions(U[e][i],Q.rX),1===t&&(this.firstReleaseDone?D["default"].playReactions(U[e][i],Q.rX):(this.firstReleaseDone=!0,D["default"].playVoice(this.id,3,Q.p5))),2===t&&D["default"].playReactions(U[e][i],Q.rX),this.checkFirstPerfect(),this.renderer.scene.blockHold=!0,this.renderer.scene.blockHoldDown=!0,await this.sheetPerfect.sequence.play({rate:1-.5*(1-this.holdingPercent)}),this.checkRelease(),this.resetHoldTime(),this.renderer.scene.blockRelease=!1,this.unblockDownReleaseTO=window.setTimeout((()=>{this.renderer.scene.isTitlePlaying.value||(this.renderer.scene.blockHold=!1,this.renderer.scene.isHolding&&D["default"].playHold(this.id,this.renderer.scene.holdValue))}),W.oJ),this.unblockReleaseTO=window.setTimeout((()=>{this.renderer.scene.isTitlePlaying.value||(this.renderer.scene.blockHoldDown=!1)}),W.QP)}cameraShake(t,e=.5,i=.05){const a=s["default"].timeline(),o={transformProgress:0},n=Math.random();a.to(o,{transformProgress:1,duration:e,ease:"power2.inOut",onUpdate:()=>{this.camShakeV[0]=Math.sin(o.transformProgress*Math.PI*4)*i,this.camShakeV[1]=Math.sin(o.transformProgress*Math.PI*4+n)*i},onComplete:()=>{r.vec3.set(this.camShakeV,0,0,0)}},"0")}preRender(){var t,e,i,s;if(!this.isLoaded)return;super.preRender(),this._root.x=-(null===(t=this._cranes[0])||void 0===t?void 0:t.trailNodeX),this._root.updateWorldMatrix();const a=this.renderer.cameras.camera;a.lens.fov=this.cameraFov.value,this._ambientChunk.ambientAddUniform.set(this.ambientAdd.value);const o=this.renderer.postprocess;if(o.vignetteblur.effectStrength=this.vignetteB.value*this.contrastValue.value,o.chroma.amount=this.chroma.value*this.contrastValue.value,o.saturation.amount=1-this.sat.value*this.holdingPercent*this.contrastValue.value,this.isIntroPlaying||this.isOutroPlaying){const t=o.contrast;t.contrast=(0,S.Z)(this.savecontrast,K,this.contrastValue.value),t.brightness=(0,S.Z)(this.savebrightness,tt,this.contrastValue.value),t.bias=(0,S.Z)(this.savebias,et,this.contrastValue.value)}const n=this.cameraSwitchIntro.value;if(this.isIntroPlaying||this.isOutroPlaying)r.vec3.lerp(a.position,this.isOutroPlaying?this.cameraInitialPosition:Y,Q.Io,this.cameraSwitchIntro.value),r.vec3.lerp(J,null===(e=this._cranes[0])||void 0===e?void 0:e.craneNode.position,Q.z8,this.cameraSwitchIntro.value),a.lookAt(J),a.invalidate(),a.updateWorldMatrix(),this.cameraTargetX=(0,S.Z)(this.cameraTargetX,0,n),this.cameraTargetY=(0,S.Z)(this.cameraTargetY,0,n),r.vec3.lerp(this.camShakeV,this.camShakeV,[0,0,0],n);else{r.vec3.lerp(this.cameraInitialPosition,Y,$,this.cameraSwitch.value),r.vec3.copy(a.position,this.cameraInitialPosition);const t=2*(this.mousePosition.x/window.innerWidth-.5),e=2*-(this.mousePosition.y/window.innerHeight-.5),s=(.025*Math.PI+this.speed.value*Math.PI*.005)*(q["default"].isMobile?0:.4),o=(.025*Math.PI+this.speed.value*Math.PI*.005)*(q["default"].isMobile?0:.4),n=.001;this.cameraTargetX=(0,S.Z)(this.cameraTargetX,t*s,n*d.Z.scaledDt),this.cameraTargetY=(0,S.Z)(this.cameraTargetY,e*o,n*d.Z.scaledDt),a.lookAt(null===(i=this._cranes[0])||void 0===i?void 0:i.craneNode.position)}r.quat.identity(this.quatcamy),r.quat.rotateX(this.quatcamy,this.quatcamy,this.cameraTargetY),r.quat.identity(this.quatcamx),r.quat.rotateY(this.quatcamx,this.quatcamx,-this.cameraTargetX),r.quat.multiply(a.rotation,a.rotation,this.quatcamx),r.quat.multiply(a.rotation,a.rotation,this.quatcamy),r.vec3.add(a.position,a.position,this.camShakeV),a.invalidate(),a.updateWorldMatrix(),a.lens.setHorizontalFov((0,c.CD)(this.cameraFov.value*(q["default"].isMobile?.5:1),this._startHFov,n)),this._vortex.speed=this.speed.value,this._vortex2.speed=this.speed.value,this._vortex.preRender(),this._vortex2.preRender(),this._vortex.cloudsOpacity=this.cloudOpacity.value;for(const[r,h]of this._cranes.entries()){if(0!==r){const t=r<3?this.cranesOffset1.value:this.cranesOffset2.value;h.craneNodePosition[0]-=2*h.forwardOffset+(10+Math.max(-h.forwardOffset,0))*t}h.speed=this.speed.value,h.preRender()}if(this._lights.preRender(null===(s=this._cranes[0])||void 0===s?void 0:s.craneNodePosition,this.speed.value),this._particles.preRender(this.speed.value),this.isOutroPlaying){for(const i of o.frame.borderWidth)i[0]*=1-this.cameraSwitchIntro.value,i[1]*=1-this.cameraSwitchIntro.value,i[2]*=1-this.cameraSwitchIntro.value,i[3]*=1-this.cameraSwitchIntro.value;const t=this.renderer.postprocess.texturepass,e=this.cameraSwitchIntro.value;t.textureLuminosity=(0,c.CD)(X.po,X.PX,e)}}render(t){if(this.isLoaded){super.render(t),this.background.render(t),this._vortex.render(t),this._vortex2.render(t);for(const e of this._cranes)e.render(t);this._particles.render(t)}}}},62551:function(t,e,i){i.d(e,{Io:function(){return w},L5:function(){return v},Sq:function(){return m},TC:function(){return h},TS:function(){return u},XA:function(){return a},XL:function(){return o},aD:function(){return r},cx:function(){return f},dM:function(){return c},im:function(){return d},nA:function(){return l},p5:function(){return g},pc:function(){return n},rX:function(){return _},uf:function(){return p},z8:function(){return y}});var s=i(63887);const a=[.83,.73,1],r=.59,o=[1,.92,.98],n=.49,h=[.89,.75,.95],c=.42,l=[.83,.73,1],d=.59,u=[.75,.74,.87],p=.49,m=[.89,.75,.95],f=.42,v=(s.vec3.fromValues(0,80,-60),s.vec3.fromValues(0,100,-100),[.01,.42,.74,1]),g=.5,_=.5,w=s.vec3.fromValues(0,100,-50),y=s.vec3.fromValues(0,100,-60)},89620:function(t,e,i){i.d(e,{Z:function(){return c},x:function(){return n}});var s=i(63887);s.mat4.create();const a=s.quat.create(),r=s.vec3.create(),o=s.vec3.create();class n{constructor(t){this.animation=t,this.range=[0,0],this.time=0,this.weight=1,this.range=[0,t.duration]}get duration(){return this.range[1]-this.range[0]}}class h{constructor(){this.layers=[],this.channels=[]}evaluate(){let t=0;for(let i of this.layers)t+=i.weight;if(0===t)return;let e=0;for(let i=0;i<this.layers.length;i++){let n=this.layers[i];if(0===n.weight)continue;let h=n.weight/t;e+=h;let c=h/e;const l=n.time%(n.range[1]-n.range[0])+n.range[0];for(let t=0;t<this.channels[i].length;t++)this.channels[i][t].evaluate(l);0===i?(a.set(this.node.rotation),r.set(this.node.scale),o.set(this.node.position)):(s.quat.slerp(a,a,this.node.rotation,c),s.vec3.lerp(r,r,this.node.scale,c),s.vec3.lerp(o,o,this.node.position,c))}this.node.rotation.set(a),this.node.scale.set(r),this.node.position.set(o),this.node.invalidate()}}class c{constructor(){this.layers=[],this._nodeLayers=[],this._nodeLayerMap=new Map}addLayer(t){this.layers.push(t),this._invalidLayers=!0}evaluate(){this._invalidLayers&&this._rebuildLayers();for(let t of this._nodeLayers)t.evaluate()}_rebuildLayers(){this._nodeLayers.length=0,this._nodeLayerMap.clear();for(let t of this.layers)t.animation.channels.forEach(((e,i)=>{let s=this._nodeLayerMap.get(e.node);s||(s=new h,s.node=e.node,this._nodeLayers.push(s),this._nodeLayerMap.set(e.node,s));const a=s.layers.indexOf(t);-1===a?(s.layers.push(t),s.channels.push([e])):s.channels[a].push(e)}));this._invalidLayers=!1}}},55929:function(t,e,i){i.d(e,{Z:function(){return o}});var s=i(79763),a=i(49500),r=i(1517);class o extends s.Z{constructor(t){super(!0,!1),this.textureRepeatV=2.5,this.textureOpacityV=.3,this.displacementV=.07,this.timeScaleV=.004,this.textureLuminosityV=1,this.backgroundInfluenceV=1,this.addChild(this.noise=new a.ZP("tileNoise",4,a.Ho.FRAGMENT)),this.noiseT=this.noise.attachSampler("tTileNoise",r.ZP.create("aTexCoord0")),this.noiseT._tex=t.scene.texturePool.get("perlinNoise").texture,this.addChild(this.tile=new a.ZP("tile",4,a.Ho.FRAGMENT)),this.tileT=this.tile.attachSampler("tTile",r.ZP.create("aTexCoord0")),this.tileT._tex=t.scene.texturePool.get("tile").texture,this.addChild(this.textureRepeat=new a.ZP("uRepeat",1,a.Ho.FRAGMENT)),this.textureRepeatU=this.textureRepeat.attachUniform(),this.textureRepeatU.set(this.textureRepeatV),this.addChild(this.textureOpacity=new a.ZP("uOpacity",1,a.Ho.FRAGMENT)),this.textureOpacityU=this.textureOpacity.attachUniform(),this.textureOpacityU.set(this.textureOpacityV),this.addChild(this.displacement=new a.ZP("uDisplacement",1,a.Ho.FRAGMENT)),this.displacementU=this.displacement.attachUniform(),this.displacementU.set(this.displacementV),this.addChild(this.timeScale=new a.ZP("uTimeScale",1,a.Ho.FRAGMENT)),this.timeScaleU=this.timeScale.attachUniform(),this.timeScaleU.set(this.timeScaleV),this.addChild(this.textureLuminosity=new a.ZP("uTextureLuminosity",1,a.Ho.FRAGMENT)),this.textureLuminosityU=this.textureLuminosity.attachUniform(),this.textureLuminosityU.set(this.textureLuminosityV),this.addChild(this.time=new a.ZP("uTime2",1,a.Ho.FRAGMENT)),this.timeU=this.time.attachUniform(),this.timeU.set(1)}_genCode(t){t.add("pf","\n      float blendOverlay(float base, float blend) {\n        return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n      }\n\n      vec3 blendOverlay(vec3 base, vec3 blend) {\n        return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));\n      }\n\n      vec3 blendOverlay(vec3 base, vec3 blend, float opacity) {\n        return (blendOverlay(base, blend) * opacity + base * (1.0 - opacity));\n      }\n\n      float greyscale(vec3 col){\n        float grey = dot(col, vec3(0.299, 0.587, 0.114));\n        return grey;\n      }\n\n      float easeInOutCubic(float x) {\n        return x < 0.5 ? 4.0 * x * x * x : 1.0 - pow(-2. * x + 2., 3.) / 2.;\n      }\n    "),t.add("postf","\n    vec4 noiseJitter = texture2D(tTileNoise, tileNoise_texCoord() + vec2(floor(uTime2() * uTimeScale()) * .1));\n    vec2 shakeUV = tileNoise_texCoord();\n\n    shakeUV = shakeUV - vec2(0.5, 0.5);\n    shakeUV = shakeUV * vec2(uRepeat(), uRepeat());\n    shakeUV = shakeUV + vec2(0.5, 0.5);\n\n    shakeUV += (noiseJitter.rg - 0.5) * uDisplacement();\n\n    vec3 texTile = texture2D(tTile, shakeUV).rgb;\n    texTile *= uTextureLuminosity();\n\n    float greyBackground = greyscale(FragColor.rgb);\n    // float greyBackgroundContrasted = easeInOutCubic(greyBackground);\n    // greyBackground = greyBackgroundContrasted;\n\n    // float blendingOpacity = uOpacity();\n    // blendingOpacity = clamp(uOpacity() - greyBackground * uBackgroundInfluence(), 0., 1.);\n    // FragColor.rgb = blendOverlay(FragColor.rgb, texTile, blendingOpacity);\n    FragColor.rgb = mix(FragColor.rgb, FragColor.rgb * 1. - texTile, uOpacity());\n    ")}}}}]);
//# sourceMappingURL=2829.3c2dc7dc.js.map