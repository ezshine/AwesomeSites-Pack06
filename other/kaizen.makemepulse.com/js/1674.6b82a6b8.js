(self["webpackChunkgl_starter"]=self["webpackChunkgl_starter"]||[]).push([[1674],{60215:function(t){var o=function(t){var o="";return o+="","pf"===t.slot&&(o+="\n\nIN mediump vec2 vTexCoord0;\n#define baseColor_texCoord(k) vTexCoord0\n\nconst float NOISE_GRANULARITY = 0.5/255.0;\n\nfloat random(vec2 coords) {\n  return fract(sin(dot(coords.xy, vec2(12.9898,78.233))) * 43758.5453);\n}\n\nfloat sat(float val) {\n  return clamp(val, 0., 1.);\n}\n\n\n"),o+="\n\n","postf"===t.slot&&(o+="\n\nvec3 color = vec3(uUseClampedMix());\nvec2 UVs = vec2(1.) - vTexCoord0;\n\nif (uType() == 0.) {\n    float distToCenter = distance(UVs, vec2(0.5));\n    distToCenter *= uRadialStrength() * 2.;\n    distToCenter = max(0., min(1., distToCenter));\n    color = mix(uBottomColor().rgb, uTopColor().rgb, distToCenter);\n} else if (uType() == 1.) {\n    color = mix(uBottomColor().rgb, uTopColor().rgb, (UVs.y - uBottomColor().a) / (uTopColor().a - uBottomColor().a));\n    color += uMiddleColor().rgb * .000001;\n} else {\n    float topMixVal = (UVs.y - uBottomColor().a) / (uMiddleColor().a - uBottomColor().a);\n    topMixVal = mix(topMixVal, sat(topMixVal), uUseClampedMix());\n    color = mix(uBottomColor().rgb, uMiddleColor().rgb, topMixVal);\n\n    float botMixVal = (UVs.y - uMiddleColor().a) / (uTopColor().a - uMiddleColor().a);\n    botMixVal = mix(botMixVal, sat(botMixVal), uUseClampedMix());\n    vec3 colorB = mix(uMiddleColor().rgb, uTopColor().rgb, botMixVal);\n    color = mix(colorB, color, step(UVs.y, uMiddleColor().a));\n}\n\nvec3 ditheredColor = color + mix(-NOISE_GRANULARITY, NOISE_GRANULARITY, random(UVs));\n\nFragColor = vec4(ditheredColor, 1.);\n\n"),o+="",o};o.toString=o,t.exports=o,o.onHmr=function(){}},41674:function(t,o,e){"use strict";e.r(o),e.d(o,{default:function(){return V}});var s=e(2262),r=e(5434),i=e(63887),n=e(88271),a=e(62551);const h=i.vec3.create(),l=i.vec3.create();class c{constructor(t){this.renderer=t,this.camLerp={value:0},this.initialFov=0,this.fovTarget=.95,this.lookAtAdd=i.vec3.fromValues(0,0,1),this.lookAtTarget=i.vec3.fromValues(0,0,1),this.positionTarget=i.vec3.fromValues(0,0,.5)}start(){this.renderer.cameras.use("main");const t=this.renderer.camera;t._parent&&t._parent.remove(t),this.initialFov=this.renderer.camera.lens._fov,this.camLerpTheatre=new r.Z(this.camLerp,this.introSheet,"camLerp")}stop(){this.camLerpTheatre.dispose()}preRender(){(0,n.Z)(this.initialFov,this.fovTarget,this.camLerp.value);i.vec3.add(this.lookAtTarget,this.positionTarget,this.lookAtAdd),i.vec3.lerp(l,a.Io,this.positionTarget,this.camLerp.value),i.vec3.lerp(h,a.z8,this.lookAtTarget,this.camLerp.value),this.renderer.camera.position.set(l),this.renderer.camera.lookAt(h),this.renderer.camera.invalidate(),this.renderer.camera.updateWorldMatrix()}}var d=e(97703),u=e(5839),p=e(38677),C=e(46381);class m{get rgb(){return this.v}constructor(t,o,e){this.v=t,this.sheet=o,this.name=e;const s=o.object(e,{position:C.types.rgba({r:t[0],g:t[1],b:t[2],a:1})});this._unsubscribe=s.onValuesChange((t=>{const{r:o,g:e,b:s}=t.position;i.vec3.set(this.v,o,e,s)})),this._obj=s}dispose(){this._unsubscribe(),this.sheet.detachObject(this.name)}}var v=e(42686);class g{constructor(t){this.renderer=t,this.sheet=d["default"].state.machine.context.theatreProject.project.sheet("conclusion / bg"),this.background=new p.Z(this.renderer,p.E.LINEAR_3_STOPS),this.background.setUseClampedMix(!0)}async load(){await Promise.all([this.background.load()]),this.background.onLoaded(),this.loaded=!0}start(){this.sheet.sequence.play(),this.topColorPos=new r.Z({value:v.CJ[3]},this.sheet,"topPos"),this.midColorPos=new r.Z({value:v.HE[3]},this.sheet,"midPos"),this.botColorPos=new r.Z({value:v.nF[3]},this.sheet,"botPos"),this.topColor=new m(i.vec3.fromValues(v.CJ[0],v.CJ[1],v.CJ[2]),this.sheet,"topColor"),this.midColor=new m(i.vec3.fromValues(v.HE[0],v.HE[1],v.HE[2]),this.sheet,"midColor"),this.botColor=new m(i.vec3.fromValues(v.nF[0],v.nF[1],v.nF[2]),this.sheet,"botColor"),this.background.start()}stop(){this.topColorPos.dispose(),this.midColorPos.dispose(),this.botColorPos.dispose(),this.topColor.dispose(),this.midColor.dispose(),this.botColor.dispose(),this.background.stop(),this.sheet.sequence.pause(),this.sheet.sequence.position=0}playIntro(){}preRender(){this.background.topColor.set([...this.topColor.rgb,this.topColorPos.value]),this.background.middleColor.set([...this.midColor.rgb,this.midColorPos.value]),this.background.bottomColor.set([...this.botColor.rgb,this.botColorPos.value])}rttPass(){}render(){this.background.render(this.renderer.context.withMask(u.Z.OPAQUE))}}var f=e(61987),b=e(18158),T=e(13579),M=e(21370),x=e(31236),w=e(56478),P=e(63132);const N=i.mat4.create(),A=i.quat.create(),_=i.quat.create(),B=i.quat.create(),y=200,L=1.2,S=200,k=5,I=50,Z=3;class R{constructor(t){this.renderer=t,this.cloudsTex=[],this.cloudsNode=[],this.rootTargetZ=0,this.cloudsProgress={value:0},this.quadData=new Float32Array([-1,-1,1,0,0,1,-1,1,1,0,1,1,1,1,1,-1,1,1,0,1]),this.prg=(0,x["default"])(t.gl).get("intro-clouds"),this._noiseTex=this.renderer.scene.texturePool.get("perlinNoise").texture}setGeo(){this.buffer=new b.Z(this.renderer.gl,this.quadData),this.bufferIndex=new T.Z(this.renderer.gl,this.renderer.gl.UNSIGNED_SHORT,new Uint16Array([0,1,2,0,2,3])),this.buffer.attrib("aPosition",3,this.renderer.gl.FLOAT),this.buffer.attrib("aTexCoord",2,this.renderer.gl.FLOAT),this.rootNode=new f.Z;for(let t=0;t<8*k;t++){const t=new f.Z;t.position.set([0,0,0]),t.scale.set([2*L*I,.48*Z,1]),t.invalidate(),t.updateWorldMatrix(),this.rootNode.add(t),this.cloudsNode.push(t)}}setNodeRotation(t,o){const e=.5*Math.PI-.05*Math.random(),s=.5*Math.PI-.05*Math.random(),r=Math.random()>.5?Math.PI:0,n=o%k;i.quat.identity(A),i.quat.identity(_),i.quat.identity(B),i.quat.identity(t.rotation),1===n||2===n||4===n?(i.quat.rotateY(A,A,e),i.quat.rotateX(_,A,s),i.quat.rotateZ(B,_,r),t.rotation.set(B)):(i.quat.rotateY(A,A,e),i.quat.rotateZ(_,A,r),t.rotation.set(_)),t.invalidate(),t.updateWorldMatrix()}setupClouds(){this.rootNode.position.set([0,0,y]),this.rootNode.invalidate(),this.rootNode.updateWorldMatrix();const t=S*Math.floor(this.cloudsNode.length/k);for(let o=0;o<this.cloudsNode.length;o++){const e=30,s=this.cloudsNode[o],r=o%k,i=1===r||2===r;let n=0;switch(r){case 0:n=.5*e+2*e*Math.random();break;case 1:n=4+10*Math.random();break;case 2:n=-10*Math.random()-4;break;case 3:n=.5*-e-2*e*Math.random();break;default:n=e*(2*(Math.random()-.5))}const a=5+10*Math.random()+5*+i,h=Math.floor(o/4)*S,l=Math.min(t,h-S/4*Math.random());s.position.set([n,a,l]);const c=2*L*(I/4+I*Math.random()),d=.48*Z+2*Z*Math.random();s.scale[0]=c,s.scale[1]=d,this.setNodeRotation(s,o),o===this.cloudsNode.length-1&&(this.rootTargetZ=2.25*-I-l)}for(let o=0;o<this.cloudsNode.length;o+=k){const t=Math.random()>.2;if(!t)continue;const e=Math.round(Math.random()*k);this.cloudsNode[o+e]=null}}async load(){const t=["intro/clouds-2/cloud-1.webp","intro/brushWhite.webp"];for(const o of t){const t=w["default"].getTexture(o,this.renderer.gl,{alpha:!0,smooth:!1,wrap:"repeat"});await t.load(),this.cloudsTex.push(t.texture)}}start(){this.cam=this.renderer.camera,this.setGeo(),this.setupClouds(),this.cloudsProgressTheatre=new r.Z(this.cloudsProgress,this.sheet,"cloudsProgress")}stop(){this.buffer.dispose(),this.bufferIndex.dispose(),this.cloudsProgressTheatre.dispose()}preRender(){const t=.005*M.Z.time;this.rootNode.position.set([2*Math.sin(.1*(t+100)),1.5*Math.sin(.15*t),(0,n.Z)(y,this.rootTargetZ,this.cloudsProgress.value)]),this.rootNode.invalidate(),this.rootNode.updateWorldMatrix()}render(){for(let t=0;t<this.cloudsNode.length;t++){const o=this.cloudsNode[t];if(!o)continue;const e=this.cloudsTex[1];this.cam.modelViewProjectionMatrix(N,o._wmatrix);const s=Math.abs(this.renderer.camera._wposition[2]-o._wposition[2]),r=(0,P.CW)(2*S,-50,s),i=Math.min(1,Math.max(0,r));this.prg.use(),this.prg.uMVP(N),this.prg.uCamZ&&this.prg.uCamZ(this.renderer.camera._wposition[2]),this.prg.uDiffuse(e),this.prg.uAlpha(Math.min(1,this.cloudsProgress.value/.1)),this.prg.uAlphaDist(i),this.prg.uNoise(this._noiseTex),this.prg.uIsTlClouds(1),this.prg.uTime(M.Z.time),this.buffer.attribPointer(this.prg),this.bufferIndex.bind(),this.bufferIndex.drawTriangles()}}}var O=e(94292),U=e(11821);class V{constructor(t){this.renderer=t,this.isLoaded=!1,this.waitingStart=!1,this.introStarted=!1,this.introFinished=!1;const o=t.gl;this.sheet=d["default"].state.machine.context.theatreProject.project.sheet("conclusion"),this.showLogoRef=(0,s.iH)(!1),this.perspectiveCam=new c(this.renderer),this.ConclusionBackground=new g(this.renderer),this.clouds=new R(this.renderer),this.blendCfg=O.Z.get(o).config().enableBlend().blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA)}async load(){this.clouds.sheet=this.sheet,this.perspectiveCam.introSheet=this.sheet,await Promise.all([this.ConclusionBackground.load(),this.clouds.load()]),this.onLoaded()}onLoaded(){this.isLoaded=!0,this.waitingStart&&(this.waitingStart=!1,this.start())}unload(){}start(){this.isLoaded?(this.showLogoTheatre=new U.Z(!1,(t=>{this.showLogoRef.value=t}),this.sheet,"Show Title"),this.unsubscribeSequenceLength=(0,C.onChange)(this.sheet.sequence.pointer.length,(t=>{this.sequenceTime=t})),this.perspectiveCam.start(),this.ConclusionBackground.start(),this.clouds.start(),this.renderer.scene.prepareTransition(!1),this.sheet.sequence.play().then((async()=>{this.renderer.scene.playTransitionToPortail()}))):this.waitingStart=!0}stop(){this.unsubscribeSequenceLength(),this.ConclusionBackground.stop(),this.perspectiveCam.stop(),this.clouds.stop(),this.showLogoTheatre.dispose(),this.sheet.sequence.position=0}rttPass(){this.isLoaded&&this.ConclusionBackground.rttPass()}preRender(){this.isLoaded&&(this.renderer.scene.currIntroPercentage.value=this.sequenceTime>0?this.sheet.sequence.position/this.sequenceTime:0,this.perspectiveCam.preRender(),this.ConclusionBackground.preRender(),this.clouds.preRender())}render(){this.isLoaded&&(this.ConclusionBackground.render(),this.blendCfg.apply(),this.clouds.render())}}},42686:function(t,o,e){"use strict";e.d(o,{CJ:function(){return s},HE:function(){return r},nF:function(){return i}});const s=[.423,.337,.47,.58],r=[.423,.36,.501,.48],i=[.043,.156,.317,.38]},38677:function(t,o,e){"use strict";e.d(o,{E:function(){return m},Z:function(){return g}});var s=e(63887),r=e(5839),i=e(42946),n=e(5434),a=e(61221),h=e(76879),l=e(79763),c=e(49500),d=e(60215),u=e.n(d);const p=(0,h.Z)(u());class C extends l.Z{constructor(t){super(!0,!0),this.addChild(this.topColor=new c.ZP("uTopColor",4,c.Ho.FRAGMENT)),this.addChild(this.middleColor=new c.ZP("uMiddleColor",4,c.Ho.FRAGMENT)),this.addChild(this.bottomColor=new c.ZP("uBottomColor",4,c.Ho.FRAGMENT)),this.addChild(this.type=new c.ZP("uType",1,c.Ho.FRAGMENT)),this.addChild(this.radialStrength=new c.ZP("uRadialStrength",1,c.Ho.FRAGMENT)),this.addChild(this.useClampedMix=new c.ZP("uUseClampedMix",1,c.Ho.FRAGMENT)),this.topColor.attachConstant([1,0,0,1]),this.middleColor.attachConstant([0,1,0,.5]),this.bottomColor.attachConstant([0,0,1,0]),this.type.attachConstant(2),this.radialStrength.attachConstant(1),this.useClampedMix.attachConstant(0),p.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("pv","\n    IN mediump vec2 aTexCoord0;\n    OUT mediump vec2 vTexCoord0;\n    "),t.add("postv","\n    vTexCoord0 = aTexCoord0;\n    "),t.add("pf",p({slot:"pf"})),t.add("postf",p({slot:"postf"}))}setup(t){t.tex_basecolor||(t.tex_basecolor=()=>{}),t.uMetalnessFactor||(t.uMetalnessFactor=()=>{})}}var m,v=e(14888);(function(t){t[t["RADIAL"]=0]="RADIAL",t[t["LINEAR_2_STOPS"]=1]="LINEAR_2_STOPS",t[t["LINEAR_3_STOPS"]=2]="LINEAR_3_STOPS"})(m||(m={}));class g{constructor(t,o=m.LINEAR_2_STOPS,e=1){this.renderer=t,this.type=o,this.radialStrength=e,this.topColor=s.vec4.create(),this.middleColor=s.vec4.create(),this.bottomColor=s.vec4.create(),this.transitionTopColor=s.vec4.create(),this.transitionMiddleColor=s.vec4.create(),this.transitionBottomColor=s.vec4.create(),this.introTopColor=s.vec4.create(),this.introMiddleColor=s.vec4.create(),this.introBottomColor=s.vec4.create(),this.outroTopColor=s.vec4.create(),this.outroMiddleColor=s.vec4.create(),this.outroBottomColor=s.vec4.create(),this.currentTopColor=s.vec4.create(),this.currentMiddleColor=s.vec4.create(),this.currentBottomColor=s.vec4.create(),this.useClampedMix=!1;const r=new v.Z;r.overridePass("",((t,o)=>{const e=new C(o);this.currentTopColorUniform=e.topColor.attachUniform(),this.currentMiddleColorUniform=e.middleColor.attachUniform(),this.currentBottomColorUniform=e.bottomColor.attachUniform(),this.useClampedMixUniform=e.useClampedMix.attachUniform(),e.type.attachConstant(this.type),e.radialStrength.attachConstant(this.radialStrength);const s=o.getPass("color").pass;return s.inputs.add(e),s})),this.res=new a.ZP("intro/sphere.glb",t.gl,{defaultTextureFilter:t.gl.LINEAR_MIPMAP_LINEAR,extensions:[r]})}async load(){await this.res.load()}onLoaded(){this.gltf=this.res.gltf,this.gltf.root.scale.set([20,20,20]),this.gltf.root.invalidate(),this.gltf.root.updateWorldMatrix()}start(){this.sheetSuccess&&(this.transitionTimeline=new n.Z(g.transition,this.sheetSuccess,"Background Transition")),this.sheetIntro&&(this.sheetIntroObj=this.sheetIntro.object("Background",{transition:0})),this.sheetOutro&&(this.sheetOutroObj=this.sheetOutro.object("Background",{transition:0})),this.sheetDownhill&&(this.transitionDownhill=new n.Z(g.transition,this.sheetDownhill,"Background Transition")),g.transition.value=0,g.transition.startV=g.transition.value}stop(){var t,o,e,s;null===(t=this.sheetIntro)||void 0===t||t.detachObject("Background"),null===(o=this.sheetOutro)||void 0===o||o.detachObject("Background"),null===(e=this.transitionTimeline)||void 0===e||e.dispose(),null===(s=this.transitionDownhill)||void 0===s||s.dispose()}setTransitionColors(t,o,e){s.vec4.copy(this.transitionTopColor,t),s.vec4.copy(this.transitionMiddleColor,o),s.vec4.copy(this.transitionBottomColor,e)}setIntroColors(t,o,e){s.vec4.copy(this.introTopColor,t),s.vec4.copy(this.introMiddleColor,o),s.vec4.copy(this.introBottomColor,e)}setOutroColors(t,o,e){s.vec4.copy(this.outroTopColor,t),s.vec4.copy(this.outroMiddleColor,o),s.vec4.copy(this.outroBottomColor,e)}setUseClampedMix(t){this.useClampedMix=t}render(t){if(t.mask===r.Z.OPAQUE&&t.pass!==i.Z.DEPTH&&t.pass!==i.Z.REFLECT_DEPTH){this.sheetSuccess?(s.vec4.lerp(this.currentTopColor,this.topColor,this.transitionTopColor,g.transition.value),s.vec4.lerp(this.currentMiddleColor,this.middleColor,this.transitionMiddleColor,g.transition.value),s.vec4.lerp(this.currentBottomColor,this.bottomColor,this.transitionBottomColor,g.transition.value)):(s.vec4.copy(this.currentTopColor,this.topColor),s.vec4.copy(this.currentMiddleColor,this.middleColor),s.vec4.copy(this.currentBottomColor,this.bottomColor)),this.sheetDownhill&&this.renderer.scene.isGoingBack&&(s.vec4.lerp(this.currentTopColor,this.topColor,this.transitionTopColor,g.transition.value),s.vec4.lerp(this.currentMiddleColor,this.middleColor,this.transitionMiddleColor,g.transition.value),s.vec4.lerp(this.currentBottomColor,this.bottomColor,this.transitionBottomColor,g.transition.value)),this.sheetOutro&&(s.vec4.lerp(this.currentTopColor,this.currentTopColor,this.outroTopColor,this.sheetOutroObj.value.transition),s.vec4.lerp(this.currentMiddleColor,this.currentMiddleColor,this.outroMiddleColor,this.sheetOutroObj.value.transition),s.vec4.lerp(this.currentBottomColor,this.currentBottomColor,this.outroBottomColor,this.sheetOutroObj.value.transition)),this.sheetIntro&&(s.vec4.lerp(this.currentTopColor,this.currentTopColor,this.introTopColor,this.sheetIntroObj.value.transition),s.vec4.lerp(this.currentMiddleColor,this.currentMiddleColor,this.introMiddleColor,this.sheetIntroObj.value.transition),s.vec4.lerp(this.currentBottomColor,this.currentBottomColor,this.introBottomColor,this.sheetIntroObj.value.transition)),this.currentTopColorUniform.set(...this.currentTopColor),this.currentMiddleColorUniform.set(...this.currentMiddleColor),this.currentBottomColorUniform.set(...this.currentBottomColor),this.useClampedMixUniform.set(this.useClampedMix?1:0);for(const o of this.gltf.renderables)o.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}}}g.transition={value:1,startV:0}},62551:function(t,o,e){"use strict";e.d(o,{Io:function(){return b},L5:function(){return v},Sq:function(){return C},TC:function(){return h},TS:function(){return u},XA:function(){return r},XL:function(){return n},aD:function(){return i},cx:function(){return m},dM:function(){return l},im:function(){return d},nA:function(){return c},p5:function(){return g},pc:function(){return a},rX:function(){return f},uf:function(){return p},z8:function(){return T}});var s=e(63887);const r=[.83,.73,1],i=.59,n=[1,.92,.98],a=.49,h=[.89,.75,.95],l=.42,c=[.83,.73,1],d=.59,u=[.75,.74,.87],p=.49,C=[.89,.75,.95],m=.42,v=(s.vec3.fromValues(0,80,-60),s.vec3.fromValues(0,100,-100),[.01,.42,.74,1]),g=.5,f=.5,b=s.vec3.fromValues(0,100,-50),T=s.vec3.fromValues(0,100,-60)},11821:function(t,o,e){"use strict";e.d(o,{Z:function(){return r}});var s=e(46381);class r{constructor(t=!1,o,e,r){this.update=o,this.sheet=e,this.name=r;const i=e.object(r,{state:s.types.boolean(t)});this._unsubscribe=i.onValuesChange((t=>{this.update(t.state)})),this._obj=i}dispose(){this._unsubscribe(),this.sheet.detachObject(this.name)}}},5434:function(t,o,e){"use strict";e.d(o,{Z:function(){return r}});var s=e(46381);class r{get value(){return this.number.value}constructor(t,o,e){this.number=t,this.sheet=o,this.name=e;const r=o.object(e,{x:s.types.number(t.value)});this._unsubscribe=r.onValuesChange((t=>{this.number.value=t.x})),this._obj=r}dispose(){this._unsubscribe(),this.sheet.detachObject(this.name)}}}}]);
//# sourceMappingURL=1674.6b82a6b8.js.map