(self["webpackChunkgl_starter"]=self["webpackChunkgl_starter"]||[]).push([[6070],{76704:function(t){var e=function(t){var e="";return e+="","pf"===t.slot&&(e+="\n    IN float vDist;\n"),e+="\n\n","f"===t.slot&&(e+="\n    // Change the cloud texture coordinates to create movement and effect\n    float progression = CloudsProgress();\n    // float stretchedU = mix(0.2, 0.0, progression);\n    vec2 uvStretching = vec2(1.0 - smoothstep(0.3, 1.0, progression) * 0.8, 1.0);\n    vec2 offsetCoords = ("+t.originalVarying+" * uvStretching) + vec2(-uTime(), 0.0);\n    vec2 customCoords = offsetCoords;\n"),e+="\n\n","postf"===t.slot&&(e+="\n    // Fade out the clouds up and down\n    float upDownFade = smoothstep(0.0, CloudUpDownFade(), vWorldPosition.y);\n    // Fade out the clouds in the distance\n    float finalDist = smoothstep(MinDist(), MaxDist(), vDist) * IsFogEnabled();\n    vec3 finalColor = mix(CloudColorSlow(), CloudColorFast(), progression);\n    FragColor.rgb = finalColor.rgb;\n    FragColor.a *= (1.0 - finalDist) * upDownFade * uOpacityUniform();\n\n    EXPOSURE(FragColor.rgb);\n    GAMMA_CORRECTION(FragColor.rgb);\n    \n    if(surface.alpha < 0.01){\n        discard;\n    }\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},2515:function(t){var e=function(t){var e="";return e+="","pv"===t.slot&&(e+="\n    OUT float vDist;\n"),e+="\n\n","postv"===t.slot&&(e+="\n    vec3 wPos = vWorldPosition;\n    vec3 camPos = CameraPos();\n\n    float dist = distance(camPos, wPos);\n    vDist = dist;\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},8918:function(t){var e=function(t){var e="";return e+="","pf"===t.slot&&(e+="\n    // IN float vDistance;\n    IN vec3 vVertexColor;\n    IN float vRenderable;\n"),e+="\n\n","postf"===t.slot&&(e+="\n    // Used for debugging\n    // FragColor = vec4(vec3(1.0-vDistance, 0.0, 0.0), 1.0);\n    // FragColor = vec4(vVertexColor.r, vVertexColor.g, vVertexColor.b, 1.0);\n    // FragColor = vec4("+t.originalVarying+".r, "+t.originalVarying+".g, 1.0, 1.0);\n\n    // Compute the 2 bit number defined by vVertexColor green and blue channel\n    // float flowerRenderable = vVertexColor.g * 2.0 + vVertexColor.b;\n\n    // Discard if the flower is not renderable\n    // if(flowerRenderable != vRenderable) discard;\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},54048:function(t){var e=function(t){var e="";return e+="","pv"===t.slot&&(e+="\n    IN vec4 aInstanceMatrix1;\n    IN vec4 aInstanceMatrix2;\n    IN vec4 aInstanceMatrix3;\n    IN vec4 aInstanceMatrix4;\n    IN float aRandomOffset;\n    IN float aIsLeftOrRight;\n    IN float aRandomRotationFactor;\n    IN float aRenderable; \n    IN float aScaleOffset;\n\n    OUT vec3 vPosition;\n    OUT float vDistance;\n    OUT vec3 vVertexColor;\n    OUT float vRenderable;\n\n    float map(float value, float min1, float max1, float min2, float max2) {\n      return min2 + (value - min1) * (max2 - min2) / (max1 - min1);\n    }\n"),e+="\n\n","vertex_warp"===t.slot&&(e+="\n\n    #define M_PI 3.1415926535897932384626433832795\n    mat4 posMat = mat4(\n        aInstanceMatrix1,\n        aInstanceMatrix2,\n        aInstanceMatrix3,\n        aInstanceMatrix4 );\n\n    float xPos = aInstanceMatrix4[0];\n\n    vec4 worldPosTest = posMat * vec4(vertex.position, 1.0);\n    float distanceM = distance(worldPosTest.xyz, uMousePos());\n    float distanceSmooth = smoothstep(0.0, uRadius(), distanceM);\n\n    vDistance = distanceSmooth;\n\n    // Moving the position of the flower\n    float distanceMoveFX = distance(worldPosTest.xyz, vec3(0.0, 13.5, 55.0));\n    float distanceSmoothMoveFX = smoothstep(0.0, 45.0, distanceMoveFX);\n    posMat[3][0] = mix(xPos - aIsLeftOrRight * 4.0, xPos, 1.0 - distanceSmoothMoveFX);\n\n    float vertexColz = aColor0.r;\n    float vertexColx = aColor0.g;\n    vertex.position.z += sin((uTime() * 0.001) + aRandomOffset) * vertexColx;\n    // vertex.position.y += cos((uTime() * 0.001) + aRandomOffset) * vertexColx;\n    \n    vVertexColor = aColor0;\n    // Reset so the color doesn't apply to base colro in fragment\n    v_aColor0 = vec3(1.0, 1.0, 1.0);\n\n    vRenderable = aRenderable;\n\n    // float angle = sin((uTime() * 0.001)) * vertexColz * (1.0-distanceSmooth);\n    float angle = aIsLeftOrRight * vertexColz * (1.0-distanceSmooth) * 0.4 * aRandomRotationFactor;\n\n    vec3 flowerPos = worldPosTest.xyz;\n    vec3 cameraPos = CameraPos();\n\n    vec3 diff = cameraPos - flowerPos;\n\n    float angleY = atan(diff.z, diff.x) - M_PI/2.0 + (aRandomRotationFactor * 0.8);\n\n    // Create a rotation matrix\n    // Y axis\n    // mat4 rotation = mat4(\n    //   cos(angle), 0.0, sin(angle), 0.0,\n    //   0.0, 1.0, 0.0, 0.0,\n    //   -sin(angle), 0.0, cos(angle), 0.0,\n    //   0.0, 0.0, 0.0, 1.0\n    // );\n\n    // X axis\n    mat4 rotationX = mat4(\n      1.0, 0.0, 0.0, 0.0,\n      0.0, cos(angleY), -sin(angleY), 0.0,\n      0.0, sin(angleY), cos(angleY), 0.0,\n      0.0, 0.0, 0.0, 1.0\n    );\n\n    // Z axis\n    mat4 rotation = mat4(\n      cos(angle), -sin(angle), 0.0, 0.0,\n      sin(angle), cos(angle), 0.0, 0.0,\n      0.0, 0.0, 1.0, 0.0,\n      0.0, 0.0, 0.0, 1.0\n    );\n\n    // Scale matrix\n    float vDistScale = distance(worldPosTest.xyz, CameraPos());\n    float bisScale = uScale() < aScaleOffset ? 0.0 : map(uScale(), aScaleOffset, 1.0, 0.0, 1.0);\n    float scale = smoothstep(MinDistScale(), MaxDistScale(), vDistScale) * bisScale;\n    mat4 scaleMat = mat4(\n      vec4(scale, 0.0, 0.0, 0.0),\n      vec4(0.0, scale, 0.0, 0.0),\n      vec4(0.0, 0.0, scale, 0.0),\n      vec4(0.0, 0.0, 0.0, 1.0)\n    );\n\n    vPosition = vertex.position;\n\n    vertex.worldMatrix = posMat * scaleMat * rotationX * rotation;\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},28654:function(t){var e=function(t){var e="";return e+="","pf"===t.slot&&(e+="\n"),e+="\n\n","f"===t.slot&&(e+="\n    vec2 uvStretching = vec2(0.5, 1.0);\n    vec2 offsetCoords = ("+t.originalVarying+" * uvStretching) + vec2(0.5 * vRenderable, 0.0);\n    vec2 customCoords = offsetCoords;\n"),e+="\n\n","postf"===t.slot&&(e+="\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},40193:function(t){var e=function(t){var e="";return e+="","pv"===t.slot&&(e+="\n\n"),e+="\n\n","vertex_warp"===t.slot&&(e+="\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},54777:function(t){var e=function(t){var e="";return e+="","pf"===t.slot&&(e+="\n    IN float vDist;\n    IN vec3 vPosition;\n"),e+="\n\n","postf"===t.slot&&(e+="\n\nfloat finalDist = smoothstep(MinDist(), MaxDist(), vDist) * IsFogEnabled() * IsAlphaEnabled();\n\nfloat rampHeight = smoothstep(BottomFade(), TopFade(), vPosition.x);\nFragColor.a *= (IsAlphaEnabled()) * (1.0 - finalDist) * rampHeight;\n\nif(surface.alpha < 0.01){\n    discard;\n}\n"),e+="\n\n",e};e.toString=e,t.exports=e,e.onHmr=function(){}},87674:function(t){var e=function(t){var e="";return e+="","pv"===t.slot&&(e+="\n    OUT float vDist;\n"),e+="\n\n","postv"===t.slot&&(e+="\n\nvec3 wPos = vWorldPosition;\nvec3 camPos = CameraPos();\n\nfloat dist = distance(camPos, wPos);\n// dist = normalize(dist);\n\nvDist = dist;\n\n"),e+="\n\n",e};e.toString=e,t.exports=e,e.onHmr=function(){}},79785:function(t,e,s){"use strict";var i=s(76670),a=s(42307);class r extends a.Z{constructor(){super(),this._type=i.Z.POINT,this._radius=0,this.radius=50}set castShadows(t){}get radius(){return this._radius}set radius(t){this._radius=t}projectionFromBounds(t){throw new Error("Shadow mapping not supported on point lights")}_createCamera(){throw new Error("Shadow mapping not supported on point lights")}getTexelBiasVector(){throw new Error("Shadow mapping not supported on point lights")}}e["Z"]=r},46070:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return kt}});var i=s(21370),a=s(79763),r=s(76879),o=s(49500),n=s(2515),h=s.n(n),l=s(76704),c=s.n(l);const u=(0,r.Z)(h()),d=(0,r.Z)(c());class f extends a.Z{constructor(t){super(!0,!0),this.addChild(this.time=new o.ZP("uTime",1,o.Ho.FRAGMENT)),this.addChild(this.maxDist=new o.ZP("MaxDist",1,o.Ho.FRAGMENT)),this.addChild(this.minDist=new o.ZP("MinDist",1,o.Ho.FRAGMENT)),this.addChild(this.cameraPos=new o.ZP("CameraPos",3,o.Ho.VERTEX)),this.addChild(this.isFogEnabled=new o.ZP("IsFogEnabled",1,o.Ho.FRAGMENT)),this.addChild(this.progressInput=new o.ZP("CloudsProgress",1,o.Ho.FRAGMENT)),this.addChild(this.cloudColorSlow=new o.ZP("CloudColorSlow",3,o.Ho.FRAGMENT)),this.addChild(this.cloudColorFast=new o.ZP("CloudColorFast",3,o.Ho.FRAGMENT)),this.addChild(this.cloudUpDownFade=new o.ZP("CloudUpDownFade",1,o.Ho.FRAGMENT)),this.addChild(this.opacity=new o.ZP("uOpacityUniform",1,o.Ho.FRAGMENT)),this.zDepthCameraPos=this.cameraPos.attachUniform(),this.timeUniform=this.time.attachUniform(),this.maxDistUniform=this.maxDist.attachUniform(),this.minDistUniform=this.minDist.attachUniform(),this.progressUniform=this.progressInput.attachUniform(),this.isFogEnabledUniform=this.isFogEnabled.attachUniform(),this.cloudColorSlowUniform=this.cloudColorSlow.attachUniform(),this.cloudColorFastUniform=this.cloudColorFast.attachUniform(),this.cloudUpDownFadeUniform=this.cloudUpDownFade.attachUniform(),this.opacityUniform=this.opacity.attachUniform(),this.timeUniform.set(0),this.progressUniform.set(0),this.maxDistUniform.set(600),this.minDistUniform.set(450),this.isFogEnabledUniform.set(1),this.zDepthCameraPos.set(0,0,0),this.cloudUpDownFadeUniform.set(60),this.cloudColorSlowUniform.set(1,.82,.55),this.cloudColorFastUniform.set(1,.93,.83),this.opacityUniform.set(1);const e=t.surface.baseColor.param;this.originalVarying=e._varying,e._varying="customCoords",u.onHmr((()=>this.invalidateCode())),d.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("pv",u({slot:"pv"})),t.add("postv",u({slot:"postv"})),t.add("pf",d({slot:"pf"})),t.add("f",d({slot:"f",originalVarying:this.originalVarying})),t.add("postf",d({slot:"postf"}))}setup(t){t.UambientAdd||(t.UambientAdd=()=>{})}}var m=s(5434),p=s(61221),v=s(17052),g=s(14888);const b="scene1/clouds.gltf";class P{constructor(t,e,s,i){this.sheetPerfect=t,this.sheetSuccess=e,this.sheetIntro=s,this.sheetOutro=i,this.time=0,this.cloudBaseSpeed=.4,this.cloudsProgress={value:0},this.cloudsOpacity={value:0}}overrideColor(t){-1===t.inputs._chunks.findIndex((t=>t instanceof f))&&(this.cloudChunk=new f(t),t.inputs._chunks.unshift(this.cloudChunk),t.inputs.invalidateList())}async load(t){this.renderer=t;const e=new g.Z;e.overridePass("Clouds",((t,e)=>{const s=e.getPass("color").pass,i=new v.Z;return i.ambientAddUniform.set(1),this.overrideColor(s),s.inputs.add(i),null})),this.resource=new p.ZP(b,this.renderer.gl,{defaultTextureFilter:this.renderer.gl.LINEAR_MIPMAP_LINEAR,extensions:[e]}),this.gltf=await this.resource.load(),this.node=this.gltf.getNode("Clouds"),this.onLoaded()}paneSetup(){}onLoaded(){}start(){this.cloudsProgressCoeff=new m.Z(this.cloudsProgress,this.sheetSuccess,"CloudsProgressCoeff"),this.cloudsOpacityOutroTheatre=new m.Z(this.cloudsOpacity,this.sheetOutro,"clouds opacity"),this.cloudsOpacityIntroTheatre=new m.Z(this.cloudsOpacity,this.sheetIntro,"clouds opacity"),this.node.position[0]=0,this.node.position[1]=-51,this.node.position[2]=100,this.cloudChunk.maxDistUniform.set(700),this.cloudChunk.minDistUniform.set(550),this.node.invalidate(),this.node.updateWorldMatrix()}stop(){var t,e,s;null===(t=this.cloudsProgressCoeff)||void 0===t||t.dispose(),null===(e=this.cloudsOpacityIntroTheatre)||void 0===e||e.dispose(),null===(s=this.cloudsOpacityOutroTheatre)||void 0===s||s.dispose()}preRender(t){const e=i.Z.scaledDt/1e4*this.cloudBaseSpeed;this.time+=e+e*this.cloudsProgress.value*4,this.cloudChunk.timeUniform.set(this.time),this.cloudChunk.progressUniform.set(this.cloudsProgress.value),this.cloudChunk.opacityUniform.set(this.cloudsOpacity.value),this.cloudChunk.zDepthCameraPos.set(t._wposition[0],t._wposition[1],t._wposition[2]),this.node.invalidate(),this.node.updateWorldMatrix()}render(t){this.node.invalidate(),this.node.updateWorldMatrix();for(const e of this.gltf.renderables)e.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}}var y=s(40549),_=s(63887),w=s(63132),S=s(68310),M=s(75989),C=s(89620);const A="butterfly/butterfly3.gltf",R=_.vec3.create(),x=_.vec3.create(),O=_.vec3.create();class T{constructor(){this.sheetPerfectVariants=[],this.mousePosition={x:0,y:0},this.initialPosition=_.vec3.create(),this.butterflyCoeff={value:0},this.butterflyYValue={value:0},this.butterflyPerfectS={value:0},this.butterflyPerfectM={value:0},this.butterflyPerfectL={value:0},this.butterflyStraight={value:0},this.butterflyAnimGLTFL={value:0},this.butterflyAnimGLTFBasic={value:0},this.butterflyPitch={value:0},this.butterflyYaw={value:0},this.butterflyRoll={value:0},this.butterflyOffsetX={value:0},this.butterflyOffsetY={value:0},this.butterflyOffsetZ={value:0},this.trailCoeff={value:0},this.endVector=_.vec3.create(),this.originVector=_.vec3.create(),this.lookAtTarget=_.vec3.create(),this.directionVector=_.vec3.create(),this.positionTargetVec=_.vec3.create(),this.positionSubTargetVec=_.vec3.create(),this.butterflyLookAt=_.vec3.create(),this.butterflyPosition=_.vec3.create(),this.butterflyRotation=_.quat.create(),this.butterflySubLookAt=_.vec3.create(),this.butterflyBarrelRoll=_.quat.create(),this.butterflySubPosition=_.vec3.create(),this.butterflySubStartPositon=_.vec3.create(),this.heightValue=0,this.vChange=0,this.uChange=0,this.moveSphere=.05+.05*Math.random(),this.scaleSphere=1+2*(2*Math.random()-1),this.jumpFactor=0,this.xAmplitude=0,this.yAmplitude=0,this.barrelRandom=0,this.rollDirection=1,this.nodeM4=_.mat4.create(),this.parentM4=_.mat4.create(),this.subM4=_.mat4.create(),this.onMouseMove=t=>{this.mousePosition.x=t.clientX,this.mousePosition.y=t.clientY}}async load(t,e){this.renderer=t,this.flowerManager=e;const s=new g.Z;s.overridePass("",((t,e)=>{const s=e.getPass("color").pass,i=new v.Z;return i.ambientAddUniform.set(.3),s.inputs.add(i),s.emissive.attach(s.surface.baseColor.param),s.emissiveFactor.attachConstant(.3),s.surface.roughnessFactor.attachConstant(1),s.surface.metalnessFactor.attachConstant(0),null})),this.resource=new p.ZP(A,this.renderer.gl,{defaultTextureFilter:this.renderer.gl.LINEAR_MIPMAP_LINEAR,extensions:[s]}),this.gltf=await this.resource.load(),this.node=this.gltf.getNode("Parent"),this.subParent=this.gltf.getNode("SubParent"),this.subNode=this.gltf.getNode("SubSubParent");const i=this.gltf.getNode("Armature");i.rotateX(-Math.PI/2),this.node.setScale(1.5),this.node.updateMatrix(),_.mat4.copy(this.nodeM4,this.node._matrix),this.subParent.updateMatrix(),_.mat4.copy(this.parentM4,this.subParent._matrix),this.subNode.updateMatrix(),_.mat4.copy(this.subM4,this.subNode._matrix),this.animationMixer=new C.Z;const a=this.gltf.animations[0];this.flyFastAnimation=new C.x(a),this.flySlowAnimation=new C.x(a),this.accelAnimation=new C.x(a),this.flyFastAnimation.range=[0,50/60],this.flySlowAnimation.range=[52/60,101/60],this.accelAnimation.range=[1.7,340/60],this.animationMixer.addLayer(this.flyFastAnimation),this.animationMixer.addLayer(this.flySlowAnimation),this.animationMixer.addLayer(this.accelAnimation),this.onLoaded()}onLoaded(){this.u=Math.random(),this.v=Math.random()}unload(){}paneSetup(){}setupLighting(t){t.lightSetup.prepare(this.renderer.gl);const e=[];for(const s of this.gltf.renderables)for(const t of s.materials)-1===e.indexOf(t)&&e.push(t);for(const s of e)t.setupMaterial(s)}start(){this.endVector=_.vec3.create(),this.originVector=_.vec3.create(),this.lookAtTarget=_.vec3.create(),this.directionVector=_.vec3.create(),this.positionTargetVec=_.vec3.create(),this.positionSubTargetVec=_.vec3.create(),this.butterflyLookAt=_.vec3.create(),this.butterflyPosition=_.vec3.create(),this.butterflyRotation=_.quat.create(),this.butterflySubLookAt=_.vec3.create(),this.butterflyBarrelRoll=_.quat.create(),this.butterflySubPosition=_.vec3.create(),this.butterflySubStartPositon=_.vec3.create(),this.node.setMatrix(this.nodeM4),this.node.updateMatrix(),this.subParent.setMatrix(this.parentM4),this.subParent.updateMatrix(),this.subNode.setMatrix(this.subM4),this.subNode.updateMatrix(),this.createTrails(),this.renderer.scene.trailManager.renderAbove=!0,this.butterflyYValue.value=this.node.position[1],this.node.position[2]=S.jQ+S.e6,_.vec3.copy(this.butterflyPosition,this.node.position),_.vec3.copy(this.butterflySubPosition,this.subParent.position),_.vec3.copy(this.butterflySubLookAt,this.node.position),_.vec3.copy(this.butterflyLookAt,_.vec3.fromValues(this.flowerManager.xPostButterflyLookAt,this.node.position[1],this.node.position[2]-2)),this.trailCoeffSuccess=new m.Z(this.trailCoeff,this.sheetSuccess,"Trail Coeff"),this.butterflyAnimPerfect=new m.Z(this.butterflyYValue,this.sheetPerfect,"Butterfly"),this.butterflyAnimSuccess=new m.Z(this.butterflyYValue,this.sheetSuccess,"Butterfly"),this.butterFlyAnimCoeff=new m.Z(this.butterflyCoeff,this.sheetSuccess,"ButterflyCoeff"),this.butterflyYawTheatre=new m.Z(this.butterflyYaw,this.sheetPerfectVariants[2],"ButterflyYaw"),this.butterflyYawMTheatre=new m.Z(this.butterflyYaw,this.sheetPerfectVariants[1],"ButterflyYaw"),this.butterflyRollTheatre=new m.Z(this.butterflyRoll,this.sheetPerfectVariants[2],"ButterflyRoll"),this.butterflyRollMTheatre=new m.Z(this.butterflyRoll,this.sheetPerfectVariants[1],"ButterflyRoll"),this.butterflyRollSTheatre=new m.Z(this.butterflyRoll,this.sheetPerfectVariants[0],"ButterflyRoll"),this.butterflyStraightTheatre=new m.Z(this.butterflyStraight,this.sheetSuccess,"ButterflyStraight"),this.butterflyPitchTheatre=new m.Z(this.butterflyPitch,this.sheetPerfectVariants[2],"ButterflyPitch"),this.butterflyPitchMTheatre=new m.Z(this.butterflyPitch,this.sheetPerfectVariants[1],"ButterflyPitch"),this.butterflyAnimationGLTFL=new m.Z(this.butterflyAnimGLTFL,this.sheetPerfectVariants[2],"ButterflyGLTF"),this.butterflyAnimationGLTFM=new m.Z(this.butterflyAnimGLTFL,this.sheetPerfectVariants[1],"ButterflyGLTF"),this.butterflyAnimationGLTFS=new m.Z(this.butterflyAnimGLTFL,this.sheetPerfectVariants[0],"ButterflyGLTF"),this.butterflyAnimationGLTFBasic=new m.Z(this.butterflyAnimGLTFBasic,this.sheetSuccess,"ButterflyGLTFBasic"),this.butterFlyAnimPerfectS=new m.Z(this.butterflyPerfectS,this.sheetPerfectVariants[0],"Butterfly Perfect S"),this.butterflyAnimPerfectM=new m.Z(this.butterflyPerfectM,this.sheetPerfectVariants[1],"Butterfly Perfect M"),this.butterflyAnimPerfectL=new m.Z(this.butterflyPerfectL,this.sheetPerfectVariants[2],"Butterfly Perfect L"),this.butterflyXOffsetValueTheatre=new m.Z(this.butterflyOffsetX,this.sheetPerfectVariants[2],"ButterflyXOffset"),this.butterflyYOffsetValueTheatre=new m.Z(this.butterflyOffsetY,this.sheetPerfectVariants[2],"ButterflyYOffset"),this.butterflyZOffsetValueTheatre=new m.Z(this.butterflyOffsetZ,this.sheetPerfectVariants[2],"ButterflyZOffset"),this.butterflyXOffsetValueMTheatre=new m.Z(this.butterflyOffsetX,this.sheetPerfectVariants[1],"ButterflyXOffset"),this.butterflyYOffsetValueMTheatre=new m.Z(this.butterflyOffsetY,this.sheetPerfectVariants[1],"ButterflyYOffset"),this.butterflyZOffsetValueMTheatre=new m.Z(this.butterflyOffsetZ,this.sheetPerfectVariants[1],"ButterflyZOffset"),this.butterflyZOffsetValueSTheatre=new m.Z(this.butterflyOffsetZ,this.sheetPerfectVariants[0],"ButterflyZOffset"),_.vec3.copy(this.initialPosition,this.node.position),this.node.invalidate(),this.node.updateWorldMatrix()}stop(){var t,e,s,i,a,r,o,n,h,l,c,u,d,f,m,p,v,g,b,P,y,_,w,S,M,C;null===(t=this.trailCoeffSuccess)||void 0===t||t.dispose(),null===(e=this.butterFlyAnimCoeff)||void 0===e||e.dispose(),null===(s=this.butterflyYawTheatre)||void 0===s||s.dispose(),null===(i=this.butterflyAnimPerfect)||void 0===i||i.dispose(),null===(a=this.butterflyAnimSuccess)||void 0===a||a.dispose(),null===(r=this.butterflyRollTheatre)||void 0===r||r.dispose(),null===(o=this.butterflyYawMTheatre)||void 0===o||o.dispose(),null===(n=this.butterFlyAnimPerfectS)||void 0===n||n.dispose(),null===(h=this.butterflyAnimPerfectM)||void 0===h||h.dispose(),null===(l=this.butterflyAnimPerfectL)||void 0===l||l.dispose(),null===(c=this.butterflyPitchTheatre)||void 0===c||c.dispose(),null===(u=this.butterflyRollMTheatre)||void 0===u||u.dispose(),null===(d=this.butterflyRollSTheatre)||void 0===d||d.dispose(),null===(f=this.butterflyPitchMTheatre)||void 0===f||f.dispose(),null===(m=this.butterflyAnimationGLTFL)||void 0===m||m.dispose(),null===(p=this.butterflyAnimationGLTFM)||void 0===p||p.dispose(),null===(v=this.butterflyAnimationGLTFS)||void 0===v||v.dispose(),null===(g=this.butterflyStraightTheatre)||void 0===g||g.dispose(),null===(b=this.butterflyAnimationGLTFBasic)||void 0===b||b.dispose(),null===(P=this.butterflyYOffsetValueTheatre)||void 0===P||P.dispose(),null===(y=this.butterflyZOffsetValueTheatre)||void 0===y||y.dispose(),null===(_=this.butterflyXOffsetValueTheatre)||void 0===_||_.dispose(),null===(w=this.butterflyXOffsetValueMTheatre)||void 0===w||w.dispose(),null===(S=this.butterflyYOffsetValueMTheatre)||void 0===S||S.dispose(),null===(M=this.butterflyZOffsetValueMTheatre)||void 0===M||M.dispose(),null===(C=this.butterflyZOffsetValueSTheatre)||void 0===C||C.dispose(),this.renderer.scene.trailManager.removeAll(),this.renderer.scene.trailManager.renderAbove=!1}release(t=1){this.jumpFactor=t,this.barrelRandom=1,this.xAmplitude=1*Math.random()+.75,this.yAmplitude=.5*Math.random()+.75,this.rollDirection=0===Math.floor(2*Math.random())?-1:1}createTrails(){this.trail=this.renderer.scene.trailManager.addTrail(this.gltf.getElementByName(M.Z.NODE,"trail1"),{color:[1,.97,.91],trailDistance:3,offset:[0,0,0],thickness:2,drawImageFrameElapsed:1,mixBorder:1}),this.trail2=this.renderer.scene.trailManager.addTrail(this.gltf.getElementByName(M.Z.NODE,"trail2"),{color:[1,.97,.91],trailDistance:3,offset:[0,0,0],thickness:2,drawImageFrameElapsed:1,mixBorder:1}),this.trail.trailChunk.alphaU.set(.5),this.trail2.trailChunk.alphaU.set(.5),this.trail.trailChunk.offsetU.set(0,-2,20),this.trail2.trailChunk.offsetU.set(0,-2,20)}updateAnimation(){const t=this.butterflyAnimGLTFL.value+this.butterflyAnimGLTFBasic.value;this.flyFastAnimation.weight=1-.3*t,this.flySlowAnimation.weight=0,this.accelAnimation.weight=t;const e=i.Z.time/1e3;this.flyFastAnimation.time=e,this.flySlowAnimation.time=e,this.accelAnimation.time=e,this.animationMixer.evaluate()}preRender(){this.updateAnimation(),this.movePointOnSphere(x,this.u,this.v),this.v=.5*(Math.sin(this.vChange)+1),this.u=.5*(Math.sin(this.uChange)+1),this.vChange+=(.1+.5*Math.random())*(this.moveSphere+.5*(0,w.CW)(6.5,7,this.flowerManager.speed.value))*Math.min(3,this.flowerManager.speed.value),this.uChange+=(.1+.5*Math.random())*(this.moveSphere+.5*(0,w.CW)(6.5,7,this.flowerManager.speed.value))*Math.min(3,this.flowerManager.speed.value),_.vec3.scale(x,x,this.scaleSphere),_.vec3.add(O,this.butterflySubStartPositon,x),_.vec3.set(this.positionSubTargetVec,O[0]+this.butterflyOffsetX.value*this.xAmplitude*this.rollDirection,O[1]+this.butterflyOffsetY.value*this.yAmplitude,.1*O[2]+this.butterflyOffsetZ.value),_.vec3.lerp(this.butterflySubPosition,this.butterflySubPosition,this.positionSubTargetVec,.002*i.Z.scaledDt),this.subParent.position.set(this.butterflySubPosition),this.subParent.invalidate(),this.subParent.updateWorldMatrix(),_.vec3.copy(this.originVector,this.node.position),this.heightValue=this.butterflyYValue.value+this.butterflyPerfectS.value+this.butterflyPerfectM.value+this.butterflyPerfectL.value,_.vec3.set(this.positionTargetVec,this.flowerManager.xPosButterfly*(1-this.butterflyStraight.value),this.heightValue,this.node.position[2]),_.vec3.lerp(this.butterflyPosition,this.butterflyPosition,this.positionTargetVec,.002*i.Z.scaledDt),this.node.position.set(this.butterflyPosition),_.vec3.set(this.endVector,this.node.position[0],this.node.position[1],this.node.position[2]),_.vec3.sub(this.directionVector,this.endVector,this.originVector),_.vec3.normalize(R,this.directionVector),_.vec3.set(this.lookAtTarget,this.flowerManager.xPostButterflyLookAt*(1-this.butterflyStraight.value),this.node.position[1]+1,this.node.position[2]-5),this.butterflyLookAt[1]=this.node.position[1]+1,_.vec3.lerp(this.butterflyLookAt,this.butterflyLookAt,this.lookAtTarget,.002*i.Z.scaledDt),this.node.lookAt(this.butterflyLookAt),_.quat.identity(this.butterflyRotation),_.quat.rotateX(this.butterflyRotation,this.butterflyRotation,this.butterflyPitch.value*Math.PI/180),_.quat.rotateY(this.butterflyRotation,this.butterflyRotation,this.butterflyYaw.value*Math.PI/180),_.quat.rotateZ(this.butterflyRotation,this.butterflyRotation,this.butterflyRoll.value*this.barrelRandom*Math.PI/180*this.rollDirection),_.quat.rotateZ(this.butterflyRotation,this.butterflyRotation,4*this.node.position[0]*Math.PI/180*(this.butterflyCoeff.value+.5)),_.quat.slerp(this.subNode.rotation,this.subNode.rotation,this.butterflyRotation,.02*i.Z.scaledDt),this.subNode.invalidate(),this.subNode.updateWorldMatrix(),this.node.invalidate(),this.node.updateWorldMatrix(),this.trail.trailChunk.alphaU.set(0+this.trailCoeff.value),this.trail2.trailChunk.alphaU.set(0+this.trailCoeff.value),this.trail.trailChunk.offsetU.set(0,-2,8+120*this.trailCoeff.value),this.trail2.trailChunk.offsetU.set(0,-2,8+120*this.trailCoeff.value),this.trail.trailChunk.thicknessU.set(1.8*this.trailCoeff.value),this.trail2.trailChunk.thicknessU.set(1.8*this.trailCoeff.value)}movePointOnSphere(t,e,s){const i=2*Math.PI*e,a=Math.acos(2*s-1);t[0]=Math.sin(a)*Math.cos(i),t[1]=Math.sin(a)*Math.sin(i),t[2]=Math.cos(a)}render(t){this.node.invalidate(),this.node.updateWorldMatrix();for(const e of this.gltf.renderables)e.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}}var F=s(62642),L=s(61987),k=s(79785);class D{constructor(t){this.renderer=t,this.lighten=1,this.spotFactor=0,this.pointFactor=1,this.moveSmoothing=.0025,this.mousePosition={x:0,y:0},this.initialPositionSpot1=_.vec3.create(),this.initialPositionSpot2=_.vec3.create(),this.onMouseMove=t=>{this.mousePosition.x=t.clientX,this.mousePosition.y=t.clientY},this.node=new L.Z,this.point=new k.Z,this.point.radius=50,this.point._color.set([200,108,76]),this.point.castShadows=!0,this.point.shadowmapSize=512,this.point.x=16,this.point.y=23,this.point.z=32,this.point.invalidate(),this.point.updateWorldMatrix(),this.node.add(this.point)}start(t){this.lighting=t,t.lightSetup.add(this.point)}stop(){this.lighting.lightSetup.remove(this.point)}async setLight(t=2.5,e=0){this._tween=F["default"].to(this,{lighten:.075,spotFactor:1,pointFactor:0,duration:t,delay:e,ease:"power2.inOut",onUpdate:()=>this.onTransitionUpdate()})}preRender(t){this.point.position[0]=t[0],this.point.position[1]=t[1]+15,this.point.invalidate(),this.point.updateWorldMatrix()}onTransitionUpdate(){}applyPointColor(){this.point._color.set([100*this.pointFactor*1,100*this.pointFactor*0,100*this.pointFactor*0])}hexToRgb(t){const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]:[0,0,0]}}var V=s(97703);function Z(){let t=0,e=0,s=0,i=0;function a(a,r,o,n){t=a,e=o,s=-3*a+3*r-2*o-n,i=2*a-2*r+o+n}return{initNonuniformCatmullRom:function(t,e,s,i,r,o,n){let h=(e-t)/r-(s-t)/(r+o)+(s-e)/o,l=(s-e)/o-(i-e)/(o+n)+(i-s)/n;h*=o,l*=o,a(e,s,h,l)},calc:function(a){const r=a*a,o=r*a;return t+e*a+s*r+i*o}}}const I=Z(),B=Z(),U=Z();class z{constructor(t=[]){this.points=t}getPoint(t){const e=this.points,s=e.length,i=s*t;let a=Math.floor(i);const r=i-a;a+=a>0?0:(Math.floor(Math.abs(a)/s)+1)*s;const o=e[(a-1)%s],n=e[a%s],h=e[(a+1)%s],l=e[(a+2)%s],c=.5;let u=Math.pow(_.vec3.squaredDistance(o,n),c),d=Math.pow(_.vec3.squaredDistance(n,h),c),f=Math.pow(_.vec3.squaredDistance(h,l),c);d<1e-4&&(d=1),u<1e-4&&(u=d),f<1e-4&&(f=d),I.initNonuniformCatmullRom(o[0],n[0],h[0],l[0],u,d,f),B.initNonuniformCatmullRom(o[1],n[1],h[1],l[1],u,d,f),U.initNonuniformCatmullRom(o[2],n[2],h[2],l[2],u,d,f);const m=_.vec3.create();return m.set([I.calc(r),B.calc(r),U.calc(r)]),m}}const E=_.vec3.create();class N{constructor(t){this.renderer=t,this.radius=7,this.pathRadius=7,this.sheetPerfectVariants=[],this.speed={value:.3},this.speedBoostS={value:0},this.speedBoostM={value:0},this.speedBoostL={value:0},this.butterflyFlight={value:0},this.xPos=0,this.distance=0,this.xPosButterfly=0,this.xPostButterflyLookAt=0,this.xPostButterflyPrevius=0,this.cameraOffset=S.P9,this.butterflyOffset=S.jQ+S.e6,this.numIt=0,this.nullList=[],this.pathList=[],this.numFlowers=200;const e=[_.vec3.fromValues(0,0,80),_.vec3.fromValues(0,0,70),_.vec3.fromValues(-3,0,60),_.vec3.fromValues(-7,0,50),_.vec3.fromValues(-9,0,40),_.vec3.fromValues(-7,0,30),_.vec3.fromValues(-5,0,20),_.vec3.fromValues(-3,0,10),_.vec3.fromValues(0,0,0),_.vec3.fromValues(5,0,-10),_.vec3.fromValues(8,0,-20),_.vec3.fromValues(10,0,-30),_.vec3.fromValues(11,0,-40),_.vec3.fromValues(8,0,-50),_.vec3.fromValues(5,0,-60),_.vec3.fromValues(0,0,-70),_.vec3.fromValues(0,0,-80)];this.catmullRom=new z(e),this.generateButterflyPath(),this.generateFlowers(),this.sheetSuccess=V["default"].state.machine.context.theatreProject.project.sheet("scene1-success")}start(){this.speedTheatre=new m.Z(this.speed,this.sheetSuccess,"FlowerSpeed"),this.butterflyFlightTheatre=new m.Z(this.butterflyFlight,this.sheetSuccess,"Butterfly Flight Flower"),this.sheetPerfectVariants[0]&&(this.speedBoostSTheatre=new m.Z(this.speedBoostS,this.sheetPerfectVariants[0],"FlowerSpeedBoostS")),this.sheetPerfectVariants[1]&&(this.speedBoostMTheatre=new m.Z(this.speedBoostM,this.sheetPerfectVariants[1],"FlowerSpeedBoostM")),this.sheetPerfectVariants[2]&&(this.speedBoostLTheatre=new m.Z(this.speedBoostL,this.sheetPerfectVariants[2],"FlowerSpeedBoostL"))}stop(){var t,e,s,i,a;null===(t=this.speedTheatre)||void 0===t||t.dispose(),null===(e=this.speedBoostSTheatre)||void 0===e||e.dispose(),null===(s=this.speedBoostMTheatre)||void 0===s||s.dispose(),null===(i=this.speedBoostLTheatre)||void 0===i||i.dispose(),null===(a=this.butterflyFlightTheatre)||void 0===a||a.dispose()}setAlternateSheet(t){this.sheetPerfectVariants=t}randomPoint(){return _.vec3.fromValues(200*Math.random()-100,0,160*Math.random()-80)}getRandomArbitrary(t,e){return Math.random()*(e-t)+t}generateButterflyPath(){for(let t=0;t<=1;t+=.02)this.pathList.push(_.vec3.fromValues(this.catmullRom.getPoint(t)[0],this.catmullRom.getPoint(t)[1],this.catmullRom.getPoint(t)[2]))}generateFlowers(){let t=0;while(this.nullList.length<this.numFlowers&&this.numIt<1e3){this.numIt++;const e=this.randomPoint();if(this.isPointOnPath(e))continue;if(this.isPointOnOtherFlower(e))continue;const s=new L.Z;s.position.set(e);const i=this.getRandomArbitrary(.4,1);s.scale.set([i,i,i]);const a=this.getRandomArbitrary(-Math.PI/12,Math.PI/12);s.rotateZ(a+Math.PI/2);this.getRandomArbitrary(-Math.PI/4,Math.PI/4);this.nullList.push(s);const r=Math.round(Math.random()),o=this.getRandomArbitrary(0,.75);this.nullList[t].extras={randomOffset:Math.random()*Math.PI*2,randomOffsetRotation:Math.random(),isLeftOrRight:0,flowerRenderable:r,offsetScale:o},t++}}isPointOnPath(t){for(let e=0;e<this.pathList.length;e++)if(_.vec3.distance(this.pathList[e],t)<this.pathRadius)return!0;return!1}isPointOnOtherFlower(t){for(let e=0;e<this.nullList.length;e++)if(_.vec3.distance(this.nullList[e].position,t)<this.radius)return!0;return!1}checkNullList(t){for(let e=0;e<t.length;e++)if(t[e].position[2]>80){t[e].position[2]=-80;const s=Math.random();s<.1?t[e].setScale(0):t[e].setScale(this.getRandomArbitrary(.5,1))}}preRender(t){this.distance+=(this.speed.value+this.speedBoostS.value+this.speedBoostM.value+this.speedBoostL.value)*i.Z.scaledDt*.1,this.distanceButterfly=S.jQ+(this.distance-this.butterflyOffset),this.distanceButterfly=this.distanceButterfly%160,this.distanceCamera=S.jQ+(this.distance-this.butterflyOffset-this.cameraOffset),this.distanceCamera=this.distanceCamera%160,this.xPos=this.catmullRom.getPoint(this.distance/160)[0],this.xPosButterfly=this.catmullRom.getPoint(this.distanceButterfly/160)[0],this.xPostButterflyLookAt=this.catmullRom.getPoint((this.distanceButterfly+2)/160)[0];for(const e of this.nullList)e.position[2]+=(this.speed.value+this.speedBoostS.value+this.speedBoostM.value+this.speedBoostL.value)*i.Z.scaledDt*.1,e.invalidate(),e.updateWorldMatrix();t.camera.updateWorldMatrix(),_.vec3.set(E,t.camera._wmatrix[12],t.camera._wmatrix[13],t.camera._wmatrix[14]),this.checkNullList(this.nullList),this.nullList.sort(((t,e)=>{const s=_.vec3.distance(t.position,E),i=_.vec3.distance(e.position,E);return i-s})),this.xPostButterflyPrevius=this.xPosButterfly}}var H=s(31236),X=s(18158),Y=s(94292);const j=10;class G{constructor(t,e,s,i,a,r,o,n){this.renderer=t,this.count=e,this.radius=s,this.color=i,this.strength=a,this.localTime=0,this.prg=(0,H["default"])(t.gl).get("particles-field"),this.noiseTex=this.renderer.scene.texturePool.get("turbulenceNoise").texture,this.sheetSuccess=r,this.sheetIntro=o,this.sheetOutro=n,this.vbuffer=new X.Z(t.gl),this.vbuffer.attrib("aPosition",3,t.gl.FLOAT).attrib("aSettings",4,t.gl.FLOAT).attrib("aAge",3,t.gl.FLOAT),this.vbuffer.attribPointer(this.prg),this.cfg=Y.Z.get(t.gl).config(),this.cfg.enableDepthTest(!0).depthMask(!1).enableBlend(!0).blendEquation(t.gl.FUNC_ADD).blendFunc(t.gl.SRC_ALPHA,t.gl.ONE)}start(t){!G.sheetSuccessObj&&this.sheetSuccess&&(G.sheetSuccessObj=this.sheetSuccess.object("Particles field",{flickerFactor:0,particlesSpeed:0,alpha:0})),!G.sheetIntroObj&&this.sheetIntro&&(G.sheetIntroObj=this.sheetIntro.object("Particles field",{alpha:0})),!G.sheetOutroObj&&this.sheetOutro&&(G.sheetOutroObj=this.sheetOutro.object("Particles field",{alpha:1}));const e=new Float32Array(this.count*j);for(let s=0;s<this.count;s++)e[s*j+0]=t[0]+Math.random()*this.radius*2-this.radius,e[s*j+1]=t[1]+Math.random()*this.radius*.8-this.radius,e[s*j+2]=t[2]+Math.random()*this.radius*2-this.radius,e[s*j+3]=.2*Math.random()*this.strength+.2,e[s*j+4]=.8,e[s*j+5]=1.5*Math.random(),e[s*j+6]=100+.4*Math.random()+.8,e[s*j+7]=80,e[s*j+8]=50,e[s*j+9]=220;this.originalPositionY=t[1],this.vbuffer.data(e)}dispose(){G.sheetSuccessObj&&this.sheetSuccess&&this.sheetSuccess.detachObject("Particles field"),G.sheetIntroObj&&this.sheetIntro&&this.sheetIntro.detachObject("Particles field"),G.sheetOutroObj&&this.sheetOutro&&this.sheetOutro.detachObject("Particles field")}preRender(){this.localTime+=2e-4*i.Z.scaledDt*G.sheetSuccessObj.value.particlesSpeed}render(t){this.prg.use(),this.prg.uProjection(t.camera.lens.getProjection()),this.prg.uView(t.camera._view),this.prg.uColor(this.color),this.prg.uTime(this.localTime),this.prg.uNoise(this.noiseTex);const e=G.sheetSuccessObj&&G.sheetIntroObj&&G.sheetOutroObj?G.sheetSuccessObj.value.alpha*G.sheetOutroObj.value.alpha*G.sheetIntroObj.value.alpha:0;this.prg.uAlpha(e),this.prg.uFlicker(G.sheetSuccessObj?G.sheetSuccessObj.value.flickerFactor:0),this.cfg.apply(),this.vbuffer.attribPointer(this.prg),this.vbuffer.drawPoints()}}const W=[["ui_reaction_kaizen_yeah_c"],["ui_reaction_kaizen_wow_a","ui_reaction_kaizen_wow_c"],["ui_reaction_kaizen_laugh-d","ui_reaction_kaizen_laugh_a","ui_reaction_kaizen_laugh_b","ui_reaction_kaizen_laugh_c"],["ui_reaction_kaizen_love-it_c"],["ui_reaction_kaizen_brilliant_a","ui_reaction_kaizen_brilliant_b","ui_reaction_kaizen_brilliant_c"],["ui_reaction_kaizen_can-t_believe-it_a","ui_reaction_kaizen_can-t_believe-it_b","ui_reaction_kaizen_can-t_believe-it_c"],["ui_reaction_kaizen_cool_a","ui_reaction_kaizen_cool_b","ui_reaction_kaizen_cool_c"],["ui_reaction_kaizen_excited_a","ui_reaction_kaizen_excited_b","ui_reaction_kaizen_excited_c"],["ui_reaction_kaizen_whee_a","ui_reaction_kaizen_whee_b","ui_reaction_kaizen_whee_c"],["ui_reaction_kaizen_whee_a","ui_reaction_kaizen_whee_b","ui_reaction_kaizen_whee_c"],["ui_reaction_kaizen_whee_a","ui_reaction_kaizen_whee_b","ui_reaction_kaizen_whee_c"],["ui_reaction_kaizen_whee_a","ui_reaction_kaizen_whee_b","ui_reaction_kaizen_whee_c"],["ui_reaction_kaizen_whee_a","ui_reaction_kaizen_whee_b","ui_reaction_kaizen_whee_c"],["ui_reaction_kaizen_whee_a","ui_reaction_kaizen_whee_b","ui_reaction_kaizen_whee_c"],["ui_reaction_kaizen_whee_a","ui_reaction_kaizen_whee_b","ui_reaction_kaizen_whee_c"],["ui_reaction_kaizen_whee_a","ui_reaction_kaizen_whee_b","ui_reaction_kaizen_whee_c"],["ui_reaction_kaizen_whee_a","ui_reaction_kaizen_whee_b","ui_reaction_kaizen_whee_c"],["ui_reaction_kaizen_whee_a","ui_reaction_kaizen_whee_b","ui_reaction_kaizen_whee_c"],["ui_reaction_kaizen_whee_a","ui_reaction_kaizen_whee_b","ui_reaction_kaizen_whee_c"],["ui_reaction_kaizen_whee_a","ui_reaction_kaizen_whee_b","ui_reaction_kaizen_whee_c"],["ui_reaction_kaizen_whee_a","ui_reaction_kaizen_whee_b","ui_reaction_kaizen_whee_c"],["ui_reaction_kaizen_whee_a","ui_reaction_kaizen_whee_b","ui_reaction_kaizen_whee_c"],["ui_reaction_kaizen_whee_a","ui_reaction_kaizen_whee_b","ui_reaction_kaizen_whee_c"],["ui_reaction_kaizen_whee_a","ui_reaction_kaizen_whee_b","ui_reaction_kaizen_whee_c"]];var q=s(50509),Q=s(87674),K=s.n(Q),J=s(54777),$=s.n(J);const tt=(0,r.Z)($()),et=(0,r.Z)(K());class st extends a.Z{constructor(){super(!0,!1),this.addChild(this.maxDist=new o.ZP("MaxDist",1,o.Ho.FRAGMENT)),this.addChild(this.minDist=new o.ZP("MinDist",1,o.Ho.FRAGMENT)),this.addChild(this.topFade=new o.ZP("TopFade",1,o.Ho.FRAGMENT)),this.addChild(this.cameraPos=new o.ZP("CameraPos",3,o.Ho.VERTEX)),this.addChild(this.bottomFade=new o.ZP("BottomFade",1,o.Ho.FRAGMENT)),this.addChild(this.isFogEnabled=new o.ZP("IsFogEnabled",1,o.Ho.FRAGMENT)),this.addChild(this.isAlphaEnabled=new o.ZP("IsAlphaEnabled",1,o.Ho.FRAGMENT)),this.zDepthCameraPos=this.cameraPos.attachUniform(),this.zDepthCameraPos.set(0,0,0),this.maxDistUniform=this.maxDist.attachUniform(),this.maxDistUniform.set(36),this.minDistUniform=this.minDist.attachUniform(),this.minDistUniform.set(10),this.isFogEnabledUniform=this.isFogEnabled.attachUniform(),this.isFogEnabledUniform.set(1),this.isAlphaEnabledUniform=this.isAlphaEnabled.attachUniform(),this.isAlphaEnabledUniform.set(1),this.bottomFadeUniform=this.bottomFade.attachUniform(),this.bottomFadeUniform.set(1),this.topFadeUniform=this.topFade.attachUniform(),this.topFadeUniform.set(20),tt.onHmr((()=>this.invalidateCode())),et.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("pv",et({slot:"pv"})),t.add("postv",et({slot:"postv"})),t.add("pf",tt({slot:"pf"})),t.add("postf",tt({slot:"postf"}))}}var it=s(42946),at=s(55411),rt=s(54048),ot=s.n(rt),nt=s(8918),ht=s.n(nt);const lt=(0,r.Z)(ot()),ct=(0,r.Z)(ht());class ut extends a.Z{constructor(){super(!0,!1),this.addChild(this.uTime=new o.ZP("uTime",1,o.Ho.VERTEX)),this.uTimeUniform=this.uTime.attachUniform(),this.uTimeUniform.set(0),this.addChild(this.uMousePos=new o.ZP("uMousePos",3,o.Ho.VERTEX)),this.uMousePosUniform=this.uMousePos.attachUniform(),this.addChild(this.uRadius=new o.ZP("uRadius",1,o.Ho.VERTEX)),this.uRadiusUniform=this.uRadius.attachUniform(),this.uRadiusUniform.set(66),this.addChild(this.cameraPos=new o.ZP("CameraPos",3,o.Ho.VERTEX)),this.addChild(this.maxDistScale=new o.ZP("MaxDistScale",1,o.Ho.VERTEX)),this.addChild(this.minDistScale=new o.ZP("MinDistScale",1,o.Ho.VERTEX)),this.addChild(this.uScale=new o.ZP("uScale",1,o.Ho.VERTEX)),this.uScaleUniform=this.uScale.attachUniform(),this.uScaleUniform.set(0),this.cameraPosUniform=this.cameraPos.attachUniform(),this.cameraPosUniform.set(0,0,0),this.maxDistScaleUniform=this.maxDistScale.attachUniform(),this.maxDistScaleUniform.set(90),this.minDistScaleUniform=this.minDistScale.attachUniform(),this.minDistScaleUniform.set(190),this.uMousePosUniform.set(0,13,41),lt.onHmr((()=>this.invalidateCode())),ct.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("pv",lt({slot:"pv"})),t.add("vertex_warp",lt({slot:"vertex_warp"})),t.add("pf",ct({slot:"pf"})),t.add("postf",ct({slot:"postf"}))}}var dt=s(40193),ft=s.n(dt),mt=s(28654),pt=s.n(mt);const vt=(0,r.Z)(ft()),gt=(0,r.Z)(pt());class bt extends a.Z{constructor(t){super(!0,!1);const e=t.surface.baseColor.param;this.originalVarying=e._varying,e._varying="customCoords",vt.onHmr((()=>this.invalidateCode())),gt.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("pv",vt({slot:"pv"})),t.add("postv",vt({slot:"postv"})),t.add("pf",gt({slot:"pf"})),t.add("f",gt({slot:"f",originalVarying:this.originalVarying})),t.add("postf",gt({slot:"postf"}))}}class Pt extends a.Z{constructor(){super(!0,!1),this.addChild(this.ambientAdd=new o.ZP("ambientAdd",1,o.Ho.FRAGMENT)),this.addChild(this.cameraPos=new o.ZP("CameraPos",3,o.Ho.VERTEX)),this.addChild(this.maxDist=new o.ZP("MaxDist",1,o.Ho.FRAGMENT)),this.addChild(this.minDist=new o.ZP("MinDist",1,o.Ho.FRAGMENT)),this.ambientAddUniform=this.ambientAdd.attachUniform(),this.ambientAddUniform.set(1),this.cameraPosUniform=this.cameraPos.attachUniform(),this.cameraPosUniform.set(0,0,0),this.maxDistUniform=this.maxDist.attachUniform(),this.maxDistUniform.set(36),this.minDistUniform=this.minDist.attachUniform(),this.minDistUniform.set(10)}_genCode(t){t.add("pv","\n    OUT float vDistAmbientAdd;\n    "),t.add("postv","\n    vec3 wPosAmb = vWorldPosition;\n    vec3 camPosAmb = CameraPos();\n\n    float distAmb = distance(camPosAmb, wPosAmb);\n\n    vDistAmbientAdd = distAmb;\n    "),t.add("pf","\n    IN float vDistAmbientAdd;\n    "),t.add("postlightsf","\n      float finalDistAmb = smoothstep(MinDist(), MaxDist(), vDistAmbientAdd);\n\n      float ambientAdd = ambientAdd();\n      // vec3 ambient = vec3(0.717, 0.658, 0.874);\n      vec3 ambient = vec3(0.0);\n\n      #if HAS_baseColor\n        ambient += surface.albedo * ambientAdd * (1.0 - finalDistAmb);\n      #endif\n      #if HAS_baseColorFactor\n        ambient += baseColorFactor() * ambientAdd * (1.0 - finalDistAmb);\n      #endif\n\n      ambient = vec3(0.0);\n\n      #if HAS_baseColor\n        ambient += surface.albedo * ambientAdd ;\n      #endif\n      #if HAS_baseColorFactor\n        ambient += baseColorFactor() * ambientAdd;\n      #endif\n\n      // FragColor.rgb += ambient * ambientAdd * (1.0 - finalDistAmb);\n\n      lightingData.lightingColor += ambient * ambientAdd;\n      // FragColor.rgb += mix(surface.albedo, ambient, ambientAdd * (1.0 - finalDistAmb));\n      // FragColor.rgb = ((FragColor.rgb - 0.5) * max(1.5, 0.0)) + 0.5;\n      \n\n    ")}}class yt{constructor(t,e,s,i){this.materials=[],this.ambientAdd=1,this.ambientAddAlpha=.35,this.move=0,this.zDepthMaxDist=135,this.zDepthMinDist=70,this.root=s,this.renderer=t,this.primitives=e,this.instancing=(0,at.Z)(this.renderer.gl).instancing,this.flowerManager=i,this.nullList=this.flowerManager.nullList,this.instanceAttributeStride=16,this.instanceBuffer=new X.Z(this.renderer.gl,null,this.renderer.gl.DYNAMIC_DRAW),this.instanceBuffer.attrib("aInstanceMatrix1",4,this.renderer.gl.FLOAT).attrib("aInstanceMatrix2",4,this.renderer.gl.FLOAT).attrib("aInstanceMatrix3",4,this.renderer.gl.FLOAT).attrib("aInstanceMatrix4",4,this.renderer.gl.FLOAT),this.instanceData=new Float32Array(this.nullList.length*this.instanceAttributeStride),this.instanceBuffer.data(this.instanceData),this.instanceRandomOffset=new Float32Array(this.nullList.length),this.instanceRandomOffsetBuffer=new X.Z(this.renderer.gl,null,this.renderer.gl.DYNAMIC_DRAW),this.instanceIsLeftOrRight=new Float32Array(this.nullList.length),this.instanceIsLeftOrRightBuffer=new X.Z(this.renderer.gl,null,this.renderer.gl.DYNAMIC_DRAW),this.instanceRenderable=new Float32Array(this.nullList.length),this.instanceRenderableBuffer=new X.Z(this.renderer.gl,null,this.renderer.gl.DYNAMIC_DRAW),this.instanceRandomRotationFactor=new Float32Array(this.nullList.length),this.instanceRandomRotationFactorBuffer=new X.Z(this.renderer.gl,null,this.renderer.gl.DYNAMIC_DRAW),this.instanceScaleOffset=new Float32Array(this.nullList.length),this.instanceScaleOffsetBuffer=new X.Z(this.renderer.gl,null,this.renderer.gl.DYNAMIC_DRAW);for(let a=0;a<this.nullList.length;a++){this.instanceRandomOffset[a]=this.nullList[a].extras.randomOffset,this.instanceRandomRotationFactor[a]=this.nullList[a].extras.randomOffsetRotation;const t=this.nullList[a].position[0],e=this.nullList[a].position[2],s=1-(e+80)/160,i=t>this.flowerManager.catmullRom.getPoint(s)[0]?1:-1;this.nullList[a].extras.isLeftOrRight=i,this.instanceIsLeftOrRight[a]=this.nullList[a].extras.isLeftOrRight,this.instanceRenderable[a]=this.nullList[a].extras.flowerRenderable,this.instanceScaleOffset[a]=this.nullList[a].extras.offsetScale}this.instanceRandomOffsetBuffer.data(this.instanceRandomOffset),this.instanceRandomOffsetBuffer.attrib("aRandomOffset",1,this.renderer.gl.FLOAT),this.instanceIsLeftOrRightBuffer.data(this.instanceIsLeftOrRight),this.instanceIsLeftOrRightBuffer.attrib("aIsLeftOrRight",1,this.renderer.gl.FLOAT),this.instanceRandomRotationFactorBuffer.data(this.instanceRandomRotationFactor),this.instanceRandomRotationFactorBuffer.attrib("aRandomRotationFactor",1,this.renderer.gl.FLOAT),this.instanceRenderableBuffer.data(this.instanceRenderable),this.instanceRenderableBuffer.attrib("aRenderable",1,this.renderer.gl.FLOAT),this.instanceScaleOffsetBuffer.data(this.instanceScaleOffset),this.instanceScaleOffsetBuffer.attrib("aScaleOffset",1,this.renderer.gl.FLOAT),this.instanceChunk=new ut,this.ambientChunk=new Pt,this.zDepth=new st,this.zDepth.maxDistUniform.set(this.zDepthMaxDist),this.zDepth.minDistUniform.set(this.zDepthMinDist),this.ambientChunk.maxDistUniform.set(120),this.ambientChunk.minDistUniform.set(70),this.ambientChunk.ambientAddUniform.set(this.ambientAdd),this.renderer.clearColor=_.vec4.fromValues(1,.81,.6,1)}setupMaterial(t,e){for(const s of this.primitives){this.material=s.material.createMaterialForPrimitive(t,null,s);const e=this.material.getPass(it.Z.COLOR).pass;this.textureOffset=new bt(e),e.inputs._chunks.unshift(this.textureOffset),e.inputs.invalidateList(),this.material.getPass("color").pass.inputs.add(this.textureOffset),this.material.inputs.add(this.instanceChunk),this.material.getPass("color").pass.inputs.add(this.zDepth),this.material.getPass("color").pass.inputs.add(this.ambientChunk),e.glconfig.depthMask(!0),this.materials.push(this.material)}}preRender(t){this.flowerManager.preRender(this.renderer),this.instanceChunk.uTimeUniform.set(i.Z.scaledTime),this.zDepth.zDepthCameraPos.set(t._wposition[0],t._wposition[1],t._wposition[2]),this.ambientChunk.cameraPosUniform.set(t._wposition[0],t._wposition[1],t._wposition[2]),this.instanceChunk.cameraPosUniform.set(t._wposition[0],t._wposition[1],t._wposition[2])}render(t){let e=0;for(const a of this.nullList){const t=a._matrix;this.instanceData.set([t[0],t[1],t[2],t[3]],e*this.instanceAttributeStride+0),this.instanceData.set([t[4],t[5],t[6],t[7]],e*this.instanceAttributeStride+4),this.instanceData.set([t[8],t[9],t[10],t[11]],e*this.instanceAttributeStride+8),this.instanceData.set([t[12],t[13],t[14],t[15]],e*this.instanceAttributeStride+12),this.instanceScaleOffset[e]=a.extras.offsetScale,this.instanceRandomOffset[e]=a.extras.randomOffset,this.instanceRenderable[e]=a.extras.flowerRenderable,this.instanceIsLeftOrRight[e]=a.extras.isLeftOrRight,this.instanceRandomRotationFactor[e]=a.extras.randomOffsetRotation,e++}this.instanceBuffer.data(this.instanceData),this.instanceRenderableBuffer.data(this.instanceRenderable),this.instanceScaleOffsetBuffer.data(this.instanceScaleOffset),this.instanceRandomOffsetBuffer.data(this.instanceRandomOffset),this.instanceIsLeftOrRightBuffer.data(this.instanceIsLeftOrRight),this.instanceRandomRotationFactorBuffer.data(this.instanceRandomRotationFactor);const s=this.renderer.gl,i=Y.Z.get(s);for(let a=0;a<this.primitives.length;a++){const e=this.primitives[a],s=this.materials[a];if(!s.hasPass(t.pass)||0===(s.mask&t.mask))return;const r=s.getPass(t.pass);if(0===(r.pass.mask&t.mask))return;r.prepare(this.root,t.camera),i.push(r.pass.glconfig),s.glconfig&&i.push(s.glconfig),t.glConfig&&i.push(t.glConfig),i.apply(),this.drawCall(t.camera,r.getProgram(),e),i.pop(),this.material.glconfig&&i.pop(),t.glConfig&&i.pop()}}drawCall(t,e,s){s.bindVao(e),this.instanceBuffer.attribPointer(e),this.instancing.vertexAttribDivisor(e.aInstanceMatrix1(),1),this.instancing.vertexAttribDivisor(e.aInstanceMatrix2(),1),this.instancing.vertexAttribDivisor(e.aInstanceMatrix3(),1),this.instancing.vertexAttribDivisor(e.aInstanceMatrix4(),1),this.instanceRenderableBuffer.attribPointer(e),this.instanceRandomOffsetBuffer.attribPointer(e),this.instanceIsLeftOrRightBuffer.attribPointer(e),this.instanceRandomRotationFactorBuffer.attribPointer(e),this.instanceScaleOffsetBuffer.attribPointer(e),this.instancing.vertexAttribDivisor(e.aRenderable(),1),this.instancing.vertexAttribDivisor(e.aRandomOffset(),1),this.instancing.vertexAttribDivisor(e.aIsLeftOrRight(),1),this.instancing.vertexAttribDivisor(e.aRandomRotationFactor(),1),this.instancing.vertexAttribDivisor(e.aScaleOffset(),1),this.instancing.drawElementsInstanced(this.renderer.gl.TRIANGLES,s.indices.count,s.indexBuffer.type,0,this.nullList.length),s.unbindVao()}}var _t=s(25409),wt=s(88271),St=s(87655),Mt=s(75256),Ct=s(39650),At=s(68872);class Rt{constructor(t,e,s,i,a){this.sheetPerfect=e,this.sheetSuccess=s,this.sheetIntro=i,this.sheetOutro=a,this.outroLookAt=new L.Z,this.camRotation=_.quat.create(),this.camParentSave=_.vec3.create(),this.cameraFov={value:0},this.ratioOutro={value:0},this.offsetCamera={value:0},this.cameraFovBoomS={value:0},this.cameraFovBoomM={value:0},this.cameraFovBoomL={value:0},this.cameraYPosition={value:0},this.progressCoeffVal={value:0},this.offsetCameraDistance={value:0},this.cameraLookAtYPosition={value:0},this.cameraLookAtZPosition={value:0},this.cameraTargetX=0,this.cameraTargetY=0,this.scene=t,this.scene.cameraInitialPosition=_.vec3.create()}async load(t){this.renderer=t}start(t){this.renderer.cameras.use("main"),this.outroLookAt=new L.Z,this.camRotation=_.quat.create(),this.cameraTargetX=this.cameraTargetY=0;const e=this.renderer.cameras.camera;if(!e._parent){const t=new L.Z;t.add(e)}_.vec3.copy(e._parent.position,S.Io),_.vec3.copy(this.camParentSave,e._parent.position),this.cameraLookAt=_.vec3.fromValues(S.z8[0],S.z8[1],S.z8[2]),e._parent.lookAt(this.cameraLookAt),e._parent.invalidate(),e._parent.updateWorldMatrix();const s=_.vec3.fromValues(t.node.position[0],0,0);_.vec3.copy(e.position,s),e.invalidate(),e.updateWorldMatrix(),this.camFovAnim=new m.Z(this.cameraFov,this.sheetSuccess,"Camera FOV"),this.ratioTheatreOutro=new m.Z(this.ratioOutro,this.sheetOutro,"Ratio outro"),this.ratioTheatreIntro=new m.Z(this.ratioOutro,this.sheetIntro,"Ratio outro"),this.progressCoeff=new m.Z(this.progressCoeffVal,this.sheetSuccess,"Progress Coeff"),this.offsetCameraTheatre=new m.Z(this.offsetCamera,this.sheetSuccess,"Offset Camera"),this.offsetCameraTheatreIntro=new m.Z(this.offsetCamera,this.sheetIntro,"Offset Camera Intro"),this.camFovBoomMTheatre=new m.Z(this.cameraFovBoomM,this.scene.sheetPerfectVariants[1],"Camera FOV Boom"),this.camFovBoomSTheatre=new m.Z(this.cameraFovBoomS,this.scene.sheetPerfectVariants[0],"Camera FOV Boom S"),this.camFovBoomLTheatre=new m.Z(this.cameraFovBoomL,this.scene.sheetPerfectVariants[2],"Camera FOV Boom L"),this.offsetCameraDistanceTheatre=new m.Z(this.offsetCameraDistance,this.sheetSuccess,"Offset Camera Distance"),this.cameraLookAtZPositionProgress=new m.Z(this.cameraLookAtZPosition,this.sheetSuccess,"Camera LookAt Z Position"),this.cameraLookAtZPositionIntro=new m.Z(this.cameraLookAtZPosition,this.sheetIntro,"Camera LookAt Z Position Intro"),this.offsetCameraDistanceTheatreIntro=new m.Z(this.offsetCameraDistance,this.sheetIntro,"Offset Camera Distance Intro")}stop(){var t,e,s,i,a,r,o,n,h,l,c,u,d,f,m;this.renderer.camera._parent.remove(this.renderer.camera),null===(t=this.camFovAnim)||void 0===t||t.dispose(),null===(e=this.camTargetAnim)||void 0===e||e.dispose(),null===(s=this.progressCoeff)||void 0===s||s.dispose(),null===(i=this.ratioTheatreOutro)||void 0===i||i.dispose(),null===(a=this.ratioTheatreIntro)||void 0===a||a.dispose(),null===(r=this.camFovBoomSTheatre)||void 0===r||r.dispose(),null===(o=this.camFovBoomMTheatre)||void 0===o||o.dispose(),null===(n=this.camFovBoomLTheatre)||void 0===n||n.dispose(),null===(h=this.camAnimInitPosition)||void 0===h||h.dispose(),null===(l=this.offsetCameraTheatre)||void 0===l||l.dispose(),null===(c=this.offsetCameraTheatreIntro)||void 0===c||c.dispose(),null===(u=this.offsetCameraDistanceTheatre)||void 0===u||u.dispose(),null===(d=this.cameraLookAtZPositionIntro)||void 0===d||d.dispose(),null===(f=this.cameraLookAtZPositionProgress)||void 0===f||f.dispose(),null===(m=this.offsetCameraDistanceTheatreIntro)||void 0===m||m.dispose()}preRender(t,e,s=!1,a=!1){const r=this.ratioOutro.value,o=1-this.ratioOutro.value,n=t.lens;n.setHorizontalFov(this.cameraFov.value+this.cameraFovBoomS.value+this.cameraFovBoomM.value+this.cameraFovBoomL.value),_.vec3.copy(t._parent.position,this.camParentSave);const h=2*(this.scene.mousePosition.x/window.innerWidth-.5),l=2*-(this.scene.mousePosition.y/window.innerHeight-.5),c=Ct["default"].isMobile?0:6,u=Ct["default"].isMobile?0:4,d=.001;if(this.cameraTargetX=(0,wt.Z)(this.cameraTargetX,h*c,d*i.Z.scaledDt*o),this.cameraTargetY=(0,wt.Z)(this.cameraTargetY,l*u,d*i.Z.scaledDt*o),_.vec3.copy(S.dv,e),S.dv[0]=10*this.offsetCameraDistance.value+e[0]*(1-this.offsetCamera.value)+this.cameraTargetX,S.dv[1]+=this.cameraYPosition.value+this.cameraTargetY,S.dv[2]+=S.P9,_.vec3.lerp(S.sk,S.Io,S.dv,o),_.vec3.lerp(t._parent.position,t._parent.position,S.sk,.005*i.Z.scaledDt),t.invalidate(),t.updateWorldMatrix(),_.vec3.copy(S.dv,e),S.dv[0]+=.2*this.cameraTargetX,S.dv[1]+=1+this.cameraLookAtYPosition.value+.2*this.cameraTargetY,S.dv[2]+=this.cameraLookAtZPosition.value+.2*this.cameraTargetX,_.vec3.lerp(S.sk,S.z8,S.dv,o),_.vec3.lerp(this.cameraLookAt,this.cameraLookAt,S.sk,.005*i.Z.scaledDt),t._parent.lookAt(this.cameraLookAt),_.quat.identity(S.S9),_.quat.rotateZ(S.S9,S.S9,4*e[0]*Math.PI/180*this.progressCoeffVal.value),_.quat.lerp(this.camRotation,S.f7,S.S9,o),_.quat.copy(t.rotation,this.camRotation),_.vec3.copy(this.camParentSave,t._parent.position),a&&(0,Mt.x)(r,t,this.outroLookAt,St.Io,St.z8,!0,!0,.6),s){const t=this.renderer.postprocess.texturepass;t.textureLuminosity=(0,w.CD)(At.po,At.PX,this.ratioOutro.value)}}}class xt{constructor(t,e,s){this.renderer=t,this.sheetPerfectVariants=e,this.sheetSuccess=s,this.postProcessBoomS={value:0},this.postProcessBoomM={value:0},this.postProcessBoomL={value:0},this.postProcessProgress={value:0},this.vignetteBlurStrength={value:0},this.vignetteBlurStart={value:0}}async load(t){this.renderer=t}start(){this.postProcessCoeffS=new m.Z(this.postProcessBoomS,this.sheetPerfectVariants[0],"Post Process Boom S"),this.postProcessCoeffM=new m.Z(this.postProcessBoomM,this.sheetPerfectVariants[1],"Post process boom"),this.postProcessCoeffL=new m.Z(this.postProcessBoomL,this.sheetPerfectVariants[2],"Post Process Boom L"),this.postProcessProgressCoeff=new m.Z(this.postProcessProgress,this.sheetSuccess,"Post Process Progress"),this.vignetteBlurStrengthCoeff=new m.Z(this.vignetteBlurStrength,this.sheetSuccess,"Vignette Blur Strength"),this.vignetteBlurStartCoeff=new m.Z(this.vignetteBlurStart,this.sheetSuccess,"Vignette Blur Start"),V["default"].glapp.quality.level.isVignetteBlur&&this.renderer.postprocess.post.add(this.renderer.postprocess.vignetteblur),this.renderer.postprocess.post.add(this.renderer.postprocess.frame),this.startcontrast=this.renderer.postprocess.contrast.contrast,this.renderer.postprocess.vignetteblur.size=0,this.renderer.postprocess.vignetteblur.size=.02,this.renderer.postprocess.vignetteblur.vignetteSize=.6,this.renderer.postprocess.vignetteblur.effectStrength=0}stop(){var t,e,s,i,a,r;this.renderer.postprocess.post.remove(this.renderer.postprocess.vignetteblur),this.renderer.postprocess.post.remove(this.renderer.postprocess.frame),null===(t=this.postProcessCoeffS)||void 0===t||t.dispose(),null===(e=this.postProcessCoeffM)||void 0===e||e.dispose(),null===(s=this.postProcessCoeffL)||void 0===s||s.dispose(),null===(i=this.vignetteBlurStartCoeff)||void 0===i||i.dispose(),null===(a=this.postProcessProgressCoeff)||void 0===a||a.dispose(),null===(r=this.vignetteBlurStrengthCoeff)||void 0===r||r.dispose()}preRender(t){const e=this.renderer.postprocess;e.vignetteblur.effectStrength=this.vignetteBlurStrength.value*(1-t),e.vignetteblur.vignetteStart=this.vignetteBlurStart.value*(1-t),this.renderer.postprocess.contrast.contrast=(0,wt.Z)(S.Yk,this.startcontrast,t)}}var Ot=s(38677);function Tt(t,e=.5,s=.05){const i=t,a=F["default"].timeline(),r={transformProgress:0},o=i._parent.position,n=Math.random();a.to(r,{transformProgress:1,duration:e,ease:"power2.inOut",onUpdate:()=>{i._parent.position[0]=o[0]+Math.sin(r.transformProgress*Math.PI*4)*s,i._parent.position[1]=o[1]+Math.sin(r.transformProgress*Math.PI*4+n)*s},onComplete:()=>{_.vec3.copy(i._parent.position,o)}},"0")}function Ft(t,e,s=.5,i=.05,a=.05){const r=t,o=F["default"].timeline(),n={transformProgress:0},h=r._parent.position,l=e,c=Math.random();o.to(n,{transformProgress:1,duration:s,ease:"power2.inOut",onUpdate:()=>{r._parent.position[0]=h[0]+Math.sin(n.transformProgress*Math.PI*4)*i,r._parent.position[1]=h[1]+Math.sin(n.transformProgress*Math.PI*4+c)*i,e[0]=l[0]+Math.cos(n.transformProgress*Math.PI*4)*a,e[1]=l[1]+Math.cos(n.transformProgress*Math.PI*4+c)*a},onComplete:()=>{_.vec3.copy(r._parent.position,h),r._parent.lookAt(l)}},"0")}const Lt=.75;class kt extends y.ZP{constructor(t,e){super(t,e),this.path="scene1/scene1.gltf",this.dandelionPath="dandelion/dandelion.gltf",this.flowerInstancingArray=[],this.materials=[],this.sheetPerfectVariants=[],this.progress={value:0,startV:0,releaseV:0},this.flowerScaleIntro={value:0},this.flowerScaleOutro={value:1},this.flowerScaleDistance={value:0},this.sceneId=1,this.changeState=async t=>{this.previousState!==(0,q.toStatePaths)(t.value)[0].join(".")&&(this.previousState=(0,q.toStatePaths)(t.value)[0].join("."),this.checkOutro(t),t.matches("scene.interacting.perfect")&&this.release())},this.onMouseMove=t=>{this.mousePosition.x=t.clientX,this.mousePosition.y=t.clientY,this.butterfly.onMouseMove(t),this.lights.onMouseMove(t)},this.stepValues=S.L5,this.flowerManager=new N(this.renderer),this.background=new Ot.Z(this.renderer,Ot.E.LINEAR_3_STOPS),this.background.topColor=_.vec4.fromValues(...S.XA,.58),this.background.middleColor=_.vec4.fromValues(...S.XL,.52),this.background.bottomColor=_.vec4.fromValues(...S.TC,.4),this.background.setTransitionColors(_.vec4.fromValues(...S.X3,.58),_.vec4.fromValues(...S.n2,.52),_.vec4.fromValues(...S.Fw,.4)),this.background.setIntroColors(_.vec4.fromValues(...S.bW),_.vec4.fromValues(...S.TO),_.vec4.fromValues(...S.PT)),this.background.setOutroColors(_.vec4.fromValues(...St.Ki,St.aD),_.vec4.fromValues(...St.XL,St.pc),_.vec4.fromValues(...St.TC,St.dM)),this.background.setUseClampedMix(!0),this.sheetPerfectVariants[0]=V["default"].state.machine.context.theatreProject.project.sheet("scene1-perfect-small"),this.sheetPerfectVariants[1]=V["default"].state.machine.context.theatreProject.project.sheet("scene1-perfect-medium"),this.sheetPerfectVariants[2]=V["default"].state.machine.context.theatreProject.project.sheet("scene1-perfect-large"),this.flowerManager.setAlternateSheet(this.sheetPerfectVariants),this.energyParticles=new G(this.renderer,300,100,_.vec3.fromValues(.17,.08,.08),3,this.sheetSuccess,this.sheetIntro,this.sheetOutro),this.cameraSystem=new Rt(this,this.sheetPerfect,this.sheetSuccess,this.sheetIntro,this.sheetOutro),this.postProcessSystem=new xt(this.renderer,this.sheetPerfectVariants,this.sheetSuccess)}async load(){console.log("start load scene 1"),this.lights=new D(this.renderer),this.matOverride=new g.Z,this.resource=new p.ZP(this.path,this.renderer.gl,{defaultTextureFilter:this.renderer.gl.LINEAR_MIPMAP_LINEAR,extensions:[this.matOverride]}),this.gltf=await this.resource.load(),this.dandelionResource=new p.ZP(this.dandelionPath,this.renderer.gl,{defaultTextureFilter:this.renderer.gl.NEAREST}),this.flower=await this.dandelionResource.load();const t=this.flower.getAllElements().filter((t=>{if(t.gltftype===M.Z.TEXTURE){const e=t;if("Flower_01_DiffuseDouble"===e.source.name)return!0}return!1}));for(const e of t){const t=e;t.glTexture.bind(),t.glTexture.setFilter(!1)}this.butterfly=new T,await this.butterfly.load(this.renderer,this.flowerManager),this.butterfly.sheetPerfect=this.sheetPerfect,this.butterfly.sheetSuccess=this.sheetSuccess,this.butterfly.sheetPerfectVariants=this.sheetPerfectVariants,this.clouds=new P(this.sheetPerfect,this.sheetSuccess,this.sheetIntro,this.sheetOutro),await this.clouds.load(this.renderer),await this.background.load(),this.background.sheetSuccess=this.sheetSuccess,this.background.sheetIntro=this.sheetIntro,this.background.sheetOutro=this.sheetOutro,this.cameraSystem.load(this.renderer),this.onLoaded()}onLoaded(){super.onLoaded();for(const t of this.flower.renderables){const e=new yt(this.renderer,t.mesh.primitives,this.gltf.getNode("EmptiesRoot"),this.flowerManager);e.setupMaterial(this.flower,this.renderer.scene.lighting),this.flowerInstancingArray.push(e)}this.background.onLoaded()}start(){super.start();const t=V["default"].state.getSnapshot().context.hasReachedPortail;_t["default"].fadeInWithDelay(_t.SCENE_AUDIO_AMBIENT_ID[this.id-1],Lt,t?2e3:19e3,3),_t["default"].fadeInWithDelay(_t.SCENE_AUDIO_AMBIENT_LAYER_ID[this.id-1],Lt-.15,t?2e3:19e3,3),_t["default"].fadeOutWithDelay(_t.AUDIO_ID.INTRO,17e3,1e3),this.waitingStart||(this.flowerScaleIntroTheatre=new m.Z(this.flowerScaleIntro,this.sheetIntro,"Flower Scale Intro"),this.flowerScaleOutroTheatre=new m.Z(this.flowerScaleOutro,this.sheetOutro,"Flower Scale Outro"),this.flowerScaleDistanceTheatre=new m.Z(this.flowerScaleDistance,this.sheetSuccess,"Flower Scale Distance"),this.clouds.start(),this.butterfly.start(),this.flowerManager.start(),this.postProcessSystem.start(),this.cameraSystem.start(this.butterfly),this.energyParticles.start(_.vec3.fromValues(0,0,0)),this.background.start(),this.gltf.root.add(this.renderer.scene.lighting.root),this.lights.start(this.renderer.scene.lighting),Ot.Z.transition.value=0,Ot.Z.transition.startV=Ot.Z.transition.value)}stop(){var t,e,s;super.stop(),this.lights.stop(),this.clouds.stop(),this.lights.stop(),this.butterfly.stop(),this.cameraSystem.stop(),this.flowerManager.stop(),this.postProcessSystem.stop(),this.background.stop(),this.energyParticles.dispose(),this.gltf.root.remove(this.renderer.scene.lighting.root),null===(t=this.flowerScaleIntroTheatre)||void 0===t||t.dispose(),null===(e=this.flowerScaleOutroTheatre)||void 0===e||e.dispose(),null===(s=this.flowerScaleDistanceTheatre)||void 0===s||s.dispose()}changeStep(t){super.changeStep(t),this.renderer.scene.isGoingBack||(2===t&&Tt(this.renderer.camera,.5,.05),3===t&&Tt(this.renderer.camera,.8,.1),4===t&&Tt(this.renderer.camera,.8,.15))}release(){var t;if(this.renderer.scene.blockRelease)return;window.clearTimeout(this.unblockReleaseTO),window.clearTimeout(this.unblockDownReleaseTO),this.butterfly.release(this.holdingPercent),this.renderer.scene.blockRelease=!0,this.renderer.scene.blockHold=!0,this.renderer.scene.blockHoldDown=!0,this.jumpCounter++,_t["default"].stopHold(this.id);const e=this.holdingPercent<S.L5[1]?0:this.holdingPercent<S.L5[2]?1:2,s=Math.floor(Math.random()*W.length),i=Math.floor(Math.random()*W[s].length);0===e&&(Ft(this.renderer.camera,this.cameraSystem.cameraLookAt,.5,.01,.01),_t["default"].playReactions(W[s][i],S.rX)),1===e&&(Ft(this.renderer.camera,this.cameraSystem.cameraLookAt,.8,.2,.15),this.firstReleaseDone?_t["default"].playReactions(W[s][i],S.rX):(this.firstReleaseDone=!0,_t["default"].playVoice(this.id,3,S.p5))),2===e&&(Ft(this.renderer.camera,this.cameraSystem.cameraLookAt,1.5,.4,.2),_t["default"].playReactions(W[s][i],S.rX)),this.checkFirstPerfect(),null===(t=this.sheetPerfectVariants[e])||void 0===t||t.sequence.play().then((async()=>{this.checkRelease(),this.resetHoldTime(),this.renderer.scene.blockRelease=!1,this.unblockDownReleaseTO=window.setTimeout((()=>{this.renderer.scene.isTitlePlaying.value||(this.renderer.scene.blockHold=!1,this.renderer.scene.isHolding&&_t["default"].playHold(this.id,this.renderer.scene.holdValue))}),y.oJ),this.unblockReleaseTO=window.setTimeout((()=>{this.renderer.scene.isTitlePlaying.value||(this.renderer.scene.blockHoldDown=!1)}),y.QP)}))}setupLighting(){const t=[];for(const e of this.gltf.renderables)for(const s of e.materials)-1===t.indexOf(s)&&t.push(s);for(const e of t)this.renderer.scene.lighting.setupMaterial(e);this.butterfly.setupLighting(this.renderer.scene.lighting),this.lights.start(this.renderer.scene.lighting)}preRender(){if(!this.isLoaded)return;super.preRender();const t=this.renderer.cameras.camera;this.butterfly.preRender(),this.cameraSystem.preRender(t,this.butterfly.node.position,this.isIntroPlaying,this.isOutroPlaying),this.energyParticles.preRender(),this.postProcessSystem.preRender(this.cameraSystem.ratioOutro.value);for(const e of this.flowerInstancingArray)this.isIntroPlaying&&e.instanceChunk.uScaleUniform.set(this.flowerScaleIntro.value),this.isOutroPlaying&&e.instanceChunk.uScaleUniform.set(this.flowerScaleOutro.value),e.preRender(t);if(this.clouds.preRender(t),this.lights.preRender(this.butterfly.node.position),this.isOutroPlaying)for(const e of this.renderer.postprocess.frame.borderWidth)e[0]*=1-this.cameraSystem.ratioOutro.value,e[1]*=1-this.cameraSystem.ratioOutro.value,e[2]*=1-this.cameraSystem.ratioOutro.value,e[3]*=1-this.cameraSystem.ratioOutro.value}rttPass(){this.isLoaded&&(this.renderer.scene.lighting.lightSetup.prepare(this.renderer.gl),this.renderer.scene.lighting.renderLightmaps((t=>{this.render(t)})))}render(t){if(this.isLoaded){this.gltf.root.invalidate(),this.gltf.root.updateWorldMatrix(),this.background.render(t),this.butterfly.render(t);for(const e of this.gltf.renderables)e.render(t.gl,t.camera,t.mask,t.pass,t.glConfig);this.clouds.render(t),this.energyParticles.render(t);for(const e of this.flowerInstancingArray)e.render(t)}}}},68310:function(t,e,s){"use strict";s.d(e,{Fw:function(){return P},Io:function(){return M},L5:function(){return c},P9:function(){return a},PT:function(){return v},S9:function(){return l},TC:function(){return f},TO:function(){return p},X3:function(){return g},XA:function(){return u},XL:function(){return d},Yk:function(){return S},b9:function(){return w},bW:function(){return m},dv:function(){return n},e6:function(){return o},f7:function(){return A},jQ:function(){return r},n2:function(){return b},p5:function(){return y},rX:function(){return _},sk:function(){return h},z8:function(){return C}});var i=s(63887);const a=20,r=80,o=-50,n=(i.vec3.fromValues(1,0,0),i.vec3.create()),h=i.vec3.create(),l=i.quat.create(),c=[.01,.36,.73,1],u=[.73,.64,.77],d=[.97,.78,.74],f=[.37,.24,.51],m=[.111,.443,.575,.58],p=[.207,.56,.65,.52],v=[.03,.29,.529,.4],g=[1,.84,.88],b=[1,.9,.78],P=[.75,.54,.58],y=.3,_=.3,w=[1,1,1],S=1.12,M=i.vec3.fromValues(-85,.5,20),C=i.vec3.fromValues(0,1,-80),A=i.quat.fromValues(0,0,0,1)},87655:function(t,e,s){"use strict";s.d(e,{Io:function(){return u},Ki:function(){return a},L5:function(){return f},TC:function(){return l},XA:function(){return r},XL:function(){return n},aD:function(){return o},dM:function(){return c},p5:function(){return m},pc:function(){return h},rX:function(){return p},z8:function(){return d}});var i=s(63887);const a=[.6,.65,.71],r=[.6,.75,.71],o=.5556,n=[.81,.89,.81],h=.5,l=[.39,.66,.64],c=.3519,u=i.vec3.fromValues(0,60,0),d=i.vec3.fromValues(60,70,0),f=[.01,.40625,.75,1],m=.5,p=.5},75256:function(t,e,s){"use strict";s.d(e,{x:function(){return d}});var i=s(63132),a=s(63887);const r=a.vec3.fromValues(0,0,0),o=a.vec3.fromValues(0,0,0),n=a.vec3.fromValues(0,0,0),h=a.quat.create(),l=a.quat.create(),c=a.quat.create();a.quat.identity(c);const u=a.vec3.create();function d(t,e,s,d,f,m=!1,p=!1,v=.7){a.vec3.copy(o,e.position),a.quat.copy(h,e.rotation),m&&(a.vec3.copy(n,e._parent.position),a.quat.copy(l,e._parent.rotation));const g=(0,i.CW)(0,v,t),b=(0,i.CW)(v,1,t);if(p&&(a.vec3.set(u,e._parent.position[0],d[1],e._parent.position[2]),a.vec3.lerp(e._parent.position,e._parent.position,u,g),e._parent.invalidate(),e._parent.updateWorldMatrix(),a.vec3.copy(n,e._parent.position)),!p||p&&g>=1){const i=p?b:t;a.vec3.copy(s.position,d),s.lookAt(f),s.invalidate(),s.updateWorldMatrix();const u=m?e._parent:e;a.quat.slerp(u.rotation,m?l:h,s.rotation,i),a.vec3.lerp(u.position,m?n:o,d,i),u.invalidate(),u.updateWorldMatrix(),m&&(a.quat.slerp(e.rotation,h,c,i),a.vec3.lerp(e.position,o,r,i),e.invalidate(),e.updateWorldMatrix())}}},89620:function(t,e,s){"use strict";s.d(e,{Z:function(){return l},x:function(){return n}});var i=s(63887);i.mat4.create();const a=i.quat.create(),r=i.vec3.create(),o=i.vec3.create();class n{constructor(t){this.animation=t,this.range=[0,0],this.time=0,this.weight=1,this.range=[0,t.duration]}get duration(){return this.range[1]-this.range[0]}}class h{constructor(){this.layers=[],this.channels=[]}evaluate(){let t=0;for(let s of this.layers)t+=s.weight;if(0===t)return;let e=0;for(let s=0;s<this.layers.length;s++){let n=this.layers[s];if(0===n.weight)continue;let h=n.weight/t;e+=h;let l=h/e;const c=n.time%(n.range[1]-n.range[0])+n.range[0];for(let t=0;t<this.channels[s].length;t++)this.channels[s][t].evaluate(c);0===s?(a.set(this.node.rotation),r.set(this.node.scale),o.set(this.node.position)):(i.quat.slerp(a,a,this.node.rotation,l),i.vec3.lerp(r,r,this.node.scale,l),i.vec3.lerp(o,o,this.node.position,l))}this.node.rotation.set(a),this.node.scale.set(r),this.node.position.set(o),this.node.invalidate()}}class l{constructor(){this.layers=[],this._nodeLayers=[],this._nodeLayerMap=new Map}addLayer(t){this.layers.push(t),this._invalidLayers=!0}evaluate(){this._invalidLayers&&this._rebuildLayers();for(let t of this._nodeLayers)t.evaluate()}_rebuildLayers(){this._nodeLayers.length=0,this._nodeLayerMap.clear();for(let t of this.layers)t.animation.channels.forEach(((e,s)=>{let i=this._nodeLayerMap.get(e.node);i||(i=new h,i.node=e.node,this._nodeLayers.push(i),this._nodeLayerMap.set(e.node,i));const a=i.layers.indexOf(t);-1===a?(i.layers.push(t),i.channels.push([e])):i.channels[a].push(e)}));this._invalidLayers=!1}}}}]);
//# sourceMappingURL=6070.ec2c99df.js.map