"use strict";(self["webpackChunkgl_starter"]=self["webpackChunkgl_starter"]||[]).push([[7799],{47799:function(t,e,i){i.r(e),i.d(e,{default:function(){return m}});var o=i(62642),s=i(21370),a=i(63887),r=i(38545),n=i(97703),h=i(39650),c=i(50509),l=i(61221),d=i(14888);const u="outroduction/outroduction.gltf",g=.1;class m{constructor(t){this.renderer=t,this.paused=!1,this.previousState="",this.contextOrigamiId="noOrigami",this.cameraInitialPosition=a.vec3.create(),this.cameraLookAt=a.vec3.create(),this.mousePosition={x:0,y:0},this.touchStartTime=0,this.cameraTransitionDuration=1,this.changeState=async t=>{this.contextOrigamiId!==t.context.mobileOrigamiId&&(this.contextOrigamiId=t.context.mobileOrigamiId,t.matches("outroduction.mobile.origamis")&&("papillon"==t.context.mobileOrigamiId&&this.tweenCamera(this.gltf.getNode("CameraPos1").position,this.gltf.getNode("Cube").position,this.cameraTransitionDuration,.58),"carpe"==t.context.mobileOrigamiId&&this.tweenCamera(this.gltf.getNode("CameraPos2").position,this.gltf.getNode("Cone").position,this.cameraTransitionDuration,.9),"grenouille"==t.context.mobileOrigamiId&&this.tweenCamera(this.gltf.getNode("CameraPos3").position,this.gltf.getNode("Torus").position,this.cameraTransitionDuration,.45),"grue"==t.context.mobileOrigamiId&&this.tweenCamera(this.gltf.getNode("CameraPos4").position,this.gltf.getNode("Icosphere").position,this.cameraTransitionDuration,.7)),this.previousState!==(0,c.toStatePaths)(t.value)[0].join(".")&&(this.previousState=(0,c.toStatePaths)(t.value)[0].join("."),console.log("change state "+this.previousState),t.matches("outroduction.mobile.carousel")&&this.tweenCamera(this.gltf.getNode("CameraPos").position,this.gltf.getNode("CameraTarget").position,this.cameraTransitionDuration)))},this.onMouseMove=t=>{this.mousePosition.x=t.clientX,this.mousePosition.y=t.clientY},this.onPointerDown=t=>{this.touchStartTime=s.Z.scaledTime},this.onPointerUp=t=>{if(!this.previousState.match("scene1.interacting.idle"))return;const e=s.Z.scaledTime-this.touchStartTime;e>1e3&&e<2500?n["default"].state.send("PERFECT_INTERACTION"):n["default"].state.send("SUCCESS_INTERACTION")}}async load(){this.lighting=new r.Z(this.renderer.gl),await this.lighting.load();const t=new d.Z;this.resource=new l.ZP(u,this.renderer.gl,{defaultTextureFilter:this.renderer.gl.LINEAR_MIPMAP_LINEAR,extensions:[t]}),console.log("load outroduction"),this.gltf=await this.resource.load(),console.log("loaded outroduction"),this.gltf.root.add(this.lighting.root),this.onLoaded()}onLoaded(){const t=window.innerWidth>=1050||!("ontouchstart"in window);let e=1.08;t||(e=.77),this.renderer.cameras.camera.lens.setVerticalFov(e),this.setupLighting()}unload(){}start(){if(this.changeStateSubscription=n["default"].state.subscribe(this.changeState),console.log("start outroduction"),!h["default"].isDesktop){const t=document.documentElement;t.classList.add("prevent-select")}const t=this.renderer.cameras.camera;a.vec3.copy(this.cameraInitialPosition,this.gltf.getNode("CameraPos").position),a.vec3.copy(t.position,this.cameraInitialPosition),a.vec3.copy(this.cameraLookAt,this.gltf.getNode("CameraTarget").position),t.lookAt(this.cameraLookAt),t.invalidate(),t.updateWorldMatrix(),t.updateViewProjectionMatrix(this.renderer.viewport.width,this.renderer.viewport.height),this.cylinder=this.gltf.getNode("Cylinder"),window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("pointerdown",this.onPointerDown),window.addEventListener("pointerup",this.onPointerUp)}stop(){console.log("stop outroduction"),this.changeStateSubscription.unsubscribe()}tweenCamera(t,e,i,s=1.08){const r=o["default"].timeline();r.to(this.renderer.cameras.camera.position,{duration:i,0:t[0],1:t[1],2:t[2],ease:"power2.out",onComplete:()=>{a.vec3.copy(this.cameraInitialPosition,t)}});const n=this.cameraLookAt,h=o["default"].timeline();h.to(n,{duration:i,0:e[0],1:e[1],2:e[2],ease:"power2.out",onComplete:()=>{a.vec3.copy(this.cameraLookAt,e)}});const c=o["default"].timeline(),l={fov:this.renderer.cameras.camera.lens.fov};l.fov!==s&&c.to(l,{duration:i,fov:s,ease:"power2.out",onUpdate:()=>{this.renderer.cameras.camera.lens.setVerticalFov(l.fov)}})}setupLighting(){this.lighting.lightSetup.prepare(this.renderer.gl);const t=[];for(const e of this.gltf.renderables)for(const i of e.materials)-1===t.indexOf(i)&&t.push(i);for(const e of t)this.lighting.setupMaterial(e)}preRender(){const t=this.renderer.cameras.camera;t.lookAt(this.cameraLookAt),t.invalidate(),t.updateWorldMatrix()}rttPass(){this.lighting.lightSetup.prepare(this.renderer.gl),this.lighting.renderLightmaps((t=>{this.render(t)}))}render(t){a.quat.identity(this.cylinder.rotation),a.quat.rotateY(this.cylinder.rotation,this.cylinder.rotation,g),this.cylinder.invalidate(),this.cylinder.updateWorldMatrix(),this.gltf.root.invalidate(),this.gltf.root.updateWorldMatrix();for(const e of this.gltf.renderables)e.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}}}}]);
//# sourceMappingURL=7799.40acf090.js.map