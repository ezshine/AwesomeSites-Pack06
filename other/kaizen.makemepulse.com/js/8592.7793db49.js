"use strict";(self["webpackChunkgl_starter"]=self["webpackChunkgl_starter"]||[]).push([[8592],{22999:function(t,e,s){function a(t){return t.startsWith("/")&&(t=t.substring(1)),s.p+t}s.d(e,{Z:function(){return a}})},33047:function(t,e,s){s.d(e,{po:function(){return o},zo:function(){return A}});const a=(t,e)=>new Promise(((s,a)=>{const i=new Image;i.src=`data:image/${t};base64,${e}`,i.onload=()=>{s(!0)},i.onerror=()=>{a(t.toUpperCase()+" format not supported")}})),i=()=>a("avif","AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="),r=()=>a("webp","UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA=="),o=(t,{async:e=!1}={})=>new Promise(((s,a)=>{const i=new Image;function r(){i.onload=null,i.onerror=null}e&&(i.decoding="async"),i.onload=()=>{r(),s(i)},i.onerror=()=>{r(),a(`Image with name '...${t}' was not found.`)},i.src=t})),A=async(t="png")=>await i().catch(console.warn)?"avif":await r().catch(console.warn)?"webp":t},14739:function(t,e,s){s.d(e,{G:function(){return A}});var a=s(33047),i=s(56478),r=s(65031),o=s(21370);class A{constructor(t,e,s,a,i=[],r=(()=>{}),o=(()=>{}),A=!1){this.renderer=t,this.spiteObject=e,this.worker=s,this.key=a,this.frameEvents=i,this.onEndEvent=r,this.onLoaded=o,this.handleWorkerLocally=A,this.totalFrames=0,this.totalLoopFrames=0,this.allImgLoaded=!1,this.time=0,this.loopTime=0,this.frame=0,this.currentFrame=0,this.currentLoopFrame=0,this.lastLoopFrameDrawn=-1,this.lastFrameDrawn=-1,this.hasStarted=!1,this.isPlaying=!1,this.canContinue=!1,this.isLoopPlaying=!1,this.isReverse=!1,this.createTextures(),A&&(this.worker.onmessage=t=>{const{imageBase64:e,layerIndex:s,frameIndex:a}=t.data;this.handleWorkerMessage(e,s,a)})}async createTextures(){const{fps:t,loopFps:e,layers:s,endFrameIn:o,totalFrames:A,loopFrames:n}=this.spiteObject;this.firstTextureLoaded=!1,this.framerate=t,this.loopFramerate=e,this.frameStop=o,this.totalFrames=A,this.totalLoopFrames=n,this.atlas=Array(s.length),s.forEach(((t,e)=>{const s=new r.Z(this.renderer.gl,this.renderer.gl.RGBA);s.bind(),s.clamp(),this.atlas[e]={images:Array(t.isLoop?n:A).fill(null),texture:s,isLoop:t.isLoop,isShaking:t.isShaking}}));const h=window.location.origin,l=await(0,a.zo)("webp"),d=s.flatMap(((t,e)=>Array.from({length:t.isLoop?n:A},((s,a)=>{const r=a>9?a.toString():`0${a}`,o=h+"/"+i["default"].getAssetPath(decodeURI(`${t.path}/${l}/${r}.${l}`));return{assetPath:o,layerIndex:e,frameIndex:a}}))));this.worker.postMessage({imageLoadRequests:d,key:this.key}),this.renderer.gl.pixelStorei(this.renderer.gl.UNPACK_FLIP_Y_WEBGL,!0)}handleWorkerMessage(t,e,s){const a=new Image;a.onload=()=>{0===s&&this.atlas[e].texture.fromImage(a),this.firstTextureLoaded||(this.firstTextureLoaded=!0),this.atlas[e].images[s]=a,this.atlas[e].images.every((t=>null!=t))&&(this.atlas[e].allLoaded=!0),this.atlas.every((t=>t.allLoaded))&&(this.allImgLoaded=!0,this.onLoaded())},a.src=t}getAtlas(){return this.atlas}getTime(){return this.loopTime}updateLoopState(t){const{hasStarted:e,isPlaying:s,isLoopPlaying:a,canContinue:i}=t;this.hasStarted=e,this.isPlaying=s,this.isLoopPlaying=a,this.canContinue=i}setFramesEvents(t){this.frameEvents=t}setOnEndEvent(t){this.onEndEvent=t}setOnLoaded(t){this.onLoaded=t}reset(){this.time=0,this.loopTime=0,this.frame=0,this.currentFrame=0,this.currentLoopFrame=0,this.lastLoopFrameDrawn=-1,this.lastFrameDrawn=-1,this.hasStarted=!1,this.isPlaying=!1,this.canContinue=!1,this.isLoopPlaying=!1,this.isReverse=!1,this.updateTextures(0,0)}updateFrame(){this.updateTextures(this.currentFrame,this.currentLoopFrame)}updateTextures(t,e){if(!this.allImgLoaded)return;const s=this.isReverse?this.totalFrames-t-1:t,a=this.isReverse?this.totalLoopFrames-e-1:e;if(!(this.lastLoopFrameDrawn===a&&this.isLoopPlaying||this.lastFrameDrawn===s&&this.isPlaying)){this.lastLoopFrameDrawn=a,this.lastFrameDrawn=s;for(let t=0;t<this.atlas.length;t++){const e=this.atlas[t].images[this.atlas[t].isLoop?a:s];this.atlas[t].texture.fromImage(e)}}}start(){}stop(){}load(){}preRender(){var t,e;if(this.hasStarted){this.frameStop&&this.currentFrame>=this.frameStop&&!this.canContinue&&(this.isPlaying=!1);for(const e of this.frameEvents)e.targetFrame===this.currentFrame&&(null===(t=e.callback)||void 0===t||t.call(e));this.currentFrame>=this.totalFrames-1&&(this.isPlaying=!1,null===(e=this.onEndEvent)||void 0===e||e.call(this)),this.isLoopPlaying&&(this.loopTime+=Math.min(.2,o.Z.dt/1e3),this.currentLoopFrame=Math.floor(this.loopTime*this.loopFramerate)%this.totalLoopFrames),this.isPlaying&&(this.time+=Math.min(.2,o.Z.dt/1e3),this.currentFrame=Math.min(Math.floor(this.time*this.framerate),this.totalFrames-1)),this.updateTextures(this.currentFrame,this.currentLoopFrame)}}}},58592:function(t,e,s){s.r(e),s.d(e,{default:function(){return n}});var a=s(14739),i=s(22999),r=s(2246),o=s(97703);const A={fps:30,loopFps:30,totalFrames:37,loopFrames:37,layers:[{path:"transitions/chapter-to-menu",isMultiply:!1,isLoop:!1,isShaking:!1}]};class n{constructor(t){this.renderer=t,this.allImgLoaded=!1,this.isPlaying=!1,this.onSpriteLoad=()=>{this.allImgLoaded=!0,this.renderer.postprocess.post.add(this.renderer.postprocess.transitionPass)},this.onEnd=async()=>{o["default"].state.send("GO_TO_QUOTE"),await(0,r.Z)(500),this.spriteManager.reset(),this.isPlaying=!1};t.gl;const e=(0,i.Z)("js/transition.worker.js");n.worker=new Worker(e),this.spriteManager=new a.G(t,A,n.worker,"to-menu",[],this.onEnd,this.onSpriteLoad,!0)}play(){this.spriteManager.updateLoopState({canContinue:!0,isPlaying:!0,isLoopPlaying:!0,hasStarted:!0}),this.isPlaying=!0}prepare(){this.spriteManager.updateFrame()}isTransitionToScene(t){this.spriteManager.isReverse=t}stop(){n.worker.terminate()}preRender(){this.allImgLoaded&&(this.spriteManager.preRender(),this.atlas=this.spriteManager.getAtlas())}}}}]);
//# sourceMappingURL=8592.7793db49.js.map