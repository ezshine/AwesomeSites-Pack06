(self["webpackChunkgl_starter"]=self["webpackChunkgl_starter"]||[]).push([[2369],{95952:function(t){var e=function(t){var e="";return e+="","postf"===t.slot&&(e+="\n\nfloat fogVisibilityZ = smoothstep(uMaxDistZ(), uMinDistZ(), abs(vWorldPosition.z));\nfloat fogVisibilityY = smoothstep(uMaxLimitY(), uMinLimitY(), uCameraY() - vWorldPosition.y);\nFragColor.a *= fogVisibilityZ * fogVisibilityY;\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},3883:function(t){var e=function(t){var e="";return e+="","postf"===t.slot&&(e+="\n\nfloat fogVisibility = smoothstep(uMaxDist(), uMinDist(), abs(vWorldPosition.z));\nFragColor.a *= fogVisibility;\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},21185:function(t){var e=function(t){var e="";return e+="","pf"===t.slot&&(e+="\n\nIN vec2 vMossCoords;\n\n"),e+="\n\n","f"===t.slot&&(e+="\n\nfloat noise = texture2D(noiseTex, vMossCoords.xy * 0.5).r * 0.2;\nfloat mossLimit = uMossProgress() * uMossEndProgress();\nfloat mossAmount = smoothstep(\n  mossLimit, mossLimit - 0.1,\n  vMossCoords.y + noise\n);\nbaseColor().rgb = mix(baseColor().rgb, mossTex().rgb, mossAmount * mossTex().a);\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},90545:function(t){var e=function(t){var e="";return e+="","pv"===t.slot&&(e+="\n\nIN vec2 aTexCoord1;\nOUT vec2 vMossCoords;\n\n"),e+="\n\n","postv"===t.slot&&(e+="\n\nvMossCoords = aTexCoord1;\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},22720:function(t){var e=function(t){var e="";return e+="","pv"===t.slot&&(e+="\n#if __VERSION__ == 300\n    #define texture2D(a, b) texture( a, b )\n#endif\n\nmat4 rotationY(in float angle) {\n\treturn mat4(cos(angle),\t0, sin(angle), 0,\n\t\t\t \t0, 1.0, 0, 0,\n\t\t\t\t-sin(angle), 0, cos(angle),\t0,\n\t\t\t\t0, 0, 0, 1);\n}\n\n"),e+="\n\n","vertex_warp"===t.slot&&(e+="\n\nfloat noiseAngle = texture2D(noiseTex, vec2(uRotateTime() * 0.008 + uRotateSeed())).r * 0.5 - 0.25;\n\nvec4 pos = vec4(vertex.position, 1.0);\npos *= rotationY(noiseAngle);\n\nvertex.position.xyz = pos.xyz;\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},25957:function(t){var e=function(t){var e="";return e+="","f"===t.slot&&(e+="\n\nvec2 stretchCoords = "+t.originalVarying+";\nstretchCoords.x = stretchCoords.x * uScrollStretch() - uScrollStretchOffset();\nstretchCoords.x += uScrollOffset();\nstretchCoords.x *= uScrollScale();\nstretchCoords.x += uScrollTime();\n\n"),e+="\n",e};e.toString=e,t.exports=e,e.onHmr=function(){}},86619:function(t){var e=function(t){var e="";return e+="","postf"===t.slot&&(e+="\n\nfloat underwaterFactor = step(-0.02, vWorldPosition.y);\nvec3 underwater = mix(uUnderwaterColor(), FragColor.rgb, 0.4);\nFragColor.rgb = mix(underwater, FragColor.rgb, underwaterFactor);\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},1060:function(t){var e=function(t){var e="";return e+="","pf"===t.slot&&(e+="\n\n#define noiseOffsetBaseSize 0.2\n\nIN vec2 vNoiseCoords;\n\n"),e+="\n\n","f"===t.slot&&(e+="\n\nvec2 noiseCoords = vec2(vNoiseCoords.x, vNoiseCoords.y - uRiverScroll()) * vec2(0.4, 0.05);\nvec4 noise = texture2D(noiseTex, noiseCoords + uWaterTime() * vec2(0.05, -0.1));\n\nfloat noiseOffsetSize = noiseOffsetBaseSize * uOffsetScale();\nvec2 noiseOffset = vec2(noise.r, noise.b) * noiseOffsetSize - noiseOffsetSize * 0.5;\nvec2 offsetCoords = "+t.originalVarying+" + noiseOffset;\nvec2 customCoords = offsetCoords;\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},33618:function(t){var e=function(t){var e="";return e+="","pv"===t.slot&&(e+="\n\nOUT vec2 vNoiseCoords;\n\n"),e+="\n\n","vertex_warp_world"===t.slot&&(e+="\n\nvNoiseCoords = vertex.worldPos.xz;\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},15901:function(t){var e=function(t){var e="";return e+="\nvec3 ref = vec3(0.);\n#if enableFReflect\n{\n  vec2 screenUV = gl_FragCoord.xy / ScreenSize();\n  screenUV += vec2(sin(100. * (screenUV.y + uTime())) * 0.001, 0.);\n  ref = vec3(1.0) - texture2D( tFloorReflect, screenUV).rgb;\n  ref = ReflectionStrength() * ref; //pow( ref, vec3(2.2) );\n  lightingData.lightingColor += ref;\n}\n#endif",e};e.toString=e,t.exports=e,e.onHmr=function(){}},14462:function(t){var e=function(t){var e="";return e+="\nuniform sampler2D tFloorReflect;",e};e.toString=e,t.exports=e,e.onHmr=function(){}},79785:function(t,e,s){"use strict";var i=s(76670),r=s(42307);class o extends r.Z{constructor(){super(),this._type=i.Z.POINT,this._radius=0,this.radius=50}set castShadows(t){}get radius(){return this._radius}set radius(t){this._radius=t}projectionFromBounds(t){throw new Error("Shadow mapping not supported on point lights")}_createCamera(){throw new Error("Shadow mapping not supported on point lights")}getTexelBiasVector(){throw new Error("Shadow mapping not supported on point lights")}}e["Z"]=o},22369:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return fe}});var i=s(63887),r=s(2246),o=s(97703),a=s(50509),n=s(61987),h=s(62642),c=s(14888),l=s(88271),d=s(21370),u=s(5839),p=s(61221),m=s(55929),f=s(46381);class g{constructor(t=0,e,s,i){this.update=e,this.sheet=s,this.name=i;const r=s.object(i,{progress:f.types.number(t)});this._unsubscribe=r.onValuesChange((t=>{this.value=t.progress,this.update(this.value)})),this._obj=r}dispose(){this._unsubscribe(),this.sheet.detachObject(this.name)}}var v=s(89620),P=s(63132),S=s(28306);const k=2*Math.PI,M=i.vec3.fromValues(0,0,-10);class b{constructor(t,e,s,r,o,a){this.renderer=t,this.root=e,this.rockManager=s,this.ambientChunk=r,this.sheetSuccess=o,this.sheetPerfect=a,this.isJumping=!1,this.isRotating=!1,this.jumpAmount=0,this.nextRock=null,this.currentRock=null,this.rockTargetYSuccess=0,this.rockTargetYPerfect=0,this.direction=0,this.startPosition=i.vec3.create(),this.startRotation=i.quat.create(),this.targetPosition=i.vec3.create(),this.rotateDirection=0,this.barrelRotationStart=0,this.barrelRotationTarget=0,this.barrelRotationCurrent=0,this.updateRockTargetYSuccess=t=>{this.rockTargetYSuccess=.5*-t},this.updateRockTargetYPerfect=t=>{this.rockTargetYPerfect=.5*t},this.updatePositionPerfect=t=>{var e;const s=this.jumpAmount<S.L5[2]?0:1;null===(e=this.trail)||void 0===e||e.trailChunk.thicknessU.set(.8*(0,P.uZ)(1-(3*t-2),0,1)*s),i.vec3.lerp(this.node.position,this.startPosition,this.targetPosition,t),this.node.position[1]+=2*Math.sin(t*Math.PI),this.node.invalidate()},this.updateBarrelPerfect=t=>{this.barrelRotationCurrent=(0,l.Z)(this.barrelRotationStart,this.barrelRotationTarget,t)},this.updateRotationStraff=t=>{i.quat.lerp(this.node.rotation,this.startRotation,this.dummy.rotation,t),this.node.invalidate()},this.updateAnimStraff=t=>{this.moveLeftAnimation.time=t*this.moveLeftAnimation.duration,this.moveRightAnimation.time=t*this.moveRightAnimation.duration},this.updateJumpAnimPerfect=t=>{this.jumpAnimation.time=t*this.jumpAnimation.duration},this.node=new n.Z,this.root.add(this.node),this.dummy=new n.Z,this.trailNode=new n.Z,this.tileTexChunk=new m.Z(this.renderer),this.tileTexChunk.textureRepeatU.set(1e-5),this.tileTexChunk.textureOpacityU.set(.5);const h=new c.Z;h.overridePass("",((e,s)=>{const i=s.getPass("color").pass;return i.inputs.add(this.ambientChunk),i.inputs.add(this.tileTexChunk),i.mask=u.Z.BLENDED,i.glconfig.enableBlend().blendFunc(t.gl.SRC_ALPHA,t.gl.ONE_MINUS_SRC_ALPHA),null})),this.gltfRes=new p.ZP("scene3/frog.gltf",this.renderer.gl,{defaultTextureFilter:this.renderer.gl.LINEAR_MIPMAP_LINEAR,extensions:[h]})}get childNode(){return this.gltf.root}async load(){return this.gltfRes.load()}onLoaded(){this.gltf=this.gltfRes.gltf,this.node.add(this.childNode),this.skelRootNode=this.gltf.getNode("root"),this.createAnimationMixer()}createAnimationMixer(){this.animationMixer=new v.Z;const t=this.gltf.animations[0];this.jumpAnimation=new v.x(t),this.idleAnimation=new v.x(t),this.moveLeftAnimation=new v.x(t),this.moveRightAnimation=new v.x(t),this.jumpAnimation.range=[0,47/30],this.idleAnimation.range=[1.6,347/30],this.moveLeftAnimation.range=[11.6,362/30],this.moveRightAnimation.range=[365/30,385/30],this.animationMixer.addLayer(this.idleAnimation),this.animationMixer.addLayer(this.jumpAnimation),this.animationMixer.addLayer(this.moveLeftAnimation),this.animationMixer.addLayer(this.moveRightAnimation)}start(){var t;this.rockYSuccess=new g(0,this.updateRockTargetYSuccess,this.sheetSuccess,"Rocks / Start Rock Y"),this.rockYPerfect=new g(1,this.updateRockTargetYPerfect,this.sheetPerfect,"Rocks / Start Rock Y"),this.frogJumpAnimPerfect=new g(0,this.updateJumpAnimPerfect,this.sheetPerfect,"Frog / Jump"),this.frogPositionPerfect=new g(0,this.updatePositionPerfect,this.sheetPerfect,"Frog / Position"),this.frogBarrelPerfect=new g(0,this.updateBarrelPerfect,this.sheetPerfect,"Frog / Barrel"),this.isJumping=!1,this.currentRock=null,this.nextRock=null,this.direction=0,this.rotateDirection=0,this.rockTargetYSuccess=0,this.rockTargetYPerfect=0,this.barrelRotationStart=0,this.barrelRotationTarget=0,this.barrelRotationCurrent=0,this.jumpAnimation.weight=0,this.moveLeftAnimation.weight=0,this.moveRightAnimation.weight=0,this.idleAnimation.weight=1,i.quat.identity(this.childNode.rotation),this.childNode.rotateY(Math.PI),this.childNode.setScale(.5),this.childNode.invalidate(),this.node.invalidate(),this.node.updateWorldMatrix(),this.trailNode.z=.8,this.childNode.add(this.trailNode),this.trail=this.renderer.scene.trailManager.addTrail(this.trailNode,{color:[220/255,246/255,246/255],trailDistance:1,offset:[0,0,0],thickness:.8,drawImageFrameElapsed:1,mixBorder:0}),this.trail.trailChunk.alphaU.set(.9),null===(t=this.trail)||void 0===t||t.trailChunk.thicknessU.set(0),this.renderer.scene.trailManager.renderAbove=!0}stop(){this.rockYSuccess.dispose(),this.rockYPerfect.dispose(),this.frogBarrelPerfect.dispose(),this.frogJumpAnimPerfect.dispose(),this.frogPositionPerfect.dispose(),this.renderer.scene.trailManager.removeAll(),this.renderer.scene.trailManager.renderAbove=!1}setInitialRock(t){this.currentRock=t,this.nextRock=t,i.vec3.copy(this.node.position,t.frogPosition||[0,0,0]),this.dummy.position[0]=this.node.position[0],this.dummy.lookAt(M),i.quat.copy(this.node.rotation,this.dummy.rotation),this.node.invalidate(),this.node.updateWorldMatrix()}getNextRock(t){const e=this.rockManager.mainRocks.indexOf(this.currentRock),s=t<S.L5[1]?1:t<S.L5[2]?2:5+Math.floor(2*Math.random()),i=Math.min(e+s+Math.floor(Math.random()),this.rockManager.mainRocks.length-1);return this.rockManager.mainRocks[i]}prepareJump(t){if(this.jumpAmount=t,this.trail.syncWithObject(),i.vec3.copy(this.startPosition,this.node.position),this.nextRock=this.getNextRock(t),!this.nextRock)return;i.vec3.copy(this.targetPosition,this.nextRock.frogPosition||[0,0,0]),this.direction=Math.sign(this.startPosition[0]-this.targetPosition[0])||1,this.barrelRotationStart=this.barrelRotationCurrent;const e=t<S.L5[2]?0:k*this.direction;this.barrelRotationTarget=Math.round((this.barrelRotationCurrent+e)/k)*k}jumpEnded(){this.currentRock=this.nextRock,this.rockTargetYPerfect=0,this.doStraff()}updateRockY(){if(!this.currentRock)return;const t=this.currentRock.renderableNodes[0],e=Math.min(this.rockTargetYSuccess+this.rockTargetYPerfect,0)/t._wmatrix[5];t.y=(0,l.Z)(t.y,e,this.isJumping?.1:.01),t.invalidate(),t.updateWorldMatrix(),this.childNode.y=t._wposition[1],this.childNode.invalidate()}applyBarrelRotation(){i.quat.identity(this.skelRootNode.rotation),this.skelRootNode.rotateZ(this.barrelRotationCurrent)}doStraff(){this.isRotating=!0,this.rotateDirection=this.direction,i.quat.copy(this.startRotation,this.node.rotation),this.dummy.position[0]=this.node.position[0],this.dummy.lookAt(M);const t=h["default"].timeline({onComplete:()=>{this.isRotating=!1}}),e={rotation:0,anim:0};t.to(e,{rotation:1,duration:1,ease:"power1.inOut",onUpdate:()=>{this.updateRotationStraff(e.rotation)}},"0"),t.to(e,{anim:1,duration:1,ease:"linear",onUpdate:()=>{this.updateAnimStraff(e.anim)}},"0")}updateAnimation(){const t=this.isJumping,e=this.isRotating&&!this.isJumping,s=!t&&!e;this.jumpAnimation.weight=(0,l.Z)(this.jumpAnimation.weight,t?1:0,.1),this.idleAnimation.weight=(0,l.Z)(this.idleAnimation.weight,s?1:0,.1);const i=this.rotateDirection>0?this.moveRightAnimation:this.moveLeftAnimation,r=this.rotateDirection>0?this.moveLeftAnimation:this.moveRightAnimation;i.weight=(0,l.Z)(i.weight,e?1:0,.1),r.weight=0;const o=d.Z.time/1e3;this.idleAnimation.time=o,this.animationMixer.evaluate()}preRender(t){this.isJumping=t,this.tileTexChunk.timeU.set(d.Z.time),this.updateRockY(),this.updateAnimation(),this.applyBarrelRotation(),this.node.updateWorldMatrix()}render(t){for(const e of this.gltf.renderables)e.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}}var w=s(99840),R=s(65031),x=s(94292),C=s(49500),_=s(31236),y=s(79763),T=s(76879),L=s(22720),A=s.n(L);const Z=(0,T.Z)(A());class E extends y.Z{constructor(t){super(!0,!1),this.addChild(this.noise=new C.ZP("noise",4,C.Ho.VERTEX)),this.addChild(this.time=new C.ZP("uRotateTime",1,C.Ho.VERTEX)),this.addChild(this.seed=new C.ZP("uRotateSeed",1,C.Ho.VERTEX)),this.time.attachConstant(0),this.seed.attachConstant(0),this.noise.attachSampler("noiseTex").set(t),Z.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("pv",Z({slot:"pv"})),t.add("vertex_warp",Z({slot:"vertex_warp"}))}}var z=s(33618),F=s.n(z),N=s(1060),U=s.n(N);const D=(0,T.Z)(F()),O=(0,T.Z)(U());class H extends y.Z{constructor(t,e){super(!0,!1),this.addChild(this.waterNoise=new C.ZP("noise",4,C.Ho.FRAGMENT)),this.addChild(this.offsetScale=new C.ZP("uOffsetScale",1,C.Ho.FRAGMENT)),this.addChild(this.time=new C.ZP("uWaterTime",1,C.Ho.FRAGMENT)),this.addChild(this.scroll=new C.ZP("uRiverScroll",1,C.Ho.FRAGMENT)),this.timeUniform=this.time.attachUniform(),this.scrollUniform=this.scroll.attachUniform(),this.offsetScaleUniform=this.offsetScale.attachUniform(),this.waterNoise.attachSampler("noiseTex").set(e);const s=t.surface.baseColor.param;this.originalVarying=s._varying,s._varying="customCoords",D.onHmr((()=>this.invalidateCode())),O.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("pv",D({slot:"pv"})),t.add("vertex_warp_world",D({slot:"vertex_warp_world"})),t.add("pf",O({slot:"pf"})),t.add("f",O({slot:"f",originalVarying:this.originalVarying}))}}var V=s(25957),I=s.n(V);const W=(0,T.Z)(I());class j extends y.Z{constructor(t){super(!0,!1),this.addChild(this.time=new C.ZP("uScrollTime",1,C.Ho.FRAGMENT)),this.addChild(this.scale=new C.ZP("uScrollScale",1,C.Ho.FRAGMENT)),this.addChild(this.stretch=new C.ZP("uScrollStretch",1,C.Ho.FRAGMENT)),this.addChild(this.stretchOffset=new C.ZP("uScrollStretchOffset",1,C.Ho.FRAGMENT)),this.addChild(this.offset=new C.ZP("uScrollOffset",1,C.Ho.FRAGMENT)),this.timeUniform=this.time.attachUniform(),this.scaleUniform=this.scale.attachUniform(),this.offsetUniform=this.offset.attachUniform(),this.stretchUniform=this.stretch.attachUniform(),this.stretchOffsetUniform=this.stretchOffset.attachUniform();const e=t.surface.baseColor.param;this.originalVarying=e._varying,e._varying="stretchCoords",W.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("f",W({slot:"f",originalVarying:this.originalVarying}))}}var B=s(11668);class Y{constructor(t,e,s,i,r,o,a){this.renderer=e,this.root=s,this.ambientChunk=i,this.tileTexChunk=r,this.fogChunk=o,this.poolRadius=[],this.elemList=[];const n=new c.Z;n.overridePass("",((t,e)=>{e.name=t.data.name;const s=e.getPass("color").pass;return s.inputs.add(this.ambientChunk),a&&a(s,t.data.name),r&&s.inputs.add(this.tileTexChunk),o&&s.inputs.add(this.fogChunk),null})),this.poolRes=new p.ZP(t,this.renderer.gl,{defaultTextureFilter:this.renderer.gl.LINEAR_MIPMAP_LINEAR,extensions:[n]})}async load(){await this.poolRes.load()}onLoaded(){this.renderables=this.poolRes.gltf.renderables,this.pool=this.renderables.map((t=>[t])),this.poolRadius=[],this.setupRadius()}start(){this.elemList=[]}setupRadius(t=this.pool,e=this.poolRadius,s=!1){for(const i of t){const t=[],r=[];for(const e of i){const i=e.bounds.min,o=e.bounds.max,a=e.node,n=s?a.scale:[1,1,1],h=Math.max(Math.abs(o[0])*n[0],Math.abs(i[0])*n[0],Math.abs(o[2])*n[2],Math.abs(i[2])*n[2]);t.push(h),s?r.push(Math.max(Math.abs(o[0]+a.x)*n[0],Math.abs(i[0]+a.x)*n[0],Math.abs(o[2]+a.z)*n[2],Math.abs(i[2]+a.z)*n[2])):r.push(h)}const o=Math.max(...r);e.push({list:t,global:o})}}addElem(t){this.elemList.push(t),t.node.invalidate(),t.node.updateWorldMatrix()}removeElem(t,e){t<=-1||this.elemList.splice(t,1)}}const J=.8*S.jk,G=[0,.25,.408];class X extends Y{constructor(t,e,s,i,r,o){const a=new n.Z;e.add(a);const h=new E(r),c=new m.Z(t);super("scene3/water.gltf",t,a,s,null,i,((e,s)=>{const i=[];if(-1===e.inputs._chunks.findIndex((t=>t instanceof H))){const t=new H(e,r);this.waterDistortChunks.set(s||"default",t),e.inputs._chunks.unshift(t),e.inputs.invalidateList()}if(s.startsWith("paint_scroll")){if(-1===e.inputs._chunks.findIndex((t=>t instanceof j))){const t=new j(e);this.waterScrollChunks.set(s||"default",t),e.inputs._chunks.splice(1,0,t),e.inputs.invalidateList(),i.push(e.alphaFactor.attachUniform())}}else e.inputs.add(h),e.inputs.add(c),e.alphaFactor.attachConstant(.8);e.alphaMode.set("BLEND"),e.surface.roughnessFactor.attachConstant(1),e.mask=u.Z.BLENDED,e.glconfig.enableBlend().depthMask(!1).blendFunc(t.gl.SRC_ALPHA,t.gl.ONE_MINUS_SRC_ALPHA),this.createWaterReflection(e,o),i.unshift(e.surface.baseColor.attachUniform()),this.waterColorUniforms.set(s||"default",i)})),this.time=0,this.stretch=1,this.worldScroll=0,this.scrollOffset=0,this.speedProgress=0,this.stretchOffset=1,this.stretchLastAdd=0,this.currentZ=3,this.renderables=[],this.elemList=[],this.renderElemList=[],this.paintScrollSize=1,this.paintScrollElemList=[],this.waterScrollChunks=new Map,this.waterColorUniforms=new Map,this.waterDistortChunks=new Map,this.tileTexChunk=c,this.waterRotateTime=h.time.attachUniform(),this.waterRotateSeed=h.seed.attachUniform()}createWaterReflection(t,e){if(!t)return;const s=new B.Z;s.reflectionTexture=this.renderer.reflect.getOutput(),t.inputs.add(s),s.strength.attach(e)}onLoaded(){const t=this.poolRes.gltf;this.pool=[],this.renderables=t.renderables;for(const e of t.renderables)"Plane_scroll"!==e.node.name?this.pool.push([e]):(this.paintScrollRenderable=e,this.paintScrollSize=e.bounds.max[2]-e.bounds.min[2]);this.setupRadius()}start(){super.start(),this.time=0,this.stretch=1,this.worldScroll=0,this.scrollOffset=0,this.stretchOffset=1,this.stretchLastAdd=0,this.renderElemList=[],this.root.y=0,this.root.invalidate(),this.root.updateWorldMatrix(),this.setupPaintScrollElems()}setupPaintScrollElems(){this.paintScrollElemList=[];const t=[],e=[],s=[];for(const n of this.paintScrollRenderable.materials){const i=this.waterScrollChunks.get(n.name);i&&t.push(i);const r=this.waterDistortChunks.get(n.name);r&&s.push(r);const o=this.waterColorUniforms.get(n.name);o&&e.push(o)}const i=new n.Z,r=.4*J,o=9*r,a=Math.random();i.y=-1e-4,i.x=.05*J,i.scale[0]=r,i.scale[2]=S.f5,i.invalidate(),i.updateWorldMatrix(),this.paintScrollElemList.push({node:i,seed:a,speed:1/o*.75,alpha:1,color:[.258,.551,.608],scale:i.scale[2]/o,distortScale:1/r*.8,scrollChunks:t,distortChunks:s,colorUniforms:e});const h=new n.Z,c=.5*J,l=4*c,d=(a+.3+.2*Math.random())%1;h.y=-2e-4,h.x=.1*-J,h.scale[0]=c,h.scale[2]=S.f5,h.invalidate(),h.updateWorldMatrix(),this.paintScrollElemList.push({node:h,seed:d,speed:1/l*.5,alpha:.7,color:[.208,.501,.558],scale:h.scale[2]/l,distortScale:1/c*.8,scrollChunks:t,distortChunks:s,colorUniforms:e});const u=new n.Z,p=.1*J,m=15*p,f=Math.random();u.x=.3*J,u.y=1e-4,u.scale[0]=p,u.scale[3]=S.f5,u.invalidate(),u.updateWorldMatrix(),this.paintScrollElemList.push({node:u,seed:f,alpha:1,color:[.458,.751,.808],speed:1/m*1.3,scale:u.scale[3]/m,distortScale:1/p*.8,scrollChunks:t,distortChunks:s,colorUniforms:e});const g=new n.Z,v=.15*J,P=10*v,k=(f+.4+.2*Math.random())%1;g.x=.05*-J,g.y=1e-4,g.scale[0]=v,g.scale[2]=S.f5,g.invalidate(),g.updateWorldMatrix(),this.paintScrollElemList.push({node:g,seed:k,alpha:1,color:[.458,.751,.808],speed:1/P*1.6,scale:g.scale[2]/P,distortScale:1/v*.8,scrollChunks:t,distortChunks:s,colorUniforms:e});for(const n of this.paintScrollElemList)this.renderElemList.push({y:n.node._wposition[1],elem:n,type:"scroll"})}elemFromData(t,e,s,i=!1){const r=Math.floor(Math.random()*this.pool.length),o=[...this.pool[r]],a=this.poolRadius[r].global*e,h=new n.Z;this.root.add(h);const c=i?a:0;h.position.set([t[0],t[1],t[2]-c]),h.rotateY(2*Math.PI*Math.random()),h.setScale(e);const l=[],d=[];for(const n of o)for(const t of n.materials){const e=this.waterDistortChunks.get(t.name);e&&l.push(e);const s=this.waterColorUniforms.get(t.name);s&&d.push(s)}return{node:h,seed:Math.random(),color:s,radius:a,renderables:o,distortChunks:l,colorUniforms:d}}createElem(t=!1){const e=Math.random(),s=.5+.3*(1-e),i=[(t?.2*Math.random()-.1:.8*Math.random()-.4)*J,-1-4*e,t?this.currentZ:this.currentZ-Math.random()*J*2],r=(t?.6+.2*Math.random():.1+.4*Math.random())*J,o=G.map((t=>t*s));return this.elemFromData(i,r,o,!0)}addElem(t,e=!1){super.addElem(t),this.renderElemList.push({y:t.node._wposition[1],elem:t,type:"splash"}),this.renderElemList.sort(((t,e)=>t.y-e.y)),e&&(this.currentZ=t.node.z-t.radius*(.5*Math.random()))}removeElem(t,e){super.removeElem(t,e);const s=this.renderElemList.findIndex((t=>t.elem===e));s<=-1||this.renderElemList.splice(s,1)}scroll(t){this.scrollOffset+=(t-this.worldScroll)/S.f5*this.stretch,this.worldScroll=t}preRender(t){this.tileTexChunk.timeU.set(d.Z.time);const e=.001*d.Z.dt;this.time+=e*(1+t);const s=1/(1+12*t),i=this.renderer.scene.blockHold||s>this.stretch?(0,l.Z)(this.stretchLastAdd,0,.01):s-this.stretch;this.stretchOffset+=i,this.stretch=s,this.stretchLastAdd=i,this.speedProgress=t}renderPaintScroll(t,e){var s,r;if(this.paintScrollRenderable){for(const t of e.scrollChunks)t.offsetUniform.set(this.scrollOffset+e.seed),t.scaleUniform.set(e.scale),t.timeUniform.set(this.time*e.speed);for(const t of e.distortChunks)t.timeUniform.set(this.time),t.offsetScaleUniform.set(e.distortScale);for(const t of e.colorUniforms)null===(s=t[0])||void 0===s||s.set(...e.color),null===(r=t[1])||void 0===r||r.set(e.alpha);i.mat4.copy(this.paintScrollRenderable.node._wmatrix,e.node._wmatrix),this.paintScrollRenderable.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}}renderPaintSplash(t,e){var s;this.waterRotateSeed.set(e.seed),this.tileTexChunk.textureRepeatU.set(.2*e.radius);for(const i of e.distortChunks)i.offsetScaleUniform.set(e.radius>0?1/e.radius:1);for(const i of e.colorUniforms)null===(s=i[0])||void 0===s||s.set(...e.color);for(const r of e.renderables)i.mat4.copy(r.node._wmatrix,e.node._wmatrix),r.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}render(t){for(const e of this.waterDistortChunks.values())e.timeUniform.set(this.time),e.scrollUniform.set(this.worldScroll);for(const e of this.waterScrollChunks.values())e.stretchUniform.set(this.stretch),e.stretchOffsetUniform.set(this.stretchOffset);this.waterRotateTime.set(this.time);for(const e of this.renderElemList)"scroll"!==e.type?this.renderPaintSplash(t,e.elem):this.renderPaintScroll(t,e.elem)}}const q=[1/S.jk,-1/S.n9],K=.5*S.f5,$=K-S.It;class Q{constructor(t,e,s,r,o,a,h){this.renderer=t,this.sheetSuccess=s,this.sheetPerfect=r,this.noiseTex=h,this.time=0,this.speedProgress=0,this.relativeScroll=0,this.rippleTime=0,this.rippleSeed=i.vec2.fromValues(Math.random(),Math.random()),this.rippleSize=i.vec2.fromValues(0,0),this.ripplePosition=i.vec4.fromValues(.5,.5,.5,.5),this.rippleStartSizeTarget=0,this.rippleStartSizeFactor=0,this.floorReflectivity=.07,this.updateRippleEndSize=t=>{this.rippleSize[1]=t},this.updateRippleStartSize=t=>{this.rippleStartSizeTarget=t},this.floorReflectivityUniform=new C.xW("fru",1),this.floorReflectivityUniform.set(this.floorReflectivity),this.root=new n.Z,this.waterNode=new n.Z,this.root.add(this.waterNode),this.heatmapTex=new R.Z(t.gl,t.gl.RGBA),this.paintManager=new X(t,e,o,a,this.noiseTex,this.floorReflectivityUniform),this.waterEffectsPrg=(0,_["default"])(t.gl).get("river"),this.glconfig=x.Z.get(t.gl).config().enableBlend(!0).enableDepthTest(!0).blendFunc(t.gl.SRC_ALPHA,t.gl.ONE_MINUS_SRC_ALPHA)}async load(){return Promise.all([this.paintManager.load()])}onLoaded(){this.paintManager.onLoaded()}start(){this.quad=new w.Z(this.renderer.gl,-.5,-.5,1,1),this.rippleSizeSuccess=new g(0,(t=>this.updateRippleStartSize(t)),this.sheetSuccess,"Ripples / Start Ripple Size"),this.endRippleSizePerfect=new g(0,(t=>this.updateRippleEndSize(t)),this.sheetPerfect,"Ripples / End Ripple Size"),this.time=0,this.speedProgress=0,this.relativeScroll=0,this.waterNode.z=-.02,this.waterNode.scale[0]=S.jk,this.waterNode.scale[1]=S.f5,this.waterNode.invalidate(),this.root.rotation.set([0,0,0,1]),this.root.rotateX(-Math.PI/2),this.root.invalidate(),this.root.updateWorldMatrix(),this.paintManager.start()}stop(){this.quad.dispose(),this.rippleSizeSuccess.dispose(),this.endRippleSizePerfect.dispose()}scroll(t){this.relativeScroll=t/this.waterNode.scale[1],this.paintManager.scroll(t)}prepareStartRock(t){this.prepareRipple(t),this.rippleSize[1]=0,this.rippleStartSizeFactor=1}prepareJump(t){this.prepareRipple(t,!0),this.rippleStartSizeFactor=0}prepareRipple(t,e=!1){const s=e?1:0;this.rippleSeed[s]=e?Math.random():this.rippleSeed[1],this.rippleSize[s]=e?0:this.rippleSize[1],this.ripplePosition[2*s]=t.node.x/(.5*S.jk)*.5+.5,this.ripplePosition[2*s+1]=-t.node.z/(.5*this.waterNode.scale[1])*.5+.5}preRender(t,e){this.speedProgress=t;const s=.001*d.Z.dt;this.time+=s*(1+t),this.rippleTime+=.5*s,this.rippleSize[0]=(0,l.Z)(this.rippleSize[0],this.rippleStartSizeTarget*this.rippleStartSizeFactor,e?.02:.05),this.paintManager.preRender(t)}renderWaterEffects(t){this.heatmapCvs&&this.heatmapTex.fromImage(this.heatmapCvs),this.quad.attribPointer(this.waterEffectsPrg),this.waterEffectsPrg.use(),this.waterEffectsPrg.uTime(this.time),this.waterEffectsPrg.uAlpha(1),this.waterEffectsPrg.tNoise(this.noiseTex),this.waterEffectsPrg.uScroll(this.relativeScroll),this.waterEffectsPrg.tHeatmap(this.heatmapTex),this.waterEffectsPrg.uMinDist($),this.waterEffectsPrg.uMaxDist(K),this.waterEffectsPrg.uQuadRatio(S.wH),this.waterEffectsPrg.uSpeedProgress(this.speedProgress),this.waterEffectsPrg.uRippleSeed(this.rippleSeed),this.waterEffectsPrg.uHeatmapScale(q),this.waterEffectsPrg.uRippleTime(this.rippleTime),this.waterEffectsPrg.uRippleSize(this.rippleSize),this.waterEffectsPrg.uRipplePosition(this.ripplePosition),this.waterEffectsPrg.uVP(t.camera._viewProj),this.waterEffectsPrg.uWorldMatrix(this.waterNode._wmatrix),this.quad.render()}render(t){t.mask===u.Z.BLENDED&&(this.paintManager.render(t),this.glconfig.apply(),this.renderWaterEffects(t))}}var tt=s(39650),et=s(76881),st=s(18158);const it=8,rt=.5*S.f5,ot=rt-S.It,at=1;class nt{constructor(t,e,s,r,o){this.renderer=t,this.count=e,this.color=s,this.sheetSuccess=r,this.noiseTex=o,this.canRender=!1,this.groupCount=[0,0],this.availableIdx=[],this.particlesData=[],this.time=0,this.maxDistX=1,this.boundsSize=i.vec3.create(),this.worldScroll=0,this.scale=[0,0],this.updateScale=(t,e)=>{this.scale[e]=t},this.prg=(0,_["default"])(t.gl).get("river-particles"),this.cfg=x.Z.get(t.gl).config(),this.cfg.enableDepthTest(!0).depthMask(!1).enableBlend(!0).blendFunc(t.gl.SRC_ALPHA,t.gl.ONE)}start(){this.vbuffer=new st.Z(this.renderer.gl),this.vbuffer.attrib("aPosScale",4,this.renderer.gl.FLOAT).attrib("aSettings",4,this.renderer.gl.FLOAT),this.scaleSuccess=[];for(let t=0;t<this.scale.length;t++){const e=`Particles / Size / Group ${t}`;this.scaleSuccess[t]=new g(0,(e=>this.updateScale(e,t)),this.sheetSuccess,e)}this.time=0,this.worldScroll=0,this.bounds=new et.Z,this.varray=new Float32Array(this.count*it),this.vbuffer.data(this.varray),this.scale=[0,0],this.groupCount=[0,0],this.availableIdx=Array.from({length:this.count},((t,e)=>e)),this.particlesData=[]}stop(){this.vbuffer.dispose();for(const t of this.scaleSuccess)t.dispose()}updateBounds(t,e){this.bounds.fromMinMax(t,e),this.boundsSize[0]=this.bounds.max[0]-this.bounds.min[0],this.boundsSize[1]=this.bounds.max[1]-this.bounds.min[1],this.boundsSize[2]=this.bounds.max[2]-this.bounds.min[2],this.maxDistX=.5*this.boundsSize[0]}addParticles(){for(let t=0;t<this.availableIdx.length;t++){const e=this.availableIdx[t],s=[],i={z:0,group:0};s[0]=this.bounds.min[0]+Math.random()*this.boundsSize[0],s[1]=this.bounds.min[1]+Math.random()*this.boundsSize[1],s[2]=-this.worldScroll+this.bounds.min[2]+Math.random()*this.boundsSize[2],i.z=s[2],s[3]=.66*Math.random()+.33;const r=this.groupCount[0]<.5*this.count?0:1;s[4]=r,i.group=r,this.groupCount[r]++,s[5]=.5*Math.random()+.1,s[6]=5*Math.random()+6,s[7]=1.5*Math.random()+.2,this.varray.set(s,e*it),this.particlesData[e]=i}this.vbuffer.data(this.varray),this.availableIdx=[]}removeParticle(t){const e=this.particlesData[t];this.availableIdx.push(t),this.groupCount[e.group]--}scroll(t){this.worldScroll=t}preRender(t){this.time+=.001*d.Z.dt*(1+t),this.canRender=this.scale[0]+this.scale[1]>0}render(t){this.canRender&&(this.prg.use(),this.prg.uProjection(t.camera.lens.getProjection()),this.prg.uView(t.camera._view),this.prg.uColor(this.color),this.prg.uTime(this.time),this.prg.uScale(this.scale),this.prg.uNoise(this.noiseTex),this.prg.uOffset(this.worldScroll),this.prg.uMaxSize(8),this.prg.uMinDistZ(ot),this.prg.uMaxDistZ(rt),this.prg.uMinDistX(at),this.prg.uMaxDistX(this.maxDistX),this.cfg.apply(),this.vbuffer.attribPointer(this.prg),this.vbuffer.drawPoints())}}var ht=s(42946),ct=s(95952),lt=s.n(ct);const dt=(0,T.Z)(lt()),ut=.5*S.f5;class pt extends y.Z{constructor(){super(!0,!1),this.addChild(this.cameraY=new C.ZP("uCameraY",1,C.Ho.FRAGMENT)),this.addChild(this.minDistZ=new C.ZP("uMinDistZ",1,C.Ho.FRAGMENT)),this.addChild(this.maxDistZ=new C.ZP("uMaxDistZ",1,C.Ho.FRAGMENT)),this.addChild(this.minLimitY=new C.ZP("uMinLimitY",1,C.Ho.FRAGMENT)),this.addChild(this.maxLimitY=new C.ZP("uMaxLimitY",1,C.Ho.FRAGMENT)),this.minDistZ.attachConstant(ut-2*S.It),this.maxDistZ.attachConstant(ut),this.minLimitY.attachConstant(0),this.maxLimitY.attachConstant(5),this.cameraYUniform=this.cameraY.attachUniform(),dt.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("postf",dt({slot:"postf"}))}}const mt=.05,ft=.5*S.f5;class gt{constructor(t,e,s){this.renderer=t,this.sheetSuccess=s,this.time=0,this.stretch=1,this.stretchOffset=1,this.speedProgress=0,this.stretchLastAdd=0,this.cloudsList=[],this.updateSpeedProgress=t=>{this.speedProgress=t},this.root=new n.Z;const i=new pt;i.minDistZ.attachConstant(0),i.maxDistZ.attachConstant(ft);const r=new c.Z;r.overridePass("",((s,r)=>{const o=r.getPass("color").pass;if(-1===o.inputs._chunks.findIndex((t=>t instanceof j))){const t=new j(o);t.scaleUniform.set(1),this.scrollChunk=t,o.inputs._chunks.unshift(t),o.inputs.invalidateList()}return this.alphaUniform=o.alphaFactor.attachUniform(),o.inputs.add(e),o.alphaMode.set("BLEND"),o.mask=u.Z.BLENDED,o.glconfig.enableBlend().depthMask(!1).blendFunc(t.gl.SRC_ALPHA,t.gl.ONE_MINUS_SRC_ALPHA),o.inputs.add(i),null})),this.fogChunk=i,this.gltfRes=new p.ZP("scene3/clouds.gltf",this.renderer.gl,{defaultTextureFilter:this.renderer.gl.LINEAR_MIPMAP_LINEAR,extensions:[r]})}async load(){return this.gltfRes.load()}onLoaded(){this.gltf=this.gltfRes.gltf}start(){this.speedSuccess=new g(0,this.updateSpeedProgress,this.sheetSuccess,"Clouds / Speed"),this.time=0,this.stretch=1,this.stretchOffset=1,this.speedProgress=0,this.stretchLastAdd=0,this.root.y=6,this.root.scale[0]=.5*S.jk,this.root.scale[2]=S.f5,this.setupClouds(),this.root.invalidate(),this.root.updateWorldMatrix()}stop(){this.speedSuccess.dispose()}setupClouds(){this.cloudsList=[];const t=new n.Z;t.y=1,t.scale[1]=.05*this.root.scale[2],this.root.add(t),this.cloudsList.push({node:t,seed:Math.random(),alpha:.6,speed:.2});const e=new n.Z;e.y=-1,e.scale[1]=.025*this.root.scale[2],this.root.add(e),this.cloudsList.push({node:e,seed:Math.random(),alpha:1,speed:.4})}preRender(){this.time+=.001*d.Z.dt*mt*(1+this.speedProgress);const t=1/(1+15*this.speedProgress),e=this.renderer.scene.blockHold||t>this.stretch?(0,l.Z)(this.stretchLastAdd,0,.01):t-this.stretch;this.stretchOffset+=e,this.stretch=t,this.stretchLastAdd=e}render(t){for(const e of this.cloudsList){this.scrollChunk.timeUniform.set(this.time*e.speed),this.scrollChunk.scaleUniform.set(2),this.scrollChunk.offsetUniform.set(.5*e.seed),this.scrollChunk.stretchUniform.set(this.stretch),this.scrollChunk.stretchOffsetUniform.set(this.stretchOffset),this.fogChunk.cameraYUniform.set(t.camera._wposition[1]),this.alphaUniform.set(e.alpha);for(const s of this.gltf.renderables)i.mat4.copy(s.node._wmatrix,e.node._wmatrix),s.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}}}class vt extends Y{constructor(t,e,s,i,r){const o=new m.Z(t);super("scene3/lilypads.gltf",t,e,s,o,i,((e,s)=>{"Lotus"!==s&&e.alphaMode.set("BLEND"),e.mask=u.Z.BLENDED,e.glconfig.enableBlend().blendFunc(t.gl.SRC_ALPHA,t.gl.ONE_MINUS_SRC_ALPHA)})),this.sheetSuccess=r,this.currentZ=3,this.renderLotus=!1,this.lotusPool=[],this.renderables=[],this.poolPositionNodes=[]}onLoaded(){this.pool=[],this.lotusPool=[],this.renderables=this.poolRes.gltf.renderables;const t=new Map;for(const e of this.renderables){const s=e.node.name;if(s.startsWith("Lotus")){const i=s.split("_"),r=i[1],o=i[2],a=t.get(r)||[];a.push({name:o,renderable:e}),t.set(r,a)}else this.pool.push([e]),this.poolPositionNodes.push(e.node._children[0]||new n.Z)}t.forEach((t=>{t.sort(((t,e)=>t.name<e.name?-1:1)),this.lotusPool.push(t)})),this.setupRadius()}start(){super.start(),this.lotusScaleSuccess=[];for(let t=0;t<4;t++)this.lotusScaleSuccess.push(new g(0,(e=>this.updateLotusScale(e,t+1)),this.sheetSuccess,`Lotus / Part ${t+1}`))}stop(){for(const t of this.lotusScaleSuccess)t.dispose()}createElem(){var t;const e=new n.Z;this.root.add(e);const s=Math.floor(Math.random()*this.pool.length),r=1+.2*Math.random(),o=this.poolRadius[s].global*r;e.x=10*Math.random()-5,e.z=this.currentZ-o,e.rotateY(Math.random()*Math.PI*2),e.setScale(r);const a=[...this.pool[s]],h=a.map((()=>null)),c=Math.floor(Math.random()*this.lotusPool.length),l=this.lotusPool[c];for(let u=0;u<l.length;u++){const r=l[u],o=new n.Z;e.add(o),i.vec3.copy(o.position,this.poolPositionNodes[s].position),o.setScale((null===(t=this.lotusScaleSuccess[u])||void 0===t?void 0:t.value)||0),a.push(r.renderable),h.push(o)}const d={node:e,seed:Math.random(),target:i.vec3.fromValues(e.x,0,e.z+1),radius:o,renderables:a,renderableNodes:h};return d}updateZ(t){this.currentZ=t.node.z-t.radius-5-10*Math.random()}updateLotusScale(t,e){var s;for(const r of this.elemList){const o=null===(s=r.renderableNodes)||void 0===s?void 0:s[e];o&&(i.quat.identity(o.rotation),o.rotateY(t*(2*Math.PI/3)),o.setScale(t))}}preRender(){this.renderLotus=this.renderer.scene.holdValue>0,this.tileTexChunk.timeU.set(d.Z.time)}render(t){var e;for(const s of this.elemList){this.tileTexChunk.textureRepeatU.set(.2*s.radius);for(const[r,o]of s.renderables.entries()){if(r>0&&!this.renderLotus)break;const a=(null===(e=s.renderableNodes)||void 0===e?void 0:e[r])||s.node;i.mat4.copy(o.node._wmatrix,a._wmatrix),o.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}}}}const Pt=20,St=70,kt=20,Mt=8,bt=512,wt=[S.Hs/2,-S.Hs/2],Rt=i.vec3.create(),xt=i.vec3.create(),Ct=i.vec3.create(),_t=i.vec3.fromValues(0,1,0),yt=i.vec3.create();class Tt{constructor(t){this.river=t,this.isSetup=!1,this.heatmapInvalid=!1,this.worldToCanvas=[1,1],this.offset=0,this.prevOffset=0}get frog(){return this.river.frog}get rockManager(){return this.river.rockManager}get lilypadManager(){return this.river.lilypadManager}get waterPaintManager(){return this.river.water.paintManager}get particlesManager(){return this.river.particles}get rockList(){return this.rockManager.elemList}get lilypadList(){return this.lilypadManager.elemList}get waterPaintList(){return this.waterPaintManager.elemList}start(){this.canvas=document.createElement("canvas"),this.canvas.width=bt,this.canvas.height=bt*(S.n9/S.jk),this.worldToCanvas=[this.canvas.width/S.jk,this.canvas.height/S.n9],this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.offset=this.river.root.z,this.prevOffset=this.offset,this.setupElems(),this.heatmapInvalid=!0}stop(){this.canvas.remove(),this.canvas=null}setupElems(){this.isSetup=!0,this.setupRocks(),this.updateHeatmap(),this.setupLilypads(),this.setupWaterPaint(),this.setupParticles()}setupRocks(){if(this.rockManager.currentZ=wt[0],this.addRocks(),this.frog.currentRock)return;let t=1/0,e=null;for(const s of this.rockManager.mainRocks){const i=Math.abs(s.node.z);if(!(i<=t)){this.river.setInitialRock(e);break}e=s,t=i}this.heatmapInvalid=!0}setupLilypads(){this.lilypadManager.currentZ=wt[0];let t=0;t:while(this.lilypadManager.currentZ+this.offset>wt[1]&&this.lilypadList.length<Pt&&t<kt){t++;const e=this.lilypadManager.createElem();let s=0,i=!0;while(i&&s<Mt){const[t,r,o]=this.getHeatmapDimensions(e.node.x,e.node.z,e.radius),a=t-o,n=r-o,h=2*o-Math.max(0,0-a),c=2*o-Math.max(0,0-n);if(h<1||c<1)break t;const l=this.ctx.getImageData(Math.max(a,0),Math.max(n,0),h,c);l.data.includes(255)?(e.node.z-=2*e.radius,s++):(this.lilypadManager.addElem(e),this.lilypadManager.updateZ(e),i=!1)}}}setupWaterPaint(){this.waterPaintManager.currentZ=wt[0],this.addWaterPaint()}setupParticles(){this.particlesManager.updateBounds([.3*-S.jk,.5,wt[1]],[.3*S.jk,5,wt[0]]),this.particlesManager.addParticles(),this.particlesManager.updateBounds([.3*-S.jk,.5,wt[1]-4],[.3*S.jk,5,wt[1]])}removeElems(){this.remove(this.lilypadManager),this.prevOffset!==this.offset&&(this.remove(this.rockManager),this.remove(this.waterPaintManager,!0),this.removeParticles())}addElems(){this.addLilypads(),this.prevOffset!==this.offset&&(this.addRocks(),this.addWaterPaint(),this.addParticles())}remove(t,e=!1){for(let s=0;s<t.elemList.length;s++){const i=t.elemList[s],r=i.node.z-i.radius+this.offset;if(r<=wt[0]){if(e)continue;break}t.removeElem(s,i)}}addRocks(){let t=0;while(this.rockManager.currentZ+this.offset>wt[1]&&this.rockManager.mainRocks.length<Pt&&t<kt){t++;const e=this.rockManager.createElem();this.rockManager.addElem(e);for(const[t,s]of this.lilypadList.entries()){const r=i.vec3.distance(e.node.position,s.node.position)-s.radius;r>e.radius||this.lilypadManager.removeElem(t,s)}}}addLilypads(){const t=this.lilypadList[this.lilypadList.length-1];if(t&&t.node.z-t.radius+this.offset<=wt[1])return;this.lilypadManager.currentZ=wt[1]-this.offset-5-10*Math.random();const e=this.lilypadManager.createElem();this.lilypadManager.addElem(e)}addWaterPaint(){let t=0;while(this.waterPaintManager.currentZ+this.offset>wt[1]-S.qc&&this.waterPaintList.length<St&&t<kt){t++;const e=this.waterPaintManager.createElem(!0),s=Math.floor(2*Math.random());for(let t=0;t<s;t++){const t=this.waterPaintManager.createElem();this.waterPaintManager.addElem(t)}this.waterPaintManager.addElem(e,!0)}}addParticles(){this.particlesManager.addParticles()}removeParticles(){for(let t=0;t<this.particlesManager.particlesData.length;t++){const e=this.particlesManager.particlesData[t].z,s=e+this.offset;s<=wt[0]||this.particlesManager.removeParticle(t)}}updateLilypads(t){for(const e of this.lilypadList){e.target[2]=e.node.z+5,i.vec3.subtract(Rt,e.target,e.node.position),i.vec3.normalize(Rt,Rt),Ct.set([0,0,0]),xt.set([0,0,0]);let s=0;for(const t of this.rockList){const r=i.vec3.distance(e.node.position,t.node.position)-e.radius-t.radius;if(!(r>t.radius)){s=1-r/t.radius,i.vec3.subtract(Ct,e.node.position,t.node.position),_t[1]=Ct[0]>=0?1:-1,i.vec3.cross(xt,Ct,_t),i.vec3.normalize(Ct,Ct),i.vec3.normalize(xt,xt);break}}i.vec3.scale(Rt,Rt,1-s),i.vec3.scaleAndAdd(yt,Rt,xt,.8*s),i.vec3.scaleAndAdd(yt,yt,Ct,.2*s),i.vec3.scale(yt,yt,d.Z.dt*S.bk*t),yt[0]+=.1*Math.cos(.001*d.Z.time+e.seed*Math.PI)*d.Z.dt*S.bk,e.node.rotateY(yt[0]),i.vec3.add(e.node.position,e.node.position,yt),e.node.invalidate(),e.node.updateWorldMatrix()}}updateFlowElems(t){this.updateLilypads(t)}getHeatmapDimensions(t,e,s){const i=.5*this.canvas.width+t*this.worldToCanvas[0],r=.5*this.canvas.height+e*this.worldToCanvas[1],o=s*this.worldToCanvas[0];return[i,r,o]}drawElem(t,e,s){this.ctx.globalCompositeOperation="lighten";const i=2*s/this.canvas.width*255,r=this.ctx.createRadialGradient(t,e,0,t,e,2*s);r.addColorStop(0,`rgba(255, 255, ${i}, 1)`),r.addColorStop(.5,`rgba(255, 127.5, ${i}, 1)`),r.addColorStop(1,`rgba(0, 0, ${i}, 1)`),this.ctx.fillStyle=r,this.ctx.beginPath(),this.ctx.arc(t,e,2*s,0,2*Math.PI),this.ctx.fill()}updateHeatmap(){if(this.heatmapInvalid){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);for(const t of this.rockList)for(const[e,s]of t.radiusList.entries()){const[i,r,o]=this.getHeatmapDimensions(t.renderableNodes[e]._wposition[0],t.renderableNodes[e]._wposition[2],s);this.drawElem(i,r,o)}this.heatmapInvalid=!1}}preRender(t){this.isSetup&&(this.prevOffset=this.offset,this.offset=this.river.root.z,this.offset!==this.prevOffset&&(this.heatmapInvalid=!0),this.removeElems(),this.updateHeatmap(),this.updateFlowElems(1+4*t),this.addElems())}}var Lt=s(90545),At=s.n(Lt),Zt=s(21185),Et=s.n(Zt);const zt=(0,T.Z)(At()),Ft=(0,T.Z)(Et());class Nt extends y.Z{constructor(t,e,s){super(!0,!1),this.addChild(this.mossNoise=new C.ZP("noise",4,C.Ho.FRAGMENT)),this.addChild(this.mossTexture=new C.ZP("mossTex",4,C.Ho.FRAGMENT)),this.addChild(this.mossProgress=new C.ZP("uMossProgress",1,C.Ho.FRAGMENT)),this.addChild(this.mossEndProgress=new C.ZP("uMossEndProgress",1,C.Ho.FRAGMENT)),this.mossProgressUniform=this.mossProgress.attachUniform(),this.mossEndProgressUniform=this.mossEndProgress.attachUniform(),this.mossNoise.attachSampler("noiseTex").set(e);const i=s.surface.baseColor.param,r=this.mossTexture.attachSampler("mossTex",i.texCoords,"rgb");r.colorspace=i.colorspace,r.set(t),zt.onHmr((()=>this.invalidateCode())),Ft.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("pv",zt({slot:"pv"})),t.add("postv",zt({slot:"postv"})),t.add("pf",Ft({slot:"pf"})),t.add("f",Ft({slot:"f"}))}}var Ut=s(86619),Dt=s.n(Ut);const Ot=(0,T.Z)(Dt());class Ht extends y.Z{constructor(){super(!0,!1),this.addChild(this.color=new C.ZP("uUnderwaterColor",3,C.Ho.FRAGMENT)),this.color.attachConstant(S.TC),Ot.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("postf",Ot({slot:"postf"}))}}var Vt=s(56478),It=s(63042);const Wt=[{id:"01",rocks:["01","05"]},{id:"02",rocks:["02"]},{id:"03",rocks:["03"]},{id:"04",rocks:["04"]}];class jt extends Y{constructor(t,e,s,i,r,o){const a=new Map;for(let c=0;c<Wt.length;c++){const e=Wt[c],s=e.id,i=new It.zg({sources:[{codec:"basis",lods:[{files:[Vt["default"].getAssetPath(`scene3/MossRock_${s}_Flowers_Diffuse.ktx2`)]}]}]},t.gl);for(let t=0;t<e.rocks.length;t++)a.set(`MossRock_${e.rocks[t]}`,i)}const n=new Ht,h=new m.Z(t);super("scene3/rocks.gltf",t,e,s,h,i,((e,s)=>{if(s.startsWith("MossRock")){const t=a.get(s);if(t){const i=new Nt(t.texture,o,e);this.mossChunks.set(s||"default",i),e.inputs.add(i)}}e.inputs.add(n),e.mask=u.Z.BLENDED,e.glconfig.enableBlend().depthMask(!0).blendFunc(t.gl.SRC_ALPHA,t.gl.ONE_MINUS_SRC_ALPHA)})),this.sheetSuccess=r,this.decorPoolRadius=[],this.poolPositionNodes=[],this.isLeft=!0,this.decorZ=3,this.isDecor=!1,this.currentZ=3,this.mossProgress=0,this.mossTexRes=[],this.mossChunks=new Map,this.updateMossProgress=t=>{this.mossProgress=t},this.underwaterChunk=n,this.mossTexRes=[...new Set(a.values())]}get mainRocks(){return this.elemList.filter((t=>!t.isDecor))}async load(){await Promise.all([super.load(),...this.mossTexRes.map((t=>t.load()))])}onLoaded(){this.renderables=this.poolRes.gltf.renderables,this.pool=[],this.decorPool=[],this.poolPositionNodes=[];const t=this.poolRes.gltf.root._children;for(const e of t){const t=e.name.startsWith("Decor"),s=e._children,i=[];for(const e of s)t||!e.name.startsWith("Frog")?e.renderable&&(e.updateMatrix(),i.push(e.renderable)):this.poolPositionNodes.push(e);const r=t?this.decorPool:this.pool;r.push(i)}this.poolRadius=[],this.decorPoolRadius=[],this.setupRadius(this.pool,this.poolRadius,!0),this.setupRadius(this.decorPool,this.decorPoolRadius,!0)}start(){super.start(),this.isLeft=!0,this.mossProgress=0,this.mossProgressSuccess=new g(0,this.updateMossProgress,this.sheetSuccess,"Rocks / Moss progress")}stop(){this.mossProgressSuccess.dispose()}elemFromData(t,e,s,r,o){const a=new n.Z;this.root.add(a);const h=Math.floor(Math.random()*s.length),c=1.5+.3*Math.random(),l=r[h],d=l.list.map((t=>t*c)),u=l.global*c,p=[...s[h]],m=p.map((t=>{const e=new n.Z;return e.setMatrix(t.node._matrix),a.add(e),e}));a.x=t,a.z=this.currentZ-u+e,a.rotateY(Math.random()*Math.PI*2),a.setScale(c);const f=this.poolPositionNodes[h],g=[];for(const i of p)for(const t of i.materials){const e=this.mossChunks.get(t.name);e&&g.push(e)}const v={node:a,radius:u,isDecor:o,mossChunks:g,radiusList:d,renderables:p,renderableNodes:m,frogPosition:o?null:i.vec3.fromValues(f.x,f.y,f.z),maxFlowerAmount:g.length>0&&Math.random()>.3?.3+.7*Math.random():0};return v}createElem(){if(this.isDecor){const t=this.isLeft?1:-1,e=(7+Math.random())*t,s=4*Math.random()-2;return this.elemFromData(e,s,this.decorPool,this.decorPoolRadius,!0)}const t=this.isLeft?-1:1,e=tt["default"].isMobile?2:3,s=Math.random()*e*t;return this.elemFromData(s,0,this.pool,this.poolRadius,!1)}addElem(t){super.addElem(t),this.isDecor=!(this.isDecor||Math.abs(this.decorZ-this.currentZ)<5)&&Math.random()>.5,t.isDecor?this.decorZ=t.node.z:(this.isLeft=!this.isLeft,this.currentZ=t.node.z-t.radius-.2-4*Math.random(),t.frogPosition&&i.vec3.transformMat4(t.frogPosition,t.frogPosition,t.node._matrix))}preRender(){this.tileTexChunk.timeU.set(d.Z.time)}render(t){var e;for(const s of this.elemList){for(const t of s.mossChunks)t.mossProgressUniform.set(this.mossProgress),t.mossEndProgressUniform.set(s.maxFlowerAmount);for(const[r,o]of s.renderables.entries()){const a=null!==(e=s.radiusList[r])&&void 0!==e?e:s.radius;this.tileTexChunk.textureRepeatU.set(.4*a);const n=s.renderableNodes[r]||s.node;i.mat4.copy(o.node._wmatrix,n._wmatrix),o.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}}}}class Bt{constructor(t,e,s,r=!0,o){this.n=t,this.sheet=e,this.name=s,this.updateWorldMatrix=r,this.externalLookAt=o,this.keyframes={scale:[],lookAt:[],position:[]},this.currentLookAt=i.vec3.create(),this.updateValues={position:!1,lookAt:!1,scale:!1};const a=e.object(s,{scaleProgress:f.types.number(0),lookAtProgress:f.types.number(0),positionProgress:f.types.number(0)});this._unsubscribe=a.onValuesChange((t=>{if(this.updateValues.position){const{from:e,to:s,progress:r}=this.getCurrentKeyframes("position",t.positionProgress);i.vec3.lerp(this.n.position,e,s,r)}if(this.updateValues.scale){const{from:e,to:s,progress:r}=this.getCurrentKeyframes("scale",t.scaleProgress);i.vec3.lerp(this.n.scale,e,s,r)}if(this.updateValues.lookAt){const{from:e,to:s,progress:r}=this.getCurrentKeyframes("lookAt",t.lookAtProgress);i.vec3.lerp(this.currentLookAt,e,s,r),o?i.vec3.copy(this.externalLookAt,this.currentLookAt):this.n.lookAt(this.currentLookAt)}this.n.invalidate(),r&&this.n.updateWorldMatrix()})),this._obj=a}get obj(){return this._obj}dispose(){this._unsubscribe(),this.sheet.detachObject(this.name)}setKeyframes({position:t,lookAt:e,scale:s}){t&&(this.keyframes.position=t.map((t=>i.vec3.fromValues(...t))),this.updateValues.position=!0),e&&(this.keyframes.lookAt=e.map((t=>i.vec3.fromValues(...t))),this.updateValues.lookAt=!0),s&&(this.keyframes.scale=s.map((t=>i.vec3.fromValues(...t))),this.updateValues.scale=!0)}getCurrentKeyframes(t,e){const s=this.keyframes[t],i=Math.max(0,Math.floor(e)),r=Math.min(i+1,s.length-1);return{from:s[i],to:s[r],progress:e%1}}disable(){this.updateValues.position=!1,this.updateValues.lookAt=!1,this.updateValues.scale=!1}}var Yt=s(62551),Jt=s(68872);const Gt=1.5;class Xt{constructor(t,e,s,r,o,a,h){this.renderer=t,this.sheetSuccess=r,this.sheetPerfect=o,this.sheetIntro=a,this.sheetOutro=h,this.isJumping=!1,this.speedProgress=1,this.addFov=0,this.initFov=0,this.baseFov=0,this.baseFovDist=0,this.cameraLookAt=i.vec3.create(),this.cameraTiltJump=i.vec3.create(),this.cameraTiltHold=i.vec3.create(),this.fovPerfectTarget=0,this.cameraShakeAmount=0,this.cameraShakeFactor=1,this.cameraRotationMouse=i.vec3.create(),this.camRotationPerfectTarget=i.vec3.create(),this.root=new n.Z,this.rootLerpPos=i.vec3.create(),this.rootStartPos=i.vec3.create(),this.rootTargetPos=i.vec3.create(),this.rootCurrentPos=i.vec3.create(),this.rootLerpFactor=1,this.updateProgressPerfect=t=>{i.vec3.lerp(this.rootLerpPos,this.rootStartPos,this.rootTargetPos,t)},this.updateSpeedProgress=t=>{this.speedProgress=t},this.updateFovSuccess=t=>{this.baseFov=this.initFov+t*this.baseFovDist,this.camera.lens.setHorizontalFov(this.baseFov+this.addFov)},this.updateFovPerfect=t=>{this.addFov=t*this.fovPerfectTarget,this.camera.lens.setHorizontalFov(this.baseFov+this.addFov)},this.updateShakeSuccess=t=>{this.cameraShakeAmount=t},this.updateCamRotationSuccess=t=>{i.vec3.lerp(this.cameraTiltHold,[0,0,0],[0,0,-.1],t)},this.updateCamRotationPerfect=t=>{i.vec3.lerp(this.cameraTiltJump,[0,0,0],this.camRotationPerfectTarget,t)},this.noiseTex=t.scene.texturePool.get("perlinNoise").texture,this.rockManager=new jt(t,this.root,e,s,r,this.noiseTex),this.lilypadManager=new vt(t,this.root,e,s,r),this.riverElemsManager=new Tt(this),this.frog=new b(t,this.root,this.rockManager,e,r,o),this.water=new Q(t,this.root,r,o,e,s,this.noiseTex),this.cloudManager=new gt(t,e,r),this.particles=new nt(t,250,i.vec3.fromValues(1,1,1),r,this.noiseTex)}get camera(){return this.renderer.camera}async load(){return Promise.all([this.frog.load(),this.water.load(),this.cloudManager.load(),this.rockManager.load(),this.lilypadManager.load()])}onLoaded(){this.frog.onLoaded(),this.water.onLoaded(),this.rockManager.onLoaded(),this.cloudManager.onLoaded(),this.lilypadManager.onLoaded()}start(t){if(this.root.position.set([0,0,0]),i.vec3.copy(this.rootLerpPos,this.root.position),this.isJumping=!1,this.rootLerpFactor=1,this.initFov=this.camera.lens._hfov,this.baseFov=this.initFov,this.baseFovDist=Gt-this.baseFov,this.cameraShakeAmount=0,this.cameraTiltJump.set([0,0,0]),this.cameraTiltHold.set([0,0,0]),null===this.camera._parent){const t=new n.Z;t.add(this.camera)}this.cameraWrapper=this.camera._parent,this.cameraWrapper.position.set([0,0,0]),i.quat.identity(this.cameraWrapper.rotation),this.riverSpeedSuccess=new g(0,this.updateSpeedProgress,this.sheetSuccess,"River / Speed"),this.rootAnimPerfect=new g(0,this.updateProgressPerfect,this.sheetPerfect,"River / Movement"),this.cameraTransformSuccess=new Bt(this.camera,this.sheetSuccess,"Camera / Transform",!1,this.cameraLookAt),this.cameraFovSuccess=new g(0,this.updateFovSuccess,this.sheetSuccess,"Camera / FOV"),this.cameraShakeSuccess=new g(0,this.updateShakeSuccess,this.sheetSuccess,"Camera / Shake"),this.cameraRotationSuccess=new g(0,this.updateCamRotationSuccess,this.sheetSuccess,"Camera / Rotation"),this.cameraFovPerfect=new g(0,this.updateFovPerfect,this.sheetPerfect,"Camera / FOV"),this.cameraRotationPerfect=new g(0,this.updateCamRotationPerfect,this.sheetPerfect,"Camera / Rotation"),this.cameraTransformIntro=new Bt(this.camera,this.sheetIntro,"Camera / Transform",!1,this.cameraLookAt),this.cameraTransformOutro=new Bt(this.camera,this.sheetOutro,"Camera / Transform",!1,this.cameraLookAt);const e=[S.Io[0],S.Io[1],S.Io[2]],s=[S.z8[0],S.z8[1],S.z8[2]],r=[Yt.Io[0],Yt.Io[1],Yt.Io[2]],o=[Yt.z8[0],Yt.z8[1],Yt.z8[2]],a=[tt["default"].isMobile?[0,25,8]:[0,40,15],tt["default"].isMobile?[0,18,8]:[0,28,15],tt["default"].isMobile?[10,1,-6]:[14,1,-14],tt["default"].isMobile?[0,4,8]:[0,4,10]],h=[0,2,0];this.cameraTransformIntro.setKeyframes({position:[e,a[0]],lookAt:[s,h]}),this.cameraTransformOutro.setKeyframes({position:[a[0],r],lookAt:[h,o]}),this.cameraTransformSuccess.setKeyframes({position:a}),this.camera.position.set(t?a[0]:e),i.vec3.set(this.cameraLookAt,...t?h:s),this.frog.start(),this.water.start(),this.particles.start(),this.rockManager.start(),this.cloudManager.start(),this.lilypadManager.start(),this.riverElemsManager.start(),this.water.heatmapCvs=this.riverElemsManager.canvas}stop(){this.cameraWrapper.position.set([0,0,0]),i.quat.identity(this.cameraWrapper.rotation),this.cameraWrapper.invalidate(),this.frog.stop(),this.water.stop(),this.particles.stop(),this.rockManager.stop(),this.cloudManager.stop(),this.lilypadManager.stop(),this.riverElemsManager.stop(),this.riverSpeedSuccess.dispose(),this.rootAnimPerfect.dispose(),this.cameraFovPerfect.dispose(),this.cameraTransformIntro.dispose(),this.cameraTransformOutro.dispose(),this.cameraRotationPerfect.dispose(),this.cameraFovSuccess.dispose(),this.cameraShakeSuccess.dispose(),this.cameraRotationSuccess.dispose(),this.cameraTransformSuccess.dispose()}setupLighting(t,e){t.lightSetup.prepare(this.renderer.gl);const s=[];for(const i of e)for(const t of i.materials)-1===s.indexOf(t)&&s.push(t);for(const i of e)for(const t of i.materials)t.hasPass(ht.Z.REFLECT_DEPTH)||t.addPass(this.renderer.reflectDistPass,ht.Z.REFLECT_DEPTH);for(const i of s)t.setupMaterial(i)}setupSceneLighting(t){this.setupLighting(t,[...this.frog.gltf.renderables,...this.rockManager.renderables,...this.lilypadManager.renderables,...this.water.paintManager.renderables])}setInitialRock(t){this.frog.setInitialRock(t),this.water.prepareStartRock(t),this.root.z=-t.node.z,i.vec3.copy(this.rootLerpPos,this.root.position)}updateScroll(){this.water.scroll(this.root.z),this.particles.scroll(this.root.z)}prepareJump(t){this.isJumping=!0,this.frog.prepareJump(t),this.water.prepareJump(this.frog.nextRock),this.rootLerpFactor=t>.9?.4-.35*(0,P.CW)(.9,1,t):.4-(0,P.CW)(0,.9,t)*(tt["default"].isMobile?.1:.2),i.vec3.copy(this.rootStartPos,this.root.position),i.vec3.copy(this.rootTargetPos,this.rootStartPos),this.rootTargetPos[2]=Math.max(0,-this.frog.nextRock.node.z),this.fovPerfectTarget=t<S.L5[2]?.1*Math.random():.3+.2*Math.random(),this.camRotationPerfectTarget.set(t<S.L5[2]?[0,0,0]:[.1*Math.random(),-this.frog.direction*(.1+.05*Math.random()),this.frog.direction*(.1+.05*Math.random())])}jumpEnded(){this.isJumping=!1,this.frog.jumpEnded(),this.water.prepareStartRock(this.frog.currentRock)}prepareOutro(){i.vec3.copy(this.cameraTransformOutro.keyframes.position[0],this.camera.position),i.vec3.copy(this.cameraTransformOutro.keyframes.lookAt[0],this.cameraLookAt),this.cameraTransformIntro.disable(),this.cameraTransformSuccess.disable()}updateRoot(){i.vec3.lerp(this.root.position,this.root.position,this.rootLerpPos,this.rootLerpFactor),this.root.invalidate(),this.root.updateWorldMatrix(),this.updateScroll()}updateCameraWrapper(t){const e=this.isJumping||t||this.renderer.scene.isTitlePlaying.value;this.cameraShakeFactor=(0,l.Z)(this.cameraShakeFactor,e?0:1,.01);const s=.05*d.Z.time;this.cameraWrapper.x=.05*Math.sin(s)*this.cameraShakeAmount*this.cameraShakeFactor,this.cameraWrapper.y=.025*Math.cos(s+.2)*this.cameraShakeAmount*this.cameraShakeFactor,this.cameraWrapper.z=.01*Math.sin(s+.5)*this.cameraShakeAmount*this.cameraShakeFactor,this.cameraWrapper.invalidate(),this.cameraWrapper.updateWorldMatrix()}updateCamera(t){this.camera.lookAt(this.cameraLookAt);const e=this.renderer.pointers.primary.coord.viewport;i.vec3.lerp(this.cameraRotationMouse,this.cameraRotationMouse,tt["default"].isMobile?[0,0,0]:[.02*e[1],.02*-e[0],0],.05);const s=t?1-this.cameraTransformIntro.obj.value.lookAtProgress:this.cameraTransformOutro.obj.value.lookAtProgress;i.vec3.lerp(this.cameraRotationMouse,this.cameraRotationMouse,[0,0,0],s),this.camera.rotateX(this.cameraRotationMouse[0]+this.cameraTiltHold[0]+this.cameraTiltJump[0]),this.camera.rotateY(this.cameraRotationMouse[1]+this.cameraTiltHold[1]+this.cameraTiltJump[1]),this.camera.rotateZ(this.cameraRotationMouse[2]+this.cameraTiltHold[2]+this.cameraTiltJump[2]),this.camera.invalidate(),this.camera.updateWorldMatrix()}preRender(t=!1,e=!1){const s=t||e;if(this.updateRoot(),this.updateCameraWrapper(e),this.updateCamera(t),this.riverElemsManager.preRender(this.speedProgress),this.rockManager.preRender(),this.lilypadManager.preRender(),this.water.preRender(this.speedProgress,this.isJumping),this.particles.preRender(this.speedProgress),this.cloudManager.preRender(),this.frog.preRender(this.isJumping),s){const e=this.renderer.postprocess.texturepass,s=t?1-this.cameraTransformIntro.obj.value.lookAtProgress:this.cameraTransformOutro.obj.value.lookAtProgress;e.textureLuminosity=(0,P.CD)(Jt.PX,Jt.po,s)}}render(t){this.rockManager.render(t),t.pass!==ht.Z.REFLECT_DEPTH&&this.water.render(t),this.lilypadManager.render(t),this.frog.render(t),this.cloudManager.render(t),t.pass!==ht.Z.REFLECT_DEPTH&&t.pass!==ht.Z.DEPTH&&this.particles.render(t)}}var qt=s(25409),Kt=s(3883),$t=s.n(Kt);const Qt=(0,T.Z)($t()),te=.5*S.f5;class ee extends y.Z{constructor(){super(!0,!1),this.addChild(this.minDist=new C.ZP("uMinDist",1,C.Ho.FRAGMENT)),this.addChild(this.maxDist=new C.ZP("uMaxDist",1,C.Ho.FRAGMENT)),this.minDist.attachConstant(te-S.It),this.maxDist.attachConstant(te),Qt.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("postf",Qt({slot:"postf"}))}}var se=s(79785);const ie={r:255,g:210,b:140},re=.3;class oe{constructor(t){this.renderer=t,this.updateColor=(t,e,s)=>{t._color.set([e.r*s,e.g*s,e.b*s])},this.node=new n.Z,this.dummy=new n.Z,this.scenePoint=new se.Z,this.scenePoint.radius=100,this.scenePoint.castShadows=!1,this.scenePoint.position.set([5,10,-5]),this.updateScenePoint(),this.updateColor(this.scenePoint,ie,re)}start(t){this.sceneLighting=t,t.lightSetup.add(this.scenePoint),this.node.add(this.scenePoint)}stop(){this.sceneLighting.lightSetup.remove(this.scenePoint),this.node.remove(this.scenePoint)}updateScenePoint(){this.scenePoint.invalidate(),this.scenePoint.updateWorldMatrix()}}var ae=s(17052),ne=s(38677);const he=[["ui_reaction_kaizen_yeah_c"],["ui_reaction_kaizen_wow_a","ui_reaction_kaizen_wow_c"],["ui_reaction_kaizen_laugh-d","ui_reaction_kaizen_laugh_a","ui_reaction_kaizen_laugh_b","ui_reaction_kaizen_laugh_c"],["ui_reaction_kaizen_love-it_c"],["ui_reaction_kaizen_brilliant_a","ui_reaction_kaizen_brilliant_b","ui_reaction_kaizen_brilliant_c"],["ui_reaction_kaizen_can-t_believe-it_a","ui_reaction_kaizen_can-t_believe-it_b","ui_reaction_kaizen_can-t_believe-it_c"],["ui_reaction_kaizen_cool_a","ui_reaction_kaizen_cool_b","ui_reaction_kaizen_cool_c"],["ui_reaction_kaizen_excited_a","ui_reaction_kaizen_excited_b","ui_reaction_kaizen_excited_c"],["ui_reaction_kaizen_woah_a"]],ce=["ui_reaction_kaizen_hop_a","ui_reaction_kaizen_hop_b","ui_reaction_kaizen_hop_c","ui_reaction_kaizen_boing_a","ui_reaction_kaizen_boing_b","ui_reaction_kaizen_boing_c"],le=["kaizen_ch3_smalljump1","kaizen_ch3_smalljump2","kaizen_ch3_smalljump3"],de=["kaizen_ch3_land1","kaizen_ch3_land2","kaizen_ch3_land3"];var ue=s(40549);const pe=.2,me=.75;class fe extends ue.ZP{constructor(t,e){super(t,e),this.blurStart=pe,this.blurAmount=0,this.blurStartTarget=pe,this.changeState=async t=>{this.previousState!==(0,a.toStatePaths)(t.value)[0].join(".")&&(this.previousState=(0,a.toStatePaths)(t.value)[0].join("."),t.matches("scene.interacting.perfect")&&this.handlePerfect(),this.checkOutro(t))},this.updatePostprocessSuccess=t=>{this.blurAmount=t},this.updatePostprocessPerfect=t=>{this.blurStart=pe-t*this.blurStartTarget},this.stepValues=S.L5,this.lights=new oe(this.renderer),this.ambientChunk=new ae.Z,this.fogChunk=new ee,this.river=new Xt(t,this.ambientChunk,this.fogChunk,this.sheetSuccess,this.sheetPerfect,this.sheetIntro,this.sheetOutro),this.background=new ne.Z(this.renderer,ne.E.LINEAR_3_STOPS),this.background.topColor=i.vec4.fromValues(...S.XA,S.aD),this.background.middleColor=i.vec4.fromValues(...S.XL,S.pc),this.background.bottomColor=i.vec4.fromValues(...S.TC,S.dM),this.background.setTransitionColors(i.vec4.fromValues(...S.Lz,.55),i.vec4.fromValues(...S.D1,.5),i.vec4.fromValues(...S.Pl,.45)),this.background.setIntroColors(i.vec4.fromValues(...S.Ki,S.aD),i.vec4.fromValues(...S.XL,S.pc),i.vec4.fromValues(...S.TC,S.dM)),this.background.setOutroColors(i.vec4.fromValues(...Yt.XA,Yt.aD),i.vec4.fromValues(...Yt.XL,Yt.pc),i.vec4.fromValues(...Yt.TC,Yt.dM)),this.background.setUseClampedMix(!0)}async load(){this.renderer.startReflect(),await Promise.all([this.river.load(),this.background.load()]),this.onLoaded()}onLoaded(){this.river.onLoaded(),this.background.sheetOutro=this.sheetOutro,this.background.sheetIntro=this.sheetIntro,this.background.sheetSuccess=this.sheetSuccess,this.background.onLoaded(),super.onLoaded()}start(){super.start(),qt["default"].fadeIn(qt.SCENE_AUDIO_AMBIENT_ID[this.id-1],me,3),qt["default"].fadeIn(qt.SCENE_AUDIO_AMBIENT_LAYER_ID[this.id-1],me-.15,3),this.waitingStart||(this.postprocessSuccess=new g(0,this.updatePostprocessSuccess,this.sheetSuccess,"Post process"),this.postprocessPerfect=new g(0,this.updatePostprocessPerfect,this.sheetPerfect,"Post process"),this.renderer.reflect.groundHeight=-.04,this.renderer.reflect.cameraDisto=-.33,this.renderer.isReflect=!0,this.renderer.clearColor.set([.2,.51,.608,1]),o["default"].glapp.quality.level.isVignetteBlur&&this.renderer.postprocess.post.add(this.renderer.postprocess.vignetteblur),this.renderer.postprocess.post.add(this.renderer.postprocess.frame),this.renderer.postprocess.vignetteblur.size=.02,this.renderer.postprocess.vignetteblur.vignetteSize=.5,this.renderer.postprocess.texturepass.textureRepeat=3.5,this.background.start(),this.river.start(this.skipIntro),this.lights.start(this.renderer.scene.lighting))}stop(){super.stop(),this.postprocessSuccess.dispose(),this.postprocessPerfect.dispose(),this.background.stop(),this.river.stop(),this.lights.stop(),this.renderer.isReflect=!1,this.renderer.postprocess.vignetteblur.size=.01,this.renderer.postprocess.vignetteblur.vignetteSize=.47,this.renderer.postprocess.vignetteblur.vignetteStart=.11,this.renderer.postprocess.vignetteblur.effectStrength=0,this.renderer.postprocess.texturepass.textureRepeat=2.5,this.renderer.postprocess.post.remove(this.renderer.postprocess.vignetteblur),this.renderer.postprocess.post.remove(this.renderer.postprocess.frame)}setupLighting(){this.river.setupSceneLighting(this.renderer.scene.lighting)}async handlePerfect(){const t=this.renderer.scene.holdRef.value;clearTimeout(this.unblockDownReleaseTO),clearTimeout(this.unblockReleaseTO),this.river.prepareJump(t),this.sheetPerfect.sequence.position=0,this.blurStartTarget=t<this.stepValues[2]?Math.random()*t*.1:.1+.1*Math.random(),this.jumpCounter++,qt["default"].stopHold(this.id);const e=t<this.stepValues[1]?0:t<this.stepValues[2]?1:2;if(this.jumpSound(),this.landingSound(e),0===e&&qt["default"].playReactionsBrute(ce[Math.floor(Math.random()*ce.length)],S.rX),1===e){this.renderer.scene.blockHold=!0;const t=Math.floor(Math.random()*he.length),e=Math.floor(Math.random()*he[t].length);this.firstReleaseDone?qt["default"].playReactionsBrute(he[t][e],S.rX):(this.firstReleaseDone=!0,qt["default"].playVoice(this.id,3,S.p5))}if(2===e){const t=Math.floor(Math.random()*he.length),e=Math.floor(Math.random()*he[t].length);qt["default"].playReactionsBrute(he[t][e],S.rX)}this.checkFirstPerfect(),this.renderer.scene.blockHold=!0,this.renderer.scene.blockHoldDown=!0,this.renderer.scene.blockRelease=!0,this.sheetPerfect.sequence.play().then((()=>{this.checkRelease(),this.resetHoldTime(),this.handlePerfectOver()}))}async jumpSound(){qt["default"].playReactionsBrute(le[Math.floor(Math.random()*le.length)],.7)}async landingSound(t){if(0===t)await(0,r.Z)(1e3);else if(1===t)await(0,r.Z)(1100);else{if(2!==t)return;await(0,r.Z)(1400)}qt["default"].playReactionsBrute(de[Math.floor(Math.random()*de.length)],.7)}async handlePerfectOver(){this.renderer.scene.blockRelease=!1,this.river.jumpEnded(),this.unblockDownReleaseTO=window.setTimeout((()=>{this.renderer.scene.isTitlePlaying.value||(this.renderer.scene.blockHold=!1,this.renderer.scene.isHolding&&qt["default"].playHold(this.id,this.renderer.scene.holdValue))}),ue.oJ),this.unblockReleaseTO=window.setTimeout((()=>{this.renderer.scene.isTitlePlaying.value||(this.renderer.scene.blockHoldDown=!1)}),ue.QP)}handleOutro(){return super.handleOutro(),this.river.prepareOutro(),Promise.resolve()}preRender(){this.isLoaded&&(super.preRender(),this.river.preRender(this.isIntroPlaying,this.isOutroPlaying))}rttPass(){this.isLoaded&&super.rttPass()}render(t){if(!this.isLoaded)return;const e=this.renderer.postprocess.vignetteblur;e.vignetteStart=this.blurStart,e.effectStrength=this.blurAmount,super.render(t),this.background.render(t),this.river.render(t)}}},28306:function(t,e,s){"use strict";s.d(e,{D1:function(){return b},Hs:function(){return l},Io:function(){return x},It:function(){return u},Ki:function(){return m},L5:function(){return R},Lz:function(){return M},Pl:function(){return w},TC:function(){return S},XA:function(){return f},XL:function(){return v},aD:function(){return g},bk:function(){return p},dM:function(){return k},f5:function(){return o},jk:function(){return r},n9:function(){return d},p5:function(){return _},pc:function(){return P},qc:function(){return c},rX:function(){return y},wH:function(){return a},z8:function(){return C}});var i=s(63887);const r=30,o=80,a=o/r,n=4,h=4,c=4,l=o+2*h,d=l+2*n,u=15,p=.001,m=[.54,.83,.78],f=[.54,.83,.88],g=.55,v=[.5,.75,.8],P=.5,S=[.02,.36,.43],k=.45,M=[.54,.83,.88],b=[.82,.87,.85],w=[.02,.36,.43],R=[.01,.2,.6,1],x=i.vec3.fromValues(0,15,0),C=i.vec3.fromValues(0,25,-10),_=.5,y=.5},62551:function(t,e,s){"use strict";s.d(e,{Io:function(){return S},L5:function(){return g},Sq:function(){return m},TC:function(){return h},TS:function(){return u},XA:function(){return r},XL:function(){return a},aD:function(){return o},cx:function(){return f},dM:function(){return c},im:function(){return d},nA:function(){return l},p5:function(){return v},pc:function(){return n},rX:function(){return P},uf:function(){return p},z8:function(){return k}});var i=s(63887);const r=[.83,.73,1],o=.59,a=[1,.92,.98],n=.49,h=[.89,.75,.95],c=.42,l=[.83,.73,1],d=.59,u=[.75,.74,.87],p=.49,m=[.89,.75,.95],f=.42,g=(i.vec3.fromValues(0,80,-60),i.vec3.fromValues(0,100,-100),[.01,.42,.74,1]),v=.5,P=.5,S=i.vec3.fromValues(0,100,-50),k=i.vec3.fromValues(0,100,-60)},89620:function(t,e,s){"use strict";s.d(e,{Z:function(){return c},x:function(){return n}});var i=s(63887);i.mat4.create();const r=i.quat.create(),o=i.vec3.create(),a=i.vec3.create();class n{constructor(t){this.animation=t,this.range=[0,0],this.time=0,this.weight=1,this.range=[0,t.duration]}get duration(){return this.range[1]-this.range[0]}}class h{constructor(){this.layers=[],this.channels=[]}evaluate(){let t=0;for(let s of this.layers)t+=s.weight;if(0===t)return;let e=0;for(let s=0;s<this.layers.length;s++){let n=this.layers[s];if(0===n.weight)continue;let h=n.weight/t;e+=h;let c=h/e;const l=n.time%(n.range[1]-n.range[0])+n.range[0];for(let t=0;t<this.channels[s].length;t++)this.channels[s][t].evaluate(l);0===s?(r.set(this.node.rotation),o.set(this.node.scale),a.set(this.node.position)):(i.quat.slerp(r,r,this.node.rotation,c),i.vec3.lerp(o,o,this.node.scale,c),i.vec3.lerp(a,a,this.node.position,c))}this.node.rotation.set(r),this.node.scale.set(o),this.node.position.set(a),this.node.invalidate()}}class c{constructor(){this.layers=[],this._nodeLayers=[],this._nodeLayerMap=new Map}addLayer(t){this.layers.push(t),this._invalidLayers=!0}evaluate(){this._invalidLayers&&this._rebuildLayers();for(let t of this._nodeLayers)t.evaluate()}_rebuildLayers(){this._nodeLayers.length=0,this._nodeLayerMap.clear();for(let t of this.layers)t.animation.channels.forEach(((e,s)=>{let i=this._nodeLayerMap.get(e.node);i||(i=new h,i.node=e.node,this._nodeLayers.push(i),this._nodeLayerMap.set(e.node,i));const r=i.layers.indexOf(t);-1===r?(i.layers.push(t),i.channels.push([e])):i.channels[r].push(e)}));this._invalidLayers=!1}}},11668:function(t,e,s){"use strict";s.d(e,{Z:function(){return u}});var i=s(79763),r=s(96323),o=s(49500),a=s(88760),n=s(15901),h=s.n(n),c=s(14462),l=s.n(c),d=s(21370);class u extends i.Z{constructor(){super(!0,!0),this.reflectionTexture=null,this.addChild(u.enabled),this.addChild(a.Z.input),this.addChild(this.strength=new o.ZP("ReflectionStrength",1)),this.addChild(this.time=new o.ZP("uTime",1)),this.strength.attachConstant(1.8),this.timeU=this.time.attachUniform(),this.timeU.set(0)}_genCode(t){t.add("postlightsf",h()()),t.add("pf",l()())}setup(t){if(null===this.reflectionTexture)throw"missing reflection texture";t.tFloorReflect(this.reflectionTexture),this.timeU.set(1e-4*d.Z.scaledTime)}}u.enabled=new r.Z("enableFReflect",!0)},55929:function(t,e,s){"use strict";s.d(e,{Z:function(){return a}});var i=s(79763),r=s(49500),o=s(1517);class a extends i.Z{constructor(t){super(!0,!1),this.textureRepeatV=2.5,this.textureOpacityV=.3,this.displacementV=.07,this.timeScaleV=.004,this.textureLuminosityV=1,this.backgroundInfluenceV=1,this.addChild(this.noise=new r.ZP("tileNoise",4,r.Ho.FRAGMENT)),this.noiseT=this.noise.attachSampler("tTileNoise",o.ZP.create("aTexCoord0")),this.noiseT._tex=t.scene.texturePool.get("perlinNoise").texture,this.addChild(this.tile=new r.ZP("tile",4,r.Ho.FRAGMENT)),this.tileT=this.tile.attachSampler("tTile",o.ZP.create("aTexCoord0")),this.tileT._tex=t.scene.texturePool.get("tile").texture,this.addChild(this.textureRepeat=new r.ZP("uRepeat",1,r.Ho.FRAGMENT)),this.textureRepeatU=this.textureRepeat.attachUniform(),this.textureRepeatU.set(this.textureRepeatV),this.addChild(this.textureOpacity=new r.ZP("uOpacity",1,r.Ho.FRAGMENT)),this.textureOpacityU=this.textureOpacity.attachUniform(),this.textureOpacityU.set(this.textureOpacityV),this.addChild(this.displacement=new r.ZP("uDisplacement",1,r.Ho.FRAGMENT)),this.displacementU=this.displacement.attachUniform(),this.displacementU.set(this.displacementV),this.addChild(this.timeScale=new r.ZP("uTimeScale",1,r.Ho.FRAGMENT)),this.timeScaleU=this.timeScale.attachUniform(),this.timeScaleU.set(this.timeScaleV),this.addChild(this.textureLuminosity=new r.ZP("uTextureLuminosity",1,r.Ho.FRAGMENT)),this.textureLuminosityU=this.textureLuminosity.attachUniform(),this.textureLuminosityU.set(this.textureLuminosityV),this.addChild(this.time=new r.ZP("uTime2",1,r.Ho.FRAGMENT)),this.timeU=this.time.attachUniform(),this.timeU.set(1)}_genCode(t){t.add("pf","\n      float blendOverlay(float base, float blend) {\n        return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n      }\n\n      vec3 blendOverlay(vec3 base, vec3 blend) {\n        return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));\n      }\n\n      vec3 blendOverlay(vec3 base, vec3 blend, float opacity) {\n        return (blendOverlay(base, blend) * opacity + base * (1.0 - opacity));\n      }\n\n      float greyscale(vec3 col){\n        float grey = dot(col, vec3(0.299, 0.587, 0.114));\n        return grey;\n      }\n\n      float easeInOutCubic(float x) {\n        return x < 0.5 ? 4.0 * x * x * x : 1.0 - pow(-2. * x + 2., 3.) / 2.;\n      }\n    "),t.add("postf","\n    vec4 noiseJitter = texture2D(tTileNoise, tileNoise_texCoord() + vec2(floor(uTime2() * uTimeScale()) * .1));\n    vec2 shakeUV = tileNoise_texCoord();\n\n    shakeUV = shakeUV - vec2(0.5, 0.5);\n    shakeUV = shakeUV * vec2(uRepeat(), uRepeat());\n    shakeUV = shakeUV + vec2(0.5, 0.5);\n\n    shakeUV += (noiseJitter.rg - 0.5) * uDisplacement();\n\n    vec3 texTile = texture2D(tTile, shakeUV).rgb;\n    texTile *= uTextureLuminosity();\n\n    float greyBackground = greyscale(FragColor.rgb);\n    // float greyBackgroundContrasted = easeInOutCubic(greyBackground);\n    // greyBackground = greyBackgroundContrasted;\n\n    // float blendingOpacity = uOpacity();\n    // blendingOpacity = clamp(uOpacity() - greyBackground * uBackgroundInfluence(), 0., 1.);\n    // FragColor.rgb = blendOverlay(FragColor.rgb, texTile, blendingOpacity);\n    FragColor.rgb = mix(FragColor.rgb, FragColor.rgb * 1. - texTile, uOpacity());\n    ")}}}}]);
//# sourceMappingURL=2369.6430dd7a.js.map