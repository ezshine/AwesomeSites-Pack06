"use strict";(self["webpackChunkgl_starter"]=self["webpackChunkgl_starter"]||[]).push([[7141],{17141:function(t,a,r){r.r(a),r.d(a,{default:function(){return f}});var i=r(21370),s=r(31236),h=r(63132),o=r(46816),e=r(5434),n=r(63887),g=r(61987),l=r(94292),d=r(18158);const u=10,S=6,v=n.vec2.create();class f{constructor(t,a,r=2){this.renderer=t,this.count=a,this.shootingCount=r,this.alpha=0,this.globalAlpha={value:0},this.globalAlphaFactor={value:1},this.shootingStarsStarted=!1,this.node=new g.Z,this.shootingNode=new g.Z}setupProgram(){const t=this.renderer;this.prg=(0,s["default"])(t.gl).get("stars"),this.shootingStarsPrg=(0,s["default"])(t.gl).get("shooting-stars"),this._noiseTex=this.renderer.scene.texturePool.get("perlinNoise").texture,this.vbuffer=new d.Z(this.renderer.gl),this.vbufferShooting=new d.Z(this.renderer.gl),this.vbuffer.attrib("aPosition",3,t.gl.FLOAT).attrib("aBaseAlpha",1,t.gl.FLOAT).attrib("aMovement",4,t.gl.FLOAT).attrib("aSize",1,t.gl.FLOAT).attrib("aAlpha",1,t.gl.FLOAT),this.vbuffer.attribPointer(this.prg),this.vbufferShooting=new d.Z(this.renderer.gl),this.vbufferShooting.attrib("aPosition",3,t.gl.FLOAT).attrib("aRotation",1,t.gl.FLOAT).attrib("aParams",2,t.gl.FLOAT),this.vbufferShooting.attribPointer(this.shootingStarsPrg),this.cfg=l.Z.get(t.gl).config(),this.cfg.enableDepthTest(!0).depthMask(!1).enableBlend(!0).blendFuncSeparate(t.gl.SRC_ALPHA,t.gl.ONE_MINUS_SRC_ALPHA,t.gl.ONE,t.gl.ONE_MINUS_SRC_ALPHA)}start(){this.prg||this.setupProgram(),this.varray=new Float32Array(this.count*u),this.vbuffer.data(this.varray),this.varrayShooting=new Float32Array(this.shootingCount*S),this.vbufferShooting.data(this.varrayShooting),this.globalAlphaTheatre=new e.Z(this.globalAlpha,this.introSheet,"starsAlpha"),this.globalAlphaFactorTheatre=new e.Z(this.globalAlphaFactor,this.introTransitionSheet,"starsAlpha"),this.addParticles(),this.addShootingStars()}stop(){this.varray=new Float32Array(this.count*u),this.vbuffer.data(this.varray),this.varrayShooting=new Float32Array(this.shootingCount*S),this.vbufferShooting.data(this.varrayShooting),this.globalAlphaTheatre.dispose(),this.globalAlphaFactorTheatre.dispose(),this.shootingStarsStarted=!1}getPos(){return[4*Math.random()-2,1.05-Math.random(),3]}getShootingPos(){return[2*Math.random()-1,1.05-Math.random(),3]}addParticles(){for(let t=0;t<this.count;t++){const a=[],r=this.getPos();v.set([.7*Math.random()-1,1-.5*Math.random()]),n.vec2.normalize(v,v),a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=.66*Math.random()+.33,a[9]=0,a[4]=1e4*Math.random(),a[5]=v[0],a[6]=v[1],a[7]=25e-5+1e-4*Math.random(),a[8]=40*Math.random(),this.varray.set(a,t*u)}this.vbuffer.data(this.varray)}addShootingStars(t){const a=void 0!==t;for(let r=a?t:0;r<(a?t+1:this.shootingCount);r++){const t=[],a=this.getShootingPos();t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=Math.random()*(2*Math.PI),t[4]=-5*Math.random(),t[5]=.25+.1*(Math.random()-.5)*2,this.varrayShooting.set(t,r*S)}this.vbufferShooting.data(this.varrayShooting)}updateStars(){this.alpha=this.globalAlpha.value*this.globalAlphaFactor.value;for(let t=0;t<this.count;t++){const a=t*u;if(this.varray[a]<-2||this.varray[a+1]>1.2){const t=this.getPos();this.varray[a]=t[0],this.varray[a+1]=t[1],this.varray[a+2]=t[2],this.varray[a+3]=.66*Math.random()+.33,this.varray[a+9]=0}const r=[this.varray[a+5],this.varray[a+6]],i=this.varray[a+7];this.varray[a]+=r[0]*i,this.varray[a+1]+=r[1]*i;let s=Math.min(this.varray[a+9]+.01,this.varray[a+3]);if(this.alpha<1){const a=Math.max(t/this.count,.001),r=(0,h.uZ)((0,o.FG)(this.alpha)/a,0,1);s=(0,h.uZ)(s*r,0,1)}this.varray[a+9]=s}this.vbuffer.data(this.varray)}updateShootingStars(){if(!(this.alpha<.25)||this.shootingStarsStarted){this.shootingStarsStarted=!0;for(let t=0;t<this.shootingCount;t++){const a=t*S,r=this.varrayShooting[a+5];this.varrayShooting[a+4]>1+r&&this.addShootingStars(t),this.varrayShooting[a+4]+=.005}this.vbufferShooting.data(this.varrayShooting)}}preRender(){this.node.updateWorldMatrix(),this.shootingNode.updateWorldMatrix(),this.updateStars(),this.updateShootingStars()}renderStars(t){this.prg.use(),this.prg.uWorldMatrix(this.node._wmatrix),this.prg.uVP(t.camera._viewProj),this.prg.uNoise(this._noiseTex),this.prg.uTime(i.Z.time),this.prg.uGlobalAlpha(this.alpha),this.vbuffer.attribPointer(this.prg),this.vbuffer.drawPoints()}renderShootingStars(t){this.shootingStarsPrg.use(),this.shootingStarsPrg.uWorldMatrix(this.shootingNode._wmatrix),this.shootingStarsPrg.uVP(t.camera._viewProj),this.shootingStarsPrg.uGlobalAlpha(this.alpha),this.shootingStarsPrg.uNoise(this._noiseTex),this.shootingStarsPrg.uTime(i.Z.time),this.vbufferShooting.attribPointer(this.shootingStarsPrg),this.vbufferShooting.drawPoints()}render(t){this.renderStars(t),this.renderShootingStars(t)}}},46816:function(t,a,r){function i(t){return t*t}r.d(a,{FG:function(){return i}});Math.PI,Math.PI}}]);
//# sourceMappingURL=7141.7c51f4e5.js.map