(self["webpackChunkgl_starter"]=self["webpackChunkgl_starter"]||[]).push([[9327],{79742:function(t,e){"use strict";e.byteLength=l,e.toByteArray=u,e.fromByteArray=m;for(var s=[],r=[],i="undefined"!==typeof Uint8Array?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,o=n.length;a<o;++a)s[a]=n[a],r[n.charCodeAt(a)]=a;function h(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var s=t.indexOf("=");-1===s&&(s=e);var r=s===e?0:4-s%4;return[s,r]}function l(t){var e=h(t),s=e[0],r=e[1];return 3*(s+r)/4-r}function c(t,e,s){return 3*(e+s)/4-s}function u(t){var e,s,n=h(t),a=n[0],o=n[1],l=new i(c(t,a,o)),u=0,p=o>0?a-4:a;for(s=0;s<p;s+=4)e=r[t.charCodeAt(s)]<<18|r[t.charCodeAt(s+1)]<<12|r[t.charCodeAt(s+2)]<<6|r[t.charCodeAt(s+3)],l[u++]=e>>16&255,l[u++]=e>>8&255,l[u++]=255&e;return 2===o&&(e=r[t.charCodeAt(s)]<<2|r[t.charCodeAt(s+1)]>>4,l[u++]=255&e),1===o&&(e=r[t.charCodeAt(s)]<<10|r[t.charCodeAt(s+1)]<<4|r[t.charCodeAt(s+2)]>>2,l[u++]=e>>8&255,l[u++]=255&e),l}function p(t){return s[t>>18&63]+s[t>>12&63]+s[t>>6&63]+s[63&t]}function f(t,e,s){for(var r,i=[],n=e;n<s;n+=3)r=(t[n]<<16&16711680)+(t[n+1]<<8&65280)+(255&t[n+2]),i.push(p(r));return i.join("")}function m(t){for(var e,r=t.length,i=r%3,n=[],a=16383,o=0,h=r-i;o<h;o+=a)n.push(f(t,o,o+a>h?h:o+a));return 1===i?(e=t[r-1],n.push(s[e>>2]+s[e<<4&63]+"==")):2===i&&(e=(t[r-2]<<8)+t[r-1],n.push(s[e>>10]+s[e>>4&63]+s[e<<2&63]+"=")),n.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},68896:function(t){var e=function(t){var e="";return e+="",!0===t.pv&&(e+="\n\n#define SKIN_NUM_JOINTS "+t.numJoints+"\nuniform mat4 uJoints[SKIN_NUM_JOINTS];\n"+t.attribDecl+"\nmat4 ComputeSkinMatrix() {\n  mat4 SM = "+t.matrixSum+";\n  return SM;\n}\n"),e+="\n\n",!0===t.vertex_warp&&(e+="\n  mat4 _skinMatrix = ComputeSkinMatrix();\n  vertex.worldMatrix = vertex.worldMatrix * _skinMatrix;\n"),e+="\n",e};e.toString=e,t.exports=e,e.onHmr=function(){}},31148:function(t,e,s){"use strict";s.d(e,{Z:function(){return V}});var r=s(61987),i=s(63887),n=s(75989),a=s(79763);const o="uMorphWeights";function h(t){return t.attributes.map(((e,s)=>`IN ${t.type} ${e};`)).join("\n")}function l(t){const e=t.attributes.map(((t,e)=>`${t} * ${o}[${e}]`)).join(" +\n ");return`void MorphAttribute_${t.name}( inout ${t.type} ${t.name} ){\n    ${t.name} += ${e};\n  }`}function c(t){return`MorphAttribute_${t.name}( vertex.${t.name} );`}function u(t){return t.map(h).join("\n")}function p(t){return t.map(l).join("\n")}function f(t){return t.map(c).join("\n")}function m(t){return`uniform float ${o}[${t}];`}const d={preVertexCode(t){return[m(t.numTargets),u(t.morphInfos),p(t.morphInfos)].join("\n")},vertexCode(t){return f(t.morphInfos)}};var g=d;function w(t){const e=t[0].attributes.length;for(let s=1;s<t.length;s++)if(t[s].attributes.length!==e)throw new Error("MorphDeformer mutiple morph dont have the same size")}class y extends a.Z{constructor(t){super(!0,!0),this._morphInfos=[],w(t),this._morphInfos=t,this._weights=new Float32Array(this.numTargets)}get weights(){return this._weights}set weights(t){if(t.length!==this.numTargets)throw new Error("MorphDeformer weights length and numMorph must match");this._weights=t}get numTargets(){return this._morphInfos[0].attributes.length}get morphInfos(){return this._morphInfos}setup(t){t[o](this._weights)}_genCode(t){t.add("pv",g.preVertexCode(this)),t.add("vertex_warp",g.vertexCode(this))}_getHash(){return"mrph"}}var E=s(68896),_=s.n(E);const A=["x","y","z","w"],v="uJoints";function b(t){return 1===t?"float":`vec${t}`}function S(t){let e="";for(const s of t){const t=b(s.numComponents);e+=`\nIN ${t} ${s.jointsAttrib}; \nIN ${t} ${s.weightsAttrib};`}return e}function T(t){const e=[];for(const s of t){const t=s.numComponents;for(let r=0;r<t;r++){const i=1===t?"":"."+A[r],n=s.jointsAttrib+i,a=s.weightsAttrib+i;e.push(`${v}[int(${n})] * ${a}`)}}return e.join("+ \n  ")}const C={preVertexCode(t){return _()({pv:!0,numJoints:t._numJoints,attribDecl:S(t._attributeSets),matrixSum:T(t._attributeSets)})},vertexCode(){return _()({vertex_warp:!0})}};var Z=C;class I extends a.Z{constructor(t,e){super(!0,!0),this._attributeSets=e,this._numJoints=t,this._jointsBuffer=new Float32Array(16*this._numJoints),this._jointMatrices=[];const s=this._jointsBuffer.buffer;for(let r=0;r<this._numJoints;r++)this._jointMatrices.push(new Float32Array(s,16*r*4,16))}get numJoints(){return this._numJoints}get jointMatrices(){return this._jointMatrices}setup(t){t[v](this._jointsBuffer)}_genCode(t){t.add("pv",Z.preVertexCode(this)),t.add("vertex_warp",Z.vertexCode())}}var R=s(45338),x=s(76881),M=s(94292);function O(t){if(t<1||t>4)throw new Error("number is not Component size")}function P(t){if("position"!==t&&"normal"!==t&&"tangent"!==t)throw new Error(`semantic ${t} can't be morphed`)}class N{constructor(t,e){this._skinDeformers=new Map,this._morphDeformers=new Map,this.materials=[],this.bounds=new x.Z,R.Z.isDefined(e.mesh),this.node=e,this.mesh=e.mesh,this.setupMaterials(t),this.computeBounds()}setupMaterials(t){for(const e of this.mesh.primitives){const s=e.material.createMaterialForPrimitive(t,this.node,e);this.configureDeformers(s,e),this.materials.push(s)}}configureDeformers(t,e){this.configureSkin(t,e),this.configureMorph(t,e)}configureMorph(t,e){if(null!==e.targets){const s=e.targets[0].attributes,r=[];for(const t of s){const s=e.targets.map((e=>e.getSemantic(t.semantic).glslname)),i=t.semantic.toLowerCase();P(i);const n={name:i,type:t.accessor.glslType,attributes:s};r.push(n)}const i=new y(r);t.inputs.add(i),this._morphDeformers.set(e,i),this.setupMorphWeights(i)}}setupMorphWeights(t){this.node.weights?t.weights=this.node.weights:this.mesh.weights&&(t.weights=this.mesh.weights)}configureSkin(t,e){if(this.node.skin){const s=this.node.skin.joints.length,r=[];let i=0;while(1){const t="WEIGHTS_"+i,s="JOINTS_"+i,n=e.attributes.getSemantic(t),a=e.attributes.getSemantic(s);if(null===n!==(null===a))throw new Error("Skin attributes inconsistency");if(null===n)break;if(n.accessor.numComps!==a.accessor.numComps)throw new Error("weight and joints attribute dont have the same size");const o=n.accessor.numComps;O(o),r.push({weightsAttrib:n.glslname,jointsAttrib:a.glslname,numComponents:o}),i++}const n=new I(s,r);t.inputs.add(n),this._skinDeformers.set(e,n)}}computeBounds(){this.bounds.copyFrom(this.mesh.primitives[0].bounds);for(const t of this.mesh.primitives)x.Z.union(this.bounds,this.bounds,t.bounds)}render(t,e,s,r,i){const n=this.mesh.primitives,a=M.Z.get(t);for(let o=0;o<n.length;o++){const t=n[o];this._skinDeformers.has(t)&&this.node.skin.computeJoints(this.node,this._skinDeformers.get(t).jointMatrices),this._morphDeformers.has(t)&&this.setupMorphWeights(this._morphDeformers.get(t));const h=this.materials[o];if(!h.hasPass(r)||0===(h.mask&s))continue;const l=h.getPass(r);0!==(l.pass.mask&s)&&(l.prepare(this.node,e),a.push(l.pass.glconfig),h.glconfig&&a.push(h.glconfig),this.glconfig&&a.push(this.glconfig),i&&a.push(i),a.apply(),this.drawCall(e,l.getProgram(),t),a.pop(),h.glconfig&&a.pop(),this.glconfig&&a.pop(),i&&a.pop())}}drawCall(t,e,s){s.bindVao(e),s.render(),s.unbindVao()}}class V extends r.Z{constructor(){super(...arguments),this.gltftype=n.Z.NODE,this.weights=null,this.restMatrix=i.mat4.create()}async parse(t,e){var s,r;if(this.extras=e.extras,void 0!==e.camera&&(this.camera=await t.getElement(n.Z.CAMERA,e.camera)),void 0!==e.matrix&&this.setMatrix(new Float32Array(e.matrix)),void 0!==e.scale&&this.scale.set(e.scale),void 0!==e.translation&&this.position.set(e.translation),void 0!==e.rotation&&this.rotation.set(e.rotation),void 0!==e.children){const s=e.children.map((e=>t.getElement(n.Z.NODE,e))),r=await Promise.all(s);for(const t of r)this.add(t)}if(void 0!==e.skin&&(this.skin=await t.getElement(n.Z.SKIN,e.skin)),void 0!==e.mesh){this.mesh=await t.getElement(n.Z.MESH,e.mesh);const s=this.mesh.primitives[0].targets;s&&(this.weights=new Float32Array(s.length))}if(void 0!==e.weights){if(null===this.weights||this.weights.length!==e.weights.length)throw new Error("morph weights on node doesn't match mesh targets");this.weights.set(e.weights)}this.name=null!==(s=e.name)&&void 0!==s?s:null===(r=this.mesh)||void 0===r?void 0:r.name,this.invalidate(),this.updateMatrix(),this.restMatrix.set(this._matrix)}findChild(t){for(let e=0;e<this._children.length;e++){const s=this._children[e];if(s.name===t)return s}}findDescendant(t){var e;let s=this.findChild(t);if(void 0===s)for(let r=0;r<this._children.length;r++){const i=this._children[r];if(s=null===(e=i.findDescendant)||void 0===e?void 0:e.call(i,t),void 0!==s)return s}return s}allocateGl(t){this.mesh&&(this.renderable=new N(t,this))}}},14888:function(t,e,s){"use strict";s.d(e,{Z:function(){return h}});var r=s(75989);function i(t,e){return t instanceof Function?t(e):t}function n(t,e,s){return t instanceof Function?t(e,s):t}class a{constructor(t,e){this.materialFactory=t,this.data=e,this.gltftype=r.Z.MATERIAL}createMaterialForPrimitive(t,e,s){return i(this.materialFactory,{data:this.data,gltf:t,node:e,primitive:s})}parse(t,e){return null}}class o{constructor(t,e){this.ext=e,this.name="material_override",this.priority=10,this.loader=t}acceptElement(t,e){return t.gltftype===r.Z.MATERIAL?this.createOverridePassMaterial(t,e):null}loadElement(t){return t.gltftype===r.Z.MATERIAL?this.createOverrideMaterial(t):null}createOverrideMaterial(t){const e=this.ext.materials.get(t.name)||this.ext.materials.get("");if(void 0!==e){const s=new a(e,t);return Promise.resolve(s)}return null}createOverridePassMaterial(t,e){const s=this.ext.passes.get(t.name)||this.ext.passes.get("");if(void 0!==s){const r=e.createMaterialForPrimitive;e.createMaterialForPrimitive=(i,a,o)=>{const h=r.apply(e,[i,a,o]),l=n(s,{data:t,gltf:i,node:a,primitive:o},h);return l&&h.addPass(l),h}}return null}}class h{constructor(){this.name="material_override",this.materials=new Map,this.passes=new Map}overrideMaterial(t,e){this.assertNotExist(t),this.materials.set(t,e)}overridePass(t,e){this.assertNotExist(t),this.passes.set(t,e)}assertNotExist(t){if(this.materials.has(t))throw`material override for "${t}" already exist`;if(this.passes.has(t))throw`pass override for "${t}" already exist`}createInstance(t){return new o(t,this)}}},13579:function(t,e,s){"use strict";var r=s(57195),i=s(16203);const n=34963;class a extends r.Z{constructor(t,e=t.UNSIGNED_SHORT,s,r=t.STATIC_DRAW,i){super(),this.gl=t,this.usage=r,this.buffer=void 0!==i?i:t.createBuffer(),this.type=0,this.typeSize=0,this.byteLength=0,this.setType(e),s&&this.data(s)}bind(){this.gl.bindBuffer(n,this.buffer)}setType(t){this.type=t,this.typeSize=(0,i.Z4)(t)}data(t){const e=this.gl;e.bindBuffer(n,this.buffer),e.bufferData(n,t,this.usage),e.bindBuffer(n,null),this.byteLength=(0,i.$P)(t)?t.byteLength:t}subData(t,e){const s=this.gl;s.bindBuffer(n,this.buffer),s.bufferSubData(n,e,t),s.bindBuffer(n,null)}dispose(){this.gl.deleteBuffer(this.buffer)}draw(t,e,s=0){e=void 0===e?this.byteLength/this.typeSize:e,this.gl.drawElements(t,e,this.type,0|s)}}e["Z"]=a},61221:function(t,e,s){"use strict";s.d(e,{ZP:function(){return oe}});var r=s(86773),i=s(79742);const n="undefined"!==typeof TextDecoder?new TextDecoder("utf-8"):null;function a(t,e,s){return e<=t&&t<=s}function o(t){let e=0,s=0,r=0,i=128,n=191;const o=[],h=t.length;for(let l=0;l<h;++l){const h=t[l];if(0===r){if(a(h,0,127)){o.push(h);continue}if(a(h,194,223)){r=1,e=31&h;continue}if(a(h,224,239)){224===h&&(i=160),237===h&&(n=159),r=2,e=15&h;continue}if(a(h,240,244)){240===h&&(i=144),244===h&&(n=143),r=3,e=7&h;continue}throw new Error("String decoding failed.")}a(h,i,n)?(i=128,n=191,e=e<<6|63&h,++s,s===r&&(o.push(e),e=r=s=0)):(e=r=s=0,i=128,n=191,--l)}return o}function h(t){return n.decode(t)}function l(t){let e="";const s=o(t);for(let r of s)r<=65535?e+=String.fromCharCode(r):(r-=65536,e+=String.fromCharCode(55296+(r>>10),56320+(1023&r)));return e}const c="undefined"!==typeof TextDecoder?h:l;var u=c,p=s(15415),f=s(25410),m=s(75989);class d{constructor(){this.gltftype=m.Z.ANIMATION,this.duration=0}async parse(t,e){const s=e.samplers.map((e=>t._loadElement(e)));this.samplers=await Promise.all(s);for(const i of this.samplers)this.duration=Math.max(i.maxTime);const r=e.channels.map((e=>t._loadElement(e)));this.channels=await Promise.all(r)}evaluate(t){for(const e of this.channels)e.evaluate(t)}getChannel(t){return this.channels[t]}getSampler(t){return this.samplers[t]}}var g=s(50434);function w(t,e){t.position.set(e),t.invalidate()}function y(t,e){t.rotation.set(e),t.invalidate()}function E(t,e){t.scale.set(e),t.invalidate()}function _(t,e){t.weights.set(e)}function A(t){switch(t){case g.Z.AnimationChannelTargetPath.TRANSLATION:return w;case g.Z.AnimationChannelTargetPath.ROTATION:return y;case g.Z.AnimationChannelTargetPath.SCALE:return E;case g.Z.AnimationChannelTargetPath.WEIGHTS:return _;default:throw new Error("unsupported path "+t)}}class v{constructor(){this.gltftype=m.Z.ANIMATION_CHANNEL}async parse(t,e){if(this._active=!1,this.path=e.target.path,this.applyFunction=A(this.path),void 0!==e.target.node){this._active=!0,this.node=await t.getElement(m.Z.NODE,e.target.node);let s=1;this.path===g.Z.AnimationChannelTargetPath.WEIGHTS&&(s=this.node.mesh.primitives[0].targets.length),t._loadElement(e.elementParent).then((t=>{this.sampler=t.getSampler(e.sampler),this.evaluator=this.sampler.createEvaluator(this.path,s),this.valueHolder=this.evaluator.createElementHolder()}))}}evaluate(t){this._active&&(this.evaluator.evaluate(this.valueHolder,t),this.applyFunction(this.node,this.valueHolder))}}var b=s(63887);function S(t,e,s,r,i,n,a){const o=e*e,h=e*o,l=2*h-3*o+1,c=s*(h-2*o+e),u=3*o-2*h,p=s*(h-o),f=r.length;for(let m=0;m<f;m++)t[m]=l*r[m]+c*i[m]+u*a[m]+p*n[m]}class T{constructor(t){this.frame=0,this.t0=t.getRawScalar(0),this.t1=t.getRawScalar(1),this.inBound=!0,this._fMax=t.count-1}contain(t){return t<this.t0?-1:t>=this.t1?1:0}normalizedFrame(){return Math.min(Math.max(this.frame,0),this._fMax)}}class C{constructor(t,e){this.sampler=t,this.interval=new T(t.input),this.numElements=e}resolveInterval(t){const e=this.interval,s=this.sampler.input,r=s.count,i=e.contain(t);if(0===i)return;let n,a,o,h=!0;if(i>0){n=e.frame+1,a=e.t1;do{n++,h=n<r,o=a,a=h?s.getRawScalar(n):Number.MAX_VALUE}while(a<=t);n--}else{n=e.frame,o=e.t0;do{n--,h=n>=0,a=o,o=h?s.getRawScalar(n):-Number.MAX_VALUE}while(o>t)}e.frame=n,e.t0=o,e.t1=a,e.inBound=h}evaluate(t,e){}}class Z extends C{evaluate(t,e){this.resolveInterval(e),this.sampler.output.getValues(t,this.interval.normalizedFrame()*this.numElements,this.numElements)}}function I(t,e,s,r){const i=e.length,n=1-r;for(let a=0;a<i;a++)t[a]=e[a]*n+s[a]*r}function R(t,e,s,r){t[0]=e[0]*(1-r)+s[0]*r}function x(t,e){switch(t){case g.Z.AnimationChannelTargetPath.WEIGHTS:return 1===e?R:I;case g.Z.AnimationChannelTargetPath.ROTATION:return b.quat.slerp;case g.Z.AnimationChannelTargetPath.SCALE:case g.Z.AnimationChannelTargetPath.TRANSLATION:default:return I}}class M extends C{constructor(t,e,s){super(t,s),this.val0=t.output.createElementHolderArray(s),this.val1=t.output.createElementHolderArray(s),this.lerpFunc=x(e,this.val0.length)}evaluate(t,e){this.resolveInterval(e);const s=this.sampler.output,r=this.numElements;if(this.interval.inBound){const{t0:i,t1:n,frame:a}=this.interval,o=(e-i)/(n-i);s.getValues(this.val0,r*a+0,r),s.getValues(this.val1,r*a+r,r),this.lerpFunc(t,this.val0,this.val1,o)}else s.getValues(t,this.interval.normalizedFrame()*r,r)}}class O extends C{constructor(t,e,s){super(t,s),this.val0=t.output.createElementHolderArray(s),this.val1=t.output.createElementHolderArray(s),this.val2=t.output.createElementHolderArray(s),this.val3=t.output.createElementHolderArray(s),this.assumeQuat=e===g.Z.AnimationChannelTargetPath.ROTATION}evaluate(t,e){this.resolveInterval(e);const s=this.sampler.output,r=this.numElements;if(this.interval.inBound){const{t0:i,t1:n,frame:a}=this.interval,o=n-i,h=(e-i)/o;s.getValues(this.val0,r*(3*a+1),r),s.getValues(this.val1,r*(3*a+2),r),s.getValues(this.val2,r*(3*a+3),r),s.getValues(this.val3,r*(3*a+4),r),S(t,h,o,this.val0,this.val1,this.val2,this.val3),this.assumeQuat&&b.quat.normalize(t,t)}else s.getValues(t,r*(3*this.interval.normalizedFrame()+1),r)}}function P(t,e,s){switch(t.interpolation){case g.Z.AnimationSamplerInterpolation.STEP:return new Z(t,s);case g.Z.AnimationSamplerInterpolation.LINEAR:return new M(t,e,s);case g.Z.AnimationSamplerInterpolation.CUBICSPLINE:return new O(t,e,s);default:throw new Error("GLTF : Unsupported sampler interpolation "+t.interpolation)}}class N{constructor(t,e,s){this.sampler=t,this.numElements=s,this.interpolator=P(t,e,s)}evaluate(t,e){this.interpolator.evaluate(t,e)}createElementHolder(){return this.sampler.output.createElementHolderArray(this.numElements)}}class V{constructor(){this.gltftype=m.Z.ANIMATION_SAMPLER,this.minTime=0,this.maxTime=0}async parse(t,e){this.input=await t.getElement(m.Z.ACCESSOR,e.input),this.output=await t.getElement(m.Z.ACCESSOR,e.output),this.interpolation=e.interpolation||g.Z.AnimationSamplerInterpolation.LINEAR,this.minTime=this.input.getRawScalar(0),this.maxTime=this.input.getRawScalar(this.input.count-1)}createEvaluator(t,e){return new N(this,t,e)}}var B,U=s(45338);(function(t){t["float"]="float",t["vec2"]="vec2",t["vec3"]="vec3",t["vec4"]="vec4",t["mat2"]="mat2",t["mat3"]="mat3",t["mat4"]="mat4"})(B||(B={}));const F=t=>Math.max(t/127,-1),L=t=>t/255,D=t=>Math.max(t/32767,-1),G=t=>t/65535,H=t=>t,j=t=>t;function z(t){switch(t){case g.Z.AccessorComponentType.BYTE:return F;case g.Z.AccessorComponentType.UNSIGNED_BYTE:return L;case g.Z.AccessorComponentType.SHORT:return D;case g.Z.AccessorComponentType.UNSIGNED_SHORT:return G;case g.Z.AccessorComponentType.UNSIGNED_INT:return H;case g.Z.AccessorComponentType.FLOAT:return j}}function k(t){switch(t){case g.Z.AccessorComponentType.BYTE:return Int8Array;case g.Z.AccessorComponentType.UNSIGNED_BYTE:return Uint8Array;case g.Z.AccessorComponentType.SHORT:return Int16Array;case g.Z.AccessorComponentType.UNSIGNED_SHORT:return Uint16Array;case g.Z.AccessorComponentType.UNSIGNED_INT:return Uint32Array;case g.Z.AccessorComponentType.FLOAT:return Float32Array}}function $(t){return k(t).BYTES_PER_ELEMENT}function W(t){switch(t){case g.Z.AccessorType.SCALAR:return 1;case g.Z.AccessorType.VEC2:return 2;case g.Z.AccessorType.VEC3:return 3;case g.Z.AccessorType.VEC4:return 4;case g.Z.AccessorType.MAT2:return 4;case g.Z.AccessorType.MAT3:return 9;case g.Z.AccessorType.MAT4:return 16}}function J(t){switch(t){case g.Z.AccessorType.SCALAR:return B.float;case g.Z.AccessorType.VEC2:return B.vec2;case g.Z.AccessorType.VEC3:return B.vec3;case g.Z.AccessorType.VEC4:return B.vec4;case g.Z.AccessorType.MAT2:return B.mat2;case g.Z.AccessorType.MAT3:return B.mat3;case g.Z.AccessorType.MAT4:return B.mat4}}class X{constructor(){this.normalized=!1,this.byteOffset=0,this.count=0,this._stride=0,this._strideElem=0}get numComps(){return W(this.type)}get bytesPerElem(){return $(this.componentType)}get glslType(){return J(this.type)}*[Symbol.iterator](){const t=this.createElementHolder();for(let e=0;e<this.count;e++)this.getValue(t,e),yield t}createElementHolder(t=this.normalized){return t?new Float32Array(this.numComps):new(k(this.componentType))(this.numComps)}createElementHolderArray(t,e=this.normalized){return e?new Float32Array(this.numComps*t):new(k(this.componentType))(this.numComps*t)}getScalar(t,e=this.normalized){let s;return s=null!==this.sparse?this.sparse.getRawScalar(t):this.getRawScalar(t),e&&(s=this._normalizeFunc(s)),s}getRawScalar(t){const e=this._strideElem*t;return this._array[e]}getValue(t,e,s=this.normalized){const r=s?this._valueHolder:t;null!==this.sparse?this.sparse.getRawValue(r,e):this.getRawValue(r,e),s&&this._normalize(t,r)}getValues(t,e,s){if(null!==this.sparse)throw new Error("Cant call getValues in sparsed accessor");this.getRawValues(t,e,s),this.normalized&&this._normalize(t,t)}getRawValue(t,e){const s=this._strideElem*e,r=this.numComps;for(let i=0;i<r;i++)t[i]=this._array[i+s]}getRawValues(t,e,s){const r=this.numComps;for(let i=0;i<s;i++){const s=i*r,n=this._strideElem*(e+i);for(let e=0;e<r;e++)t[s+e]=this._array[e+n]}}_normalize(t,e){const s=this._normalizeFunc,r=this.numComps;for(let i=0;i<r;i++)t[i]=s(e[i])}}class Y extends X{constructor(){super(...arguments),this.gltftype=m.Z.ACCESSOR}async parse(t,e){const{byteOffset:s=0,normalized:r=!1}=e;if(this.normalized=r,this.byteOffset=s,this.componentType=e.componentType,this.count=e.count,this.type=e.type,this.max=e.max,this.min=e.min,void 0!==e.bufferView){this.bufferView=await t.getElement(m.Z.BUFFERVIEW,e.bufferView);const s=k(this.componentType);0===this.bufferView.byteStride?(this._stride=this.numComps*this.bytesPerElem,this._strideElem=this.numComps):(this._stride=this.bufferView.byteStride,this._strideElem=this._stride/s.BYTES_PER_ELEMENT,U.Z.isTrue(this._strideElem===Math.round(this._strideElem)));const r=this.bufferView.buffer._bytes,i=this.byteOffset+this.bufferView.getByteOffset(),n=(r.byteLength-i)/s.BYTES_PER_ELEMENT,a=Math.min(this.count*this._strideElem,n);this._array=new s(r,i,a)}else this.bufferView=null,this._stride=0,this._strideElem=0,this._array=this.createElementHolder();return this.sparse=null,void 0!==e.sparse&&t._loadElement(e.sparse).then((t=>this.sparse=t)),this._valueHolder=this.createElementHolder(),this._normalizeFunc=z(this.componentType),Promise.resolve()}}var K=s(20508),q=s(1579);class Q{constructor(){this.gltftype=m.Z.CAMERA}parse(t,e){switch(this.type=e.type,this.type){case g.Z.CameraType.PERSPECTIVE:this.projectionData=e.perspective,this.lens=this.createPerpective(this.projectionData);break;case g.Z.CameraType.ORTHOGRAPHIC:this.projectionData=e.orthographic,this.lens=this.createOrtho(this.projectionData);break;default:throw new Error("Camera - unsupported type "+this.type)}return Promise.resolve()}createPerpective(t){var e,s;const r=new K.Z;return r.near=t.znear,r.far=null!==(e=t.zfar)&&void 0!==e?e:100,r.setVerticalFov(t.yfov),r.aspect=null!==(s=t.aspectRatio)&&void 0!==s?s:1,r}createOrtho(t){const e=new q.Z;return e.near=t.znear,e.far=t.zfar,e._xMin=-t.xmag,e._xMax=t.xmag,e._yMin=-t.ymag,e._yMax=t.ymag,e}}var tt=s(95893);class et{constructor(){this.gltftype=m.Z.MESH}async parse(t,e){const s=e.primitives.map((e=>t._loadElement(e)));this.primitives=await Promise.all(s),e.weights&&(this.weights=new Float32Array(e.weights))}}var st=s(49500),rt=s(1517);class it{constructor(){this._sampler=null}createSampler(t){var e;if(null===this._sampler){const s=p.Z.getSemantics().getAttributeName(`TEXCOORD_${this.texCoord}`);this._sampler=new st.Z4(`tex_${null!==(e=this.name)&&void 0!==e?e:""}${t}`,rt.ZP.create(s)),this.texture.glTexturePromise.then((t=>this._sampler.set(t)))}return this._sampler}async parse(t,e){var s;this.texture=await t.getElement(m.Z.TEXTURE,e.index),this.texCoord=null!==(s=e.texCoord)&&void 0!==s?s:0}}class nt extends it{constructor(){super(...arguments),this.gltftype=m.Z.TEXTURE_INFO}}class at extends it{constructor(){super(...arguments),this.gltftype=m.Z.NORMAL_TEXTURE_INFO}async parse(t,e){var s;await super.parse(t,e),this.scale=null!==(s=e.scale)&&void 0!==s?s:1}}class ot extends it{constructor(){super(...arguments),this.gltftype=m.Z.OCCLUSION_TEXTURE_INFO}async parse(t,e){var s;await super.parse(t,e),this.strength=null!==(s=e.strength)&&void 0!==s?s:1}}var ht=s(34686),lt=s(18158);function ct(t,e){t.createVertexArray=function(){return e.createVertexArrayOES()},t.bindVertexArray=function(t){return e.bindVertexArrayOES(t)},t.deleteVertexArray=function(t){return e.deleteVertexArrayOES(t)},t.isVertexArray=function(t){return e.isVertexArrayOES(t)}}function ut(t){return void 0!==t.bindVertexArray}class pt{constructor(t){if(this.gl=t,ut(t))this._impl=new ft(this);else{const e=t.getExtension("OES_vertex_array_object");e?(ct(t,e),this._impl=new ft(this)):this._impl=new mt(this)}}dispose(){this._impl.dispose()}setup(t,e,s){t.ready||t._grabParameters(),this._impl.setup(t,e,s)}bind(){this._impl.bind()}unbind(){this._impl.unbind()}}class ft{constructor(t){this._vao=t,this._gl=this._vao.gl,this._handle=null}dispose(){this.release()}setup(t,e,s){this.release();const r=this._gl;this._handle=r.createVertexArray(),r.bindVertexArray(this._handle);for(var i=0;i<e.length;i++)e[i].attribPointer(t);void 0!==s&&s.bind(),r.bindVertexArray(null)}bind(){this._gl.bindVertexArray(this._handle)}unbind(){this._gl.bindVertexArray(null)}release(){this._handle&&(this._gl.deleteVertexArray(this._handle),this._handle=null)}}class mt{constructor(t){this._vao=t,this.prg=null,this.buffers=null,this.indices=null}dispose(){this.prg=null,this.buffers=null,this.indices=null}setup(t,e,s){this.prg=t,this.buffers=e,this.indices=s}bind(){if(null!=this.buffers&&null!=this.prg&&null!=this.indices){for(var t=0;t<this.buffers.length;t++)this.buffers[t].attribPointer(this.prg);void 0!==this.indices&&this.indices.bind()}}unbind(){}}var dt=s(13579),gt=s(76881);class wt{constructor(t,e){this.semantic=t,this.accessor=e,this.glslname=p.Z.getSemantics().getAttributeName(t)}}class yt{constructor(t){this.accessor=t,this.attributes=[]}addAttribute(t){this.attributes.push(t)}}class Et{constructor(){this._attributes=[]}get length(){return this._attributes.length}get attributes(){return this._attributes}add(t){this._attributes.push(t)}getSemantic(t){for(const e of this._attributes)if(e.semantic===t)return e;return null}getBuffersViewSets(){const t=new Map;for(const e of this._attributes){const s=e.accessor.bufferView;t.has(s)||t.set(s,new yt(e.accessor)),t.get(s).addAttribute(e)}return Array.from(t.values())}}const _t=34963,At=34962;class vt{constructor(){this.gltftype=m.Z.PRIMITIVE,this.material=null,this.indices=null,this.targets=null,this.bounds=new gt.Z}_calculaterBounds(){const t=this.attributes.getSemantic("POSITION");null!=t&&t.accessor.min&&t.accessor.max&&this.bounds.fromMinMax(t.accessor.min,t.accessor.max)}async parse(t,e){if(this.attributes=new Et,await this.parseAttributeSet(t,this.attributes,e.attributes),void 0!==e.indices&&(this.indices=await t.getElement(m.Z.ACCESSOR,e.indices)),void 0!==e.material?this.material=await t.getElement(m.Z.MATERIAL,e.material):this.material=await t.loadDefaultMaterial(),void 0!==e.mode?this.mode=e.mode:this.mode=g.Z.MeshPrimitiveMode.DEFAULT,void 0!==e.targets){this.targets=[];for(let s=0;s<e.targets.length;s++){const r=e.targets[s],i=new Et;await this.parseMorphAttributeSet(t,i,r,s),this.targets.push(i)}}this._calculaterBounds()}async parseAttributeSet(t,e,s){for(const r in s){const i=await t.getElement(m.Z.ACCESSOR,s[r]);e.add(new wt(r,i))}}async parseMorphAttributeSet(t,e,s,r){for(const i in s){const n=await t.getElement(m.Z.ACCESSOR,s[i]),a=new wt(i,n);a.glslname=p.Z.getSemantics().getMorphedAttributeName(a.semantic,r),e.add(a)}}allocateGl(t){this._vaoMap=new Map,this.buffers=[];const e=this.attributes.getBuffersViewSets();for(const s of e)this.buffers.push(this.createArrayBuffer(t,s));if(null!==this.indices){const e=this.indices.bufferView.getWebGLBuffer(t,_t);this.indexBuffer=new dt.Z(t,this.indices.componentType,void 0,t.STATIC_DRAW,e),this.indexBuffer.byteLength=this.indices.bufferView.byteLength}if(null!==this.targets)for(let s=0;s<this.targets.length;s++){const e=this.targets[s],r=e.getBuffersViewSets();for(const s of r)this.buffers.push(this.createArrayBuffer(t,s))}}createArrayBuffer(t,e){const s=e.accessor.bufferView,r=s.getWebGLBuffer(t,At),i=new lt.Z(t,void 0,t.STATIC_DRAW,r);i.byteLength=s.byteLength,i.stride=e.accessor._stride,i._computeLength();for(const n of e.attributes){const t=this.createAttributeDefinition(n);i.attribs.push(t)}return i}createAttributeDefinition(t){const e=t.accessor;return{name:t.glslname,type:e.componentType,size:e.numComps,normalize:e.normalized,offset:e.byteOffset,stride:e._stride}}getVao(t){const e=t._cuid.toString();if(!this._vaoMap.has(e)){const s=new pt(t.gl);s.setup(t,this.buffers,this.indexBuffer),this._vaoMap.set(e,s)}return this._vaoMap.get(e)}bindVao(t){this._currentVao=this.getVao(t),this._currentVao.bind()}render(){this.indexBuffer?this.indexBuffer.draw(this.mode,this.indices.count,this.indices.byteOffset):this.buffers[0].draw(this.mode)}unbindVao(){this._currentVao.unbind()}}const bt=10497;class St{constructor(){this.gltftype=m.Z.SAMPLER}parse(t,e){var s,r;return this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.wrapS=null!==(s=e.wrapS)&&void 0!==s?s:bt,this.wrapT=null!==(r=e.wrapT)&&void 0!==r?r:bt,Promise.resolve()}}class Tt{constructor(){this.gltftype=m.Z.SCENE}async parse(t,e){if(void 0!==e.nodes){const s=e.nodes.map((e=>t.getElement(m.Z.NODE,e)));this.nodes=await Promise.all(s)}else this.nodes=[]}updateNodes(){for(let t=0;t<this.nodes.length;t++)this.nodes[t].updateWorldMatrix()}}const Ct=b.mat4.create();class Zt{constructor(){this.gltftype=m.Z.SKIN}async parse(t,e){const s=e.joints.map((e=>t.getElement(m.Z.NODE,e)));if(this.joints=await Promise.all(s),this.inverseBindMatrices=this.joints.map(b.mat4.create),void 0!==e.inverseBindMatrices){const s=await t.getElement(m.Z.ACCESSOR,e.inverseBindMatrices);this.inverseBindMatrices.forEach(((t,e)=>s.getValue(t,e)))}void 0!==e.skeleton&&(this.skeletonRoot=await t.getElement(m.Z.NODE,e.skeleton))}computeJoints(t,e){if(e.length!==this.joints.length)throw new Error("Skin.computeJoints(), jointMatrices size must match joints size");b.mat4.invert(Ct,t._wmatrix);for(let s=0;s<this.joints.length;s++){const t=this.joints[s],r=this.inverseBindMatrices[s],i=e[s];b.mat4.mul(i,t._wmatrix,r),b.mat4.mul(i,Ct,i)}}}var It=s(35183),Rt=s(31148),xt=s(45950);class Mt{constructor(){this.gltftype=m.Z.ASSET}parse(t,e){return this.version=e.version,this.copyright=e.copyright,this.generator=e.generator,this.minVersion=e.minVersion,Promise.resolve()}}class Ot{constructor(){this.gltftype=m.Z.BUFFER}async parse(t,e){this.byteLength=e.byteLength,this.uri=e.uri,this._byteOffset=0,this._bytes=await t.loadBufferUri(e.uri),U.Z.isTrue(null!==this._bytes)}}class Pt{constructor(){this.gltftype=m.Z.BUFFERVIEW,this.byteOffset=0,this.byteLength=0,this.byteStride=0,this.target=0,this.glBuffer=null,this.glBufferTarget=0}async parse(t,e){const{byteLength:s,byteOffset:r=0,byteStride:i=0,target:n=0}=e;this.byteLength=s,this.byteOffset=r,this.byteStride=i,this.target=n,this.buffer=await t.getElement(m.Z.BUFFER,e.buffer)}getByteOffset(){return this.byteOffset+this.buffer._byteOffset}getWebGLBuffer(t,e){if(0!==this.target&&this.target!==e)throw new Error(`BufferView's target ${this.target} doesn't match infered one ${e}`);if(null!==this.glBuffer){if(this.glBufferTarget!==e)throw new Error("WebglBuffers with different target requested on BufferView")}else{const s=new Uint8Array(this.buffer._bytes,this.getByteOffset(),this.byteLength);this.glBufferTarget=e,this.glBuffer=t.createBuffer(),t.bindBuffer(e,this.glBuffer),t.bufferData(e,s,t.STATIC_DRAW),t.bindBuffer(e,null)}return this.glBuffer}}class Nt{constructor(){this.gltftype=m.Z.ACCESSOR_SPARSE}async parse(t,e,...s){this.accessor=await t.getElement(m.Z.ACCESSOR,e.elementParent.elementIndex),this.indices=await t._loadElement(e.indices),this.values=await t._loadElement(e.values);const r=this.indicesSet=new Set,i=this.indicesMap=new Map,n=this.indices,a=n.count;for(let o=0;o<a;o++){const t=n.getScalar(o);r.add(t),i.set(t,o)}}getRawValue(t,e){const s=this.indicesSet.has(e);s?this.values.getRawValue(t,this.indicesMap.get(e)):this.accessor.getRawValue(t,e)}getRawScalar(t){const e=this.indicesSet.has(t);return e?this.values.getRawScalar(this.indicesMap.get(t)):this.accessor.getRawScalar(t)}}class Vt extends X{constructor(){super(...arguments),this.gltftype=m.Z.ACCESSOR_SPARSE_INDICES}async parse(t,e){var s;const r=e.elementParent;this.normalized=!1,this.byteOffset=null!==(s=e.byteOffset)&&void 0!==s?s:0,this.componentType=e.componentType,this.count=r.count,this.type=g.Z.AccessorType.SCALAR,this.sparse=null,this.bufferView=await t.getElement(m.Z.BUFFERVIEW,e.bufferView);const i=k(this.componentType);return 0===this.bufferView.byteStride?(this._stride=this.numComps*this.bytesPerElem,this._strideElem=this.numComps):(this._stride=this.bufferView.byteStride,this._strideElem=this._stride/i.BYTES_PER_ELEMENT,U.Z.isTrue(this._strideElem===Math.round(this._strideElem))),this._array=new i(this.bufferView.buffer._bytes,this.byteOffset+this.bufferView.getByteOffset(),this.count*this._strideElem),this._valueHolder=this.createElementHolder(),Promise.resolve()}}class Bt extends X{constructor(){super(...arguments),this.gltftype=m.Z.ACCESSOR_SPARSE_VALUES}async parse(t,e){var s,r;const i=e.elementParent,n=i.elementParent;this.byteOffset=null!==(s=e.byteOffset)&&void 0!==s?s:0,this.count=i.count,this.normalized=null!==(r=n.normalized)&&void 0!==r&&r,this.componentType=n.componentType,this.type=n.type,this.sparse=null,this.bufferView=await t.getElement(m.Z.BUFFERVIEW,e.bufferView);const a=k(this.componentType);return 0===this.bufferView.byteStride?(this._stride=this.numComps*this.bytesPerElem,this._strideElem=this.numComps):(this._stride=this.bufferView.byteStride,this._strideElem=this._stride/a.BYTES_PER_ELEMENT,U.Z.isTrue(this._strideElem===Math.round(this._strideElem))),this._array=new a(this.bufferView.buffer._bytes,this.byteOffset+this.bufferView.getByteOffset(),this.count*this._strideElem),this._valueHolder=this.createElementHolder(),Promise.resolve()}}class Ut{constructor(t){this.name="default",this.priority=0,this.loader=t}acceptElement(t,e){return null}loadElement(t){switch(t.gltftype){case m.Z.ACCESSOR:return this.createAccessor(t);case m.Z.ACCESSOR_SPARSE:return this.createAccessorSparse(t);case m.Z.ACCESSOR_SPARSE_INDICES:return this.createAccessorSparseIndices(t);case m.Z.ACCESSOR_SPARSE_VALUES:return this.createAccessorSparseValues(t);case m.Z.ANIMATION:return this.createAnimation(t);case m.Z.ANIMATION_SAMPLER:return this.createAnimationSampler(t);case m.Z.ANIMATION_CHANNEL:return this.createAnimationChannel(t);case m.Z.ASSET:return this.createAsset(t);case m.Z.BUFFER:return this.createBuffer(t);case m.Z.BUFFERVIEW:return this.createBufferview(t);case m.Z.CAMERA:return this.createCamera(t);case m.Z.IMAGE:return this.createImage(t);case m.Z.MATERIAL:return this.createMaterial(t);case m.Z.MESH:return this.createMesh(t);case m.Z.NODE:return this.createNode(t);case m.Z.NORMAL_TEXTURE_INFO:return this.createNormalTextureInfo(t);case m.Z.OCCLUSION_TEXTURE_INFO:return this.createOcclusionTextureInfo(t);case m.Z.PRIMITIVE:return this.createPrimitive(t);case m.Z.SAMPLER:return this.createSampler(t);case m.Z.SCENE:return this.createScene(t);case m.Z.SKIN:return this.createSkin(t);case m.Z.TEXTURE:return this.createTexture(t);case m.Z.TEXTURE_INFO:return this.createTextureInfo(t)}}async createAccessor(t){const e=new Y;return await e.parse(this.loader,t),e}async createAccessorSparse(t){const e=new Nt;return await e.parse(this.loader,t),e}async createAccessorSparseIndices(t){const e=new Vt;return await e.parse(this.loader,t),e}async createAccessorSparseValues(t){const e=new Bt;return await e.parse(this.loader,t),e}async createAsset(t){const e=new Mt;return await e.parse(this.loader,t),e}async createBuffer(t){const e=new Ot;return await e.parse(this.loader,t),e}async createBufferview(t){const e=new Pt;return await e.parse(this.loader,t),e}async createAnimationChannel(t){const e=new v;return await e.parse(this.loader,t),e}async createAnimationSampler(t){const e=new V;return await e.parse(this.loader,t),e}async createAnimation(t){const e=new d;return await e.parse(this.loader,t),e}async createCamera(t){const e=new Q;return await e.parse(this.loader,t),e}async createImage(t){const e=new xt.ZP;return await e.parse(this.loader,t),e}async createMaterial(t){const e=new tt.Z;return await e.parse(this.loader,t),e}async createMesh(t){const e=new et;return await e.parse(this.loader,t),e}async createNode(t){const e=new Rt.Z;return await e.parse(this.loader,t),e}async createNormalTextureInfo(t){const e=new at;return await e.parse(this.loader,t),e}async createOcclusionTextureInfo(t){const e=new ot;return await e.parse(this.loader,t),e}async createPbrMetallicRoughness(t){const e=new ht.Z;return await e.parse(this.loader,t),e}async createPrimitive(t){const e=new vt;return await e.parse(this.loader,t),e}async createSampler(t){const e=new St;return await e.parse(this.loader,t),e}async createScene(t){const e=new Tt;return await e.parse(this.loader,t),e}async createSkin(t){const e=new Zt;return await e.parse(this.loader,t),e}async createTexture(t){const e=new It.Z;return await e.parse(this.loader,t),e}async createTextureInfo(t){const e=new nt;return await e.parse(this.loader,t),e}}class Ft{constructor(){this.name="default"}createInstance(t){return new Ut(t)}}const Lt=new Ft;p.Z.addExtension(Lt);var Dt=s(4638);let Gt=0;function Ht(){return Gt+++""}const jt={gltftype:m.Z.MATERIAL,elementIndex:-1,elementParent:null,uuid:"_default_mat_",name:"default"};class zt{constructor(t,e){this.data=t,this.promise=e}}const kt=1179937895,$t=1313821514,Wt=20,Jt=9729;class Xt{constructor(t,e,s={}){var r,i;this._elements=new Map,this._pendingElements=[],this._byType=new Map,this._propertyMaps=new Map,this.loadBufferUri=t=>{if(void 0===t)return Promise.resolve(this._glbData);const e=this.gltfIO.resolvePath(t,this._baseUrl);return this.gltfIO.loadBinaryResource(e,this.abortSignal)},this.gltfIO=t,this._url=e,this._baseUrl=s.baseurl,this.abortSignal=null!==(r=s.abortSignal)&&void 0!==r?r:Dt.R.none,this.defaultTextureFilter=null!==(i=s.defaultTextureFilter)&&void 0!==i?i:Jt,void 0===this._baseUrl&&([this._baseUrl,this._url]=t.resolveBaseDir(this._url)),this.gltf=new p.Z,this._data=null,this._extensions=new f.y,p.Z.getExtensionsRegistry().setupExtensions(this,s.extensions)}async load(){const t=await this.gltfIO.loadBinaryResource(this.gltfIO.resolvePath(this._url,this._baseUrl),this.abortSignal);return this.unpack(t),await this.parseAll(),this.gltf}unpack(t){const e=new Uint32Array(t,0,1)[0];if(e===kt)this.unpackGlb(t);else{const e=this.gltfIO.decodeUTF8(t);this._data=JSON.parse(e),this.prepareGltfDatas(this._data)}}unpackGlb(t){const[,e,,s,r]=new Uint32Array(t,0,5);if(2!==e)throw new Error("Binary glTF version is not 2");if(r!==$t)throw new Error("Binary glTF scene format is not JSON");const i=this.gltfIO.decodeUTF8(t,Wt,s);this._glbData=t.slice(Wt+s+8),this._data=JSON.parse(i),this.prepareGltfDatas(this._data)}resolveUri(t){return this.gltfIO.resolvePath(t,this._baseUrl)}parseCommonGltfProperty(t,e){void 0===e.name&&(e.name=t.name),void 0===e.extras&&(e.extras=t.extras)}async _createElement(t){const e=await this._createElementInstance(t);return this.parseCommonGltfProperty(t,e),this._extensionsAccept(t,e)}_createElementInstance(t){const e=this._extensions._list;for(const s of e){const e=s.loadElement(t);if(void 0===e)throw new Error("extension should not return undefined");if(null!==e)return e}throw new Error("Unhandled type")}async _extensionsAccept(t,e){const s=this._extensions._list;let r;for(const i of s)r=i.acceptElement(t,e),null!==r&&(e=await r);return e}_loadElement(t){let e=this._elements.get(t.uuid);if(void 0===e){e=this._createElement(t);const s=new zt(t,e);this._pendingElements.push(s),this._elements.set(t.uuid,e)}return e}loadDefaultMaterial(){return this._loadElement(jt)}_getElementHolder(t){let e=this._byType.get(t);return void 0===e&&(e=[],this._byType.set(t,e)),e}getElement(t,e){const s=this._getElementHolder(t);if(void 0!==s[e])return s[e];const r=this._propertyMaps.get(t),i=r[e];return this._loadElement(i)}async parseAll(){this._extensions.validate(this._data.extensionsUsed,this._data.extensionsRequired);const t=await this._loadElement(this._data.asset);"2.0"!=t.version&&console.warn(`Gltf version should be "2.0" found "${t.version}"`),await this._loadElements(this._data.scenes),await this._loadElements(this._data.nodes),await this._loadElements(this._data.animations),await this.resolveElements()}_loadElements(t){if(void 0!==t){const e=t.map((t=>this._loadElement(t)));return Promise.all(e).then()}}async resolveElements(){while(this._pendingElements.length>0){const t=this._pendingElements.splice(0,this._pendingElements.length),e=await Promise.all(t.map((t=>t.promise)));for(let s=0;s<t.length;s++){const r=e[s];U.Z.isDefined(r.gltftype),this.gltf.addElement(e[s],t[s].data.elementIndex)}}}prepareGltfDatas(t){if(this.prepareGltfRootProperties(t.accessors,m.Z.ACCESSOR,null),this.prepareGltfRootProperties(t.animations,m.Z.ANIMATION,null),this.prepareGltfRootProperties([t.asset],m.Z.ASSET,null),this.prepareGltfRootProperties(t.buffers,m.Z.BUFFER,null),this.prepareGltfRootProperties(t.bufferViews,m.Z.BUFFERVIEW,null),this.prepareGltfRootProperties(t.cameras,m.Z.CAMERA,null),this.prepareGltfRootProperties(t.images,m.Z.IMAGE,null),this.prepareGltfRootProperties(t.materials,m.Z.MATERIAL,null),this.prepareGltfRootProperties(t.meshes,m.Z.MESH,null),this.prepareGltfRootProperties(t.nodes,m.Z.NODE,null),this.prepareGltfRootProperties(t.samplers,m.Z.SAMPLER,null),this.prepareGltfRootProperties(t.scenes,m.Z.SCENE,null),this.prepareGltfRootProperties(t.skins,m.Z.SKIN,null),this.prepareGltfRootProperties(t.textures,m.Z.TEXTURE,null),void 0!==t.animations)for(const e of t.animations)this.prepareGltfProperties(e.samplers,m.Z.ANIMATION_SAMPLER,e),this.prepareGltfProperties(e.channels,m.Z.ANIMATION_CHANNEL,e);if(void 0!==t.materials)for(const e of t.materials)this.prepareGltfProperty(e.normalTexture,m.Z.NORMAL_TEXTURE_INFO,-1,e),this.prepareGltfProperty(e.occlusionTexture,m.Z.OCCLUSION_TEXTURE_INFO,-1,e),this.prepareGltfProperty(e.emissiveTexture,m.Z.TEXTURE_INFO,-1,e),void 0!==e.pbrMetallicRoughness&&(this.prepareGltfProperty(e.pbrMetallicRoughness.baseColorTexture,m.Z.TEXTURE_INFO,-1,e),this.prepareGltfProperty(e.pbrMetallicRoughness.metallicRoughnessTexture,m.Z.TEXTURE_INFO,-1,e));if(void 0!==t.meshes)for(const e of t.meshes)this.prepareGltfProperties(e.primitives,m.Z.PRIMITIVE,e);if(void 0!==t.accessors)for(const e of t.accessors)this.prepareGltfProperty(e.sparse,m.Z.ACCESSOR_SPARSE,-1,e),void 0!==e.sparse&&(this.prepareGltfProperty(e.sparse.indices,m.Z.ACCESSOR_SPARSE_INDICES,-1,e.sparse),this.prepareGltfProperty(e.sparse.values,m.Z.ACCESSOR_SPARSE_VALUES,-1,e.sparse))}prepareGltfProperties(t,e,s){if(void 0!==t)for(let r=0;r<t.length;r++){const i=t[r];this.prepareGltfProperty(i,e,r,s)}}prepareGltfRootProperties(t,e,s){if(void 0!==t){this._propertyMaps.set(e,t);for(let r=0;r<t.length;r++){const i=t[r];this.prepareGltfProperty(i,e,r,s)}}}prepareGltfProperty(t,e,s,r){void 0!==t&&(t.gltftype=e,t.uuid=Ht(),t.elementIndex=s,t.elementParent=r)}}class Yt{constructor(t){this._ioImpl=t}loadGltf(t,e={}){const s=new Xt(this._ioImpl,t,e);return s.load()}}var Kt=s(24352);async function qt(){if("undefined"===typeof window||void 0===window.createImageBitmap)return!1;const t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVQYV2NgYAAAAAMAAWgmWQ0AAAAASUVORK5CYII=",e=await fetch(t),s=await e.blob();try{await window.createImageBitmap(s,{premultiplyAlpha:"none",colorSpaceConversion:"none"})}catch(r){return!1}return!0}const Qt=qt();function te(t){const e=t.lastIndexOf("/");return[t.substr(0,e),t.substr(e+1)]}class ee{isDataURI(t){return 0===t.indexOf("data:")}decodeDataURI(t){if(0!==t.indexOf("data:"))throw new Error("invalid dataURI");const e=t.substr(t.indexOf(",")+1);return i.toByteArray(e).buffer}resolveBaseDir(t){return te(t)}resolvePath(t,e){return void 0===e||this.isDataURI(t)?t:e+"/"+t}decodeUTF8(t,e=0,s){return void 0===s&&(s=t.byteLength-e),u(new Uint8Array(t,e,s))}async loadResource(t,e=Dt.R.none){const s=(0,Kt.mr)(e),r=await fetch(t,{signal:s});return r.text()}async loadBinaryResource(t,e=Dt.R.none){if(this.isDataURI(t))return this.decodeDataURI(t);const s=(0,Kt.mr)(e),r=await fetch(t,{signal:s});return r.arrayBuffer()}async loadImageBuffer(t,e,s=Dt.R.none){const r=new Blob([t],{type:e});return this.loadImageBlob(r,s)}async loadImage(t,e=Dt.R.none){const s=(0,Kt.mr)(e),r=await fetch(t,{signal:s}),i=await r.blob();return this.loadImageBlob(i,e)}async loadImageBlob(t,e){let s;const r=await Qt;if(r)s=createImageBitmap(t,{premultiplyAlpha:"none",colorSpaceConversion:"none"});else{const e=new window.Image,r=URL.createObjectURL(t),i=new Promise(((t,s)=>{e.onload=t,e.onerror=s,e.src=r})).finally((()=>URL.revokeObjectURL(r)));s=i.then((()=>e))}return(0,Kt.gI)(s,e)}writeResource(t,e){throw new Error("Method not implemented.")}writeBinaryResource(t,e){throw new Error("Method not implemented.")}}const se=new ee;new Yt(se);var re=s(56478);class ie extends ee{resolvePath(t,e){return this.isDataURI(t)?t:(void 0!==e&&(t=e+"/"+t),re["default"].getAssetPath(decodeURI(t)))}}const ne=new ee,ae=new ie;class oe extends r._z{get gltf(){return this.value}constructor(t,e,s={},r=!0){super(),this.request=t,this.gl=e,this.opts=s,this._io=r?ae:ne}async doLoad(){const t=new Xt(this._io,this.request,Object.assign(Object.assign({},this.opts),{abortSignal:this.abortSignal})),e=await t.load();return await e.allocate(this.gl),e}doUnload(){}}}}]);
//# sourceMappingURL=9327.08262a7d.js.map