"use strict";(self["webpackChunkgl_starter"]=self["webpackChunkgl_starter"]||[]).push([[5800],{13579:function(t,e,s){var i=s(57195),o=s(16203);const a=34963;class r extends i.Z{constructor(t,e=t.UNSIGNED_SHORT,s,i=t.STATIC_DRAW,o){super(),this.gl=t,this.usage=i,this.buffer=void 0!==o?o:t.createBuffer(),this.type=0,this.typeSize=0,this.byteLength=0,this.setType(e),s&&this.data(s)}bind(){this.gl.bindBuffer(a,this.buffer)}setType(t){this.type=t,this.typeSize=(0,o.Z4)(t)}data(t){const e=this.gl;e.bindBuffer(a,this.buffer),e.bufferData(a,t,this.usage),e.bindBuffer(a,null),this.byteLength=(0,o.$P)(t)?t.byteLength:t}subData(t,e){const s=this.gl;s.bindBuffer(a,this.buffer),s.bufferSubData(a,e,t),s.bindBuffer(a,null)}dispose(){this.gl.deleteBuffer(this.buffer)}draw(t,e,s=0){e=void 0===e?this.byteLength/this.typeSize:e,this.gl.drawElements(t,e,this.type,0|s)}}e["Z"]=r},25800:function(t,e,s){s.r(e),s.d(e,{Clouds:function(){return T}});var i=s(18158),o=s(13579),a=s(61987),r=s(63887),n=s(21370),d=s(63132),h=s(5434);const l=r.mat4.create(),u=r.quat.create(),c=r.quat.create(),m=r.quat.create(),f=(r.vec3.create(),1.2),p=200,g=50,b=3,M=5;class T{constructor(t){this.renderer=t,this.cloudsNode=[],this.cloudsNodeTimeline=[],this.cloudsTex=[],this.cloudsAlpha=1,this.cloudsMovement=1,this.introCloudsDone=!1,this.timelineCloudsDone=!1,this.progress=0,this.rootNodeTransforms={z:200,x:0,y:0},this.timelineMaxZ=0,this.timelineCloudsHidden=[],this.params={baseZRootNode:0},this.timelineCloudsProgress={value:0},this.cloudAnimStarted=!1,this.progressTimeline={value:0},this.quadData=new Float32Array([-1,-1,1,0,0,1,-1,1,1,0,1,1,1,1,1,-1,1,1,0,1]),this._noiseTex=this.renderer.scene.texturePool.get("perlinNoise").texture}setGeo(){this.buffer=new i.Z(this.renderer.gl,this.quadData),this.bufferIndex=new o.Z(this.renderer.gl,this.renderer.gl.UNSIGNED_SHORT,new Uint16Array([0,1,2,0,2,3])),this.buffer.attrib("aPosition",3,this.renderer.gl.FLOAT),this.buffer.attrib("aTexCoord",2,this.renderer.gl.FLOAT),this.cloudsNode=[];for(let t=0;t<2;t++){const t=new a.Z;t.position.set([0,0,0]),t.scale.set([2*f,.48,1]),t.invalidate(),t.updateWorldMatrix(),this.cloudsNode.push(t)}this.rootNode=new a.Z;for(let t=0;t<8*M;t++){const t=new a.Z;t.position.set([0,0,0]),t.scale.set([2*f*g,.48*b,1]),t.invalidate(),t.updateWorldMatrix(),this.rootNode.add(t),this.cloudsNodeTimeline.push(t)}}setBaseTransformsTlClouds(){this.rootNode.position.set([this.rootNodeTransforms.x,this.rootNodeTransforms.y,this.rootNodeTransforms.z]),this.rootNode.invalidate(),this.rootNode.updateWorldMatrix();const t=p*Math.floor(this.cloudsNodeTimeline.length/M);for(let e=0;e<this.cloudsNodeTimeline.length;e++){const s=30,i=this.cloudsNodeTimeline[e],o=e%M,a=1===o||2===o;let r=0;switch(o){case 0:r=.5*s+2*s*Math.random();break;case 1:r=4+10*Math.random();break;case 2:r=-10*Math.random()-4;break;case 3:r=.5*-s-2*s*Math.random();break;default:r=s*(2*(Math.random()-.5))}const n=5+10*Math.random()+5*+a,d=Math.floor(e/4)*p,h=Math.min(t,d-p/4*Math.random());i.position.set([r,n,h]);const l=2*f*(g/4+g*Math.random()),u=.48*b+2*b*Math.random();i.scale[0]=l,i.scale[1]=u,this.setNodeRotation(i,e),e===this.cloudsNodeTimeline.length-1&&(this.timelineMaxZ=2.25*-g+-1*h)}for(let e=0;e<this.cloudsNodeTimeline.length;e+=M){const t=Math.random()>.2,s=Math.round(Math.random()*M);t&&this.timelineCloudsHidden.push(e+s)}}setNodeRotation(t,e){const s=.5*Math.PI-.05*Math.random(),i=.5*Math.PI-.05*Math.random(),o=Math.random()>.5?Math.PI:0,a=e%M;r.quat.identity(u),r.quat.identity(c),r.quat.identity(m),r.quat.identity(t.rotation),1===a||2===a||4===a?(r.quat.rotateY(u,u,s),r.quat.rotateX(c,u,i),r.quat.rotateZ(m,c,o),t.rotation.set(m)):(r.quat.rotateY(u,u,s),r.quat.rotateZ(c,u,o),t.rotation.set(c)),t.invalidate(),t.updateWorldMatrix()}async setupTimelineAnimation(){const t=await s.e(8348).then(s.bind(s,38348)),e=t.gsap,i=50;this.tl=e.timeline({paused:!1}),this.tl.addLabel("start",0),this.tl.to(this.rootNodeTransforms,{z:this.timelineMaxZ,duration:i},"start")}async loadClouds(){const t=(await Promise.all([s.e(9400),s.e(6478)]).then(s.bind(s,56478))).default,e=["intro/clouds-2/cloud-1.webp","intro/brushWhite.webp"];for(const s of e){const e=t.getTexture(s,this.renderer.gl,{alpha:!0,smooth:!1,wrap:"repeat"});await e.load(),this.cloudsTex.push(e.texture)}}async load(){await Promise.all([this.loadClouds()])}async start(){const t=(await s.e(1236).then(s.bind(s,31236))).default;this.prg=t(this.renderer.gl).get("intro-clouds"),this.setGeo(),this.cam=this.renderer.camera,this.setBaseTransformsTlClouds(),await this.setupTimelineAnimation(),this.timelineCloudsProgressTheatre=new h.Z(this.timelineCloudsProgress,this.introSheet,"timelineCloudsProgress")}stop(){this.buffer.dispose(),this.bufferIndex.dispose(),this.timelineCloudsProgressTheatre.dispose()}async onClick(){const t=await s.e(8348).then(s.bind(s,38348));t.gsap;this.introCloudsDone=!0}async goToTlEnd(){const t=await s.e(8348).then(s.bind(s,38348)),e=t.gsap;return e.to(this,{cloudsAlpha:0,duration:.5,onComplete:()=>{this.timelineCloudsDone=!0,this.cloudsAlpha=1}})}updateCloudsIntro(){for(let t=0;t<this.cloudsNode.length;t++){const e=this.cloudsNode[t];let s=0;s=0===t?3+1*this.cloudsMovement:-1.5-1*this.cloudsMovement;let i=0;i=0===t?1:.8,e.position.set([s,i,3]),e.invalidate(),e.updateWorldMatrix()}}updateCloudsTimeline(){for(let t=0;t<this.cloudsNodeTimeline.length;t++){const e=this.cloudsNodeTimeline[t],s=.5*Math.PI-.05*Math.random(),i=.5*Math.PI-.05*Math.random(),o=t%M;r.quat.identity(u),r.quat.identity(c),r.quat.identity(e.rotation),1===o||2===o?(r.quat.rotateY(u,u,s),r.quat.rotateX(c,u,i),e.rotation.set(c)):(r.quat.rotateY(u,u,s),e.rotation.set(u)),e.invalidate(),e.updateWorldMatrix()}}preRender(){if(!this.tl)return;this.tl.progress(this.timelineCloudsProgress.value),this.timelineCloudsProgress.value>=1&&!this.timelineCloudsDone&&(this.timelineCloudsDone=!0),this.updateCloudsIntro();const t=.005*n.Z.time;this.rootNode.position.set([2*Math.sin(.1*(t+100)),1.5*Math.sin(.15*t),this.rootNodeTransforms.z]),this.rootNode.invalidate(),this.rootNode.updateWorldMatrix()}rttPass(){}renderClouds(t,e=!0){if(this.tl)for(let s=0;s<t.length;s++){const i=t[s],o=this.cloudsTex[1];this.cam.modelViewProjectionMatrix(l,i._wmatrix);const a=Math.abs(this.renderer.camera._wposition[2]-i._wposition[2]),r=(0,d.CW)(2*p,-50,a);let h=Math.min(1,Math.max(0,r));const u=e?1:0;h=e?h:1,this.prg.use(),this.prg.uMVP(l),this.prg.uCamZ&&this.prg.uCamZ(this.renderer.camera._wposition[2]),this.prg.uDiffuse(o),this.prg.uAlpha(e?Math.min(1,this.timelineCloudsProgress.value*this.cloudsAlpha/.05):this.cloudsAlpha),this.prg.uAlphaDist(h),this.prg.uNoise(this._noiseTex),this.prg.uIsTlClouds(u),this.prg.uTime(n.Z.time),this.buffer.attribPointer(this.prg),this.bufferIndex.bind(),this.timelineCloudsHidden.includes(s)&&e||this.bufferIndex.drawTriangles()}}render(){this.introCloudsDone&&!this.timelineCloudsDone&&this.renderClouds(this.cloudsNodeTimeline)}}}}]);
//# sourceMappingURL=5800.66aa89a3.js.map