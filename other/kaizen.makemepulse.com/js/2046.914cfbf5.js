"use strict";(self["webpackChunkgl_starter"]=self["webpackChunkgl_starter"]||[]).push([[2046],{13579:function(e,t,s){var r=s(57195),i=s(16203);const h=34963;class n extends r.Z{constructor(e,t=e.UNSIGNED_SHORT,s,r=e.STATIC_DRAW,i){super(),this.gl=e,this.usage=r,this.buffer=void 0!==i?i:e.createBuffer(),this.type=0,this.typeSize=0,this.byteLength=0,this.setType(t),s&&this.data(s)}bind(){this.gl.bindBuffer(h,this.buffer)}setType(e){this.type=e,this.typeSize=(0,i.Z4)(e)}data(e){const t=this.gl;t.bindBuffer(h,this.buffer),t.bufferData(h,e,this.usage),t.bindBuffer(h,null),this.byteLength=(0,i.$P)(e)?e.byteLength:e}subData(e,t){const s=this.gl;s.bindBuffer(h,this.buffer),s.bufferSubData(h,t,e),s.bindBuffer(h,null)}dispose(){this.gl.deleteBuffer(this.buffer)}draw(e,t,s=0){t=void 0===t?this.byteLength/this.typeSize:t,this.gl.drawElements(e,t,this.type,0|s)}}t["Z"]=n},42046:function(e,t,s){s.r(t),s.d(t,{FlowMap:function(){return b}});var r=s(62642),i=s(63887),h=s(34072),n=s(18158),o=s(13579),a=s(31236),u=s(56478),l=s(46009);const d=i.vec3.create();function g(e,t){return t[0]=(e>>16&255)/255,t[1]=(e>>8&255)/255,t[2]=(255&e)/255,t}function f(e){return g(e,d)}function p(e){return g(e,i.vec3.create())}var c=s(22632);class b{constructor(e){this.renderer=e,this.fbos={},this.isReady=!1,this.aspect=1,this.viewport=[1,1],this.needsClear=!1,this.color=p(15323729),this.bgAlpha=0,this.angle=0,this.randAngleInfluence=1,this.velocity=i.vec2.create(),this.points=[],this.noiseStep=.65,this.alpha=.99,this.accumulation=1,this.useRandomAngle=!1,this.channelToUse=i.vec3.fromValues(1,0,0),this.isIntro=!0,this.grainVisibility=.6,this.brushTextureName="brush-02-2.png",this.prg=(0,a["default"])(this.renderer.gl).get("brush"),this.brush1Res=u["default"].getTexture("brushes/brush.png",e.gl,{alpha:!0,smooth:!1,wrap:"clamp"}),this.noiseTex=this.renderer.scene.texturePool.get("fbmNoise").texture,this.wNoise=this.renderer.scene.texturePool.get("whiteNoise").texture,this.renderPrg=(0,a["default"])(this.renderer.gl).get("brushRender")}createDebug(){var e;const t=l.Z.folder("Brushes");t.addColor(this,"color").onChange((e=>{const t=e.slice(1);this.color=f(parseInt(t,16))})),t.add(this,"useRandomAngle"),t.add(this,"noiseStep",{min:0,max:1,step:.01}),t.add(this,"randAngleInfluence",{min:0,max:1,step:.01}),t.add(this,"accumulation",{min:0,max:1,step:.01}),t.add(this,"alpha",{min:0,max:1,step:.01}),t.add(this,"grainVisibility",{min:0,max:1,step:.01}),t.btn("Clear",(()=>this.needsClear=!0)),t.btn("Show Texture",(()=>{this.imgBrush.style.display="block"})),(null===(e=this.imgBrush)||void 0===e?void 0:e.src)||(this.imgBrush=new Image,this.imgBrush.style.position="fixed",this.imgBrush.style.top="0",this.imgBrush.style.left="0",this.imgBrush.style.display="none",document.body.appendChild(this.imgBrush)),t.add(this,"brushTextureName",{options:c.q}).onChange((e=>{console.log(e);const t=u["default"].getAssetPath(decodeURI(`brushes/${e}`));this.imgBrush.src=t,this.imgBrush.onload=()=>{this.brush1Tex.setFormat(this.renderer.gl.RGBA),this.brush1Tex.fromImage(this.imgBrush)}}))}initBuffer(){const e=new Float32Array([-1,-1,1,0,0,1,-1,1,1,0,1,1,1,1,1,-1,1,1,0,1]);this.buffer=new n.Z(this.renderer.gl,e),this.renderBuffer=new n.Z(this.renderer.gl,e),this.iBuffer=new o.Z(this.renderer.gl,this.renderer.gl.UNSIGNED_SHORT,new Uint16Array([0,1,2,0,2,3])),this.renderIBuffer=new o.Z(this.renderer.gl,this.renderer.gl.UNSIGNED_SHORT,new Uint16Array([0,1,2,0,2,3])),this.buffer.attrib("aPosition",3,this.renderer.gl.FLOAT),this.renderBuffer.attrib("aPosition",3,this.renderer.gl.FLOAT),this.buffer.attrib("aTexCoord",2,this.renderer.gl.FLOAT),this.renderBuffer.attrib("aTexCoord",2,this.renderer.gl.FLOAT)}setFbos(){this.fbos.read=new h.Z(this.renderer.gl),this.fbos.read.attachColor();let e=this.fbos.read.getColorTexture();e.setFormat(this.renderer.gl.RGBA),this.fbos.read.resize(this.viewport[0],this.viewport[1]),e.bind(),this.fbos.write=new h.Z(this.renderer.gl),this.fbos.write.attachColor(),e=this.fbos.write.getColorTexture(),e.setFormat(this.renderer.gl.RGBA),this.fbos.write.resize(this.viewport[0],this.viewport[1]),e.bind(),this.swap(),this.isReady=!0}swap(){const e=this.fbos.read;this.fbos.read=this.fbos.write,this.fbos.write=e,this.texture=this.fbos.read.getColorTexture()}async load(){await Promise.all([this.brush1Res.load()]),this.afterLoad()}afterLoad(){this.brush1Tex=this.brush1Res.texture}onKeyDown(e){"r"===e.key&&(console.clear(),this.needsClear=!0)}setViewport(e,t){this.aspect=e,this.viewport=t,this.isReady&&(this.fbos.read.resize(this.viewport[0],this.viewport[1]),this.fbos.write.resize(this.viewport[0],this.viewport[1]))}setIsIntro(e){this.isIntro=e}setChannelToUse(e){this.channelToUse.set(e)}setAccumulation(e){this.accumulation=e}setNoiseStep(e){this.noiseStep=e}setUseRandomAngle(e){this.useRandomAngle=e}setAlphaBackground(e){this.bgAlpha=e}setBrushColor(e){g(e,this.color)}setBrushTexture(e){const t=c.q[e],s=u["default"].getAssetPath(decodeURI(`brushes/${t}`));this.imgBrush||(this.imgBrush=new Image),this.imgBrush.src=s,this.imgBrush.onload=()=>{this.brush1Tex.setFormat(this.renderer.gl.RGBA),this.brush1Tex.fromImage(this.imgBrush)}}clearOldBrush(){this.needsClear=!0}clearBrushs(){this.needsClear=!0;const e=document.querySelector(".brush-container");if(e){const t=e.querySelectorAll("img");for(let e=0;e<t.length;e++)r["default"].to(t[e],{duration:.5,delay:.1*e,autoAlpha:0,ease:"quart.out",onComplete:()=>t[e].remove()})}}start(){this.setFbos(),this.initBuffer()}stop(){this.buffer.dispose(),this.iBuffer.dispose(),this.fbos.read.dispose(),this.fbos.write.dispose(),this.brush1Tex.dispose(),this.noiseTex.dispose()}preRender(){this.isReady&&this.needsClear&&(this.needsClear=!1,this.fbos.read.bind(),this.fbos.read.defaultViewport(),this.renderer.gl.clearColor(0,0,0,0),this.renderer.gl.clear(this.renderer.gl.COLOR_BUFFER_BIT))}rttPass(){if(this.isReady&&this.points.length>0)for(let e=0;e<this.points.length;e++){const{coord:t,randAngle:s,alpha:r,size:i}=this.points[e];this.fbos.write.bind(),this.fbos.write.defaultViewport(),this.renderer.gl.clearColor(0,0,0,0),this.renderer.gl.clear(this.renderer.gl.COLOR_BUFFER_BIT),this.prg.use(),this.prg.uTex(this.fbos.read.getColorTexture()),this.prg.uCoord(t),this.prg.uAspect(this.aspect),this.prg.uVelocity(this.velocity),this.prg.uNoiseStep(this.noiseStep),this.prg.uAccumulation(this.accumulation),this.prg.uAngle(this.angle),this.prg.uScale(i),this.prg.uBrush1(this.brush1Tex),this.prg.uRandAngle(s),this.prg.uRandAngleInfluence(this.randAngleInfluence),this.prg.uRandAngleEnabled(this.useRandomAngle),this.prg.uNoise(this.noiseTex),this.prg.uChanToUse(this.channelToUse),this.prg.uAlpha(r),this.buffer.attribPointer(this.prg),this.iBuffer.bind(),this.iBuffer.drawTriangles(),this.swap()}}render(){this.isReady&&(this.renderPrg.use(),this.renderPrg.uTex(this.texture),this.renderPrg.uGrainVisibility(this.grainVisibility),this.renderPrg.uWNoise(this.wNoise),this.renderPrg.uAspect(this.aspect),this.renderPrg.uColor(this.color),this.renderPrg.uColorIntro1(f(15323729)),this.renderPrg.uColorIntro2(f(16742530)),this.renderPrg.uIsIntro(this.isIntro),this.renderPrg.uBackgroundAlpha(this.bgAlpha),this.renderPrg.uBrushAlpha(this.alpha),this.renderBuffer.attribPointer(this.renderPrg),this.renderIBuffer.bind(),this.renderIBuffer.drawTriangles())}}}}]);
//# sourceMappingURL=2046.914cfbf5.js.map