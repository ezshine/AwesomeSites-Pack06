(self["webpackChunkgl_starter"]=self["webpackChunkgl_starter"]||[]).push([[9793],{20598:function(t){var e=function(t){var e="";return e+="\n\n","pf"===t.slot&&(e+="\n#define PI 3.141592653\n#define PI_2 (PI * 2.)\n\nfloat ripples(vec2 coords, vec2 position, float seed, float size, float hide) {\n  vec2 center = vec2(position.x, position.y);\n  float dist = distance(coords, center);\n\n  float angleOffset = seed * PI_2 + uRippleTime() * 0.5;\n  float angle = mod(atan(coords.y - center.y, coords.x - center.x) + angleOffset, PI_2);\n  vec2 texCoords = vec2(\n    angle * 0.05,\n    dist * 10. - uRippleTime()\n  );\n  vec4 tex = texture2D(noiseTex, texCoords);\n  float pattern = mix(0., tex.r, smoothstep(0., 0.2, angle) - smoothstep(PI_2 - 0.2, PI_2, angle));\n\n  float limit = min(\n    // ripple outer limit\n    smoothstep(0.05, 1., dist)\n    // ripple grow\n    + step(1. * size, dist)\n    // ripple disappear\n    + hide\n    , 1.);\n\n  float stepVal = 0.55 + 0.45 * limit;\n  return smoothstep(stepVal - 0.02, stepVal + 0.02, pattern);\n}\n"),e+="\n\n","postf"===t.slot&&(e+="\n  float ripple = ripples(noise_texCoord(), vec2(0.5, 0.5), 0.3, smoothstep(1.0, 0.2, uOpacity()), 0.0);\n\n  FragColor.rgb = max(vec3(1., 1., 1.), baseColorFactor());\n  FragColor.a = ripple * uOpacity();\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},52284:function(t){var e=function(t){var e="";return e+="","postf"===t.slot&&(e+="\n\nfloat opacity = step(uThreshold(), FragColor.a);\n\nFragColor.a *= opacity * uOpacity() * step(uShadowThreshold(), FragColor.g);\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},18935:function(t){var e=function(t){var e="";return e+="","pf"===t.slot&&(e+="\n\nIN float vDepth;\n\n"),e+="\n\n","postf"===t.slot&&(e+="\n\nFragColor.rgb = mix(FragColor.rgb, vec3(111. / 255., 168. / 255., 137. / 255.), vDepth);\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},58610:function(t){var e=function(t){var e="";return e+="","pv"===t.slot&&(e+="\n\nOUT float vDepth;\n\n"),e+="\n\n","postv"===t.slot&&(e+="\n\nvDepth = vWorldPosition.y + 0.06;\nvDepth *= 20.;\nvDepth = max(0.0, vDepth);\nvDepth = min(1.0, vDepth);\nvDepth = 1.0 - vDepth;\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},85493:function(t){var e=function(t){var e="";return e+="","postf"===t.slot&&(e+="\n\nFragColor.rgb *= uColor();\nFragColor.a *= min(0.8, uOpacity());\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},13653:function(t){var e=function(t){var e="";return e+="","pf"===t.slot&&(e+="\n\nvec3 ContrastSaturationBrightness(vec3 color, float brt, float sat, float con)\n{\n\t// Increase or decrease theese values to adjust r, g and b color channels seperately\n\tconst float AvgLumR = 0.5;\n\tconst float AvgLumG = 0.5;\n\tconst float AvgLumB = 0.5;\n\t\n\tconst vec3 LumCoeff = vec3(0.2125, 0.7154, 0.0721);\n\t\n\tvec3 AvgLumin  = vec3(AvgLumR, AvgLumG, AvgLumB);\n\tvec3 brtColor  = color * brt;\n\tvec3 intensity = vec3(dot(brtColor, LumCoeff));\n\tvec3 satColor  = mix(intensity, brtColor, sat);\n\tvec3 conColor  = mix(AvgLumin, satColor, con);\n\t\n\treturn conColor;\n}\n\n"),e+="\n\n","postf"===t.slot&&(e+="\n\nFragColor.rgb = ContrastSaturationBrightness(FragColor.rgb, uBrightness(), uSaturation(), uContrast());\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},17744:function(t){var e=function(t){var e="";return e+="","pf"===t.slot&&(e+="\n\nIN vec2 vUv;\n\n"),e+="\n\n","f"===t.slot&&(e+="\n\nvec2 uvNoise = vec2(0.5) + abs(vUv - vec2(0.5));\nvec4 noise = texture2D(tNoise, vec2(uvNoise.x * 0.75, uvNoise.y * 0.75 + uTime() * .1));\nnoise *= 1.;\n\n"),e+="\n\n","postf"===t.slot&&(e+="\n\nFragColor.rgb *= uColor();\n\nfloat waterSurfaceOpacity = step(uAlphaThreshold(), FragColor.r);\nfloat d = uViewFoam() + ((noise.g + noise.b) * 0.5 * 2. - 1.) * 0.2;\nfloat distToCenter = smoothstep(d + 0.01, d, distance(vUv, vec2(0.)));\n\nFragColor.a *= distToCenter * uFoamOpacity() * tex.a * waterSurfaceOpacity;\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},64085:function(t){var e=function(t){var e="";return e+="","pv"===t.slot&&(e+="\n\nOUT vec2 vUv;\n\n"),e+="\n\n","postv"===t.slot&&(e+="\n\nvUv = vertex.position.xz;\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},45567:function(t){var e=function(t){var e="";return e+="","pv"===t.slot&&(e+="\n#if __VERSION__ == 300\n    #define texture2D(a, b) texture( a, b )\n#endif\n\nmat4 rotationY(in float angle) {\n\treturn mat4(cos(angle),\t0, sin(angle), 0,\n\t\t\t \t0, 1.0, 0, 0,\n\t\t\t\t-sin(angle), 0, cos(angle),\t0,\n\t\t\t\t0, 0, 0, 1);\n}\n\n"),e+="\n\n","vertex_warp"===t.slot&&(e+="\n\nfloat noiseAngle = texture2D(tNoise, vec2(uTime() * 0.05)).r * 4. - 2.;\n\nvec4 pos = vec4(vertex.position, 1.0);\npos *= rotationY(noiseAngle);\n\nvertex.position.xyz = pos.xyz;\n\n"),e+="\n\n","vertex_warp_world"===t.slot&&(e+="\n\nfloat noiseX = texture2D(tNoise, vec2(uTime() * 0.08)).r * 1.6 - .9;\nfloat noiseY = texture2D(tNoise, vec2(uTime() * 0.05 + 0.5)).r * 1.6 - .9;\n\nvertex.worldPos.xz += vec2(noiseX, noiseY) * uMoveFactor();\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},10389:function(t){var e=function(t){var e="";return e+="","vertex_warp_world"===t.slot&&(e+="\nfloat windStrength = vertex.worldPos.y;\nwindStrength -= 0.3;\nwindStrength = max(windStrength, 0.0);\nwindStrength = pow(windStrength, 2.0);\nwindStrength *= 0.2;\n\nfloat windOffset = sin(uTime() * .9 + vertex.worldPos.x + vertex.worldPos.z) * .5 + .5;\nwindOffset *= windStrength;\n\nvertex.worldPos.x += windOffset;\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},11896:function(t){var e=function(t){var e="";return e+="\n\n","postf"===t.slot&&(e+="\n  FragColor.a *= uOpacity();\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},74665:function(t){var e=function(t){var e="";return e+="","pf"===t.slot&&(e+="\n\nIN vec2 vUv;\n\n"),e+="\n\n","f"===t.slot&&(e+="\nvec2 uvNoise = vec2(0.5) + abs(vUv - vec2(0.5));\nvec4 noise = texture2D(tNoise, vec2(uvNoise.x * 1., uvNoise.y * 1. + uTime() * .1));\n// noise *= texture2D(tNoise, vec2(vUv.x * .1 - uTime(), vUv.y * .1));\n// noise *= texture2D(tNoise, vec2(vUv * .3 + uTime() * .2));\nnoise *= 1.;\n\n"),e+="\n\n","postf"===t.slot&&(e+="\n\nFragColor.rgb *= 0.001;\nFragColor.rgb += tex.rgb;\n\nfloat waterSurfaceOpacity = step(uAlphaThreshold(), FragColor.r);\n// float distToCenter = 1.3 - distance(vUv, vec2(0.5, 0.5));\nfloat d = uViewFoam() + ((noise.g + noise.b)) * 0.2;\nfloat distToCenter = smoothstep(d + 0.01, d, distance(vUv, vec2(0.)));\n\nFragColor.rgb *= uFoamColor();\n\nFragColor.a *= waterSurfaceOpacity * uOpacity() * distToCenter * tex.a;\n// FragColor.rgb = vec3(1., 0., 0.);\n// FragColor.a = 1.;\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},84596:function(t){var e=function(t){var e="";return e+="","pv"===t.slot&&(e+="\n\nOUT vec2 vUv;\n\n"),e+="\n\n","postv"===t.slot&&(e+="\n\nvUv = vertex.position.xz;\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},90943:function(t){var e=function(t){var e="";return e+="","pf"===t.slot&&(e+="\n\nIN float vWaterDepth;\n\n"),e+="\n\n","postf"===t.slot&&(e+="\n\nfloat uvY = 1. - gl_FragCoord.y / uViewportSize().y / (uViewportSize().x / uViewportSize().y);\nuvY = min(1., max(0., uvY));\n\nvec3 waterColor = mix(uWaterColor(), uDeepWaterColor(), uvY);\nFragColor.rgb = mix(FragColor.rgb, waterColor, min(1., max(0., vWaterDepth) * uDeepWaterColorFactor()));\n\n"),e+="\n",e};e.toString=e,t.exports=e,e.onHmr=function(){}},9390:function(t){var e=function(t){var e="";return e+="","pv"===t.slot&&(e+="\n#if __VERSION__ == 300\n    #define texture2D(a, b) texture( a, b )\n#endif\n\nOUT float vWaterDepth;\n\n"),e+="\n\n","vertex_warp_world"===t.slot&&(e+="\n\nvWaterDepth = uWaterHeight() - vertex.worldPos.y;\n\n"),e+="\n\n","postv"===t.slot&&(e+="\n\nvec2 UV = vertex.position.xz;\nfloat t = uTime() * 2.;\nfloat noise = texture2D(tNoise, vec2(UV.x * .1 + t, UV.y * .1 + t) * 0.1).r * 2. - 1.;\nfloat distToCamera = length(vertex.worldPos.xyz - uCameraPos());\n\ngl_Position.xy += noise * 0.01 * max(0., vWaterDepth) * distToCamera;\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},31474:function(t){var e=function(t){var e="";return e+="","pf"===t.slot&&(e+="\n\nIN float vWaterDepth;\n\n"),e+="\n\n","postf"===t.slot&&(e+="\n\nFragColor.rgb = uWaterColor();\nFragColor.a = 1. - min(1., max(0., vWaterDepth) * uOpacityThreshold());\n\n"),e+="\n",e};e.toString=e,t.exports=e,e.onHmr=function(){}},60362:function(t){var e=function(t){var e="";return e+="","pv"===t.slot&&(e+="\n\nOUT float vWaterDepth;\n\n"),e+="\n\n","vertex_warp_world"===t.slot&&(e+="\n\nvWaterDepth = uWaterHeight() - vertex.worldPos.y;\nvertex.worldPos.y -= max(0., vWaterDepth) * uDistortionFactor();\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},33814:function(t){var e=function(t){var e="";return e+="","pf"===t.slot&&(e+="\n\nIN vec2 vUv;\n\n"),e+="\n\n","f"===t.slot&&(e+="\n\n\n\n"),e+="\n\n","postf"===t.slot&&(e+="\n\nFragColor.rgb *= uWaterColor();\n// FragColor.rgb += ref;\n\n// FragColor.a *= waterSurfaceOpacity;\n// FragColor.a *= 1. / waterSurfaceOpacity;\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},88220:function(t){var e=function(t){var e="";return e+="","pv"===t.slot&&(e+="\n\nOUT vec2 vUv;\n\nvec2 rotate(vec2 v, float a) {\n\tfloat s = sin(a);\n\tfloat c = cos(a);\n\tmat2 m = mat2(c, s, -s, c);\n\treturn m * v;\n}\n\n"),e+="\n\n","vertex_warp_world"===t.slot&&(e+="\n\nvertex.worldPos.xz = rotate(vertex.worldPos.xz, uSurfaceTime());\n\n"),e+="\n\n","postv"===t.slot&&(e+="\n\nvUv = vertex.position.xz;\n\n"),e+="",e};e.toString=e,t.exports=e,e.onHmr=function(){}},15901:function(t){var e=function(t){var e="";return e+="\nvec3 ref = vec3(0.);\n#if enableFReflect\n{\n  vec2 screenUV = gl_FragCoord.xy / ScreenSize();\n  screenUV += vec2(sin(100. * (screenUV.y + uTime())) * 0.001, 0.);\n  ref = vec3(1.0) - texture2D( tFloorReflect, screenUV).rgb;\n  ref = ReflectionStrength() * ref; //pow( ref, vec3(2.2) );\n  lightingData.lightingColor += ref;\n}\n#endif",e};e.toString=e,t.exports=e,e.onHmr=function(){}},14462:function(t){var e=function(t){var e="";return e+="\nuniform sampler2D tFloorReflect;",e};e.toString=e,t.exports=e,e.onHmr=function(){}},89906:function(t,e,s){"use strict";var i=s(85645),o=s(76670),a=s(42307);const r=new Float32Array(4);class n extends a.Z{constructor(){super(),this._type=o.Z.SPOT,this._innerAngle=0,this._outerAngle=0,this._radius=0,this._camera=null,this._attenuationData=new Float32Array(4),this.outerAngle=Math.PI/4,this.radius=50}projectionFromBounds(t){const e=this.boundsInLocalSpace(t);let s=-e[5],i=-e[2];const o=this._radius<=0?Number.MAX_VALUE:this._radius;s=Math.max(.001,Math.min(s,o)),i=Math.max(.005+s,Math.min(i,o));const a=this._camera.lens;a.near=s,a.far=i}getTexelBiasVector(){var t=this._camera._view,e=-2*Math.tan(this._outerAngle);return r[0]=t[2]*e,r[1]=t[6]*e,r[2]=t[10]*e,r[3]=t[14]*e,r}_createCamera(){var t=i.Z.makePerspectiveCamera();return t.lens.aspect=1,t.lens.fov=2*this._outerAngle,t.lens.near=10,t.lens.far=20,t}get innerAngle(){return this._innerAngle}set innerAngle(t){this._innerAngle=t,this._updateSpotData()}get angle(){return this._outerAngle}set angle(t){this.outerAngle=t}get outerAngle(){return this._outerAngle}set outerAngle(t){this._outerAngle=t,this._updateSpotData(),this.castShadows&&(this._camera.lens.fov=2*this._outerAngle)}get radius(){return this._radius}set radius(t){this._radius=t,this._updateSpotData()}_updateSpotData(){this._attenuationData[0]=1/(this._radius*this._radius),this._attenuationData[1]=this._radius*this._radius,this._attenuationData[2]=1/Math.max(.001,Math.cos(this._innerAngle)-Math.cos(this._outerAngle)),this._attenuationData[3]=-Math.cos(this._outerAngle)*this._attenuationData[2]}}e["Z"]=n},59793:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return He}});var i=s(61221),o=s(42946),a=s(63887),r=s(75989),n=s(63132);class h{constructor(t,e,s=!1,i=1){this.gltf=t,this.foamGltf=e,this.hasLotus=s,this.scale=i,this.time=Math.random(),this.position=a.vec3.create(),this.topRotation=a.quat.create(),this.lotusRotation=a.quat.create(),this.node=t.root,a.quat.rotateY(this.topRotation,this.topRotation,Math.random()*Math.PI*2),this.foamNode=e.root}start(){this.hasLotus&&(this.petale_01=this.gltf.getElementByName(r.Z.NODE,"petale_01"),this.petale_02=this.gltf.getElementByName(r.Z.NODE,"petale_02"),this.petale_03=this.gltf.getElementByName(r.Z.NODE,"petale_03"),this.pistils=this.gltf.getElementByName(r.Z.NODE,"pistils"),this.petale_01.setScale(.01),this.petale_02.setScale(.01),this.petale_03.setScale(.01),this.pistils.setScale(.01),this.petale_01.invalidate(),this.petale_02.invalidate(),this.petale_03.invalidate(),this.pistils.invalidate(),this.petale_01.updateWorldMatrix(),this.petale_02.updateWorldMatrix(),this.petale_03.updateWorldMatrix(),this.pistils.updateWorldMatrix(),a.quat.rotateY(this.lotusRotation,this.lotusRotation,Math.random()*Math.PI*2)),this.invalidate()}invalidate(){this.gltf.root.invalidate(),this.gltf.root.updateWorldMatrix(),this.node.invalidate(),this.node.updateWorldMatrix(),this.foamNode.invalidate(),this.foamNode.updateWorldMatrix()}preRender(t){if(this.hasLotus){const e=t,s=(0,n.CW)(0,.4,e),i=(0,n.CW)(0,.6,e),o=(0,n.CW)(0,.8,e),r=(0,n.CW)(0,1,e);this.pistils.setScale(s),this.petale_01.setScale(i),this.petale_02.setScale(o),this.petale_03.setScale(r),a.quat.identity(this.pistils.rotation),this.pistils.rotateY(2*Math.PI*s),a.quat.identity(this.petale_01.rotation),this.petale_01.rotateY(2*Math.PI*i),a.quat.identity(this.petale_02.rotation),this.petale_02.rotateY(2*Math.PI*o),a.quat.identity(this.petale_03.rotation),this.petale_03.rotateY(2*Math.PI*r),this.petale_01.invalidate(),this.petale_02.invalidate(),this.petale_03.invalidate(),this.pistils.invalidate(),this.petale_01.updateWorldMatrix(),this.petale_02.updateWorldMatrix(),this.petale_03.updateWorldMatrix(),this.pistils.updateWorldMatrix()}}render(t){if(a.vec3.copy(this.gltf.root.position,this.position),a.vec3.copy(this.foamNode.position,this.position),a.vec3.sub(this.foamNode.position,this.foamNode.position,a.vec3.fromValues(0,.001,0)),a.vec3.set(this.gltf.root.scale,this.scale,this.scale,this.scale),a.vec3.copy(this.foamNode.scale,this.gltf.root.scale),a.vec3.add(this.foamNode.scale,this.foamNode.scale,a.vec3.fromValues(.4,.4,.4)),a.quat.copy(this.node.rotation,this.topRotation),a.quat.copy(this.foamNode.rotation,this.topRotation),this.invalidate(),t.pass!==o.Z.DEPTH&&t.pass!==o.Z.REFLECT_DEPTH)for(const e of this.foamGltf.renderables)e.render(t.gl,t.camera,t.mask,t.pass,t.glConfig);for(const e of this.gltf.renderables)e.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}}var l=s(14888),c=s(5839),d=s(76879),u=s(79763),p=s(49500),m=s(52284),f=s.n(m);const g=(0,d.Z)(f());class v extends u.Z{constructor(){super(!0,!1),this.addChild(this.threshold=new p.ZP("uThreshold",1,p.Ho.FRAGMENT)),this.addChild(this.opacity=new p.ZP("uOpacity",1,p.Ho.FRAGMENT)),this.addChild(this.shadowThreshold=new p.ZP("uShadowThreshold",1,p.Ho.FRAGMENT)),this.threshold.attachConstant(.5),this.opacity.attachConstant(1),this.shadowThreshold.attachConstant(.5),g.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("postf",g({slot:"postf"}))}}var C=s(17052),w=s(13653),_=s.n(w);const x=(0,d.Z)(_());class y extends u.Z{constructor(){super(!0,!1),this.addChild(this.brightness=new p.ZP("uBrightness",1,p.Ho.FRAGMENT)),this.addChild(this.saturation=new p.ZP("uSaturation",1,p.Ho.FRAGMENT)),this.addChild(this.contrast=new p.ZP("uContrast",1,p.Ho.FRAGMENT)),this.brightness.attachConstant(1),this.saturation.attachConstant(1),this.contrast.attachConstant(1),x.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("pf",x({slot:"pf"})),t.add("postf",x({slot:"postf"}))}}var b=s(64085),P=s.n(b),T=s(17744),M=s.n(T);const S=(0,d.Z)(P()),R=(0,d.Z)(M());class Z extends u.Z{constructor(t){super(!0,!1),this.addChild(this.alphaThreshold=new p.ZP("uAlphaThreshold",1,p.Ho.FRAGMENT)),this.addChild(this.opacity=new p.ZP("uFoamOpacity",1,p.Ho.FRAGMENT)),this.addChild(this.time=new p.ZP("uTime",1,p.Ho.ALL)),this.addChild(this.noise=new p.ZP("noise",4,p.Ho.FRAGMENT)),this.addChild(this.viewFoam=new p.ZP("uViewFoam",1,p.Ho.FRAGMENT)),this.addChild(this.color=new p.ZP("uColor",3,p.Ho.FRAGMENT)),this.transformedCode=t.getPass("color").pass.surface.baseColor.param.texCoords.getTransformCode(),this.transformedCode=this.transformedCode.split(" ")[0],this.transformedCode=`vec4 tex = texture2D(tex_basecolor, ${this.transformedCode});`,this.alphaThreshold.attachConstant(.5),this.opacity.attachConstant(1),this.time.attachConstant(0),this.color.attachConstant([0,1,0]),S.onHmr((()=>this.invalidateCode())),R.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("pv",S({slot:"pv"})),t.add("postv",S({slot:"postv"})),t.add("pf",R({slot:"pf"})),t.add("f",R({slot:"f"})),t.add("postf",this.transformedCode),t.add("postf",R({slot:"postf"}))}}var F=s(1517),k=s(21370),A=s(45567),E=s.n(A);const L=(0,d.Z)(E());class N extends u.Z{constructor(){super(!0,!1),this.addChild(this.time=new p.ZP("uTime",1,p.Ho.VERTEX)),this.addChild(this.noise=new p.ZP("noise",4,p.Ho.VERTEX)),this.addChild(this.moveFactor=new p.ZP("uMoveFactor",1,p.Ho.VERTEX)),this.time.attachConstant(0),this.moveFactor.attachConstant(1),L.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("pv",L({slot:"pv"})),t.add("vertex_warp",L({slot:"vertex_warp"})),t.add("vertex_warp_world",L({slot:"vertex_warp_world"}))}}var V=s(38677),O=s(5434);class H{constructor(t,e,s){this.renderer=t,this.lilies=[],this.renderables=[],this.moveFactor={value:1,startV:0},this.lotusOpening={value:0,startV:0},this.noiseTex=this.renderer.scene.texturePool.get("perlinNoise").texture;const o=new l.Z,a=new y;this.lilyContrast=a.contrast.attachUniform(),this.lilySaturation=a.saturation.attachUniform(),this.lilyBrightness=a.brightness.attachUniform();const r=new N;this.lilyTime=r.time.attachUniform(),this.lilyMoveFactor=r.moveFactor.attachUniform(),this.lilyNoiseTex=r.noise.attachSampler("tNoise",F.ZP.create("aTexCoord0"));const n=new C.Z;n.ambientAddUniform.set(2),o.overridePass("",((t,e)=>{const i=e.getPass("color").pass;return i.inputs.add(n),i.inputs.add(a),i.inputs.add(s),i})),this.lilyRes=new i.ZP("scene2/lily.glb",t.gl,{defaultTextureFilter:t.gl.LINEAR_MIPMAP_LINEAR,extensions:[o]});const h=new l.Z,d=new v;this.foamBlendThreshold=d.threshold.attachUniform(),this.foamBlendShadowThreshold=d.shadowThreshold.attachUniform(),this.foamBlendOpacity=d.opacity.attachUniform(),h.overridePass("",((i,o)=>{const a=new Z(o);this.foamTime=a.time.attachUniform(),this.foamNoiseTex=a.noise.attachSampler("tNoise",F.ZP.create("aTexCoord0")),this.foamColor=a.color.attachUniform(),this.viewFoam=a.viewFoam.attachUniform();const r=o.getPass("color").pass;return r.inputs.add(e),r.inputs.add(d),r.inputs.add(a),r.inputs.add(s),r.alphaMode.set("BLEND"),r.mask=c.Z.BLENDED,r.glconfig.depthMask(!1).enableBlend().blendFunc(t.gl.SRC_ALPHA,t.gl.ONE_MINUS_SRC_ALPHA),r})),this.foamRes=new i.ZP("scene2/foam.glb",t.gl,{defaultTextureFilter:t.gl.LINEAR_MIPMAP_LINEAR,extensions:[h]});const u=new l.Z,p=new y;this.lotusContrast=p.contrast.attachUniform(),this.lotusSaturation=p.saturation.attachUniform(),this.lotusBrightness=p.brightness.attachUniform(),u.overridePass("",((t,e)=>{const s=e.getPass("color").pass;return s.inputs.add(n),s.inputs.add(p),s})),this.positionsRes=new i.ZP("scene2/nenupharSpawnPoints.gltf",t.gl,{defaultTextureFilter:t.gl.LINEAR_MIPMAP_LINEAR})}async load(){return Promise.all([this.lilyRes.load(),this.foamRes.load(),this.positionsRes.load()])}onLoaded(){this.lily=this.lilyRes.gltf,this.foam=this.foamRes.gltf,this.positions=this.positionsRes.gltf.nodes,this.renderables.push(...this.lily.renderables),this.positions.forEach((t=>{if(0===this.positions.length)return;const e=t.position,s=!0,i=.75+.5*(2*Math.random()-1),o=new h(this.lily,this.foam,s,i);o.position.set([e[0],e[1]-.02,e[2]]),this.lilies.push(o)})),this.lilies=this.lilies.sort(((t,e)=>t.position[1]-e.position[1]))}start(){this.moveFactorTimeline=new O.Z(this.moveFactor,this.sheetSuccess,"Lily Move Factor"),this.lotusOpeningTimeline=new O.Z(this.lotusOpening,this.sheetSuccess,"Lotus Opening"),this.lilies.forEach((t=>t.start())),this.foamBlendThreshold.set(0),this.foamBlendShadowThreshold.set(0),this.foamBlendOpacity.set(.228),this.lilyContrast.set(1.4347826087),this.lilySaturation.set(.8260869565),this.lilyBrightness.set(.6304347826),this.lotusContrast.set(1.0869565217),this.lotusSaturation.set(.847826087),this.lotusBrightness.set(.7826086957),this.foamNoiseTex.set(this.noiseTex),this.foamColor.set(1,1,1),this.lilyNoiseTex.set(this.noiseTex),this.moveFactor.startV=this.moveFactor.value,this.lotusOpening.startV=this.lotusOpening.value}stop(){this.moveFactorTimeline.dispose(),this.lotusOpeningTimeline.dispose()}preRender(){this.foamBlendOpacity.set(.25+.2*V.Z.transition.value),this.lilyMoveFactor.set(this.moveFactor.value),this.foamTime.set(1e-4*k.Z.scaledTime),this.viewFoam.set(.3+.8*V.Z.transition.value),this.lilies.forEach(((t,e)=>{t.preRender(this.lotusOpening.value),this.lilyTime.set(1e-5*k.Z.dt+100.1*e)}))}render(t){this.lilies.forEach(((e,s)=>{this.foamTime.set(4e-4*(k.Z.scaledTime+e.time)),e.render(t)}))}}class U{constructor(t){this.gltf=t,this.time=Math.random(),this.position=a.vec3.create(),this.rotation=a.quat.create(),this.scale=1,this.scale=.5+.5*Math.random(),this.renderables=t.renderables}start(){this.invalidate()}invalidate(){this.gltf.root.invalidate(),this.gltf.root.updateWorldMatrix()}render(t){if(t.pass!==o.Z.REFLECT_DEPTH&&t.pass!==o.Z.DEPTH){a.vec3.copy(this.gltf.root.position,this.position),a.vec3.set(this.gltf.root.scale,this.scale,this.scale,this.scale),this.invalidate();for(const e of this.renderables)e.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}}}var D=s(60362),I=s.n(D),W=s(31474),B=s.n(W);const q=(0,d.Z)(I()),z=(0,d.Z)(B());class j extends u.Z{constructor(){super(!0,!1),this.addChild(this.waterHeight=new p.ZP("uWaterHeight",1,p.Ho.VERTEX)),this.addChild(this.distortionFactor=new p.ZP("uDistortionFactor",1,p.Ho.VERTEX)),this.addChild(this.opacityThreshold=new p.ZP("uOpacityThreshold",1,p.Ho.FRAGMENT)),this.addChild(this.waterColor=new p.ZP("uWaterColor",3,p.Ho.FRAGMENT)),this.waterHeight.attachConstant(0),this.distortionFactor.attachConstant(1),this.opacityThreshold.attachConstant(1),this.waterColor.attachConstant([0,0,1]),q.onHmr((()=>this.invalidateCode())),z.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("pv",q({slot:"pv"})),t.add("vertex_warp_world",q({slot:"vertex_warp_world"})),t.add("pf",z({slot:"pf"})),t.add("postf",z({slot:"postf"}))}}var G=s(84596),X=s.n(G),Y=s(74665),$=s.n(Y);const J=(0,d.Z)(X()),K=(0,d.Z)($());class Q extends u.Z{constructor(t){super(!0,!1),this.addChild(this.foamColor=new p.ZP("uFoamColor",3,p.Ho.FRAGMENT)),this.addChild(this.alphaThreshold=new p.ZP("uAlphaThreshold",1,p.Ho.FRAGMENT)),this.addChild(this.opacity=new p.ZP("uOpacity",1,p.Ho.FRAGMENT)),this.addChild(this.time=new p.ZP("uTime",1,p.Ho.ALL)),this.addChild(this.viewFoam=new p.ZP("uViewFoam",1,p.Ho.FRAGMENT)),this.addChild(this.noise=new p.ZP("noise",4,p.Ho.FRAGMENT)),this.transformedCode=t.getPass("color").pass.surface.baseColor.param.texCoords.getTransformCode(),this.transformedCode=this.transformedCode.split(" ")[0],this.transformedCode=`vec4 tex = texture2D(tex_basecolor, ${this.transformedCode});`,this.foamColor.attachConstant([0,1,0]),this.alphaThreshold.attachConstant(.5),this.opacity.attachConstant(1),this.time.attachConstant(0),J.onHmr((()=>this.invalidateCode())),K.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("pv",J({slot:"pv"})),t.add("postv",J({slot:"postv"})),t.add("pf",K({slot:"pf"})),t.add("f",K({slot:"f"})),t.add("postf",this.transformedCode),t.add("postf",K({slot:"postf"}))}}class tt extends u.Z{constructor(){super(!0,!1),this.addChild(this.color=new p.ZP("cs_color",4)),this.addChild(this.threshold=new p.ZP("cs_threshold",1)),this.threshold.attachConstant(.5)}_genCode(t){const e="\n    if( cs_threshold() > cs_color().a ){\n      discard;\n    }";t.add("f",e)}}var et=s(58610),st=s.n(et),it=s(18935),ot=s.n(it);const at=(0,d.Z)(st()),rt=(0,d.Z)(ot());class nt extends u.Z{constructor(){super(!0,!1),at.onHmr((()=>this.invalidateCode())),rt.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("pv",at({slot:"pv"})),t.add("postv",at({slot:"postv"})),t.add("pf",rt({slot:"pf"})),t.add("postf",rt({slot:"postf"}))}}const ht=Math.floor(3+3*Math.random());class lt{constructor(t,e,s){this.renderer=t,this.outRocks=[],this.renderables=[],this.noiseTex=this.renderer.scene.texturePool.get("perlinNoise").texture;const o=new l.Z,a=new l.Z,r=new j;this.waterHeight=r.waterHeight.attachUniform(),this.distortionFactor=r.distortionFactor.attachUniform(),this.opacityThreshold=r.opacityThreshold.attachUniform(),this.waterColor=r.waterColor.attachUniform();new tt;const n=new y;this.rockContrast=n.contrast.attachUniform(),this.rockSaturation=n.saturation.attachUniform(),this.rockBrightness=n.brightness.attachUniform(),o.overridePass("Rock",((e,s)=>{const i=s.getPass("color").pass;return i.inputs.add(r),i.alphaMode.set("BLEND"),i.mask=c.Z.BLENDED,i.glconfig.enableBlend().blendFunc(t.gl.SRC_ALPHA,t.gl.ONE_MINUS_SRC_ALPHA),i}));const h=new nt;let d;a.overridePass("",((i,o)=>{const a=o.getPass("color").pass;return a.inputs.add(e),a.inputs.add(n),a.inputs.add(s),a.inputs.add(h),a.alphaMode.set("BLEND"),a.mask=c.Z.BLENDED,a.glconfig.enableBlend().blendFunc(t.gl.SRC_ALPHA,t.gl.ONE_MINUS_SRC_ALPHA),a})),a.overridePass("Water",((e,s)=>{if(s.getPass("color").pass.inputs._chunks.some((t=>t instanceof Q)))return;d||(d=new Q(s)),this.outFoamColor=d.foamColor.attachUniform(),this.outAlphaThreshold=d.alphaThreshold.attachUniform(),this.centerRockFoamOpacity=d.opacity.attachUniform(),this.outRockTime=d.time.attachUniform(),this.centerViewFoam=d.viewFoam.attachUniform(),this.outRockNoiseTex=d.noise.attachSampler("tNoise",F.ZP.create("aTexCoord0"));const i=s.getPass("color").pass;return i.inputs.add(d),i.alphaMode.set("BLEND"),i.mask=c.Z.BLENDED,i.glconfig.enableBlend().blendFunc(t.gl.SRC_ALPHA,t.gl.ONE_MINUS_SRC_ALPHA),i})),o.overridePass("Water",((e,i)=>{if(i.getPass("color").pass.inputs._chunks.some((t=>t instanceof Q)))return;d||(d=new Q(i)),this.outFoamColor=d.foamColor.attachUniform(),this.outAlphaThreshold=d.alphaThreshold.attachUniform(),this.outRockFoamOpacity=d.opacity.attachUniform(),this.outRockTime=d.time.attachUniform(),this.outViewFoam=d.viewFoam.attachUniform(),this.outRockNoiseTex=d.noise.attachSampler("tNoise",F.ZP.create("aTexCoord0"));const o=i.getPass("color").pass;return o.inputs.add(d),o.inputs.add(s),o.alphaMode.set("BLEND"),o.mask=c.Z.BLENDED,o.glconfig.depthMask(!1).enableBlend().blendFunc(t.gl.SRC_ALPHA,t.gl.ONE_MINUS_SRC_ALPHA),o})),this.outRockRes=new i.ZP("scene2/rock_1.gltf",t.gl,{defaultTextureFilter:t.gl.LINEAR_MIPMAP_LINEAR,extensions:[o]}),this.centerRocksRes=new i.ZP("scene2/rocks.glb",t.gl,{defaultTextureFilter:t.gl.LINEAR_MIPMAP_LINEAR,extensions:[a]}),this.outPositionsRes=new i.ZP("scene2/rocks_positions.gltf",t.gl,{defaultTextureFilter:t.gl.LINEAR_MIPMAP_LINEAR})}async load(){return Promise.all([this.outRockRes.load(),this.centerRocksRes.load(),this.outPositionsRes.load()])}onLoaded(){this.outRockGltf=this.outRockRes.gltf,this.centerRocksGltf=this.centerRocksRes.gltf,this.outPositions=this.outPositionsRes.gltf.nodes;const t=this.centerRocksGltf.renderables.filter((t=>!t.node.name.includes("Plane.002_Baked"))),e=this.centerRocksGltf.renderables.filter((t=>t.node.name.includes("Plane.002_Baked")));for(const i of t)i.node.position[1]-=.05,i.node.invalidate(),i.node.updateWorldMatrix();let s=0;for(const i of e)i.node.position[1]+=.002*s,s++,i.node.invalidate(),i.node.updateWorldMatrix();this.renderables=[...t];for(let i=0;i<ht;i++)this.outRocks.push(new U(this.outRockGltf));this.outRocks.forEach((t=>{const e=this.outPositions;if(0===e.length)return;const s=Math.floor(Math.random()*e.length),i=e[s].position;t.position.set([i[0],i[1],i[2]]),e.splice(s,1)}))}start(t){this.outRocks.forEach((t=>t.start())),this.waterHeight.set(t+.35),this.distortionFactor.set(2),this.opacityThreshold.set(10),this.waterColor.set(.5739,.701,.6495),this.outFoamColor.set(1,1,1),this.outAlphaThreshold.set(.6),this.outRockFoamOpacity.set(.35),this.outRockNoiseTex.set(this.noiseTex),this.rockContrast.set(1.13),this.rockSaturation.set(1),this.rockBrightness.set(1.2)}preRender(){this.outRockFoamOpacity.set(.328+.5*V.Z.transition.value),this.outViewFoam.set(.4+.6*V.Z.transition.value),this.centerRockFoamOpacity.set(.6+.2*V.Z.transition.value),this.centerViewFoam.set(.4+.6*V.Z.transition.value)}render(t){this.outRocks.forEach((e=>{this.outRockTime.set(4e-4*(k.Z.scaledTime+e.time)),e.render(t)}));for(const[e,s]of this.centerRocksGltf.renderables.entries())s.node.invalidate(),s.node.updateWorldMatrix(),s.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}}var ct=s(97703),dt=s(61987),ut=s(9390),pt=s.n(ut),mt=s(90943),ft=s.n(mt);const gt=(0,d.Z)(pt()),vt=(0,d.Z)(ft());class Ct extends u.Z{constructor(){super(!0,!1),this.addChild(this.waterHeight=new p.ZP("uWaterHeight",1,p.Ho.VERTEX)),this.addChild(this.waterColor=new p.ZP("uWaterColor",3,p.Ho.FRAGMENT)),this.addChild(this.deepWaterColor=new p.ZP("uDeepWaterColor",3,p.Ho.FRAGMENT)),this.addChild(this.deepWaterColorFactor=new p.ZP("uDeepWaterColorFactor",1,p.Ho.FRAGMENT)),this.addChild(this.time=new p.ZP("uTime",1,p.Ho.VERTEX)),this.addChild(this.noise=new p.ZP("noise",4,p.Ho.VERTEX)),this.addChild(this.viewportSize=new p.ZP("uViewportSize",2,p.Ho.FRAGMENT)),this.addChild(this.cameraPos=new p.ZP("uCameraPos",3,p.Ho.VERTEX)),this.waterHeight.attachConstant(0),this.waterColor.attachConstant([0,1,0]),this.deepWaterColor.attachConstant([0,0,0]),this.deepWaterColorFactor.attachConstant(1),this.time.attachConstant(0),this.viewportSize.attachConstant([0,0]),this.cameraPos.attachConstant([0,0,0]),gt.onHmr((()=>this.invalidateCode())),vt.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("pv",gt({slot:"pv"})),t.add("vertex_warp_world",gt({slot:"vertex_warp_world"})),t.add("postv",gt({slot:"postv"})),t.add("pf",vt({slot:"pf"})),t.add("postf",vt({slot:"postf"}))}}var wt=s(14697),_t=s(62642),xt=s(46381);class yt{constructor(t,e,s){this.v=t,this.sheet=e,this.name=s;const i=e.object(s,{position:xt.types.compound({x:xt.types.number(t[0]),y:xt.types.number(t[1]),z:xt.types.number(t[2])})});this._unsubscribe=i.onValuesChange((t=>{const{x:e,y:s,z:i}=t.position;a.vec3.set(this.v,e,s,i)})),this._obj=i}dispose(){this._unsubscribe(),this.sheet.detachObject(this.name)}}var bt=s(75256),Pt=s(87655),Tt=s(28306),Mt=s(88271),St=s(39650);const Rt=a.vec3.create(),Zt=a.vec3.create(),Ft=a.vec3.create(),kt=a.quat.create();class At{constructor(t,e){this.renderer=t,this.pond=e,this.finallookAt=a.vec3.fromValues(0,0,0),this.lookAt=a.vec3.create(),this.targetLookAt=a.vec3.create(),this.pondCenter=a.vec3.create(),this.outroFov=.9519629308995201,this.distanceFromCenter=At.CAM_DISTANCE,this.focusFish=.2,this.focusHeight=0,this.rotationSpeed=.02,this.rotationZ=0,this.shakeTime=Math.random(),this.saveCamParentPos=a.vec3.create(),this.cameraInitialPosition=a.vec3.create(),this.camShakeV=a.vec3.create(),this.quatcamy=a.quat.create(),this.quatcamx=a.quat.create(),this.cameraTargetX=0,this.cameraTargetY=0,this.rotation={value:1,startV:0},this.height={value:.5,startV:0},this.fov={value:.7,startV:0},this.camShake={value:0,startV:0},this.localPosition={value:a.vec3.fromValues(0,0,0),startV:a.vec3.create()},this.localLookAt={value:a.vec3.fromValues(0,0,0),startV:a.vec3.create()},this.localLookAtMobile={value:a.vec3.fromValues(0,0,0),startV:a.vec3.create()},this.totalTime=0,this.introLookAt=new dt.Z,At.node=new dt.Z,this.lookAtNode=new dt.Z,At.node.add(this.lookAtNode)}get camera(){return this.renderer.camera}cameraShake(t,e=.5,s=.05){const i=_t["default"].timeline(),o={transformProgress:0},r=Math.random();i.to(o,{transformProgress:1,duration:e,ease:"power2.inOut",onUpdate:()=>{this.camShakeV[0]=Math.sin(o.transformProgress*Math.PI*4)*s,this.camShakeV[1]=Math.sin(o.transformProgress*Math.PI*4+r)*s*.5},onComplete:()=>{a.vec3.set(this.camShakeV,0,0,0)}},"0")}start(){this.introFov=this.renderer.camera.lens.fov,At.node.add(this.renderer.camera),this.pondCenter=a.vec3.fromValues(this.pond.water.center[0],this.pond.water.center[1],this.pond.water.center[2]),this.rotationTimeline=new O.Z(this.rotation,this.sheetSuccess,"Camera Rotation Factor"),this.heightTimeline=new O.Z(this.height,this.sheetSuccess,"Camera Y"),this.fovTimeline=new O.Z(this.fov,this.sheetSuccess,"Camera FOV"),this.localPositionTimeline=new yt(this.localPosition.value,this.sheetSuccess,"Camera Local Position"),this.localLookAtTimeline=new yt(this.localLookAt.value,this.sheetSuccess,"Camera Local LookAt"),this.localLookAtMobileTimeline=new yt(this.localLookAtMobile.value,this.sheetSuccess,"Camera Local LookAt Mobile"),this.camShakeTimeline=new O.Z(this.camShake,this.sheetSuccess,"Camera Shake"),this.fov.startV=this.fov.value,this.rotation.startV=this.rotation.value,this.height.startV=this.height.value,this.localPosition.startV=a.vec3.clone(this.localPosition.value),this.localLookAt.startV=a.vec3.clone(this.localLookAt.value),this.localLookAtMobile.startV=a.vec3.clone(this.localLookAtMobile.value),this.invalidate(),this.sheetIntroObj=this.sheetIntro.object("Camera",{ratio:0}),this.sheetOutroObj=this.sheetOutro.object("Camera",{ratio:1}),this.sheetPerfectObj=this.sheetPerfect.object("Camera",{distanceFromCenter:this.distanceFromCenter,focusFish:this.focusFish,focusHeight:this.focusHeight,rotationSpeed:this.rotationSpeed,rotationZ:this.rotationZ}),this.preRender()}stop(){var t,e,s;this.sheetIntroObj&&(null===(t=this.sheetIntro)||void 0===t||t.detachObject("Camera")),this.sheetOutroObj&&(null===(e=this.sheetOutro)||void 0===e||e.detachObject("Camera")),this.sheetPerfectObj&&(null===(s=this.sheetPerfect)||void 0===s||s.detachObject("Camera")),this.rotationTimeline.dispose(),this.heightTimeline.dispose(),this.fovTimeline.dispose(),this.localPositionTimeline.dispose(),this.localLookAtTimeline.dispose(),this.localLookAtMobileTimeline.dispose(),this.camShakeTimeline.dispose(),At.node.remove(this.renderer.camera)}invalidate(){this.renderer.camera.invalidate(),this.renderer.camera.updateWorldMatrix(),At.node.invalidate(),At.node.updateWorldMatrix(),this.lookAtNode.invalidate(),this.lookAtNode.updateWorldMatrix()}updateValuesFromSheet(){this.currentSheetObj&&(this.distanceFromCenter=this.currentSheetObj.value.distanceFromCenter,this.focusFish=this.currentSheetObj.value.focusFish,this.focusHeight=this.currentSheetObj.value.focusHeight,this.rotationSpeed=this.currentSheetObj.value.rotationSpeed,this.rotationZ=this.currentSheetObj.value.rotationZ)}updateCameraWrapper(){this.shakeTime+=k.Z.scaledDt*(.01+.05*this.camShake.value);const t=3;this.camera.x+=.03*Math.sin(this.shakeTime)*this.camShake.value*t,this.camera.y+=.01*Math.cos(this.shakeTime+.2)*this.camShake.value*t}preRender(t={x:0,y:0},e=1,s=!1,i=!1){this.updateValuesFromSheet();const o=this.sheetIntroObj.value,r=this.sheetOutroObj.value;this.totalTime+=.01*k.Z.stableDt*this.rotationSpeed*this.rotation.value*(Nt.isSlowMo?Nt.slowMoFactor:1),a.vec3.copy(At.node.position,this.saveCamParentPos);const h=At.node.position;h[0]=this.pondCenter[0]+this.distanceFromCenter*Math.cos(this.totalTime),h[2]=this.pondCenter[2]+this.distanceFromCenter*Math.sin(this.totalTime),h[1]=this.height.value,At.node.lookAt(a.vec3.fromValues(this.pondCenter[0],At.node.position[1],this.pondCenter[2])),a.vec3.copy(this.renderer.camera.position,this.localPosition.value),a.vec3.sub(Rt,this.pond.fish.worldPosition,At.node.position),a.vec3.copy(Zt,Rt),a.quat.invert(kt,At.node.rotation),a.vec3.transformQuat(Zt,Zt,kt),a.vec3.copy(this.lookAtNode.position,a.vec3.lerp(Ft,St["default"].isMobile?this.localLookAtMobile.value:this.localLookAt.value,Zt,this.sheetPerfectObj.value.focusFish*(0,n.CW)(.95,1,e)));const l=2*(t.x/window.innerWidth-.5),c=2*-(t.y/window.innerHeight-.5),d=(.025*Math.PI+1*Math.PI*.005)*(St["default"].isMobile?0:.5),u=(.025*Math.PI+1*Math.PI*.005)*(St["default"].isMobile?0:.5),p=.001;this.cameraTargetX=(0,Mt.Z)(this.cameraTargetX,l*d*(1-r.ratio),p*k.Z.scaledDt),this.cameraTargetY=(0,Mt.Z)(this.cameraTargetY,c*u*(1-r.ratio),p*k.Z.scaledDt),this.renderer.camera.lookAt(this.lookAtNode.position),a.quat.identity(this.quatcamy),a.quat.rotateX(this.quatcamy,this.quatcamy,this.cameraTargetY+(0,n.CW)(0,.5,r.ratio)*(0,n.CW)(1,.85,r.ratio)*Math.PI*.5),a.quat.identity(this.quatcamx),a.quat.rotateY(this.quatcamx,this.quatcamx,-this.cameraTargetX),a.quat.multiply(this.renderer.camera.rotation,this.renderer.camera.rotation,this.quatcamx),a.quat.multiply(this.renderer.camera.rotation,this.renderer.camera.rotation,this.quatcamy),this.fovVal=(0,n.CD)(this.fov.value*(St["default"].isMobile?.4:1),s?this.introFov:this.fov.value*(St["default"].isMobile?.4:1),o.ratio),this.camera.lens.setHorizontalFov(this.fovVal),a.vec3.add(this.renderer.camera.position,this.renderer.camera.position,this.camShakeV),(s||i)&&(0,bt.x)(i?r.ratio:o.ratio,this.camera,this.introLookAt,s?Pt.Io:Tt.Io,s?Pt.z8:Tt.z8,!0,!0)}}At.CAM_DISTANCE=10;const Et=a.vec3.create(),Lt=a.vec3.create();class Nt{constructor(t,e,s){this.renderer=t,this.renderables=[],this.position=a.vec3.create(),this.rotation=a.quat.create(),this.lookAt=a.vec3.create(),this.worldPosition=a.vec3.create(),this.energy={value:1,startV:0},this.isAnimating=!1,this.jumpFactor=0,this.jumpRandom=0,this.isSuperJump=0,this.enterWater=new wt.Z,this.exitWater=new wt.Z,this.nextPosition=a.vec3.create(),this.vel=a.vec3.create(),this.velAdd=a.vec3.create(),this.camWorldVecScaled=a.vec3.create(),this.camWorldVec=a.vec3.create(),this.camWorldVecLerp=a.vec3.create(),this.angleCircle=0,this.camVecRand=0,this.camVecRandLerp=0,this.fishY=0,this.animTime=Math.random(),this.fishRotation=a.quat.create(),this.fishRotationX=a.quat.create(),this.fishRotationZ=a.quat.create(),this.noiseTex=this.renderer.scene.texturePool.get("perlinNoise").texture;const o=new l.Z,r=new Ct;this.waterHeight=r.waterHeight.attachUniform(),this.waterColor=r.waterColor.attachUniform(),this.deepWaterColor=r.deepWaterColor.attachUniform(),this.deepWaterColorFactor=r.deepWaterColorFactor.attachUniform(),this.viewportSize=r.viewportSize.attachUniform(),this.time=r.time.attachUniform(),this.fishNoiseTex=r.noise.attachSampler("tNoise",F.ZP.create("aTexCoord0")),this.cameraPos=r.cameraPos.attachUniform(),o.overridePass("",((t,i)=>{const o=i.getPass("color").pass;return o.inputs.add(e),o.inputs.add(r),o.inputs.add(s),o})),this.res=new i.ZP("scene2/Fish.gltf",t.gl,{defaultTextureFilter:t.gl.LINEAR_MIPMAP_LINEAR,extensions:[o]}),this.sheetLoop=ct["default"].state.machine.context.theatreProject.project.sheet("scene2-fish-loop"),this.parentNode=new dt.Z,a.vec3.set(this.velAdd,.3+.4*Math.random(),0,.3+.4*Math.random()),a.vec3.scale(this.velAdd,this.velAdd,2*(.025+.005*Math.random())),this.directionChange=.1*(.003+.005*Math.random()),this.avoidLimit=.1+.2*Math.random()}async load(){return this.res.load()}onLoaded(){this.gltf=this.res.gltf,this.renderables=this.gltf.renderables,this.gltf.root.setScale(.02),this.parentNode.add(this.gltf.root),this.fishNode=this.gltf.getElementByName(r.Z.NODE,"skeleton_root")}start(t){this.sheetLoop.sequence.play({iterationCount:1/0}),this.waterHeight.set(t+.1),this.waterColor.set(.4898,.7324,.6046),this.deepWaterColor.set(.69,.86,.84),this.deepWaterColorFactor.set(.95),this.fishNoiseTex.set(this.noiseTex),this.viewportSize.set(this.renderer.viewport.height,this.renderer.viewport.width),this.cameraPos.set(...At.node.position),this.camVecRandLerp=this.camVecRand=.3,this.invalidate(),a.vec3.copy(this.camWorldVecLerp,this.camWorldVecScaled),this.sheetLoopObj=this.sheetLoop.object("Fish",{easing:0}),this.sheetPerfectObj=this.sheetPerfect.object("Fish",{height:0,rotationX:0,rotationZ:0,superRotateZ:0}),this.energyTimeline=new O.Z(this.energy,this.sheetSuccess,"Fish Energy"),this.energy.startV=this.energy.value}stop(){var t;this.sheetLoopObj&&this.sheetLoop.detachObject("Fish"),this.sheetPerfectObj&&(null===(t=this.sheetPerfect)||void 0===t||t.detachObject("Fish")),this.energyTimeline.dispose()}invalidate(){this.parentNode.invalidate(),this.parentNode.updateWorldMatrix(),this.gltf.root.invalidate(),this.gltf.root.updateWorldMatrix()}async jump(t){this.jumpFactor=Math.min(t,.8),this.jumpRandom=.75+.25*Math.random(),this.isSuperJump=0,t>.99?(this.isSuperJump=1,await this.sheetPerfect.sequence.play({range:[0,.406]}),Nt.isSlowMo=!0,await this.sheetPerfect.sequence.play({range:[.406,.6],rate:.8}),await this.sheetPerfect.sequence.play({range:[.6,.7],rate:.5}),await this.sheetPerfect.sequence.play({range:[.7,1.05],rate:.2}),await this.sheetPerfect.sequence.play({range:[1.05,1.1],rate:.5}),await this.sheetPerfect.sequence.play({range:[1.1,1.2],rate:.8}),Nt.isSlowMo=!1,await this.sheetPerfect.sequence.play({range:[1.2,2.55]})):await this.sheetPerfect.sequence.play()}setCamScaleVec(t){a.vec3.set(this.camWorldVec,At.node._wmatrix[12],0,At.node._wmatrix[14]),this.camVecRandLerp=this.camVecRand,this.camVecRandLerp+=.02*Math.sin(this.angleCircle)*(0,n.CW)(.7,1,t);const e=Math.atan2(this.camWorldVec[2],this.camWorldVec[0]),s=Math.cos(e)*At.CAM_DISTANCE*2,i=Math.sin(e)*At.CAM_DISTANCE*2;this.fishY=.5*Math.sin(-this.angleCircle)*(0,n.CW)(.2,1,t),a.vec3.set(this.camWorldVecScaled,s,this.fishY,i),a.vec3.scale(this.camWorldVecScaled,this.camWorldVecScaled,this.camVecRandLerp)}preRender(t=!1,e=!1){const s=this.gltf.animations[0];this.animTime+=k.Z.stableDt/50*(Nt.isSlowMo?.5:1+2*this.energy.value),s.evaluate(this.animTime%s.duration);const i=this.energy.value;this.setCamScaleVec(i),this.angleCircle+=.05*(Nt.isSlowMo?Nt.slowMoFactor:1),this.time.set(1e-4*k.Z.scaledTime);const o=this.sheetPerfectObj.value.height*this.jumpFactor*this.jumpRandom-.5;o>this.waterHeight.value[0]&&this.gltf.root.position[1]<=this.waterHeight.value[0]&&this.exitWater.emit({}),o<this.waterHeight.value[0]&&this.gltf.root.position[1]>=this.waterHeight.value[0]&&this.enterWater.emit({});const r=1.5+Math.sin(1e-4*k.Z.scaledTime),h=Math.atan2(this.renderer.camera._wmatrix[14],this.renderer.camera._wmatrix[12]);a.vec3.set(Lt,8*Math.cos(h)+Math.cos(.4*this.animTime)*r,this.camWorldVec[1],8*Math.sin(h)+Math.sin(.4*this.animTime)*r),a.vec3.lerp(this.nextPosition,this.nextPosition,Lt,.1);const l=(0,n.CW)(0,1,i);a.vec3.lerp(this.camWorldVecLerp,this.camWorldVecLerp,this.camWorldVecScaled,1),a.vec3.lerp(this.nextPosition,this.nextPosition,this.camWorldVecLerp,t?0:l),a.vec3.sub(Lt,this.nextPosition,this.parentNode.position),a.vec3.normalize(Lt,Lt),a.vec3.add(Et,this.parentNode.position,Lt),this.parentNode.lookAt(Et),a.quat.rotateY(this.parentNode.rotation,this.parentNode.rotation,-Math.PI/2),a.vec3.copy(this.parentNode.position,this.nextPosition),this.gltf.root.position[1]=o,a.vec3.set(this.worldPosition,this.gltf.root._wmatrix[12],this.gltf.root._wmatrix[13],this.gltf.root._wmatrix[14]),a.vec3.copy(this.position,this.parentNode.position),this.fishYRotate=.2*Math.sin(this.sheetLoopObj.value.easing*Math.PI*2*20),a.quat.identity(this.fishRotation),a.quat.identity(this.fishRotationX),a.quat.identity(this.fishRotationZ),a.quat.rotateY(this.fishRotation,this.fishRotation,this.fishYRotate-Math.PI/2),a.quat.rotateZ(this.fishRotationZ,this.fishRotationZ,this.sheetPerfectObj.value.rotationZ*this.jumpFactor*3*this.jumpRandom*Math.PI*2+this.sheetPerfectObj.value.superRotateZ*Math.PI*2*this.isSuperJump),a.quat.rotateX(this.fishRotationX,this.fishRotationX,this.sheetPerfectObj.value.rotationX*Math.PI*2),this.fishNode.rotation.set(this.fishRotation),a.quat.mul(this.fishNode.rotation,this.fishNode.rotation,this.fishRotationX),a.quat.mul(this.fishNode.rotation,this.fishNode.rotation,this.fishRotationZ),this.fishNode.invalidate(),this.invalidate(),this.deepWaterColorFactor.set(.95+10.55*(1-i))}render(t){this.cameraPos.set(...At.node.position);for(const e of this.gltf.renderables)e.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}}Nt.isSlowMo=!1,Nt.slowMoFactor=.2;var Vt=s(76881),Ot=s(88220),Ht=s.n(Ot),Ut=s(33814),Dt=s.n(Ut);const It=(0,d.Z)(Ht()),Wt=(0,d.Z)(Dt());class Bt extends u.Z{constructor(t){super(!0,!0),this.addChild(this.waterColor=new p.ZP("uWaterColor",3,p.Ho.FRAGMENT)),this.addChild(this.time=new p.ZP("uSurfaceTime",1,p.Ho.ALL)),It.onHmr((()=>this.invalidateCode())),Wt.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("pv",It({slot:"pv"})),t.add("vertex_warp_world",It({slot:"vertex_warp_world"})),t.add("postv",It({slot:"postv"})),t.add("pf",Wt({slot:"pf"})),t.add("f",Wt({slot:"f"})),t.add("postf",Wt({slot:"postf"}))}setup(t){super.setup(t),t.UuPondCenter||(t.UuPondCenter=()=>{})}}class qt{constructor(t,e,s,i,o,r){this.position=t,this.rotationY=e,this.scale=s,this.blendThreshold=i,this.blendOpacity=o,this.rotationSpeed=r,this.node=new dt.Z,a.vec3.set(this.node.scale,s,s,s),this.node.rotateY(e),a.vec3.copy(this.node.position,t),this.node.invalidate(),this.node.updateWorldMatrix()}}class zt{constructor(t,e,s){this.renderer=t,this.bounds=new Vt.Z,this.renderables=[],this.center=[],this.blendThresholdBase=1,this.blendOpacityBase=.9,this.waterPlanes=[],this.rotation={value:1,startV:0},this.totalTime=0,this.noiseTex=this.renderer.scene.texturePool.get("perlinNoise").texture;const o=new l.Z,a=new v;this.blendThreshold=a.threshold.attachUniform(),this.blendOpacity=a.opacity.attachUniform(),o.overridePass("",((s,i)=>{const o=new Bt(i);this.waterColor=o.waterColor.attachUniform(),this.time=o.time.attachUniform();const r=i.getPass("color").pass;return r.inputs.add(e),r.inputs.add(a),r.inputs.add(o),r.alphaMode.set("BLEND"),r.mask=c.Z.BLENDED,r.glconfig.depthMask(!0).enableBlend().blendFunc(t.gl.SRC_ALPHA,t.gl.ONE_MINUS_SRC_ALPHA),r})),this.res=new i.ZP("scene2/Water_02.glb",t.gl,{defaultTextureFilter:t.gl.LINEAR_MIPMAP_LINEAR,extensions:[o]})}async load(){return this.res.load()}onLoaded(){this.gltf=this.res.gltf,this.renderables=this.gltf.renderables,this.gltf.root.updateWorldMatrix();const t=new Vt.Z;Vt.Z.transform(this.bounds,this.gltf.renderables[0].bounds,this.gltf.renderables[0].node._wmatrix);for(const e of this.renderables)Vt.Z.transform(t,e.bounds,e.node._wmatrix),Vt.Z.union(this.bounds,this.bounds,t);this.center=[(this.bounds.min[0]+this.bounds.max[0])/2,(this.bounds.min[1]+this.bounds.max[1])/2,(this.bounds.min[2]+this.bounds.max[2])/2],this.waterPlanes.push(new qt(a.vec3.fromValues(0,-.1,0),2*Math.PI*Math.random(),1.3,.25,.3,1)),this.waterPlanes.push(new qt(a.vec3.fromValues(0,-.12,0),2*Math.PI*Math.random(),.8,.2,.5,1.5))}start(){this.gltf.root.invalidate(),this.gltf.root.updateWorldMatrix(),this.waterColor.set(.48,.74,.61),this.rotationTimeline=new O.Z(this.rotation,this.sheetSuccess,"Water Rotation Factor"),this.rotation.startV=this.rotation.value}stop(){this.rotationTimeline.dispose()}preRender(){V.Z.transition.value}render(t){this.totalTime+=k.Z.dt*this.rotation.value,this.waterPlanes.sort(((t,e)=>t.position[1]-e.position[1])).forEach((e=>{this.gltf.root.scale.set(e.node.scale),this.gltf.root.rotation.set(e.node.rotation),this.gltf.root.position.set(e.node.position),this.gltf.root.invalidate(),this.gltf.root.updateWorldMatrix(),this.blendThreshold.set(e.blendThreshold*this.blendThresholdBase),this.blendOpacity.set(e.blendOpacity*this.blendOpacityBase),this.time.set(1e-5*this.totalTime*e.rotationSpeed);for(const s of this.renderables)s.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}))}}var jt=s(11668),Gt=s(85493),Xt=s.n(Gt);const Yt=(0,d.Z)(Xt());class $t extends u.Z{constructor(t){super(!0,!1),this.addChild(this.opacity=new p.ZP("uOpacity",1,p.Ho.FRAGMENT)),this.addChild(this.color=new p.ZP("uColor",3,p.Ho.FRAGMENT)),this.addChild(this.time=new p.ZP("uTime",1,p.Ho.FRAGMENT)),this.transformedCode=t.getPass("color").pass.surface.baseColor.param.texCoords.getTransformCode(),this.transformedCode=this.transformedCode.split(" ")[0],this.transformedCode=`\n    VAL_tex_basecolor${this.transformedCode} = texture2D(tex_basecolor, (${this.transformedCode} + vec2(uTime(), 0.)) * vec2(2., 1.));\n    VAL_tex_basecolor${this.transformedCode}.rgb = VAL_tex_basecolor${this.transformedCode}.rgb*VAL_tex_basecolor${this.transformedCode}.rgb;\n    VAL_tex_emissive${this.transformedCode} = texture2D(tex_emissive, (${this.transformedCode} + vec2(uTime(), 0.)) * vec2(2., 1.));\n    `,this.opacity.attachConstant(1),this.color.attachConstant([1,1,1]),this.time.attachConstant(0),Yt.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("f",this.transformedCode),t.add("postf",Yt({slot:"postf"}))}}class Jt{constructor(t,e){this.renderer=t,this.renderables=[],this.rotation={value:1,startV:0},this.opacityFactor={value:1,startV:0};const s=new l.Z,o=new tt;s.overridePass("",((e,s)=>{const i=new $t(s);this.opacity=i.opacity.attachUniform(),this.color=i.color.attachUniform(),this.time=i.time.attachUniform();const a=s.getPass("color").pass;return a.inputs.add(i),a.alphaMode.set("BLEND"),a.mask=c.Z.BLENDED,a.glconfig.depthMask(!1).enableBlend().blendFunc(t.gl.SRC_ALPHA,t.gl.ONE_MINUS_SRC_ALPHA),o.color.attach(a.alpha.param),a})),this.res=new i.ZP("scene2/clouds.glb",t.gl,{defaultTextureFilter:t.gl.LINEAR_MIPMAP_LINEAR,extensions:[s]})}async load(){return this.res.load()}onLoaded(){this.gltf=this.res.gltf,this.renderables=this.gltf.renderables,this.totalTimes=this.renderables.map((()=>0)),this.root=new dt.Z,this.root.add(this.gltf.root),this.root.y=4}start(){this.gltf.root.invalidate(),this.gltf.root.updateWorldMatrix(),this.opacity.set(1),this.color.set(.875,1,.9899),this.rotationTimeline=new O.Z(this.rotation,this.sheetSuccess,"Clouds Rotation Factor"),this.opacityFactorTimeline=new O.Z(this.opacityFactor,this.sheetSuccess,"Clouds Opacity Factor"),this.rotation.startV=this.rotation.value,this.opacityFactor.startV=this.opacityFactor.value}stop(){this.rotationTimeline.dispose(),this.opacityFactorTimeline.dispose()}render(t){for(const[e,s]of this.renderables.entries())this.totalTimes[e]+=k.Z.dt*this.rotation.value*s.node.extras.speedBase*10*(Nt.isSlowMo?.1*Nt.slowMoFactor:1),this.time.set(1e-5*this.totalTimes[e]),this.opacity.set(s.node.extras.opacityBase*this.opacityFactor.value),s.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}}var Kt=s(18158),Qt=s(94292),te=s(31236);class ee{constructor(t,e,s,i,o){this.renderer=t,this.count=e,this.radius=s,this.color=i,this.strength=o,this.time=0,this.offset=a.vec3.create(),this.prg=(0,te["default"])(t.gl).get("pond-energy"),this.noiseTex=this.renderer.scene.texturePool.get("perlinNoise").texture,this.vbuffer=new Kt.Z(t.gl),this.vbuffer.attrib("aPosition",3,t.gl.FLOAT).attrib("aSettings",4,t.gl.FLOAT),this.vbuffer.attribPointer(this.prg),this.cfg=Qt.Z.get(t.gl).config(),this.cfg.enableDepthTest(!0).depthMask(!1).enableBlend(!0).blendEquation(t.gl.FUNC_ADD).blendFunc(t.gl.SRC_ALPHA,t.gl.ONE)}start(t){this.sheetSuccess&&(this.scaleFactorTimeline=new O.Z(ee.scaleFactor,this.sheetSuccess,"Energy Scale Factor"));const e=new Float32Array(7*this.count);for(let s=0;s<this.count;s++)e[7*s+0]=t[0]+Math.random()*this.radius*2-this.radius,e[7*s+1]=t[1]+4*Math.random(),e[7*s+2]=t[2]+Math.random()*this.radius*2-this.radius,e[7*s+3]=.2*Math.random()*this.strength+.2,e[7*s+4]=.15*Math.random()*this.strength+.2,e[7*s+5]=Math.random()*this.strength+.5,e[7*s+6]=2*Math.random()+.2;ee.scaleFactor.startV=ee.scaleFactor.value,this.vbuffer.data(e)}dispose(){this.scaleFactorTimeline.dispose()}preRender(){this.time+=2e-4*k.Z.scaledDt*ee.scaleFactor.value}render(t){this.prg.use(),this.prg.uProjection(t.camera.lens.getProjection()),this.prg.uView(t.camera._view),this.prg.uColor(this.color),this.prg.uTime(this.time),this.prg.uNoise(this.noiseTex),this.prg.uScaleFactor(.5*ee.scaleFactor.value),this.prg.uOffset(this.offset),this.cfg.apply(),this.vbuffer.attribPointer(this.prg),this.vbuffer.drawPoints()}}ee.scaleFactor={value:1,startV:0};var se=s(20598),ie=s.n(se);const oe=(0,d.Z)(ie());class ae extends u.Z{constructor(t){super(!0,!0),this.addChild(this.noiseInput=new p.ZP("noise",3,p.Ho.FRAGMENT)),this.addChild(this.timeInput=new p.ZP("uRippleTime",1,p.Ho.FRAGMENT)),this.addChild(this.opacityInput=new p.ZP("uOpacity",1,p.Ho.FRAGMENT)),this.timeU=this.timeInput.attachUniform(),this.opacityU=this.opacityInput.attachUniform(),this.noiseInput.attachSampler("noiseTex").set(t.scene.texturePool.get("perlinNoise").texture)}_genCode(t){t.add("pf",oe({slot:"pf"})),t.add("postf",oe({slot:"postf"}))}setup(t){t.UuRippleTime||(t.UuRippleTime=()=>{})}}class re{constructor(t){this.renderer=t,this.time=0,this.positionStart=a.vec3.create(),this.positionEnd=a.vec3.create(),this.opacityStart=0,this.opacityEnd=0,this.timeStart=0,this.timeEnd=0;const e=new l.Z;this.rippleChunk=new ae(t),e.overridePass("",((t,e)=>{const s=e.getPass("color").pass;return s.inputs.add(this.rippleChunk),s})),this.res=new i.ZP("scene2/ripple.gltf",t.gl,{defaultTextureFilter:t.gl.LINEAR_MIPMAP_LINEAR,extensions:[e]})}async load(){return Promise.all([this.res.load()])}onLoaded(){this.gltf=this.res.gltf}start(){}stop(){}spawnStart(t){a.vec3.copy(this.positionStart,t),this.opacityStart=1,this.timeStart=0}spawnEnd(t){a.vec3.copy(this.positionEnd,t),this.opacityEnd=1,this.timeEnd=0}preRender(){this.timeStart+=.001*k.Z.scaledDt,this.timeEnd+=.001*k.Z.scaledDt,this.opacityStart+=.01*(0-this.opacityStart),this.opacityEnd+=.01*(0-this.opacityEnd)}render(t){if(this.opacityStart>.01){a.vec3.copy(this.gltf.root.position,this.positionStart),this.gltf.root.position[1]=.07,this.gltf.root.invalidate(),this.gltf.root.updateWorldMatrix(),this.rippleChunk.opacityU.set(this.opacityStart),this.rippleChunk.timeU.set(this.timeStart);for(const e of this.gltf.renderables)e.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}if(this.opacityEnd>.01){a.vec3.copy(this.gltf.root.position,this.positionEnd),this.gltf.root.position[1]=.07,this.gltf.root.invalidate(),this.gltf.root.updateWorldMatrix(),this.rippleChunk.opacityU.set(this.opacityEnd),this.rippleChunk.timeU.set(this.timeEnd);for(const e of this.gltf.renderables)e.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}}}var ne=s(23128),he=s.n(ne);class le{constructor(t){this.renderer=t,this.time=0,this.baseTime=1e-4,this.timeMult=.001,this.rotation=0,this.opacity=.3,this.node=new dt.Z}onLoaded(t){this.gltf=t}start(){this.node.setScale(8),this.node.y=-.1,this.node.invalidate(),this.node.updateWorldMatrix()}stop(){}preRender(t){const e=t;this.time+=k.Z.scaledDt*(15e-5+35e-5*e),a.quat.identity(this.node.rotation),a.quat.rotateY(this.node.rotation,this.node.rotation,this.rotation),this.node.invalidate(),this.node.updateWorldMatrix(),this.rotation+=k.Z.scaledDt*(this.baseTime+e*this.timeMult)}render(t,e,s){const i=s;e.opacityU.set(i*this.opacity),he().copy(this.gltf.root.position,this.node.position),he().copy(this.gltf.root.scale,this.node.scale),a.quat.copy(this.gltf.root.rotation,this.node.rotation),this.gltf.root.invalidate(),this.gltf.root.updateWorldMatrix();for(const o of this.gltf.renderables)o.node.updateWorldMatrix(),o.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}}var ce=s(11896),de=s.n(ce);const ue=(0,d.Z)(de());class pe extends u.Z{constructor(t){super(!0,!1),this.addChild(this.timeInput=new p.ZP("uTime",1,p.Ho.FRAGMENT)),this.addChild(this.speedInput=new p.ZP("uSpeed",1,p.Ho.FRAGMENT)),this.addChild(this.opacityInput=new p.ZP("uOpacity",1,p.Ho.FRAGMENT)),this.speedU=this.speedInput.attachUniform(),this.opacityU=this.opacityInput.attachUniform(),this.speedU.set(1),this.transformedCode=t.surface.baseColor.param.texCoords.getTransformCode(),this.transformedCode=this.transformedCode.split(" ")[0],this.transformedCode=`\n    VAL_tex_basecolor${this.transformedCode} = texture2D(tex_basecolor, ${this.transformedCode} * vec2(uSpeed(), 1.));\n    `}_genCode(t){t.add("f",this.transformedCode),t.add("postf",ue({slot:"postf"}))}}class me{constructor(t){this.renderer=t,this.rotation={value:1,startV:0},this.opacity={value:1,startV:0};const e=new l.Z;e.overridePass("",((t,e)=>{const s=e.getPass("color").pass;return this.ringChunk=new pe(s),s.inputs.add(this.ringChunk),s.glconfig.depthMask(!0),s})),this.res=new i.ZP("scene2/ring.glb",t.gl,{defaultTextureFilter:t.gl.LINEAR_MIPMAP_LINEAR,extensions:[e]}),this.ring=new le(this.renderer),this.ring1=new le(this.renderer),this.ring2=new le(this.renderer),this.ring3=new le(this.renderer),this.ring4=new le(this.renderer),this.ring5=new le(this.renderer)}async load(){await Promise.all([this.res.load()])}onLoaded(){this.gltf=this.res.gltf,this.ring.onLoaded(this.gltf),this.ring1.onLoaded(this.gltf),this.ring2.onLoaded(this.gltf),this.ring3.onLoaded(this.gltf),this.ring4.onLoaded(this.gltf),this.ring5.onLoaded(this.gltf)}start(){this.ring.start(),this.ring1.start(),this.ring2.start(),this.ring3.start(),this.ring4.start(),this.ring5.start(),this.ring.node.setScale(6.5),this.ring1.node.setScale(7),this.ring2.node.setScale(8.5),this.ring3.node.setScale(4),this.ring4.node.setScale(5.5),this.ring5.node.setScale(3),this.ring2.node.y=.1,this.ring.node.y=.11,this.ring1.node.y=.12,this.ring3.node.y=.06,this.ring4.node.y=.05,this.ring5.node.y=.04,this.ring.rotation=.2,this.ring1.rotation=1,this.ring2.rotation=.8,this.ring3.rotation=.8,this.ring4.rotation=.3,this.ring5.rotation=.5,this.ring.opacity=.5,this.ring1.opacity=.5,this.ring2.opacity=.5,this.ring3.opacity=.3,this.ring4.opacity=.3,this.ring5.opacity=.3,this.ring2.timeMult+=(2*Math.random()-1)*(.25*this.ring2.timeMult),this.ring2.baseTime+=(2*Math.random()-1)*(.25*this.ring2.baseTime),this.ring1.timeMult+=(2*Math.random()-1)*(.25*this.ring1.timeMult),this.ring1.baseTime+=(2*Math.random()-1)*(.25*this.ring1.baseTime),this.ring3.timeMult+=(2*Math.random()-1)*(.25*this.ring3.timeMult),this.ring3.baseTime+=(2*Math.random()-1)*(.25*this.ring3.baseTime),this.ring4.timeMult+=(2*Math.random()-1)*(.25*this.ring4.timeMult),this.ring4.baseTime+=(2*Math.random()-1)*(.25*this.ring4.baseTime),this.ring5.timeMult+=(2*Math.random()-1)*(.25*this.ring4.timeMult),this.ring5.baseTime+=(2*Math.random()-1)*(.25*this.ring4.baseTime),this.ring.node.invalidate(),this.ring1.node.invalidate(),this.ring2.node.invalidate(),this.ring3.node.invalidate(),this.ring4.node.invalidate(),this.ring5.node.invalidate(),this.ring.node.updateWorldMatrix(),this.ring1.node.updateWorldMatrix(),this.ring2.node.updateWorldMatrix(),this.ring3.node.updateWorldMatrix(),this.ring4.node.updateWorldMatrix(),this.ring5.node.updateWorldMatrix(),this.rotationTimeline=new O.Z(this.rotation,this.sheetSuccess,"Rings / Rotation"),this.opacityTimeline=new O.Z(this.opacity,this.sheetSuccess,"Rings / Opacity"),this.rotation.startV=this.rotation.value,this.opacity.startV=this.opacity.value}stop(){this.ring.stop(),this.ring1.stop(),this.ring2.stop(),this.ring3.stop(),this.ring4.stop(),this.ring5.stop(),this.rotationTimeline.dispose(),this.opacityTimeline.dispose()}preRender(){this.ring.preRender(this.rotation.value),this.ring1.preRender(this.rotation.value),this.ring2.preRender(this.rotation.value),this.ring3.preRender(this.rotation.value),this.ring4.preRender(this.rotation.value),this.ring5.preRender(this.rotation.value)}render(t){this.ring.render(t,this.ringChunk,this.opacity.value),this.ring1.render(t,this.ringChunk,this.opacity.value),this.ring2.render(t,this.ringChunk,this.opacity.value),this.ring3.render(t,this.ringChunk,this.opacity.value),this.ring4.render(t,this.ringChunk,this.opacity.value),this.ring5.render(t,this.ringChunk,this.opacity.value)}}var fe=s(10389),ge=s.n(fe);const ve=(0,d.Z)(ge());class Ce extends u.Z{constructor(){super(!0,!1),this.addChild(this.time=new p.ZP("uTime",1,p.Ho.VERTEX)),this.time.attachConstant(0),ve.onHmr((()=>this.invalidateCode()))}_genCode(t){t.add("vertex_warp_world",ve({slot:"vertex_warp_world"}))}}class we{constructor(t,e){this.renderer=t,this.renderables=[],this.time=Math.random();const s=new l.Z,o=new Ce;this.windTime=o.time.attachUniform(),this.windTime.set(this.time),s.overridePass("",((s,i)=>{const a=i.getPass("color").pass;return a.inputs.add(e),a.inputs.add(o),a.alphaMode.set("BLEND"),a.mask=c.Z.BLENDED,a.glconfig.enableBlend().blendFunc(t.gl.SRC_ALPHA,t.gl.ONE_MINUS_SRC_ALPHA),a})),this.reedRes=new i.ZP("scene2/reeds.glb",t.gl,{defaultTextureFilter:t.gl.LINEAR_MIPMAP_LINEAR,extensions:[s]})}async load(){return this.reedRes.load()}onLoaded(){this.reed=this.reedRes.gltf,this.renderables=[...this.reed.renderables]}preRender(){this.time+=.001*k.Z.scaledDt,this.windTime.set(this.time)}render(t){for(const e of this.reed.renderables)e.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}}var _e=s(25317);const xe=3;class ye{constructor(t,e){this.renderer=t,this.time=0,this.positionStart=a.vec3.create(),this.positionEnd=a.vec3.create(),this.timeStart=0,this.timeEnd=0,this.renderStart=!1,this.renderEnd=!1;const s=new l.Z;s.overridePass("",((t,s)=>{const i=s.getPass("color").pass;return i.inputs.add(e),i.surface.metalnessFactor.attachConstant(0),i.surface.roughnessFactor.attachConstant(1),this.alphaUniform=i.alphaFactor.attachUniform(),i})),this.res=new i.ZP("scene2/splash.glb",t.gl,{defaultTextureFilter:t.gl.LINEAR_MIPMAP_LINEAR,extensions:[s]}),this.nodeStart=[],this.opacityStart=[],this.timeLinesStart=[];for(let i=0;i<xe;i++)this.nodeStart[i]=new dt.Z,this.opacityStart[i]=0,this.timeLinesStart.push(this.makeTimeline(this.nodeStart[i],i,!0));this.nodeEnd=[],this.opacityEnd=[],this.timeLinesEnd=[];for(let i=0;i<xe;i++)this.nodeEnd[i]=new dt.Z,this.opacityEnd[i]=0,this.timeLinesEnd.push(this.makeTimeline(this.nodeEnd[i],i,!1))}async load(){return Promise.all([this.res.load()])}onLoaded(){this.gltf=this.res.gltf}start(){}stop(){}async spawnStart(t){this.renderStart=!0,await this.spawn(this.nodeStart,t,!0),this.renderStart=!1}async spawnEnd(t){this.renderEnd=!0,await this.spawn(this.nodeEnd,t,!1),this.renderEnd=!1}spawn(t,e,s=!1){const i=[];for(const[o,r]of t.entries())a.vec3.copy(r.position,e),r.invalidate(),r.updateWorldMatrix(),s?i.push(this.timeLinesStart[o].play(0)):i.push(this.timeLinesEnd[o].play(0));return Promise.all(i)}makeTimeline(t,e,s=!1){const i=_t.gsap.timeline(),o={s:.3,xz:1,opacity:1,r:0};return i.fromTo(o,{s:.1,xz:.25+.1*e,opacity:1,r:.2*e},{s:.4+.2*e,xz:2-.15*e,opacity:0,r:.3*Math.PI+.2*e,duration:4,ease:_e.Au.easeOut,delay:.025*e,onUpdate:()=>{t.scale[1]=o.s,t.scale[0]=o.xz,t.scale[2]=o.xz,a.quat.identity(t.rotation),a.quat.rotateY(t.rotation,t.rotation,o.r),s?this.opacityStart[e]=o.opacity:this.opacityEnd[e]=o.opacity,t.invalidate(),t.updateWorldMatrix()}}),i}preRender(){}render(t){if(this.renderStart)for(const[e,s]of this.nodeStart.entries()){a.vec3.copy(this.gltf.root.position,s.position),a.vec3.copy(this.gltf.root.scale,s.scale),a.quat.copy(this.gltf.root.rotation,s.rotation),this.gltf.root.invalidate(),this.gltf.root.updateWorldMatrix(),this.alphaUniform.set(this.opacityStart[e]);for(const e of this.gltf.renderables)e.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}if(this.renderEnd)for(const[e,s]of this.nodeEnd.entries()){a.vec3.copy(this.gltf.root.position,s.position),a.vec3.copy(this.gltf.root.scale,s.scale),a.quat.copy(this.gltf.root.rotation,s.rotation),this.gltf.root.invalidate(),this.gltf.root.updateWorldMatrix(),this.alphaUniform.set(this.opacityEnd[e]);for(const e of this.gltf.renderables)e.render(t.gl,t.camera,t.mask,t.pass,t.glConfig)}}}class be{constructor(t,e){this.renderer=t,this.ambientAdd=1,this.floorReflectivity=.03;const s=new C.Z;s.ambientAddUniform.set(this.ambientAdd),this.lilies=new H(this.renderer,s,e),this.rocks=new lt(this.renderer,s,e),this.reeds=new we(this.renderer,s),this.fish=new Nt(this.renderer,s,e),this.water=new zt(this.renderer,s,e),this.energyParticles=new ee(this.renderer,150,8,a.vec3.fromValues(.2,.8,.65),4),this.clouds=new Jt(this.renderer,e),this.ripples=new re(this.renderer),this.splash=new ye(this.renderer,s),this.rings=new me(this.renderer)}async load(){return Promise.all([this.water.load(),this.lilies.load(),this.rocks.load(),this.reeds.load(),this.rings.load(),this.fish.load(),this.clouds.load(),this.ripples.load(),this.splash.load()])}onLoaded(){this.lilies.onLoaded(),this.water.onLoaded(),this.rocks.onLoaded(),this.reeds.onLoaded(),this.clouds.onLoaded(),this.ripples.onLoaded(),this.splash.onLoaded(),this.rings.onLoaded(),this.fish.onLoaded(),this.fish.enterWater.on((()=>{this.splash.spawnStart(this.fish.position),this.ripples.spawnStart(this.fish.position)})),this.fish.exitWater.on((()=>{this.splash.spawnEnd(this.fish.position),this.ripples.spawnEnd(this.fish.position)}))}start(){this.water.start(),this.lilies.start(),this.rocks.start(this.water.center[1]),this.fish.start(this.water.center[1]),this.clouds.start(),this.energyParticles.start(a.vec3.fromValues(this.water.center[0],this.water.center[1],this.water.center[2])),this.ripples.start(),this.splash.start(),this.rings.start()}stop(){this.fish.stop(),this.ripples.stop(),this.splash.stop(),this.rings.stop(),this.water.stop(),this.lilies.stop(),this.clouds.stop(),this.energyParticles.dispose()}setupSceneLighting(t){this.setupLighting(t,[...this.lilies.renderables,...this.rocks.renderables,...this.reeds.renderables,...this.fish.renderables,...this.water.renderables])}setupWaterLighting(t){this.setupLighting(t,[])}setupLighting(t,e){t.lightSetup.prepare(this.renderer.gl);const s=[];for(const i of e)for(const t of i.materials)-1===s.indexOf(t)&&s.push(t);for(const i of s)t.setupMaterial(i)}createWaterReflection(t){if(!t)return;const e=t.materialPass,s=new jt.Z;s.reflectionTexture=this.renderer.reflect.getOutput(),e.inputs.add(s),s.strength.attach(this.floorReflectivityUniform)}preRender(t=!1,e=!1){this.fish.preRender(t,e),this.energyParticles.preRender(),this.rocks.preRender(),this.lilies.preRender(),this.water.preRender(),this.ripples.preRender(),this.splash.preRender(),this.rings.preRender(),this.reeds.preRender()}render(t){t.pass!==o.Z.DEPTH&&t.pass!==o.Z.REFLECT_DEPTH&&this.water.render(t),this.lilies.render(t),this.rocks.render(t),this.reeds.render(t),t.pass!==o.Z.DEPTH&&this.clouds.render(t),t.pass!==o.Z.REFLECT_DEPTH&&this.fish.render(t),t.pass!==o.Z.DEPTH&&t.pass!==o.Z.REFLECT_DEPTH&&(this.splash.render(t),this.ripples.render(t)),t.pass!==o.Z.DEPTH&&t.pass!==o.Z.REFLECT_DEPTH&&this.rings.render(t),t.pass!==o.Z.DEPTH&&t.pass!==o.Z.REFLECT_DEPTH&&this.energyParticles.render(t)}}var Pe=s(2246),Te=s(89906);const Me=a.vec3.create();class Se{constructor(t){this.renderer=t,this.pointLightColor={r:.9449,g:.9202,b:.5788},this.moveSmoothing=.0025,this.initialPositionSpot=a.vec3.create(),this.power={value:1,startV:0},this.node=new dt.Z,this.spot=new Te.Z,this.spot.radius=61.96,this.spot.outerAngle=.85,this.spot.innerAngle=0,this.spot._color.set([.9449,.9202,.5788]),this.spot.y=5,this.spot.z=-2.17,a.quat.set(this.spot.rotation,-.85,.26,.31,.32),this.initialPositionSpot=a.vec3.clone(this.spot.position);const e={power:10,power2:25};this.spot._color.set([this.pointLightColor.g*e.power,this.pointLightColor.g*e.power,this.pointLightColor.b*e.power])}setColor(t,e,s){t.set([e.r*s,e.g*s,e.b*s])}start(t){this.sceneLighting=t,t.lightSetup.add(this.spot),this.node.add(this.spot),this.powerTimeline=new O.Z(this.power,this.sheetSuccess,"Pointlight Power"),this.power.startV=this.power.value}stop(){this.sceneLighting.lightSetup.remove(this.spot),this.node.remove(this.spot),this.powerTimeline.dispose()}preRender(t){this.renderer.camera.updateWorldMatrix(),this.spot.x=this.renderer.camera._wmatrix[12],this.spot.y=this.renderer.camera._wmatrix[13],this.spot.z=this.renderer.camera._wmatrix[14],this.spot.invalidate(),this.spot.updateWorldMatrix(),a.vec3.set(Me,0,0,0),this.spot.lookAt(t),this.spot.invalidate(),this.spot.updateWorldMatrix(),this.setColor(this.spot._color,this.pointLightColor,this.power.value)}}var Re=s(50509),Ze=s(25409),Fe=s(55929);const ke=[["ui_reaction_kaizen_yeah_c"],["ui_reaction_kaizen_wow_a","ui_reaction_kaizen_wow_c"],["ui_reaction_kaizen_laugh-d","ui_reaction_kaizen_laugh_a","ui_reaction_kaizen_laugh_b","ui_reaction_kaizen_laugh_c"],["ui_reaction_kaizen_love-it_c"],["ui_reaction_kaizen_brilliant_a","ui_reaction_kaizen_brilliant_b","ui_reaction_kaizen_brilliant_c"],["ui_reaction_kaizen_can-t_believe-it_a","ui_reaction_kaizen_can-t_believe-it_b","ui_reaction_kaizen_can-t_believe-it_c"],["ui_reaction_kaizen_cool_a","ui_reaction_kaizen_cool_b","ui_reaction_kaizen_cool_c"],["ui_reaction_kaizen_excited_a","ui_reaction_kaizen_excited_b","ui_reaction_kaizen_excited_c"],["ui_reaction_kaizen_great_a"],["ui_reaction_kaizen_wanna-go-even-higher_c"]],Ae=["ui_reaction_kaizen_splash_a","ui_reaction_kaizen_splash_b","ui_reaction_kaizen_splash_c"],Ee=["kaizen_ch2_smalldive1","kaizen_ch2_smalldive2","kaizen_ch2_smalldive3"],Le=["kaizen_ch2_smalljump1","kaizen_ch2_smalljump2","kaizen_ch2_smalljump3"];var Ne=s(40549);const Ve=a.vec3.create(),Oe=.75;class He extends Ne.ZP{constructor(t,e){super(t,e),this.isOutroPlaying=!1,this.coolDownPeriod=8,this.chroma={value:0},this.vignette={value:0},this.startRelease=0,this.downHillV={value:0},this.sceneId=2,this.changeState=async t=>{this.previousState!==(0,Re.toStatePaths)(t.value)[0].join(".")&&(this.previousState=(0,Re.toStatePaths)(t.value)[0].join("."),t.matches("scene.interacting.perfect")&&this.release(),this.checkOutro(t))},this.stepValues=Pt.L5,this.tileTexChunk=new Fe.Z(this.renderer),this.pond=new be(this.renderer,this.tileTexChunk),this.background=new V.Z(this.renderer,V.E.LINEAR_3_STOPS),this.background.topColor=a.vec4.fromValues(...Pt.XA,Pt.aD),this.background.middleColor=a.vec4.fromValues(...Pt.XL,Pt.pc),this.background.bottomColor=a.vec4.fromValues(...Pt.TC,Pt.dM),this.background.setIntroColors(a.vec4.fromValues(...Pt.Ki,Pt.aD),a.vec4.fromValues(...Pt.XL,Pt.pc),a.vec4.fromValues(...Pt.TC,Pt.dM)),this.background.setOutroColors(a.vec4.fromValues(...Tt.Ki,Tt.aD),a.vec4.fromValues(...Tt.XL,Tt.pc),a.vec4.fromValues(...Tt.TC,Tt.dM)),this.background.setUseClampedMix(!0),this.camera=new At(this.renderer,this.pond)}async load(){this.lights=new Se(this.renderer),await Promise.all([this.pond.load(),this.background.load()]),this.background.sheetOutro=this.sheetOutro,this.background.sheetIntro=this.sheetIntro,this.pond.fish.sheetPerfect=this.sheetPerfect,this.pond.fish.sheetSuccess=this.sheetSuccess,this.pond.water.sheetSuccess=this.sheetSuccess,this.pond.lilies.sheetSuccess=this.sheetSuccess,this.pond.clouds.sheetSuccess=this.sheetSuccess,this.pond.energyParticles.sheetSuccess=this.sheetSuccess,this.pond.rings.sheetSuccess=this.sheetSuccess,this.lights.sheetSuccess=this.sheetSuccess,this.camera.sheetSuccess=this.sheetSuccess,this.camera.sheetPerfect=this.sheetPerfect,this.camera.sheetIntro=this.sheetIntro,this.camera.sheetOutro=this.sheetOutro,this.onLoaded()}onLoaded(){this.pond.onLoaded(),this.background.onLoaded(),super.onLoaded()}setupLighting(){this.pond.setupSceneLighting(this.renderer.scene.lighting)}start(){super.start(),Ze["default"].fadeIn(Ze.SCENE_AUDIO_AMBIENT_ID[this.id-1],Oe,3),Ze["default"].fadeIn(Ze.SCENE_AUDIO_AMBIENT_LAYER_ID[this.id-1],Oe-.15,3),this.waitingStart||(this.renderer.isReflect=!1,a.vec4.set(this.renderer.clearColor,.541,.686,.588,1),this.camera.start(),this.pond.start(),this.background.start(),this.lights.start(this.renderer.scene.lighting),this.chromaTheatreObj=new O.Z(this.chroma,this.sheetPerfect,"chromatic aberation"),this.vignetteTheatreObj=new O.Z(this.vignette,this.sheetPerfect,"vignette blur"),ct["default"].glapp.quality.level.isVignetteBlur&&this.renderer.postprocess.post.add(this.renderer.postprocess.vignetteblur),this.renderer.postprocess.post.add(this.renderer.postprocess.frame),this.downHill=new O.Z(this.downHillV,this.sheetDownhill,"Downhill"))}stop(){super.stop(),this.lights.stop(),this.pond.stop(),this.background.stop(),this.camera.stop(),this.renderer.postprocess.post.remove(this.renderer.postprocess.frame),this.renderer.postprocess.post.remove(this.renderer.postprocess.vignetteblur),this.chromaTheatreObj.dispose(),this.vignetteTheatreObj.dispose(),this.renderer.isReflect=!1;const t=this.renderer.postprocess;t.saturation.amount=1,this.downHill.dispose()}async release(){if(this.renderer.scene.blockRelease)return;window.clearTimeout(this.unblockReleaseTO),window.clearTimeout(this.unblockDownReleaseTO),this.startRelease=this.renderer.scene.hold,this.camera.camShake.value=0,this.renderer.scene.blockRelease=!0,this.renderer.scene.blockHold=!0,this.renderer.scene.blockHoldDown=!0,this.jumpCounter++,Ze["default"].stopHold(this.id);const t=this.holdingPercent<this.stepValues[1]?0:this.holdingPercent<this.stepValues[2]?1:2,e=Math.floor(Math.random()*ke.length),s=Math.floor(Math.random()*ke[e].length);this.waterExitSound(),this.waterEntrySound(t),0===t&&this.splashSound(),1===t&&(this.firstReleaseDone?Ze["default"].playReactions(ke[e][s],Pt.rX):(this.firstReleaseDone=!0,Ze["default"].playVoice(this.id,3,Pt.p5))),2===t&&Ze["default"].playReactions(ke[e][s],Pt.rX),this.checkFirstPerfect(),this.pond&&await this.pond.fish.jump(Math.max(.4,this.holdingPercent)).then((()=>{this.checkRelease()})),this.resetHoldTime(),this.renderer.scene.blockRelease=!1,this.unblockDownReleaseTO=window.setTimeout((()=>{this.renderer.scene.isTitlePlaying.value||(this.renderer.scene.blockHold=!1,this.renderer.scene.isHolding&&Ze["default"].playHold(this.id,this.renderer.scene.holdValue))}),Ne.oJ),this.unblockReleaseTO=window.setTimeout((()=>{this.renderer.scene.isTitlePlaying.value||(this.renderer.scene.blockHoldDown=!1)}),Ne.QP)}async waterExitSound(){await(0,Pe.Z)(200),Ze["default"].playReactionsBrute(Le[Math.floor(Math.random()*Le.length)],.4)}async waterEntrySound(t){if(0===t)await(0,Pe.Z)(800);else if(1===t)await(0,Pe.Z)(1200);else{if(2!==t)return;await(0,Pe.Z)(1350)}this.isPerfectRelease?(await(0,Pe.Z)(1600),Ze["default"].playReactionsBrute("kaizen_ch2_superdive",.7)):Ze["default"].playReactionsBrute(Ee[Math.floor(Math.random()*Ee.length)],.7)}async splashSound(){await(0,Pe.Z)(800),Ze["default"].playReactionsBrute(Ae[Math.floor(Math.random()*Ae.length)],Pt.rX)}preRender(){if(!this.isLoaded)return;super.preRender(),this.pond.preRender(this.isIntroPlaying,this.isOutroPlaying);const t=this.renderer.postprocess;if(t.vignetteblur.effectStrength=this.vignette.value,t.chroma.amount=this.chroma.value,this.tileTexChunk.timeU.set(k.Z.time),this.isOutroPlaying)for(const s of t.frame.borderWidth)s[0]*=1-this.camera.sheetOutroObj.value.ratio,s[1]*=1-this.camera.sheetOutroObj.value.ratio,s[2]*=1-this.camera.sheetOutroObj.value.ratio,s[3]*=1-this.camera.sheetOutroObj.value.ratio;this.camera.preRender(this.mousePosition,this.holdingPercent,this.isIntroPlaying,this.isOutroPlaying);const e=this.pond.fish.gltf.renderables[0].node;e.updateWorldMatrix(),a.vec3.set(Ve,e._wmatrix[12],e._wmatrix[13],e._wmatrix[14]),this.lights.preRender(Ve)}rttPass(){this.isLoaded&&this.renderer.scene.lighting.lightSetup.prepare(this.renderer.gl)}render(t){this.isLoaded&&(super.render(t),this.background.render(t),this.pond.render(t))}}},87655:function(t,e,s){"use strict";s.d(e,{Io:function(){return d},Ki:function(){return o},L5:function(){return p},TC:function(){return l},XA:function(){return a},XL:function(){return n},aD:function(){return r},dM:function(){return c},p5:function(){return m},pc:function(){return h},rX:function(){return f},z8:function(){return u}});var i=s(63887);const o=[.6,.65,.71],a=[.6,.75,.71],r=.5556,n=[.81,.89,.81],h=.5,l=[.39,.66,.64],c=.3519,d=i.vec3.fromValues(0,60,0),u=i.vec3.fromValues(60,70,0),p=[.01,.40625,.75,1],m=.5,f=.5},28306:function(t,e,s){"use strict";s.d(e,{D1:function(){return y},Hs:function(){return c},Io:function(){return T},It:function(){return u},Ki:function(){return m},L5:function(){return P},Lz:function(){return x},Pl:function(){return b},TC:function(){return w},XA:function(){return f},XL:function(){return v},aD:function(){return g},bk:function(){return p},dM:function(){return _},f5:function(){return a},jk:function(){return o},n9:function(){return d},p5:function(){return S},pc:function(){return C},qc:function(){return l},rX:function(){return R},wH:function(){return r},z8:function(){return M}});var i=s(63887);const o=30,a=80,r=a/o,n=4,h=4,l=4,c=a+2*h,d=c+2*n,u=15,p=.001,m=[.54,.83,.78],f=[.54,.83,.88],g=.55,v=[.5,.75,.8],C=.5,w=[.02,.36,.43],_=.45,x=[.54,.83,.88],y=[.82,.87,.85],b=[.02,.36,.43],P=[.01,.2,.6,1],T=i.vec3.fromValues(0,15,0),M=i.vec3.fromValues(0,25,-10),S=.5,R=.5},75256:function(t,e,s){"use strict";s.d(e,{x:function(){return u}});var i=s(63132),o=s(63887);const a=o.vec3.fromValues(0,0,0),r=o.vec3.fromValues(0,0,0),n=o.vec3.fromValues(0,0,0),h=o.quat.create(),l=o.quat.create(),c=o.quat.create();o.quat.identity(c);const d=o.vec3.create();function u(t,e,s,u,p,m=!1,f=!1,g=.7){o.vec3.copy(r,e.position),o.quat.copy(h,e.rotation),m&&(o.vec3.copy(n,e._parent.position),o.quat.copy(l,e._parent.rotation));const v=(0,i.CW)(0,g,t),C=(0,i.CW)(g,1,t);if(f&&(o.vec3.set(d,e._parent.position[0],u[1],e._parent.position[2]),o.vec3.lerp(e._parent.position,e._parent.position,d,v),e._parent.invalidate(),e._parent.updateWorldMatrix(),o.vec3.copy(n,e._parent.position)),!f||f&&v>=1){const i=f?C:t;o.vec3.copy(s.position,u),s.lookAt(p),s.invalidate(),s.updateWorldMatrix();const d=m?e._parent:e;o.quat.slerp(d.rotation,m?l:h,s.rotation,i),o.vec3.lerp(d.position,m?n:r,u,i),d.invalidate(),d.updateWorldMatrix(),m&&(o.quat.slerp(e.rotation,h,c,i),o.vec3.lerp(e.position,r,a,i),e.invalidate(),e.updateWorldMatrix())}}},11668:function(t,e,s){"use strict";s.d(e,{Z:function(){return u}});var i=s(79763),o=s(96323),a=s(49500),r=s(88760),n=s(15901),h=s.n(n),l=s(14462),c=s.n(l),d=s(21370);class u extends i.Z{constructor(){super(!0,!0),this.reflectionTexture=null,this.addChild(u.enabled),this.addChild(r.Z.input),this.addChild(this.strength=new a.ZP("ReflectionStrength",1)),this.addChild(this.time=new a.ZP("uTime",1)),this.strength.attachConstant(1.8),this.timeU=this.time.attachUniform(),this.timeU.set(0)}_genCode(t){t.add("postlightsf",h()()),t.add("pf",c()())}setup(t){if(null===this.reflectionTexture)throw"missing reflection texture";t.tFloorReflect(this.reflectionTexture),this.timeU.set(1e-4*d.Z.scaledTime)}}u.enabled=new o.Z("enableFReflect",!0)},55929:function(t,e,s){"use strict";s.d(e,{Z:function(){return r}});var i=s(79763),o=s(49500),a=s(1517);class r extends i.Z{constructor(t){super(!0,!1),this.textureRepeatV=2.5,this.textureOpacityV=.3,this.displacementV=.07,this.timeScaleV=.004,this.textureLuminosityV=1,this.backgroundInfluenceV=1,this.addChild(this.noise=new o.ZP("tileNoise",4,o.Ho.FRAGMENT)),this.noiseT=this.noise.attachSampler("tTileNoise",a.ZP.create("aTexCoord0")),this.noiseT._tex=t.scene.texturePool.get("perlinNoise").texture,this.addChild(this.tile=new o.ZP("tile",4,o.Ho.FRAGMENT)),this.tileT=this.tile.attachSampler("tTile",a.ZP.create("aTexCoord0")),this.tileT._tex=t.scene.texturePool.get("tile").texture,this.addChild(this.textureRepeat=new o.ZP("uRepeat",1,o.Ho.FRAGMENT)),this.textureRepeatU=this.textureRepeat.attachUniform(),this.textureRepeatU.set(this.textureRepeatV),this.addChild(this.textureOpacity=new o.ZP("uOpacity",1,o.Ho.FRAGMENT)),this.textureOpacityU=this.textureOpacity.attachUniform(),this.textureOpacityU.set(this.textureOpacityV),this.addChild(this.displacement=new o.ZP("uDisplacement",1,o.Ho.FRAGMENT)),this.displacementU=this.displacement.attachUniform(),this.displacementU.set(this.displacementV),this.addChild(this.timeScale=new o.ZP("uTimeScale",1,o.Ho.FRAGMENT)),this.timeScaleU=this.timeScale.attachUniform(),this.timeScaleU.set(this.timeScaleV),this.addChild(this.textureLuminosity=new o.ZP("uTextureLuminosity",1,o.Ho.FRAGMENT)),this.textureLuminosityU=this.textureLuminosity.attachUniform(),this.textureLuminosityU.set(this.textureLuminosityV),this.addChild(this.time=new o.ZP("uTime2",1,o.Ho.FRAGMENT)),this.timeU=this.time.attachUniform(),this.timeU.set(1)}_genCode(t){t.add("pf","\n      float blendOverlay(float base, float blend) {\n        return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n      }\n\n      vec3 blendOverlay(vec3 base, vec3 blend) {\n        return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));\n      }\n\n      vec3 blendOverlay(vec3 base, vec3 blend, float opacity) {\n        return (blendOverlay(base, blend) * opacity + base * (1.0 - opacity));\n      }\n\n      float greyscale(vec3 col){\n        float grey = dot(col, vec3(0.299, 0.587, 0.114));\n        return grey;\n      }\n\n      float easeInOutCubic(float x) {\n        return x < 0.5 ? 4.0 * x * x * x : 1.0 - pow(-2. * x + 2., 3.) / 2.;\n      }\n    "),t.add("postf","\n    vec4 noiseJitter = texture2D(tTileNoise, tileNoise_texCoord() + vec2(floor(uTime2() * uTimeScale()) * .1));\n    vec2 shakeUV = tileNoise_texCoord();\n\n    shakeUV = shakeUV - vec2(0.5, 0.5);\n    shakeUV = shakeUV * vec2(uRepeat(), uRepeat());\n    shakeUV = shakeUV + vec2(0.5, 0.5);\n\n    shakeUV += (noiseJitter.rg - 0.5) * uDisplacement();\n\n    vec3 texTile = texture2D(tTile, shakeUV).rgb;\n    texTile *= uTextureLuminosity();\n\n    float greyBackground = greyscale(FragColor.rgb);\n    // float greyBackgroundContrasted = easeInOutCubic(greyBackground);\n    // greyBackground = greyBackgroundContrasted;\n\n    // float blendingOpacity = uOpacity();\n    // blendingOpacity = clamp(uOpacity() - greyBackground * uBackgroundInfluence(), 0., 1.);\n    // FragColor.rgb = blendOverlay(FragColor.rgb, texTile, blendingOpacity);\n    FragColor.rgb = mix(FragColor.rgb, FragColor.rgb * 1. - texTile, uOpacity());\n    ")}}}}]);
//# sourceMappingURL=9793.70dfad53.js.map