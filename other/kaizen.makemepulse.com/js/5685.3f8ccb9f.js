"use strict";(self["webpackChunkgl_starter"]=self["webpackChunkgl_starter"]||[]).push([[5685,2246],{2246:function(t,e,i){function n(t){return new Promise((e=>{setTimeout(e,t)}))}i.d(e,{Z:function(){return n}})},14697:function(t,e,i){i.d(e,{Z:function(){return n}});class n{constructor(){this._listeners=[]}on(t,e=!1){-1===this._findListener(t)&&this._listeners.push({cbk:t,once:e})}off(t){const e=this._findListener(t);e>-1&&this._listeners.splice(e,1)}release(){this._listeners=[]}emit(t){for(const e of this._listeners)e.cbk(t);this._listeners.some((t=>t.once))&&(this._listeners=this._listeners.filter((t=>!t.once)))}_findListener(t){return this._listeners.findIndex((e=>e.cbk===t))}}},75685:function(t,e,i){i.r(e),i.d(e,{default:function(){return $}});var n=i(7748),s=i(68736),r=i(2246),o=i(14697),a=i(92571);function h(){return performance.now()/1e3}class c{constructor(){this._running=!1,this.lastFrameTime=-1,this.startTime=-1,this._sampleDuration=1,this.record=[],this.onRaf=()=>{if(!this._running)return;const t=h();if(this.lastFrameTime>0&&this.record.push(t-this.lastFrameTime),this.lastFrameTime=t,t-this.startTime>this._sampleDuration)return this._defer.resolve(this.getResult()),void this._stop();requestAnimationFrame(this.onRaf)}}start(t=1){if(!this._running)return this._sampleDuration=t,this._defer=new s.Z,this.startTime=h(),this._running=!0,this.record.length=0,this.lastFrameTime=-1,requestAnimationFrame(this.onRaf),this._defer.promise}stop(){this._running&&(this._running=!1,this._defer.reject("stopped"),this._stop())}_stop(){this._defer=null,this._running=!1}getResult(){let t=0;const e=this.record;for(let s=0;s<e.length;s++){const i=e[s];t+=i}t/=e.length;let i=0,n=0;for(let s=0;s<e.length;s++){const r=e[s],o=r/t;o>.25&&o<4&&(i+=r,n++)}return i/=n,{meanFrame:i}}}const u=50,l=1e3,f=1e3,d=5e3,p=2,v=4,_=8;var g;(function(t){t[t["DEGRADE"]=p]="DEGRADE",t[t["DEGRADE_CONTINUOUS"]=p|_]="DEGRADE_CONTINUOUS",t[t["UPGRADE"]=v]="UPGRADE",t[t["UPGRADE_CONTINUOUS"]=v|_]="UPGRADE_CONTINUOUS"})(g||(g={}));class m{setLevel(t){this.levelIndex=t}setTargetFps(t){this.targetFps=t,this.targetFrameTime=1/this.targetFps}constructor(t){this.levels=t,this.onChange=new o.Z,this.levelIndex=t.length-1,this.targetFps=u,this.targetFrameTime=1/this.targetFps}async startAutoLevel(t,e=g.DEGRADE){this._autoLevelAbortCtrl=new a.H(t);const i=this._autoLevelAbortCtrl.signal,s=0!==(e&p);s?this.maxQuality():this.minQuality();const o=new c,h=1/this.targetFps;await(0,r.Z)(l);while(1){const t=await o.start();if((0,n.k_)(i),s){if(!(t.meanFrame>this.targetFrameTime))break;if(!this.degrade())break;await(0,r.Z)(f)}else{if(!(t.meanFrame<this.targetFrameTime)){this.degrade();break}if(!this.upgrade())break;await(0,r.Z)(f)}}if(e&_)while(!i.aborted){await(0,r.Z)(d),(0,n.k_)(i);let t=await o.start();(0,n.k_)(i),t.meanFrame<h?(this.upgrade(),await(0,r.Z)(f),(0,n.k_)(i),t=await o.start(.5),(0,n.k_)(i),t.meanFrame>h&&this.degrade()):this.degrade()}}stopAutoLevel(){var t;null===(t=this._autoLevelAbortCtrl)||void 0===t||t.abort()}set levelIndex(t){t<0||t>=this.levels.length||(this._currentLevel=t,this._applyLevel())}get levelIndex(){return this._currentLevel}get level(){return this.levels[this._currentLevel]}maxQuality(){this.levelIndex=this.levels.length-1}minQuality(){this.levelIndex=0}upgrade(){return!(this.levelIndex>=this.levels.length-1)&&(this.levelIndex++,!0)}degrade(){return!(this.levelIndex<=0)&&(this.levelIndex--,!0)}_applyLevel(){this.onChange.emit(this.level)}}var b=function(){if("undefined"!==typeof Map)return Map;function t(t,e){var i=-1;return t.some((function(t,n){return t[0]===e&&(i=n,!0)})),i}return function(){function e(){this.__entries__=[]}return Object.defineProperty(e.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),e.prototype.get=function(e){var i=t(this.__entries__,e),n=this.__entries__[i];return n&&n[1]},e.prototype.set=function(e,i){var n=t(this.__entries__,e);~n?this.__entries__[n][1]=i:this.__entries__.push([e,i])},e.prototype.delete=function(e){var i=this.__entries__,n=t(i,e);~n&&i.splice(n,1)},e.prototype.has=function(e){return!!~t(this.__entries__,e)},e.prototype.clear=function(){this.__entries__.splice(0)},e.prototype.forEach=function(t,e){void 0===e&&(e=null);for(var i=0,n=this.__entries__;i<n.length;i++){var s=n[i];t.call(e,s[1],s[0])}},e}()}(),w="undefined"!==typeof window&&"undefined"!==typeof document&&window.document===document,y=function(){return"undefined"!==typeof i.g&&i.g.Math===Math?i.g:"undefined"!==typeof self&&self.Math===Math?self:"undefined"!==typeof window&&window.Math===Math?window:Function("return this")()}(),E=function(){return"function"===typeof requestAnimationFrame?requestAnimationFrame.bind(y):function(t){return setTimeout((function(){return t(Date.now())}),1e3/60)}}(),O=2;function R(t,e){var i=!1,n=!1,s=0;function r(){i&&(i=!1,t()),n&&a()}function o(){E(r)}function a(){var t=Date.now();if(i){if(t-s<O)return;n=!0}else i=!0,n=!1,setTimeout(o,e);s=t}return a}var T=20,x=["top","right","bottom","left","width","height","size","weight"],A="undefined"!==typeof MutationObserver,F=function(){function t(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=R(this.refresh.bind(this),T)}return t.prototype.addObserver=function(t){~this.observers_.indexOf(t)||this.observers_.push(t),this.connected_||this.connect_()},t.prototype.removeObserver=function(t){var e=this.observers_,i=e.indexOf(t);~i&&e.splice(i,1),!e.length&&this.connected_&&this.disconnect_()},t.prototype.refresh=function(){var t=this.updateObservers_();t&&this.refresh()},t.prototype.updateObservers_=function(){var t=this.observers_.filter((function(t){return t.gatherActive(),t.hasActive()}));return t.forEach((function(t){return t.broadcastActive()})),t.length>0},t.prototype.connect_=function(){w&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),A?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},t.prototype.disconnect_=function(){w&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},t.prototype.onTransitionEnd_=function(t){var e=t.propertyName,i=void 0===e?"":e,n=x.some((function(t){return!!~i.indexOf(t)}));n&&this.refresh()},t.getInstance=function(){return this.instance_||(this.instance_=new t),this.instance_},t.instance_=null,t}(),k=function(t,e){for(var i=0,n=Object.keys(e);i<n.length;i++){var s=n[i];Object.defineProperty(t,s,{value:e[s],enumerable:!1,writable:!1,configurable:!0})}return t},M=function(t){var e=t&&t.ownerDocument&&t.ownerDocument.defaultView;return e||y},D=V(0,0,0,0);function I(t){return parseFloat(t)||0}function C(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];return e.reduce((function(e,i){var n=t["border-"+i+"-width"];return e+I(n)}),0)}function L(t){for(var e=["top","right","bottom","left"],i={},n=0,s=e;n<s.length;n++){var r=s[n],o=t["padding-"+r];i[r]=I(o)}return i}function P(t){var e=t.getBBox();return V(0,0,e.width,e.height)}function B(t){var e=t.clientWidth,i=t.clientHeight;if(!e&&!i)return D;var n=M(t).getComputedStyle(t),s=L(n),r=s.left+s.right,o=s.top+s.bottom,a=I(n.width),h=I(n.height);if("border-box"===n.boxSizing&&(Math.round(a+r)!==e&&(a-=C(n,"left","right")+r),Math.round(h+o)!==i&&(h-=C(n,"top","bottom")+o)),!S(t)){var c=Math.round(a+r)-e,u=Math.round(h+o)-i;1!==Math.abs(c)&&(a-=c),1!==Math.abs(u)&&(h-=u)}return V(s.left,s.top,a,h)}var z=function(){return"undefined"!==typeof SVGGraphicsElement?function(t){return t instanceof M(t).SVGGraphicsElement}:function(t){return t instanceof M(t).SVGElement&&"function"===typeof t.getBBox}}();function S(t){return t===M(t).document.documentElement}function q(t){return w?z(t)?P(t):B(t):D}function G(t){var e=t.x,i=t.y,n=t.width,s=t.height,r="undefined"!==typeof DOMRectReadOnly?DOMRectReadOnly:Object,o=Object.create(r.prototype);return k(o,{x:e,y:i,width:n,height:s,top:i,right:e+n,bottom:s+i,left:e}),o}function V(t,e,i,n){return{x:t,y:e,width:i,height:n}}var N=function(){function t(t){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=V(0,0,0,0),this.target=t}return t.prototype.isActive=function(){var t=q(this.target);return this.contentRect_=t,t.width!==this.broadcastWidth||t.height!==this.broadcastHeight},t.prototype.broadcastRect=function(){var t=this.contentRect_;return this.broadcastWidth=t.width,this.broadcastHeight=t.height,t},t}(),U=function(){function t(t,e){var i=G(e);k(this,{target:t,contentRect:i})}return t}(),W=function(){function t(t,e,i){if(this.activeObservations_=[],this.observations_=new b,"function"!==typeof t)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=t,this.controller_=e,this.callbackCtx_=i}return t.prototype.observe=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!==typeof Element&&Element instanceof Object){if(!(t instanceof M(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)||(e.set(t,new N(t)),this.controller_.addObserver(this),this.controller_.refresh())}},t.prototype.unobserve=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!==typeof Element&&Element instanceof Object){if(!(t instanceof M(t).Element))throw new TypeError('parameter 1 is not of type "Element".');var e=this.observations_;e.has(t)&&(e.delete(t),e.size||this.controller_.removeObserver(this))}},t.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},t.prototype.gatherActive=function(){var t=this;this.clearActive(),this.observations_.forEach((function(e){e.isActive()&&t.activeObservations_.push(e)}))},t.prototype.broadcastActive=function(){if(this.hasActive()){var t=this.callbackCtx_,e=this.activeObservations_.map((function(t){return new U(t.target,t.broadcastRect())}));this.callback_.call(t,e,t),this.clearActive()}},t.prototype.clearActive=function(){this.activeObservations_.splice(0)},t.prototype.hasActive=function(){return this.activeObservations_.length>0},t}(),Z="undefined"!==typeof WeakMap?new WeakMap:new b,H=function(){function t(e){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=F.getInstance(),n=new W(e,i,this);Z.set(this,n)}return t}();["observe","unobserve","disconnect"].forEach((function(t){H.prototype[t]=function(){var e;return(e=Z.get(this))[t].apply(e,arguments)}}));var j=function(){return"undefined"!==typeof y.ResizeObserver?y.ResizeObserver:H}(),Q=j;function J(t){return(t>.2||t<1/180)&&(t=1/60),t}function K(){return performance.now()}class X{constructor(t,{depth:e=!0,alpha:i=!1,pixelRatio:n=-1}={}){this.canvas=t,this.onRender=new o.Z,this.onResize=new o.Z,this.frame=t=>{if(!this._playing)return;const e=t-this.previousTime;let i=(t-this.previousTime)/1e3;i=J(i),e>this.fpsInterval&&(this.onRender.emit(i),this.previousTime=t-e%this.fpsInterval),this._playing&&this._requestFrame()},this.pixelRatio=n<0?Math.min(3,window.devicePixelRatio):n;const s={depth:e,antialias:!1,stencil:!1,alpha:i,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance"};this.gl=t.getContext("webgl2",s)||t.getContext("webgl",s)||t.getContext("experimental-webgl",s)||t.getContext("webgl"),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.width=0,this.height=0,this.canvasWidth=0,this.canvasHeight=0,this.targetFPS=60,this.fpsInterval=1e3/this.targetFPS,this.previousTime=K(),this._rafId=0,this._playing=!1,this._resizeObs=new Q((t=>{const{width:e,height:i}=t[0].contentRect;this._handleResize(e,i)}))}setTargetFps(t=60){this.targetFPS=t,this.fpsInterval=1e3/this.targetFPS}setPixelRatio(t){this.pixelRatio=Math.min(2,t)}updateSize(){const t=this.pixelRatio;this.canvas.width=4*Math.ceil(t*this.canvasWidth/4),this.canvas.height=4*Math.ceil(t*this.canvasHeight/4),this.width=this.gl.drawingBufferWidth,this.height=this.gl.drawingBufferHeight,this.onResize.emit()}_handleResize(t,e){return!isNaN(t)&&!isNaN(e)&&0!==t&&0!==e&&(t===this.canvasWidth&&e===this.canvasHeight||(this.canvasWidth=t,this.canvasHeight=e,this.updateSize()),!0)}start(){this._resizeObs.observe(this.canvas),this._playing=!0,this.frame(K()),this.previousTime=K()}stop(){this._resizeObs.disconnect(),this._playing=!1,this._rafId=0}_requestFrame(){window.cancelAnimationFrame(this._rafId),this._rafId=window.requestAnimationFrame(this.frame)}}var Y=X;class ${constructor(){this._onQualityChange=t=>{switch(this.renderer.postprocess.enabled=t.postprocess,t.isVignetteBlur||this.renderer.postprocess.post.remove(this.renderer.postprocess.vignetteblur),t.dpi){case"full":this.glview.setPixelRatio(window.devicePixelRatio);break;case"one":this.glview.setPixelRatio(1);break;case"low":this.glview.setPixelRatio(.75);break;default:break}this.glview.updateSize(),this.glview.setTargetFps(t.fps),this.quality.setTargetFps(t.fps)}}async createGlAppElements(){const t=document.createElement("canvas");this.glview=new Y(t,{alpha:!1});const{default:e}=await Promise.all([i.e(1972),i.e(179)]).then(i.bind(i,40179));this.renderer=new e(this.glview),this.quality=new m([{postprocess:!0,fps:29,isVignetteBlur:!1,dpi:"one"},{postprocess:!0,fps:50,isVignetteBlur:!1,dpi:"one"},{postprocess:!0,fps:59,isVignetteBlur:!1,dpi:"one"},{postprocess:!0,fps:29,isVignetteBlur:!1,dpi:"full"},{postprocess:!0,fps:50,isVignetteBlur:!1,dpi:"full"},{postprocess:!0,fps:59,isVignetteBlur:!1,dpi:"full"},{postprocess:!0,fps:29,isVignetteBlur:!0,dpi:"full"},{postprocess:!0,fps:50,isVignetteBlur:!0,dpi:"full"},{postprocess:!0,fps:59,isVignetteBlur:!0,dpi:"full"}]),this.quality.maxQuality(),this.quality.onChange.on(this._onQualityChange)}load(){return Promise.resolve()}start(){this.glview.start()}startProfile(){this.quality.startAutoLevel()}stop(){this.glview.stop()}}$._instance=null}}]);
//# sourceMappingURL=5685.3f8ccb9f.js.map