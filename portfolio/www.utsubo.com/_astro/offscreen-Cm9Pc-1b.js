import{R as Ss,D as vo,S as Ti,t as Ls,u as O,f as at,V as Ce,M as lt,a as W,E as xo,b as te,Q as Nt,c as bo,I as lr,P as _i,G as Kt,g as Xt,L as ur,d as js,F as Hs,C as he,e as jt,h as on,i as wo,j as gn,k as vs,l as cs,m as Ht,n as Pi,o as yn,O as Xe,T as So,p as To,B as $t,q as _o,r as rn,s as Ai,v as pt,N as is,w as hr,x as Fi,y as dr,z as Po,A as Yt,H as pr,J as Ts,K as vn,U as Ct,W as Rn,X as fr,Y as mr,Z as gr,_ as yr,$ as Ao,a0 as vr,a1 as xr,a2 as br,a3 as Mo,a4 as an,a5 as wr,a6 as Sr,a7 as Tr,a8 as _r,a9 as Pr,aa as Ar,ab as gt,ac as cn,ad as ln,ae as Mr,af as Rr,ag as Cn,ah as In,ai as Fn,aj as Cs,ak as as,al as Cr,am as Ir,an as Fr,ao as Ro,ap as kr,aq as Er,ar as Nr,as as Co,at as wt,au as xn,av as bn,aw as Ze,ax as Io,ay as ls,az as Js,aA as $,aB as H,aC as ki,aD as Lr,aE as Dr,aF as Pe,aG as _,aH as Xs,aI as wn,aJ as os,aK as zr,aL as Ei,aM as be,aN as Rs,aO as Sn,aP as Vt,aQ as q,aR as At,aS as de,aT as j,aU as xs,aV as Lt,aW as re,aX as Fo,aY as kn,aZ as ko,a_ as Vr,a$ as je,b0 as us,b1 as Tn,b2 as rt,b3 as st,b4 as Or,b5 as Ur,b6 as Br,b7 as Rt,b8 as Gr,b9 as Eo,ba as jr,bb as Wr,bc as Hr,bd as Xr,be as _n,bf as No,bg as Ni,bh as Se,bi as Wt,bj as Lo,bk as Do,bl as qr,bm as _s,bn as tt,bo as zo,bp as nt,bq as gi,br as Vo,bs as Pn,bt as En,bu as Et,bv as Li,bw as Nn,bx as Ds,by as ws,bz as Ft,bA as oe,bB as yi,bC as Di,bD as hs,bE as qs,bF as vi,bG as xi,bH as xt,bI as Ye,bJ as Oo,bK as Le,bL as Is,bM as Pt,bN as Kr,bO as Ln,bP as bi,bQ as un,bR as hn,bS as $r,bT as Uo,bU as Yr,bV as Dt,bW as ct,bX as Es,bY as Bo,bZ as Ps,b_ as Ks,b$ as $s,c0 as Zt,c1 as Go,c2 as jo,c3 as Zr,c4 as wi,c5 as Dn,c6 as Qr,c7 as Gt,c8 as Jr,c9 as As,ca as Ys,cb as Si,cc as ea,cd as Ws,ce as it,cf as Ge,cg as Wo,ch as Zs,ci as Ho,cj as Xo,ck as qo,cl as Ko,cm as ta,cn as zn,co as Vn,cp as On,cq as Un,cr as vt,cs as sa,ct as ia,cu as zi,cv as Ns,cw as mt,cx as di,cy as ni,cz as na,cA as rs,cB as Ot,cC as oa,cD as ra,cE as Mi,cF as aa,cG as ca,cH as Ut,cI as la,cJ as Vi,cK as ps,cL as ua,cM as pi,cN as ha,cO as da,cP as pa,cQ as Bn,cR as fa,cS as Gn,cT as ma,cU as jn,cV as ga,cW as ya,cX as Wn,cY as va,cZ as xa,c_ as ba,c$ as fs,d0 as wa,d1 as Hn,d2 as Oi,d3 as Sa,d4 as Ta,d5 as _a,d6 as Pa}from"./vendor-BHSZwm3o.js";const yt=1/0,Ri=new Ss(1,1);Ri.texture.name="rtt";Ri.depthTexture=new vo;Ri.depthTexture.name="rttDepth";const x={fourthAnimBreakPointStart:.7,fourthAnimBreakPointEnd:.95,spBreakPoint:1024,websiteStarted:!1,fboParticles:Ri,fboScene:new Ti,tempFurMaterial:null,timer:Ls,scroll:0,virtualScroll:0,inSubpage:!1,useAlphaCoverage:!0,globalTimer:O(0).label("globalTimer").setGroup(at),globalElapsed:O(0).label("globalElapsed").setGroup(at),introEyeAnimProgress:O(0),introAnimProgress:O(0),introTotalAnimProgress:O(0),lightBlendProgress:O(.1),cameraFov:O(40),pointerDelta:O("float").label("pointerDelta").setGroup(at),aspectRatio:O("float").label("aspectRatio").setGroup(at),normalizedPointer:O(new Ce).label("normalizedPointer").setGroup(at),screenSpaceMatrix:O(new lt).label("screenSpaceMatrix").setGroup(at),introTotalAnimProgressAfter:{value:0},introTrackingEnabled:{value:0}};x.sections={oneProgress:O(0).label("oneProgress").setGroup(at),twoProgress:O(0).label("twoProgress").setGroup(at),oneEndProgress:O(0).label("oneEndProgress").setGroup(at),twoEndProgress:O(0).label("twoEndProgress").setGroup(at),threeProgress:O(0).label("threeProgress").setGroup(at),fourthProgress:O(0).label("fourthProgress").setGroup(at),fiveProgress:O(0).label("fiveProgress").setGroup(at),oneMagnetProgress:O(0).label("oneMagnetProgress").setGroup(at),endMagnetProgress:O(0).label("endMagnetProgress").setGroup(at),twoIntroProgress:O(0).label("twoIntroProgress").setGroup(at),current:"section1"};let dn={dpr:1,anchorScrolling:!1,speed:O(1).label("speed").setGroup(at),slowMoLerp:O(1).label("slowMoLerp").setGroup(at),transitionSlowMo:O(0),interactionHighlight:O(0),slowMo:!1,zoomInteraction:!1,scene:null,menuOpen:!1,pageTransition:!1,animMenu:O(0),sceneMenu:new Ti,camera:null,gl:null,isWebGPU:!0,resetActivityRatio:1,orthographicLayer:3,perspectiveLayer:2,pointerRef:new Ce(-9999,-9999),pointerLerp:new Ce(-9999,-9999),pointerLerpPrev:new Ce(-9999,-9999),pointerLerpDelta:new Ce,mouseVelocityRef:new W,mouseDirectionRef:new W};function Bt(p){dn={...dn,...p}}function se(){return dn}function $o(p){return"geometry"in p&&"material"in p}function Aa(p){if(!$o(p))return;const e=[].concat(p.material);for(const i of e)i.dispose()}function Ma(p){p&&($o(p)&&(p.geometry&&p.geometry.dispose(),Aa(p)),Promise.resolve().then(()=>{p.parent?.remove(p)}))}function Ra(p){p.isObject3D===!0&&p.traverse(e=>Ma(e))}class Ca{constructor(){this.data={},this.listeners={},this.fireAtStart={},this.instances=[],this.handlerMap={},this.triggeredEvents=new Set,this.smoothProgress=0,this.globalLastUpdateTime=0,this.is}on(e,i){this.listeners[e]=this.listeners[e]||[],this.handlerMap[e]||(this.handlerMap[e]=new Set),this.handlerMap[e].has(i)||(this.handlerMap[e].add(i),this.listeners[e].push(i)),this.listeners[e].push(i)}isHandlerRegistered(e,i){return this.handlerMap[e]?.has(i)}off(e,i){e in this.listeners&&(this.listeners[e].splice(this.listeners[e].indexOf(i),1),this.handlerMap[e]&&this.handlerMap[e].delete(i))}register(e){this.instances.push(e);for(const i in this.fireAtStart)this.fireMethod(e,i)}unregister(e){const i=this.instances.indexOf(e);i>-1&&this.instances.splice(i,1)}nameToMethod(e){return`on${e.charAt(0).toUpperCase()+e.slice(1)}`}fireMethod(e,i){const a=e[this.nameToMethod(i)];typeof a=="function"&&a.call(e,this.data[i])}sortInstances(){const e=this.instances.length;return e!==this.lastInstanceCount&&(this.sortedInstances=Array.from(this.instances).sort((i,a)=>i.raf.renderPriority-a.raf.renderPriority),this.lastInstanceCount=e),this.sortedInstances}async triggerOnRaf({elapsedTime:e,startTime:i}){const s=self.performance.now(),{gl:t,scene:n,camera:r}=se();this.sortInstances();for(const l of this.sortedInstances)typeof l.onBeforeRaf=="function"&&l.onBeforeRaf({gl:t,scene:n,camera:r});let o=10;const c=Math.min((s-this.globalLastUpdateTime)/1e3,o);this.globalLastUpdateTime=s;for(const l of this.sortedInstances){const u=typeof l.onRaf=="function",h=typeof l.onThrottle=="function";if(u||h){h&&(o=1/l.raf.fps);const d=Math.min(s-(l.lastUpdateTime||s),o*1e3),f=1e3/l.raf.fps;let g=d%f/f;if(l.raf.fps===1/0)g=0;else if(h&&Math.floor(d)>=Math.floor(f)){g=1;const m=d/1e3;l.onThrottle({delta:m,elapsedTime:e,startTime:i,gl:t,progress:this.smoothProgress}),l.lastUpdateTime=s}await l.onRaf({delta:c,throttleInterpolation:g,elapsedTime:e,startTime:i,gl:t,scene:n,camera:r,progress:this.smoothProgress})}}for(const l of this.sortedInstances)typeof l.onAfterRaf=="function"&&await l.onAfterRaf({gl:t,scene:n,camera:r})}trigger({name:e,fireAtStart:i=!1,log:a=!1},s={}){if(this.data[e]=s,e!=="newEventRegistered"&&typeof window>"u"&&this.trigger({name:"newEventRegistered"},{newEvent:e}),i&&(this.fireAtStart[e]=!0),a&&console.log(`üë®‚Äçüè´ ${e} ‚Äì ${s}`),e in this.listeners)for(let t=0;t<this.listeners[e].length;t++)this.listeners[e][t].call(this,s);this.instances.forEach(t=>this.fireMethod(t,e))}}const De=new Ca,Ia=new Map,Xn={renderPriority:0,fps:1/0},ze=(p=class{},e={raf:Xn})=>class extends(p||class{}){constructor(...i){super(...i),this._savedArgs=i,this._args=i,this.raf=e.raf||Xn,this.init?.(...i),this.lastUpdateTime=self.performance.now(),De.register(this,this.raf),Ia.set(this.constructor.name,this)}destroy(){console.log("destroy",this),De.unregister(this)}dispose(){this.destroy();const{scene:i}=se();i.remove(this),this.folder&&this.folder.destroy(),Ra(this)}},Ui=()=>{};class Fa extends ze(xo){constructor(){super(),this.ownerDocument=this,this.top=0,this.left=0,this.width=1e3,this.height=1e3,this.style={},this.releasePointerCapture=Ui}get clientWidth(){return Math.round(this.width)}get clientHeight(){return Math.round(this.height)}setPointerCapture(){}onResize({width:e,height:i}){this.setSize(e,i)}getRootNode(){return this}getBoundingClientRect(){return{top:this.top,left:this.left,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height}}focus(){}setSize(e,i){this.height=i,this.width=e}dispatchEvent(e){e.type==="resize"&&(this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height),e.preventDefault=Ui,e.stopPropagation=Ui,super.dispatchEvent(e)}}var Me=new Fa;const ka=new W,qn=new W;class Ea extends ze(){constructor(){super(),this.x=0,this.y=0,this.isTouching=!0,this.distance=0,this.hold=new Ce,this.last=new Ce,this.delta=new Ce,this.move=new Ce,this.world=new W,this.direction=new W,this.normalized=new Ce,this.cameraDirection=new W,Bt({pointer:this})}onStart(e){const i=this.convertEvent(e);this.isTouching=!0,this.x=i.x,this.y=i.y,this.hold.set(i.x,i.y),this.last.set(i.x,i.y),this.delta.set(0,0),this.move.set(0,0),this.normalized.x=this.x/Me.width*2-1,this.normalized.y=-(this.y/Me.height)*2+1,this.distance=0,De.trigger({name:"pointerStart"},{pointer:this})}convertEvent(e){const i={x:0,y:0};return e?e.windowsPointer?e:(e.touches||e.changedTouches?e.touches.length?(i.x=e.touches[0].pageX,i.y=e.touches[0].pageY):(i.x=e.changedTouches[0].pageX,i.y=e.changedTouches[0].pageY):(i.x=e.clientX,i.y=e.clientY),i):i}onPointermove(e){const i=this.convertEvent(e);this.isTouching&&(this.move.x=i.x-this.hold.x,this.move.y=i.y-this.hold.y),(this.last.x!==i.x||this.last.y!==i.y)&&this.last.set(this.x,this.y),this.x=i.x,this.y=i.y,this.delta.x=i.x-this.last.x,this.delta.y=i.y-this.last.y,this.distance+=this.delta.length(),this.normalized.x=this.x/Me.width*2-1,this.normalized.y=-(this.y/Me.height)*2+1,De.trigger({name:"pointerMove"},{pointer:this}),this.isTouching&&De.trigger({name:"pointerDrag"},{pointer:this})}onPointerup(){this.isTouching=!1,this.move.set(0,0),this.delta.set(0,0),De.trigger({name:"pointerEnd"},{pointer:this})}onRaf(){const{camera:e,pointerLerp:i,pointerLerpPrev:a,pointerLerpDelta:s,pointerRef:t}=se();if(!this.normalized||!e)return;t.copy(this.normalized),i.x+=t.x-i.x,i.y+=t.y-i.y,s.copy(i).sub(a),a.copy(i);const n=new W(i.x,i.y,1).unproject(e);qn.copy(n),se().mouseVelocityRef=ka,se().mouseDirectionRef=qn}}new Ea;class Na{constructor(){this.time=self.performance.now(),this.start=this.start.bind(this),this.pause=this.pause.bind(this),this.animate=this.animate.bind(this)}start(){this.startTime=self.performance.now(),this.oldTime=this.startTime,this.isPaused=!1,this.animate(this.startTime);const{gl:e}=se();e.setAnimationLoop(this.animate)}pause(){this.isPaused=!0}async animate(e,i){const{recording:a}=se();this.time=e;const s=this.time-this.startTime,{gl:t,stats:n}=se();a||(this.isPaused||await De.triggerOnRaf({elapsedTime:s/1e3,startTime:this.startTime}),n&&n.update())}}const La=new Na;class Da{constructor(e,i,a,s){if(i.folders?.find(w=>w.id==="camera"))return;this.folder=i.addFolder("Camera"),this.folder.id="camera",this.folder.close();const n=a,r=s,o=a.clone(),c=s.clone(),l=.01,u=60,h=this.folder.add(n,"x",-u,u,l).name("position x"),d=this.folder.add(n,"y",-u,u,l).name("position y"),f=this.folder.add(n,"z",-u,u,l).name("position z"),g=this.folder.add(r,"x",-u,u,l).name("target x"),m=this.folder.add(r,"y",-u,u,l).name("target y"),v=this.folder.add(r,"z",-u,u,l).name("target z");this.folder.add({copyPosition:()=>{const w=[n.x,n.y,n.z],T=JSON.stringify(w);navigator.clipboard.writeText(T)}},"copyPosition").name("Copy Position"),this.folder.add({copyTarget:()=>{const w=[r.x,r.y,r.z],T=JSON.stringify(w);navigator.clipboard.writeText(T)}},"copyTarget").name("Copy Target"),this.folder.add({setToDefault:()=>{n.copy(o),r.copy(c),h.updateDisplay(),d.updateDisplay(),f.updateDisplay(),g.updateDisplay(),m.updateDisplay(),v.updateDisplay(),e.lookAt(e.target)}},"setToDefault").name("Set to Default")}}const Kn={mobile:{position0:[0,.75,1.7],target0:[0,.75,.3],position1:[0,-1.7,8],target1:[0,-1.7,.3],position2:[-18,4,4.5],target2:[20,-4,-5.53],position2Mid:[-5,.8,2],target2Mid:[11,-.5,-3],position2End:[-2.4,-.4,1.9],target2End:[1.8,.2,0],position2Interaction:[-4,3,9],target2Interaction:[.95,-.06,-1.83],position3:[-1.65,.31237,.236622],target3:[1.66,-.16,.5],position4v2:[-.492,.4,.4],target4v2:[.252,.5,.784],position4Mid:[-4,1.5,2.121],target4Mid:[-1,.47,.288],position4End:[-18.84,10,21.89],target4End:[2.09,3.61,-9.99],position4Exit:[0,3,14],target4Exit:[0,1,0],position4Interaction:[.84,.84,7.14],target4Interaction:[-.87,2.14,-3.6],position5Begin:[0,3,0],target5Begin:[0,3,-4],position5:[0,3,20.5],target5:[.7,2.31,-.1],subPagePosition:[2.8,5.74,3.45],subPageTarget:[.63,5.33,20]},desktop:{position0:[0,.75,1.3],target0:[0,.75,.3],position1:[0,-1.7,8],target1:[0,-1.7,.3],position2:[-8,5,3.28],target2:[2.8,-1.9,-1.16],position2Mid:[-5.08,3,.5],target2Mid:[2.09,-1.06,0],position2End:[-1.63,1,1.2],target2End:[2.46,-1.51,-.03],position2Interaction:[-2.62,4.27,9.35],target2Interaction:[.62,-.57,-1.63],position3:[-1.2773,.31237,.236622],target3:[1.3,-.16,.32],position4v2:[-.492,.4,.4],target4v2:[.252,.35,.784],position4Interaction:[.84,.84,7.14],target4Interaction:[-.87,2.14,-3.6],position4Mid:[-4,1.5,2.121],target4Mid:[-1,.47,.288],position4End:[-3.43,3.95,10.75],target4End:[3,-2,-24.08],position4Exit:[4,4,12],target4Exit:[-7.85,-4,-14.08],position5Begin:[0,3,.992],target5Begin:[0,3,-4],position5:[-.149304,1.968,13.45],target5:[-.149304,2.38,-.1],subPagePosition:[2.8,5.74,3.45],subPageTarget:[.63,5.33,20]}},za=["position0","target0","position1","target1","position2","target2","position2Mid","target2Mid","position2Interaction","target2Interaction","position2End","target2End","position3","target3","position4Mid","target4Mid","position4v2","target4v2","position4Interaction","target4Interaction","position4End","target4End","position4Exit","target4Exit","position5Begin","target5Begin","position5","target5","subPagePosition","subPageTarget"],Va=new W(0,0,1),$n=new bo,Oa=new Nt,Ua=new Nt(-Math.sqrt(.5),0,0,Math.sqrt(.5)),Ba={type:"change"},Ga={270:te.degToRad(-90),"-90":te.degToRad(-90),90:te.degToRad(90),0:0,null:0,undefined:0};class ja extends xo{constructor(e){super(),window.isSecureContext===!1&&console.error("THREE.DeviceOrientationControls: DeviceOrientationEvent is only available in secure contexts (https)");const i=1e-6,a=new Nt;this.object=e,this.object.rotation.reorder("YXZ"),this.enabled=!0,this.normalizedRotation={x:0,y:0},this.device={alpha:0,beta:0,gamma:0},this.screenOrientation=0,this.alphaOffset=0;const s=r=>{if(r.alpha===null||r.beta===null||r.gamma===null){this.device={alpha:0,beta:0,gamma:0};return}this.device.alpha=r.alpha,this.device.beta=r.beta,this.device.gamma=r.gamma;const o=this.device.beta-90;this.normalizedRotation.y=te.clamp(-o/30,-1,1),this.normalizedRotation.x=te.clamp(-this.device.gamma/30,-1,1),this.dispatchEvent({type:"change",data:this.normalizedRotation})},t=r=>{if(console.info(`The orientation event is of type ${r.type}`),screen.orientation){const o=screen.orientation;this.screenOrientation=Ga[o.angle],console.log(`Inputs are: ${o.angle} degrees. Result is ${this.screenOrientation} radians.`);return}this.screenOrientation=0,console.log(`Screen orientation is ${this.screenOrientation} radians.`)},n=(r,o,c,l,u)=>{$n.set(c,o,-l,"YXZ"),r.setFromEuler($n),r.multiply(Ua),r.multiply(Oa.setFromAxisAngle(Va,-u))};this.connect=()=>{window.DeviceOrientationEvent!==void 0&&typeof window.DeviceOrientationEvent.requestPermission=="function"?window.DeviceOrientationEvent.requestPermission().then(r=>{r=="granted"&&(window.addEventListener("orientationchange",t),window.addEventListener("deviceorientation",s))}).catch(r=>{console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",r)}):(window.addEventListener("orientationchange",t),window.addEventListener("deviceorientation",s)),this.enabled=!0},this.disconnect=()=>{window.removeEventListener("orientationchange",t),window.removeEventListener("deviceorientation",s),this.enabled=!1},this.update=()=>{if(this.enabled===!1)return;const r=this.deviceOrientation;if(r){const o=r.alpha?te.degToRad(r.alpha)+this.alphaOffset:0,c=r.beta?te.degToRad(r.beta):0,l=r.gamma?te.degToRad(r.gamma):0,u=this.screenOrientation?te.degToRad(this.screenOrientation):0;n(this.object.quaternion,o,c,l,u),8*(1-a.dot(this.object.quaternion))>i&&(a.copy(this.object.quaternion),this.dispatchEvent(Ba))}},this.dispose=()=>{this.disconnect()},this.connect()}}const{clamp:Wa}=te,Bi=(p,e,i)=>{if(p>=e)throw new Error("Start must be less than end");return i=Math.max(0,Math.min(1,i)),i<p?1:Math.max(0,1-(i-p)/(e-p))},ot=(p,e,i)=>e-p===0?1:Wa((i-p)/(e-p),0,1),ns=(p,e,i)=>p*(1-i)+e*i,Yo=p=>p*p*p,Yn=p=>p*p*p*p*p,fi=p=>1-Math.pow(1-p,3),Ha=p=>p<.5?2*p*p:1-Math.pow(-2*p+2,2)/2,oi=p=>1+Math.sin(Math.PI/2*p-Math.PI/2),Xa=p=>Math.sin(Math.PI/2*p),Zn=p=>Math.sqrt(1-Math.pow(p-1,2));class qa{constructor(e){this.position=e,this.origin=new W,this.target=new W,this.perlin=new lr,this.frequency=new W(1,1,1),this.amplitude=new W(4,4,4),this.scale=10,this.lerpSpeed=.012,this.intensity=0,this.position&&this.origin.copy(this.position)}update(e,i,a,s){this.intensity=i>0?te.damp(this.intensity,i,1.3,a):0,this.intensity!==0&&(this.target.x=this.perlin.noise(e*this.frequency.x,1,1)*this.amplitude.x*this.intensity,this.target.y=this.perlin.noise(1,e*this.frequency.y,1)*this.amplitude.y*this.intensity,this.target.z=this.perlin.noise(1,1,e*this.frequency.z)*this.amplitude.z*this.intensity,this.target.multiplyScalar(this.scale),this.target.add(this.origin),this.position&&this.position.lerp(this.target,(this.lerpSpeed+this.intensity*.025)*Math.max(.01,s)))}}Nt.prototype.damp=function(p,e,i){this.slerp(p,1-Math.exp(-e*i))};W.prototype.damp=function(p,e,i){this.x=te.damp(this.x,p.x,e,i),this.y=te.damp(this.y,p.y,e,i),this.z=te.damp(this.z,p.z,e,i)};class Ka extends ze(_i,{raf:{renderPriority:0,fps:yt}}){constructor(){super(20,0,.1,20)}init(){this.isMobile=!0,this.fromTp=!1,this.zoomInteractionValue=0,this.mobileScaleFactor=0,this.rollAngle=0,this.enableAxis=1,this.animMenuLerp=0,this.switchedPage=!1,this.reducePointerEffect=1,this.virtualParent=new Kt,this.virtualParentDamp=new Kt,this.virtualAxisDamp=new Kt,this.virtualAxisDamp.add(this.virtualParentDamp),this.wobbleEffect=new qa(this.position),this.offsetIntro=new W(0,0,0),this.pointerInteractionZ=0,this.target=new W(0,.75,.3),this.virtualTarget=new W(0,.75,0),this.virtualTargetDamp=new W().copy(this.virtualTarget),this.virtualParent.position.set(0,.75,1.3),this.introTotalAnimProgress={value:0},this.lookAt(this.target),this.currentScene=1,["offsetFirstScreen","position0Temp","gyroscope",...za].forEach(i=>{this[i]=new W}),this.offsetZStart=-.5,this.near=.1,this.fardamp=0,this.neardamp=0,this.fovdamp=0,this.fov0=20,this.far0=20,this.near0=.1,this.fov1=20,this.far1=20,this.fov2=15,this.far2=50,this.near2=.001,this.fov3=25,this.far3=40,this.near3=.001,this.unzoomValue=1,this.far4=90,this.near4=.5,this.fov4v2=18,this.far4v2=20,this.near4v2=.001,this.fov4=42,this.fov5=40,this.far5=90,this.near5=.1,this.updateCameraPropertiesForScreenSize(),this.position1Temp=new W,this.target1Temp=new W,Bt({camera:this})}onDeviceOrientationGranted(){const e=new ja(this);e.enabled=!0,e.addEventListener("change",this.gyroscopeUpdate),this.gyroscopeEnabled=!0}gyroscopeUpdate=e=>{const{x:i,y:a}=e.data;this.gyroscope.x=i,this.gyroscope.y=a};calculateUnitSize(e=this.position.z){const i=this.fov*Math.PI/180,a=2*Math.tan(i/2)*e;return{width:a*this.aspect,height:a}}setVirtualCameraProperties({position:e,target:i,fov:a,far:s,near:t}){this.virtualParentDamp.position.copy(e),this.virtualTargetDamp.copy(i),this.fov=a,this.far=s,this.near=t}interpolateCameraProperties({target:e,position:i,fov:a,far:s,near:t,progress:n}){this.virtualTarget.lerp(e,n),this.virtualParent.position.lerp(i,n),this.fovdamp=ns(this.fovdamp,a,n),this.fardamp=ns(this.fardamp,s,n),this.neardamp=ns(this.neardamp,t,n)}cameraMovementStill(e,i,a=1){const s=1-ot(0,.3,e);if(s>0){const t=Math.sin(i*1.5)*.005*s*a,n=Math.cos(i*.4)*.02*s*a;this.offsetFirstScreen.set(0,t,n)}else this.offsetFirstScreen.set(0,0,0)}scene3CameraMovement(e){const i=this.isMobile?-.2:-.26,a=this.isMobile?0:-.14;this.target3.y=i+Yn(Math.max(0,1-this.progress3*4))*a,this.setVirtualCameraProperties({position:this.position3,target:this.target3,fov:this.fov3+this.animMenuLerp*30,far:this.far3,near:this.near3}),this.fromTp=!0;const t=-.1-this.mobileScaleFactor*.1+this.progress3*(this.isMobile?.12:.18);this.virtualParentDamp.position.z+=t,this.virtualTargetDamp.z+=t;const n=Yn(Math.max(0,1-this.progress3*50));this.unzoomValue=te.damp(this.unzoomValue,n,5+n*20,e),this.currentScene===4&&(this.unzoomValue=0),this.virtualParentDamp.position.x+=-(this.unzoomValue*(this.isMobile?.1:.25)),this.currentScene=3}teleportCamera({instant:e,position:i,target:a,fov:s,far:t,near:n,instantPosition:r,instantTarget:o}){e?this.setVirtualCameraProperties({position:r||i,target:o||a,fov:s,far:t,near:n}):this.interpolateCameraProperties({target:a,position:i,fov:s,far:t,near:n,progress:1})}fovMenuController(e,i){const{menuOpen:a,pageTransition:s}=se(),t=a||s;this.animMenuLerp=te.damp(this.animMenuLerp,t?1:0,t?1.5:4,e);const n=i?4-4*this.progress4:0,r=this.progress5===0?10:7.5;this.menuFov=(6+n+this.progress5)*this.animMenuLerp*r}blendCameraProperties(e){let i=0;const a=new W,s=new W;e.forEach(({position:t,target:n,progress:r})=>{i+=r,a.addScaledVector(t,r),s.addScaledVector(n,r)}),i>0&&(a.divideScalar(i),s.divideScalar(i),this.virtualParent.position.copy(a),this.virtualTarget.copy(s))}onRaf({elapsedTime:e,delta:i}){let a=12,s=!1;const{sections:t}=x;this.progress1=t.oneProgress.value,this.progress2=t.twoProgress.value,this.progress2Intro=t.twoIntroProgress.value,this.progress2End=t.twoEndProgress.value,this.progress3=t.threeProgress.value,this.progress4=t.fourthProgress.value,this.progress5=t.fiveProgress.value,this.switchedPage=this.inSubpage!==x.inSubpage,this.inSubpage=x.inSubpage;const n=x.introTotalAnimProgress.value,r=this.progress4>0;if(this.inSubpage)this.rollAngle=te.lerp(this.rollAngle,0,.004),this.interpolateCameraProperties({target:this.subPagePosition,position:this.subPageTarget,fov:this.fov4,far:this.far4,near:this.near4,progress:1});else{if(this.offsetIntro.z=(1-n)*this.offsetZStart,this.offsetIntro.y=(1-n)*.05,this.position0Temp.copy(this.position0).add(this.offsetIntro),this.progress3<=0){this.virtualParent.position.set(this.position0Temp.x,this.position0Temp.y,this.position0Temp.z),this.position1Temp.copy(this.position1),this.position1Temp.x+=Math.abs(this.virtualAxisDamp.rotation.y-.25)*10;const l=oi(this.progress1);this.virtualParent.position.lerpVectors(this.position0Temp,this.position1Temp,l),this.virtualTarget.lerpVectors(this.target0,this.target1,l);const u=35;this.fovdamp=ns(this.fov0,this.fov1+u,Math.min(1,this.progress1*2)),this.fardamp=ns(this.far0,this.far1,this.progress1),this.neardamp=ns(this.near0,this.near2,this.progress1),this.cameraMovementStill(this.progress1,e),this.progress2Intro>0&&this.interpolateCameraProperties({target:this.target2,position:this.position2,fov:this.fov2+u*(1-fi(this.progress2Intro)),far:this.far2,near:this.near2,progress:this.progress2Intro});const h=Math.min(1,Math.max(0,(this.progress2-.42)*3.333));this.rollAngle=te.lerp(this.rollAngle,0,.015),h>0&&(this.interpolateCameraProperties({target:this.target2Mid,position:this.position2Mid,fov:this.fov2,far:this.far2,near:this.near2,progress:h}),this.interpolateCameraProperties({target:this.target2End,position:this.position2End,fov:this.fov2,far:this.far2,near:this.near2,progress:this.progress2End})),this.currentScene=2}else if(r&&this.progress5<=0){this.fromTp=!1,s=this.currentScene!==4;const l=this.currentScene!=5;s&&l&&(this.rollAngle=Math.PI/4),this.rollAngle=te.lerp(this.rollAngle,0,.004),this.teleportCamera({instant:s,position:this.position4v2,target:this.target4v2,fov:l?this.fov4v2:this.fov4,far:this.far4v2,near:this.near4v2,instantPosition:l?this.position4v2:this.position4End,instantTarget:l?this.target4v2:this.target4End}),this.interpolateCameraProperties({target:this.target4Mid,position:this.position4Mid,fov:this.fov4,far:this.far4,near:this.near4,progress:Xa(1-Bi(0,.34,this.progress4))});const{fourthAnimBreakPointStart:u,fourthAnimBreakPointEnd:h}=x;ot(u,h,this.progress4);const d=oi(1-Bi(.22,.7,this.progress4)),f=oi(1-Bi(.5,.75,this.progress4));this.interpolateCameraProperties({target:this.target4End,position:this.position4End,fov:this.fov4,far:this.far4,near:this.near4,progress:d}),this.interpolateCameraProperties({target:this.target4Exit,position:this.position4Exit,fov:this.fov4,far:this.far4,near:this.near4,progress:f}),this.currentScene=4}else this.progress5>0&&(s=this.currentScene!==5,this.rollAngle=0,this.teleportCamera({instant:s,position:this.position5Begin,target:this.target5Begin,fov:this.fov5,far:this.far5,near:this.near5}),this.currentScene=5,this.interpolateCameraProperties({target:this.target5,position:this.position5,fov:this.fov5,far:this.far5,near:this.near5,progress:oi(this.progress5)}));s&&(a=0)}const o=this.progress4===0;this.updateZoomInteraction(i,o),this.fovMenuController(i,r),this.progress3>0&&o&&!this.inSubpage?(this.offsetFirstScreen.set(0,0,0),this.scene3CameraMovement(i)):(this.unzoomValue=1,this.fromTp?this.setVirtualCameraProperties({position:this.virtualParent.position,target:this.virtualTarget,fov:this.fovdamp,far:this.fardamp,near:this.neardamp}):(this.virtualParentDamp.position.damp(this.virtualParent.position,a,i),this.virtualTargetDamp.damp(this.virtualTarget,a,i),this.fov=te.damp(this.fov,this.fovdamp+this.menuFov,a,i),this.far=te.damp(this.far,this.fardamp,a,i),this.near=te.damp(this.near,this.neardamp,a,i)),this.fromTp=!1),this.cameraUserInteractionAxis({instantTeleport:s,delta:i}),this.position.setFromMatrixPosition(this.virtualParentDamp.matrixWorld),this.position.add(this.offsetFirstScreen);const c=this.progress5===0?this.animMenuLerp:0;if(bt.up.set(Math.sin(this.rollAngle+fi(c)*.3),Math.cos(this.rollAngle+c*.2),0),!this.inSubpage){const l=1-this.zoomInteractionValue;this.wobbleEffect.update(e,this.progress4===1?0:Math.min(1,this.progress4*1.4*l)*(1-this.animMenuLerp),i,se().slowMoLerp.value)}this.lookAt(this.virtualTargetDamp),this.updateProjectionMatrix(),this.switchedPage&&(this.switchedPage=this.inSubpage),x.cameraFov.value=this.fov}updateZoomInteraction(e,i){const{zoomInteraction:a}=se(),s=1.01-(a?this.zoomInteractionValue:-1)*.7,t=2;if(this.zoomInteractionValue=te.damp(this.zoomInteractionValue,a?1:0,i?t:s,e),this.zoomInteractionValue<.001||x.inSubpage)return;const n=i?{target:this.target2Interaction,position:this.position2Interaction,fov:this.fov2,far:this.far2,near:this.near2,progress:this.zoomInteractionValue}:{target:this.target4Interaction,position:this.position4Interaction,fov:this.fov4,far:this.far4,near:this.near4,progress:this.zoomInteractionValue};i||(this.cameraScene4MidZoomProgress=1-Math.abs(1-2*Math.min(1,this.zoomInteractionValue*1.1)),this.interpolateCameraProperties({target:{x:0,y:0,z:0},position:{x:0,y:0,z:0},fov:this.fov4,far:this.far4,near:this.near4,progress:fi(this.cameraScene4MidZoomProgress)})),this.interpolateCameraProperties(n)}cameraUserInteractionAxis({instantTeleport:e,delta:i}){let a=1,s=1.2;if(this.progress2End>0&&this.progress2End<1&&(a=1-Math.min(this.progress2End*3,1)),this.progress3>0&&this.progress3<1&&this.progress4===0){const w=ot(.3,.6,this.progress3);a=(1-w)*.2,s=1+w*2+(this.progress3>.6?(this.progress3-.6)*100:0)}a*=x.introTrackingEnabled.value;const t=e&&this.currentScene===4;s=2*s+(t?100:0),s*=Math.max(.01,1-this.zoomInteractionValue);const n=1-this.zoomInteractionValue,r=this.progress4*n,o=Math.max(1,(r-this.progress5)*1.6);this.progress4>0&&(a*=n);const c=0,l=this.isMobile&&this.gyroscopeEnabled,{pointerLerp:u,isMobileOrTablet:h}=se();let d=l?this.gyroscope.x:u.x;const f=l?this.gyroscope.y:u.y,g=this.progress2>0&&this.progress3<.2?.5:1,m=this.progress4>.72,v=m&&this.progress5<.5?0:1;if(this.reducePointerEffect=te.damp(this.reducePointerEffect,m?v:g,1,i),h&&!l){this.virtualAxisDamp.updateMatrixWorld(!0);return}if(this.inSubpage){const w=d*.6,T=f*.002;this.switchedPage&&(this.virtualAxisDamp.rotation.y=0,this.virtualAxisDamp.rotation.z=w,this.virtualAxisDamp.rotation.x=T),this.virtualAxisDamp.rotation.z=te.damp(this.virtualAxisDamp.rotation.z,w,.3,i),this.virtualAxisDamp.rotation.x=te.damp(this.virtualAxisDamp.rotation.x,T,.4,i)}else{const w=-f*.05*a*o*this.reducePointerEffect,T=d*.25*a*o*this.reducePointerEffect+c;this.virtualAxisDamp.rotation.x=te.damp(this.virtualAxisDamp.rotation.x,w,s,i),this.virtualAxisDamp.rotation.y=te.damp(this.virtualAxisDamp.rotation.y,T+this.getIntroRotationY(this.virtualAxisDamp.rotation.y),s,i),this.virtualAxisDamp.rotation.z=0}this.virtualAxisDamp.updateMatrixWorld(!0)}getIntroRotationY(e){const i=Math.min(1,this.progress1*2)-Math.min(1,Math.max(0,(-.5+this.progress1)*2.5));let a=Math.max(0,.1-Math.abs(e))*10;return e<0?a-=e*40:a+=-e*2,a*i}updateCameraPropertiesForScreenSize(e){const i=x.spBreakPoint;this.isMobile=Me.width<=i;const a=this.isMobile?Kn.mobile:Kn.desktop;if(Object.keys(a).forEach(s=>{this[s].set(...a[s])}),this.isMobile){const s=(i-Me.width)/i,t=1-e;this.mobileScaleFactor=s,this.position0.z+=s/2,this.position2.z+=s*2,this.target2Interaction.x-=s-t*.5,this.target2Interaction.y+=s*1.3-t,this.position2Interaction.z+=s,this.target2.z-=s*2,this.position4Mid.z+=s,this.target4Mid.z+=s,this.target4End.x+=s*2,this.position4End.z+=s,this.position5.z+=s*10,this.offsetZStart=-.5-s/2}else this.mobileScaleFactor=0,this.offsetZStart=Me.width<=1100?-.3:-.33,this.target4Mid.x+=Math.max(0,(1.8-e)*7)}onResize({ratio:e}){this.updateCameraPropertiesForScreenSize(e),this.aspect=e,this.unit=this.calculateUnitSize(),this.updateProjectionMatrix()}onDebug({gui:e}){e&&new Da(this,e,this.position2Interaction,this.target2Interaction)}}const bt=new Ka;class $a extends ze(_i){constructor(){super(50,0,.1,50),this.isMobile=!1,this.baseLogoSize={desktop:1,mobile:2},this.updateScaleFactor()}init(){this.target=new W(0,0,1),this.position.set(0,0,1),this.lookAt(this.target),this.checkDevice()}checkDevice(){this.isMobile=Me.width<=1080}updateScaleFactorMobile(){const e=Me.width<=768?667:1120,i=Me.height/e;this.scaleFactor=i}updateScaleFactor(){if(this.scaleFactor=1,Me.width<=1300){const e=Me.width/1300;this.scaleFactor=e}}calculateUnitSize(e=this.position.z){const i=this.fov*Math.PI/180;let a=2*Math.tan(i/2)*e,s=a*this.aspect;const t=this.isMobile?this.baseLogoSize.mobile:this.baseLogoSize.desktop;return this.isMobile?(this.updateScaleFactorMobile(),a*=t/this.scaleFactor,s*=t/this.scaleFactor):(this.updateScaleFactor(),a*=t,s*=t),{width:s,height:a}}onMenuOpen({open:e}){const{animMenu:i}=se();Xt.killTweensOf(i);const a=i.value;Xt.to(i,{value:e?1:0,duration:(e?3:.6)*(e?1-a:a),ease:e?"expo.out":"power1.inOut"})}onResize({ratio:e}){this.checkDevice(),this.aspect=e,this.unit=this.calculateUnitSize(),this.updateProjectionMatrix()}onRaf({progress:e,elapsedTime:i}){const{animMenu:a}=se(),s=this.isMobile?21+(this.scaleFactor-1)*20:15-(this.scaleFactor-1)*30;this.position.z=1+a.value*s}}const Ya=new $a,Qe=new Ti;Bt({scene:Qe,cameraMenu:Ya});class Za extends ur{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(i){return new sc(i)}),this.register(function(i){return new ic(i)}),this.register(function(i){return new dc(i)}),this.register(function(i){return new pc(i)}),this.register(function(i){return new oc(i)}),this.register(function(i){return new rc(i)}),this.register(function(i){return new ac(i)}),this.register(function(i){return new cc(i)}),this.register(function(i){return new tc(i)}),this.register(function(i){return new lc(i)}),this.register(function(i){return new nc(i)}),this.register(function(i){return new hc(i)}),this.register(function(i){return new uc(i)}),this.register(function(i){return new Ja(i)}),this.register(function(i){return new fc(i)}),this.register(function(i){return new mc(i)})}load(e,i,a,s){const t=this;let n;if(this.resourcePath!=="")n=this.resourcePath;else if(this.path!==""){const c=js.extractUrlBase(e);n=js.resolveURL(c,this.path)}else n=js.extractUrlBase(e);this.manager.itemStart(e);const r=function(c){s?s(c):console.error(c),t.manager.itemError(e),t.manager.itemEnd(e)},o=new Hs(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(c){try{t.parse(c,n,function(l){i(l),t.manager.itemEnd(e)},r)}catch(l){r(l)}},a,r)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,i,a,s){let t;const n={},r={},o=new TextDecoder;if(typeof e=="string")t=JSON.parse(e);else if(e instanceof ArrayBuffer)if(o.decode(new Uint8Array(e,0,4))===Zo){try{n[Re.KHR_BINARY_GLTF]=new gc(e)}catch(u){s&&s(u);return}t=JSON.parse(n[Re.KHR_BINARY_GLTF].content)}else t=JSON.parse(o.decode(e));else t=e;if(t.asset===void 0||t.asset.version[0]<2){s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const c=new Cc(t,{path:i||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});c.fileLoader.setRequestHeader(this.requestHeader);for(let l=0;l<this.pluginCallbacks.length;l++){const u=this.pluginCallbacks[l](c);u.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),r[u.name]=u,n[u.name]=!0}if(t.extensionsUsed)for(let l=0;l<t.extensionsUsed.length;++l){const u=t.extensionsUsed[l],h=t.extensionsRequired||[];switch(u){case Re.KHR_MATERIALS_UNLIT:n[u]=new ec;break;case Re.KHR_DRACO_MESH_COMPRESSION:n[u]=new yc(t,this.dracoLoader);break;case Re.KHR_TEXTURE_TRANSFORM:n[u]=new vc;break;case Re.KHR_MESH_QUANTIZATION:n[u]=new xc;break;default:h.indexOf(u)>=0&&r[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}c.setExtensions(n),c.setPlugins(r),c.parse(a,s)}parseAsync(e,i){const a=this;return new Promise(function(s,t){a.parse(e,i,s,t)})}}function Qa(){let p={};return{get:function(e){return p[e]},add:function(e,i){p[e]=i},remove:function(e){delete p[e]},removeAll:function(){p={}}}}const Re={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Ja{constructor(e){this.parser=e,this.name=Re.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,i=this.parser.json.nodes||[];for(let a=0,s=i.length;a<s;a++){const t=i[a];t.extensions&&t.extensions[this.name]&&t.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,t.extensions[this.name].light)}}_loadLight(e){const i=this.parser,a="light:"+e;let s=i.cache.get(a);if(s)return s;const t=i.json,o=((t.extensions&&t.extensions[this.name]||{}).lights||[])[e];let c;const l=new he(16777215);o.color!==void 0&&l.setRGB(o.color[0],o.color[1],o.color[2],jt);const u=o.range!==void 0?o.range:0;switch(o.type){case"directional":c=new gn(l),c.target.position.set(0,0,-1),c.add(c.target);break;case"point":c=new wo(l),c.distance=u;break;case"spot":c=new on(l),c.distance=u,o.spot=o.spot||{},o.spot.innerConeAngle=o.spot.innerConeAngle!==void 0?o.spot.innerConeAngle:0,o.spot.outerConeAngle=o.spot.outerConeAngle!==void 0?o.spot.outerConeAngle:Math.PI/4,c.angle=o.spot.outerConeAngle,c.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,c.target.position.set(0,0,-1),c.add(c.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return c.position.set(0,0,0),c.decay=2,qt(c,o),o.intensity!==void 0&&(c.intensity=o.intensity),c.name=i.createUniqueName(o.name||"light_"+e),s=Promise.resolve(c),i.cache.add(a,s),s}getDependency(e,i){if(e==="light")return this._loadLight(i)}createNodeAttachment(e){const i=this,a=this.parser,t=a.json.nodes[e],r=(t.extensions&&t.extensions[this.name]||{}).light;return r===void 0?null:this._loadLight(r).then(function(o){return a._getNodeRef(i.cache,r,o)})}}class ec{constructor(){this.name=Re.KHR_MATERIALS_UNLIT}getMaterialType(){return vs}extendParams(e,i,a){const s=[];e.color=new he(1,1,1),e.opacity=1;const t=i.pbrMetallicRoughness;if(t){if(Array.isArray(t.baseColorFactor)){const n=t.baseColorFactor;e.color.setRGB(n[0],n[1],n[2],jt),e.opacity=n[3]}t.baseColorTexture!==void 0&&s.push(a.assignTexture(e,"map",t.baseColorTexture,cs))}return Promise.all(s)}}class tc{constructor(e){this.parser=e,this.name=Re.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const t=s.extensions[this.name].emissiveStrength;return t!==void 0&&(i.emissiveIntensity=t),Promise.resolve()}}class sc{constructor(e){this.parser=e,this.name=Re.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:Ht}extendMaterialParams(e,i){const a=this.parser,s=a.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const t=[],n=s.extensions[this.name];if(n.clearcoatFactor!==void 0&&(i.clearcoat=n.clearcoatFactor),n.clearcoatTexture!==void 0&&t.push(a.assignTexture(i,"clearcoatMap",n.clearcoatTexture)),n.clearcoatRoughnessFactor!==void 0&&(i.clearcoatRoughness=n.clearcoatRoughnessFactor),n.clearcoatRoughnessTexture!==void 0&&t.push(a.assignTexture(i,"clearcoatRoughnessMap",n.clearcoatRoughnessTexture)),n.clearcoatNormalTexture!==void 0&&(t.push(a.assignTexture(i,"clearcoatNormalMap",n.clearcoatNormalTexture)),n.clearcoatNormalTexture.scale!==void 0)){const r=n.clearcoatNormalTexture.scale;i.clearcoatNormalScale=new Ce(r,r)}return Promise.all(t)}}class ic{constructor(e){this.parser=e,this.name=Re.KHR_MATERIALS_DISPERSION}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:Ht}extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const t=s.extensions[this.name];return i.dispersion=t.dispersion!==void 0?t.dispersion:0,Promise.resolve()}}class nc{constructor(e){this.parser=e,this.name=Re.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:Ht}extendMaterialParams(e,i){const a=this.parser,s=a.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const t=[],n=s.extensions[this.name];return n.iridescenceFactor!==void 0&&(i.iridescence=n.iridescenceFactor),n.iridescenceTexture!==void 0&&t.push(a.assignTexture(i,"iridescenceMap",n.iridescenceTexture)),n.iridescenceIor!==void 0&&(i.iridescenceIOR=n.iridescenceIor),i.iridescenceThicknessRange===void 0&&(i.iridescenceThicknessRange=[100,400]),n.iridescenceThicknessMinimum!==void 0&&(i.iridescenceThicknessRange[0]=n.iridescenceThicknessMinimum),n.iridescenceThicknessMaximum!==void 0&&(i.iridescenceThicknessRange[1]=n.iridescenceThicknessMaximum),n.iridescenceThicknessTexture!==void 0&&t.push(a.assignTexture(i,"iridescenceThicknessMap",n.iridescenceThicknessTexture)),Promise.all(t)}}class oc{constructor(e){this.parser=e,this.name=Re.KHR_MATERIALS_SHEEN}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:Ht}extendMaterialParams(e,i){const a=this.parser,s=a.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const t=[];i.sheenColor=new he(0,0,0),i.sheenRoughness=0,i.sheen=1;const n=s.extensions[this.name];if(n.sheenColorFactor!==void 0){const r=n.sheenColorFactor;i.sheenColor.setRGB(r[0],r[1],r[2],jt)}return n.sheenRoughnessFactor!==void 0&&(i.sheenRoughness=n.sheenRoughnessFactor),n.sheenColorTexture!==void 0&&t.push(a.assignTexture(i,"sheenColorMap",n.sheenColorTexture,cs)),n.sheenRoughnessTexture!==void 0&&t.push(a.assignTexture(i,"sheenRoughnessMap",n.sheenRoughnessTexture)),Promise.all(t)}}class rc{constructor(e){this.parser=e,this.name=Re.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:Ht}extendMaterialParams(e,i){const a=this.parser,s=a.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const t=[],n=s.extensions[this.name];return n.transmissionFactor!==void 0&&(i.transmission=n.transmissionFactor),n.transmissionTexture!==void 0&&t.push(a.assignTexture(i,"transmissionMap",n.transmissionTexture)),Promise.all(t)}}class ac{constructor(e){this.parser=e,this.name=Re.KHR_MATERIALS_VOLUME}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:Ht}extendMaterialParams(e,i){const a=this.parser,s=a.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const t=[],n=s.extensions[this.name];i.thickness=n.thicknessFactor!==void 0?n.thicknessFactor:0,n.thicknessTexture!==void 0&&t.push(a.assignTexture(i,"thicknessMap",n.thicknessTexture)),i.attenuationDistance=n.attenuationDistance||1/0;const r=n.attenuationColor||[1,1,1];return i.attenuationColor=new he().setRGB(r[0],r[1],r[2],jt),Promise.all(t)}}class cc{constructor(e){this.parser=e,this.name=Re.KHR_MATERIALS_IOR}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:Ht}extendMaterialParams(e,i){const s=this.parser.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const t=s.extensions[this.name];return i.ior=t.ior!==void 0?t.ior:1.5,Promise.resolve()}}class lc{constructor(e){this.parser=e,this.name=Re.KHR_MATERIALS_SPECULAR}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:Ht}extendMaterialParams(e,i){const a=this.parser,s=a.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const t=[],n=s.extensions[this.name];i.specularIntensity=n.specularFactor!==void 0?n.specularFactor:1,n.specularTexture!==void 0&&t.push(a.assignTexture(i,"specularIntensityMap",n.specularTexture));const r=n.specularColorFactor||[1,1,1];return i.specularColor=new he().setRGB(r[0],r[1],r[2],jt),n.specularColorTexture!==void 0&&t.push(a.assignTexture(i,"specularColorMap",n.specularColorTexture,cs)),Promise.all(t)}}class uc{constructor(e){this.parser=e,this.name=Re.EXT_MATERIALS_BUMP}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:Ht}extendMaterialParams(e,i){const a=this.parser,s=a.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const t=[],n=s.extensions[this.name];return i.bumpScale=n.bumpFactor!==void 0?n.bumpFactor:1,n.bumpTexture!==void 0&&t.push(a.assignTexture(i,"bumpMap",n.bumpTexture)),Promise.all(t)}}class hc{constructor(e){this.parser=e,this.name=Re.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const a=this.parser.json.materials[e];return!a.extensions||!a.extensions[this.name]?null:Ht}extendMaterialParams(e,i){const a=this.parser,s=a.json.materials[e];if(!s.extensions||!s.extensions[this.name])return Promise.resolve();const t=[],n=s.extensions[this.name];return n.anisotropyStrength!==void 0&&(i.anisotropy=n.anisotropyStrength),n.anisotropyRotation!==void 0&&(i.anisotropyRotation=n.anisotropyRotation),n.anisotropyTexture!==void 0&&t.push(a.assignTexture(i,"anisotropyMap",n.anisotropyTexture)),Promise.all(t)}}class dc{constructor(e){this.parser=e,this.name=Re.KHR_TEXTURE_BASISU}loadTexture(e){const i=this.parser,a=i.json,s=a.textures[e];if(!s.extensions||!s.extensions[this.name])return null;const t=s.extensions[this.name],n=i.options.ktx2Loader;if(!n){if(a.extensionsRequired&&a.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return i.loadTextureImage(e,t.source,n)}}class pc{constructor(e){this.parser=e,this.name=Re.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const i=this.name,a=this.parser,s=a.json,t=s.textures[e];if(!t.extensions||!t.extensions[i])return null;const n=t.extensions[i],r=s.images[n.source];let o=a.textureLoader;if(r.uri){const c=a.options.manager.getHandler(r.uri);c!==null&&(o=c)}return this.detectSupport().then(function(c){if(c)return a.loadTextureImage(e,n.source,o);if(s.extensionsRequired&&s.extensionsRequired.indexOf(i)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return a.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const i=new Image;i.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",i.onload=i.onerror=function(){e(i.height===1)}})),this.isSupported}}class fc{constructor(e){this.name=Re.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const i=this.parser.json,a=i.bufferViews[e];if(a.extensions&&a.extensions[this.name]){const s=a.extensions[this.name],t=this.parser.getDependency("buffer",s.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return t.then(function(r){const o=s.byteOffset||0,c=s.byteLength||0,l=s.count,u=s.byteStride,h=new Uint8Array(r,o,c);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(l,u,h,s.mode,s.filter).then(function(d){return d.buffer}):n.ready.then(function(){const d=new ArrayBuffer(l*u);return n.decodeGltfBuffer(new Uint8Array(d),l,u,h,s.mode,s.filter),d})})}else return null}}class mc{constructor(e){this.name=Re.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const i=this.parser.json,a=i.nodes[e];if(!a.extensions||!a.extensions[this.name]||a.mesh===void 0)return null;const s=i.meshes[a.mesh];for(const c of s.primitives)if(c.mode!==kt.TRIANGLES&&c.mode!==kt.TRIANGLE_STRIP&&c.mode!==kt.TRIANGLE_FAN&&c.mode!==void 0)return null;const n=a.extensions[this.name].attributes,r=[],o={};for(const c in n)r.push(this.parser.getDependency("accessor",n[c]).then(l=>(o[c]=l,o[c])));return r.length<1?null:(r.push(this.parser.createNodeMesh(e)),Promise.all(r).then(c=>{const l=c.pop(),u=l.isGroup?l.children:[l],h=c[0].count,d=[];for(const f of u){const g=new lt,m=new W,v=new Nt,w=new W(1,1,1),T=new Pi(f.geometry,f.material,h);for(let y=0;y<h;y++)o.TRANSLATION&&m.fromBufferAttribute(o.TRANSLATION,y),o.ROTATION&&v.fromBufferAttribute(o.ROTATION,y),o.SCALE&&w.fromBufferAttribute(o.SCALE,y),T.setMatrixAt(y,g.compose(m,v,w));for(const y in o)if(y==="_COLOR_0"){const S=o[y];T.instanceColor=new yn(S.array,S.itemSize,S.normalized)}else y!=="TRANSLATION"&&y!=="ROTATION"&&y!=="SCALE"&&f.geometry.setAttribute(y,o[y]);Xe.prototype.copy.call(T,f),this.parser.assignFinalMaterial(T),d.push(T)}return l.isGroup?(l.clear(),l.add(...d),l):d[0]}))}}const Zo="glTF",Vs=12,Qn={JSON:1313821514,BIN:5130562};class gc{constructor(e){this.name=Re.KHR_BINARY_GLTF,this.content=null,this.body=null;const i=new DataView(e,0,Vs),a=new TextDecoder;if(this.header={magic:a.decode(new Uint8Array(e.slice(0,4))),version:i.getUint32(4,!0),length:i.getUint32(8,!0)},this.header.magic!==Zo)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-Vs,t=new DataView(e,Vs);let n=0;for(;n<s;){const r=t.getUint32(n,!0);n+=4;const o=t.getUint32(n,!0);if(n+=4,o===Qn.JSON){const c=new Uint8Array(e,Vs+n,r);this.content=a.decode(c)}else if(o===Qn.BIN){const c=Vs+n;this.body=e.slice(c,c+r)}n+=r}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class yc{constructor(e,i){if(!i)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Re.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=i,this.dracoLoader.preload()}decodePrimitive(e,i){const a=this.json,s=this.dracoLoader,t=e.extensions[this.name].bufferView,n=e.extensions[this.name].attributes,r={},o={},c={};for(const l in n){const u=pn[l]||l.toLowerCase();r[u]=n[l]}for(const l in e.attributes){const u=pn[l]||l.toLowerCase();if(n[l]!==void 0){const h=a.accessors[e.attributes[l]],d=Fs[h.componentType];c[u]=d.name,o[u]=h.normalized===!0}}return i.getDependency("bufferView",t).then(function(l){return new Promise(function(u,h){s.decodeDracoFile(l,function(d){for(const f in d.attributes){const g=d.attributes[f],m=o[f];m!==void 0&&(g.normalized=m)}u(d)},r,c,jt,h)})})}}class vc{constructor(){this.name=Re.KHR_TEXTURE_TRANSFORM}extendTexture(e,i){return(i.texCoord===void 0||i.texCoord===e.channel)&&i.offset===void 0&&i.rotation===void 0&&i.scale===void 0||(e=e.clone(),i.texCoord!==void 0&&(e.channel=i.texCoord),i.offset!==void 0&&e.offset.fromArray(i.offset),i.rotation!==void 0&&(e.rotation=i.rotation),i.scale!==void 0&&e.repeat.fromArray(i.scale),e.needsUpdate=!0),e}}class xc{constructor(){this.name=Re.KHR_MESH_QUANTIZATION}}class Qo extends Cr{constructor(e,i,a,s){super(e,i,a,s)}copySampleValue_(e){const i=this.resultBuffer,a=this.sampleValues,s=this.valueSize,t=e*s*3+s;for(let n=0;n!==s;n++)i[n]=a[t+n];return i}interpolate_(e,i,a,s){const t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,o=r*2,c=r*3,l=s-i,u=(a-i)/l,h=u*u,d=h*u,f=e*c,g=f-c,m=-2*d+3*h,v=d-h,w=1-m,T=v-h+u;for(let y=0;y!==r;y++){const S=n[g+y+r],A=n[g+y+o]*l,P=n[f+y+r],k=n[f+y]*l;t[y]=w*S+T*A+m*P+v*k}return t}}const bc=new Nt;class wc extends Qo{interpolate_(e,i,a,s){const t=super.interpolate_(e,i,a,s);return bc.fromArray(t).normalize().toArray(t),t}}const kt={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Fs={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Jn={9728:is,9729:rn,9984:wr,9985:Sr,9986:Tr,9987:Ai},eo={33071:_r,33648:Pr,10497:pt},Gi={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},pn={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ts={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Sc={CUBICSPLINE:void 0,LINEAR:Mo,STEP:Ar},ji={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Tc(p){return p.DefaultMaterial===void 0&&(p.DefaultMaterial=new Po({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:gt})),p.DefaultMaterial}function ms(p,e,i){for(const a in i.extensions)p[a]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[a]=i.extensions[a])}function qt(p,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(p.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function _c(p,e,i){let a=!1,s=!1,t=!1;for(let c=0,l=e.length;c<l;c++){const u=e[c];if(u.POSITION!==void 0&&(a=!0),u.NORMAL!==void 0&&(s=!0),u.COLOR_0!==void 0&&(t=!0),a&&s&&t)break}if(!a&&!s&&!t)return Promise.resolve(p);const n=[],r=[],o=[];for(let c=0,l=e.length;c<l;c++){const u=e[c];if(a){const h=u.POSITION!==void 0?i.getDependency("accessor",u.POSITION):p.attributes.position;n.push(h)}if(s){const h=u.NORMAL!==void 0?i.getDependency("accessor",u.NORMAL):p.attributes.normal;r.push(h)}if(t){const h=u.COLOR_0!==void 0?i.getDependency("accessor",u.COLOR_0):p.attributes.color;o.push(h)}}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(o)]).then(function(c){const l=c[0],u=c[1],h=c[2];return a&&(p.morphAttributes.position=l),s&&(p.morphAttributes.normal=u),t&&(p.morphAttributes.color=h),p.morphTargetsRelative=!0,p})}function Pc(p,e){if(p.updateMorphTargets(),e.weights!==void 0)for(let i=0,a=e.weights.length;i<a;i++)p.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(p.morphTargetInfluences.length===i.length){p.morphTargetDictionary={};for(let a=0,s=i.length;a<s;a++)p.morphTargetDictionary[i[a]]=a}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Ac(p){let e;const i=p.extensions&&p.extensions[Re.KHR_DRACO_MESH_COMPRESSION];if(i?e="draco:"+i.bufferView+":"+i.indices+":"+Wi(i.attributes):e=p.indices+":"+Wi(p.attributes)+":"+p.mode,p.targets!==void 0)for(let a=0,s=p.targets.length;a<s;a++)e+=":"+Wi(p.targets[a]);return e}function Wi(p){let e="";const i=Object.keys(p).sort();for(let a=0,s=i.length;a<s;a++)e+=i[a]+":"+p[i[a]]+";";return e}function fn(p){switch(p){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Mc(p){return p.search(/\.jpe?g($|\?)/i)>0||p.search(/^data\:image\/jpeg/)===0?"image/jpeg":p.search(/\.webp($|\?)/i)>0||p.search(/^data\:image\/webp/)===0?"image/webp":p.search(/\.ktx2($|\?)/i)>0||p.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const Rc=new lt;class Cc{constructor(e={},i={}){this.json=e,this.extensions={},this.plugins={},this.options=i,this.cache=new Qa,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let a=!1,s=-1,t=!1,n=-1;if(typeof navigator<"u"){const r=navigator.userAgent;a=/^((?!chrome|android).)*safari/i.test(r)===!0;const o=r.match(/Version\/(\d+)/);s=a&&o?parseInt(o[1],10):-1,t=r.indexOf("Firefox")>-1,n=t?r.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||a&&s<17||t&&n<98?this.textureLoader=new So(this.options.manager):this.textureLoader=new To(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Hs(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,i){const a=this,s=this.json,t=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(n){return n._markDefs&&n._markDefs()}),Promise.all(this._invokeAll(function(n){return n.beforeRoot&&n.beforeRoot()})).then(function(){return Promise.all([a.getDependencies("scene"),a.getDependencies("animation"),a.getDependencies("camera")])}).then(function(n){const r={scene:n[0][s.scene||0],scenes:n[0],animations:n[1],cameras:n[2],asset:s.asset,parser:a,userData:{}};return ms(t,r,s),qt(r,s),Promise.all(a._invokeAll(function(o){return o.afterRoot&&o.afterRoot(r)})).then(function(){for(const o of r.scenes)o.updateMatrixWorld();e(r)})}).catch(i)}_markDefs(){const e=this.json.nodes||[],i=this.json.skins||[],a=this.json.meshes||[];for(let s=0,t=i.length;s<t;s++){const n=i[s].joints;for(let r=0,o=n.length;r<o;r++)e[n[r]].isBone=!0}for(let s=0,t=e.length;s<t;s++){const n=e[s];n.mesh!==void 0&&(this._addNodeRef(this.meshCache,n.mesh),n.skin!==void 0&&(a[n.mesh].isSkinnedMesh=!0)),n.camera!==void 0&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(e,i){i!==void 0&&(e.refs[i]===void 0&&(e.refs[i]=e.uses[i]=0),e.refs[i]++)}_getNodeRef(e,i,a){if(e.refs[i]<=1)return a;const s=a.clone(),t=(n,r)=>{const o=this.associations.get(n);o!=null&&this.associations.set(r,o);for(const[c,l]of n.children.entries())t(l,r.children[c])};return t(a,s),s.name+="_instance_"+e.uses[i]++,s}_invokeOne(e){const i=Object.values(this.plugins);i.push(this);for(let a=0;a<i.length;a++){const s=e(i[a]);if(s)return s}return null}_invokeAll(e){const i=Object.values(this.plugins);i.unshift(this);const a=[];for(let s=0;s<i.length;s++){const t=e(i[s]);t&&a.push(t)}return a}getDependency(e,i){const a=e+":"+i;let s=this.cache.get(a);if(!s){switch(e){case"scene":s=this.loadScene(i);break;case"node":s=this._invokeOne(function(t){return t.loadNode&&t.loadNode(i)});break;case"mesh":s=this._invokeOne(function(t){return t.loadMesh&&t.loadMesh(i)});break;case"accessor":s=this.loadAccessor(i);break;case"bufferView":s=this._invokeOne(function(t){return t.loadBufferView&&t.loadBufferView(i)});break;case"buffer":s=this.loadBuffer(i);break;case"material":s=this._invokeOne(function(t){return t.loadMaterial&&t.loadMaterial(i)});break;case"texture":s=this._invokeOne(function(t){return t.loadTexture&&t.loadTexture(i)});break;case"skin":s=this.loadSkin(i);break;case"animation":s=this._invokeOne(function(t){return t.loadAnimation&&t.loadAnimation(i)});break;case"camera":s=this.loadCamera(i);break;default:if(s=this._invokeOne(function(t){return t!=this&&t.getDependency&&t.getDependency(e,i)}),!s)throw new Error("Unknown type: "+e);break}this.cache.add(a,s)}return s}getDependencies(e){let i=this.cache.get(e);if(!i){const a=this,s=this.json[e+(e==="mesh"?"es":"s")]||[];i=Promise.all(s.map(function(t,n){return a.getDependency(e,n)})),this.cache.add(e,i)}return i}loadBuffer(e){const i=this.json.buffers[e],a=this.fileLoader;if(i.type&&i.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+i.type+" buffer type is not supported.");if(i.uri===void 0&&e===0)return Promise.resolve(this.extensions[Re.KHR_BINARY_GLTF].body);const s=this.options;return new Promise(function(t,n){a.load(js.resolveURL(i.uri,s.path),t,void 0,function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+i.uri+'".'))})})}loadBufferView(e){const i=this.json.bufferViews[e];return this.getDependency("buffer",i.buffer).then(function(a){const s=i.byteLength||0,t=i.byteOffset||0;return a.slice(t,t+s)})}loadAccessor(e){const i=this,a=this.json,s=this.json.accessors[e];if(s.bufferView===void 0&&s.sparse===void 0){const n=Gi[s.type],r=Fs[s.componentType],o=s.normalized===!0,c=new r(s.count*n);return Promise.resolve(new $t(c,n,o))}const t=[];return s.bufferView!==void 0?t.push(this.getDependency("bufferView",s.bufferView)):t.push(null),s.sparse!==void 0&&(t.push(this.getDependency("bufferView",s.sparse.indices.bufferView)),t.push(this.getDependency("bufferView",s.sparse.values.bufferView))),Promise.all(t).then(function(n){const r=n[0],o=Gi[s.type],c=Fs[s.componentType],l=c.BYTES_PER_ELEMENT,u=l*o,h=s.byteOffset||0,d=s.bufferView!==void 0?a.bufferViews[s.bufferView].byteStride:void 0,f=s.normalized===!0;let g,m;if(d&&d!==u){const v=Math.floor(h/d),w="InterleavedBuffer:"+s.bufferView+":"+s.componentType+":"+v+":"+s.count;let T=i.cache.get(w);T||(g=new c(r,v*d,s.count*d/l),T=new _o(g,d/l),i.cache.add(w,T)),m=new cn(T,o,h%d/l,f)}else r===null?g=new c(s.count*o):g=new c(r,h,s.count*o),m=new $t(g,o,f);if(s.sparse!==void 0){const v=Gi.SCALAR,w=Fs[s.sparse.indices.componentType],T=s.sparse.indices.byteOffset||0,y=s.sparse.values.byteOffset||0,S=new w(n[1],T,s.sparse.count*v),A=new c(n[2],y,s.sparse.count*o);r!==null&&(m=new $t(m.array.slice(),m.itemSize,m.normalized)),m.normalized=!1;for(let P=0,k=S.length;P<k;P++){const C=S[P];if(m.setX(C,A[P*o]),o>=2&&m.setY(C,A[P*o+1]),o>=3&&m.setZ(C,A[P*o+2]),o>=4&&m.setW(C,A[P*o+3]),o>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}m.normalized=f}return m})}loadTexture(e){const i=this.json,a=this.options,t=i.textures[e].source,n=i.images[t];let r=this.textureLoader;if(n.uri){const o=a.manager.getHandler(n.uri);o!==null&&(r=o)}return this.loadTextureImage(e,t,r)}loadTextureImage(e,i,a){const s=this,t=this.json,n=t.textures[e],r=t.images[i],o=(r.uri||r.bufferView)+":"+n.sampler;if(this.textureCache[o])return this.textureCache[o];const c=this.loadImageSource(i,a).then(function(l){l.flipY=!1,l.name=n.name||r.name||"",l.name===""&&typeof r.uri=="string"&&r.uri.startsWith("data:image/")===!1&&(l.name=r.uri);const h=(t.samplers||{})[n.sampler]||{};return l.magFilter=Jn[h.magFilter]||rn,l.minFilter=Jn[h.minFilter]||Ai,l.wrapS=eo[h.wrapS]||pt,l.wrapT=eo[h.wrapT]||pt,l.generateMipmaps=!l.isCompressedTexture&&l.minFilter!==is&&l.minFilter!==rn,s.associations.set(l,{textures:e}),l}).catch(function(){return null});return this.textureCache[o]=c,c}loadImageSource(e,i){const a=this,s=this.json,t=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const n=s.images[e],r=self.URL||self.webkitURL;let o=n.uri||"",c=!1;if(n.bufferView!==void 0)o=a.getDependency("bufferView",n.bufferView).then(function(u){c=!0;const h=new Blob([u],{type:n.mimeType});return o=r.createObjectURL(h),o});else if(n.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const l=Promise.resolve(o).then(function(u){return new Promise(function(h,d){let f=h;i.isImageBitmapLoader===!0&&(f=function(g){const m=new ln(g);m.needsUpdate=!0,h(m)}),i.load(js.resolveURL(u,t.path),f,void 0,d)})}).then(function(u){return c===!0&&r.revokeObjectURL(o),qt(u,n),u.userData.mimeType=n.mimeType||Mc(n.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),u});return this.sourceCache[e]=l,l}assignTexture(e,i,a,s){const t=this;return this.getDependency("texture",a.index).then(function(n){if(!n)return null;if(a.texCoord!==void 0&&a.texCoord>0&&(n=n.clone(),n.channel=a.texCoord),t.extensions[Re.KHR_TEXTURE_TRANSFORM]){const r=a.extensions!==void 0?a.extensions[Re.KHR_TEXTURE_TRANSFORM]:void 0;if(r){const o=t.associations.get(n);n=t.extensions[Re.KHR_TEXTURE_TRANSFORM].extendTexture(n,r),t.associations.set(n,o)}}return s!==void 0&&(n.colorSpace=s),e[i]=n,n})}assignFinalMaterial(e){const i=e.geometry;let a=e.material;const s=i.attributes.tangent===void 0,t=i.attributes.color!==void 0,n=i.attributes.normal===void 0;if(e.isPoints){const r="PointsMaterial:"+a.uuid;let o=this.cache.get(r);o||(o=new hr,Fi.prototype.copy.call(o,a),o.color.copy(a.color),o.map=a.map,o.sizeAttenuation=!1,this.cache.add(r,o)),a=o}else if(e.isLine){const r="LineBasicMaterial:"+a.uuid;let o=this.cache.get(r);o||(o=new dr,Fi.prototype.copy.call(o,a),o.color.copy(a.color),o.map=a.map,this.cache.add(r,o)),a=o}if(s||t||n){let r="ClonedMaterial:"+a.uuid+":";s&&(r+="derivative-tangents:"),t&&(r+="vertex-colors:"),n&&(r+="flat-shading:");let o=this.cache.get(r);o||(o=a.clone(),t&&(o.vertexColors=!0),n&&(o.flatShading=!0),s&&(o.normalScale&&(o.normalScale.y*=-1),o.clearcoatNormalScale&&(o.clearcoatNormalScale.y*=-1)),this.cache.add(r,o),this.associations.set(o,this.associations.get(a))),a=o}e.material=a}getMaterialType(){return Po}loadMaterial(e){const i=this,a=this.json,s=this.extensions,t=a.materials[e];let n;const r={},o=t.extensions||{},c=[];if(o[Re.KHR_MATERIALS_UNLIT]){const u=s[Re.KHR_MATERIALS_UNLIT];n=u.getMaterialType(),c.push(u.extendParams(r,t,i))}else{const u=t.pbrMetallicRoughness||{};if(r.color=new he(1,1,1),r.opacity=1,Array.isArray(u.baseColorFactor)){const h=u.baseColorFactor;r.color.setRGB(h[0],h[1],h[2],jt),r.opacity=h[3]}u.baseColorTexture!==void 0&&c.push(i.assignTexture(r,"map",u.baseColorTexture,cs)),r.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,r.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(c.push(i.assignTexture(r,"metalnessMap",u.metallicRoughnessTexture)),c.push(i.assignTexture(r,"roughnessMap",u.metallicRoughnessTexture))),n=this._invokeOne(function(h){return h.getMaterialType&&h.getMaterialType(e)}),c.push(Promise.all(this._invokeAll(function(h){return h.extendMaterialParams&&h.extendMaterialParams(e,r)})))}t.doubleSided===!0&&(r.side=Yt);const l=t.alphaMode||ji.OPAQUE;if(l===ji.BLEND?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,l===ji.MASK&&(r.alphaTest=t.alphaCutoff!==void 0?t.alphaCutoff:.5)),t.normalTexture!==void 0&&n!==vs&&(c.push(i.assignTexture(r,"normalMap",t.normalTexture)),r.normalScale=new Ce(1,1),t.normalTexture.scale!==void 0)){const u=t.normalTexture.scale;r.normalScale.set(u,u)}if(t.occlusionTexture!==void 0&&n!==vs&&(c.push(i.assignTexture(r,"aoMap",t.occlusionTexture)),t.occlusionTexture.strength!==void 0&&(r.aoMapIntensity=t.occlusionTexture.strength)),t.emissiveFactor!==void 0&&n!==vs){const u=t.emissiveFactor;r.emissive=new he().setRGB(u[0],u[1],u[2],jt)}return t.emissiveTexture!==void 0&&n!==vs&&c.push(i.assignTexture(r,"emissiveMap",t.emissiveTexture,cs)),Promise.all(c).then(function(){const u=new n(r);return t.name&&(u.name=t.name),qt(u,t),i.associations.set(u,{materials:e}),t.extensions&&ms(s,u,t),u})}createUniqueName(e){const i=pr.sanitizeNodeName(e||"");return i in this.nodeNamesUsed?i+"_"+ ++this.nodeNamesUsed[i]:(this.nodeNamesUsed[i]=0,i)}loadGeometries(e){const i=this,a=this.extensions,s=this.primitiveCache;function t(r){return a[Re.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(r,i).then(function(o){return to(o,r,i)})}const n=[];for(let r=0,o=e.length;r<o;r++){const c=e[r],l=Ac(c),u=s[l];if(u)n.push(u.promise);else{let h;c.extensions&&c.extensions[Re.KHR_DRACO_MESH_COMPRESSION]?h=t(c):h=to(new Ts,c,i),s[l]={primitive:c,promise:h},n.push(h)}}return Promise.all(n)}loadMesh(e){const i=this,a=this.json,s=this.extensions,t=a.meshes[e],n=t.primitives,r=[];for(let o=0,c=n.length;o<c;o++){const l=n[o].material===void 0?Tc(this.cache):this.getDependency("material",n[o].material);r.push(l)}return r.push(i.loadGeometries(n)),Promise.all(r).then(function(o){const c=o.slice(0,o.length-1),l=o[o.length-1],u=[];for(let d=0,f=l.length;d<f;d++){const g=l[d],m=n[d];let v;const w=c[d];if(m.mode===kt.TRIANGLES||m.mode===kt.TRIANGLE_STRIP||m.mode===kt.TRIANGLE_FAN||m.mode===void 0)v=t.isSkinnedMesh===!0?new vn(g,w):new Ct(g,w),v.isSkinnedMesh===!0&&v.normalizeSkinWeights(),m.mode===kt.TRIANGLE_STRIP?v.geometry=Rn(v.geometry,Mr):m.mode===kt.TRIANGLE_FAN&&(v.geometry=Rn(v.geometry,Rr));else if(m.mode===kt.LINES)v=new fr(g,w);else if(m.mode===kt.LINE_STRIP)v=new mr(g,w);else if(m.mode===kt.LINE_LOOP)v=new gr(g,w);else if(m.mode===kt.POINTS)v=new yr(g,w);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);Object.keys(v.geometry.morphAttributes).length>0&&Pc(v,t),v.name=i.createUniqueName(t.name||"mesh_"+e),qt(v,t),m.extensions&&ms(s,v,m),i.assignFinalMaterial(v),u.push(v)}for(let d=0,f=u.length;d<f;d++)i.associations.set(u[d],{meshes:e,primitives:d});if(u.length===1)return t.extensions&&ms(s,u[0],t),u[0];const h=new Kt;t.extensions&&ms(s,h,t),i.associations.set(h,{meshes:e});for(let d=0,f=u.length;d<f;d++)h.add(u[d]);return h})}loadCamera(e){let i;const a=this.json.cameras[e],s=a[a.type];if(!s){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return a.type==="perspective"?i=new _i(te.radToDeg(s.yfov),s.aspectRatio||1,s.znear||1,s.zfar||2e6):a.type==="orthographic"&&(i=new Ao(-s.xmag,s.xmag,s.ymag,-s.ymag,s.znear,s.zfar)),a.name&&(i.name=this.createUniqueName(a.name)),qt(i,a),Promise.resolve(i)}loadSkin(e){const i=this.json.skins[e],a=[];for(let s=0,t=i.joints.length;s<t;s++)a.push(this._loadNodeShallow(i.joints[s]));return i.inverseBindMatrices!==void 0?a.push(this.getDependency("accessor",i.inverseBindMatrices)):a.push(null),Promise.all(a).then(function(s){const t=s.pop(),n=s,r=[],o=[];for(let c=0,l=n.length;c<l;c++){const u=n[c];if(u){r.push(u);const h=new lt;t!==null&&h.fromArray(t.array,c*16),o.push(h)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',i.joints[c])}return new vr(r,o)})}loadAnimation(e){const i=this.json,a=this,s=i.animations[e],t=s.name?s.name:"animation_"+e,n=[],r=[],o=[],c=[],l=[];for(let u=0,h=s.channels.length;u<h;u++){const d=s.channels[u],f=s.samplers[d.sampler],g=d.target,m=g.node,v=s.parameters!==void 0?s.parameters[f.input]:f.input,w=s.parameters!==void 0?s.parameters[f.output]:f.output;g.node!==void 0&&(n.push(this.getDependency("node",m)),r.push(this.getDependency("accessor",v)),o.push(this.getDependency("accessor",w)),c.push(f),l.push(g))}return Promise.all([Promise.all(n),Promise.all(r),Promise.all(o),Promise.all(c),Promise.all(l)]).then(function(u){const h=u[0],d=u[1],f=u[2],g=u[3],m=u[4],v=[];for(let w=0,T=h.length;w<T;w++){const y=h[w],S=d[w],A=f[w],P=g[w],k=m[w];if(y===void 0)continue;y.updateMatrix&&y.updateMatrix();const C=a._createAnimationTracks(y,S,A,P,k);if(C)for(let M=0;M<C.length;M++)v.push(C[M])}return new xr(t,void 0,v)})}createNodeMesh(e){const i=this.json,a=this,s=i.nodes[e];return s.mesh===void 0?null:a.getDependency("mesh",s.mesh).then(function(t){const n=a._getNodeRef(a.meshCache,s.mesh,t);return s.weights!==void 0&&n.traverse(function(r){if(r.isMesh)for(let o=0,c=s.weights.length;o<c;o++)r.morphTargetInfluences[o]=s.weights[o]}),n})}loadNode(e){const i=this.json,a=this,s=i.nodes[e],t=a._loadNodeShallow(e),n=[],r=s.children||[];for(let c=0,l=r.length;c<l;c++)n.push(a.getDependency("node",r[c]));const o=s.skin===void 0?Promise.resolve(null):a.getDependency("skin",s.skin);return Promise.all([t,Promise.all(n),o]).then(function(c){const l=c[0],u=c[1],h=c[2];h!==null&&l.traverse(function(d){d.isSkinnedMesh&&d.bind(h,Rc)});for(let d=0,f=u.length;d<f;d++)l.add(u[d]);return l})}_loadNodeShallow(e){const i=this.json,a=this.extensions,s=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const t=i.nodes[e],n=t.name?s.createUniqueName(t.name):"",r=[],o=s._invokeOne(function(c){return c.createNodeMesh&&c.createNodeMesh(e)});return o&&r.push(o),t.camera!==void 0&&r.push(s.getDependency("camera",t.camera).then(function(c){return s._getNodeRef(s.cameraCache,t.camera,c)})),s._invokeAll(function(c){return c.createNodeAttachment&&c.createNodeAttachment(e)}).forEach(function(c){r.push(c)}),this.nodeCache[e]=Promise.all(r).then(function(c){let l;if(t.isBone===!0?l=new br:c.length>1?l=new Kt:c.length===1?l=c[0]:l=new Xe,l!==c[0])for(let u=0,h=c.length;u<h;u++)l.add(c[u]);if(t.name&&(l.userData.name=t.name,l.name=n),qt(l,t),t.extensions&&ms(a,l,t),t.matrix!==void 0){const u=new lt;u.fromArray(t.matrix),l.applyMatrix4(u)}else t.translation!==void 0&&l.position.fromArray(t.translation),t.rotation!==void 0&&l.quaternion.fromArray(t.rotation),t.scale!==void 0&&l.scale.fromArray(t.scale);return s.associations.has(l)||s.associations.set(l,{}),s.associations.get(l).nodes=e,l}),this.nodeCache[e]}loadScene(e){const i=this.extensions,a=this.json.scenes[e],s=this,t=new Kt;a.name&&(t.name=s.createUniqueName(a.name)),qt(t,a),a.extensions&&ms(i,t,a);const n=a.nodes||[],r=[];for(let o=0,c=n.length;o<c;o++)r.push(s.getDependency("node",n[o]));return Promise.all(r).then(function(o){for(let l=0,u=o.length;l<u;l++)t.add(o[l]);const c=l=>{const u=new Map;for(const[h,d]of s.associations)(h instanceof Fi||h instanceof ln)&&u.set(h,d);return l.traverse(h=>{const d=s.associations.get(h);d!=null&&u.set(h,d)}),u};return s.associations=c(t),t})}_createAnimationTracks(e,i,a,s,t){const n=[],r=e.name?e.name:e.uuid,o=[];ts[t.path]===ts.weights?e.traverse(function(h){h.morphTargetInfluences&&o.push(h.name?h.name:h.uuid)}):o.push(r);let c;switch(ts[t.path]){case ts.weights:c=In;break;case ts.rotation:c=Fn;break;case ts.position:case ts.scale:c=Cn;break;default:switch(a.itemSize){case 1:c=In;break;case 2:case 3:default:c=Cn;break}break}const l=s.interpolation!==void 0?Sc[s.interpolation]:Mo,u=this._getArrayFromAccessor(a);for(let h=0,d=o.length;h<d;h++){const f=new c(o[h]+"."+ts[t.path],i.array,u,l);s.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(f),n.push(f)}return n}_getArrayFromAccessor(e){let i=e.array;if(e.normalized){const a=fn(i.constructor),s=new Float32Array(i.length);for(let t=0,n=i.length;t<n;t++)s[t]=i[t]*a;i=s}return i}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(a){const s=this instanceof Fn?wc:Qo;return new s(this.times,this.values,this.getValueSize()/3,a)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function Ic(p,e,i){const a=e.attributes,s=new Cs;if(a.POSITION!==void 0){const r=i.json.accessors[a.POSITION],o=r.min,c=r.max;if(o!==void 0&&c!==void 0){if(s.set(new W(o[0],o[1],o[2]),new W(c[0],c[1],c[2])),r.normalized){const l=fn(Fs[r.componentType]);s.min.multiplyScalar(l),s.max.multiplyScalar(l)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const t=e.targets;if(t!==void 0){const r=new W,o=new W;for(let c=0,l=t.length;c<l;c++){const u=t[c];if(u.POSITION!==void 0){const h=i.json.accessors[u.POSITION],d=h.min,f=h.max;if(d!==void 0&&f!==void 0){if(o.setX(Math.max(Math.abs(d[0]),Math.abs(f[0]))),o.setY(Math.max(Math.abs(d[1]),Math.abs(f[1]))),o.setZ(Math.max(Math.abs(d[2]),Math.abs(f[2]))),h.normalized){const g=fn(Fs[h.componentType]);o.multiplyScalar(g)}r.max(o)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(r)}p.boundingBox=s;const n=new as;s.getCenter(n.center),n.radius=s.min.distanceTo(s.max)/2,p.boundingSphere=n}function to(p,e,i){const a=e.attributes,s=[];function t(n,r){return i.getDependency("accessor",n).then(function(o){p.setAttribute(r,o)})}for(const n in a){const r=pn[n]||n.toLowerCase();r in p.attributes||s.push(t(a[n],r))}if(e.indices!==void 0&&!p.index){const n=i.getDependency("accessor",e.indices).then(function(r){p.setIndex(r)});s.push(n)}return an.workingColorSpace!==jt&&"COLOR_0"in a&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${an.workingColorSpace}" not supported.`),qt(p,e),Ic(p,e,i),Promise.all(s).then(function(){return e.targets!==void 0?_c(p,e.targets,i):p})}const Fc="/",ve="/cdn.utsubo.io/v2/",kc=[{name:"cheetah",url:`${ve}glb/cheetah_minimal.glb`,fileSize:4776632},{name:"furnormal",url:`${ve}img/furnormal.ktx2`,fileSize:334080},{name:"cheetah_normal",url:`${ve}img/cheetah_normal.ktx2`,fileSize:3405705},{name:"ppmori",url:`${Fc}fonts/PPMori-Medium.woff`,fileSize:46360,isFont:!0},{name:"concrete",url:`${ve}img/concrete.ktx2`,fileSize:4845688},{name:"paw_smoke_desktop",url:`${ve}ktx2/paw_smoke.ktx2`,fileSize:4672344},{name:"moon_smoke_front_texture_desktop",url:`${ve}ktx2/smoke_front_alpha.ktx2`,fileSize:3088311},{name:"moon_smoke_back_texture_desktop",url:`${ve}ktx2/smoke_back_alpha.ktx2`,fileSize:4268487},{name:"grain",url:`${ve}img/grain.ktx2`,fileSize:81859},{name:"water_normals",url:`${ve}img/waternormals.ktx2`,fileSize:613710},{name:"fractal",url:`${ve}img/fractal.ktx2`,fileSize:90372},{name:"fur_length",url:`${ve}img/fur_length.ktx2`,fileSize:406247},{name:"hdr",url:`${ve}hdr/royal_esplanade_1k.hdr`,fileSize:1667276},{name:"moon_xs",url:`${ve}glb/moon_xs.glb`,fileSize:1421196},{name:"moon_md",url:`${ve}glb/moon_md.glb`,fileSize:1361708},{name:"moon_xl",url:`${ve}glb/moon_xl.glb`,fileSize:658776},{name:"paw_smoke_scene_desktop",url:`${ve}glb/paw_surface/paw_smoke.glb`,fileSize:3544},{name:"logo",url:`${ve}glb/logo.glb`,fileSize:15048},{name:"cheetah_fin_alpha",url:`${ve}img/cheetah_fin_alpha.ktx2`,fileSize:350064},{name:"moonscape_albedo",url:`${ve}img/moonscape_albedo.ktx2`,fileSize:636446},{name:"fur_leg_length",url:`${ve}img/fur_leg_length.ktx2`,fileSize:1398656},{name:"floor_normal",url:`${ve}img/floor_normal.ktx2`,fileSize:1096281},{name:"floor_albedo",url:`${ve}img/floor_albedo.ktx2`,fileSize:183553},{name:"cheetah_albedo",url:`${ve}img/cheetah_albedo.ktx2`,fileSize:2297613},{name:"cheetah_rough",url:`${ve}img/cheetah_rough.ktx2`,fileSize:10640},{name:"surface_albedo",url:`${ve}img/surface_albedo.ktx2`,fileSize:591160},{name:"paw",url:`${ve}glb/paw.glb`,fileSize:2775772},{name:"paw_rock",url:`${ve}glb/paw_surface/paw_rock_opti.glb`,fileSize:21984},{name:"paw_surface",url:`${ve}glb/paw_surface.glb`,fileSize:1761532},{name:"paw_surface_big",url:`${ve}glb/paw_surface/surface_opti_big.glb`,fileSize:382432},{name:"paw_surface_small",url:`${ve}glb/paw_surface/paw_rock_small.glb`,fileSize:141748},{name:"paw_surface_shockwave",url:`${ve}glb/paw_surface/paw_shockwave.glb`,fileSize:58748},{name:"paw_surface_xl_bake_60",url:`${ve}exr/paw_surface_xl_bake_60.exr`,fileSize:96639},{name:"bake_moon_surface_big",url:`${ve}exr/surface_anim_big_bake.exr`,fileSize:51512},{name:"bake_moon_surface_small",url:`${ve}exr/surface_anim_small_bake.exr`,fileSize:796294},{name:"surface_xs_bake",url:`${ve}exr/surface_xs_bake_120.exr`,fileSize:2433419},{name:"surface_md_bake",url:`${ve}exr/surface_md_bake_120.exr`,fileSize:465698},{name:"surface_xl_bake",url:`${ve}exr/surface_xl_bake_120.exr`,fileSize:66619},{name:"bake_surfacegate_loop",url:`${ve}exr/surface_loopgate_bake.exr`,fileSize:149218},{name:"temple_moon",url:`${ve}glb/temple_draco.glb`,fileSize:1228972},{name:"temple_portal",url:`${ve}glb/temple_portal_draco.glb`,fileSize:2949928}];let bs;const mn=typeof window>"u";mn?(bs=new To,bs.setOptions({imageOrientation:"flipY"})):bs=new So;function so(p){const e=new ln(p);return e.needsUpdate=!0,e.flipY=!0,e.colorSpace=cs,e}const Jo=new Ir;Jo.setDecoderPath("/draco/");const Qs=new Za;Qs.setDRACOLoader(Jo);Qs.setMeshoptDecoder(Fr);const Hi=new Ro().setTranscoderPath("/basis/"),Ec={".png":bs,".jpg":bs,".jpeg":bs,".webp":bs,".glb":Qs,".gltf":Qs,".hdr":Er,".bin":Hs,".exr":Nr,".ktx2":Ro},io="_desktop",no="_mobile";class Nc{constructor(){}initResources(){const{isIOS:e,isSafari:i,isMobileOrTablet:a}=se(),s=e;this.deviceSpecificResources=s?no:io,this.doNotSupportOpusFiles=s||i,this.shouldLoadFontFile=!a,this.resources={},this.totalImagesForCubeTexture=6,this.defaultFileSize=1024,this.totalBytes=0,this.loadedBytes=0,this.currentProgress=0;for(const t of kc){const n=this.formatResourcesForLoader(t);n&&(this.resources[t.name]=n,this.totalBytes+=this.resources[t.name].total)}}formatResourcesForLoader(e){const i=this.filterDeviceSpecificResources(this.filterAudioResources(e));return!i||!this.shouldLoadFontFile&&i.isFont?null:{name:i.name,url:i.url,asset:null,loaded:0,total:i.fileSize,isCubeTexture:Array.isArray(i.url),cubeTextureProgress:Array.isArray(i.url)?Array(this.totalImagesForCubeTexture).fill(0):null,loading:{promise:null,resolve:null,reject:null}}}filterDeviceSpecificResources(e){if(!e)return!1;const i=e.name,a=i.endsWith(io),s=i.endsWith(no);return i.includes(this.deviceSpecificResources)?(e.name=i.replace(this.deviceSpecificResources,""),e):a||s?!1:e}filterAudioResources(e){const i=e.url.includes(".mp3"),a=e.url.includes(".opus");if(!i&&!a)return e;if(a&&this.doNotSupportOpusFiles||i&&!this.doNotSupportOpusFiles)return!1;const s=e.name.replace(a?"_opus":"_mp3","");return this.resources[s]?!1:(e.name=s,e)}load(){this.initResources(),De.trigger({name:"loadStart"});const e=Object.values(this.resources).map(i=>(i.loading.promise=new Promise((a,s)=>{i.loading.resolve=a,i.loading.reject=s}),this.loadResource(i)));return Promise.allSettled(e).then(i=>{this.finish(i)})}loadResource(e){return new Promise(async(i,a)=>{if(Array.isArray(e.url)){const r=e.url.map((o,c)=>this.fetchImage(o,e.name,c));Promise.all(r).then(o=>{const c=mn?o.map(u=>so(u)):o,l=new kr(c);l.needsUpdate=!0,this.resources[e.name].asset=l,this.resources[e.name].loading.resolve(l),i(l)}).catch(a);return}const s=e.url.substring(e.url.lastIndexOf("."));let t=Ec[s]||Hs;s===".json"&&(t=new Hs,t.setResponseType("json")),typeof t=="function"&&(t=new t);const n=[".png",".jpg",".jpeg",".webp"].includes(s);if(mn&&n){t.load(e.url,r=>{const o=so(r);this.resources[e.name].asset=o,this.resources[e.name].loading.resolve(o),i(o)},r=>{this.onProgress(e.name,r)},a);return}if(s===".glb"){const{gl:r}=se();Hi.detectSupportAsync(r).then(()=>{Qs.setKTX2Loader(Hi),t.load(e.url,o=>{const c=o;this.resources[e.name].asset=c,this.resources[e.name].loading.resolve(c),i(c)},o=>{this.onProgress(e.name,o)},o=>{console.error("Error loading asset:",o),a(o)})});return}if(s===".bin"&&t.setResponseType("arraybuffer"),s===".ktx2"){const{gl:r}=se();t=Hi,await t.detectSupportAsync(r)}t.load(e.url,r=>{const o=r;this.resources[e.name].asset=o,this.resources[e.name].loading.resolve(o),i(o)},r=>{this.onProgress(e.name,r)},r=>{console.error("Error loading asset:",r),a(r)})})}async fetchImage(e,i,a){try{const s=await fetch(e),t=s.headers.get("Content-Length"),n=t?Number.parseInt(t,10):this.defaultFileSize;this.resources[i].cubeTextureProgress[a]=n,this.updateResourceTotal(i);const r=await s.blob(),o=await createImageBitmap(r);return this.resources[i].loaded+=this.resources[i].cubeTextureProgress[a],this.updateOverallProgress(),o}catch(s){throw this.resources[i].reject(s),s}}updateResourceTotal(e){const i=this.resources[e];i.isCubeTexture&&(i.total=i.cubeTextureProgress.reduce((a,s)=>a+s,0),this.totalBytes=Object.values(this.resources).reduce((a,s)=>a+s.total,0))}onCubeTextureProgress(e,i,a,s){const t=this.resources[e];if(t.isCubeTexture){let n;a.headers.get("Content-Length")?n=parseInt(a.headers.get("Content-Length"),10):n=this.defaultFileSize,t.cubeTextureProgress[i]=n,t.total===0&&(t.total=t.cubeTextureProgress.reduce((r,o)=>r+o,0)),t.loaded+=n,this.updateOverallProgress()}}onProgress(e,i){const a=this.resources[e];i.lengthComputable?(a.loaded=i.loaded,a.total=i.total):(a.total=1024,a.loaded=1024),this.updateOverallProgress()}updateOverallProgress(){const e=Object.values(this.resources).reduce((s,t)=>s+t.total,0),i=Object.values(this.resources).reduce((s,t)=>s+t.loaded,0),a=Math.round(e>0?i/e*100:0);this.currentProgress!==a&&(this.currentProgress=a,De.trigger({name:"loadProgress"},{progress:a}))}finish(e){De.trigger({name:"loadEnd",fireAtStart:!0},{})}}var ce=new Nc;class Lc extends ze(Xe,{raf:{renderPriority:1,fps:1/0}}){async init(){this.fogSettings={section1:{color1:new he(995912),color2:new he(515),density:.019},section2:{color1:new he(268066),color2:new he(68111),density:.029},section3:{color1:new he(5723991),color2:new he(16777215),density:.22,instant:!0},section4:{color1:new he(2697513),color2:new he(4463113),fromDensity:.13,defaultDensity:.028,density:.022},section5:{color1:new he(995912),color2:new he(0),density:.02,instant:!0},subpage:{color1:new he(995912),color2:new he(0),instant:!0,density:.024}},this.sphere=new Ct(new Co(1,32,32),new wt({color:16777215,reflectivity:0,side:xn,depthWrite:!1,transparent:!1,depthTest:!1,fog:!1})),this.isDebugging=!1,this.sphere.renderOrder=-9999,this.sphere.frustumCulled=!1,this.color1=O(this.fogSettings.section1.color1.clone()),this.color2=O(this.fogSettings.section1.color2.clone()),this.noiseScale=O(.8),this.noiseSpeed=O(.2);const i=bn(Ze.mul(this.noiseScale).add(Ls.mul(this.noiseSpeed)),1).saturate().mix(this.color1,this.color2).mul(x.sections.fourthProgress.smoothstep(x.fourthAnimBreakPointStart,x.fourthAnimBreakPointEnd).sub(x.sections.fiveProgress.smoothstep(0,.4)).oneMinus());this.sphere.material.colorNode=i,this.sphere.scale.setScalar(bt.far/2),this.fogDensity=O(.164),x.fogOutputColor=i,Qe.backgroundNode=i,Qe.fogNode=Io(i,this.fogDensity),Qe.add(this)}onDebug({gui:e}){this.folder=e.addFolder("Background"),this.folder.close(),this.folder.add(this,"isDebugging",!1).name("Manual Control"),this.folder.addColor(this.color1,"value").name("color 1").onChange(()=>{this.color1.value.convertSRGBToLinear()}),this.folder.addColor(this.color2,"value").name("color 2").onChange(()=>{this.color2.value.convertSRGBToLinear()}),this.folder.add(this.noiseScale,"value",0,10).name("noise scale"),this.folder.add(this.noiseSpeed,"value",0,2).name("noise speed"),this.folder.add(this.fogDensity,"value",0,1).name("fog density")}getColorValuesForSection(e){return this.fogSettings[e]}instantChange({color1:e,color2:i,density:a}){this.color1.value.copy(e),this.color2.value.copy(i),this.fogDensity.value=a}onRaf({camera:e,elapsedTime:i,delta:a}){const{inSubpage:s,sections:t}=x;this.sphere.scale.setScalar(e.far/2);const n=s?"subpage":t.current,r=this.getColorValuesForSection(n);if(this.currentSection=n,!this.isDebugging){if(r.instant)this.instantChange(r);else if(this.currentSection==="section4"){const o=t.fourthProgress.value,{fourthAnimBreakPointStart:c,fourthAnimBreakPointEnd:l}=x,u=se().slowMoLerp.value,h=ot(c+.05,l,o)*.13,d=Math.max(0,r.fromDensity*(1-o*4)),f=r.defaultDensity+(d+h)*u;this.fogDensity.value=te.damp(this.fogDensity.value,f,3+h>0?30:0,a),this.previousSection!=="section4"&&this.instantChange(r)}else if(this.currentSection==="section2"||this.currentSection==="section1"){this.previousSection==="section3"&&this.instantChange(r);const o=t.oneProgress.value,c=t.twoIntroProgress.value,l=Math.max(0,-.2+o*1.2)-Math.max(0,Math.min(1,-.3+c*2)),u=n==="section1"?3:.1;this.color1.value.lerp(r.color1,a*u),this.color2.value.lerp(r.color2,a*u);const h=r.density+l;this.fogDensity.value=te.damp(this.fogDensity.value,h,.8+l*30+c*10,a)}this.previousSection=this.currentSection}}onResize(){}dispose(){super.dispose()}}class Dc extends Js{static get type(){return"ColorAdjustementNode"}constructor(e,i){super("vec4"),this.inputNode=e,this.cdlSettings=i}setup(){const e=this.inputNode,i=$(([n,r=_(1)])=>{const o=Dr(n.rgb);return Pe(o,n.rgb,r)}),a=$(([n,r=_(1)])=>{const o=Xs(n.r,n.g,n.b).div(3),u=n.r.max(n.g.max(n.b)).sub(o).oneMinus().mul(r);return Pe(n.rgb,i([n.rgb,_(2)]),u)});return $(()=>{const n=this.inputNode.toVar();return n.assign(H(ki(n.r,this.cdlSettings.contrastAmount,this.cdlSettings.contrastPivot),ki(n.g,this.cdlSettings.contrastAmount,this.cdlSettings.contrastPivot),ki(n.b,this.cdlSettings.contrastAmount,this.cdlSettings.contrastPivot))),n.assign(Lr(n,this.cdlSettings.hue)),n.assign(i(n,this.cdlSettings.saturation)),n.assign(a(n,this.cdlSettings.vibrance)),n})(e)}}const zc=(p,e)=>ls(new Dc(ls(p),e));class Xi{constructor(e,i,a,s){this.a=new Ss(e,i,a),this.b=new Ss(e,i,a),this.a.texture.name=`${s}.read`,this.b.texture.name=`${s}.write`,this.isAActive=!0}get read(){return this.isAActive?this.a:this.b}get write(){return this.isAActive?this.b:this.a}swap(){this.isAActive=!this.isAActive}dispose(){this.a.dispose(),this.b.dispose()}}let qi;const Vc=new ko,Oc=new ko;class Uc extends Js{static get type(){return"FluidSimulationNode"}constructor(e,i){super(e);const a={speedFactor:1,simRes:64,dyeRes:256,iterations:3,densityDissipation:.97,velocityDissipation:.98,pressureDissipation:.8,curlStrength:20,radius:.001,useBoundaries:!0,useInteraction:!0};Object.assign(a,i),this._isFirstMeshActive=!0,this.useBoundaries=a.useBoundaries;const{simRes:s,dyeRes:t,velocityDissipation:n,pressureDissipation:r,curlStrength:o,radius:c}=a;this.simRes=O(new Ce(s,s)),this.dyeRes=O(new Ce(t,t)),this.deltaTime=O(.016),this.useInteraction=a.useInteraction,this._speedFactor=a.speedFactor,this._advectionDissipation=O(n),this.textureNode=e,this._baseIterations=a.iterations,this.iterations=Math.round(this._baseIterations*(1/this._speedFactor)),this._accumulatedTime=0,this._timeStep=.016,this._subSteps=Math.max(1,Math.round(1/this._speedFactor)),this.densityDissipation=a.densityDissipation,this.velocityDissipation=n,this.pressureDissipation=O(r),this.curlStrength=O(o),this.point=O(new Ce(0,0),"vec2"),this.force=O(new Ce(0,0),"vec2"),this.radius=O(c),this.splats=[],this._density=new Xi(t,t,{depthBuffer:!1,type:os},"FluidSimulationNode.density"),this._velocity=new Xi(s,s,{depthBuffer:!1,type:os,format:zr},"FluidSimulationNode.velocity"),this._pressure=new Xi(s,s,{type:os,format:Ei,magFilter:is,minFilter:is,depthBuffer:!1},"FluidSimulationNode.pressure"),this._divergenceRT=new Ss(s,s,{type:os,format:Ei,magFilter:is,minFilter:is,depthBuffer:!1}),this._divergenceRT.texture.name="FluidSimulationNode.divergence",this._curlRT=new Ss(s,s,{type:os,format:Ei,magFilter:is,minFilter:is,depthBuffer:!1}),this._curlRT.texture.name="FluidSimulationNode.curl",this._densityNode=be(this._density.read.texture),this._velocityNode=be(this._velocity.read.texture),this._pressureNode=be(this._pressure.read.texture),this._divergenceNode=be(this._divergenceRT.texture),this._curlNode=be(this._curlRT.texture),this.splatTextureNode=be(this._velocity.read.texture),this._sourceNode=be(this._velocity.read.texture),this._textureDebugVelocity=Rs(this,this._velocity.read.texture),this._textureDebugDensity=Rs(this,this._density.read.texture),this._textureDebugCurl=Rs(this,this._curlRT.texture),this._textureDebugPressure=Rs(this,this._pressure.read.texture),this._textureDebugDivergence=Rs(this,this._divergenceRT.texture),this._textureNode=this._textureDebugDensity,this.updateBeforeType=Sn.FRAME;const l={depthWrite:!1,depthTest:!1,blending:Vr};this._materialVorticity=new Vt(l),this._materialPressure=new Vt(l),this._materialGradientSubtract=new Vt(l),this._materialClear=new Vt(l),this._materialSplat=new Vt(l),this._materialAdvection=new Vt(l),this._materialAdvectionDensity=new Vt(l),this._materialDivergence=new Vt(l),this._materialCurl=new Vt(l),this._materialVorticity.name="FluidSimulationNode.vorticity",this._materialPressure.name="FluidSimulationNode.pressure",this._materialGradientSubtract.name="FluidSimulationNode.gradientSubtract",this._materialClear.name="FluidSimulationNode.clear",this._materialSplat.name="FluidSimulationNode.splat",this._materialAdvection.name="FluidSimulationNode.advection",this._materialAdvectionDensity.name="FluidSimulationNode.advectionDensity",this._materialDivergence.name="FluidSimulationNode.divergence",this._materialCurl.name="FluidSimulationNode.curl",this._onPointerMove=({pointer:u})=>{if(Math.abs(u.delta.x)||Math.abs(u.delta.y)){const h=u.normalized.x*.5+.5,d=u.normalized.y*-.5+.5,f=u.delta.x*1,g=u.delta.y*-1;this.splats.push({x:h,y:d,dx:f,dy:g})}},this.useInteraction&&De.on("pointerMove",this._onPointerMove),this._folder=null,this._onDebug=({gui:u})=>{this.folder=u.addFolder("Fluid Simulation"),this.folder.add(this,"iterations",0,30).name("Iterations"),this.folder.add(this.curlStrength,"value",0,100).name("Curl Strength"),this.folder.add(this.radius,"value",0,.01).name("Splat Radius"),this.folder.add(this,"velocityDissipation",0,1).name("Velocity Dissipation"),this.folder.add(this.pressureDissipation,"value",0,1).name("Pressure Dissipation"),this.folder.add(this,"densityDissipation",0,1).name("Density Dissipation"),this._folder=this.folder}}get activeMesh(){return this._isFirstMeshActive?Vc:Oc}swapMesh(){this._isFirstMeshActive=!this._isFirstMeshActive}getTextureNode(){return this._textureNode}_updateSpeedFactor(e){this._speedFactor=e,this._subSteps=Math.max(1,Math.round(1/e)),this.iterations=Math.round(this._baseIterations*(1/e))}setSize(e,i){let a=this.simRes.value.x,s=this.dyeRes.value.x;e<x.spBreakPoint&&(a=a/2,s=s/2),this.simRes.value.set(a,a),this.dyeRes.value.set(s,s),this._density.read.setSize(s,s),this._density.write.setSize(s,s),this._velocity.read.setSize(a,a),this._velocity.write.setSize(a,a),this._pressure.read.setSize(a,a),this._pressure.write.setSize(a,a),this._divergenceRT.setSize(a,a),this._curlRT.setSize(a,a)}_createCurlMaterial(){const e=q(_(1).div(At.x),_(1).div(At.y)),i=c=>this._velocityNode.uv(c),a=de(),s=a.sub(q(e.x,0)),t=a.add(q(e.x,0)),n=a.add(q(0,e.y)),r=a.sub(q(0,e.y)),o=$(()=>{let c=i(s).y.negate(),l=i(t).y.negate(),u=i(n).x,h=i(r).x;const d=l.sub(c).sub(u).add(h);return j(_(.5).mul(d),0,0,1)});this._materialCurl.fragmentNode=o()}_createVorticityMaterial(){const e=q(_(1).div(At.x),_(1).div(At.y)),i=l=>this._curlNode.uv(l),a=l=>this._velocityNode.uv(l),s=de(),t=s.sub(q(e.x,0)),n=s.add(q(e.x,0)),r=s.add(q(0,e.y)),o=s.sub(q(0,e.y)),c=$(()=>{const l=i(t).x,u=i(n).x,h=i(r).x,d=i(o).x,f=i(s).x,g=q(xs(h).sub(xs(d)),xs(u).sub(xs(l))).mul(.5).toVar();g.divAssign(Lt(g).add(1e-4)),g.mulAssign(this.curlStrength.mul(f));const m=a(s).xy;return j(m.add(g.mul(this.deltaTime)),0,1)});this._materialVorticity.fragmentNode=c()}_createDivergenceMaterial(){const e=q(_(1).div(At.x),_(1).div(At.y)),i=c=>this._velocityNode.uv(c),a=de(),s=a.sub(q(e.x,0)),t=a.add(q(e.x,0)),n=a.add(q(0,e.y)),r=a.sub(q(0,e.y)),o=$(()=>{const c=i(s).x.toVar(),l=i(t).x.toVar(),u=i(n).y.negate().toVar(),h=i(r).y.negate().toVar(),d=i(a).xy;if(this.useBoundaries===!0){const g=s.x.lessThan(0),m=t.x.greaterThan(1),v=n.y.greaterThan(1),w=r.y.lessThan(0);re(g,()=>{c.assign(d.x.negate())}),re(m,()=>{l.assign(d.x.negate())}),re(v,()=>{u.assign(d.y)}),re(w,()=>{h.assign(d.y)})}const f=_(.5).mul(_(l.sub(c).add(u.sub(h))));return j(f,0,0,1)});this._materialDivergence.fragmentNode=o()}setup(e){const i=this.textureNode,a=de(),s=S=>this.splatTextureNode.uv(S).xyz,t=S=>this._pressureNode.uv(S).x,n=S=>this._velocityNode.uv(S).xy,r=S=>this._divergenceNode.uv(S).x,o=S=>this._sourceNode.uv(S).xyz,c=q(_(1).div(At.x),_(1).div(At.y)),l=a.sub(q(c.x,0)),u=a.add(q(c.x,0)),h=a.add(q(0,c.y)),d=a.sub(q(0,c.y)),f=$(()=>{const S=a.sub(this.point).toVar();S.x.mulAssign(At.x.div(At.y));const A=_(Fo(S.dot(S).negate().div(this.radius))).mul(H(this.force.x,this.force.y,1)),P=s(a);return j(P.add(A),1)}),g=$(()=>j(t().mul(this.pressureDissipation),0,0,1)),m=$(()=>{const S=de(),A=t(l).x,P=t(u).x,k=t(h).x,C=t(d).x,M=r(S);return j(_(_(A).add(P).add(k).add(C).sub(M)).mul(.25),0,0,1)}),v=$(()=>{const S=t(de().sub(q(c.x,0))),A=t(de().add(q(c.x,0))),P=t(de().add(q(0,c.y))),k=t(de().sub(q(0,c.y))),C=n(a).toVar();return C.subAssign(q(A.sub(S),k.sub(P))),j(C,0,1)}),w=$(()=>{const S=n(a).xy.toVar();S.y=S.y.negate();const A=a.sub(this.deltaTime.mul(S.mul(1/this.simRes.value.x)));return j(this._advectionDissipation.mul(o(A)),1)}),T=$(()=>{const S=n(a).xy.toVar();S.y=S.y.negate();const A=a.sub(this.deltaTime.mul(S.mul(1/this.simRes.value.x)));return j(this._advectionDissipation.mul(o(A)),1)});this._materialAdvection.fragmentNode=w(),this._materialAdvectionDensity.fragmentNode=T(),this._createVorticityMaterial(),this._materialPressure.fragmentNode=m(),this._materialGradientSubtract.fragmentNode=v(),this._materialClear.fragmentNode=g(),this._materialSplat.fragmentNode=f(),this._createCurlMaterial(),this._createDivergenceMaterial();const y=e.getNodeProperties(this);return y.textureNode=i,this._textureNode}splat(e){for(let i=this.splats.length-1;i>=0;i--){const{x:a,y:s,dx:t,dy:n}=this.splats.splice(i,1)[0];this.point.value.set(a,s),this.force.value.set(t,n),this.splatTextureNode.value=this._velocity.read.texture,this.activeMesh.material=this._materialSplat,e.setRenderTarget(this._velocity.write),this.activeMesh.render(e),this._velocity.swap(),this.swapMesh(),this.splatTextureNode.value=this._density.read.texture,this.activeMesh.material=this._materialSplat,e.setRenderTarget(this._density.write),this.activeMesh.render(e),this._density.swap(),this.swapMesh()}}curl(e){this._velocityNode.value=this._velocity.read.texture,this.activeMesh.material=this._materialCurl,e.setRenderTarget(this._curlRT),this.activeMesh.render(e),this.swapMesh(),this._velocityNode.value=this._velocity.read.texture,this._curlNode.value=this._curlRT.texture}vorticity(e){this.activeMesh.material=this._materialVorticity,e.setRenderTarget(this._velocity.write),this.activeMesh.render(e),this._velocity.swap(),this.swapMesh()}divergence(e){this._velocityNode.value=this._velocity.read.texture,this.activeMesh.material=this._materialDivergence,e.setRenderTarget(this._divergenceRT),this.activeMesh.render(e),this.swapMesh()}clearPressure(e){this._velocityNode.value=this._velocity.read.texture,this.activeMesh.material=this._materialClear,e.setRenderTarget(this._pressure.write),this.activeMesh.render(e),this._pressure.swap(),this.swapMesh()}pressure(e){this._divergenceNode.value=this._divergenceRT.texture,this.activeMesh.material=this._materialPressure;for(let i=0;i<this.iterations;i++)this._pressureNode.value=this._pressure.read.texture,e.setRenderTarget(this._pressure.write),this.activeMesh.render(e),this._pressure.swap(),this.swapMesh();this._pressureNode.value=this._pressure.read.texture,this._velocityNode.value=this._velocity.read.texture}gradientSubtract(e){this.activeMesh.material=this._materialGradientSubtract,e.setRenderTarget(this._velocity.write),this.activeMesh.render(e),this._velocity.swap(),this.swapMesh()}advectionVelocity(e){this._advectionDissipation.value=this.velocityDissipation,this._velocityNode.value=this._velocity.read.texture,this._sourceNode.value=this._velocity.read.texture,this.activeMesh.material=this._materialAdvection,e.setRenderTarget(this._velocity.write),this.activeMesh.render(e),this._velocity.swap(),this.swapMesh()}advectionDensity(e){this._advectionDissipation.value=this.densityDissipation,this._velocityNode.value=this._velocity.read.texture,this._sourceNode.value=this._density.read.texture,this.activeMesh.material=this._materialAdvectionDensity,e.setRenderTarget(this._density.write),this.activeMesh.render(e),this._density.swap()}updateBefore(e){const{renderer:i}=e;qi=kn.resetRendererState(i,qi),i.autoClear=!1,this._accumulatedTime+=this.deltaTime.value;const a=Math.floor(this._accumulatedTime/(this._timeStep*this._speedFactor));if(a>0){this._accumulatedTime-=a*this._timeStep*this._speedFactor;for(let s=0;s<a;s++){const t=[...this.splats];this.splats.length=0,s===0&&this.splats.push(...t),this.splat(i),this.curl(i),this.vorticity(i),this.divergence(i),this.clearPressure(i),this.pressure(i),this.gradientSubtract(i),this.advectionVelocity(i),this.advectionDensity(i)}}this._densityNode.value=this._density.read.texture,kn.restoreRendererState(i,qi)}dispose(){this._density.dispose(),this._velocity.dispose(),this._pressure.dispose(),this._divergenceRT.dispose(),this._curlRT.dispose(),this.useInteraction&&De.off("pointerMove",this._onPointerMove),De.off("debug",this._onDebug),this._folder&&this._folder.destroy()}}const Bc=wn(Uc);class Gc extends Js{static get type(){return"ForegroundNode"}constructor(e,i,a){super("vec4"),this.inputNode=e,this.fluid=i,this.preAnimShow=a}setup(){const e=this.inputNode,s=bn(Ze.mul(1.5).add(Ls.mul(.1)),1).remapClamp(0,1).toVar(),t=At.x.div(At.y);let n=_(.002);se().isMobileOrTablet&&(n=_(.004));const r=t.greaterThan(_(1)).select(n.div(t),n),o=t.lessThan(_(1)).select(n.mul(t),n),c=je(_(0),r,Ze.x),l=je(_(0),r,Ze.x.oneMinus()),u=je(_(0),o,Ze.y),h=je(_(0),o,Ze.y.oneMinus()),d=c.mul(l).mul(u).mul(h).oneMinus(),f=Ze.sub(.5).mul(3),g=f.dot(f).mul(-.1).exp().mul(1.1).oneMinus().toVar(),m=s.mul(g.pow(2).mul(2).add(g.mul(.5).add(d.mul(s).mul(5)))).max(0).toVar();let v=_(0);return this.fluid!==void 0&&(v=Lt(this.fluid.rg).mul(.01).saturate().toVar().mul(2)),j(e.rgb.add(m.mul(_(.2).add(v)).mul(this.preAnimShow)).add(d.mul(v).mul(this.preAnimShow)).mul(x.sections.fourthProgress.smoothstep(x.fourthAnimBreakPointStart,x.fourthAnimBreakPointEnd).sub(x.sections.fiveProgress.smoothstep(0,.4)).oneMinus()),1)}}const jc=(p,e,i)=>ls(new Gc(ls(p),e,i));class Wc extends Js{constructor(e,i,a,s){super("vec4"),this.textureNode=e,this.depthNode=i,this.preNode=a,this.backgroundColor=us(331025),this.tFluid=s.tFluid,this.preAnimShow=s.preAnimShow}setup(e){const i=this.textureNode,a=this.preNode,s=this.depthNode,t=l=>i.uv(l),n=l=>a.uv(l),r=()=>s;return $(()=>{const l=de(),u=this.backgroundColor.toVar(),h=de().toVar(),d=j(t(h)).toVar(),f=d.toVar();let g=q(0,0);if(this.tFluid!==void 0){const C=Lt(q(_(.5).sub(de().x),_(.5).sub(de().y))).toVar(),M=Tn(_(.5).sub(de().x),_(.5).sub(de().y)).toVar(),z=Lt(this.tFluid.rg).mul(.001).toVar(),b=je(x.sections.twoEndProgress.mul(.15),_(.03).add(x.sections.twoEndProgress.mul(.52)),C),F=z.mul(b).toVar();g=q(q(rt(M),st(M)).mul(F)).toVar();const R=g.mul(1.1).toVar(),E=g.toVar(),I=g.mul(.9).toVar();u.addAssign(F.mul(10).mul(r().oneMinus().smoothstep(0,.6).oneMinus()).mul(this.preAnimShow).mul(.1));const U=t(Ze.add(R)).r.toVar(),G=t(Ze.add(E)).g.toVar(),X=t(Ze.add(I)).b.toVar(),D=H(U,G,X).mul(20.1).add(.03).toVar();f.assign(Pe(d,D,F))}const m=j(f).toVar(),v=l.sub(q(.5)).add(q(0,.2)).mul(.95),w=v.dot(v),T=je(0,_(.13),w).toVar(),y=m.toVar();re(x.introAnimProgress.lessThan(1),()=>{const C=j(n(l.add(g))),z=_(r().remapClamp(0,.91).r).toVar().pow(1).oneMinus(),b=_(0).toVar();re(C.r.greaterThan(.95).and(C.g.lessThan(.01)).and(C.b.lessThan(.01)),()=>{b.assign(_(1))});const F=Pe(u,m.mul(je(0,_(0).add(x.introAnimProgress).mul(2),w).mul(x.introAnimProgress).oneMinus()),Pe(z,_(1),x.introAnimProgress)),E=x.introEyeAnimProgress.sub(.5).div(.5).clamp(0,1).mul(T.mul(x.introEyeAnimProgress.oneMinus()).oneMinus());y.assign(Pe(u,F,E)),y.assign(Pe(y,m,b))});function S(C,M,z){const b=C.smoothstep(M,z),F=b.mul(2).mod(1).toVar();re(b.lessThan(.99).and(b.greaterThan(.01)),()=>{const R=l.x.add(l.y).oneMinus(),E=F.mul(3).sub(1),I=R.sub(E).smoothstep(-.6,1).clamp(0,1);re(b.lessThan(.5),()=>{y.mulAssign(I)}).Else(()=>{y.mulAssign(I.oneMinus())})})}const A=x.sections.threeProgress.toVar(),P=x.sections.twoEndProgress.smoothstep(.9,1).add(A.smoothstep(0,.1)).div(2).toVar();S(P,0,1),S(A,.71,.86);const k=l.sub(q(.5));return y.assign(y.mul(Pe(l.y.oneMinus().pow(.7).saturate(),k.dot(k).oneMinus().pow(5),_(0))),y),y})()}}const Hc=(p,e,i,a)=>ls(new Wc(p,e,i,a)),Xc=new Ce;class qc extends Js{constructor(e,i,a){super("vec4"),this.textureNode=e,this.scene=i,this.camera=a,this._pixelRatio=1,this._width=1,this._height=1,this.shaderRed=new wt({color:16711680,reflectivity:0,refractionRatio:0});const s=new Ss(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:os});s.texture.name="IntroPreProcessing",this.renderTarget=s,this.updateBeforeType=Sn.RENDER,this._textureNode=Rs(this,s.texture),this.resolution=new Ce(1,1)}getTextureNode(){return this._textureNode}setSize(e,i){this._width=e,this._height=i;const a=this._width*this._pixelRatio,s=this._height*this._pixelRatio;this.renderTarget.setSize(a,s)}updateBefore(e){const{renderer:i}=e,{scene:a,camera:s}=this,t=i.getSize(Xc);this.setSize(t.width,t.height);const n=i.toneMapping,r=i.toneMappingNode,o=i.getRenderTarget();if(x.introAnimProgress.value<1&&x.cheetahBody){i.setRenderTarget(this.renderTarget);const c=a.getObjectByName("Cheetah_PupilR");if(!c)return;const l=a.getObjectByName("Cheetah_PupilL"),u=x.cheetahBody,h=c.material,d=l.material;c.material=this.shaderRed,l.material=this.shaderRed,s.layers.disableAll(),s.layers.enable(2);const f=u.count;u.count=1,i.toneMapping=Ur,i.toneMappingNode=null,i.render(a,s),u.isInstancedMesh=!0,s.layers.enableAll(),u.count=f,c.material=h,l.material=d}i.toneMapping=n,i.toneMappingNode=r,i.setRenderTarget(o)}setup(e){const i=this.textureNode,a=e.getNodeProperties(this);return a.textureNode=i,this._textureNode}dispose(){this.renderTarget.dispose()}}const Kc=(p,e)=>ls(new qc(Or.COLOR,p,e));async function $c(){if(se().isWebGPU)try{const p=await navigator.gpu.requestAdapter();if(p===null)return"Unable to create WebGPU adapter";const{vendor:e,architecture:i,device:a,description:s}=p.info;return`
        Vendor: ${e}
        Architecture: ${i}
  ${a?`Device: ${a}`:""}
  ${s?`Description: ${s}`:""}`}catch(p){return`Error getting WebGPU info: ${p.message}`}else try{const p=se().gl.backend.gl,e=p.getExtension("WEBGL_debug_renderer_info"),i=p.getParameter(e.UNMASKED_VENDOR_WEBGL),a=p.getParameter(e.UNMASKED_RENDERER_WEBGL);return`
        Vendor: ${i}
        Renderer: ${a}`}catch(p){return`Error getting WebGL info: ${p.message}`}}const Yc=async()=>{const p=typeof window>"u"?"WORKER THREAD (OffScreenCanvas)":"MAIN THREAD",e=se().isWebGPU?"WebGPU":"WebGL",i=await $c();setTimeout(()=>{De.trigger({name:"debugInfos"},{threadType:p,renderBackend:e,hardwareInfo:i})},1)};Br("hash",Rt);const Zc=new Ce;class Qc extends ze(Gr,{raf:{renderPriority:999999,fps:yt}}){constructor({canvas:e,isWebGPU:i}){super({canvas:e,antialias:!0,alpha:!0,powerPreference:"high-performance",forceWebGL:!i}),this.countRenderBeforeStart=0,this.hasStarted=!1,this.frameTimes=[],this.fpsAverage=0,this.REPORT_INTERVAL=15,this.SAMPLE_WINDOW=5,this.lastReportTime=0,bt.layers.enableAll();const a=Eo(Qe,bt);this.sortObjects=!0,this.pass=a,this.shadowMap.enabled=!0,this.pass.renderTarget.autoClear=!1;const s=Kc(Qe,bt);this.getDrawingBufferSize(Zc),se().isMobileOrTablet||(this.tFluid=Bc(null).getTextureNode()),this.preAnimShow=O(0);const t=Hc(a.getTextureNode("output"),a.getTextureNode("depth"),s.getTextureNode(),this);this.rendererSettings={background:"#050d11"},a.getLinearDepthNode().remapClamp(0,.05),this.focus=O(1),this.aperture=O(.025),this.maxblur=O(.0125),this.fDepth=O(.5),this.ndofstart=O(1),this.ndofdist=O(2),this.fdofstart=O(1),this.fdofdist=O(3),this.postProcessing=new jr(this),this.postProcessing.outputColorTransform=!1;const{slowMoLerp:n}=se();this.cdlSettings={contrastAmount:O(1.15),contrastPivot:O(0),hue:O(0),saturation:O(1),vibrance:O(0)};const r=t,o=n.greaterThan(.8).select(1,n.div(.8)),c=x.sections.oneEndProgress.greaterThan(.5).and(x.sections.twoProgress.lessThan(1)).select(Wr(r,.95),r),l=jc(o.mix(c,r),this.tFluid,this.preAnimShow),u=zc(l,this.cdlSettings);this.outputPass=Hr(u,Xr),self._outputPass=this.outputPass,this.postProcessing.outputNode=this.outputPass,new Lc,this.combinedPass=t,self._postprocessing=this.postProcessing}onResize({width:e,height:i,dpr:a}){this.setDrawingBufferSize(e,i,a)}onDebug({gui:e}){this.folder=e.addFolder("Renderer"),this.folder.close(),this.folder.add(this.cdlSettings.hue,"value",-1,2).name("Hue"),this.folder.add(this.cdlSettings.saturation,"value",0,2).name("Saturation"),this.folder.add(this.cdlSettings.vibrance,"value",-1,1).name("Vibrance"),this.folder.add(this.cdlSettings.contrastAmount,"value",0,2).name("Contrast Amount"),this.folder.add(this.cdlSettings.contrastPivot,"value",0,1).name("Contrast Pivot")}onLoadEnd(){this.assetsLoaded=!0}dispose(){}onThrottle({delta:e}){}checkFps(e){this.frameTimes.push(e);const i=e-this.SAMPLE_WINDOW;for(;this.frameTimes.length>0&&this.frameTimes[0]<i;)this.frameTimes.shift();if(this.frameTimes.length>1){const a=this.frameTimes[this.frameTimes.length-1]-this.frameTimes[0],s=this.frameTimes.length-1;this.fpsAverage=s/a,e-this.lastReportTime>=this.REPORT_INTERVAL&&(this.reportFps(),this.lastReportTime=e)}else this.fpsAverage=0}reportFps(){const e=Math.round(this.fpsAverage);De.trigger({name:"collectFps"},{fps:e})}async onRaf({delta:e,elapsedTime:i,progress:a}){this.postProcessing&&await this.postProcessing.renderAsync(),this.assetsLoaded&&!this.hasStarted?this.countRenderBeforeStart>20?(this.hasStarted=!0,De.trigger({name:"renderedReady"}),Yc()):this.countRenderBeforeStart+=1:this.hasStarted&&this.checkFps(i),this.countRenderBeforeStart>20&&this.preAnimShow.value<1&&(this.preAnimShow.value+=e*.5)}}class Qt extends _n{static get type(){return"UtsuboPhysicalNodeMaterial"}constructor(e){super(),this.setValues(e)}setupPosition(e){const{object:i}=e,a=i.geometry;if(e.addStack(),(a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color)&&No(i).append(),i.isSkinnedMesh===!0&&(n=>ls(new qr(n,!0)))(i).append(),this.displacementMap){const t=Ni("displacementMap","texture"),n=Ni("displacementScale","float"),r=Ni("displacementBias","float");Se.addAssign(Wt.normalize().mul(t.x.mul(n).add(r)))}i.instanceMatrix&&i.instanceMatrix.isInstancedBufferAttribute===!0&&Lo(i).append(),this.positionNode!==null&&Se.assign(this.positionNode);const s=Do();return e.context.vertex=e.removeStack(),e.context.mvp=s,s}}const An=p=>{p.traverse(e=>{e.isMesh&&(e.material=new Qt({map:e.material.map,normalMap:e.material.normalMap,roughnessMap:e.material.roughnessMap,metalnessMap:e.material.metalnessMap,color:e.material.color,roughness:e.material.roughness,metalness:e.material.metalness,alphaTest:e.material.alphaTest,transparent:e.material.transparent}),e.material.transmission=0,e.material.frustumCulled=!1)})},Mt=$(([p,e=1])=>{const i=H(p.ga,0).toVar();return i.xy.mulAssign(2).subAssign(1),i.z.assign(_s(tt(i.xy,i.xy).oneMinus())),i.assign(i.mul(.5).add(.5)),zo(i,e)});class Jc{constructor(e={}){this.idleDuration=e.idleDuration||2,this.idleLookAtInterval=e.idleLookAtInterval||2,this.idleGazeRange=e.idleGazeRange||.5,this.isIdle=!1,this.currentTarget=new Ce,this.idleTarget=new Ce(0,0),this.idleLookAtTime=0,this.idleTime=0,this.lastPointerLerp=new Ce}resetIdleBehavior(){this.isIdle=!1,this.idleTime=0,this.idleLookAtTime=0}generateIdleTarget(){const e=this.idleGazeRange;this.idleTarget.x=(Math.random()-.5)*2*e,this.idleTarget.y=(Math.random()-.5)*2*e}update(e,i,a){if(e>.1)return;i.distanceTo(this.lastPointerLerp)>.001?(this.currentTarget.copy(i),this.resetIdleBehavior()):(this.idleTime+=e,this.idleTime>=this.idleDuration&&(this.isIdle||(this.isIdle=!0,this.generateIdleTarget()),this.idleLookAtTime+=e,this.idleLookAtTime>=this.idleLookAtInterval&&(this.idleLookAtTime=0,this.idleLookAtInterval=10+Math.random()*10,this.generateIdleTarget()))),this.isIdle&&(this.currentTarget.x=te.lerp(this.currentTarget.x,this.idleTarget.x,e*.3),this.currentTarget.y=te.lerp(this.currentTarget.y,this.idleTarget.y,e*.5),a.copy(this.currentTarget)),this.lastPointerLerp.copy(i)}}class el extends ze(Xe,{raf:{renderPriority:3,fps:1/0}}){init({model:e,mixer:i,animations:a}){this.pauseDuration=0,this.lastUpdateTime=0,this.isPaused=!1,this.currentXOffset=0,this.currentYOffset=0,this.idleBehavior=new Jc({idleDuration:6,idleLookAtInterval:12,idleGazeRange:.6}),this.tempPosition=new W,this.angerRatio=0;const s=nt("color_1","vec3");this.scaleEyes=O(0),this.head=e.getObjectByName("DEF_spine006"),this.spine=e.getObjectByName("DEF_Neck001"),this.neck=e.getObjectByName("DEF_Neck002"),this.headPosition=new W,this.headQuaternion=new Nt().copy(this.head.quaternion),this.headQuatOrigin=new Nt().copy(this.head.quaternion);const t=e.getObjectByName("Cheetah_Sclera");t.material=new Qt({color:16777215,side:gt,roughness:0,metalness:1,ior:1.5,opacity:1,transparent:!1,envMapIntensity:3}),t.material.backdropNode=gi();const n=Vo.dot(Pn).oneMinus().pow(1);je(.1,.3,n.oneMinus()).oneMinus(),this.dummy=new Xe,this.eyeTrackerReference=new Ct(new Co(.025,6,6),new vs({color:16777215})),this.eyeTrackerReference.visible=!1,this.eyeTrackerReference.frustumCulled=!1,this.add(this.eyeTrackerReference),Qe.add(this),this.pupil=e.getObjectByName("Cheetah_PupilL"),this.pupil.material=new wt({color:16777215,map:this.pupil.material.map,side:gt,vertexColors:!0,reflectivity:0,refractionRatio:0}),this.pupil.layers.set(2),this.pupil.frustumCulled=!1,this.pupil.material.colorNode=$(()=>H(En.mul(_(2)).add(s.r.mul(x.introAnimProgress).pow(3).oneMinus().mul(0))))(),this.resetActivityRatio=O(1),this.pupilLeftQuaternion=new Nt,this.pupilRightQuaternion=new Nt,this.eulerAngles=new bo,this.pupilLeftRotation=O(new W(0,0,0)),this.headBoneOrigin=this.head.position.clone(),this.eyeOffsetReference=this.headBoneOrigin.clone().sub(new W(-.037224,.905843,.651414)),this.eyeOffsetLeftReference=this.headBoneOrigin.clone().sub(new W(.037224,.905843,.651414)),this.pupil.material.positionNode=$(()=>{const r=H(.037224,.905843,.651414),o=this.pupilLeftRotation.negate().mul(this.resetActivityRatio),c=Se.sub(r).toVar();re(s.r.greaterThan(.5),()=>{c.assign(this.resetActivityRatio.mix(c.mul(1.2),c)),c.assign(this.resetActivityRatio.mul(this.scaleEyes.pow(1.7).max(0)).mix(c,c.mul(1.3)))});const l=Et(j(1,0,0,0),j(0,rt(o.x),st(o.x).negate(),0),j(0,st(o.x),rt(o.x),0),j(0,0,0,1)),u=Et(j(rt(o.y),0,st(o.y),0),j(0,1,0,0),j(st(o.y).negate(),0,rt(o.y),0),j(0,0,0,1)),h=Et(j(rt(o.z),st(o.z).negate(),0,0),j(st(o.z),rt(o.z),0,0),j(0,0,1,0),j(0,0,0,1));return l.mul(u).mul(h).mul(j(c,1)).xyz.add(r)}).once()(),this.pupilRight=e.getObjectByName("Cheetah_PupilR"),this.pupilRight.frustumCulled=!1,this.pupilRight.material=new wt({color:16777215,map:this.pupil.material.map,side:gt,vertexColors:!0,reflectivity:0,refractionRatio:0}),this.pupilRight.material.colorNode=$(()=>H(En.mul(_(2)).add(s.r.mul(x.introAnimProgress).pow(3).oneMinus().mul(0))))(),this.pupilRightRotation=O(new W(0,0,0)),this.pupilRight.layers.set(2),this.pupilRight.material.positionNode=$(()=>{const r=H(-.037224,.905843,.651414),o=this.pupilRightRotation.negate().mul(this.resetActivityRatio),c=Se.sub(r).toVar();re(s.r.greaterThan(.5),()=>{c.assign(this.resetActivityRatio.mix(c.mul(1.2),c)),c.assign(this.resetActivityRatio.mul(this.scaleEyes.pow(1.7).max(0)).mix(c,c.mul(1.3)))});const l=Et(j(1,0,0,0),j(0,rt(o.x),st(o.x).negate(),0),j(0,st(o.x),rt(o.x),0),j(0,0,0,1)),u=Et(j(rt(o.y),0,st(o.y),0),j(0,1,0,0),j(st(o.y).negate(),0,rt(o.y),0),j(0,0,0,1)),h=Et(j(rt(o.z),st(o.z).negate(),0,0),j(st(o.z),rt(o.z),0,0),j(0,0,1,0),j(0,0,0,1));return l.mul(u).mul(h).mul(j(c,1)).xyz.add(r)}).once()()}adjustMovementOffsets(e){const a=Math.random()-.5,s=Math.random()-.5,t=.95;this.currentXOffset=t*this.currentXOffset+Math.sin(e*1.25)*a*1,this.currentYOffset=t*this.currentYOffset+Math.cos(e*1.75)*s*1}onRaf({elapsedTime:e,delta:i}){const{resetActivityRatio:a,speed:s,pointerLerp:t,mouseDirectionRef:n}=se();if(!n)return;const r=x.sections,o=r.oneProgress.value,c=Math.min(1,o*2),l=r.fiveProgress.value,u=l>.05;if(o>.99&&!u)return;const h=t.clone();if(x.introEyeAnimProgress.value===0||x.inSubpage)return;const f=x.introTotalAnimProgressAfter.value;this.idleBehavior.update(i,t,h);const g=Math.max(f,.4);this.resetActivityRatio.value=a*g;const m=bt.near+1,v=2+s.value;let w=this.resetActivityRatio.value;l>0&&(w=.3);const T=h.x*w+this.currentXOffset,y=h.y*w+this.currentYOffset,A=new W(T,y,.5).unproject(bt).sub(bt.position).normalize();let P=(m-bt.position.z)/A.z;(!isFinite(P)||isNaN(P))&&(P=.6);const k=Math.min(u?10:.6,P),C=bt.position.clone().add(A.multiplyScalar(k));this.eyeTrackerReference.position.copy(C),C.y-=10,C.y-=(1-w)*1e3,this.head.updateWorldMatrix(!0,!1),this.head.parent.updateWorldMatrix(!0,!1),this.neckMemo||(this.neckMemo=this.head.parent.clone()),this.neckMemo.matrixWorld.copy(this.head.parent.matrixWorld),this.headMemo||(this.headMemo=this.head.clone(),this.neckMemo.add(this.headMemo)),this.headMemo.matrixWorld.copy(this.head.matrixWorld),this.head.lookAt(C);const M=te.clamp(y*.5,-1,-.1);this.angerRatio=1-f,this.headMemo.rotation.set(this.head.rotation.x+M-.4-this.angerRatio*x.introTotalAnimProgress.value*.25-(1-x.introEyeAnimProgress.value)*.2,this.head.rotation.y,this.head.rotation.z),this.headMemo.quaternion.setFromEuler(this.headMemo.rotation);const z=i*v*.9;if(isNaN(z)||!isFinite(z)){console.error("deltaFactor is NaN or infinite",i,v);debugger;return}this.headQuaternion.damp(this.headMemo.quaternion,4.2+Math.max(.01,Math.random())+k,i*v*.9),this.head.quaternion.slerpQuaternions(this.headQuatOrigin,this.headQuaternion,w*(1-ot(0,.5,o*3-l*3)));const b=20,F=ns(.2,.2,ot(0,.5,c-l));this.pupil&&(this.dummy.position.copy(this.head.position),this.dummy.position.sub(this.eyeOffsetLeftReference),this.dummy.position.y-=.028,this.dummy.lookAt(this.eyeTrackerReference.position),this.dummy.rotation.setFromQuaternion(this.dummy.quaternion,"XZY"),this.dummy.rotation.x=Math.max(-.8,Math.min(.8,this.dummy.rotation.x)),this.dummy.rotation.y=Math.max(-.7,Math.min(.7,this.dummy.rotation.y)),this.dummy.quaternion.setFromEuler(this.dummy.rotation),this.dummy.quaternion.slerp(this.pupil.quaternion,F),this.pupilLeftQuaternion.damp(this.dummy.quaternion,b,i*4*v),this.eulerAngles.setFromQuaternion(this.pupilLeftQuaternion),this.pupilLeftRotation.value.copy(this.eulerAngles)),this.pupilRight&&(this.dummy.position.copy(this.head.position),this.dummy.position.sub(this.eyeOffsetReference),this.dummy.position.y-=.028,this.dummy.lookAt(this.eyeTrackerReference.position),this.dummy.rotation.setFromQuaternion(this.dummy.quaternion,"XZY"),this.dummy.rotation.x=Math.max(-.8,Math.min(.8,this.dummy.rotation.x)),this.dummy.rotation.y=Math.max(-.7,Math.min(.7,this.dummy.rotation.y)),this.dummy.quaternion.setFromEuler(this.dummy.rotation),this.dummy.quaternion.slerp(this.pupilRight.quaternion,F),this.pupilRightQuaternion.damp(this.dummy.quaternion,b,i*4*v),this.eulerAngles.setFromQuaternion(this.pupilRightQuaternion),this.pupilRightRotation.value.copy(this.eulerAngles)),this.scaleEyes.value=te.damp(this.scaleEyes.value,ns(1-Math.abs(h.x)+1-Math.abs(h.y),1,ot(0,.5,c)),6,i)}onResize(){}dispose(){super.dispose(),this.gui&&this.gui.destroy()}}class tl extends ze(Xe,{raf:{renderPriority:1,fps:1/0}}){init(e){this.beard=e.getObjectByName("beard_mesh"),this.skinnedMesh=e.getObjectByName("Cheetah_Full")}onDebug({gui:e}){}onRaf({delta:e}){this.beard.morphTargetInfluences=this.skinnedMesh.morphTargetInfluences}onResize(){}dispose(){super.dispose(),this.gui&&this.gui.destroy()}}class sl extends ze(Xe,{raf:{renderPriority:3,fps:1/0}}){init({model:e,mixer:i,animations:a,modelExtra:s,mixerExtra:t,animationsExtra:n}){this.tempPosition=new W,this.model=e,this.angerRatio=.5,this.angerTrigger=0,this.head=e.getObjectByName("DEF_spine006"),this.spine=e.getObjectByName("DEF_Neck001"),this.neck=e.getObjectByName("DEF_Neck002"),this.angerAnimation=i.clipAction(a.find(o=>o.name==="blend shape Anger head"),null,Li),this.angerAnimation.play(),this.angerAnimation.setDuration(1),this.angerAnimation.paused=!0,this.blinkFactor=0,this.beard=e.getObjectByName("beard_mesh"),this.beard.material.outputNode=j(Se.distance(H(0,.7,0)).remapClamp(.6,.65).mix(H(1),H(.02)),1),this.beard.material.needsUpdate=!0,this.earLeftAnimation=i.clipAction(a.find(o=>o.name==="blend shape head ear L"),null,Li),this.earLeftAnimation.setLoop(Nn),this.earRightAnimation=i.clipAction(a.find(o=>o.name==="blend shape head ear R"),null,Li),this.earRightAnimation.setLoop(Nn);const r=(()=>{const o=(c,l)=>Math.random()*(l-c)+c;return(c,l,u)=>{const h={start:performance.now(),total:o(l,u)},d=f=>{h.total<=f-h.start&&(h.start=f,h.total=o(l,u),c()),requestAnimationFrame(d)};requestAnimationFrame(d)}})();this.blinkValue=0,r(()=>{x.introAnimProgress.value<1||(this.blinkFactor=.001)},1500,5e3),r(()=>{const o=.5+Math.random()*1.5;this.earRightAnimation.reset(),this.earRightAnimation.timeScale=o,this.earRightAnimation.play(),this.earRightFurAnimation&&(this.earRightFurAnimation.reset(),this.earRightFurAnimation.timeScale=o,this.earRightFurAnimation.play())},4e3,12e3),r(()=>{const o=.5+Math.random()*1.5;this.earLeftAnimation.reset(),this.earLeftAnimation.timeScale=o,this.earLeftAnimation.play(),this.earLeftFurAnimation&&(this.earLeftFurAnimation.reset(),this.earLeftFurAnimation.timeScale=o,this.earLeftFurAnimation.play())},4e3,12e3),this.resetActivityRatio=1,x.lastActivityTime=performance.now(),this.modelHead=this.model.getObjectByName("Cheetah_Full"),this.modelFur=this.model.getObjectByName("fur_line")}resetActivity(){this.resetActivityRatio=1,x.lastActivityTime=performance.now(),x.resetActivityRatio=this.resetActivityRatio}onPointerMove({pointer:e}){this.resetActivity()}onDebug({gui:e}){}onRaf({delta:e,elapsedTime:i}){const a=x.introEyeAnimProgress.value;if(a===0){this.modelHead.morphTargetInfluences[1]=1.1;return}const{speed:s}=se(),{introAnimProgress:t,introTotalAnimProgressAfter:n,sections:r}=x,o=1.02-a*1.02;t.value<1?this.modelHead.morphTargetInfluences[1]=o:performance.now()-x.lastActivityTime>600&&(this.resetActivityRatio=te.damp(this.resetActivityRatio,.1,2,e),x.resetActivityRatio=this.resetActivityRatio),r.fourthProgress.value;const l=r.oneProgress.value>.15&&!!1;this.angerRatio=te.damp(this.angerRatio,l?0:this.angerTrigger>0?.7*this.angerTrigger-Math.sin(i*25)*.013:Ha(Math.abs(Math.sin(i*.8)))*.072,8,e*(.5+s.value));const h=Math.max(0,Math.min(1,2.5-ot(.6,1,a)*2.5))+this.angerRatio;this.modelFur&&this.modelFur.morphTargetInfluences&&(this.modelFur.morphTargetInfluences[0]=h),this.modelHead.morphTargetInfluences[0]=h,this.beard.morphTargetInfluences[0]=h,this.beard.visible=r.threeProgress.value===0,this.blinkValue=.5-Math.cos(this.blinkFactor)*.5,this.blinkFactor>0?(this.blinkFactor+=e*3,this.blinkFactor>2*Math.PI?this.blinkFactor=0:this.blinkFactor+=e*10*(1+s.value),this.modelHead.morphTargetInfluences[1]=this.blinkValue):n.value>.5&&(this.modelHead.morphTargetInfluences[1]=o)}onTriggerAnger({active:e}){x.introTotalAnimProgressAfter.value<1||(this.angerTrigger=e?1:0)}onResize(){}dispose(){super.dispose(),this.gui&&this.gui.destroy()}}class il extends ze(Xe,{raf:{renderPriority:2,fps:yt}}){async init(){this.shellCount=O(1),this.renderedOnce=!1,this.renderOrder=2,this.name="Cheetah",this.fromScene2=!1,this.tempPosition=new W,this.hairBodydensity=O(506),this.factorNormal=O(.0041),this.furDistance=O(13e-5);const e=ce.resources.cheetah.asset.scene;An(e);const i=e.getObjectByName("Cheetah_Full");this.skinnedMesh=i,this.skinnedMesh.frustumCulled=!1,x.cheetahBody=i,x.cheetahParent=this,i.layers.set(2),i.isInstancedMesh=!0,i.count=this.shellCount.value,i.castShadow=!0,i.receiveShadow=!1,this.furPatch(i,i,this.hairBodydensity),i.renderOrder=9998,this.position.y=-.25,this.mixer=new Ds(e),this.cheetahExtra=null,this.mixerExtra=null,this.animationsExtra=null;const a=ce.resources.cheetah.asset.animations;this.animationsPatch(a),this.claws=e.getObjectByName("Cheetah_Claw"),this.tongue=e.getObjectByName("Cheetah_Tongue"),this.oral=e.getObjectByName("Cheetah_Teeth"),this.teeht=e.getObjectByName("Cheetah_OralCavity"),this.claws.frustumCulled=!1,this.add(e),new tl(e,this.cheetahExtras),new sl({model:e,mixer:this.mixer,animations:a,modelExtra:this.cheetahExtras,mixerExtra:this.mixerExtra,animationsExtra:this.animationsExtra}),new el({model:e,mixer:this.mixer,animations:a}),this.traverse(s=>{s.isMesh&&(s.isVisible=!1)}),Qe.add(this)}animationsPatch(e){this.run=this.mixer.clipAction(e.find(i=>i.name==="Cheetah_Rig Lite v3_Run slowmo")),this.sit=this.mixer.clipAction(e.find(i=>i.name==="Cheetah_Rig Lite v3_sitting")),this.walk=this.mixer.clipAction(e.find(i=>i.name==="Cheetah_Rig Lite v3_Walk")),this.runMuscle=this.mixer.clipAction(e[7]),this.sit.play(),this.runMuscle.play(),this.run.play(),this.sitToRunWeight=1,this.sit.setEffectiveWeight(this.sitToRunWeight),this.run.setEffectiveWeight(1-this.sitToRunWeight),this.runMuscle.setEffectiveWeight(1-this.sitToRunWeight),e[8]&&(this.runFin=this.mixer.clipAction(e[8])),this.runFin&&(this.runFin.play(),this.runFin.setEffectiveWeight(1-this.sitToRunWeight)),this.updateFur(0),x.runAnimation=this.run,x.cheetahGroupRef=this}furPatch(e,i,a){const s=ce.resources.cheetah_albedo.asset;s.flipY=!1,s.colorSpace=cs,s.needsUpdate=!0,i.userData._tempTexture=s;const t=ce.resources.cheetah_normal.asset,n=ce.resources.cheetah_rough.asset;n.colorSpace=ws,n.needsUpdate=!0;const r=ce.resources.furnormal.asset;r.wrapS=r.wrapT=pt,r.colorSpace=ws;const o=ce.resources.fur_length.asset;typeof window>"u"?o.flipY=!0:o.flipY=!1,o.colorSpace=ws,o.needsUpdate=!0;const l={};l.transparent=!1,l.alphaTest=.05;const u=new Qt({color:16777215,side:gt,...l}),h=Ft("float","vLayer"),d=nt("_uv2_noise").mul(7),f=Mt(be(r,d)).toVar(),g=Mt(be(t,de())).toVar(),m=be(o,de()).r.smoothstep(0,.3).add(6e-4);u.positionNode=$(()=>{const T=oe.equal(0).select(_(0),_(1).sub(oe.sub(1).toFloat().smoothstep(0,this.shellCount.sub(1))));h.assign(T);const y=T.mul(this.shellCount),S=yi.normalize(),A=_(0).toVar();re(oe.lessThan(this.shellCount),()=>{A.assign(this.furDistance.add(this.furDistance.mul(1.5).mul(T)).add(Di.z.smoothstep(.35,.61).oneMinus().mul(3e-4)))});const P=Se.add(S.mul(y).mul(A)).toVar();return Se.assign(P),hs.assign(qs.mul(Se)),P})();const v=$(([T])=>{const y=T.toVar(),S=nt("_uv2_noise").add(f.rg.mul(this.factorNormal).mul(y)),A=this.hairBodydensity,P=q(vi(S.mul(A))).toVar(),k=q(P.mul(2).sub(1)).toVar(),C=xi(xt(S.mul(A))).toVar(),M=Ye(C.x.add(C.y.mul(Ye(1357)))).toVar(),z=Ye(C.x.mul(Ye(1357)).add(C.y.mul(Ye(2468)))).toVar(),b=_(Rt(M)).div(4294967295),F=_(Rt(z)).div(4294967295),R=b.add(F).div(2).toVar(),E=_(Pe(0,y.pow(.8),R.pow(1.2))).toVar(),I=_(250).toVar(),U=_(1).sub(y.pow(2.5)),G=_(1.5).sub(je(0,.3,y)),X=I.mul(U).mul(G).toVar(),D=_(1).toVar(),N=k.length().mul(m).div(X.mul(E.max(.001))).toVar(),L=N.fwidth().mul(Pe(2,1,y)).toVar();return re(y.greaterThan(0),()=>{const V=je(_(1).sub(L),_(1).add(L),N.oneMinus()).mul(je(L.oneMinus(),L.add(.15),N).oneMinus()).toVar(),B=je(.85,1,y).oneMinus();D.assign(V.mul(B))}),D});u.colorNode=$(()=>{const T=H(be(s,de()).rgb).toVar();v(h).lessThanEqual(.05).discard();const y=nt("_uv2_noise").add(f.rg.mul(this.factorNormal).mul(h)),A=q(vi(y.mul(a))).mul(2).sub(1),P=xi(xt(y.mul(a))),k=Ye(P.x.add(P.y.mul(Ye(1357)))),C=Ye(P.x.mul(Ye(1357)).add(P.y.mul(Ye(2468)))),M=_(Rt(k)).div(4294967295),z=_(Rt(C)).div(4294967295),b=M.add(z).div(2),F=_(200).toVar(),R=_(.2),E=_(1).sub(h.pow(.5)).max(R),I=b.mul(.1).add(.95),U=A.length().mul(m).div(F.mul(E)).mul(.3).add(.7);return T.mulAssign(I),T.mulAssign(U),H(T)})(),u.opacityNode=$(()=>v(h))(),u.normalNode=g.add(f).normalize(),Oo([Le(-1,-1),Le(-1,1),Le(1,-1),Le(1,1)],"ivec2");const w=Di.z.smoothstep(.45,.61).oneMinus().mix(g,yi).toVar();u.normalNode=x.sections.twoIntroProgress.mix(w.add(f).normalize(),g),u.roughnessNode=be(n,de()).g.sub(f.b.mul(.2)),u.metalnessNode=be(n,de()).g.oneMinus(),u.outputNode=Pe(Is,j(x.fogOutputColor,1),Di.z.smoothstep(.35,.61).oneMinus().mul(x.sections.oneProgress.oneMinus())),$(()=>(v(h).lessThanEqual(0).discard(),j(0,0,0,10)))(),u.morphTexture=null,i.material=u}updateFur(e){const{speed:i}=se(),{sections:a}=x,s=a.oneProgress.value,t=a.oneEndProgress.value,n=a.twoEndProgress.value,r=a.threeProgress.value,o=a.fourthProgress.value,c=a.fiveProgress.value,l=n>0&&r===0;let u=0;l&&(u=.7*Math.min(1,n*1.2));const h=Math.max(.4,i.value)-u,d=o>0&&c===0?(.035+o*.025)*Math.max(.1,i.value):0;this.sitToRunWeight=te.damp(this.sitToRunWeight,1-Math.min(1,Math.max(0,-.1+s*(this.fromScene2?8:4))),20,e),c>0&&(this.sitToRunWeight=1),this.sitToRunWeight>.99?(this.run.paused=!0,this.runMuscle.paused=!0,this.runMuscle.time=this.runMuscle.getClip().duration-.2,this.run.time=this.run.getClip().duration-.2):(this.run.paused=!1,this.runMuscle.paused=!1),this.sit.setEffectiveWeight(this.sitToRunWeight),this.run.setEffectiveWeight(1-this.sitToRunWeight),this.runMuscle.setEffectiveWeight(1-this.sitToRunWeight),this.mixer.update(x.globalTimer.value*h+d);const f=te.smoothstep(this.tempPosition.distanceTo(bt.position),1,3.5);this.shellCount.value=se().isMobileOrTablet?1+Math.round((1-f)*3):1+Math.round((1-f)*4),this.skinnedMesh.count=this.shellCount.value,this.furDistance.value=7e-5+f*3e-4+f*6e-4*ot(.5,1,t)}onRenderedReady(){this.renderedOnce=!0,x.inSubpage&&(this.visible=!1)}onRaf({delta:e}){this.visible&&this.updateFur(e);const{sections:i,inSubpage:a}=x,s=i.oneProgress.value,t=i.threeProgress.value,n=i.fourthProgress.value,r=i.fiveProgress.value,o=n<=0,c=Math.min(1,i.twoIntroProgress.value*2);this.visible=!this.renderedOnce||(t===0||!o)&&!a,this.tongue.visible=o&&i.twoIntroProgress.value<1,this.oral.visible=o&&i.twoIntroProgress.value<1,this.teeht.visible=o&&i.twoIntroProgress.value<1;const l=20;if(r>0)this.position.set(4.4,2.691,.6);else if(n>0){const{fourthAnimBreakPointStart:u,fourthAnimBreakPointEnd:h}=x,d=ot(u+.02,h,n)*25;this.position.x=0,this.position.y=-.25,this.position.z=te.damp(this.position.z,d,l,e)}else t>0?this.position.set(0,-.25,0):s<1?this.fromScene2?(this.position.z=te.damp(this.position.z,-40+Zn(1-s)*40,l,e),(this.position.z===0||s<.01)&&(this.fromScene2=!1)):s>.95?(this.position.z=-20,this.fromScene2=!0):(this.position.z=te.damp(this.position.z,7*Math.min(1,Math.max(0,-.2+s*1.3)),l,e),s<.1&&(this.fromScene2=!1)):(this.position.z=te.damp(this.position.z,-40+Zn(c)*40,l,e),this.fromScene2=!0)}onDebug({gui:e}){e&&(this.folder=e.addFolder("Anim"),this.folder.close(),this.folder.add(this.hairBodydensity,"value",0,1500).name("hairBodydensity"),this.folder.add(this.furDistance,"value",0,5e-4).name("furDistance"),this.folder.add(this.factorNormal,"value",0,.01).name("factorNormal"))}dispose(){super.dispose()}}const ri={fog:{oneProgress:{near:6.3,far:12},twoProgress:{near:6.3,far:12},threeProgress:{near:.3,far:3},fourthProgress:{near:.3,far:95},fiveProgress:{near:9.6,far:31},subpage:{near:.3,far:80}},dirLight:{oneProgress:{intensity:3,position:new W(-13.94,6.9,21.65),target:new W(-13.75,-44.73,-33.75),color:new he(16765620)},twoProgress:{defaultIntensity:2.4,fromIntensity:2.4,toIntensity:0,intensity:2.4,position:new W(4.6,11.48,9.52),target:new W(4.6,1.65,2.63),color:new he(16701625)},threeProgress:{intensity:.2,fromIntensity:.2,toIntensity:2.34,position:new W(9.52,1.65,-.32),target:new W(4.6,.66,1.65),color:new he(14411263)},fourthProgress:{defaultIntensity:1.8,intensity:1.8,position:new W(10,1,0),target:new W(12,0,0),color:new he(.29613827078752575,.29613827078752575,.29613827078752575)},fiveProgress:{intensity:8,position:new W(21.68,3.36,27.55),target:new W(17.22,2.63,1),color:new he(12573932)},subpage:{intensity:3.82,position:new W(3.61,6.56,-36.7),target:new W(5.58,0,0),color:new he(14540510)}},dirLightWhite:{oneProgress:{intensity:129.57,position:new W(2.47,1,-.48),target:new W(-9.09,4.5,5.42),decay:2,distance:100,angle:.66,penumbra:1,color:new he(16765869)},twoProgress:{defaultIntensity:14.44,fromIntensity:14.44,toIntensity:0,intensity:14.44,position:new W(-.96,.19,1.08),target:new W(-.34,.21,.36),decay:1.95,distance:100,angle:.54,penumbra:1,color:new he(8164088)},threeProgress:{intensity:1,fromIntensity:1,toIntensity:41.06,position:new W(5.66,7.14,13.04),target:new W(.5,2.71,-1.71),decay:1.45,distance:119.73,angle:.78,penumbra:.74,color:new he(16777215)},fourthProgress:{interactionColor:new he(1320766),defaultColor:new he(.7454042095350284,.783537791521566,.8713671191959567),defaultIntensity:47.33,fromIntensity:41.33,toIntensity:200,exitIntensity:0,intensity:41.23,position:new W(-.7,.4,7),defaultPositionZ:7,target:new W(0,1.63,-1),decay:1.5,distance:242.66,angle:.33,penumbra:1,color:new he(16251132)},fiveProgress:{intensity:213.16,position:new W(-6.14,1.86,8.22),target:new W(-1.71,-.98,-1.49),decay:1.88,distance:85.32,angle:.57,penumbra:1,color:new he(9153016)},subpage:{intensity:139.4,position:new W(-12.04,10.09,0),target:new W(0,0,0),decay:1.55,distance:100,angle:.88,penumbra:1,color:new he(7389439)}},fillLight:{oneProgress:{intensity:124.55,position:new W(2.47,-2.78,2.47),target:new W(1,-.48,1),decay:1.8,distance:100,angle:1.37,penumbra:1,color:new he(10016505)},twoProgress:{defaultIntensity:90,fromIntensity:90,toIntensity:0,intensity:90,position:new W(.42,-.31,1.94),target:new W(.04,.13,.21),decay:1.06,distance:100,angle:.73,penumbra:1,color:new he(16629846)},threeProgress:{intensity:0,fromIntensity:0,toIntensity:13,position:new W(-.05,-.16,-.65),target:new W(.07,.33,-.16),decay:1.58,distance:25.2,angle:.99,penumbra:.4,color:new he(16742144)},fourthProgress:{fromIntensity:219.7,toIntensity:330.95,intensity:219.85,position:new W(4,-4,-22),target:new W(.07,0,-20),decay:1.54,distance:185.68,angle:1.55,penumbra:.95,color:new he(1,.17144110072255403,0)},fourthExit:{intensity:300,position:new W(4,18.7,-22),target:new W(.07,3.95,-20),decay:1.27,distance:185.68,angle:1.15,penumbra:.95,color:new he(16742144)},fiveProgress:{intensity:146.18,position:new W(5.42,6.9,3.07),target:new W(0,-21.13,-1.95),decay:2,distance:100,angle:.48,penumbra:1,color:new he(16641767)},subpage:{intensity:56.61,position:new W(60,30.5,-35.88),target:new W(23.12,3.95,-19.65),decay:1.13,distance:100,angle:.35,penumbra:1,color:new he(15201023)}}},nl=p=>{let e=[];return p.intensity!==void 0&&e.push(`intensity: ${p.intensity.toFixed(2)}`),e.push(`position: new THREE.Vector3(${p.position.x.toFixed(2)}, ${p.position.y.toFixed(2)}, ${p.position.z.toFixed(2)})`),p.target&&p.target.position&&e.push(`target: new THREE.Vector3(${p.target.position.x.toFixed(2)}, ${p.target.position.y.toFixed(2)}, ${p.target.position.z.toFixed(2)})`),p.decay!==void 0&&e.push(`decay: ${p.decay.toFixed(2)}`),p.distance!==void 0&&e.push(`distance: ${p.distance.toFixed(2)}`),p.angle!==void 0&&e.push(`angle: ${p.angle.toFixed(2)}`),p.penumbra!==void 0&&e.push(`penumbra: ${p.penumbra.toFixed(2)}`),p.color!==void 0&&e.push(`color: new THREE.Color(0x${p.color.getHexString()})`),e.join(`,
  `)};class ol extends ze(Xe,{raf:{renderPriority:1,fps:yt}}){async init(){this.name="Utsubo_Lights",this.isDebugging=!1,this.showHelpers=!0;const e=ri.dirLight.oneProgress,i=new gn(e.color,e.intensity);i.position.set(-2.5,5,0),i.userData.virtual={intensity:e.intensity,position:i.position.clone(),target:i.target.clone(),color:e.color.clone()};const a=ri.dirLightWhite.oneProgress,s=new on(a.color,a.intensity);s.castShadow=!0,s.shadow.camera.near=.1,s.shadow.camera.far=15,s.shadow.camera.right=5,s.shadow.camera.left=-5,s.shadow.camera.top=5,s.shadow.camera.bottom=-5,s.shadow.mapSize.width=512,s.shadow.mapSize.height=512,s.penumbra=a.penumbra,s.decay=a.decay,s.distance=a.distance,s.angle=a.angle,s.shadow.bias=-5e-4,s.position.set(.08,2.36,-7.82),s.target.position.set(0,1.64,-7.64),s.userData.virtual={intensity:s.intensity,position:s.position.clone(),target:s.target.clone(),distance:s.distance,penumbra:s.penumbra,decay:s.decay,angle:s.angle,color:s.color.clone()};const t=ri.fillLight.oneProgress,n=new on(e.color,t.intensity);n.position.set(-.33,-2.78,4),n.target.position.set(0,0,0),n.penumbra=t.penumbra,n.decay=t.decay,n.distance=t.distance,n.angle=t.angle,n.userData.virtual={intensity:n.intensity,position:n.position.clone(),target:n.target.clone(),color:n.color.clone(),distance:n.distance,penumbra:n.penumbra,decay:n.decay,angle:n.angle},this.lights=new Kt,this.dampFactor=12,this.dirLight=i,this.dirLightWhite=s,this.fillLight=n,this.lights.add(i),this.lights.add(s),this.lights.add(n),this.add(this.lights),this.lightsPositionPerSection=ri,this.updateLights(0),Qe.add(this)}setFogProperties(e,i,a){this.isDebugging}setLightsProperties(e,i){this.isDebugging||(e.userData.virtual.position.copy(i.position),e.userData.virtual.target.position.copy(i.target),e.userData.virtual.intensity=i.intensity,e.userData.virtual.color&&e.userData.virtual.color.copy(i.color),e.userData.virtual.distance&&(e.userData.virtual.distance=i.distance),e.userData.virtual.penumbra&&(e.userData.virtual.penumbra=i.penumbra),e.userData.virtual.decay&&(e.userData.virtual.decay=i.decay),e.userData.virtual.angle&&(e.userData.virtual.angle=i.angle))}instantChangeLightsProperties(e,i){this.isDebugging||(e.intensity=i.intensity,e.position.copy(i.position),e.target.position.copy(i.target),i.color&&e.color.copy(i.color),i.distance&&(e.distance=i.distance),i.penumbra&&(e.penumbra=i.penumbra),i.decay&&(e.decay=i.decay),i.angle&&(e.angle=i.angle))}dampLightsProperties(e,i){if(this.isDebugging)return;const a=x.introAnimProgress.value;e.intensity=te.damp(e.intensity,e.userData.virtual.intensity*a,this.dampFactor,i),e.position.lerp(e.userData.virtual.position,this.dampFactor*i),e.target.position.lerp(e.userData.virtual.target.position,this.dampFactor*i),e.userData.virtual.color&&e.color.lerp(e.userData.virtual.color,this.dampFactor*i),e.userData.virtual.distance&&(e.distance=te.damp(e.distance,e.userData.virtual.distance,this.dampFactor,i)),e.userData.virtual.penumbra&&(e.penumbra=te.damp(e.penumbra,e.userData.virtual.penumbra,this.dampFactor,i)),e.userData.virtual.decay&&(e.decay=te.damp(e.decay,e.userData.virtual.decay,this.dampFactor,i)),e.userData.virtual.angle&&(e.angle=te.damp(e.angle,e.userData.virtual.angle,this.dampFactor,i)),this.controllers&&this.updateGUI()}instantChangeFog({near:e,far:i}){}instantChangeLights(e,i,a){this.instantChangeLightsProperties(this.dirLight,e),this.instantChangeLightsProperties(this.dirLightWhite,i),a&&this.instantChangeLightsProperties(this.fillLight,a)}interpolateLights(e,i,a,s){return e=Object.assign({},e),e.position=e.position.clone(),e.target=e.target.clone(),e.intensity=te.lerp(i.intensity,a.intensity,s),e.position.lerpVectors(i.position,a.position,s),e.target.lerpVectors(i.target,a.target,s),e.color.lerpColors(i.color,a.color,s),e.decay=te.lerp(i.decay,a.decay,s),e.distance=te.lerp(i.distance,a.distance,s),e.angle=te.lerp(i.angle,a.angle,s),e.penumbra=te.lerp(i.penumbra,a.penumbra,s),e}updateLights(e){const{inSubpage:i,sections:a,spBreakPoint:s}=x;this.inSubpage=i;const t=a.oneProgress.value,n=a.twoProgress.value,r=a.twoIntroProgress.value,o=a.threeProgress.value,c=a.fourthProgress.value,l=a.fiveProgress.value,u=Me.width<s,h=u?1.8:1,d=u?Me.width/s*60:0,f=this.lightsPositionPerSection.fog,g=this.lightsPositionPerSection.dirLightWhite,m=this.lightsPositionPerSection.dirLight,v=this.lightsPositionPerSection.fillLight;let w=f.oneProgress.near,T=f.oneProgress.far,y=g.oneProgress,S=m.oneProgress,A=v.oneProgress;if(this.inSubpage)w=f.subpage.near,T=f.subpage.far,y=g.subpage,S=m.subpage,A=v.subpage,this.instantChangeFog(f.subpage),this.instantChangeLights(S,y,A),this.fromSubPage=!0;else{if(l>0)w=f.fiveProgress.near+d*5,T=f.fiveProgress.far+d*5,y=g.fiveProgress,S=m.fiveProgress,A=v.fiveProgress,this.instantChangeFog(f.fiveProgress),this.instantChangeLights(S,y,A),this.currentSection=5;else if(c>0){w=f.fourthProgress.near+d,T=f.fourthProgress.far+d,y=g.fourthProgress,S=m.fourthProgress,A=v.fourthProgress,this.instantChangeFog(f.fourthProgress),this.instantChangeLights(S,y);const P=1-se().slowMoLerp.value;S.intensity=Pt(S.defaultIntensity,.2,P),y.intensity=Pt(y.defaultIntensity,y.defaultIntensity-1.5,P),this.currentSection=4;const{fourthAnimBreakPointStart:k,fourthAnimBreakPointEnd:C}=x,M=Math.min(1,ot(k+.05,C,c)*4),z=v.fourthProgress,b=v.fourthExit;A=this.interpolateLights(A,z,b,M),M>0&&(y.intensity=Pt(y.defaultIntensity,0,M),y.position.z=Pt(y.defaultPositionZ,12,M),A.intensity=Pt(A.intensity,0,Math.min(1,Math.max(0,(-.85+c)*30))))}else if(o>0){if(w=f.threeProgress.near,T=f.threeProgress.far,this.instantChangeFog(f.threeProgress),y=g.threeProgress,S=m.threeProgress,A=v.threeProgress,this.currentSection===2)this.instantChangeLights(S,y,A);else{const P=Math.max(0,Math.min(1,-.38+o*8));y.intensity=Pt(y.fromIntensity,y.toIntensity,P),S.intensity=Pt(S.fromIntensity,S.toIntensity,P),A.intensity=Pt(A.fromIntensity,A.toIntensity,P)}this.currentSection=3}else if(n>0){const P=Math.max(1,h*Math.min(1,r*1.3));w=f.twoProgress.near*P,T=f.twoProgress.far*P,y=g.twoProgress,S=m.twoProgress,A=v.twoProgress;const k=1-se().slowMoLerp.value;if(S.intensity=Pt(S.defaultIntensity,.5,k),y.intensity=Pt(y.defaultIntensity,.5,k),this.currentSection===3)this.instantChangeLights(S,y,A);else{const C=a.twoEndProgress.value,M=fi(C*1.3),z=Math.max(0,-.05+C*1.1);C>0&&(y.intensity=Pt(y.fromIntensity,y.toIntensity,M),S.intensity=Pt(S.fromIntensity,S.toIntensity,M),A.intensity=Pt(A.fromIntensity,A.toIntensity,z))}this.currentSection=2}else t<1&&(w=f.oneProgress.near*h,T=f.oneProgress.far*h,S=m.oneProgress,y=g.oneProgress,A=v.oneProgress,this.currentSection=1);this.fromSubPage&&this.instantChangeLights(S,y,A),this.fromSubPage=!1}this.setFogProperties(w,T,e),this.setLightsProperties(this.dirLightWhite,y),this.setLightsProperties(this.dirLight,S),this.setLightsProperties(this.fillLight,A),this.dampLightsProperties(this.dirLight,e),this.dampLightsProperties(this.dirLightWhite,e),this.dampLightsProperties(this.fillLight,e)}onRenderedReady(){this.floorMesh&&(this.floorMesh.visible=!1)}onRaf({gl:e,elapsedTime:i,delta:a}){if(e.hasStarted===!1)return;const s=x.sections.oneProgress.value,t=x.sections.twoProgress.value,n=x.sections.threeProgress.value;if(this.updateLights(a),this.floorMesh&&t>0&&t<1){const r=s>.5&&n===0;this.floorMesh.visible=r,this.floorMesh.material.opacity=ot(.3,.5,t)}this.dirLightHelper?.update(),this.dirLightWhiteHelper?.update(),this.fillLightHelper?.update(),this.dirLight.updateWorldMatrix(!0,!1),this.dirLight.target.updateWorldMatrix(!0,!1),this.dirLightWhite.updateWorldMatrix(!0,!1),this.dirLightWhite.target.updateWorldMatrix(!0,!1),this.fillLight.updateWorldMatrix(!0,!1),this.fillLight.target.updateWorldMatrix(!0,!1)}updateGUI(){this.controllers&&this.controllers.forEach((e,i)=>{e.updateDisplay()})}onDebug({gui:e}){this.controllers=new Map,e.add(this,"isDebugging",!1).name("Manual Control"),e.add(this,"showHelpers").name("Show Helpers").onChange(r=>{this.dirLightHelper.visible=r,this.dirLightWhiteHelper.visible=r,this.fillLightHelper.visible=r});const i=(r,o,c,l,u,h)=>{const d=r.add(o,c,l,u).name(h).step(.01);return this.controllers.set(h,d),d},a=(r,o,c)=>{const l=r.addColor(o,"color").name(c);return this.controllers.set(c,l),l.onChange(()=>{o.color.copy(o.color).convertSRGBToLinear(),l.updateDisplay()}),l},s=(r,o,c)=>{r.add({"Copy Parameters":()=>{const l=nl(c);navigator.clipboard.writeText(l).then(()=>{console.log(`${o} copied:
${l}`)},u=>{console.error("Failed to copy: ",u)})}},"Copy Parameters").name("Copy Parameters")},t=60,n=[{light:this.dirLight,helper:new Kr(this.dirLight,5.5),folderName:"Directional Light",range:40,properties:[{property:"intensity",min:0,max:400,name:"Intensity _dl"},{property:"position.x",min:-t,max:t,name:"Position X _dl"},{property:"position.y",min:-t,max:t,name:"Position Y _dl"},{property:"position.z",min:-t,max:t,name:"Position Z _dl"},{property:"target.position.x",min:-t,max:t,name:"Target X _dl"},{property:"target.position.y",min:-t,max:t,name:"Target Y _dl"},{property:"target.position.z",min:-t,max:t,name:"Target Z _dl"},{property:"color",type:"color",name:"Color _dl"}]},{light:this.dirLightWhite,helper:new Ln(this.dirLightWhite),folderName:"Directional Light White",range:30,properties:[{property:"intensity",min:0,max:400,name:"Intensity _dwl"},{property:"distance",min:0,max:400,name:"Distance _dwl"},{property:"position.x",min:-t,max:t,name:"Position X _dwl"},{property:"position.y",min:-t,max:t,name:"Position Y _dwl"},{property:"position.z",min:-t,max:t,name:"Position Z _dwl"},{property:"target.position.x",min:-t,max:t,name:"Target X _dwl"},{property:"target.position.y",min:-t,max:t,name:"Target Y _dwl"},{property:"target.position.z",min:-t,max:t,name:"Target Z _dwl"},{property:"decay",min:1,max:2,name:"Decay _dwl"},{property:"angle",min:0,max:Math.PI/2,name:"Angle _dwl"},{property:"penumbra",min:0,max:1,name:"Penumbra _dwl"},{property:"color",type:"color",name:"Color _dwl"}]},{light:this.fillLight,helper:new Ln(this.fillLight),folderName:"Fill Light",range:20,properties:[{property:"intensity",min:0,max:300,name:"Intensity"},{property:"distance",min:0,max:300,name:"Distance"},{property:"position.x",min:-t,max:t,name:"Position X"},{property:"position.y",min:-t,max:t,name:"Position Y"},{property:"position.z",min:-t,max:t,name:"Position Z"},{property:"target.position.x",min:-t,max:t,name:"Target X"},{property:"target.position.y",min:-t,max:t,name:"Target Y"},{property:"target.position.z",min:-t,max:t,name:"Target Z"},{property:"decay",min:1,max:2,name:"Decay"},{property:"angle",min:0,max:Math.PI/2,name:"Angle"},{property:"penumbra",min:0,max:1,name:"Penumbra"},{property:"color",type:"color",name:"Color"}]}];n.forEach(r=>{const{light:o,helper:c,folderName:l,properties:u}=r,h=e.addFolder(l);h.close(),u.forEach(d=>{const{property:f,min:g,max:m,name:v,type:w}=d,T=f.split("."),y=T.pop(),S=T.reduce((A,P)=>A[P],o);w==="color"?a(h,S,v):i(h,S,y,g,m,v)}),s(h,l,o),this.lights.add(c)}),this.dirLightHelper=n[0].helper,this.dirLightWhiteHelper=n[1].helper,this.fillLightHelper=n[2].helper}onResize(){}dispose(){super.dispose(),this.gui&&(this.gui.destroy(),this.controllers?.clear())}}const rl=new Yr;class er extends Vt{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this.lights=!1,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(rl),this.setValues(e)}setupPosition(e){const{object:i,camera:a,context:s}=e;e.addStack();const t=this.sizeAttenuation,{positionNode:n,rotationNode:r,scaleNode:o}=this,c=Se;let l=qs.mul(H(n||0)),u=q(bi[0].xyz.length(),bi[1].xyz.length());if(o!==null&&(u=u.mul(o)),!t)if(a.isPerspectiveCamera)u=u.mul(l.z.negate());else{const m=_(2).div(un.element(1).element(1));u=u.mul(m.mul(2))}let h=c.xy;if(i.center&&i.center.isVector2===!0){const m=hn("center","vec2");h=h.sub(m.sub(.5))}h=h.mul(u);const d=_(r||$r),f=Uo(h,d);Se.assign(f),l=j(l.xy.add(f),l.zw);const g=un.mul(l);return s.vertex=c,hs.assign(l),e.context.vertex=e.removeStack(),e.context.mvp=g,g}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}class al extends ze(Xe,{raf:{renderPriority:1,fps:1/0}}){async init(){this.name="Insects",this.speed=O(1);const e=2400,i=3,{scene:a}=se(),s=new Dt(e,i),t=new Dt(e,i),n=new Dt(e,i),r=ct(s,"vec3",e),o=ct(t,"vec3",e),c=ct(n,"vec3",e),l=()=>Ye(Math.random()*16777215),u=[5,5,10],h=$(({renderer:C})=>{const M=$(()=>{const E=r.element(oe),I=oe.hash().rand(),U=oe.add(l()).hash().rand(),G=oe.add(l()).hash().rand(),D=H(I,U,G).toVar().mul(H(u[0],u[1],u[2]));D.subAssign(H(u[0]/2,u[1]/2,u[2]/2)),E.assign(D),o.element(oe).assign(E.xyz)})().compute(e),z=O(1.558),b=O(15.5),F=O(.8);this.pointerSize=O(.1),this.isPositionInCircle=$(([E,I,U,G])=>{const X=Es(!1).toVar(),D=I.toVar(),N=U.mul(G),L=E.x.mul(G),B=D.x.mul(G).sub(L),K=D.y.sub(E.y),Z=B.mul(B).add(K.mul(K));return X.assign(Z.lessThanEqual(N.mul(N))),X}).setLayout({name:"isPositionInCircle",type:"bool",inputs:[{name:"screenPosition",type:"vec2"},{name:"pointerPosition",type:"vec2"},{name:"pointerSize",type:"float"},{name:"aspectRatio",type:"float"}]});const R=$(()=>{const E=r.element(oe),I=c.element(oe),U=o.element(oe);re(E.z.lessThan(-u[2]*.5),()=>{E.x.assign(U.x),E.y.assign(U.y),E.z.addAssign(u[2]),I.assign(H(0))}),E.addAssign(I);const G=H(.002).mul(b).mul(Bo(E.mul(10).mul(z).add(Ls.mul(.01).mul(F))));I.addAssign(G.mul(.001).mul(this.speed.add(1)));const D=_(.3).mul(Ps.mul(this.speed));I.z.subAssign(D);const N=_(1/120),V=_(.97).pow(Ps.div(N));I.mulAssign(V);const B=x.screenSpaceMatrix.mul(E),K=B.xyz.div(B.w),Z=q(K.x,K.y);re(B.w.greaterThan(0),()=>{const le=x.pointerDelta;re(this.isPositionInCircle(Z,x.normalizedPointer,this.pointerSize,x.aspectRatio),()=>{const fe=x.normalizedPointer.toVar(),ae=this.pointerSize.mul(x.aspectRatio),me=Z.x.mul(x.aspectRatio),ne=fe.x.mul(x.aspectRatio).sub(me),Te=fe.y.sub(Z.y),ke=ne.mul(ne).add(Te.mul(Te)).sqrt(),Ie=ae,Ee=_(1.2),Ae=_(1).sub(je(_(0),Ie,ke)),xe=q(Te.negate(),ne).div(ke).mul(Ae).mul(Ee).mul(le.add(.01)),We=Ie.mul(.4),ue=ke.sub(We),Fe=_(.3),_e=q(ne,Te).div(ke).mul(ue).mul(Fe).mul(le.add(.01));I.x.addAssign(xe.x.sub(_e.x)),I.y.addAssign(xe.y.sub(_e.y));const Ue=_(.02),He=I.x.mul(I.x).add(I.y.mul(I.y));re(He.greaterThan(Ue.mul(Ue)),()=>{const ge=_s(He);I.mulAssign(Ue.div(ge))})});const Q=H(0,.26,.45),ie=Ks.x.lessThan(x.spBreakPoint).select(.28,.19).toVar(),J=x.screenSpaceMatrix.mul(Q),Y=J.xyz.div(J.w),ee=q(Y.x,Y.y).toVar();re(x.sections.oneProgress.lessThan(.5),()=>{ee.assign(q(0,.2)),ie.assign(.3)}),re(this.isPositionInCircle(Z,ee,ie,x.aspectRatio),()=>{const fe=ee.toVar(),ae=ie,me=Z.x.mul(x.aspectRatio),ne=fe.x.mul(x.aspectRatio).sub(me),Te=fe.y.sub(Z.y),Oe=ne.mul(ne).add(Te.mul(Te)),ke=q(ne,Te),Ie=Oe.sqrt(),Ee=_(1.5),Ae=_(1).sub(je(_(0),ae,Ie)),xe=ke.div(Ie).mul(Ae).mul(Ee.negate());I.x.addAssign(xe.x),I.y.addAssign(xe.y);const We=_(.02),ue=I.x.mul(I.x).add(I.y.mul(I.y));re(ue.greaterThan(We.mul(We)),()=>{const Fe=_s(ue);I.mulAssign(We.div(Fe))})})})})().compute(e);return R.onInit(()=>C.compute(M)),R}),d=r.toAttribute(),f=c.toAttribute(),g=new Ts;g.setAttribute("position",new $t(new Float32Array(3),3)),g.drawRange.count=1;const m={};m.blending=Go,m.transparent=!0,m.alphaTest=.1;const v=new er({transparent:!0,depthWrite:!1,...m}),w=O(.06);v.scaleNode=$s(0,1).mul(w),H(1,1,1).toVar(),H(.8,.6,0).toVar();const T=$s(0,1);this.colorParticleOne=O(new he("#ffffff")),this.colorParticleTwo=O(new he("#4eb0dc"));const y=Pe(this.colorParticleOne,this.colorParticleTwo,T.oneMinus().pow(2).oneMinus()),S=je(.3,2,hs.z.negate()).oneMinus(),A=_(_(.1).add(S.div(2))).div(de().sub(.5).length()).sub(_(.2).add(S.mul(1))),P=Ks.x.lessThan(x.spBreakPoint).select(18,12);v.colorNode=j(y.add(f.xy.length().mul(50)),A.mul(je(.3,P,hs.z.negate()).oneMinus())),v.alphaTest=.01,v.geometryNode=h(),v.positionNode=d;const k=new Pi(new Zt(1,1),v);k.count=e,k.frustumCulled=!1,k.material.fog=!1,this.points=k,this.add(k),a.add(this)}onDebug({gui:e}){this.folder=e.addFolder("Particles"),this.folder.close(),this.folder.addColor(this.colorParticleOne,"value").name("color 1"),this.folder.addColor(this.colorParticleTwo,"value").name("color 2")}onPointerMove({pointer:e}){}onRaf({gl:e,elapsedTime:i,delta:a}){const{sections:s}=x,t=s.twoProgress.value;if(t>=1){this.visible=!1;return}this.visible=!0;const n=s.threeProgress.value;this.speed.value=n>0?0:Math.min(.24,t*.24*2)}onResize(){}dispose(){super.dispose()}}class cl extends ze(Xe,{raf:{renderPriority:2,fps:yt}}){async init(){this.renderOrder=2,this.shellCount=O(6);const e=ce.resources.paw.asset.scene;An(e),this.decalZ=-.025,this.decalY=.1,this.tempPosition=new W,this.hairdensity=_(206),this.factorNormal=_(.05),this.furDistance=_(23e-5),this.cameraPosition=O(new W);const i=e.getObjectByName("Cheetah_Paw");this.skinnedMesh=i,i.isInstancedMesh=!0,i.frustumCulled=!1,i.count=this.shellCount.value,i.casShadow=!0;const a=this.furPatch(i);i.material=a,this.mixer=new Ds(e);const s=ce.resources.paw.asset.animations;this.animationsPatch(s),await this.finPatch(e),this.add(e);const t=e.getObjectByName("Cheetah_leg_line_fur");this.distanceInvisible=5,t&&((r=>{this.linesSkinned=new vn(r.geometry,new wt({color:16775395,reflectivity:0,refractionRatio:0}));const o=this.linesSkinned;o.material.colorNode=$(()=>Zr.hash().mix(H(.3),H(.2,.07,0)).mul(.5))(),o.material.normals=!1,o.frustumCulled=!1,o.castShadow=!1,o.receiveShadow=!1,o.morphTargetInfluences=r.morphTargetInfluences,o.morphTargetDictionary=r.morphTargetDictionary,o.isLineSegments=!0;const c=i.skeleton;o.skeleton=c,r.parent.remove(r),o.name="Cheetah_leg_line_fur"})(t),e.add(this.linesSkinned)),e.traverse(r=>{r.isMesh&&(r.layers.disable(0),r.layers.enable(3),r.material.transmission=0)}),Qe.add(this)}animationsPatch(e){this.anim=this.mixer.clipAction(e[0]),this.anim.play(),this.anim.paused=!0,this.updateFur(0)}furPatch(e){const i=e.material.map,a=e.material.normalMap,s=ce.resources.fractal.asset;s.wrapS=s.wrapT=pt,s.colorSpace=ws;const t=ce.resources.furnormal.asset;t.wrapS=t.wrapT=pt,t.colorSpace=ws;const n=ce.resources.fur_leg_length.asset;n.wrapS=n.wrapT=pt,typeof window>"u"?n.flipY=!0:n.flipY=!1,n.colorSpace=ws,n.needsUpdate=!0;const o=new jo({color:16777215,side:gt}),c=Ft("float","vLayer"),l=be(n,de()).r.smoothstep(0,.3);o.positionNode=$(()=>{const m=oe.equal(0).select(_(0),_(1).sub(oe.sub(1).toFloat().smoothstep(0,this.shellCount.sub(1))));c.assign(m);const v=m.mul(this.shellCount),w=yi.normalize(),T=_(0).toVar();re(oe.lessThan(this.shellCount),()=>{T.assign(this.furDistance.add(this.furDistance.mul(1.5).mul(m)))});const y=Se.add(w.mul(v).mul(T)).toVar();return Se.assign(y),hs.assign(qs.mul(Se)),y})();const u=nt("uv1").mul(5),h=zo(be(a,de())).toVar(),d=Mt(be(t,u)).toVar();o.positionNode=$(()=>{const m=oe.equal(0).select(_(0),_(1).sub(oe.sub(1).toFloat().smoothstep(0,this.shellCount.sub(1))));c.assign(m);const v=m.mul(this.shellCount),w=yi.normalize(),T=_(0).toVar();re(oe.lessThan(this.shellCount),()=>{T.assign(this.furDistance.add(this.furDistance.mul(1.5).mul(m)))});const y=Se.add(w.mul(v).mul(T)).toVar();return Se.assign(y),hs.assign(qs.mul(Se)),y})();const f=$(([m])=>{const v=m.toVar(),w=nt("uv1").add(d.rg.mul(this.factorNormal).mul(v)),T=this.hairdensity,y=q(vi(w.mul(T))).toVar(),S=q(y.mul(2).sub(1)).toVar(),A=xi(xt(w.mul(T))).toVar(),P=Ye(A.x.add(A.y.mul(Ye(1357)))).toVar(),k=Ye(A.x.mul(Ye(1357)).add(A.y.mul(Ye(2468)))).toVar(),C=_(Rt(P)).div(4294967295),M=_(Rt(k)).div(4294967295),z=C.add(M).div(2).toVar(),b=_(Pe(0,v.pow(1.2),z.pow(1.5))).toVar(),F=_(110).toVar(),R=_(1).sub(v.pow(.7)),E=F.mul(R).toVar(),I=_(1).toVar(),U=S.length().mul(l).div(E.mul(b.max(.001))).toVar(),G=U.fwidth().mul(1.5).toVar();return re(v.greaterThan(0),()=>{const X=je(_(1).sub(G),_(1).add(G),U.oneMinus()).mul(je(G.oneMinus(),G.add(.1),U).oneMinus()).toVar(),D=je(.9,1,v).oneMinus();I.assign(X.mul(D))}),I}),g=this.hairdensity;return o.colorNode=$(()=>{const m=H(be(i,de()).rgb).toVar();f(c).lessThanEqual(.05).discard();const v=nt("uv1").add(d.rg.mul(this.factorNormal).mul(c)),T=q(vi(v.mul(g))).mul(2).sub(1),y=xi(xt(v.mul(g))),S=Ye(y.x.add(y.y.mul(Ye(1357)))),A=Ye(y.x.mul(Ye(1357)).add(y.y.mul(Ye(2468)))),P=_(Rt(S)).div(4294967295),k=_(Rt(A)).div(4294967295),C=P.add(k).div(2),M=_(110).toVar(),z=_(1).sub(c.pow(.7)),b=c.mul(.4).add(.6),F=C.mul(.1).add(.95),R=T.length().mul(l).div(M.mul(z)).mul(.3).add(.7);return m.mulAssign(b),m.mulAssign(F),m.mulAssign(R),m.mulAssign(c.mul(.4).add(1)),H(m)})(),o.opacityNode=$(()=>f(c))(),o.normalNode=h.add(d).normalize(),o.morphTexture=null,o}async finPatch(e){if(this.finBody=e.getObjectByName("Cheetah_leg_fin_fur"),this.claws=e.getObjectByName("Cheetah_Claw"),this.claws.frustumCulled=!1,this.finBody){this.finBody.frustumCulled=!1,this.finBody.material.side=Yt,this.finBody.material.transparent=!1;const i=$(()=>{const s=be(ce.resources.cheetah_fin_alpha.asset,nt("uv","vec2").xy).r.toVar();return s.lessThan(.1).discard(),s})(),a=$(()=>be(this.finBody.material.map,de("uv")).rgb)();this.finBody.material.colorNode=a.mul(.3),this.finBody.material.outputNode=j(Is.rgb,Is.a),this.finBody.material.opacityNode=i}}onDebug({gui:e}){}updateFur(){this.shellCount.value=se().isMobileOrTablet?3:4,this.skinnedMesh&&(this.skinnedMesh.count=this.shellCount.value),this.cameraPosition.value.copy(bt.position)}onRaf({gl:e,delta:i}){if(e.hasStarted===!1)return;const a=x.sections.threeProgress.value,s=a>0,t=x.sections.fourthProgress.value<=0,n=s&&t&&!x.inSubpage;if(this.visible=n,this.visible){this.updateFur(i);const r=Yo(Math.max(0,1-a*16));this.position.z=this.decalZ*r,this.position.y=this.decalY*r,this.anim&&(this.anim.time=5*Math.min(1,a+14/160),this.mixer.update(0))}}onResize(){}dispose(){super.dispose(),this.folder&&this.folder.destroy()}}const Ki=$(([p,e,i,a,s])=>{let t=bn(p.add(s)).mul(.5).add(.5);return t=i.mul(wi(xs(t),a)),p.add(t.mul(e))});$(p=>{const i=p.vNormal.toVar(),a=p.vTangent.toVar(),t=p.vPosition.toVar().mul(Fo(p.scale.div(2).add(2))).toVar(),n=i.normalize().toVar(),r=a.mul(.001).toVar(),o=Dn(n,r).normalize().mul(.001).toVar(),c=Qr(p.density,0,1,10,.5).toVar(),l=H(st(p.seed).mul(100),rt(p.seed.div(2)).mul(100),st(p.seed.div(3)).mul(100)).toVar(),u=Ki(t,n,p.bump,c,l),h=Ki(t.add(r),n,p.bump,c,l),d=Ki(t.add(o),n,p.bump,c,l),f=Gt(h,u),g=Gt(d,u);return Jr.mul(Dn(f,g).normalize())}).once();const{lerp:$i}=te;class ll extends ze(Xe,{raf:{renderPriority:2,fps:yt}}){async init(){const e=ce.resources.paw_rock.asset.scene.children[0];this.rock=e;const i=ce.resources.moonscape_albedo.asset,a=new Qt({color:16777215,side:gt,map:i});e.material=a,e.material.normalNode=Mt(be(ce.resources.concrete.asset,de().mul(10))),e.material.colorNode=$(()=>be(i,de()).pow(2.5))(),e.layers.disable(0),e.layers.enable(3),this.add(e),this.mixerRock=new Ds(e),this.animRock=this.mixerRock.clipAction(ce.resources.paw_rock.asset.animations[0]),this.animRock.play(),this.animRock.paused=!0,Qe.add(this),this.targetPosition=new W,this.desktopOffsetPosition=new W(-.1,.024,-.04),this.tableProOffsetPosition=new W(-.49,.04,-.08),this.tabletOffsetPosition=new W(-.52,.04,-.12),this.smartphoneOffsetPosition=new W(-.46,.03,-.16),this.offsetPosition=new W(0,0,0)}onRenderedReady(){this.visible=!1}onRaf({gl:e,delta:i}){if(e.hasStarted===!1)return;const a=x.sections.threeProgress.value,s=a>0,t=x.sections.fourthProgress.value<=0,n=0;if(this.visible=s&&t&&a>n&&!x.inSubpage,this.visible!==!1&&(this.visible&&this.animRock&&(this.animRock.time=4*Math.min(1,a+30/200),this.mixerRock.update(0)),this.visible)){this.targetPosition.set($i(0,this.offsetPosition.x,a),$i(0,this.offsetPosition.y,a),$i(0,this.offsetPosition.z,a));const r=6;this.position.x=te.damp(this.position.x,this.targetPosition.x,r,i),this.position.y=te.damp(this.position.y,this.targetPosition.y,r,i),this.position.z=te.damp(this.position.z,this.targetPosition.z,r,i)}}onResize({width:e}){e>x.spBreakPoint?this.offsetPosition.copy(this.desktopOffsetPosition):e>820?this.offsetPosition.copy(this.tableProOffsetPosition):e>700?this.offsetPosition.copy(this.tabletOffsetPosition):this.offsetPosition.copy(this.smartphoneOffsetPosition)}onDebug({gui:e}){}dispose(){super.dispose(),this.gui&&this.gui.destroy()}}function ul(p,e){return p.z-e.z}function hl(p,e){return e.z-p.z}class dl{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,i){const a=this.pool,s=this.list;this.index>=a.length&&a.push({start:-1,count:-1,z:-1});const t=a[this.index];s.push(t),this.index++,t.start=e.start,t.count=e.count,t.z=i}reset(){this.list.length=0,this.index=0}}const Ms="batchId",ss=new lt,oo=new lt,pl=new lt,ro=new lt,Yi=new ea,ai=new Cs,gs=new as,Os=new W,Zi=new dl,ft=new Ct,ci=[];function fl(p,e,i=0){const a=e.itemSize;if(p.isInterleavedBufferAttribute||p.array.constructor!==e.array.constructor){const s=p.count;for(let t=0;t<s;t++)for(let n=0;n<a;n++)e.setComponent(t+i,n,p.getComponent(t,n))}else e.array.set(p.array,i*a);e.needsUpdate=!0}class tr extends Ct{get maxGeometryCount(){return this._maxGeometryCount}constructor(e,i,a=i*2,s){super(new Ts,s),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._drawRanges=[],this._reservedRanges=[],this._visibility=[],this._active=[],this._bounds=[],this._maxGeometryCount=e,this._maxVertexCount=i,this._maxIndexCount=a,this._geometryInitialized=!1,this._geometryCount=0,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._visibilityChanged=!0,this._matricesTexture=null,this._initMatricesTexture(),this._colorsTexture=null}_initMatricesTexture(){let e=Math.sqrt(this._maxGeometryCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const i=new Float32Array(e*e*4),a=new As(i,e,e,Ys,Si);this._matricesTexture=a}_initColorsTexture(){let e=Math.sqrt(this._maxGeometryCount);e=Math.ceil(e);const i=new Float32Array(e*e*4),a=new As(i,e,e,Ys,Si);a.colorSpace=an.workingColorSpace,this._colorsTexture=a}_initializeGeometry(e){const i=this.geometry,a=this._maxVertexCount,s=this._maxGeometryCount,t=this._maxIndexCount;if(this._geometryInitialized===!1){for(const r in e.attributes){const o=e.getAttribute(r),{array:c,itemSize:l,normalized:u}=o,h=new c.constructor(a*l),d=new $t(h,l,u);i.setAttribute(r,d)}if(e.getIndex()!==null){const r=a>65536?new Uint32Array(t):new Uint16Array(t);i.setIndex(new $t(r,1))}const n=s>65536?new Uint32Array(a):new Uint32Array(a);i.setAttribute(Ms,new $t(n,1)),this._geometryInitialized=!0}}_validateGeometry(e){if(e.getAttribute(Ms))throw new Error(`BatchedMesh: Geometry cannot use attribute "${Ms}"`);const i=this.geometry;if(!!e.getIndex()!=!!i.getIndex())throw new Error('BatchedMesh: All geometries must consistently have "index".');for(const a in i.attributes){if(a===Ms)continue;if(!e.hasAttribute(a))throw new Error(`BatchedMesh: Added geometry missing "${a}". All geometries must have consistent attributes.`);const s=e.getAttribute(a),t=i.getAttribute(a);if(s.itemSize!==t.itemSize||s.normalized!==t.normalized)throw new Error("BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Cs);const e=this._geometryCount,i=this.boundingBox,a=this._active;i.makeEmpty();for(let s=0;s<e;s++)a[s]!==!1&&(this.getMatrixAt(s,ss),this.getBoundingBoxAt(s,ai).applyMatrix4(ss),i.union(ai))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new as);const e=this._geometryCount,i=this.boundingSphere,a=this._active;i.makeEmpty();for(let s=0;s<e;s++)a[s]!==!1&&(this.getMatrixAt(s,ss),this.getBoundingSphereAt(s,gs).applyMatrix4(ss),i.union(gs))}addGeometry(e,i=-1,a=-1){if(this._initializeGeometry(e),this._validateGeometry(e),this._geometryCount>=this._maxGeometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");const s={vertexStart:-1,vertexCount:-1,indexStart:-1,indexCount:-1};let t=null;const n=this._reservedRanges,r=this._drawRanges,o=this._bounds;this._geometryCount!==0&&(t=n[n.length-1]),i===-1?s.vertexCount=e.getAttribute("position").count:s.vertexCount=i,t===null?s.vertexStart=0:s.vertexStart=t.vertexStart+t.vertexCount;const c=e.getIndex(),l=c!==null;if(l&&(a===-1?s.indexCount=c.count:s.indexCount=a,t===null?s.indexStart=0:s.indexStart=t.indexStart+t.indexCount),s.indexStart!==-1&&s.indexStart+s.indexCount>this._maxIndexCount||s.vertexStart+s.vertexCount>this._maxVertexCount)throw new Error("BatchedMesh: Reserved space request exceeds the maximum buffer size.");const u=this._visibility,h=this._active,d=this._matricesTexture,f=this._matricesTexture.image.data;u.push(!0),h.push(!0);const g=this._geometryCount;this._geometryCount++,pl.toArray(f,g*16),d.needsUpdate=!0,n.push(s),r.push({start:l?s.indexStart:s.vertexStart,count:-1}),o.push({boxInitialized:!1,box:new Cs,sphereInitialized:!1,sphere:new as});const m=this.geometry.getAttribute(Ms);for(let v=0;v<s.vertexCount;v++)m.setX(s.vertexStart+v,g);return m.needsUpdate=!0,this.setGeometryAt(g,e),g}setGeometryAt(e,i){if(e>=this._geometryCount)throw new Error("BatchedMesh: Maximum geometry count reached.");this._validateGeometry(i);const a=this.geometry,s=a.getIndex()!==null,t=a.getIndex(),n=i.getIndex(),r=this._reservedRanges[e];if(s&&n.count>r.indexCount||i.attributes.position.count>r.vertexCount)throw new Error("BatchedMesh: Reserved space not large enough for provided geometry.");const o=r.vertexStart,c=r.vertexCount;for(const d in a.attributes){if(d===Ms)continue;const f=i.getAttribute(d),g=a.getAttribute(d);fl(f,g,o);const m=f.itemSize;for(let v=f.count,w=c;v<w;v++){const T=o+v;for(let y=0;y<m;y++)g.setComponent(T,y,0)}g.needsUpdate=!0,g.addUpdateRange(o*m,c*m)}if(s){const d=r.indexStart;for(let f=0;f<n.count;f++)t.setX(d+f,o+n.getX(f));for(let f=n.count,g=r.indexCount;f<g;f++)t.setX(d+f,o);t.needsUpdate=!0,t.addUpdateRange(d,r.indexCount)}const l=this._bounds[e];i.boundingBox!==null?(l.box.copy(i.boundingBox),l.boxInitialized=!0):l.boxInitialized=!1,i.boundingSphere!==null?(l.sphere.copy(i.boundingSphere),l.sphereInitialized=!0):l.sphereInitialized=!1;const u=this._drawRanges[e],h=i.getAttribute("position");return u.count=s?n.count:h.count,this._visibilityChanged=!0,e}deleteGeometry(e){const i=this._active;return e>=i.length||i[e]===!1?this:(i[e]=!1,this._visibilityChanged=!0,this)}getInstanceCountAt(e){return this._multiDrawInstances===null?null:this._multiDrawInstances[e]}setInstanceCountAt(e,i){return this._multiDrawInstances===null&&(this._multiDrawInstances=new Int32Array(this._maxGeometryCount).fill(1)),this._multiDrawInstances[e]=i,e}getBoundingBoxAt(e,i){if(this._active[e]===!1)return null;const s=this._bounds[e],t=s.box,n=this.geometry;if(s.boxInitialized===!1){t.makeEmpty();const r=n.index,o=n.attributes.position,c=this._drawRanges[e];for(let l=c.start,u=c.start+c.count;l<u;l++){let h=l;r&&(h=r.getX(h)),t.expandByPoint(Os.fromBufferAttribute(o,h))}s.boxInitialized=!0}return i.copy(t),i}getBoundingSphereAt(e,i){if(this._active[e]===!1)return null;const s=this._bounds[e],t=s.sphere,n=this.geometry;if(s.sphereInitialized===!1){t.makeEmpty(),this.getBoundingBoxAt(e,ai),ai.getCenter(t.center);const r=n.index,o=n.attributes.position,c=this._drawRanges[e];let l=0;for(let u=c.start,h=c.start+c.count;u<h;u++){let d=u;r&&(d=r.getX(d)),Os.fromBufferAttribute(o,d),l=Math.max(l,t.center.distanceToSquared(Os))}t.radius=Math.sqrt(l),s.sphereInitialized=!0}return i.copy(t),i}setMatrixAt(e,i){const a=this._active,s=this._matricesTexture,t=this._matricesTexture.image.data,n=this._geometryCount;return e>=n||a[e]===!1?this:(i.toArray(t,e*16),s.needsUpdate=!0,this)}getMatrixAt(e,i){const a=this._active,s=this._matricesTexture.image.data,t=this._geometryCount;return e>=t||a[e]===!1?null:i.fromArray(s,e*16)}setColorAt(e,i){this._colorsTexture===null&&this._initColorsTexture();const a=this._active,s=this._colorsTexture,t=this._colorsTexture.image.data,n=this._geometryCount;return e>=n||a[e]===!1?this:(i.toArray(t,e*4),s.needsUpdate=!0,this)}getColorAt(e,i){const a=this._active,s=this._colorsTexture.image.data,t=this._geometryCount;return e>=t||a[e]===!1?null:i.fromArray(s,e*4)}setVisibleAt(e,i){const a=this._visibility,s=this._active,t=this._geometryCount;return e>=t||s[e]===!1||a[e]===i?this:(a[e]=i,this._visibilityChanged=!0,this)}getVisibleAt(e){const i=this._visibility,a=this._active,s=this._geometryCount;return e>=s||a[e]===!1?!1:i[e]}raycast(e,i){const a=this._visibility,s=this._active,t=this._drawRanges,n=this._geometryCount,r=this.matrixWorld,o=this.geometry;ft.material=this.material,ft.geometry.index=o.index,ft.geometry.attributes=o.attributes,ft.geometry.boundingBox===null&&(ft.geometry.boundingBox=new Cs),ft.geometry.boundingSphere===null&&(ft.geometry.boundingSphere=new as);for(let c=0;c<n;c++){if(!a[c]||!s[c])continue;const l=t[c];ft.geometry.setDrawRange(l.start,l.count),this.getMatrixAt(c,ft.matrixWorld).premultiply(r),this.getBoundingBoxAt(c,ft.geometry.boundingBox),this.getBoundingSphereAt(c,ft.geometry.boundingSphere),ft.raycast(e,ci);for(let u=0,h=ci.length;u<h;u++){const d=ci[u];d.object=this,d.batchId=c,i.push(d)}ci.length=0}ft.material=null,ft.geometry.index=null,ft.geometry.attributes={},ft.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._drawRanges=e._drawRanges.map(i=>({...i})),this._reservedRanges=e._reservedRanges.map(i=>({...i})),this._visibility=e._visibility.slice(),this._active=e._active.slice(),this._bounds=e._bounds.map(i=>({boxInitialized:i.boxInitialized,box:i.box.clone(),sphereInitialized:i.sphereInitialized,sphere:i.sphere.clone()})),this._maxGeometryCount=e._maxGeometryCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.slice()),this}dispose(){return this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null),this}onBeforeRender(e,i,a,s,t){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const n=s.getIndex(),r=n===null?1:n.array.BYTES_PER_ELEMENT,o=this._active,c=this._visibility,l=this._multiDrawStarts,u=this._multiDrawCounts,h=this._drawRanges,d=this.perObjectFrustumCulled;d&&(ro.multiplyMatrices(a.projectionMatrix,a.matrixWorldInverse).multiply(this.matrixWorld),Yi.setFromProjectionMatrix(ro,e.coordinateSystem));let f=0;if(this.sortObjects){oo.copy(this.matrixWorld).invert(),Os.setFromMatrixPosition(a.matrixWorld).applyMatrix4(oo);for(let v=0,w=c.length;v<w;v++)if(c[v]&&o[v]){this.getMatrixAt(v,ss),this.getBoundingSphereAt(v,gs).applyMatrix4(ss);let T=!1;if(d&&(T=!Yi.intersectsSphere(gs)),!T){const y=Os.distanceTo(gs.center);Zi.push(h[v],y)}}const g=Zi.list,m=this.customSort;m===null?g.sort(t.transparent?hl:ul):m.call(this,g,a);for(let v=0,w=g.length;v<w;v++){const T=g[v];l[f]=T.start*r,u[f]=T.count,f++}Zi.reset()}else for(let g=0,m=c.length;g<m;g++)if(c[g]&&o[g]){let v=!1;if(d&&(this.getMatrixAt(g,ss),this.getBoundingSphereAt(g,gs).applyMatrix4(ss),v=!Yi.intersectsSphere(gs)),!v){const w=h[g];l[f]=w.start*r,u[f]=w.count,f++}}this._multiDrawCount=f,this._visibilityChanged=!1}onBeforeShadow(e,i,a,s,t,n){this.onBeforeRender(e,null,s,t,n)}}const ml=new lt,Us=new as;class Mn extends ze(Xe,{raf:{renderPriority:2,fps:yt}}){init(e,i,a=60,s=!0,t=!1,n=!1,r=!1){this.prevProgress3=0;const o=ce.resources.moonscape_albedo.asset,c=ce.resources[i].asset,l=e.reduce((P,k)=>(P.vertex+=k.geometry.attributes.position.count,P.index+=k.geometry.index.count,P),{vertex:0,index:0});if(t===!0){this.bakeAnimation(e,i);return}const u=e.length,h=l.vertex,d=l.index,f=new Qt({color:16777215,side:gt,map:o}),g=new tr(u,h,d,f);g._colorsTexture=null,g.userData.animations=[],g.userData.meshLocals=e,g.perObjectFrustumCulled=!1;const m=c,v=new Float32Array(u*4);for(let P=0;P<u;P++){const k=e[P];g.addGeometry(k.geometry),g.getBoundingSphereAt(P,Us).applyMatrix4(ml),v[P*4+0]=Us.center.x,v[P*4+1]=Us.center.y,v[P*4+2]=Us.center.z,v[P*4+3]=Us.radius}const w=new Ws(v,4),T=_(1);this.progress=O(0),g.frustumCulled=!1,this.pointerSize=O(.1),this.isReverting=O(0),this.isPositionInCircle=$(([P,k,C,M])=>{const z=Es(!1).toVar(),b=k.toVar(),F=C.mul(M),R=P.x.mul(M),I=b.x.mul(M).sub(R),U=b.y.sub(P.y),G=I.mul(I).add(U.mul(U));return z.assign(G.lessThanEqual(F.mul(F))),z}).setLayout({name:"isPositionInCircle",type:"bool",inputs:[{name:"screenPosition",type:"vec2"},{name:"pointerPosition",type:"vec2"},{name:"pointerSize",type:"float"},{name:"aspectRatio",type:"float"}]});const y=u;let S,A;if(S=ct(w,"vec4",y).toReadOnly(),se().isWebGPU&&!se().isMobileOrTablet&&!r){const P=new Dt(y,3),k=ct(P,"vec3",y),C=new Ws(new Float32Array(y*3),3),M=ct(C,"vec3",C.count).label("positionStorage");A=ct(C,"vec3",C.count).toReadOnly();const z=$(()=>{const b=k.element(oe);return $(()=>{const R=oe,E=M.element(oe),I=S.element(oe),U=I.w,G=_(1/120),D=_(.97).pow(Ps.div(G));b.mulAssign(D),n?E.mulAssign(D):re(this.isReverting.greaterThan(0),()=>{E.mulAssign(D)});const N=_(a-1),L=_(N.mul(this.progress)).toVar(),V=it(L.floor()).toVar(),B=it(it(V.mul(4))).toVar(),K=it(R).toVar(),Z=Ge(m,Le(B,K)).toVar(),le=Ge(m,Le(B.add(1),K)).toVar(),Q=Ge(m,Le(B.add(2),K)).toVar(),ie=Ge(m,Le(B.add(3),K)).toVar(),J=Et(Z,le,Q,ie).toVar(),Y=H(J.mul(I.xyz).xyz).toVar();Y.addAssign(E);const ee=x.screenSpaceMatrix.mul(Y);re(ee.w.greaterThan(0),()=>{const ae=ee.xyz.div(ee.w),me=q(ae.x,ae.y),pe=U.mul(x.screenSpaceMatrix[0][0]).div(ee.w),ne=this.pointerSize.add(pe);re(this.isPositionInCircle(me,x.normalizedPointer,ne,x.aspectRatio),()=>{const Te=x.normalizedPointer.toVar(),Oe=ne.mul(x.aspectRatio),ke=me.x.mul(x.aspectRatio),Ee=Te.x.mul(x.aspectRatio).sub(ke),Ae=Te.y.sub(me.y),qe=Ee.mul(Ee).add(Ae.mul(Ae)),xe=q(Ee,Ae),We=qe.sqrt(),ue=Oe,Fe=_(.05).mul(_(1).div(U)).toVar();n&&Fe.assign(.01);const we=_(1).sub(je(_(0),ue,We)),_e=xe.div(We),Ue=Fe.mul(U.div(_(1))),He=_e.mul(we).mul(Ue.negate());n?(b.y.addAssign(He.y),b.z.addAssign(He.x.mul(.05))):(b.z.addAssign(He.x),b.y.addAssign(He.y));const ge=_(.02),Je=b.x.mul(b.x).add(b.y.mul(b.y)).add(b.z.mul(b.z));re(Je.greaterThan(ge.mul(ge)),()=>{const ye=_s(Je);b.mulAssign(ge.div(ye))})})});const fe=b.mul(U);E.addAssign(fe)})().compute(y)});g.material.geometryNode=z()}g.material.positionNode=$(()=>{g.batchingIdNode||(g.batchingIdNode=nt("batchId","uint"));const P=Ye(g.batchingIdNode),k=_(a-1),C=_(k.mul(this.progress)).toVar(),M=it(C.floor()).toVar(),z=it(it(M.mul(4))).toVar(),b=it(P).toVar(),F=Ge(m,Le(z,b)).toVar(),R=Ge(m,Le(z.add(1),b)).toVar(),E=Ge(m,Le(z.add(2),b)).toVar(),I=Ge(m,Le(z.add(3),b)).toVar();re(M.lessThan(a).and(T.greaterThan(0)),()=>{const V=it(it(M.add(1).mul(4))).toVar(),B=Ge(m,Le(V,b)),K=Ge(m,Le(V.add(1),b)),Z=Ge(m,Le(V.add(2),b)),le=Ge(m,Le(V.add(3),b)),Q=C.fract().toVar();F.assign(Pe(F,B,Q)),R.assign(Pe(R,K,Q)),E.assign(Pe(E,Z,Q)),I.assign(Pe(I,le,Q))});const U=Et(F,R,E,I).toVar(),G=H(U.mul(Se).xyz).toVar();if(A!==void 0){const V=A.element(P);G.addAssign(V)}const X=Wo(U).toVar(),D=Wt.div(H(X[0].dot(X[0]),X[1].dot(X[1]),X[2].dot(X[2]))).toVar();Se.assign(G);const N=X.mul(D).xyz.toVar();Wt.assign(N);const L=Zs.mul(X).toVar();return Zs.assign(L),Se})(),s&&(g.material.normalNode=$(()=>Mt(be(ce.resources.concrete.asset,de().mul(10))).toVar())()),this._positionRead=A,this.mesh=g,this.boundingSphereAttribute=S}bakeAnimation(e,i){const a=ce.resources.paw_surface.asset,s=new Ds(a.scene),t=a.animations,n=t.length,r=60,o=16,c=new Float32Array(r*o*n),l=new lt;for(let v=0;v<n;v++){const w=t[v],T=s.clipAction(w);T.play(),T.paused=!0;const y=T._clip.duration;for(let S=0;S<r;S++){T.time=S/r*y,s.update(0);const A=e[v];l.compose(A.position,A.quaternion,A.scale);const P=v*r*o+S*o;c.set(l.elements,P)}}let u=0,h=0;for(let v=0;v<c.length;v++)c[v]<u&&(u=c[v]),c[v]>h&&(h=c[v]);const d=new As(c,r*4,t.length,Ys,Si),f=new Ho;async function g(){const v=os,w=Xo,T=await f.parse(d,{type:v,compression:w});m(T,`${i}.exr`)}function m(v,w){const T=new Blob([v],{type:"image/x-exr"}),y=document.createElement("a");y.href=URL.createObjectURL(T),y.download=w,y.click()}g()}onDebug({gui:e}){}onRenderedReady(){this.visible=!0}onRaf({gl:e,delta:i}){if(e.hasStarted===!1)return;const a=x.sections.threeProgress.value>0,s=x.sections.fourthProgress.value===0;this.isReverting.value=this.prevProgress3>x.sections.threeProgress.value?1:0,this.prevProgress3=x.sections.threeProgress.value,this.visible=a&&s&&!x.inSubpage}onResize(){}dispose(){super.dispose()}}let li=null;class gl extends qo{static get type(){return"ViewportSharedTextureNode"}constructor(e=Ze,i=null){li===null&&(li=new Ko,li.minFilter=Ai),super(e,i,li),this.generateMipmaps=!0}updateReference(){return this}}const yl=wn(gl);class vl extends ze(Xe,{raf:{renderPriority:2,fps:yt}}){init(){const e=ce.resources.paw_surface.asset,i=ce.resources.moonscape_albedo.asset;i.flipY=!1,i.needsUpdate=!0;const a=yl(Ze.flipY().sub(q(0,-.2))).blur(.6).toVar(),s=[],t=[];e.scene.traverse(l=>{if(l.name.includes("static")){const u=l;u.material=new Qt({color:16777215,side:Yt}),u.material.normalNode=Mt(be(ce.resources.concrete.asset,de().mul(10))),u.material.colorNode=$(()=>be(i,de()).pow(1.5).add(a))(),t.push(u)}else l.isMesh&&s.push(l)});for(let l=0;l<t.length;l++){const u=t[l];this.add(u)}const{mesh:n,boundingSphereAttribute:r,progress:o}=new Mn(s,"paw_surface_xl_bake_60",60,!0,!1,!0,!0);this.mesh=n,this.progress=o,this.add(n),n.material.colorNode=$(()=>be(i,de()).pow(1.5).add(a))();const c=new Ct(new Zt(10,10).rotateX(-Math.PI/2),new wt({color:16731136,visible:!0}));c.material.outputNode=j(us(16731136).mul(3),1),c.position.y=-.1,this.add(c),Qe.add(this)}onDebug({gui:e}){}onRenderedReady(){this.visible=!1}onRaf({gl:e,delta:i}){if(e.hasStarted===!1)return;const a=x.sections.threeProgress.value>0,s=x.sections.fourthProgress.value===0;this.visible=a&&s&&!x.inSubpage,this.visible!==!1&&(this.progress.value=Math.min(1,ot(0,.1,x.sections.threeProgress.value)))}onResize(){}dispose(){super.dispose()}}const xl=$(([p=1,e=.8])=>{let i=Pn.toVar();i=ta.select(i,i.mul(-1));const a=Vo.dot(i).oneMinus().max(0).pow(p);return je(0,e,a.oneMinus())});class bl extends ze(Xe,{raf:{renderPriority:2,fps:yt}}){init(){const i=ce.resources.paw_surface_big.asset.scene.children,a=[];for(let o=0;o<i.length;o++)a.push(i[o].clone());const{mesh:s,progress:t,_positionRead:n}=new Mn(a,"bake_moon_surface_big",150,!0);this.mesh=s,this.progress=t,this.add(s);const r=ce.resources.moonscape_albedo.asset;s.material.colorNode=$(()=>be(r,de()).pow(2.5))(),Qe.add(this)}onDebug({gui:e}){}onRenderedReady(){this.visible=!0}onRaf({gl:e,delta:i}){if(e.hasStarted===!1)return;const a=x.sections.threeProgress.value>0,s=x.sections.fourthProgress.value===0;this.visible=a&&s&&!x.inSubpage,this.visible!==!1&&(this.progress.value=Math.min(1,x.sections.threeProgress.value+14/200))}onResize(){}dispose(){super.dispose()}}_(.05);class wl extends ze(Xe,{raf:{renderPriority:2,fps:yt}}){init(){const e=ce.resources.paw_surface_shockwave.asset,i=e.scene.clone();if(this.mixer=new Ds(i),this.animations=e.animations,this.progress=0,this.animations.length>0)for(const n of this.animations)this.mixer.clipAction(n).play();const a=i.children[1],s=i.children[0];this.groundDust=a,s.material=new wt({side:Yt,reflectivity:0,refractionRatio:0,blending:zn,blendEquation:Vn,blendSrc:On,blendDst:Un,transparent:!0,depthWrite:!1}),s.renderOrder=-10001,this.groundWave=s,a.material=new wt({side:gt,reflectivity:0,refractionRatio:0,blending:zn,blendEquation:Vn,blendSrc:On,blendDst:Un,transparent:!0,depthWrite:!1}),a.renderOrder=-1e4,this.dustProgress=O(0);const t=O(us("#ff9500"));a.material.outputNode=$(()=>{const n=this.dustProgress.oneMinus(),r=Se.y.smoothstep(0,.1).oneMinus(),o=vt.x.abs().add(vt.z).sub(.4).abs().mul(n).smoothstep(0,this.dustProgress).oneMinus().mul(r);return j(H(o).mul(r.mix(t.mul(20),H(3)).mul(r)),o)})(),s.material.outputNode=$(()=>{const n=vt.y.smoothstep(0,.05).oneMinus();return j(H(n).mul(n.mul(.5).mix(t.mul(20),H(1))).mul(this.dustProgress.smoothstep(0,.5).oneMinus()),n)})(),this.add(i),Qe.add(this)}onDebug({gui:e}){}onRenderedReady(){this.visible=!0}onRaf({gl:e,delta:i}){if(e.hasStarted===!1)return;const a=x.sections.threeProgress.value>0,s=x.sections.fourthProgress.value===0;this.visible=a&&s&&!x.inSubpage,this.visible!==!1&&(this.progress=Math.min(1,x.sections.threeProgress.value+14/150),this.mixer&&this.mixer.setTime(ot(14,27,this.progress*150)*this.animations[0].duration),this.dustProgress.value=ot(21,33,this.progress*150),this.groundDust.position.y=-.032781-ot(27,33,this.progress*150)*.3,this.groundWave.visible=this.dustProgress.value<1,this.groundDust.visible=this.dustProgress.value<1)}onResize(){}dispose(){super.dispose()}}class Sl extends ze(Xe,{raf:{renderPriority:2,fps:yt}}){init(){const i=ce.resources.paw_surface_small.asset.scene.children,a=[];for(let r=0;r<i.length;r++)a.push(i[r]);const{mesh:s,_positionRead:t,progress:n}=new Mn(a,"bake_moon_surface_small",200,!1);this.mesh=s,this.progress=n,this.add(s),this.mesh=s,this.add(s),Qe.add(this)}onDebug({gui:e}){}onRenderedReady(){this.visible=!0}onRaf({gl:e,delta:i}){if(e.hasStarted===!1)return;const a=x.sections.threeProgress.value>0,s=x.sections.fourthProgress.value===0;this.visible=a&&s&&!x.inSubpage,this.visible!==!1&&(this.progress.value=Math.min(1,x.sections.threeProgress.value+5/200))}onResize(){}dispose(){super.dispose()}}const ao=new lt,co=new W;class Tl extends ze(Kt,{raf:{renderPriority:1,fps:1/0}}){async init(){this.flickerSpeed=.3,this.flickerTime=0,this.lerpFactor=.075;const e=new Zt(10,10,20,20),i=new vs({visible:!1,depthWrite:!1,depthTest:!0,transparent:!0,wireframe:!0});this.plane=new Ct(e,i),this.renderOrder=9999,this.raycaster=new sa,this.add(this.plane),this.plane.rotation.x=.168;const{camera:a}=se();this.lookAt(a.position),this.mouse=new Ce(0,0),this.plane.position.z=.9,this.pointLightIntensity=.18,this.pointLightDistance=.43,this.pointLightDecay=1.68,this.initialColor=new he(16777215),this.pointLight=new wo(16777215,this.pointLightIntensity,this.pointLightDistance,this.pointLightDecay),this.pointLightHelper=new ia(this.pointLight,.1),Qe.add(this.pointLight),Qe.add(this),this.lightSettings={section1:{color:new he(356863),intensity:.24,instant:!1},section2:{disabled:!0},section3:{disabled:!0},section4:{disabled:!0},section5:{disabled:!0},subpage:{color:new he(65280),intensity:.18,instant:!0}},this.isDebugging=!1}onDebug({gui:e}){e&&(this.folder=e.addFolder("Point Light"),this.folder.close(),this.folder.add(this,"isDebugging",!1).name("Manual Control"),this.folder.add(this.pointLight,"intensity",0,2).name("pointLightIntensity"),this.folder.add(this.pointLight,"distance",0,2).name("pointLightDistance"),this.folder.add(this.pointLight,"decay",0,2).name("pointLightDecay"),this.folder.addColor(this.pointLight,"color").name("pointLightColor"))}getLightSettingsForSection(e){return this.lightSettings[e]}instantChange({color:e,intensity:i}){this.pointLight.color.copy(e),this.pointLight.intensity=i}onRaf({gl:e,elapsedTime:i,delta:a}){const{inSubpage:s,sections:t}=x,n=s?"subpage":t?.current,r=this.getLightSettingsForSection(n),{pointer:o,camera:c}=se();this.lookAt(c.position);const{slowMoLerp:l,pointerLerpDelta:u}=se();x.pointerDelta.value=Math.min(u.length()*l.value,.4),x.aspectRatio.value=Me.width/Me.height,x.normalizedPointer.value.copy(o.normalized),ao.identity().premultiply(c.matrixWorldInverse).premultiply(c.projectionMatrix),x.screenSpaceMatrix.value=ao,this.plane.updateMatrixWorld(),this.raycaster.setFromCamera(o.normalized,c);const h=this.raycaster.intersectObject(this.plane,!1)[0];if(!h)return;if(co.copy(h.point),this.pointLight.position.lerp(co,this.lerpFactor),o.world.copy(h.point),r?.disabled){this.pointLight.visible=!1,this.pointLight.intensity=0;return}if(this.isDebugging)return;this.flickerTime+=a*this.flickerSpeed;const d=Math.sin(this.flickerTime*1)*.05+Math.sin(this.flickerTime*2.3)*.001+Math.sin(this.flickerTime*3.7)*.025;this.pointLight.visible=!0,r.instant?this.instantChange(r):(this.pointLight.color.lerp(r.color,a*2),this.pointLight.intensity=te.damp(this.pointLight.intensity,r.intensity+d,5,a)),this.pointLightHelper?.update()}onResize(){}dispose(){super.dispose(),Qe.remove(this.pointLightHelper),Qe.remove(this.pointLight)}}const _l=()=>{const p=x.sections.fourthProgress.value>0,e=x.sections.fiveProgress.value===0;return p&&e||x.inSubpage},Pl=p=>{const{speed:e}=se(),{globalTimer:i,sections:a}=x;return p+=i.value*.15*(1+e.value+a.fourthProgress.value*2)*Math.max(.2,e.value),p},Al=new lt,Bs=new as;class Qi extends ze(Xe,{raf:{renderPriority:1,fps:1/0}}){init(e,i){this.elapsedTime=O(0),this.disableTileAnimation=O(0);const a=e.scene.clone().children;this.position.y=-.04;const s=5,t=a.reduce((C,M)=>(C.vertex+=M.geometry.attributes.position.count,C.index+=M.geometry.index.count,C),{vertex:0,index:0}),n=a.length,r=t.vertex,o=t.index,c=new Qt({color:16777215,side:gt,wireframe:!1}),l=new tr(n,r,o,c);l._colorsTexture=null,l.userData.animations=[],l.userData.meshLocals=a,l.perObjectFrustumCulled=!1,e.animations;const u=120,h=se().isWebGPU&&!se().isMobileOrTablet?3:2;l.isInstancedMesh=!0,l.count=h,l.receiveShadow=!0;const d=new Float32Array(n*4);for(let C=0;C<n;C++){const M=a[C];l.addGeometry(M.geometry),l.setInstanceCountAt(C,h),l.getBoundingSphereAt(C,Bs).applyMatrix4(Al),d[C*4+0]=Bs.center.x,d[C*4+1]=Bs.center.y,d[C*4+2]=Bs.center.z,d[C*4+3]=Bs.radius}const f=new Ws(d,4),g=10,m=_(1);l.frustumCulled=!1,l.batchingIdNode||(l.batchingIdNode=nt("batchId","uint")),zi(H()),zi(H()),zi(H());let v;const w=ct(f,"vec4",n).toReadOnly();if(se().isWebGPU&&!se().isMobileOrTablet){this.pointerSize=O(.2),this.isWithinCollisionRadius=$(([X,D,N,L,V])=>{const B=Es(!1).toVar(),K=j(D,1),Z=L.mul(K);return re(Z.w.greaterThan(0),()=>{const le=Z.xyz.div(Z.w).toVar(),Q=q(le.x,le.y).toVar(),ie=j(X,1),J=L.mul(ie);re(J.w.greaterThan(0),()=>{const Y=J.xyz.div(J.w),ee=q(Y.x,Y.y),fe=Q.x.mul(V),ae=ee.x.mul(V),me=fe.sub(ae),pe=Q.y.sub(ee.y),ne=me.mul(me).add(pe.mul(pe)),Te=N.mul(L[0][0]).div(Z.w),Oe=Te.mul(Te);B.assign(ne.lessThanEqual(Oe))})}),B}).setLayout({name:"isWithinCollisionRadius",type:"bool",inputs:[{name:"pointPosition",type:"vec3"},{name:"collidePoint",type:"vec3"},{name:"collideRadius",type:"float"},{name:"screenSpaceMatrix",type:"mat4"},{name:"aspectRatio",type:"float"}]}),this.isPositionInCircle=$(([X,D,N,L])=>{const V=Es(!1).toVar(),B=D.toVar(),K=N.mul(L),Z=X.x.mul(L),Q=B.x.mul(L).sub(Z),ie=B.y.sub(X.y),J=Q.mul(Q).add(ie.mul(ie));return V.assign(J.lessThanEqual(K.mul(K))),V}).setLayout({name:"isPositionInCircle",type:"bool",inputs:[{name:"screenPosition",type:"vec2"},{name:"pointerPosition",type:"vec2"},{name:"pointerSize",type:"float"},{name:"aspectRatio",type:"float"}]});const C=h,M=new Dt(n*C,3),z=ct(M,"vec3",n*C),b=new Ws(new Float32Array(n*C*3),3),F=ct(b,"vec3",b.count).label("positionStorage");v=ct(b,"vec3",b.count).toReadOnly();const R=new Ws(new Float32Array(n*C),1),E=ct(R,"float",R.count),I=(X,D,N)=>{const L=[H(0,0),H(0,0,4),H(0,0,8),H(0,0,12)],V=_(1).add(se().slowMoLerp.mul(1.5)).toVar(),B=x.screenSpaceMatrix.mul(X),K=this.isWithinCollisionRadius(X,L[0],V,x.screenSpaceMatrix,x.aspectRatio),Z=this.isWithinCollisionRadius(X,L[1],V,x.screenSpaceMatrix,x.aspectRatio),le=this.isWithinCollisionRadius(X,L[2],V,x.screenSpaceMatrix,x.aspectRatio),Q=this.isWithinCollisionRadius(X,L[3],V,x.screenSpaceMatrix,x.aspectRatio);re(B.w.greaterThan(0).and(K.not().or(this.disableTileAnimation.lessThan(1))).and(Z.not().or(this.disableTileAnimation.lessThan(1))).and(le.not().or(this.disableTileAnimation.lessThan(1))).and(Q.not().or(this.disableTileAnimation.lessThan(1))),()=>{const ie=B.xyz.div(B.w),J=q(ie.x,ie.y),Y=N.mul(x.screenSpaceMatrix[0][0]).div(B.w),ee=this.pointerSize.add(Y);re(this.isPositionInCircle(J,x.normalizedPointer,ee,x.aspectRatio),()=>{const fe=x.normalizedPointer.toVar(),ae=ee.mul(x.aspectRatio),me=J.x.mul(x.aspectRatio),ne=fe.x.mul(x.aspectRatio).sub(me),Te=fe.y.sub(J.y),Oe=ne.mul(ne).add(Te.mul(Te)),ke=q(ne,Te),Ie=Oe.sqrt(),Ee=_(1).sub(je(_(0),ae,Ie)),Ae=ke.div(Ie),xe=_(5.5).mul(N.div(_(1))),We=Ae.mul(Ee).mul(se().slowMoLerp).mul(xe.negate());D.x.addAssign(We.x),D.y.addAssign(We.y);const ue=_(1.1),Fe=D.dot(D);re(Fe.greaterThan(ue.mul(ue)),()=>{D.mulAssign(ue.div(Fe.sqrt()))})})})},U=se().slowMoLerp,G=$(()=>{const X=oe.toFloat().div(n).floor(),D=Ye(it(oe).modInt(n)),N=z.element(oe);return $(()=>{const V=F.element(oe),B=E.element(oe),K=w.element(D),Z=K.w,le=_(g).toVar(),Q=_(2.4).toVar(),ie=Q.mul(_(h)),J=_(X).toVar(),Y=_(Ns(this.elapsedTime.sub(Q),ie.sub(Q)).add(Q)).toVar(),ee=_(20*s).sub(.01).toVar(),fe=_(ee.mul(_(h))).toVar(),ae=_(1/120).toVar(),pe=_(.95).toVar().pow(Ps.mul(U).div(ae));V.mulAssign(pe),N.mulAssign(pe);const ne=Y.div(ie).mul(fe).sub(ee.mul(J.add(1).sub(.5))).sub(ee.mul(.05)).toVar(),Te=J.mul(Q).toVar(),Oe=Y.lessThan(B);re(Oe,()=>{V.assign(H(0,0,0)),N.assign(H(0,0,0))});const ke=Y.sub(Te).add(x.sections.fourthProgress.smoothstep(x.fourthAnimBreakPointStart,x.fourthAnimBreakPointEnd).mul(this.disableTileAnimation)).mul(this.disableTileAnimation).div(le).saturate().toVar(),Ie=_(u).mul(ke.add(x.sections.fourthProgress.smoothstep(x.fourthAnimBreakPointStart+.1,x.fourthAnimBreakPointEnd).mul(this.disableTileAnimation))).toVar(),Ee=it(Ie.floor()).toVar(),Ae=it(Ee.mul(4)).toVar(),qe=it(D).toVar(),xe=Ge(i,Le(Ae,qe)).toVar(),We=Ge(i,Le(Ae.add(1),qe)).toVar(),ue=Ge(i,Le(Ae.add(2),qe)).toVar(),Fe=Ge(i,Le(Ae.add(3),qe)).toVar(),we=Et(xe,We,ue,Fe).toVar(),_e=H(we.mul(K.xyz).xyz).mul(s).toVar();_e.z.subAssign(ne),_e.y.subAssign(.28),_e.addAssign(V),I(_e,N,Z),V.addAssign(N),F.element(oe).assign(V),B.assign(Y)})().compute(n*C)});l.material.geometryNode=G()}const T=Ye(l.batchingIdNode),y=oe.toFloat().mul(n).toVar(),S=T.add(Ye(y));l.material.positionNode=$(()=>{const C=_(g).toVar(),M=_(2.4).toVar(),z=M.mul(_(h)),b=_(Ns(this.elapsedTime.sub(M),z.sub(M)).add(M)).toVar(),F=_(oe).toVar(),R=_(20*s).sub(.01).toVar(),E=_(R.mul(_(h))).toVar(),I=b.div(z).mul(E).sub(R.mul(F.add(1).sub(.5))).sub(R.mul(.05)),U=F.mul(M).toVar(),G=b.sub(U).add(x.sections.fourthProgress.smoothstep(x.fourthAnimBreakPointStart,x.fourthAnimBreakPointEnd).mul(Se.x.abs().smoothstep(0,3).oneMinus()).mul(this.disableTileAnimation)).mul(this.disableTileAnimation).div(C).saturate().toVar(),X=_(u).mul(G.add(x.sections.fourthProgress.smoothstep(x.fourthAnimBreakPointStart+.1,x.fourthAnimBreakPointEnd).mul(this.disableTileAnimation)).saturate()).toVar(),D=it(X.floor()).toVar(),N=it(D.mul(4)).toVar(),L=it(T).toVar(),V=Ge(i,Le(N,L)).toVar(),B=Ge(i,Le(N.add(1),L)).toVar(),K=Ge(i,Le(N.add(2),L)).toVar(),Z=Ge(i,Le(N.add(3),L)).toVar();re(D.lessThan(u).and(m.greaterThan(0)),()=>{const ee=it(D.add(1).mul(4)).toVar(),fe=Ge(i,Le(ee,L)),ae=Ge(i,Le(ee.add(1),L)),me=Ge(i,Le(ee.add(2),L)),pe=Ge(i,Le(ee.add(3),L)),ne=X.fract().toVar();V.assign(Pe(V,fe,ne)),B.assign(Pe(B,ae,ne)),K.assign(Pe(K,me,ne)),Z.assign(Pe(Z,pe,ne))});const le=Et(V,B,K,Z).toVar(),Q=H(le.mul(Se).xyz).mul(s).toVar();if(Q.z.subAssign(I),Q.y.subAssign(.28),v!==void 0){const ee=v.element(S);Q.addAssign(ee)}const ie=Et(V,B,K,Z).toVar();ie.element(3).element(0).assign(Q.x),ie.element(3).element(1).assign(Q.y),ie.element(3).element(2).assign(Q.z);const J=Wo(ie).toVar(),Y=Wt.div(H(J[0].dot(J[0]),J[1].dot(J[1]),J[2].dot(J[2]))).toVar();return Se.assign(Q),Wt.assign(J.mul(Y).xyz),Zs.assign(Zs.mul(J)),Se})(),l.material.normalNode=$(()=>Mt(be(ce.resources.concrete.asset,de().mul(5))).toVar())(),l.material.colorNode=$(()=>{const C=be(ce.resources.surface_albedo.asset,de());return v===void 0?C:v.element(S).length().mul(10).mix(C,us(16731136))})();const A=ce.resources.surface_albedo.asset,P=O(3.2),k=O(1.95);xl(P,k).saturate(),l.material.colorNode=$(()=>be(A,de()))(),this.add(l),Qe.add(this)}onRenderedReady(){this.visible=!1}bakeAnimation(e){const i=ce.resources.moon_xl.asset,a=new Ds(i.scene),s=i.animations,t=e.length,n=120,r=16,o=new Float32Array(n*r*t),c=new lt;for(let m=0;m<t;m++){const v=s[m],w=a.clipAction(v);w.play();const T=w._clip.duration;for(let y=0;y<n;y++){w.time=y/n*T,a.update(0);const S=e[m];if(!S)continue;c.compose(S.position,S.quaternion,S.scale);const A=m*n*r+y*r;o.set(c.elements,A)}}let l=0,u=0;for(let m=0;m<o.length;m++)o[m]<l&&(l=o[m]),o[m]>u&&(u=o[m]);const h=new As(o,n*4,s.length,Ys,Si),d=new Ho;async function f(){const m=os,v=Xo,w=await d.parse(h,{type:m,compression:v});g(w,"surface_xl_bake_120.exr")}function g(m,v){const w=new Blob([m],{type:"image/x-exr"}),T=document.createElement("a");T.href=URL.createObjectURL(w),T.download=v,T.click()}f()}onRaf({gl:e,delta:i}){if(e.hasStarted===!1)return;const{inSubpage:a,globalTimer:s}=x;this.visible=_l(),this.elapsedTime.value=a?this.elapsedTime.value+s.value*.008:Pl(this.elapsedTime.value),this.disableTileAnimation.value=a?0:1}onResize(){}dispose(){super.dispose(),this.gui&&this.gui.destroy()}}class Ml extends ze(Xe,{raf:{renderPriority:2,fps:yt}}){async init(){const e=ce.resources.temple_portal.asset.scene.clone();An(e),this.surface=e,this.add(e),Qe.add(this)}onRenderedReady(){this.visible=!1}onRaf({gl:e}){if(e.hasStarted===!1)return;const i=x.sections.fiveProgress.value;this.visible=!x.inSubpage&&i>0}onResize(){}dispose(){super.dispose(),this.gui&&this.gui.destroy()}}class Rl extends ze(Xe,{raf:{renderPriority:2,fps:yt}}){async init(){const e=ce.resources.temple_moon.asset.scene.clone();this.surface=e;const i=new Qt({color:16777215,side:Yt});i.normalNode=Mt(be(ce.resources.concrete.asset,de().mul(5))),i.colorNode=vt.y.abs().smoothstep(0,.1).mix(H(.18),be(ce.resources.temple_moon.asset.scene.children[0].material.emissiveMap).pow(1.3)),e.traverse(C=>{C.isMesh&&(C.material=i)});const a=new Zt(100,100,2,2),s=ce.resources.water_normals.asset;s.wrapS=s.wrapT=pt,s.needsUpdate=!0,this.waterNormals=be(s);const t=new wt({color:16777215,transparent:!0});this.distortionScale=O(10),this.size=O(10),this.sunDirection=O(new W(.70707,.70707,0)),this.waterColor=O(new he(7695));const n=Ls,o=$(([C])=>{const M=Xs(mt(C,103),q(mt(n,17),mt(n,29))).toVar(),z=mt(C,107).sub(q(mt(n,-19),mt(n,31))).toVar(),b=Xs(mt(C,q(8907,9803)),q(mt(n,101),mt(n,97))).toVar(),F=Gt(mt(C,q(1091,1027)),q(mt(n,109),mt(n,-113))).toVar(),R=Mt(this.waterNormals.uv(M)),E=Mt(this.waterNormals.uv(z)),I=Mt(this.waterNormals.uv(b)),U=Mt(this.waterNormals.uv(F));return R.add(E).add(I).add(U).mul(.5).sub(1)})(vt.xz.mul(this.size)),c=di(o.xzy.mul(1.5,1,1.5)),l=H(0).toVar(),u=H(0).toVar(),h=ni.sub(vt),d=di(h),f=di(na(this.sunDirection.negate(),c)),g=rs(0,tt(d,f));u.addAssign(wi(g,100).mul(2)),l.addAssign(rs(tt(this.sunDirection,c),0).mul(.5));const m=c.xy.mul(_(.005)).mul(this.distortionScale),v=_(ni.z).div(At.x.lessThanEqual(x.spBreakPoint).select(16,13.5)),w=gi(vt.z.greaterThan(0).select(Ze.flipY().sub(q(0,_(-.54).div(v).add(ni.z.smoothstep(9,30).mul(.05)).add(_(.007).div(v).mul(_(x.cameraFov.toVar().sub(40).min(50)))))).add(m),Ze.sub(q(-.03,_(-.06).add(ni.z.smoothstep(10,25).mul(.05).div(v)))).add(m))).mul(vt.z.smoothstep(-4,0)).mul(vt.x.abs().smoothstep(1.5,5).oneMinus()),T=rs(tt(d,c),0),y=_(.3),S=Ot(wi(_(1).sub(T),5),_(1).sub(y)).add(y),A=rs(0,tt(c,d)).mul(this.waterColor),P=Pe(l.add(A),w.rgb.mul(vt.z.smoothstep(-10,0)).mul(u).add(w.rgb.mul(1.9).mul(vt.z.smoothstep(-10,0))).add(H(.1)).add(A),S);$(()=>j(P.rgb.mul(4),.2))(),t.outputNode=j(Io(H(1),_(.05)).mix(P.rgb.mul(4),x.fogOutputColor),.2),c.xy.mul(_(.003)).mul(this.distortionScale),t.backdropNodeAlpha=_(1),t.backdropNode=gi(Ze.mul(10));const k=new Ct(a,t);k.rotation.x=-Math.PI/2,e.position.y-=.02,this.add(k),this.add(e),Qe.add(this)}onRenderedReady(){this.visible=!1}onRaf({gl:e}){if(e.hasStarted===!1)return;const i=x.sections.fiveProgress.value;this.visible=!x.inSubpage&&i>0}onResize(){}dispose(){super.dispose(),this.gui&&this.gui.destroy()}}class Cl extends ze(Ti){constructor(){super(50,0,.1,20)}init(){const e=ce.resources.logo.asset.scene.children[0];this.renderReady=!1,this.closeInvertlogoRotation=!1,this._logoRotation=0,this.logo=new Ct(e.geometry,new _n({color:16777215,side:Yt,ior:1.76,dispersion:5,thickness:2.27,roughness:.4,metalness:.6,transmission:.1,envMapIntensity:1})),this.logoGroup=new Kt,this.logoGroup.add(this.logo),this.add(new gn(16777215,3)),this.add(this.logoGroup),Bt({sceneMenu:this}),this._patchLogoMask()}_patchLogoMask(){const{sceneMenu:e,cameraMenu:i,animMenu:a,gl:s}=se(),t=$(()=>{const o=s.pass.getTextureNode("output"),c=de().toVar(),l=j(o.uv(c)).toVar(),u=l.toVar();if(s.tFluid!==void 0){const h=Lt(q(_(.5).sub(de().x),_(.5).sub(de().y))).toVar(),d=Tn(_(.5).sub(de().x),_(.5).sub(de().y)).toVar(),f=Lt(s.tFluid.rg).mul(.001).toVar(),g=je(0,.03,h),m=f.mul(g).toVar(),v=q(q(rt(d),st(d)).mul(m)).toVar(),w=j(.8,.6,.9,1).toVar(),T=j(.2,.3,.8,1).toVar(),y=j(o.uv(c.add(v))).mul(w).toVar(),S=j(o.uv(c.sub(v))).mul(T).toVar(),A=Pe(y,S,Lt(v).mul(2)).toVar();u.assign(Pe(l,A,m.mul(50)))}return u.mul(2)})(),n=Eo(this,i),r=n.a.mix(j(H(0,.008,.012),1),a.mix(s.outputPass,j(.5).mix(t,n)));s.postProcessing.outputNode=a.greaterThan(.01).select(r,s.outputPass),s.postProcessing.needsUpdate=!0}onMenuOpen({open:e}){!e&&this._logoRotation>Math.PI&&(this.closeInvertlogoRotation=!0)}onRenderedReady(){this.renderReady=!0,this.visible=!1}onResize({ratio:e}){}onRaf({progress:e,elapsedTime:i}){if(this.logo&&this.renderReady){const{animMenu:a}=se();let s=Math.max(0,-.3+a.value*1.3)*Math.PI*1.5;const t=ot(0,1,a.value);this.visible=a.value>.01,a.value<.01&&(this.closeInvertlogoRotation=!1,this._logoRotation=0),this._logoRotation=(this._logoRotation+.005)%(Math.PI*2),this.logoGroup.rotation.y=this._logoRotation*(this.closeInvertlogoRotation?Yo(t):t),this.logo.rotation.y=s}}}const lo={};function Il(p){let e=lo[p];if(!e){const i=new Zt(1,1,p,p),a=i.clone(),s=i.attributes,t=a.attributes,n=new Ts,r=s.uv.count;for(let o=0;o<r;o++)t.position.array[o*3]*=-1,t.normal.array[o*3+2]*=-1;["position","normal","uv"].forEach(o=>{n.setAttribute(o,new ra([...s[o].array,...t[o].array],s[o].itemSize))}),n.setIndex([...i.index.array,...a.index.array.map(o=>o+r)]),n.translate(.5,.5,0),e=lo[p]=n}return e}const Fl="aTroikaGlyphBounds",uo="aTroikaGlyphIndex",kl="aTroikaGlyphColor";class El extends oa{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new as,this.boundingBox=new Cs}computeBoundingSphere(){}computeBoundingBox(){}setSide(e){const i=this.getIndex().count;this.setDrawRange(e===xn?i/2:0,e===Yt?i:i/2)}set detail(e){if(e!==this._detail){this._detail=e,(typeof e!="number"||e<1)&&(e=1);let i=Il(e);["position","normal","uv"].forEach(a=>{this.attributes[a]=i.attributes[a].clone()}),this.setIndex(i.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,i,a,s,t){Ji(this,Fl,e,4),Ji(this,uo,i,1),Ji(this,kl,t,3),this._blockBounds=a,this._chunkedBounds=s,this.instanceCount=i.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:i,boundingBox:a}=this;if(i){const{PI:s,floor:t,min:n,max:r,sin:o,cos:c}=Math,l=s/2,u=s*2,h=Math.abs(i),d=e[0]/h,f=e[2]/h,g=t((d+l)/u)!==t((f+l)/u)?-h:n(o(d)*h,o(f)*h),m=t((d-l)/u)!==t((f-l)/u)?h:r(o(d)*h,o(f)*h),v=t((d+s)/u)!==t((f+s)/u)?h*2:r(h-c(d)*h,h-c(f)*h);a.min.set(g,e[1],i<0?-v:0),a.max.set(m,e[3],i<0?0:v)}else a.min.set(e[0],e[1],0),a.max.set(e[2],e[3],0);a.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let i=this.getAttribute(uo).count,a=this._chunkedBounds;if(a)for(let s=a.length;s--;){i=a[s].end;let t=a[s].rect;if(t[1]<e.w&&t[3]>e.y&&t[0]<e.z&&t[2]>e.x)break}this.instanceCount=i}}function Ji(p,e,i,a){const s=p.getAttribute(e);i?s&&s.array.length===i.length?(s.array.set(i),s.needsUpdate=!0):(p.setAttribute(e,new yn(i,a)),delete p._maxInstanceCount,p.dispose()):s&&p.deleteAttribute(e)}/*!
Custom build of Typr.ts (https://github.com/fredli74/Typr.ts) for use in Troika text rendering.
Original MIT license applies: https://github.com/fredli74/Typr.ts/blob/master/LICENSE
*/function Nl(){return typeof window>"u"&&(self.window=self),function(p){var e={parse:function(s){var t=e._bin,n=new Uint8Array(s);if(t.readASCII(n,0,4)=="ttcf"){var r=4;t.readUshort(n,r),r+=2,t.readUshort(n,r),r+=2;var o=t.readUint(n,r);r+=4;for(var c=[],l=0;l<o;l++){var u=t.readUint(n,r);r+=4,c.push(e._readFont(n,u))}return c}return[e._readFont(n,0)]},_readFont:function(s,t){var n=e._bin,r=t;n.readFixed(s,t),t+=4;var o=n.readUshort(s,t);t+=2,n.readUshort(s,t),t+=2,n.readUshort(s,t),t+=2,n.readUshort(s,t),t+=2;for(var c=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],l={_data:s,_offset:r},u={},h=0;h<o;h++){var d=n.readASCII(s,t,4);t+=4,n.readUint(s,t),t+=4;var f=n.readUint(s,t);t+=4;var g=n.readUint(s,t);t+=4,u[d]={offset:f,length:g}}for(h=0;h<c.length;h++){var m=c[h];u[m]&&(l[m.trim()]=e[m.trim()].parse(s,u[m].offset,u[m].length,l))}return l},_tabOffset:function(s,t,n){for(var r=e._bin,o=r.readUshort(s,n+4),c=n+12,l=0;l<o;l++){var u=r.readASCII(s,c,4);c+=4,r.readUint(s,c),c+=4;var h=r.readUint(s,c);if(c+=4,r.readUint(s,c),c+=4,u==t)return h}return 0}};e._bin={readFixed:function(s,t){return(s[t]<<8|s[t+1])+(s[t+2]<<8|s[t+3])/65540},readF2dot14:function(s,t){return e._bin.readShort(s,t)/16384},readInt:function(s,t){return e._bin._view(s).getInt32(t)},readInt8:function(s,t){return e._bin._view(s).getInt8(t)},readShort:function(s,t){return e._bin._view(s).getInt16(t)},readUshort:function(s,t){return e._bin._view(s).getUint16(t)},readUshorts:function(s,t,n){for(var r=[],o=0;o<n;o++)r.push(e._bin.readUshort(s,t+2*o));return r},readUint:function(s,t){return e._bin._view(s).getUint32(t)},readUint64:function(s,t){return 4294967296*e._bin.readUint(s,t)+e._bin.readUint(s,t+4)},readASCII:function(s,t,n){for(var r="",o=0;o<n;o++)r+=String.fromCharCode(s[t+o]);return r},readUnicode:function(s,t,n){for(var r="",o=0;o<n;o++){var c=s[t++]<<8|s[t++];r+=String.fromCharCode(c)}return r},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(s,t,n){var r=e._bin._tdec;return r&&t==0&&n==s.length?r.decode(s):e._bin.readASCII(s,t,n)},readBytes:function(s,t,n){for(var r=[],o=0;o<n;o++)r.push(s[t+o]);return r},readASCIIArray:function(s,t,n){for(var r=[],o=0;o<n;o++)r.push(String.fromCharCode(s[t+o]));return r},_view:function(s){return s._dataView||(s._dataView=s.buffer?new DataView(s.buffer,s.byteOffset,s.byteLength):new DataView(new Uint8Array(s).buffer))}},e._lctf={},e._lctf.parse=function(s,t,n,r,o){var c=e._bin,l={},u=t;c.readFixed(s,t),t+=4;var h=c.readUshort(s,t);t+=2;var d=c.readUshort(s,t);t+=2;var f=c.readUshort(s,t);return t+=2,l.scriptList=e._lctf.readScriptList(s,u+h),l.featureList=e._lctf.readFeatureList(s,u+d),l.lookupList=e._lctf.readLookupList(s,u+f,o),l},e._lctf.readLookupList=function(s,t,n){var r=e._bin,o=t,c=[],l=r.readUshort(s,t);t+=2;for(var u=0;u<l;u++){var h=r.readUshort(s,t);t+=2;var d=e._lctf.readLookupTable(s,o+h,n);c.push(d)}return c},e._lctf.readLookupTable=function(s,t,n){var r=e._bin,o=t,c={tabs:[]};c.ltype=r.readUshort(s,t),t+=2,c.flag=r.readUshort(s,t),t+=2;var l=r.readUshort(s,t);t+=2;for(var u=c.ltype,h=0;h<l;h++){var d=r.readUshort(s,t);t+=2;var f=n(s,u,o+d,c);c.tabs.push(f)}return c},e._lctf.numOfOnes=function(s){for(var t=0,n=0;n<32;n++)s>>>n&1&&t++;return t},e._lctf.readClassDef=function(s,t){var n=e._bin,r=[],o=n.readUshort(s,t);if(t+=2,o==1){var c=n.readUshort(s,t);t+=2;var l=n.readUshort(s,t);t+=2;for(var u=0;u<l;u++)r.push(c+u),r.push(c+u),r.push(n.readUshort(s,t)),t+=2}if(o==2){var h=n.readUshort(s,t);for(t+=2,u=0;u<h;u++)r.push(n.readUshort(s,t)),t+=2,r.push(n.readUshort(s,t)),t+=2,r.push(n.readUshort(s,t)),t+=2}return r},e._lctf.getInterval=function(s,t){for(var n=0;n<s.length;n+=3){var r=s[n],o=s[n+1];if(s[n+2],r<=t&&t<=o)return n}return-1},e._lctf.readCoverage=function(s,t){var n=e._bin,r={};r.fmt=n.readUshort(s,t),t+=2;var o=n.readUshort(s,t);return t+=2,r.fmt==1&&(r.tab=n.readUshorts(s,t,o)),r.fmt==2&&(r.tab=n.readUshorts(s,t,3*o)),r},e._lctf.coverageIndex=function(s,t){var n=s.tab;if(s.fmt==1)return n.indexOf(t);if(s.fmt==2){var r=e._lctf.getInterval(n,t);if(r!=-1)return n[r+2]+(t-n[r])}return-1},e._lctf.readFeatureList=function(s,t){var n=e._bin,r=t,o=[],c=n.readUshort(s,t);t+=2;for(var l=0;l<c;l++){var u=n.readASCII(s,t,4);t+=4;var h=n.readUshort(s,t);t+=2;var d=e._lctf.readFeatureTable(s,r+h);d.tag=u.trim(),o.push(d)}return o},e._lctf.readFeatureTable=function(s,t){var n=e._bin,r=t,o={},c=n.readUshort(s,t);t+=2,c>0&&(o.featureParams=r+c);var l=n.readUshort(s,t);t+=2,o.tab=[];for(var u=0;u<l;u++)o.tab.push(n.readUshort(s,t+2*u));return o},e._lctf.readScriptList=function(s,t){var n=e._bin,r=t,o={},c=n.readUshort(s,t);t+=2;for(var l=0;l<c;l++){var u=n.readASCII(s,t,4);t+=4;var h=n.readUshort(s,t);t+=2,o[u.trim()]=e._lctf.readScriptTable(s,r+h)}return o},e._lctf.readScriptTable=function(s,t){var n=e._bin,r=t,o={},c=n.readUshort(s,t);t+=2,c>0&&(o.default=e._lctf.readLangSysTable(s,r+c));var l=n.readUshort(s,t);t+=2;for(var u=0;u<l;u++){var h=n.readASCII(s,t,4);t+=4;var d=n.readUshort(s,t);t+=2,o[h.trim()]=e._lctf.readLangSysTable(s,r+d)}return o},e._lctf.readLangSysTable=function(s,t){var n=e._bin,r={};n.readUshort(s,t),t+=2,r.reqFeature=n.readUshort(s,t),t+=2;var o=n.readUshort(s,t);return t+=2,r.features=n.readUshorts(s,t,o),r},e.CFF={},e.CFF.parse=function(s,t,n){var r=e._bin;(s=new Uint8Array(s.buffer,t,n))[t=0],s[++t],s[++t],s[++t],t++;var o=[];t=e.CFF.readIndex(s,t,o);for(var c=[],l=0;l<o.length-1;l++)c.push(r.readASCII(s,t+o[l],o[l+1]-o[l]));t+=o[o.length-1];var u=[];t=e.CFF.readIndex(s,t,u);var h=[];for(l=0;l<u.length-1;l++)h.push(e.CFF.readDict(s,t+u[l],t+u[l+1]));t+=u[u.length-1];var d=h[0],f=[];t=e.CFF.readIndex(s,t,f);var g=[];for(l=0;l<f.length-1;l++)g.push(r.readASCII(s,t+f[l],f[l+1]-f[l]));if(t+=f[f.length-1],e.CFF.readSubrs(s,t,d),d.CharStrings){t=d.CharStrings,f=[],t=e.CFF.readIndex(s,t,f);var m=[];for(l=0;l<f.length-1;l++)m.push(r.readBytes(s,t+f[l],f[l+1]-f[l]));d.CharStrings=m}if(d.ROS){t=d.FDArray;var v=[];for(t=e.CFF.readIndex(s,t,v),d.FDArray=[],l=0;l<v.length-1;l++){var w=e.CFF.readDict(s,t+v[l],t+v[l+1]);e.CFF._readFDict(s,w,g),d.FDArray.push(w)}t+=v[v.length-1],t=d.FDSelect,d.FDSelect=[];var T=s[t];if(t++,T!=3)throw T;var y=r.readUshort(s,t);for(t+=2,l=0;l<y+1;l++)d.FDSelect.push(r.readUshort(s,t),s[t+2]),t+=3}return d.Encoding&&(d.Encoding=e.CFF.readEncoding(s,d.Encoding,d.CharStrings.length)),d.charset&&(d.charset=e.CFF.readCharset(s,d.charset,d.CharStrings.length)),e.CFF._readFDict(s,d,g),d},e.CFF._readFDict=function(s,t,n){var r;for(var o in t.Private&&(r=t.Private[1],t.Private=e.CFF.readDict(s,r,r+t.Private[0]),t.Private.Subrs&&e.CFF.readSubrs(s,r+t.Private.Subrs,t.Private)),t)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(o)!=-1&&(t[o]=n[t[o]-426+35])},e.CFF.readSubrs=function(s,t,n){var r=e._bin,o=[];t=e.CFF.readIndex(s,t,o);var c,l=o.length;c=l<1240?107:l<33900?1131:32768,n.Bias=c,n.Subrs=[];for(var u=0;u<o.length-1;u++)n.Subrs.push(r.readBytes(s,t+o[u],o[u+1]-o[u]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(s,t){for(var n=0;n<s.charset.length;n++)if(s.charset[n]==t)return n;return-1},e.CFF.glyphBySE=function(s,t){return t<0||t>255?-1:e.CFF.glyphByUnicode(s,e.CFF.tableSE[t])},e.CFF.readEncoding=function(s,t,n){e._bin;var r=[".notdef"],o=s[t];if(t++,o!=0)throw"error: unknown encoding format: "+o;var c=s[t];t++;for(var l=0;l<c;l++)r.push(s[t+l]);return r},e.CFF.readCharset=function(s,t,n){var r=e._bin,o=[".notdef"],c=s[t];if(t++,c==0)for(var l=0;l<n;l++){var u=r.readUshort(s,t);t+=2,o.push(u)}else{if(c!=1&&c!=2)throw"error: format: "+c;for(;o.length<n;){u=r.readUshort(s,t),t+=2;var h=0;for(c==1?(h=s[t],t++):(h=r.readUshort(s,t),t+=2),l=0;l<=h;l++)o.push(u),u++}}return o},e.CFF.readIndex=function(s,t,n){var r=e._bin,o=r.readUshort(s,t)+1,c=s[t+=2];if(t++,c==1)for(var l=0;l<o;l++)n.push(s[t+l]);else if(c==2)for(l=0;l<o;l++)n.push(r.readUshort(s,t+2*l));else if(c==3)for(l=0;l<o;l++)n.push(16777215&r.readUint(s,t+3*l-1));else if(o!=1)throw"unsupported offset size: "+c+", count: "+o;return(t+=o*c)-1},e.CFF.getCharString=function(s,t,n){var r=e._bin,o=s[t],c=s[t+1];s[t+2],s[t+3],s[t+4];var l=1,u=null,h=null;o<=20&&(u=o,l=1),o==12&&(u=100*o+c,l=2),21<=o&&o<=27&&(u=o,l=1),o==28&&(h=r.readShort(s,t+1),l=3),29<=o&&o<=31&&(u=o,l=1),32<=o&&o<=246&&(h=o-139,l=1),247<=o&&o<=250&&(h=256*(o-247)+c+108,l=2),251<=o&&o<=254&&(h=256*-(o-251)-c-108,l=2),o==255&&(h=r.readInt(s,t+1)/65535,l=5),n.val=h??"o"+u,n.size=l},e.CFF.readCharString=function(s,t,n){for(var r=t+n,o=e._bin,c=[];t<r;){var l=s[t],u=s[t+1];s[t+2],s[t+3],s[t+4];var h=1,d=null,f=null;l<=20&&(d=l,h=1),l==12&&(d=100*l+u,h=2),l!=19&&l!=20||(d=l,h=2),21<=l&&l<=27&&(d=l,h=1),l==28&&(f=o.readShort(s,t+1),h=3),29<=l&&l<=31&&(d=l,h=1),32<=l&&l<=246&&(f=l-139,h=1),247<=l&&l<=250&&(f=256*(l-247)+u+108,h=2),251<=l&&l<=254&&(f=256*-(l-251)-u-108,h=2),l==255&&(f=o.readInt(s,t+1)/65535,h=5),c.push(f??"o"+d),t+=h}return c},e.CFF.readDict=function(s,t,n){for(var r=e._bin,o={},c=[];t<n;){var l=s[t],u=s[t+1];s[t+2],s[t+3],s[t+4];var h=1,d=null,f=null;if(l==28&&(f=r.readShort(s,t+1),h=3),l==29&&(f=r.readInt(s,t+1),h=5),32<=l&&l<=246&&(f=l-139,h=1),247<=l&&l<=250&&(f=256*(l-247)+u+108,h=2),251<=l&&l<=254&&(f=256*-(l-251)-u-108,h=2),l==255)throw f=r.readInt(s,t+1)/65535,h=5,"unknown number";if(l==30){var g=[];for(h=1;;){var m=s[t+h];h++;var v=m>>4,w=15&m;if(v!=15&&g.push(v),w!=15&&g.push(w),w==15)break}for(var T="",y=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],S=0;S<g.length;S++)T+=y[g[S]];f=parseFloat(T)}l<=21&&(d=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][l],h=1,l==12&&(d=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][u],h=2)),d!=null?(o[d]=c.length==1?c[0]:c,c=[]):c.push(f),t+=h}return o},e.cmap={},e.cmap.parse=function(s,t,n){s=new Uint8Array(s.buffer,t,n),t=0;var r=e._bin,o={};r.readUshort(s,t),t+=2;var c=r.readUshort(s,t);t+=2;var l=[];o.tables=[];for(var u=0;u<c;u++){var h=r.readUshort(s,t);t+=2;var d=r.readUshort(s,t);t+=2;var f=r.readUint(s,t);t+=4;var g="p"+h+"e"+d,m=l.indexOf(f);if(m==-1){var v;m=o.tables.length,l.push(f);var w=r.readUshort(s,f);w==0?v=e.cmap.parse0(s,f):w==4?v=e.cmap.parse4(s,f):w==6?v=e.cmap.parse6(s,f):w==12?v=e.cmap.parse12(s,f):console.debug("unknown format: "+w,h,d,f),o.tables.push(v)}if(o[g]!=null)throw"multiple tables for one platform+encoding";o[g]=m}return o},e.cmap.parse0=function(s,t){var n=e._bin,r={};r.format=n.readUshort(s,t),t+=2;var o=n.readUshort(s,t);t+=2,n.readUshort(s,t),t+=2,r.map=[];for(var c=0;c<o-6;c++)r.map.push(s[t+c]);return r},e.cmap.parse4=function(s,t){var n=e._bin,r=t,o={};o.format=n.readUshort(s,t),t+=2;var c=n.readUshort(s,t);t+=2,n.readUshort(s,t),t+=2;var l=n.readUshort(s,t);t+=2;var u=l/2;o.searchRange=n.readUshort(s,t),t+=2,o.entrySelector=n.readUshort(s,t),t+=2,o.rangeShift=n.readUshort(s,t),t+=2,o.endCount=n.readUshorts(s,t,u),t+=2*u,t+=2,o.startCount=n.readUshorts(s,t,u),t+=2*u,o.idDelta=[];for(var h=0;h<u;h++)o.idDelta.push(n.readShort(s,t)),t+=2;for(o.idRangeOffset=n.readUshorts(s,t,u),t+=2*u,o.glyphIdArray=[];t<r+c;)o.glyphIdArray.push(n.readUshort(s,t)),t+=2;return o},e.cmap.parse6=function(s,t){var n=e._bin,r={};r.format=n.readUshort(s,t),t+=2,n.readUshort(s,t),t+=2,n.readUshort(s,t),t+=2,r.firstCode=n.readUshort(s,t),t+=2;var o=n.readUshort(s,t);t+=2,r.glyphIdArray=[];for(var c=0;c<o;c++)r.glyphIdArray.push(n.readUshort(s,t)),t+=2;return r},e.cmap.parse12=function(s,t){var n=e._bin,r={};r.format=n.readUshort(s,t),t+=2,t+=2,n.readUint(s,t),t+=4,n.readUint(s,t),t+=4;var o=n.readUint(s,t);t+=4,r.groups=[];for(var c=0;c<o;c++){var l=t+12*c,u=n.readUint(s,l+0),h=n.readUint(s,l+4),d=n.readUint(s,l+8);r.groups.push([u,h,d])}return r},e.glyf={},e.glyf.parse=function(s,t,n,r){for(var o=[],c=0;c<r.maxp.numGlyphs;c++)o.push(null);return o},e.glyf._parseGlyf=function(s,t){var n=e._bin,r=s._data,o=e._tabOffset(r,"glyf",s._offset)+s.loca[t];if(s.loca[t]==s.loca[t+1])return null;var c={};if(c.noc=n.readShort(r,o),o+=2,c.xMin=n.readShort(r,o),o+=2,c.yMin=n.readShort(r,o),o+=2,c.xMax=n.readShort(r,o),o+=2,c.yMax=n.readShort(r,o),o+=2,c.xMin>=c.xMax||c.yMin>=c.yMax)return null;if(c.noc>0){c.endPts=[];for(var l=0;l<c.noc;l++)c.endPts.push(n.readUshort(r,o)),o+=2;var u=n.readUshort(r,o);if(o+=2,r.length-o<u)return null;c.instructions=n.readBytes(r,o,u),o+=u;var h=c.endPts[c.noc-1]+1;for(c.flags=[],l=0;l<h;l++){var d=r[o];if(o++,c.flags.push(d),(8&d)!=0){var f=r[o];o++;for(var g=0;g<f;g++)c.flags.push(d),l++}}for(c.xs=[],l=0;l<h;l++){var m=(2&c.flags[l])!=0,v=(16&c.flags[l])!=0;m?(c.xs.push(v?r[o]:-r[o]),o++):v?c.xs.push(0):(c.xs.push(n.readShort(r,o)),o+=2)}for(c.ys=[],l=0;l<h;l++)m=(4&c.flags[l])!=0,v=(32&c.flags[l])!=0,m?(c.ys.push(v?r[o]:-r[o]),o++):v?c.ys.push(0):(c.ys.push(n.readShort(r,o)),o+=2);var w=0,T=0;for(l=0;l<h;l++)w+=c.xs[l],T+=c.ys[l],c.xs[l]=w,c.ys[l]=T}else{var y;c.parts=[];do{y=n.readUshort(r,o),o+=2;var S={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(c.parts.push(S),S.glyphIndex=n.readUshort(r,o),o+=2,1&y){var A=n.readShort(r,o);o+=2;var P=n.readShort(r,o);o+=2}else A=n.readInt8(r,o),o++,P=n.readInt8(r,o),o++;2&y?(S.m.tx=A,S.m.ty=P):(S.p1=A,S.p2=P),8&y?(S.m.a=S.m.d=n.readF2dot14(r,o),o+=2):64&y?(S.m.a=n.readF2dot14(r,o),o+=2,S.m.d=n.readF2dot14(r,o),o+=2):128&y&&(S.m.a=n.readF2dot14(r,o),o+=2,S.m.b=n.readF2dot14(r,o),o+=2,S.m.c=n.readF2dot14(r,o),o+=2,S.m.d=n.readF2dot14(r,o),o+=2)}while(32&y);if(256&y){var k=n.readUshort(r,o);for(o+=2,c.instr=[],l=0;l<k;l++)c.instr.push(r[o]),o++}}return c},e.GDEF={},e.GDEF.parse=function(s,t,n,r){var o=t;t+=4;var c=e._bin.readUshort(s,t);return{glyphClassDef:c===0?null:e._lctf.readClassDef(s,o+c)}},e.GPOS={},e.GPOS.parse=function(s,t,n,r){return e._lctf.parse(s,t,n,r,e.GPOS.subt)},e.GPOS.subt=function(s,t,n,r){var o=e._bin,c=n,l={};if(l.fmt=o.readUshort(s,n),n+=2,t==1||t==2||t==3||t==7||t==8&&l.fmt<=2){var u=o.readUshort(s,n);n+=2,l.coverage=e._lctf.readCoverage(s,u+c)}if(t==1&&l.fmt==1){var h=o.readUshort(s,n);n+=2,h!=0&&(l.pos=e.GPOS.readValueRecord(s,n,h))}else if(t==2&&l.fmt>=1&&l.fmt<=2){h=o.readUshort(s,n),n+=2;var d=o.readUshort(s,n);n+=2;var f=e._lctf.numOfOnes(h),g=e._lctf.numOfOnes(d);if(l.fmt==1){l.pairsets=[];var m=o.readUshort(s,n);n+=2;for(var v=0;v<m;v++){var w=c+o.readUshort(s,n);n+=2;var T=o.readUshort(s,w);w+=2;for(var y=[],S=0;S<T;S++){var A=o.readUshort(s,w);w+=2,h!=0&&(b=e.GPOS.readValueRecord(s,w,h),w+=2*f),d!=0&&(F=e.GPOS.readValueRecord(s,w,d),w+=2*g),y.push({gid2:A,val1:b,val2:F})}l.pairsets.push(y)}}if(l.fmt==2){var P=o.readUshort(s,n);n+=2;var k=o.readUshort(s,n);n+=2;var C=o.readUshort(s,n);n+=2;var M=o.readUshort(s,n);for(n+=2,l.classDef1=e._lctf.readClassDef(s,c+P),l.classDef2=e._lctf.readClassDef(s,c+k),l.matrix=[],v=0;v<C;v++){var z=[];for(S=0;S<M;S++){var b=null,F=null;h!=0&&(b=e.GPOS.readValueRecord(s,n,h),n+=2*f),d!=0&&(F=e.GPOS.readValueRecord(s,n,d),n+=2*g),z.push({val1:b,val2:F})}l.matrix.push(z)}}}else if(t==4&&l.fmt==1)l.markCoverage=e._lctf.readCoverage(s,o.readUshort(s,n)+c),l.baseCoverage=e._lctf.readCoverage(s,o.readUshort(s,n+2)+c),l.markClassCount=o.readUshort(s,n+4),l.markArray=e.GPOS.readMarkArray(s,o.readUshort(s,n+6)+c),l.baseArray=e.GPOS.readBaseArray(s,o.readUshort(s,n+8)+c,l.markClassCount);else if(t==6&&l.fmt==1)l.mark1Coverage=e._lctf.readCoverage(s,o.readUshort(s,n)+c),l.mark2Coverage=e._lctf.readCoverage(s,o.readUshort(s,n+2)+c),l.markClassCount=o.readUshort(s,n+4),l.mark1Array=e.GPOS.readMarkArray(s,o.readUshort(s,n+6)+c),l.mark2Array=e.GPOS.readBaseArray(s,o.readUshort(s,n+8)+c,l.markClassCount);else{if(t==9&&l.fmt==1){var R=o.readUshort(s,n);n+=2;var E=o.readUint(s,n);if(n+=4,r.ltype==9)r.ltype=R;else if(r.ltype!=R)throw"invalid extension substitution";return e.GPOS.subt(s,r.ltype,c+E)}console.debug("unsupported GPOS table LookupType",t,"format",l.fmt)}return l},e.GPOS.readValueRecord=function(s,t,n){var r=e._bin,o=[];return o.push(1&n?r.readShort(s,t):0),t+=1&n?2:0,o.push(2&n?r.readShort(s,t):0),t+=2&n?2:0,o.push(4&n?r.readShort(s,t):0),t+=4&n?2:0,o.push(8&n?r.readShort(s,t):0),t+=8&n?2:0,o},e.GPOS.readBaseArray=function(s,t,n){var r=e._bin,o=[],c=t,l=r.readUshort(s,t);t+=2;for(var u=0;u<l;u++){for(var h=[],d=0;d<n;d++)h.push(e.GPOS.readAnchorRecord(s,c+r.readUshort(s,t))),t+=2;o.push(h)}return o},e.GPOS.readMarkArray=function(s,t){var n=e._bin,r=[],o=t,c=n.readUshort(s,t);t+=2;for(var l=0;l<c;l++){var u=e.GPOS.readAnchorRecord(s,n.readUshort(s,t+2)+o);u.markClass=n.readUshort(s,t),r.push(u),t+=4}return r},e.GPOS.readAnchorRecord=function(s,t){var n=e._bin,r={};return r.fmt=n.readUshort(s,t),r.x=n.readShort(s,t+2),r.y=n.readShort(s,t+4),r},e.GSUB={},e.GSUB.parse=function(s,t,n,r){return e._lctf.parse(s,t,n,r,e.GSUB.subt)},e.GSUB.subt=function(s,t,n,r){var o=e._bin,c=n,l={};if(l.fmt=o.readUshort(s,n),n+=2,t!=1&&t!=2&&t!=4&&t!=5&&t!=6)return null;if(t==1||t==2||t==4||t==5&&l.fmt<=2||t==6&&l.fmt<=2){var u=o.readUshort(s,n);n+=2,l.coverage=e._lctf.readCoverage(s,c+u)}if(t==1&&l.fmt>=1&&l.fmt<=2){if(l.fmt==1)l.delta=o.readShort(s,n),n+=2;else if(l.fmt==2){var h=o.readUshort(s,n);n+=2,l.newg=o.readUshorts(s,n,h),n+=2*l.newg.length}}else if(t==2&&l.fmt==1){h=o.readUshort(s,n),n+=2,l.seqs=[];for(var d=0;d<h;d++){var f=o.readUshort(s,n)+c;n+=2;var g=o.readUshort(s,f);l.seqs.push(o.readUshorts(s,f+2,g))}}else if(t==4)for(l.vals=[],h=o.readUshort(s,n),n+=2,d=0;d<h;d++){var m=o.readUshort(s,n);n+=2,l.vals.push(e.GSUB.readLigatureSet(s,c+m))}else if(t==5&&l.fmt==2){if(l.fmt==2){var v=o.readUshort(s,n);n+=2,l.cDef=e._lctf.readClassDef(s,c+v),l.scset=[];var w=o.readUshort(s,n);for(n+=2,d=0;d<w;d++){var T=o.readUshort(s,n);n+=2,l.scset.push(T==0?null:e.GSUB.readSubClassSet(s,c+T))}}}else if(t==6&&l.fmt==3){if(l.fmt==3){for(d=0;d<3;d++){h=o.readUshort(s,n),n+=2;for(var y=[],S=0;S<h;S++)y.push(e._lctf.readCoverage(s,c+o.readUshort(s,n+2*S)));n+=2*h,d==0&&(l.backCvg=y),d==1&&(l.inptCvg=y),d==2&&(l.ahedCvg=y)}h=o.readUshort(s,n),n+=2,l.lookupRec=e.GSUB.readSubstLookupRecords(s,n,h)}}else{if(t==7&&l.fmt==1){var A=o.readUshort(s,n);n+=2;var P=o.readUint(s,n);if(n+=4,r.ltype==9)r.ltype=A;else if(r.ltype!=A)throw"invalid extension substitution";return e.GSUB.subt(s,r.ltype,c+P)}console.debug("unsupported GSUB table LookupType",t,"format",l.fmt)}return l},e.GSUB.readSubClassSet=function(s,t){var n=e._bin.readUshort,r=t,o=[],c=n(s,t);t+=2;for(var l=0;l<c;l++){var u=n(s,t);t+=2,o.push(e.GSUB.readSubClassRule(s,r+u))}return o},e.GSUB.readSubClassRule=function(s,t){var n=e._bin.readUshort,r={},o=n(s,t),c=n(s,t+=2);t+=2,r.input=[];for(var l=0;l<o-1;l++)r.input.push(n(s,t)),t+=2;return r.substLookupRecords=e.GSUB.readSubstLookupRecords(s,t,c),r},e.GSUB.readSubstLookupRecords=function(s,t,n){for(var r=e._bin.readUshort,o=[],c=0;c<n;c++)o.push(r(s,t),r(s,t+2)),t+=4;return o},e.GSUB.readChainSubClassSet=function(s,t){var n=e._bin,r=t,o=[],c=n.readUshort(s,t);t+=2;for(var l=0;l<c;l++){var u=n.readUshort(s,t);t+=2,o.push(e.GSUB.readChainSubClassRule(s,r+u))}return o},e.GSUB.readChainSubClassRule=function(s,t){for(var n=e._bin,r={},o=["backtrack","input","lookahead"],c=0;c<o.length;c++){var l=n.readUshort(s,t);t+=2,c==1&&l--,r[o[c]]=n.readUshorts(s,t,l),t+=2*r[o[c]].length}return l=n.readUshort(s,t),t+=2,r.subst=n.readUshorts(s,t,2*l),t+=2*r.subst.length,r},e.GSUB.readLigatureSet=function(s,t){var n=e._bin,r=t,o=[],c=n.readUshort(s,t);t+=2;for(var l=0;l<c;l++){var u=n.readUshort(s,t);t+=2,o.push(e.GSUB.readLigature(s,r+u))}return o},e.GSUB.readLigature=function(s,t){var n=e._bin,r={chain:[]};r.nglyph=n.readUshort(s,t),t+=2;var o=n.readUshort(s,t);t+=2;for(var c=0;c<o-1;c++)r.chain.push(n.readUshort(s,t)),t+=2;return r},e.head={},e.head.parse=function(s,t,n){var r=e._bin,o={};return r.readFixed(s,t),t+=4,o.fontRevision=r.readFixed(s,t),t+=4,r.readUint(s,t),t+=4,r.readUint(s,t),t+=4,o.flags=r.readUshort(s,t),t+=2,o.unitsPerEm=r.readUshort(s,t),t+=2,o.created=r.readUint64(s,t),t+=8,o.modified=r.readUint64(s,t),t+=8,o.xMin=r.readShort(s,t),t+=2,o.yMin=r.readShort(s,t),t+=2,o.xMax=r.readShort(s,t),t+=2,o.yMax=r.readShort(s,t),t+=2,o.macStyle=r.readUshort(s,t),t+=2,o.lowestRecPPEM=r.readUshort(s,t),t+=2,o.fontDirectionHint=r.readShort(s,t),t+=2,o.indexToLocFormat=r.readShort(s,t),t+=2,o.glyphDataFormat=r.readShort(s,t),t+=2,o},e.hhea={},e.hhea.parse=function(s,t,n){var r=e._bin,o={};return r.readFixed(s,t),t+=4,o.ascender=r.readShort(s,t),t+=2,o.descender=r.readShort(s,t),t+=2,o.lineGap=r.readShort(s,t),t+=2,o.advanceWidthMax=r.readUshort(s,t),t+=2,o.minLeftSideBearing=r.readShort(s,t),t+=2,o.minRightSideBearing=r.readShort(s,t),t+=2,o.xMaxExtent=r.readShort(s,t),t+=2,o.caretSlopeRise=r.readShort(s,t),t+=2,o.caretSlopeRun=r.readShort(s,t),t+=2,o.caretOffset=r.readShort(s,t),t+=2,t+=8,o.metricDataFormat=r.readShort(s,t),t+=2,o.numberOfHMetrics=r.readUshort(s,t),t+=2,o},e.hmtx={},e.hmtx.parse=function(s,t,n,r){for(var o=e._bin,c={aWidth:[],lsBearing:[]},l=0,u=0,h=0;h<r.maxp.numGlyphs;h++)h<r.hhea.numberOfHMetrics&&(l=o.readUshort(s,t),t+=2,u=o.readShort(s,t),t+=2),c.aWidth.push(l),c.lsBearing.push(u);return c},e.kern={},e.kern.parse=function(s,t,n,r){var o=e._bin,c=o.readUshort(s,t);if(t+=2,c==1)return e.kern.parseV1(s,t-2,n,r);var l=o.readUshort(s,t);t+=2;for(var u={glyph1:[],rval:[]},h=0;h<l;h++){t+=2,n=o.readUshort(s,t),t+=2;var d=o.readUshort(s,t);t+=2;var f=d>>>8;if((f&=15)!=0)throw"unknown kern table format: "+f;t=e.kern.readFormat0(s,t,u)}return u},e.kern.parseV1=function(s,t,n,r){var o=e._bin;o.readFixed(s,t),t+=4;var c=o.readUint(s,t);t+=4;for(var l={glyph1:[],rval:[]},u=0;u<c;u++){o.readUint(s,t),t+=4;var h=o.readUshort(s,t);t+=2,o.readUshort(s,t),t+=2;var d=h>>>8;if((d&=15)!=0)throw"unknown kern table format: "+d;t=e.kern.readFormat0(s,t,l)}return l},e.kern.readFormat0=function(s,t,n){var r=e._bin,o=-1,c=r.readUshort(s,t);t+=2,r.readUshort(s,t),t+=2,r.readUshort(s,t),t+=2,r.readUshort(s,t),t+=2;for(var l=0;l<c;l++){var u=r.readUshort(s,t);t+=2;var h=r.readUshort(s,t);t+=2;var d=r.readShort(s,t);t+=2,u!=o&&(n.glyph1.push(u),n.rval.push({glyph2:[],vals:[]}));var f=n.rval[n.rval.length-1];f.glyph2.push(h),f.vals.push(d),o=u}return t},e.loca={},e.loca.parse=function(s,t,n,r){var o=e._bin,c=[],l=r.head.indexToLocFormat,u=r.maxp.numGlyphs+1;if(l==0)for(var h=0;h<u;h++)c.push(o.readUshort(s,t+(h<<1))<<1);if(l==1)for(h=0;h<u;h++)c.push(o.readUint(s,t+(h<<2)));return c},e.maxp={},e.maxp.parse=function(s,t,n){var r=e._bin,o={},c=r.readUint(s,t);return t+=4,o.numGlyphs=r.readUshort(s,t),t+=2,c==65536&&(o.maxPoints=r.readUshort(s,t),t+=2,o.maxContours=r.readUshort(s,t),t+=2,o.maxCompositePoints=r.readUshort(s,t),t+=2,o.maxCompositeContours=r.readUshort(s,t),t+=2,o.maxZones=r.readUshort(s,t),t+=2,o.maxTwilightPoints=r.readUshort(s,t),t+=2,o.maxStorage=r.readUshort(s,t),t+=2,o.maxFunctionDefs=r.readUshort(s,t),t+=2,o.maxInstructionDefs=r.readUshort(s,t),t+=2,o.maxStackElements=r.readUshort(s,t),t+=2,o.maxSizeOfInstructions=r.readUshort(s,t),t+=2,o.maxComponentElements=r.readUshort(s,t),t+=2,o.maxComponentDepth=r.readUshort(s,t),t+=2),o},e.name={},e.name.parse=function(s,t,n){var r=e._bin,o={};r.readUshort(s,t),t+=2;var c=r.readUshort(s,t);t+=2,r.readUshort(s,t);for(var l,u=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],h=t+=2,d=0;d<c;d++){var f=r.readUshort(s,t);t+=2;var g=r.readUshort(s,t);t+=2;var m=r.readUshort(s,t);t+=2;var v=r.readUshort(s,t);t+=2;var w=r.readUshort(s,t);t+=2;var T=r.readUshort(s,t);t+=2;var y,S=u[v],A=h+12*c+T;if(f==0)y=r.readUnicode(s,A,w/2);else if(f==3&&g==0)y=r.readUnicode(s,A,w/2);else if(g==0)y=r.readASCII(s,A,w);else if(g==1)y=r.readUnicode(s,A,w/2);else if(g==3)y=r.readUnicode(s,A,w/2);else{if(f!=1)throw"unknown encoding "+g+", platformID: "+f;y=r.readASCII(s,A,w),console.debug("reading unknown MAC encoding "+g+" as ASCII")}var P="p"+f+","+m.toString(16);o[P]==null&&(o[P]={}),o[P][S!==void 0?S:v]=y,o[P]._lang=m}for(var k in o)if(o[k].postScriptName!=null&&o[k]._lang==1033)return o[k];for(var k in o)if(o[k].postScriptName!=null&&o[k]._lang==0)return o[k];for(var k in o)if(o[k].postScriptName!=null&&o[k]._lang==3084)return o[k];for(var k in o)if(o[k].postScriptName!=null)return o[k];for(var k in o){l=k;break}return console.debug("returning name table with languageID "+o[l]._lang),o[l]},e["OS/2"]={},e["OS/2"].parse=function(s,t,n){var r=e._bin.readUshort(s,t);t+=2;var o={};if(r==0)e["OS/2"].version0(s,t,o);else if(r==1)e["OS/2"].version1(s,t,o);else if(r==2||r==3||r==4)e["OS/2"].version2(s,t,o);else{if(r!=5)throw"unknown OS/2 table version: "+r;e["OS/2"].version5(s,t,o)}return o},e["OS/2"].version0=function(s,t,n){var r=e._bin;return n.xAvgCharWidth=r.readShort(s,t),t+=2,n.usWeightClass=r.readUshort(s,t),t+=2,n.usWidthClass=r.readUshort(s,t),t+=2,n.fsType=r.readUshort(s,t),t+=2,n.ySubscriptXSize=r.readShort(s,t),t+=2,n.ySubscriptYSize=r.readShort(s,t),t+=2,n.ySubscriptXOffset=r.readShort(s,t),t+=2,n.ySubscriptYOffset=r.readShort(s,t),t+=2,n.ySuperscriptXSize=r.readShort(s,t),t+=2,n.ySuperscriptYSize=r.readShort(s,t),t+=2,n.ySuperscriptXOffset=r.readShort(s,t),t+=2,n.ySuperscriptYOffset=r.readShort(s,t),t+=2,n.yStrikeoutSize=r.readShort(s,t),t+=2,n.yStrikeoutPosition=r.readShort(s,t),t+=2,n.sFamilyClass=r.readShort(s,t),t+=2,n.panose=r.readBytes(s,t,10),t+=10,n.ulUnicodeRange1=r.readUint(s,t),t+=4,n.ulUnicodeRange2=r.readUint(s,t),t+=4,n.ulUnicodeRange3=r.readUint(s,t),t+=4,n.ulUnicodeRange4=r.readUint(s,t),t+=4,n.achVendID=[r.readInt8(s,t),r.readInt8(s,t+1),r.readInt8(s,t+2),r.readInt8(s,t+3)],t+=4,n.fsSelection=r.readUshort(s,t),t+=2,n.usFirstCharIndex=r.readUshort(s,t),t+=2,n.usLastCharIndex=r.readUshort(s,t),t+=2,n.sTypoAscender=r.readShort(s,t),t+=2,n.sTypoDescender=r.readShort(s,t),t+=2,n.sTypoLineGap=r.readShort(s,t),t+=2,n.usWinAscent=r.readUshort(s,t),t+=2,n.usWinDescent=r.readUshort(s,t),t+=2},e["OS/2"].version1=function(s,t,n){var r=e._bin;return t=e["OS/2"].version0(s,t,n),n.ulCodePageRange1=r.readUint(s,t),t+=4,n.ulCodePageRange2=r.readUint(s,t),t+=4},e["OS/2"].version2=function(s,t,n){var r=e._bin;return t=e["OS/2"].version1(s,t,n),n.sxHeight=r.readShort(s,t),t+=2,n.sCapHeight=r.readShort(s,t),t+=2,n.usDefault=r.readUshort(s,t),t+=2,n.usBreak=r.readUshort(s,t),t+=2,n.usMaxContext=r.readUshort(s,t),t+=2},e["OS/2"].version5=function(s,t,n){var r=e._bin;return t=e["OS/2"].version2(s,t,n),n.usLowerOpticalPointSize=r.readUshort(s,t),t+=2,n.usUpperOpticalPointSize=r.readUshort(s,t),t+=2},e.post={},e.post.parse=function(s,t,n){var r=e._bin,o={};return o.version=r.readFixed(s,t),t+=4,o.italicAngle=r.readFixed(s,t),t+=4,o.underlinePosition=r.readShort(s,t),t+=2,o.underlineThickness=r.readShort(s,t),t+=2,o},e==null&&(e={}),e.U==null&&(e.U={}),e.U.codeToGlyph=function(s,t){var n=s.cmap,r=-1;if(n.p0e4!=null?r=n.p0e4:n.p3e1!=null?r=n.p3e1:n.p1e0!=null?r=n.p1e0:n.p0e3!=null&&(r=n.p0e3),r==-1)throw"no familiar platform and encoding!";var o=n.tables[r];if(o.format==0)return t>=o.map.length?0:o.map[t];if(o.format==4){for(var c=-1,l=0;l<o.endCount.length;l++)if(t<=o.endCount[l]){c=l;break}return c==-1||o.startCount[c]>t?0:65535&(o.idRangeOffset[c]!=0?o.glyphIdArray[t-o.startCount[c]+(o.idRangeOffset[c]>>1)-(o.idRangeOffset.length-c)]:t+o.idDelta[c])}if(o.format==12){if(t>o.groups[o.groups.length-1][1])return 0;for(l=0;l<o.groups.length;l++){var u=o.groups[l];if(u[0]<=t&&t<=u[1])return u[2]+(t-u[0])}return 0}throw"unknown cmap table format "+o.format},e.U.glyphToPath=function(s,t){var n={cmds:[],crds:[]};if(s.SVG&&s.SVG.entries[t]){var r=s.SVG.entries[t];return r==null?n:(typeof r=="string"&&(r=e.SVG.toPath(r),s.SVG.entries[t]=r),r)}if(s.CFF){var o={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:s.CFF.Private?s.CFF.Private.defaultWidthX:0,open:!1},c=s.CFF,l=s.CFF.Private;if(c.ROS){for(var u=0;c.FDSelect[u+2]<=t;)u+=2;l=c.FDArray[c.FDSelect[u+1]].Private}e.U._drawCFF(s.CFF.CharStrings[t],o,c,l,n)}else s.glyf&&e.U._drawGlyf(t,s,n);return n},e.U._drawGlyf=function(s,t,n){var r=t.glyf[s];r==null&&(r=t.glyf[s]=e.glyf._parseGlyf(t,s)),r!=null&&(r.noc>-1?e.U._simpleGlyph(r,n):e.U._compoGlyph(r,t,n))},e.U._simpleGlyph=function(s,t){for(var n=0;n<s.noc;n++){for(var r=n==0?0:s.endPts[n-1]+1,o=s.endPts[n],c=r;c<=o;c++){var l=c==r?o:c-1,u=c==o?r:c+1,h=1&s.flags[c],d=1&s.flags[l],f=1&s.flags[u],g=s.xs[c],m=s.ys[c];if(c==r)if(h){if(!d){e.U.P.moveTo(t,g,m);continue}e.U.P.moveTo(t,s.xs[l],s.ys[l])}else d?e.U.P.moveTo(t,s.xs[l],s.ys[l]):e.U.P.moveTo(t,(s.xs[l]+g)/2,(s.ys[l]+m)/2);h?d&&e.U.P.lineTo(t,g,m):f?e.U.P.qcurveTo(t,g,m,s.xs[u],s.ys[u]):e.U.P.qcurveTo(t,g,m,(g+s.xs[u])/2,(m+s.ys[u])/2)}e.U.P.closePath(t)}},e.U._compoGlyph=function(s,t,n){for(var r=0;r<s.parts.length;r++){var o={cmds:[],crds:[]},c=s.parts[r];e.U._drawGlyf(c.glyphIndex,t,o);for(var l=c.m,u=0;u<o.crds.length;u+=2){var h=o.crds[u],d=o.crds[u+1];n.crds.push(h*l.a+d*l.b+l.tx),n.crds.push(h*l.c+d*l.d+l.ty)}for(u=0;u<o.cmds.length;u++)n.cmds.push(o.cmds[u])}},e.U._getGlyphClass=function(s,t){var n=e._lctf.getInterval(t,s);return n==-1?0:t[n+2]},e.U._applySubs=function(s,t,n,r){for(var o=s.length-t-1,c=0;c<n.tabs.length;c++)if(n.tabs[c]!=null){var l,u=n.tabs[c];if(!u.coverage||(l=e._lctf.coverageIndex(u.coverage,s[t]))!=-1){if(n.ltype==1)s[t],u.fmt==1?s[t]=s[t]+u.delta:s[t]=u.newg[l];else if(n.ltype==4)for(var h=u.vals[l],d=0;d<h.length;d++){var f=h[d],g=f.chain.length;if(!(g>o)){for(var m=!0,v=0,w=0;w<g;w++){for(;s[t+v+(1+w)]==-1;)v++;f.chain[w]!=s[t+v+(1+w)]&&(m=!1)}if(m){for(s[t]=f.nglyph,w=0;w<g+v;w++)s[t+w+1]=-1;break}}}else if(n.ltype==5&&u.fmt==2)for(var T=e._lctf.getInterval(u.cDef,s[t]),y=u.cDef[T+2],S=u.scset[y],A=0;A<S.length;A++){var P=S[A],k=P.input;if(!(k.length>o)){for(m=!0,w=0;w<k.length;w++){var C=e._lctf.getInterval(u.cDef,s[t+1+w]);if(T==-1&&u.cDef[C+2]!=k[w]){m=!1;break}}if(m){var M=P.substLookupRecords;for(d=0;d<M.length;d+=2)M[d],M[d+1]}}}else if(n.ltype==6&&u.fmt==3){if(!e.U._glsCovered(s,u.backCvg,t-u.backCvg.length)||!e.U._glsCovered(s,u.inptCvg,t)||!e.U._glsCovered(s,u.ahedCvg,t+u.inptCvg.length))continue;var z=u.lookupRec;for(A=0;A<z.length;A+=2){T=z[A];var b=r[z[A+1]];e.U._applySubs(s,t+T,b,r)}}}}},e.U._glsCovered=function(s,t,n){for(var r=0;r<t.length;r++)if(e._lctf.coverageIndex(t[r],s[n+r])==-1)return!1;return!0},e.U.glyphsToPath=function(s,t,n){for(var r={cmds:[],crds:[]},o=0,c=0;c<t.length;c++){var l=t[c];if(l!=-1){for(var u=c<t.length-1&&t[c+1]!=-1?t[c+1]:0,h=e.U.glyphToPath(s,l),d=0;d<h.crds.length;d+=2)r.crds.push(h.crds[d]+o),r.crds.push(h.crds[d+1]);for(n&&r.cmds.push(n),d=0;d<h.cmds.length;d++)r.cmds.push(h.cmds[d]);n&&r.cmds.push("X"),o+=s.hmtx.aWidth[l],c<t.length-1&&(o+=e.U.getPairAdjustment(s,l,u))}}return r},e.U.P={},e.U.P.moveTo=function(s,t,n){s.cmds.push("M"),s.crds.push(t,n)},e.U.P.lineTo=function(s,t,n){s.cmds.push("L"),s.crds.push(t,n)},e.U.P.curveTo=function(s,t,n,r,o,c,l){s.cmds.push("C"),s.crds.push(t,n,r,o,c,l)},e.U.P.qcurveTo=function(s,t,n,r,o){s.cmds.push("Q"),s.crds.push(t,n,r,o)},e.U.P.closePath=function(s){s.cmds.push("Z")},e.U._drawCFF=function(s,t,n,r,o){for(var c=t.stack,l=t.nStems,u=t.haveWidth,h=t.width,d=t.open,f=0,g=t.x,m=t.y,v=0,w=0,T=0,y=0,S=0,A=0,P=0,k=0,C=0,M=0,z={val:0,size:0};f<s.length;){e.CFF.getCharString(s,f,z);var b=z.val;if(f+=z.size,b=="o1"||b=="o18")c.length%2!=0&&!u&&(h=c.shift()+r.nominalWidthX),l+=c.length>>1,c.length=0,u=!0;else if(b=="o3"||b=="o23")c.length%2!=0&&!u&&(h=c.shift()+r.nominalWidthX),l+=c.length>>1,c.length=0,u=!0;else if(b=="o4")c.length>1&&!u&&(h=c.shift()+r.nominalWidthX,u=!0),d&&e.U.P.closePath(o),m+=c.pop(),e.U.P.moveTo(o,g,m),d=!0;else if(b=="o5")for(;c.length>0;)g+=c.shift(),m+=c.shift(),e.U.P.lineTo(o,g,m);else if(b=="o6"||b=="o7")for(var F=c.length,R=b=="o6",E=0;E<F;E++){var I=c.shift();R?g+=I:m+=I,R=!R,e.U.P.lineTo(o,g,m)}else if(b=="o8"||b=="o24"){F=c.length;for(var U=0;U+6<=F;)v=g+c.shift(),w=m+c.shift(),T=v+c.shift(),y=w+c.shift(),g=T+c.shift(),m=y+c.shift(),e.U.P.curveTo(o,v,w,T,y,g,m),U+=6;b=="o24"&&(g+=c.shift(),m+=c.shift(),e.U.P.lineTo(o,g,m))}else{if(b=="o11")break;if(b=="o1234"||b=="o1235"||b=="o1236"||b=="o1237")b=="o1234"&&(w=m,T=(v=g+c.shift())+c.shift(),M=y=w+c.shift(),A=y,k=m,g=(P=(S=(C=T+c.shift())+c.shift())+c.shift())+c.shift(),e.U.P.curveTo(o,v,w,T,y,C,M),e.U.P.curveTo(o,S,A,P,k,g,m)),b=="o1235"&&(v=g+c.shift(),w=m+c.shift(),T=v+c.shift(),y=w+c.shift(),C=T+c.shift(),M=y+c.shift(),S=C+c.shift(),A=M+c.shift(),P=S+c.shift(),k=A+c.shift(),g=P+c.shift(),m=k+c.shift(),c.shift(),e.U.P.curveTo(o,v,w,T,y,C,M),e.U.P.curveTo(o,S,A,P,k,g,m)),b=="o1236"&&(v=g+c.shift(),w=m+c.shift(),T=v+c.shift(),M=y=w+c.shift(),A=y,P=(S=(C=T+c.shift())+c.shift())+c.shift(),k=A+c.shift(),g=P+c.shift(),e.U.P.curveTo(o,v,w,T,y,C,M),e.U.P.curveTo(o,S,A,P,k,g,m)),b=="o1237"&&(v=g+c.shift(),w=m+c.shift(),T=v+c.shift(),y=w+c.shift(),C=T+c.shift(),M=y+c.shift(),S=C+c.shift(),A=M+c.shift(),P=S+c.shift(),k=A+c.shift(),Math.abs(P-g)>Math.abs(k-m)?g=P+c.shift():m=k+c.shift(),e.U.P.curveTo(o,v,w,T,y,C,M),e.U.P.curveTo(o,S,A,P,k,g,m));else if(b=="o14"){if(c.length>0&&!u&&(h=c.shift()+n.nominalWidthX,u=!0),c.length==4){var G=c.shift(),X=c.shift(),D=c.shift(),N=c.shift(),L=e.CFF.glyphBySE(n,D),V=e.CFF.glyphBySE(n,N);e.U._drawCFF(n.CharStrings[L],t,n,r,o),t.x=G,t.y=X,e.U._drawCFF(n.CharStrings[V],t,n,r,o)}d&&(e.U.P.closePath(o),d=!1)}else if(b=="o19"||b=="o20")c.length%2!=0&&!u&&(h=c.shift()+r.nominalWidthX),l+=c.length>>1,c.length=0,u=!0,f+=l+7>>3;else if(b=="o21")c.length>2&&!u&&(h=c.shift()+r.nominalWidthX,u=!0),m+=c.pop(),g+=c.pop(),d&&e.U.P.closePath(o),e.U.P.moveTo(o,g,m),d=!0;else if(b=="o22")c.length>1&&!u&&(h=c.shift()+r.nominalWidthX,u=!0),g+=c.pop(),d&&e.U.P.closePath(o),e.U.P.moveTo(o,g,m),d=!0;else if(b=="o25"){for(;c.length>6;)g+=c.shift(),m+=c.shift(),e.U.P.lineTo(o,g,m);v=g+c.shift(),w=m+c.shift(),T=v+c.shift(),y=w+c.shift(),g=T+c.shift(),m=y+c.shift(),e.U.P.curveTo(o,v,w,T,y,g,m)}else if(b=="o26")for(c.length%2&&(g+=c.shift());c.length>0;)v=g,w=m+c.shift(),g=T=v+c.shift(),m=(y=w+c.shift())+c.shift(),e.U.P.curveTo(o,v,w,T,y,g,m);else if(b=="o27")for(c.length%2&&(m+=c.shift());c.length>0;)w=m,T=(v=g+c.shift())+c.shift(),y=w+c.shift(),g=T+c.shift(),m=y,e.U.P.curveTo(o,v,w,T,y,g,m);else if(b=="o10"||b=="o29"){var B=b=="o10"?r:n;if(c.length==0)console.debug("error: empty stack");else{var K=c.pop(),Z=B.Subrs[K+B.Bias];t.x=g,t.y=m,t.nStems=l,t.haveWidth=u,t.width=h,t.open=d,e.U._drawCFF(Z,t,n,r,o),g=t.x,m=t.y,l=t.nStems,u=t.haveWidth,h=t.width,d=t.open}}else if(b=="o30"||b=="o31"){var le=c.length,Q=(U=0,b=="o31");for(U+=le-(F=-3&le);U<F;)Q?(w=m,T=(v=g+c.shift())+c.shift(),m=(y=w+c.shift())+c.shift(),F-U==5?(g=T+c.shift(),U++):g=T,Q=!1):(v=g,w=m+c.shift(),T=v+c.shift(),y=w+c.shift(),g=T+c.shift(),F-U==5?(m=y+c.shift(),U++):m=y,Q=!0),e.U.P.curveTo(o,v,w,T,y,g,m),U+=4}else{if((b+"").charAt(0)=="o")throw console.debug("Unknown operation: "+b,s),b;c.push(b)}}}t.x=g,t.y=m,t.nStems=l,t.haveWidth=u,t.width=h,t.open=d};var i=e,a={Typr:i};return p.Typr=i,p.default=a,Object.defineProperty(p,"__esModule",{value:!0}),p}({}).Typr}/*!
Custom bundle of woff2otf (https://github.com/arty-name/woff2otf) with fflate
(https://github.com/101arrowz/fflate) for use in Troika text rendering. 
Original licenses apply: 
- fflate: https://github.com/101arrowz/fflate/blob/master/LICENSE (MIT)
- woff2otf.js: https://github.com/arty-name/woff2otf/blob/master/woff2otf.js (Apache2)
*/function Ll(){return function(p){var e=Uint8Array,i=Uint16Array,a=Uint32Array,s=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),t=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),n=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),r=function(b,F){for(var R=new i(31),E=0;E<31;++E)R[E]=F+=1<<b[E-1];var I=new a(R[30]);for(E=1;E<30;++E)for(var U=R[E];U<R[E+1];++U)I[U]=U-R[E]<<5|E;return[R,I]},o=r(s,2),c=o[0],l=o[1];c[28]=258,l[258]=28;for(var u=r(t,0)[0],h=new i(32768),d=0;d<32768;++d){var f=(43690&d)>>>1|(21845&d)<<1;f=(61680&(f=(52428&f)>>>2|(13107&f)<<2))>>>4|(3855&f)<<4,h[d]=((65280&f)>>>8|(255&f)<<8)>>>1}var g=function(b,F,R){for(var E=b.length,I=0,U=new i(F);I<E;++I)++U[b[I]-1];var G,X=new i(F);for(I=0;I<F;++I)X[I]=X[I-1]+U[I-1]<<1;{G=new i(1<<F);var D=15-F;for(I=0;I<E;++I)if(b[I])for(var N=I<<4|b[I],L=F-b[I],V=X[b[I]-1]++<<L,B=V|(1<<L)-1;V<=B;++V)G[h[V]>>>D]=N}return G},m=new e(288);for(d=0;d<144;++d)m[d]=8;for(d=144;d<256;++d)m[d]=9;for(d=256;d<280;++d)m[d]=7;for(d=280;d<288;++d)m[d]=8;var v=new e(32);for(d=0;d<32;++d)v[d]=5;var w=g(m,9),T=g(v,5),y=function(b){for(var F=b[0],R=1;R<b.length;++R)b[R]>F&&(F=b[R]);return F},S=function(b,F,R){var E=F/8|0;return(b[E]|b[E+1]<<8)>>(7&F)&R},A=function(b,F){var R=F/8|0;return(b[R]|b[R+1]<<8|b[R+2]<<16)>>(7&F)},P=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],k=function(b,F,R){var E=new Error(F||P[b]);if(E.code=b,Error.captureStackTrace&&Error.captureStackTrace(E,k),!R)throw E;return E},C=function(b,F,R){var E=b.length;if(!E||R&&!R.l&&E<5)return F||new e(0);var I=!F||R,U=!R||R.i;R||(R={}),F||(F=new e(3*E));var G,X=function(ye){var ut=F.length;if(ye>ut){var ht=new e(Math.max(2*ut,ye));ht.set(F),F=ht}},D=R.f||0,N=R.p||0,L=R.b||0,V=R.l,B=R.d,K=R.m,Z=R.n,le=8*E;do{if(!V){R.f=D=S(b,N,1);var Q=S(b,N+1,3);if(N+=3,!Q){var ie=b[(ke=((G=N)/8|0)+(7&G&&1)+4)-4]|b[ke-3]<<8,J=ke+ie;if(J>E){U&&k(0);break}I&&X(L+ie),F.set(b.subarray(ke,J),L),R.b=L+=ie,R.p=N=8*J;continue}if(Q==1)V=w,B=T,K=9,Z=5;else if(Q==2){var Y=S(b,N,31)+257,ee=S(b,N+10,15)+4,fe=Y+S(b,N+5,31)+1;N+=14;for(var ae=new e(fe),me=new e(19),pe=0;pe<ee;++pe)me[n[pe]]=S(b,N+3*pe,7);N+=3*ee;var ne=y(me),Te=(1<<ne)-1,Oe=g(me,ne);for(pe=0;pe<fe;){var ke,Ie=Oe[S(b,N,Te)];if(N+=15&Ie,(ke=Ie>>>4)<16)ae[pe++]=ke;else{var Ee=0,Ae=0;for(ke==16?(Ae=3+S(b,N,3),N+=2,Ee=ae[pe-1]):ke==17?(Ae=3+S(b,N,7),N+=3):ke==18&&(Ae=11+S(b,N,127),N+=7);Ae--;)ae[pe++]=Ee}}var qe=ae.subarray(0,Y),xe=ae.subarray(Y);K=y(qe),Z=y(xe),V=g(qe,K),B=g(xe,Z)}else k(1);if(N>le){U&&k(0);break}}I&&X(L+131072);for(var We=(1<<K)-1,ue=(1<<Z)-1,Fe=N;;Fe=N){var we=(Ee=V[A(b,N)&We])>>>4;if((N+=15&Ee)>le){U&&k(0);break}if(Ee||k(2),we<256)F[L++]=we;else{if(we==256){Fe=N,V=null;break}var _e=we-254;if(we>264){var Ue=s[pe=we-257];_e=S(b,N,(1<<Ue)-1)+c[pe],N+=Ue}var He=B[A(b,N)&ue],ge=He>>>4;if(He||k(3),N+=15&He,xe=u[ge],ge>3&&(Ue=t[ge],xe+=A(b,N)&(1<<Ue)-1,N+=Ue),N>le){U&&k(0);break}I&&X(L+131072);for(var Je=L+_e;L<Je;L+=4)F[L]=F[L-xe],F[L+1]=F[L+1-xe],F[L+2]=F[L+2-xe],F[L+3]=F[L+3-xe];L=Je}}R.l=V,R.p=Fe,R.b=L,V&&(D=1,R.m=K,R.d=B,R.n=Z)}while(!D);return L==F.length?F:function(ye,ut,ht){(ht==null||ht>ye.length)&&(ht=ye.length);var zt=new(ye instanceof i?i:ye instanceof a?a:e)(ht-ut);return zt.set(ye.subarray(ut,ht)),zt}(F,0,L)},M=new e(0),z=typeof TextDecoder<"u"&&new TextDecoder;try{z.decode(M,{stream:!0})}catch{}return p.convert_streams=function(b){var F=new DataView(b),R=0;function E(){var Y=F.getUint16(R);return R+=2,Y}function I(){var Y=F.getUint32(R);return R+=4,Y}function U(Y){ie.setUint16(J,Y),J+=2}function G(Y){ie.setUint32(J,Y),J+=4}for(var X={signature:I(),flavor:I(),length:I(),numTables:E(),reserved:E(),totalSfntSize:I(),majorVersion:E(),minorVersion:E(),metaOffset:I(),metaLength:I(),metaOrigLength:I(),privOffset:I(),privLength:I()},D=0;Math.pow(2,D)<=X.numTables;)D++;D--;for(var N=16*Math.pow(2,D),L=16*X.numTables-N,V=12,B=[],K=0;K<X.numTables;K++)B.push({tag:I(),offset:I(),compLength:I(),origLength:I(),origChecksum:I()}),V+=16;var Z,le=new Uint8Array(12+16*B.length+B.reduce(function(Y,ee){return Y+ee.origLength+4},0)),Q=le.buffer,ie=new DataView(Q),J=0;return G(X.flavor),U(X.numTables),U(N),U(D),U(L),B.forEach(function(Y){G(Y.tag),G(Y.origChecksum),G(V),G(Y.origLength),Y.outOffset=V,(V+=Y.origLength)%4!=0&&(V+=4-V%4)}),B.forEach(function(Y){var ee,fe=b.slice(Y.offset,Y.offset+Y.compLength);if(Y.compLength!=Y.origLength){var ae=new Uint8Array(Y.origLength);ee=new Uint8Array(fe,2),C(ee,ae)}else ae=new Uint8Array(fe);le.set(ae,Y.outOffset);var me=0;(V=Y.outOffset+Y.origLength)%4!=0&&(me=4-V%4),le.set(new Uint8Array(me).buffer,Y.outOffset+Y.origLength),Z=V+me}),Q.slice(0,Z)},Object.defineProperty(p,"__esModule",{value:!0}),p}({}).convert_streams}function Dl(p,e){const i={M:2,L:2,Q:4,C:6,Z:0},a={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},s=1,t=2,n=4,r=8,o=16,c=32;let l;function u(P){if(!l){const k={R:t,L:s,D:n,C:o,U:c,T:r};l=new Map;for(let C in a){let M=0;a[C].split(",").forEach(z=>{let[b,F]=z.split("+");b=parseInt(b,36),F=F?parseInt(F,36):0,l.set(M+=b,k[C]);for(let R=F;R--;)l.set(++M,k[C])})}}return l.get(P)||c}const h=1,d=2,f=3,g=4,m=[null,"isol","init","fina","medi"];function v(P){const k=new Uint8Array(P.length);let C=c,M=h,z=-1;for(let b=0;b<P.length;b++){const F=P.codePointAt(b);let R=u(F)|0,E=h;R&r||(C&(s|n|o)?R&(t|n|o)?(E=f,(M===h||M===f)&&k[z]++):R&(s|c)&&(M===d||M===g)&&k[z]--:C&(t|c)&&(M===d||M===g)&&k[z]--,M=k[b]=E,C=R,z=b,F>65535&&b++)}return k}function w(P,k){const C=[];for(let z=0;z<k.length;z++){const b=k.codePointAt(z);b>65535&&z++,C.push(p.U.codeToGlyph(P,b))}const M=P.GSUB;if(M){const{lookupList:z,featureList:b}=M;let F;const R=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,E=[];b.forEach(I=>{if(R.test(I.tag))for(let U=0;U<I.tab.length;U++){if(E[I.tab[U]])continue;E[I.tab[U]]=!0;const G=z[I.tab[U]],X=/^(isol|init|fina|medi)$/.test(I.tag);X&&!F&&(F=v(k));for(let D=0;D<C.length;D++)(!F||!X||m[F[D]]===I.tag)&&p.U._applySubs(C,D,G,z)}})}return C}function T(P,k){const C=new Int16Array(k.length*3);let M=0;for(;M<k.length;M++){const R=k[M];if(R===-1)continue;C[M*3+2]=P.hmtx.aWidth[R];const E=P.GPOS;if(E){const I=E.lookupList;for(let U=0;U<I.length;U++){const G=I[U];for(let X=0;X<G.tabs.length;X++){const D=G.tabs[X];if(G.ltype===1){if(p._lctf.coverageIndex(D.coverage,R)!==-1&&D.pos){F(D.pos,M);break}}else if(G.ltype===2){let N=null,L=z();if(L!==-1){const V=p._lctf.coverageIndex(D.coverage,k[L]);if(V!==-1){if(D.fmt===1){const B=D.pairsets[V];for(let K=0;K<B.length;K++)B[K].gid2===R&&(N=B[K])}else if(D.fmt===2){const B=p.U._getGlyphClass(k[L],D.classDef1),K=p.U._getGlyphClass(R,D.classDef2);N=D.matrix[B][K]}if(N){N.val1&&F(N.val1,L),N.val2&&F(N.val2,M);break}}}}else if(G.ltype===4){const N=p._lctf.coverageIndex(D.markCoverage,R);if(N!==-1){const L=z(b),V=L===-1?-1:p._lctf.coverageIndex(D.baseCoverage,k[L]);if(V!==-1){const B=D.markArray[N],K=D.baseArray[V][B.markClass];C[M*3]=K.x-B.x+C[L*3]-C[L*3+2],C[M*3+1]=K.y-B.y+C[L*3+1];break}}}else if(G.ltype===6){const N=p._lctf.coverageIndex(D.mark1Coverage,R);if(N!==-1){const L=z();if(L!==-1){const V=k[L];if(y(P,V)===3){const B=p._lctf.coverageIndex(D.mark2Coverage,V);if(B!==-1){const K=D.mark1Array[N],Z=D.mark2Array[B][K.markClass];C[M*3]=Z.x-K.x+C[L*3]-C[L*3+2],C[M*3+1]=Z.y-K.y+C[L*3+1];break}}}}}}}}else if(P.kern&&!P.cff){const I=z();if(I!==-1){const U=P.kern.glyph1.indexOf(k[I]);if(U!==-1){const G=P.kern.rval[U].glyph2.indexOf(R);G!==-1&&(C[I*3+2]+=P.kern.rval[U].vals[G])}}}}return C;function z(R){for(let E=M-1;E>=0;E--)if(k[E]!==-1&&(!R||R(k[E])))return E;return-1}function b(R){return y(P,R)===1}function F(R,E){for(let I=0;I<3;I++)C[E*3+I]+=R[I]||0}}function y(P,k){const C=P.GDEF&&P.GDEF.glyphClassDef;return C?p.U._getGlyphClass(k,C):0}function S(...P){for(let k=0;k<P.length;k++)if(typeof P[k]=="number")return P[k]}function A(P){const k=Object.create(null),C=P["OS/2"],M=P.hhea,z=P.head.unitsPerEm,b=S(C&&C.sTypoAscender,M&&M.ascender,z),F={unitsPerEm:z,ascender:b,descender:S(C&&C.sTypoDescender,M&&M.descender,0),capHeight:S(C&&C.sCapHeight,b),xHeight:S(C&&C.sxHeight,b),lineGap:S(C&&C.sTypoLineGap,M&&M.lineGap),supportsCodePoint(R){return p.U.codeToGlyph(P,R)>0},forEachGlyph(R,E,I,U){let G=0;const X=1/F.unitsPerEm*E,D=w(P,R);let N=0;const L=T(P,D);return D.forEach((V,B)=>{if(V!==-1){let K=k[V];if(!K){const{cmds:Z,crds:le}=p.U.glyphToPath(P,V);let Q="",ie=0;for(let ae=0,me=Z.length;ae<me;ae++){const pe=i[Z[ae]];Q+=Z[ae];for(let ne=1;ne<=pe;ne++)Q+=(ne>1?",":"")+le[ie++]}let J,Y,ee,fe;if(le.length){J=Y=1/0,ee=fe=-1/0;for(let ae=0,me=le.length;ae<me;ae+=2){let pe=le[ae],ne=le[ae+1];pe<J&&(J=pe),ne<Y&&(Y=ne),pe>ee&&(ee=pe),ne>fe&&(fe=ne)}}else J=ee=Y=fe=0;K=k[V]={index:V,advanceWidth:P.hmtx.aWidth[V],xMin:J,yMin:Y,xMax:ee,yMax:fe,path:Q}}U.call(null,K,G+L[B*3]*X,L[B*3+1]*X,N),G+=L[B*3+2]*X,I&&(G+=I*E)}N+=R.codePointAt(N)>65535?2:1}),G}};return F}return function(k){const C=new Uint8Array(k,0,4),M=p._bin.readASCII(C,0,4);if(M==="wOFF")k=e(k);else if(M==="wOF2")throw new Error("woff2 fonts not supported");return A(p.parse(k)[0])}}const zl=Mi({name:"Typr Font Parser",worker:self,dependencies:[Nl,Ll,Dl],init(p,e,i){const a=p(),s=e();return i(a,s)}});/*!
Custom bundle of @unicode-font-resolver/client v1.0.2 (https://github.com/lojjic/unicode-font-resolver)
for use in Troika text rendering. 
Original MIT license applies
*/function Vl(){return function(p){var e=function(){this.buckets=new Map};e.prototype.add=function(T){var y=T>>5;this.buckets.set(y,(this.buckets.get(y)||0)|1<<(31&T))},e.prototype.has=function(T){var y=this.buckets.get(T>>5);return y!==void 0&&(y&1<<(31&T))!=0},e.prototype.serialize=function(){var T=[];return this.buckets.forEach(function(y,S){T.push((+S).toString(36)+":"+y.toString(36))}),T.join(",")},e.prototype.deserialize=function(T){var y=this;this.buckets.clear(),T.split(",").forEach(function(S){var A=S.split(":");y.buckets.set(parseInt(A[0],36),parseInt(A[1],36))})};var i=Math.pow(2,8),a=i-1,s=~a;function t(T){var y=function(A){return A&s}(T).toString(16),S=function(A){return(A&s)+i-1}(T).toString(16);return"codepoint-index/plane"+(T>>16)+"/"+y+"-"+S+".json"}function n(T,y){var S=T&a,A=y.codePointAt(S/6|0);return((A=(A||48)-48)&1<<S%6)!=0}function r(T,y){var S;(S=T,S.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(A){return A.split("-").map(function(P){return parseInt(P.trim(),16)})})).forEach(function(A){var P=A[0],k=A[1];k===void 0&&(k=P),y(P,k)})}function o(T,y){r(T,function(S,A){for(var P=S;P<=A;P++)y(P)})}var c={},l={},u=new WeakMap,h="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function d(T){var y=u.get(T);return y||(y=new e,o(T.ranges,function(S){return y.add(S)}),u.set(T,y)),y}var f,g=new Map;function m(T,y,S){return T[y]?y:T[S]?S:function(A){for(var P in A)return P}(T)}function v(T,y){var S=y;if(!T.includes(S)){S=1/0;for(var A=0;A<T.length;A++)Math.abs(T[A]-y)<Math.abs(S-y)&&(S=T[A])}return S}function w(T){return f||(f=new Set,o("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(y){f.add(y)})),f.has(T)}return p.CodePointSet=e,p.clearCache=function(){c={},l={}},p.getFontsForString=function(T,y){y===void 0&&(y={});var S,A=y.lang;A===void 0&&(A=/\p{Script=Hangul}/u.test(S=T)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(S)?"ja":"en");var P=y.category;P===void 0&&(P="sans-serif");var k=y.style;k===void 0&&(k="normal");var C=y.weight;C===void 0&&(C=400);var M=(y.dataUrl||h).replace(/\/$/g,""),z=new Map,b=new Uint8Array(T.length),F={},R={},E=new Array(T.length),I=new Map,U=!1;function G(N){var L=g.get(N);return L||(L=fetch(M+"/"+N).then(function(V){if(!V.ok)throw new Error(V.statusText);return V.json().then(function(B){if(!Array.isArray(B)||B[0]!==1)throw new Error("Incorrect schema version; need 1, got "+B[0]);return B[1]})}).catch(function(V){if(M!==h)return U||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+M+'", trying default CDN. '+V.message),U=!0),M=h,g.delete(N),G(N);throw V}),g.set(N,L)),L}for(var X=function(N){var L=T.codePointAt(N),V=t(L);E[N]=V,c[V]||I.has(V)||I.set(V,G(V).then(function(B){c[V]=B})),L>65535&&(N++,D=N)},D=0;D<T.length;D++)X(D);return Promise.all(I.values()).then(function(){I.clear();for(var N=function(V){var B=T.codePointAt(V),K=null,Z=c[E[V]],le=void 0;for(var Q in Z){var ie=R[Q];if(ie===void 0&&(ie=R[Q]=new RegExp(Q).test(A||"en")),ie){for(var J in le=Q,Z[Q])if(n(B,Z[Q][J])){K=J;break}break}}if(!K){e:for(var Y in Z)if(Y!==le){for(var ee in Z[Y])if(n(B,Z[Y][ee])){K=ee;break e}}}K||(console.debug("No font coverage for U+"+B.toString(16)),K="latin"),E[V]=K,l[K]||I.has(K)||I.set(K,G("font-meta/"+K+".json").then(function(fe){l[K]=fe})),B>65535&&(V++,L=V)},L=0;L<T.length;L++)N(L);return Promise.all(I.values())}).then(function(){for(var N,L=null,V=0;V<T.length;V++){var B=T.codePointAt(V);if(L&&(w(B)||d(L).has(B)))b[V]=b[V-1];else{L=l[E[V]];var K=F[L.id];if(!K){var Z=L.typeforms,le=m(Z,P,"sans-serif"),Q=m(Z[le],k,"normal"),ie=v((N=Z[le])===null||N===void 0?void 0:N[Q],C);K=F[L.id]=M+"/font-files/"+L.id+"/"+le+"."+Q+"."+ie+".woff"}var J=z.get(K);J==null&&(J=z.size,z.set(K,J)),b[V]=J}B>65535&&(V++,b[V]=b[V-1])}return{fontUrls:Array.from(z.keys()),chars:b}})},Object.defineProperty(p,"__esModule",{value:!0}),p}({})}function Ol(p,e){const i=Object.create(null),a=Object.create(null);function s(n,r){const o=c=>{console.error(`Failure loading font ${n}`,c)};try{const c=new XMLHttpRequest;c.open("get",n,!0),c.responseType="arraybuffer",c.onload=function(){if(c.status>=400)o(new Error(c.statusText));else if(c.status>0)try{const l=p(c.response);l.src=n,r(l)}catch(l){o(l)}},c.onerror=o,c.send()}catch(c){o(c)}}function t(n,r){let o=i[n];o?r(o):a[n]?a[n].push(r):(a[n]=[r],s(n,c=>{c.src=n,i[n]=c,a[n].forEach(l=>l(c)),delete a[n]}))}return function(n,r,{lang:o,fonts:c=[],style:l="normal",weight:u="normal",unicodeFontsURL:h}={}){const d=new Uint8Array(n.length),f=[];n.length||w();const g=new Map,m=[];if(l!=="italic"&&(l="normal"),typeof u!="number"&&(u=u==="bold"?700:400),c&&!Array.isArray(c)&&(c=[c]),c=c.slice().filter(y=>!y.lang||y.lang.test(o)).reverse(),c.length){let P=0;(function k(C=0){for(let M=C,z=n.length;M<z;M++){const b=n.codePointAt(M);if(P===1&&f[d[M-1]].supportsCodePoint(b)||/\s/.test(n[M]))d[M]=d[M-1],P===2&&(m[m.length-1][1]=M);else for(let F=d[M],R=c.length;F<=R;F++)if(F===R){const E=P===2?m[m.length-1]:m[m.length]=[M,M];E[1]=M,P=2}else{d[M]=F;const{src:E,unicodeRange:I}=c[F];if(!I||T(b,I)){const U=i[E];if(!U){t(E,()=>{k(M)});return}if(U.supportsCodePoint(b)){let G=g.get(U);typeof G!="number"&&(G=f.length,f.push(U),g.set(U,G)),d[M]=G,P=1;break}}}b>65535&&M+1<z&&(d[M+1]=d[M],M++,P===2&&(m[m.length-1][1]=M))}v()})()}else m.push([0,n.length-1]),v();function v(){if(m.length){const y=m.map(S=>n.substring(S[0],S[1]+1)).join(`
`);e.getFontsForString(y,{lang:o||void 0,style:l,weight:u,dataUrl:h}).then(({fontUrls:S,chars:A})=>{const P=f.length;let k=0;m.forEach(M=>{for(let z=0,b=M[1]-M[0];z<=b;z++)d[M[0]+z]=A[k++]+P;k++});let C=0;S.forEach((M,z)=>{t(M,b=>{f[z+P]=b,++C===S.length&&w()})})})}else w()}function w(){r({chars:d,fonts:f})}function T(y,S){for(let A=0;A<S.length;A++){const[P,k=P]=S[A];if(P<=y&&y<=k)return!0}return!1}}}const Ul=Mi({name:"FontResolver",worker:self,dependencies:[Ol,zl,Vl],init(p,e,i){return p(e,i())}}),Bl=aa();Bl.webglUtils.resizeWebGLCanvasWithoutClearing;function Gl(p,e){const a=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,s="[^\\S\\u00A0]",t=new RegExp(`${s}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function n({text:f,lang:g,fonts:m,style:v,weight:w,preResolvedFonts:T,unicodeFontsURL:y},S){const A=({chars:P,fonts:k})=>{let C,M;const z=[];for(let b=0;b<P.length;b++)P[b]!==M?(M=P[b],z.push(C={start:b,end:b,fontObj:k[P[b]]})):C.end=b;S(z)};T?A(T):p(f,A,{lang:g,fonts:m,style:v,weight:w,unicodeFontsURL:y})}function r({text:f="",font:g,lang:m,sdfGlyphSize:v=64,fontSize:w=400,fontWeight:T=1,fontStyle:y="normal",letterSpacing:S=0,lineHeight:A="normal",maxWidth:P=1/0,direction:k,textAlign:C="left",textIndent:M=0,whiteSpace:z="normal",overflowWrap:b="normal",anchorX:F=0,anchorY:R=0,metricsOnly:E=!1,unicodeFontsURL:I,preResolvedFonts:U=null,includeCaretPositions:G=!1,chunkedBoundsSize:X=8192,colorRanges:D=null},N){const L=u(),V={fontLoad:0,typesetting:0};f.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),f=f.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),w=+w,S=+S,P=+P,A=A||"normal",M=+M,n({text:f,lang:m,style:y,weight:T,fonts:typeof g=="string"?[{src:g}]:g,unicodeFontsURL:I,preResolvedFonts:U},B=>{V.fontLoad=u()-L;const K=isFinite(P);let Z=null,le=null,Q=null,ie=null,J=null,Y=null,ee=null,fe=null,ae=0,me=0,pe=z!=="nowrap";const ne=new Map,Te=u();let Oe=M,ke=0,Ie=new h;const Ee=[Ie];B.forEach(ue=>{const{fontObj:Fe}=ue,{ascender:we,descender:_e,unitsPerEm:Ue,lineGap:He,capHeight:ge,xHeight:Je}=Fe;let ye=ne.get(Fe);if(!ye){const Be=w/Ue,Ke=A==="normal"?(we-_e+He)*Be:A*w,zs=(Ke-(we-_e)*Be)/2,$e=Math.min(Ke,(we-_e)*Be),Ve=(we+_e)/2*Be+$e/2;ye={index:ne.size,src:Fe.src,fontObj:Fe,fontSizeMult:Be,unitsPerEm:Ue,ascender:we*Be,descender:_e*Be,capHeight:ge*Be,xHeight:Je*Be,lineHeight:Ke,baseline:-zs-we*Be,caretTop:(we+_e)/2*Be+$e/2,caretBottom:Ve-$e},ne.set(Fe,ye)}const{fontSizeMult:ut}=ye,ht=f.slice(ue.start,ue.end+1);let zt,Jt;Fe.forEachGlyph(ht,w,S,(Be,Ke,zs,$e)=>{Ke+=ke,$e+=ue.start,zt=Ke,Jt=Be;const Ve=f.charAt($e),St=Be.advanceWidth*ut,Tt=Ie.count;let Ne;if("isEmpty"in Be||(Be.isWhitespace=!!Ve&&new RegExp(s).test(Ve),Be.canBreakAfter=!!Ve&&t.test(Ve),Be.isEmpty=Be.xMin===Be.xMax||Be.yMin===Be.yMax||a.test(Ve)),!Be.isWhitespace&&!Be.isEmpty&&me++,pe&&K&&!Be.isWhitespace&&Ke+St+Oe>P&&Tt){if(Ie.glyphAt(Tt-1).glyphObj.canBreakAfter)Ne=new h,Oe=-Ke;else for(let It=Tt;It--;)if(It===0&&b==="break-word"){Ne=new h,Oe=-Ke;break}else if(Ie.glyphAt(It).glyphObj.canBreakAfter){Ne=Ie.splitAt(It+1);const _t=Ne.glyphAt(0).x;Oe-=_t;for(let dt=Ne.count;dt--;)Ne.glyphAt(dt).x-=_t;break}Ne&&(Ie.isSoftWrapped=!0,Ie=Ne,Ee.push(Ie),ae=P)}let et=Ie.glyphAt(Ie.count);et.glyphObj=Be,et.x=Ke+Oe,et.y=zs,et.width=St,et.charIndex=$e,et.fontData=ye,Ve===`
`&&(Ie=new h,Ee.push(Ie),Oe=-(Ke+St+S*w)+M)}),ke=zt+Jt.advanceWidth*ut+S*w});let Ae=0;Ee.forEach(ue=>{let Fe=!0;for(let we=ue.count;we--;){const _e=ue.glyphAt(we);Fe&&!_e.glyphObj.isWhitespace&&(ue.width=_e.x+_e.width,ue.width>ae&&(ae=ue.width),Fe=!1);let{lineHeight:Ue,capHeight:He,xHeight:ge,baseline:Je}=_e.fontData;Ue>ue.lineHeight&&(ue.lineHeight=Ue);const ye=Je-ue.baseline;ye<0&&(ue.baseline+=ye,ue.cap+=ye,ue.ex+=ye),ue.cap=Math.max(ue.cap,ue.baseline+He),ue.ex=Math.max(ue.ex,ue.baseline+ge)}ue.baseline-=Ae,ue.cap-=Ae,ue.ex-=Ae,Ae+=ue.lineHeight});let qe=0,xe=0;if(F&&(typeof F=="number"?qe=-F:typeof F=="string"&&(qe=-ae*(F==="left"?0:F==="center"?.5:F==="right"?1:c(F)))),R&&(typeof R=="number"?xe=-R:typeof R=="string"&&(xe=R==="top"?0:R==="top-baseline"?-Ee[0].baseline:R==="top-cap"?-Ee[0].cap:R==="top-ex"?-Ee[0].ex:R==="middle"?Ae/2:R==="bottom"?Ae:R==="bottom-baseline"?Ee[Ee.length-1].baseline:c(R)*Ae)),!E){const ue=e.getEmbeddingLevels(f,k);Z=new Uint16Array(me),le=new Uint8Array(me),Q=new Float32Array(me*2),ie={},ee=[1/0,1/0,-1/0,-1/0],fe=[],G&&(Y=new Float32Array(f.length*4)),D&&(J=new Uint8Array(me*3));let Fe=0,we=-1,_e=-1,Ue,He;if(Ee.forEach((ge,Je)=>{let{count:ye,width:ut}=ge;if(ye>0){let ht=0;for(let $e=ye;$e--&&ge.glyphAt($e).glyphObj.isWhitespace;)ht++;let zt=0,Jt=0;if(C==="center")zt=(ae-ut)/2;else if(C==="right")zt=ae-ut;else if(C==="justify"&&ge.isSoftWrapped){let $e=0;for(let Ve=ye-ht;Ve--;)ge.glyphAt(Ve).glyphObj.isWhitespace&&$e++;Jt=(ae-ut)/$e}if(Jt||zt){let $e=0;for(let Ve=0;Ve<ye;Ve++){let St=ge.glyphAt(Ve);const Tt=St.glyphObj;St.x+=zt+$e,Jt!==0&&Tt.isWhitespace&&Ve<ye-ht&&($e+=Jt,St.width+=Jt)}}const Be=e.getReorderSegments(f,ue,ge.glyphAt(0).charIndex,ge.glyphAt(ge.count-1).charIndex);for(let $e=0;$e<Be.length;$e++){const[Ve,St]=Be[$e];let Tt=1/0,Ne=-1/0;for(let et=0;et<ye;et++)if(ge.glyphAt(et).charIndex>=Ve){let It=et,_t=et;for(;_t<ye;_t++){let dt=ge.glyphAt(_t);if(dt.charIndex>St)break;_t<ye-ht&&(Tt=Math.min(Tt,dt.x),Ne=Math.max(Ne,dt.x+dt.width))}for(let dt=It;dt<_t;dt++){const ds=ge.glyphAt(dt);ds.x=Ne-(ds.x+ds.width-Tt)}break}}let Ke;const zs=$e=>Ke=$e;for(let $e=0;$e<ye;$e++){const Ve=ge.glyphAt($e);Ke=Ve.glyphObj;const St=Ke.index,Tt=ue.levels[Ve.charIndex]&1;if(Tt){const Ne=e.getMirroredCharacter(f[Ve.charIndex]);Ne&&Ve.fontData.fontObj.forEachGlyph(Ne,0,0,zs)}if(G){const{charIndex:Ne,fontData:et}=Ve,It=Ve.x+qe,_t=Ve.x+Ve.width+qe;Y[Ne*4]=Tt?_t:It,Y[Ne*4+1]=Tt?It:_t,Y[Ne*4+2]=ge.baseline+et.caretBottom+xe,Y[Ne*4+3]=ge.baseline+et.caretTop+xe;const dt=Ne-we;dt>1&&l(Y,we,dt),we=Ne}if(D){const{charIndex:Ne}=Ve;for(;Ne>_e;)_e++,D.hasOwnProperty(_e)&&(He=D[_e])}if(!Ke.isWhitespace&&!Ke.isEmpty){const Ne=Fe++,{fontSizeMult:et,src:It,index:_t}=Ve.fontData,dt=ie[It]||(ie[It]={});dt[St]||(dt[St]={path:Ke.path,pathBounds:[Ke.xMin,Ke.yMin,Ke.xMax,Ke.yMax]});const ds=Ve.x+qe,Ci=Ve.y+ge.baseline+xe;Q[Ne*2]=ds,Q[Ne*2+1]=Ci;const ei=ds+Ke.xMin*et,ti=Ci+Ke.yMin*et,si=ds+Ke.xMax*et,ii=Ci+Ke.yMax*et;ei<ee[0]&&(ee[0]=ei),ti<ee[1]&&(ee[1]=ti),si>ee[2]&&(ee[2]=si),ii>ee[3]&&(ee[3]=ii),Ne%X===0&&(Ue={start:Ne,end:Ne,rect:[1/0,1/0,-1/0,-1/0]},fe.push(Ue)),Ue.end++;const es=Ue.rect;if(ei<es[0]&&(es[0]=ei),ti<es[1]&&(es[1]=ti),si>es[2]&&(es[2]=si),ii>es[3]&&(es[3]=ii),Z[Ne]=St,le[Ne]=_t,D){const Ii=Ne*3;J[Ii]=He>>16&255,J[Ii+1]=He>>8&255,J[Ii+2]=He&255}}}}}),Y){const ge=f.length-we;ge>1&&l(Y,we,ge)}}const We=[];ne.forEach(({index:ue,src:Fe,unitsPerEm:we,ascender:_e,descender:Ue,lineHeight:He,capHeight:ge,xHeight:Je})=>{We[ue]={src:Fe,unitsPerEm:we,ascender:_e,descender:Ue,lineHeight:He,capHeight:ge,xHeight:Je}}),V.typesetting=u()-Te,N({glyphIds:Z,glyphFontIndices:le,glyphPositions:Q,glyphData:ie,fontData:We,caretPositions:Y,glyphColors:J,chunkedBounds:fe,fontSize:w,topBaseline:xe+Ee[0].baseline,blockBounds:[qe,xe-Ae,qe+ae,xe],visibleBounds:ee,timings:V})})}function o(f,g){r({...f,metricsOnly:!0},m=>{const[v,w,T,y]=m.blockBounds;g({width:T-v,height:y-w})})}function c(f){let g=f.match(/^([\d.]+)%$/),m=g?parseFloat(g[1]):NaN;return isNaN(m)?0:m/100}function l(f,g,m){const v=f[g*4],w=f[g*4+1],T=f[g*4+2],y=f[g*4+3],S=(w-v)/m;for(let A=0;A<m;A++){const P=(g+A)*4;f[P]=v+S*A,f[P+1]=v+S*(A+1),f[P+2]=T,f[P+3]=y}}function u(){return(self.performance||Date).now()}function h(){this.data=[]}const d=["glyphObj","x","y","width","charIndex","fontData"];return h.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/d.length)},glyphAt(f){let g=h.flyweight;return g.data=this.data,g.index=f,g},splitAt(f){let g=new h;return g.data=this.data.splice(f*d.length),g}},h.flyweight=d.reduce((f,g,m,v)=>(Object.defineProperty(f,g,{get(){return this.data[this.index*d.length+m]},set(w){this.data[this.index*d.length+m]=w}}),f),{data:null,index:0}),{typeset:r,measure:o}}const jl=Mi({name:"Typesetter",worker:self,dependencies:[Gl,Ul,ca],init(p,e,i){return p(e,i())}});Mi({name:"Typesetter",worker:self,dependencies:[jl],init(p){return function(e){return new Promise(i=>{p.typeset(e,i)})}},getTransferables(p){const e=[];for(let i in p)p[i]&&p[i].buffer&&e.push(p[i].buffer);return e}});Nt.prototype.damp=function(p,e,i){this.slerp(p,1-Math.exp(-e*i))};W.prototype.damp=function(p,e,i){this.x=te.damp(this.x,p.x,e,i),this.y=te.damp(this.y,p.y,e,i),this.z=te.damp(this.z,p.z,e,i)};const sr=new wt({color:0,side:Yt,transparent:!0,colorWrite:!1,reflectivity:0,refractionRatio:0}),ho=new he(0),po=new lt,ui=new W,en=new W,Gs=[],Wl=new W,tn="+x+y";let ir=()=>{const p=new Ct(new Zt(1,1),sr);return ir=()=>p,p},nr=()=>{const p=new Ct(new Zt(1,1,32,1),sr);return nr=()=>p,p};const Hl={type:"syncstart"},Xl={type:"synccomplete"},or=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],ql=or.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class rr extends Ct{constructor(){const e=new El;super(e,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=new wt({color:0,side:Yt,transparent:!0,colorWrite:!1}),this.color=16777215,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=ho,this.strokeOpacity=0,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=tn,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1,this.uniforms={uTroikaSdfDebug:O(0),uTroikaSDFTextureSize:O(new Ce),uTroikaSDFGlyphSize:O(0),uTroikaSDFExponent:O(0),uTroikaTotalBounds:O(new Ut(0,0,0,0)),uTroikaClipRect:O(new Ut(0,0,0,0)),uTroikaDistanceOffset:O(0),uTroikaOutlineOpacity:O(0),uTroikaFillOpacity:O(1),uTroikaPositionOffset:O(new Ce),uTroikaCurveRadius:O(0),uTroikaBlurRadius:O(0),uTroikaStrokeWidth:O(0),uTroikaStrokeColor:O(new he(16711680)),uTroikaStrokeOpacity:O(1),uTroikaOrient:O(new la)},this.patchWebGPU(new Float32Array)}patchWebGPU(e){const i=new Uint32Array(e.length);for(let a=0;a<e.length;a++)i[a]=e[a];return this.geometry.instanceCount=1,[i]}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(Hl),se().gl,De.trigger({name:"getTextRenderInfo"},{uuid:this.uuid,text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL}),De.on("textRenderInfo",i=>{if(i.parameters.uuid!==this.uuid)return;this._isSyncing=!1,this._textRenderInfo=i;const[a]=this.patchWebGPU(i.glyphAtlasIndices);this.geometry.updateGlyphs(i.glyphBounds,a,i.blockBounds,i.chunkedBounds,i.glyphColors),this.prepareMaterial(this.material);const s=this._queuedSyncs;s&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{s.forEach(t=>t&&t())})),this.dispatchEvent(Xl),e&&e()})))}prepareMaterial(e){const i=this.textRenderInfo;if(i.sdfTexture.version===this.version)return;let{sdfTexture:a}=i;if(!a.image){const{width:M,height:z,data:b}=i.sdfTexture.source.data;a=new As(b,M,z),a.needsUpdate=!0,i.sdfTexture=a}this.version=i.sdfTexture.version;const{uTroikaSDFTexture:s,uTroikaSdfDebug:t,uTroikaDistanceOffset:n,uTroikaBlurRadius:r,uTroikaPositionOffset:o,uTroikaCurveRadius:c,uTroikaOrient:l,uTroikaFillOpacity:u,uTroikaStrokeWidth:h,uTroikaStrokeColor:d,uTroikaStrokeOpacity:f,uTroikaSDFTextureSize:g,uTroikaSDFGlyphSize:m,uTroikaTotalBounds:v,uTroikaClipRect:w,uTroikaSDFExponent:T}=this.uniforms;e.positionNode=$(()=>{const M=nt("aTroikaGlyphBounds","vec4"),z=nt("aTroikaGlyphIndex","float"),b=q(0,0).toVar(),F=j(M).toVar();F.addAssign(o.x,o.y.negate(),o.x,o.y.negate());const R=j(F).toVar();R.addAssign(n.negate().sub(r),n.negate().sub(r),n.add(r),n.add(r));const E=j(R).toVar(),I=j(Vi(E.xy,w.xy,w.zw),Vi(E.zw,w.xy,w.zw)).toVar(),U=Wt.toVar(),G=q(F.xy).toVar(),X=q(F.zw).toVar(),D=q(Pe(I.xy,I.zw,Se.xy).sub(G).div(X.sub(G))).toVar(),N=H(Pe(G,X,D),Se.z).toVar();b.assign(N.xy.sub(v.xy).div(v.zw.sub(v.xy)));const L=_(c).toVar();re(L.notEqual(0),()=>{const Z=_(N.x.div(L)).toVar();N.x=L.mul(Z.sin()),N.z=L.sub(L.mul(Z.cos())),U.x=Z.sin(),U.z=Z.cos()}),N.assign(l.mul(N));const V=_(g.x.div(m)).toVar(),B=q(m.div(g)).toVar(),K=q(B.mul(q(Ns(xt(_(z).div(4)),V),xt(xt(_(z).div(4)).div(V))))).toVar();return Ft("vec2","vUv").assign(b),Ft("vec2","vTroikaGlyphUV").assign(D.xy),Ft("vec4","vTroikaTextureUVBounds").assign(j(K,q(K).add(B))),Ft("float","vTroikaTextureChannel").assign(Ns(_(z),4)),Ft("vec2","vTroikaGlyphDimensions").assign(q(F.z.sub(F.x),F.w.sub(F.y))),Wt.assign(U),N})();const y=$(([M,z])=>{const b=_(M).toVar(),F=_(rs(z.x,z.y)).toVar(),R=_(Gt(1,wi(Ot(2,ps(b.greaterThan(.5),Gt(1,b),b)),_(1).div(T))).mul(F)).toVar();return _(R.mul(ps(b.greaterThan(.5),-1,1))).toVar()}),S=$(([M,z,b])=>{const F=q(Pe(z.xy,z.zw,M)).toVar(),R=j(be(a,F)).toVar(),E=_(xt(b.add(.5))).toVar();return ps(E.equal(0),R.r,ps(E.equal(1),R.g,ps(E.equal(2),R.b,R.a)))}),A=$(([M,z,b,F])=>{const R=q(M).toVar();return y(S(R,z,b),F)}),P=$(([M,z])=>Lt(ua(M.mul(z))).mul(.5)),k=$(([M,z,b,F])=>{const R=q(Vi(M,mt(.5,m),Gt(1,mt(.5,m)))).toVar(),E=_(A(R,b,F,z)).toVar();return E.addAssign(ps(R.x.equal(M.x).and(R.y.equal(M.y)),0,Lt(M.sub(R).mul(z)))),E}),C=$(([M,z,b])=>{const F=_(b).toVar(),R=_(z).toVar(),E=_(M).toVar();return _(je(R.add(F),R.sub(F),E)).toVar()});e.opacityNode=$(()=>{const M=Ft("vec2","vTroikaGlyphUV"),z=Ft("vec4","vTroikaTextureUVBounds"),b=Ft("float","vTroikaTextureChannel"),F=Ft("vec2","vTroikaGlyphDimensions"),R=_(P(M,F)).toVar(),E=_(k(M,F,z,b)).toVar(),I=_(C(E,n,rs(R,r))).toVar();re(t.greaterThan(0),()=>{I.assign(S(M,z,b))});const U=pi.toVar(),G=j(U).toVar();G.a.mulAssign(u);const X=j(ps(h.equal(0),G,j(d,f))).toVar();return re(G.a.equal(0),()=>{G.assign(X)}),U.assign(Pe(G,X,je(h.negate().sub(R),h.negate().add(R),E))),U.a.mulAssign(I),I.equal(0).discard(),U.a})(),this.material=e,this.material._isUtsuboText=!0,this.material.colorWrite=!0,this.material.transparent=!0,this.material.needsUpdate=!0}onBeforeRender(e,i,a,s,t,n){this.sync(),this._prepareForRender(t),t._hadOwnSide=t.hasOwnProperty("side"),this.geometry.setSide(t._actualSide=t.side),t.side=gt}onAfterRender(e,i,a,s,t,n){t._hadOwnSide?t.side=t._actualSide:delete t.side}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}async _prepareForRender(e){const i=this.uniforms,a=this.textRenderInfo,s=this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY;if(!a)return;if(a){let{sdfTexture:r,blockBounds:o}=a;if(!r.image){const{width:w,height:T,data:y}=a.sdfTexture.source.data;r=new As(y,w,T),r.needsUpdate=!0,a.sdfTexture=r}i.uTroikaSDFTexture=be(r),i.uTroikaSDFTextureSize.value.set(r.image.width,r.image.height),i.uTroikaSDFGlyphSize.value=a.sdfGlyphSize,i.uTroikaSDFExponent.value=a.sdfExponent,i.uTroikaTotalBounds.value.fromArray(o);let c=0,l=0,u=0,h=1,d=0,f,g=0,m=0;if(s){let{outlineWidth:w,outlineOffsetX:T,outlineOffsetY:y,outlineBlur:S,outlineOpacity:A}=this;c=this._parsePercent(w)||0,l=Math.max(0,this._parsePercent(S)||0),h=A,g=this._parsePercent(T)||0,m=this._parsePercent(y)||0}else u=Math.max(0,this._parsePercent(this.strokeWidth)||0),u&&(f=this.strokeColor,i.uTroikaStrokeColor.value.set(f??ho),d=this.strokeOpacity,d==null&&(d=1)),h=this.fillOpacity;i.uTroikaDistanceOffset.value=c,i.uTroikaPositionOffset.value.set(g,m),i.uTroikaBlurRadius.value=l,i.uTroikaStrokeWidth.value=u,i.uTroikaStrokeOpacity.value=d,i.uTroikaFillOpacity.value=h??1,i.uTroikaCurveRadius.value=this.curveRadius||0;let v=this.clipRect;if(v&&Array.isArray(v)&&v.length===4)i.uTroikaClipRect.value.fromArray(v);else{const w=(this.fontSize||.1)*100;i.uTroikaClipRect.value.set(o[0]-w,o[1]-w,o[2]+w,o[3]+w)}this.geometry.applyClipRect(i.uTroikaClipRect.value)}if(!a.sdfTexture)return;e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const t=s?this.outlineColor||0:this.color;e.color.set(t);let n=this.orientation||tn;if(n!==e._orientation){let r=i.uTroikaOrient.value;n=n.replace(/[^-+xyz]/g,"");let o=n!==tn&&n.match(/^([-+])([xyz])([-+])([xyz])$/);if(o){let[,c,l,u,h]=o;ui.set(0,0,0)[l]=c==="-"?1:-1,en.set(0,0,0)[h]=u==="-"?-1:1,po.lookAt(Wl,ui.cross(en),en),r.setFromMatrix4(po)}else r.identity();e._orientation=n}}_parsePercent(e){if(typeof e=="string"){let i=e.match(/^(-?[\d.]+)%$/),a=i?parseFloat(i[1]):NaN;e=(isNaN(a)?0:a/100)*this.fontSize}return e}localPositionToTextCoords(e,i=new Ce){i.copy(e);const a=this.curveRadius;return a&&(i.x=Math.atan2(e.x,Math.abs(a)-Math.abs(e.z))*Math.abs(a)),i}worldPositionToTextCoords(e,i=new Ce){return ui.copy(e),this.localPositionToTextCoords(this.worldToLocal(ui),i)}raycast(e,i){const{textRenderInfo:a,curveRadius:s}=this;if(a){const t=a.blockBounds,n=s?nr():ir(),r=n.geometry,{position:o,uv:c}=r.attributes;for(let l=0;l<c.count;l++){let u=t[0]+c.getX(l)*(t[2]-t[0]);const h=t[1]+c.getY(l)*(t[3]-t[1]);let d=0;s&&(d=s-Math.cos(u/s)*s,u=Math.sin(u/s)*s),o.setXYZ(l,u,h,d)}r.boundingSphere=this.geometry.boundingSphere,r.boundingBox=this.geometry.boundingBox,n.matrixWorld=this.matrixWorld,n.material.side=this.material.side,Gs.length=0,n.raycast(e,Gs);for(let l=0;l<Gs.length;l++)Gs[l].object=this,i.push(Gs[l])}}copy(e){const i=this.geometry;return super.copy(e),this.geometry=i,ql.forEach(a=>{this[a]=e[a]}),this}clone(){return new this.constructor().copy(this)}}or.forEach(p=>{const e="_private_"+p;Object.defineProperty(rr.prototype,p,{get(){return this[e]},set(i){i!==this[e]&&(this[e]=i,this._needsSync=!0)}})});const fo=40,mo=1.2;class Kl extends ze(Xe,{raf:{renderPriority:1,fps:Number.Infinity}}){init({text:e,position:i=new Ce(0,0),color:a=16777215,fontSize:s=fo,lineHeight:t=mo,textAlign:n="center",fontWeight:r="bold",anchorX:o="center",anchorY:c="center",depthWorld:l=!1,dephIndex:u=0}){const h=Me.width,d=Me.height;this.textPosition=i;const f=0,g=h,m=0,v=-d,w=-1,T=1,y=new Ao(f,g,m,v,w,T);y.position.set(0,0,1),y.lookAt(0,0,0),y.updateProjectionMatrix(),y.updateMatrixWorld(),this.orthoCamera=y,this.cameraProjectionMatrix=O(new lt().copy(y.projectionMatrix)),this._modelViewMatrix=O(new lt),this.text=new rr,this.text.text=e;const A="/fonts/PPMori-Medium.woff";this.text.font=A,this.updateStyle({color:a,fontSize:s,lineHeight:t,textAlign:n,fontWeight:r},!1),this.text.anchorX=o,this.text.anchorY=c,this.text.position.set(i.x,-i.y,0),this.text.material.depthTest=!0,this.text.material.transparent=!0,this.text.material.depthWrite=!0,this.text.frustumCulled=!1,this.text.renderOrder=9999,this.revealFactor=O(0),this.text.material.vertexNode=$(()=>(this.text.material.positionNode&&Se.assign(this.text.material.positionNode),this.cameraProjectionMatrix.mul(this._modelViewMatrix).mul(Se).toVar()))(),this.text.material.depthNode=l?ha(this._modelViewMatrix.mul(this.text.material.positionNode?this.text.material.positionNode:Se).z.sub(u).toVar(),da,pa):_(0);const P=new he(a);this.baseColor=new W(P.r,P.g,P.b);const{gl:k}=se();this.text.material.outputNode=$(()=>{const C=_(0).toVar(),M=pi.rgb.toVar();if(k.tFluid!==void 0){const E=k.tFluid.uv(Ze).rgb.remapClamp(0,1).toVar(),I=Lt(k.tFluid.rg).mul(.003).toVar(),U=Tn(_(.5).sub(Ze.x).mul(2),_(.5).sub(Ze.y).mul(2)).toVar(),G=q(q(rt(U),st(U)).mul(I)).toVar(),X=O(new he("#ff9500"));M.assign(Pe(Bn(X,.4),Bn(X,1),Lt(G).mul(5))),C.assign(E.length())}const b=Ft("vec2","vUv").x.div(2).add(.1),F=_(.5),R=b.sub(this.revealFactor).div(F.negate()).saturate();return j(C.mix(pi.rgb,M),pi.a.mul(R.mul(R))).saturate()})(),this.add(this.text),Qe.add(this)}updateStyle({color:e,fontSize:i,lineHeight:a,textAlign:s,fontWeight:t},n=!0){e&&(this.text.color=e),this.text.fontSize=i||fo,this.text.lineHeight=a||mo,s&&(this.text.textAlign=s),t&&(this.text.fontWeight=t),n&&this.text.sync()}updateText(e){this.text.text=e,this.text.sync()}resize({width:e,height:i,position:a,config:s}){this.orthoCamera.aspect=e/i,this.orthoCamera.left=0,this.orthoCamera.right=e,this.orthoCamera.top=0,this.orthoCamera.bottom=-i,this.text.position.set(a.x,-a.y,0),this.orthoCamera.updateMatrixWorld(),this.orthoCamera.updateProjectionMatrix(),s&&this.updateStyle(s,!1),s.anchorX&&(this.text.anchorX=s.anchorX),s.anchorY&&(this.text.anchorY=s.anchorY)}onDebug({gui:e}){}onRaf({camera:e,elapsedTime:i,delta:a}){this._modelViewMatrix.value.multiplyMatrices(this.orthoCamera.matrixWorldInverse,this.text.matrixWorld),this.cameraProjectionMatrix.value=this.orthoCamera.projectionMatrix}dispose(){super.dispose()}}const go=(p,e)=>{if(!p)return"";const i=/<\/?span[^>]*>/gi;p=p.replace(i,"");const a=/<br\s*(?:class="([^"]*)")?\s*\/?>\s*/gi;return p.replace(a,(t,n)=>{if(!n)return`
`;const r=n.split(" ").map(c=>c.trim());let o=!1;return r.forEach(c=>{if(c==="pc")e>767&&(o=!0);else if(c==="sp")e<768&&(o=!0);else if(c.startsWith("w-")){const l=parseInt(c.split("-")[1],10);isNaN(l)||e>l&&(o=!0)}else if(c.startsWith("minw-")){const l=parseInt(c.split("-")[1],10);isNaN(l)||e<l&&(o=!0)}}),o?`
`:" "}).trim()};class $l extends ze(Xe,{raf:{renderPriority:1,fps:Number.Infinity}}){init(){this.headlinesCreated=!1,this.textsConfig=[{id:"progress1",from:0,to:.01,defaultConfig:{text:"",getPosition:()=>new Ce(Me.width/2,Me.height-80),anchorY:"bottom"},mobileConfig:{fontSize:30,getFontSize:()=>Math.min(40,Me.width*.07)}},{id:"progress2",from:.42,to:.72,defaultConfig:{text:"",anchorX:"left",anchorY:"top",textAlign:"left",getPosition:()=>new Ce(85,Me.height/2+90)},mobileConfig:{anchorX:"center",textAlign:"center",fontSize:30,getPosition:()=>new Ce(Me.width/2,110),getFontSize:()=>Math.min(40,Me.width*.07)}},{id:"progress3",from:.04,to:.77,dampExit:40,defaultConfig:{text:"",anchorX:"right",anchorY:"top",textAlign:"right",depthWorld:!0,color:16579836,getPosition:()=>new Ce(Me.width-(Me.width>1279?120:50),180)},mobileConfig:{fontSize:30,getPosition:()=>new Ce(Me.width-30,120),getFontSize:()=>Math.min(40,Me.width*.07)}},{id:"progress4",from:.1,to:.72,dampExit:3,defaultConfig:{text:"",anchorX:"center",anchorY:"bottom",textAlign:"center",depthWorld:!0,dephIndex:.6,getPosition:()=>new Ce(Me.width/2,Me.height-80)},mobileConfig:{fontSize:30,anchorX:"center",anchorY:"top",textAlign:"center",getPosition:()=>new Ce(Me.width/2,110)}}]}createTextUI(e){const i=new Kl(e);return i.visible=!1,i}getEffectiveConfig(e){const i=Me.width<1025,a={...e.defaultConfig};return i&&e.mobileConfig&&(Object.assign(a,e.mobileConfig),e.mobileConfig.getFontSize&&(a.fontSize=e.mobileConfig.getFontSize())),a}onFeedLocalizationToCanvas({headlines:e}){const i=Me.width;this.textsConfig.forEach((a,s)=>{const t=e[s];a.text=t;const n=this.getEffectiveConfig(a);n.text=go(t,i),n.position=n.getPosition(),this.headlinesCreated?a.item.updateText(n.text):a.item=this.createTextUI(n)}),this.headlinesCreated=!0}onResize({width:e,height:i}){this.headlinesCreated&&this.textsConfig?.forEach(a=>{const s=this.getEffectiveConfig(a),t=s.getPosition();s.position=t;const n=go(a.text,e);n!==s.text&&(s.text=n,a.item.updateText(n)),a.item?.resize({width:e,height:i,position:t,config:s})})}onRaf({elapsedTime:e,delta:i}){if(!this.headlinesCreated)return;const{sections:a}=x,{zoomInteraction:s,animMenu:t}=se(),n=this.inSubpage||s||t.value>0,r=x.introTotalAnimProgressAfter.value;this.progress1=a.oneProgress.value,this.progress2=a.twoProgress.value,this.progress3=a.threeProgress.value,this.progress4=a.fourthProgress.value,this.inSubpage=x.inSubpage,this.textsConfig?.forEach(o=>{const c=this[o.id];let l=!n&&c>=o.from&&c<o.to;const u=l?3:o.dampExit||3;o.item.revealFactor.value=te.damp(o.item.revealFactor.value,l?r:0,u,i),o.item.revealFactor.value<.01?(o.item.visible=!1,o.item.revealFactor.value=0):o.item.visible=!0})}}const yo=new WeakMap;class Yl extends fa{static get type(){return"SkinningNode"}constructor(e,i=!1){super("void"),this.skinnedMesh=e,this.useReference=i,this.updateType=Sn.OBJECT,this.skinIndexNode=nt("skinIndex","uvec4"),this.skinWeightNode=nt("skinWeight","vec4");let a,s,t;i?(a=hn("bindMatrix","mat4"),s=hn("bindMatrixInverse","mat4"),t=Gn("skeleton.boneMatrices","mat4",e.skeleton.bones.length)):(a=O(e.bindMatrix,"mat4"),s=O(e.bindMatrixInverse,"mat4"),t=ma(e.skeleton.boneMatrices,"mat4",e.skeleton.bones.length)),this.bindMatrixNode=a,this.bindMatrixInverseNode=s,this.boneMatricesNode=t,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,i=Se){const{skinIndexNode:a,skinWeightNode:s,bindMatrixNode:t,bindMatrixInverseNode:n}=this,r=e.element(a.x),o=e.element(a.y),c=e.element(a.z),l=e.element(a.w),u=t.mul(i),h=Xs(r.mul(s.x).mul(u),o.mul(s.y).mul(u),c.mul(s.z).mul(u),l.mul(s.w).mul(u));return n.mul(h).xyz}getSkinnedNormal(e=this.boneMatricesNode,i=Wt){const{skinIndexNode:a,skinWeightNode:s,bindMatrixNode:t,bindMatrixInverseNode:n}=this,r=e.element(a.x),o=e.element(a.y),c=e.element(a.z),l=e.element(a.w);let u=Xs(s.x.mul(r),s.y.mul(o),s.z.mul(c),s.w.mul(l));return u=n.mul(u).mul(t),u.transformDirection(i).xyz}getPreviousSkinnedPosition(e){const i=e.object;return this.previousBoneMatricesNode===null&&(i.skeleton.previousBoneMatrices=new Float32Array(i.skeleton.boneMatrices),this.previousBoneMatricesNode=Gn("skeleton.previousBoneMatrices","mat4",i.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,jn)}needsPreviousBoneMatrices(e){const i=e.renderer.getMRT();return i&&i.has("velocity")}setup(e){this.needsPreviousBoneMatrices(e)&&jn.assign(this.getPreviousSkinnedPosition(e));const i=this.getSkinnedPosition();if(Se.assign(i),Se.y.mulAssign(-1),Se.y.subAssign(.5),e.hasGeometryAttribute("normal")){const a=this.getSkinnedNormal();Wt.assign(a),e.hasGeometryAttribute("tangent")&&Zs.assign(a)}}generate(e,i){if(i!=="void")return Se.build(e,i)}update(e){const a=(this.useReference?e.object:this.skinnedMesh).skeleton;yo.get(a)!==e.frameId&&(yo.set(a,e.frameId),this.previousBoneMatricesNode!==null&&a.previousBoneMatrices.set(a.boneMatrices),a.update())}}new ga;new W;new W;new W;new lt;new W(0,0,-1);new Ut;new W;new W;new Ut;new Ce;const Zl=new Ss;Ze.flipX();Zl.depthTexture=new vo(1,1);new _i;class Ql extends Qt{static get type(){return"CheetahParticlesNodeMaterial"}constructor(e){super(),this.setValues(e)}setupPosition(e){const{object:i}=e,a=i.geometry;e.addStack(),(a.morphAttributes.position||a.morphAttributes.normal||a.morphAttributes.color)&&No(i).append(),i.isSkinnedMesh===!0&&(n=>ls(new Yl(n)))(i).append(),i.instanceMatrix&&i.instanceMatrix.isInstancedBufferAttribute===!0&&Lo(i).append(),this.positionNode!==null&&Se.assign(this.positionNode);const s=Do();return e.context.vertex=e.removeStack(),e.context.mvp=s,s}}class Jl extends ze(Xe,{raf:{renderPriority:3,fps:1/0}}){init(){this.renderReady=!1;const e=x.cheetahBody;this.parentGroup=x.cheetahParent,this.sandevistanCount=O(this._staticSandevistanCount),this.skinnedMesh=e.getObjectByName("Cheetah_Full");const i=this.skinnedMesh,a=i.skeleton,s=i.geometry.clone();this.cheetahParticles=new vn(s,new Ql({color:16777215,transparent:!0,side:xn,depthWrite:!0,depthTest:!0,roughness:1,metalness:0,map:this.skinnedMesh.userData._tempTexture})),this.cheetahParticles.skeleton=a,this.cheetahParticles.material.outputNode=j(Is.rgb.mul(.05),x.sections.twoProgress),this.cheetahParticles.frustumCulled=!1,this.cheetahParticles.visible=!0;const t=new Ct(new Zt(40,40).rotateX(-Math.PI/2),new _n({color:0,side:gt,depthWrite:!1,transparent:!0}));t.position.x=-1.2,t.position.y=-.25;const n=t.material,r=vt.x.lessThan(.2).select(vt.x.smoothstep(-2.1,.2).oneMinus(),0).pow(.6).toVar(),o=ce.resources.floor_albedo.asset;o.wrapS=pt,o.wrapT=pt,o.needsUpdate=!0;const c=be(o,de().mul(6).sub(q(0,x.globalElapsed.mul(.28)))).rgb,l=ce.resources.floor_normal.asset;l.wrapS=pt,l.wrapT=pt,l.needsUpdate=!0;const u=Mt(be(l,de().mul(6).sub(q(0,x.globalElapsed.mul(.28)))),4),{slowMoLerp:h}=se(),d=h.greaterThan(.8).select(1,h.div(.8)),f=r.mix(Ze,Ze.add(u.rg.mul(.05).mul(d)));n.colorNode=c,n.opacityNode=vt.x.smoothstep(0,1).oneMinus(),n.outputNode=j(Is.rgb.add(gi(f).rgb.mul(se().interactionHighlight.oneMinus())),Is.a.mul(x.sections.twoProgress.smoothstep(.2,.4))),t.frustumCulled=!1,this.add(t),this.add(this.cheetahParticles),Qe.add(this)}onDebug({gui:e}){}onRenderedReady(){this.renderReady=!0}onRaf({gl:e,delta:i}){e.hasStarted!==!1&&(this.visible=this.parentGroup.visible&&x.sections.twoProgress.value>0&&x.sections.twoProgress.value<1,this.visible!==!1&&(this.cheetahParticles.morphTargetInfluences=this.skinnedMesh.morphTargetInfluences,this.cheetahParticles.morphTargetDictionary=this.skinnedMesh.morphTargetDictionary))}updateSandevistan(){}onResize(){}dispose(){super.dispose(),this.gui&&this.gui.destroy()}}class eu extends ze(Xe,{raf:{renderPriority:1,fps:1/0}}){async init(){se().gl;const e=se().videoFrame,i=new As(e,128,128,Ys,ya);i.colorSpace=cs,this.map=i,this.isPlaying=!0,x.videoMap=i}onNewVideoFrame({frame:e}){this.map.image=e,this.map.needsUpdate=!0}onDebug({gui:e}){}onRaf({elapsedTime:e,delta:i}){const a=x.sections.fiveProgress.value;a>.28&&!this.isPlaying?(De.trigger({name:"videoPlay"}),this.isPlaying=!0):a===0&&this.isPlaying&&(De.trigger({name:"videoPause"}),this.isPlaying=!1)}onResize(){}dispose(){super.dispose()}}const mi=$(([p])=>{const e=j(p).toVar();return Ns(e.mul(34).add(1).mul(e),289)}),ar=$(([p])=>{const e=j(p).toVar();return Gt(1.79284291400159,Ot(.85373472095314,e))}),cr=$(([p])=>{const e=H(p).toVar(),i=q(_(1).div(6),_(1).div(3)),a=j(0,.5,1,2),s=H(xt(e.add(tt(e,i.yyy)))).toVar(),t=H(e.sub(s).add(tt(s,i.xxx))).toVar(),n=H(Wn(t.yzx,t.xyz)).toVar(),r=H(Gt(1,n)).toVar(),o=H(va(n.xyz,r.zxy)).toVar(),c=H(rs(n.xyz,r.zxy)).toVar(),l=H(t.sub(o).add(Ot(1,i.xxx))).toVar(),u=H(t.sub(c).add(Ot(2,i.xxx))).toVar(),h=H(t.sub(1).add(Ot(3,i.xxx))).toVar();s.assign(Ns(s,289));const d=j(mi(mi(mi(s.z.add(j(0,o.z,c.z,1))).add(s.y.add(j(0,o.y,c.y,1)))).add(s.x.add(j(0,o.x,c.x,1))))).toVar(),f=_(1).div(7).toVar(),g=H(f.mul(a.wyz).sub(a.xzx)).toVar(),m=j(d.sub(Ot(49,xt(d.mul(g.z.mul(g.z)))))).toVar(),v=j(xt(m.mul(g.z))).toVar(),w=j(xt(m.sub(Ot(7,v)))).toVar(),T=j(v.mul(g.x).add(g.yyyy)).toVar(),y=j(w.mul(g.x).add(g.yyyy)).toVar(),S=j(Gt(1,xs(T).sub(xs(y)))).toVar(),A=j(T.xy,y.xy).toVar(),P=j(T.zw,y.zw).toVar(),k=j(xt(A).mul(2).add(1)).toVar(),C=j(xt(P).mul(2).add(1)).toVar(),M=j(Wn(S,j(0)).negate()).toVar(),z=j(A.xzyw.add(k.xzyw.mul(M.xxyy))).toVar(),b=j(P.xzyw.add(C.xzyw.mul(M.zzww))).toVar(),F=H(z.xy,S.x).toVar(),R=H(z.zw,S.y).toVar(),E=H(b.xy,S.z).toVar(),I=H(b.zw,S.w).toVar(),U=j(ar(j(tt(F,F),tt(R,R),tt(E,E),tt(I,I)))).toVar();F.mulAssign(U.x),R.mulAssign(U.y),E.mulAssign(U.z),I.mulAssign(U.w);const G=j(rs(Gt(.6,j(tt(t,t),tt(l,l),tt(u,u),tt(h,h))),0)).toVar();return G.assign(G.mul(G)),Ot(42,tt(G.mul(G),j(tt(F,t),tt(R,l),tt(E,u),tt(I,h))))});mi.setLayout({name:"permute",type:"vec4",inputs:[{name:"x",type:"vec4"}]});ar.setLayout({name:"taylorInvSqrt",type:"vec4",inputs:[{name:"r",type:"vec4"}]});cr.setLayout({name:"snoise",type:"float",inputs:[{name:"v",type:"vec3"}]});const sn=(p=de())=>cr(p.convert("vec2|vec3")),ys=$(([p])=>{const e=H(p).toVar(),i=_(sn(H(e))).toVar(),a=_(sn(H(e.y.sub(19.1),e.z.add(33.4),e.x.add(47.2)))).toVar(),s=_(sn(H(e.z.add(74.2),e.x.sub(124.5),e.y.add(99.4)))).toVar();return H(i,a,s).toVar()}),tu=$(([p])=>{const e=H(p).toVar(),i=_(.1),a=H(i,0,0).toVar(),s=H(0,i,0).toVar(),t=H(0,0,i).toVar(),n=H(ys(e.sub(a))).toVar(),r=H(ys(e.add(a))).toVar(),o=H(ys(e.sub(s))).toVar(),c=H(ys(e.add(s))).toVar(),l=H(ys(e.sub(t))).toVar(),u=H(ys(e.add(t))).toVar(),h=_(c.z.sub(o.z.sub(u.y)).add(l.y)).toVar(),d=_(u.x.sub(l.x.sub(r.z)).add(n.z)).toVar(),f=_(r.y.sub(n.y.sub(c.x)).add(o.x)).toVar(),g=_(mt(1,Ot(2,i)));return di(H(h,d,f).mul(g))});ys.setLayout({name:"snoiseVec3",type:"vec3",inputs:[{name:"x",type:"vec3"}]});tu.setLayout({name:"curlNoise",type:"vec3",inputs:[{name:"p",type:"vec3"}]});class su extends ze(Xe,{raf:{renderPriority:10,fps:1/0}}){async init(){this.name="Insects_Waves",this.renderedOnce=!1,this.speed=O(3),this.fadeIn=O(0);const e=1e3,i=3,{gl:a,scene:s}=se(),t=new Dt(e,i),n=new Dt(e,i),r=new Dt(e,i),o=ct(t,"vec3",e),c=ct(n,"vec3",e),l=ct(r,"vec3",e),u=[new Ut(1.1,.4,0,1.6),new Ut(-.9,-.3,.4,2),new Ut(.5,.3,-1.8,1.4),new Ut(-.6,-.2,3.2,2.2),new Ut(.3,.4,1.6,1.6),new Ut(-.2,.4,.3,1.8)],h=Oo(u,"vec4"),d=[10,8,10];this.pointerSize=O(.1),this.isPositionInCircle=$(([z,b,F,R])=>{const E=Es(!1).toVar(),I=b.toVar(),U=F.mul(R),G=z.x.mul(R),D=I.x.mul(R).sub(G),N=I.y.sub(z.y),L=D.mul(D).add(N.mul(N));return E.assign(L.lessThanEqual(U.mul(U))),E}).setLayout({name:"isPositionInCircle",type:"bool",inputs:[{name:"screenPosition",type:"vec2"},{name:"pointerPosition",type:"vec2"},{name:"pointerSize",type:"float"},{name:"aspectRatio",type:"float"}]});const f=$(({renderer:z,geometry:b})=>{b.setAttribute("storagePosition",t),b.setAttribute("storageVelocity",r);const F=$(()=>{const E=o.element(oe),I=c.element(oe),U=_(e).div(u.length).floor(),G=_(oe).div(U).floor().toVar(),X=h.element(G).toVar(),D=H(X.x,X.y,X.z).toVar(),N=X.w.toVar(),L=Rt(oe).toVar(),V=Rt(oe.add(e)).toVar(),B=L.mul(Math.PI*2).toVar(),Z=_(oe).mod(U).div(U),Q=Z.mul(N).sub(N.mul(.5)).toVar().add(D.z).toVar(),ie=d[0]*15e-5,J=V.sqrt().mul(ie).toVar(),Y=Z.sub(.5).mul(2).toVar(),ee=Y.mul(Y).oneMinus().toVar(),ae=J.mul(_(1).add(ee.mul(3))).toVar(),me=B.sin().mul(ae).add(D.x),pe=B.cos().mul(ae).add(D.y),ne=H(me,pe,Q).toVar();ne.y.addAssign(.15),E.assign(ne),I.assign(ne)})().compute(e),R=$(()=>{const E=o.element(oe),I=l.element(oe),U=c.element(oe).toVar();E.addAssign(I),re(E.z.lessThan(-d[2]*.5),()=>{E.x.assign(U.x),E.y.assign(U.y),E.z.addAssign(d[2]),I.assign(H(0))});const G=x.screenSpaceMatrix.mul(E);re(G.w.greaterThan(0),()=>{const ne=G.xyz.div(G.w),Te=q(ne.x,ne.y);re(this.isPositionInCircle(Te,x.normalizedPointer,this.pointerSize,x.aspectRatio),()=>{const Oe=x.normalizedPointer.toVar(),ke=this.pointerSize.mul(x.aspectRatio),Ie=Te.x.mul(x.aspectRatio),Ae=Oe.x.mul(x.aspectRatio).sub(Ie),qe=Oe.y.sub(Te.y),xe=Ae.mul(Ae).add(qe.mul(qe)),We=q(Ae,qe),ue=xe.sqrt(),Fe=ke,we=_(.5),_e=_(1).sub(je(_(0),Fe,ue)),He=We.div(ue).mul(_e).mul(we.negate());I.x.addAssign(He.x),I.y.addAssign(He.y);const ge=_(.02),Je=I.x.mul(I.x).add(I.y.mul(I.y));re(Je.greaterThan(ge.mul(ge)),()=>{const ye=_s(Je);I.mulAssign(ge.div(ye))})})});const X=H(0,.23,.45),D=Ks.x.lessThan(x.spBreakPoint).select(.32,.21).toVar(),N=x.screenSpaceMatrix.mul(X);re(G.w.greaterThan(0),()=>{const ne=G.xyz.div(G.w),Te=q(ne.x,ne.y),Oe=N.xyz.div(N.w),ke=q(Oe.x,Oe.y);re(this.isPositionInCircle(Te,ke,D,x.aspectRatio),()=>{const Ie=ke.toVar(),Ee=D.mul(x.aspectRatio),Ae=Te.x.mul(x.aspectRatio),xe=Ie.x.mul(x.aspectRatio).sub(Ae),We=Ie.y.sub(Te.y),ue=xe.mul(xe).add(We.mul(We)),Fe=q(xe,We),we=ue.sqrt(),_e=_(1.5),Ue=_(1).sub(je(_(0),Ee,we)),ge=Fe.div(we).mul(Ue).mul(_e.negate());I.x.addAssign(ge.x),I.y.addAssign(ge.y);const Je=_(.06),ye=I.x.mul(I.x).add(I.y.mul(I.y));re(ye.greaterThan(Je.mul(Je)),()=>{const ut=_s(ye);I.mulAssign(Je.div(ut))})})}),re(E.y.lessThanEqual(-.28),()=>{I.mulAssign(H(1,-1,1))});const L=_(e).div(u.length).floor(),V=_(oe).div(L).floor().toVar(),K=h.element(V).toVar().w.toVar(),Z=_(1.5),le=_(.01),Q=_(.2),ie=x.globalElapsed,J=E.z.mul(Z).add(ie.mul(Q)),Y=st(J).mul(le);E.x.addAssign(Y);const fe=_(18).mul(Ps).mul(this.speed);E.z.subAssign(fe.mul(K));const ae=_(1/120),pe=_(.96).pow(Ps.div(ae));I.mulAssign(pe)})().compute(e);return R.onInit(()=>z.compute(F)),R}),g=nt("storagePosition"),m=nt("storageVelocity"),v=new Ts;v.setAttribute("position",new $t(new Float32Array(3),3)),v.drawRange.count=1;const w={};w.blending=Go,w.transparent=!0,w.alphaTest=.1;const T=new er({transparent:!0,depthWrite:!1,...w});T.geometryNode=f(),T.positionNode=g;const y=O(.08);T.scaleNode=$s(0,1).mul(y);const S=$s(0,1),A=O(us("#ff9500")),P=O(us("#4eb0dc")),k=Pe(A,P,S.oneMinus().pow(1.2).oneMinus()),C=_(.1).div(de().sub(.5).length()).sub(.2);Ks.x.lessThan(x.spBreakPoint).select(18,12),T.colorNode=j(k.mul(m.xy.length().mul(30).add(1)),C.mul(.3).mul(this.fadeIn)),T.alphaTest=.01;const M=new Pi(new Zt(1,1),T);M.count=e,M.frustumCulled=!1,M.material.fog=!1,this.points=M,this.add(M),s.add(this)}onRenderedReady(){this.renderedOnce=!0,x.inSubpage&&(this.visible=!1)}onDebug({gui:e}){}onPointerMove({pointer:e}){}onRaf({gl:e,elapsedTime:i,delta:a}){const{sections:s}=x,t=s.twoProgress.value,n=s.oneEndProgress.value;if((t>=1||n<.5)&&this.renderedOnce){this.visible=!1;return}this.fadeIn.value=te.damp(this.fadeIn.value,t>.85?1:0,2.5,a),this.visible=!0,this.speed.value=Math.min(.17,t*.17*2)}onResize(){}dispose(){super.dispose()}}class iu extends jo{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.interpolationFactor=x.sections.fiveProgress.smoothstep(0,.4).add(.003),this.particleSize=e.particleSize||64,this.setValues(e)}setupPosition(e){const{object:i,camera:a,context:s}=e;e.addStack();const{positionNode:t,interpolationFactor:n,particleSize:r,scaleNode:o}=this,c=Se,l=H().toVar();t!==null&&l.assign(t);const u=qs.mul(l).toVar(),h=Et().toVar();let d=q(bi[0].xyz.length(),bi[1].xyz.length()).toVar();o!==null&&(d=d.mul(o).toVar()),q(5);let f=c.xy;f=f.mul(d);const g=_(0),m=Uo(f,g);Se.assign(m),u.assign(j(u.xy.add(m),u.zw));const v=oe.toFloat().mod(r),w=_(r-1).sub(oe.toFloat().div(r).floor()),T=j(v.div(r).mul(2).sub(1),w.div(r).mul(2).sub(1),0,1).toVar(),y=j(Pe(T.x,u.x,n),Pe(T.y,u.y,n),Pe(T.z,u.z,n),1),A=un.mul(u);s.vertex=c;const P=m.mul(2),k=P.x,C=P.y,M=k.mul(k),z=C.mul(C),b=M.add(z),R=xa(b).max(0).sqrt(),E=H(k,C,R).normalize().toVar();h.element(0).element(0).assign(d.x.mul(rt(g))),h.element(0).element(1).assign(d.x.mul(st(g)).negate()),h.element(0).element(2).assign(0),h.element(0).element(3).assign(y.x),h.element(1).element(0).assign(d.y.mul(st(g))),h.element(1).element(1).assign(d.y.mul(rt(g))),h.element(1).element(2).assign(0),h.element(1).element(3).assign(y.y),h.element(2).element(0).assign(0),h.element(2).element(1).assign(0),h.element(2).element(2).assign(1),h.element(2).element(3).assign(y.z),h.element(3).element(0).assign(0),h.element(3).element(1).assign(0),h.element(3).element(2).assign(0),h.element(3).element(3).assign(1);const I=ba(E,h);return Wt.assign(I),hs.assign(y),e.context.vertex=e.removeStack(),e.context.mvp=A,A}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}class nu extends ze(Xe,{raf:{renderPriority:1,fps:1/0}}){async init(){this.speed=O(1);let e=128,i=128;const a=O(.03);se().isMobileOrTablet&&(e=64,i=64,a.value=.06);const s=500,t=e*i+s,n=3,r=[0,3,.3],o=H(r[0],r[1],r[2]),c=128,l=128,u=2.3,h=new Float32Array(e*i*3+s*3),d=new Float32Array(e*i*3+s*3);function f(D){const N=D%e,L=i-1-Math.floor(D/e);return[N,L]}for(let D=0;D<e*i;D++){const[N,L]=f(D),V=N*c/e,B=L*l/i,K=(V-c/2)/(c/2),Z=(B-l/2)/(l/2),le=Math.atan2(Z,K),Q=Math.sqrt(K*K+Z*Z),ie=Math.min(Q,1)*u,J=ie*Math.cos(le),Y=ie*Math.sin(le),ee=0,fe=J+r[0],ae=Y+r[1],me=ee+r[2],pe=D*3;h[pe]=fe,h[pe+1]=ae,h[pe+2]=me,d[pe]=fe,d[pe+1]=ae,d[pe+2]=me}const g=2,m=(D,N)=>Math.random()*(N-D)+D,v=(D,N,L,V)=>{const B=m(D,N);return B>=L?B+(V-L):B};for(let D=0;D<s;D++){const N=v(-6,6,-3,3),L=Math.random()*g*2-.25,V=v(-6,6,-3,3),B=D*3+e*i*3;h[B]=N,h[B+1]=L,h[B+2]=V,d[B]=N,d[B+1]=L,d[B+2]=V}const{scene:w}=se(),T=$(({geometry:D})=>{const N=new Dt(h,n),L=new Dt(d,n),V=new Dt(t,n);D.setAttribute("particle",N),D.setAttribute("origin",L),D.setAttribute("velocity",V);const B=ct(N,"vec3",t),K=ct(L,"vec3",t),Z=ct(V,"vec3",t);return this.pointerSize=O(.1),this.isPositionInCircle=$(([Q,ie,J])=>{const Y=Es(!1).toVar(),ee=ie.toVar(),fe=J.mul(x.aspectRatio),ae=Q.x.mul(x.aspectRatio),pe=ee.x.mul(x.aspectRatio).sub(ae),ne=ee.y.sub(Q.y),Te=pe.mul(pe).add(ne.mul(ne));return Y.assign(Te.lessThanEqual(fe.mul(fe))),Y}).setLayout({name:"isPositionInCircle",type:"bool",inputs:[{name:"screenPosition",type:"vec2"},{name:"pointerPosition",type:"vec2"},{name:"pointerSize",type:"float"}]}),$(()=>{const Q=B.element(oe),ie=Z.element(oe),J=K.element(oe);Q.sub(o).toVar();const Y=_(1/120),ee=_(.955).toVar();re(oe.greaterThan(e*i),()=>{ee.assign(_(.985))});const fe=ee.pow(Ps.div(Y));Q.assign(fe.mix(J,Q));const ae=_(15.558),me=_(15.5),pe=_(.8);re(oe.greaterThan(e*i),()=>{const ke=H(.02).mul(me).mul(Bo(Q.mul(100).mul(ae).add(Ls.mul(1e-4).mul(pe))));ie.addAssign(ke.mul(.001))}),ie.mulAssign(fe),Q.addAssign(ie);const ne=x.screenSpaceMatrix.mul(Q),Te=ne.xyz.div(ne.w),Oe=q(Te.x,Te.y);re(ne.w.greaterThan(0),()=>{const ke=x.pointerDelta;re(this.isPositionInCircle(Oe,x.normalizedPointer,this.pointerSize),()=>{const Ie=x.normalizedPointer.toVar(),Ee=this.pointerSize.mul(x.aspectRatio),Ae=Oe.x.mul(x.aspectRatio),xe=Ie.x.mul(x.aspectRatio).sub(Ae),We=Ie.y.sub(Oe.y),ue=xe.mul(xe).add(We.mul(We)),Fe=q(xe,We),we=ue.sqrt(),_e=Ee,Ue=_(2.8),He=_(1).sub(je(_(0),_e,we)),Je=Fe.div(we).mul(He).mul(Ue.negate()).mul(ke.min(.1));re(oe.lessThan(e*i),()=>{ie.z.addAssign(Je.xy.length())}).Else(()=>{ie.addAssign(Je)});const ye=_(.04),ut=ie.x.mul(ie.x).add(ie.y.mul(ie.y));re(ut.greaterThan(ye.mul(ye)),()=>{const ht=_s(ut);ie.mulAssign(ye.div(ht))})})})})().compute(t)}),y=new Ts;y.setAttribute("position",new $t(new Float32Array(3),3)),y.drawRange.count=1;const S=new iu({color:16777215,particleSize:e,metalness:0,roughness:1});S.scaleNode=a,H(1,1,1).toVar(),H(.8,.6,0).toVar();const A=$s(0,1),P=O(us("#ff9500")),k=O(us("#4eb0dc"));Pe(P,k,A.oneMinus().pow(2).oneMinus());const C=je(.3,2,hs.z.negate()).oneMinus();_(_(.1).add(C.div(2))).div(de().sub(.5).length()).sub(_(.2).add(C.mul(1))),Ks.x.lessThan(x.spBreakPoint).select(18,12),nt("velocity").element(oe);const M=oe.toFloat().mod(e).toInt(),z=oe.toFloat().div(e).floor().toInt(),b=oe.greaterThan(e*i).select(Rt(oe).mul(c).toInt(),M.mul(c/e)),F=oe.greaterThan(e*i).select(Rt(oe.add(1)).mul(l).toInt(),z.mul(l/i));let R=H(1,1,1).toVar();x.videoMap&&(R=Ge(x.videoMap,Le(b,F)).varying("videoParticle")),S.colorNode=R.rgb.mul(fs(R.rgb).length().add(R.r).mul(oe.lessThan(e*i).select(x.sections.fiveProgress.smoothstep(0,.5).mix(1,nt("particle").xy.distance(o.xy).smoothstep(u/1.75,u).oneMinus()),1)).mul(oe.greaterThan(e*i).select(.5,10))).max(_(oe.greaterThan(e*i).select(.1,0))).add(Pn.r.mul(Se.z.smoothstep(0,.2))),S.alphaTestNode=$(()=>{const D=de().mul(2).sub(1);return wa(D).greaterThan(1)})();const E=nt("particle");S.normalNode=$(()=>{const D=fs(Ge(x.videoMap,Le(b.sub(1).max(0),F)).rgb).length().mul(E.xy.distance(o.xy).smoothstep(u/1.75,u).oneMinus()).mul(4.5).min(20),N=fs(Ge(x.videoMap,Le(b.add(1).min(c-1),F)).rgb).length().mul(E.xy.distance(o.xy).smoothstep(u/1.75,u).oneMinus()).mul(4.5).min(20),L=fs(Ge(x.videoMap,Le(b,F.sub(1).max(0))).rgb).length().mul(E.xy.distance(o.xy).smoothstep(u/1.75,u).oneMinus()).mul(4.5).min(20),V=fs(Ge(x.videoMap,Le(b,F.add(1).min(l-1))).rgb).length().mul(E.xy.distance(o.xy).smoothstep(u/1.75,u).oneMinus()).mul(4.5).min(20),B=N.sub(D).mul(.25),K=V.sub(L).mul(.25),Z=15,le=H(B.mul(-Z),K.mul(-Z),1);let Q=Hn(le);if(se().isWebGPU&&!se().isMobileOrTablet){const ie=nt("particle"),J=.6,Y=ie.pow(10).mul(1-J);Q=le.mul(J).add(Hn(Y)).normalize()}return Q})(),S.positionNode=$(()=>{const D=E.toVar();return re(oe.lessThanEqual(e*i),()=>{D.addAssign(H(0,0,fs(R.rgb).length()).mul(E.xy.distance(o.xy).smoothstep(u/1.75,u).oneMinus()).mul(2).min(20)),D.mul(fs(R.rgb).length().mul(E.xy.distance(o.xy).smoothstep(u/1.75,u).oneMinus()).add(1))}).Else(()=>{}),D})();const I=new Ts,U=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),G=new _o(U,5);if(I.setIndex([0,1,2,0,2,3]),I.setAttribute("position",new cn(G,3,0,!1)),I.setAttribute("uv",new cn(G,2,3,!1)),se().isWebGPU&&!se().isMobileOrTablet)S.geometryNode=T();else{const D=new yn(h,n);I.setAttribute("particle",D)}const X=new Pi(I,S);X.count=t,X.frustumCulled=!1,X.material.fog=!1,this.points=X,this.add(X),w.add(this)}onDebug({gui:e}){}onPointerMove({pointer:e}){}onRaf({gl:e,elapsedTime:i,delta:a}){if(e.hasStarted===!1)return;const s=x.sections.fiveProgress.value;this.visible=!x.inSubpage&&s>0}onResize(){}dispose(){super.dispose()}}let hi=null;class ou extends qo{static get type(){return"ViewportSharedMipTextureSmoke"}constructor(e=Ze,i=null){hi===null&&(hi=new Ko,hi.minFilter=Ai),super(e,i,hi),this.generateMipmaps=!0}updateReference(){return this}}const nn=wn(ou);class ru extends ze(Xe,{raf:{renderPriority:2,fps:yt}}){init(){const i=ce.resources.paw_smoke_scene.asset.scene.clone(),a=ce.resources.paw_smoke?.asset;this.progress=O(0),this.progress2=O(0),this.isSection2=O(0);const s=i.getObjectByName("smoke_mid");if(a){s.material=new wt({color:16777215,side:gt,reflectivity:0,refractionRatio:0,transparent:!0});const h=_(this.progress).toVar(),d=it(h.floor()).toVar(),f=h.fract().toVar();s.position.z=.07,s.material.outputNode=$(()=>{const g=be(a,de()),m=g.depth(d).r.toVar();return re(d.lessThan(200),()=>{m.assign(Pe(m,g.depth(d.add(1)).r,f))}),m.mulAssign(10),re(m.r.lessThan(.01),()=>{Oi()}),j(nn(Ze).blur(_(.5).add(m.r.saturate().mul(.1))).add(m.r.mul(.2)).rgb,m.r.mul(2).saturate().mul(.98))})()}else s.visible=!1;const t=ce.resources.moon_smoke_front_texture?.asset,n=i.getObjectByName("smoke_front"),r=_(this.progress2).toVar(),o=it(r.floor()).toVar(),c=r.fract().toVar();t?(n.position.z=-.07,n.position.y=-.01,n.material=new wt({color:16777215,side:gt,reflectivity:0,refractionRatio:0,transparent:!0,depthWrite:!1,depthTest:!0}),n.material.outputNode=$(()=>{const h=be(t,de()),d=h.depth(o).r.toVar();return re(o.lessThan(200),()=>{d.assign(Pe(d,h.depth(o.add(1)).r,c))}),re(d.r.lessThan(.01),()=>{Oi()}),j(nn(Ze).blur(_(.5).add(d.r.saturate().mul(.1))).add(d.r.mul(.2)).rgb,d.r.mul(2).saturate().mul(.98))})()):n.visible=!1;const l=i.getObjectByName("smoke_back"),u=ce.resources.moon_smoke_back_texture?.asset;u?(l.position.x=.07,l.position.z=-.07,l.position.y=-.01,l.material=new wt({color:16777215,side:gt,reflectivity:0,refractionRatio:0,transparent:!0}),l.material.outputNode=$(()=>{const h=be(u,de()),d=h.depth(o).r.toVar();return re(o.lessThan(200),()=>{d.assign(Pe(d,h.depth(o.add(1)).r,c))}),re(d.r.lessThan(.01),()=>{Oi()}),j(nn(Ze).blur(_(.5).add(d.r.saturate().mul(.1))).add(d.r.mul(.2)).rgb,d.r.mul(2).saturate().mul(.98))})()):l.visible=!1,this.add(i),Qe.add(this)}onDebug({gui:e}){}onRenderedReady(){this.visible=!0}onRaf({gl:e,delta:i}){if(e.hasStarted===!1)return;const a=x.sections.threeProgress.value>0,s=x.sections.fourthProgress.value===0;if(this.visible=a&&s&&!x.inSubpage,this.visible===!1)return;const t=Math.min(1,x.sections.threeProgress.value+14/150);this.progress.value=ot(.2,1,t)*150,this.progress2.value=ot(0,1,t)*150}onResize(){}dispose(){super.dispose()}}class au extends ze(null,{raf:{renderPriority:0,fps:yt}}){init({gl:e}){this.gl=e,this.slowMoLerp=1,Bt({gl:e}),La.start(),bt.lookAt(bt.target),this.isOffscreen=typeof window>"u",ce.load()}onInitStats({stats:e}){console.log("üèóÔ∏è Debug mode is enabled"),e&&Bt({stats:e})}onSectionInteraction({slowMo:e,zoomInteraction:i}){const a={};e!==void 0&&(a.slowMo=e),i!==void 0&&(a.zoomInteraction=i),Bt(a)}onPageTransition({pageTransition:e}){Bt({pageTransition:e})}onInSubPage({inSubpage:e}){x.inSubpage=e}onMenuOpen({open:e}){Bt({menuOpen:e})}onSectionProgress({progressValues:e,currentSection:i}){if(this.isOffscreen){for(let a=0;a<e.length;a++){const{id:s,progress:t}=e[a];x.sections[s].value=t}x.sections.current=i}}onRaf({delta:e}){const i=x.sections.twoProgress.value<1,{slowMoLerp:a,animMenu:s,interactionHighlight:t,speed:n,slowMo:r}=se(),o=1-.025;a.value=te.damp(a.value,r?.05:t.value===0?1:1-o*t.value,2,e);const c=1-s.value*(i?.5:1);n.value=a.value*c,x.globalElapsed.value+=e*1.5*c,x.globalTimer.value=e*1.5*c}onDebug({gui:e}){e&&(x.isDebug=!0,this.folder=e.addFolder("Navigation"),this.folder.add({jumpToSection3:()=>{const a=x.sectionsDom.find(t=>t.id==="section3"),s=document.body.clientHeight*a.from;De.trigger({name:"lenis:scrollTo"},{target:s,options:{immediate:!0}})}},"jumpToSection3").name("Jump to Section 3"),this.folder.add({jumpToSection4:()=>{const a=x.sectionsDom.find(t=>t.id==="section4"),s=document.body.clientHeight*a.from;De.trigger({name:"lenis:scrollTo"},{target:s,options:{immediate:!0}})}},"jumpToSection4").name("Jump to Section 4"),this.folder.add({jumpToSection5:()=>{const i=document.body.clientHeight;De.trigger({name:"lenis:scrollTo"},{target:i,options:{immediate:!0}})}},"jumpToSection5").name("Jump to Section 5"))}onStartWebsite({initial:e}){const{websiteStarted:i,introCheetahSeen:a}=x;if(!(i&&a||!i&&!e)){if(x.websiteStarted=!0,x.inSubpage){Xt.to(x.introEyeAnimProgress,{value:1,duration:3.2,delay:0,ease:"power3.out"}),Xt.to(x.introAnimProgress,{value:1,duration:4,delay:0,ease:"power2.inOut"});return}a||(x.introEyeAnimProgress.value=0,x.introAnimProgress.value=0),Xt.to(x.introEyeAnimProgress,{value:1,duration:5,delay:.2,ease:"power2.out"}),Xt.to(x.introAnimProgress,{value:1,duration:4,delay:1.2,ease:"power2.inOut"}),Xt.to(x.introTotalAnimProgress,{value:1,duration:3.9,delay:.3,ease:"power1.inOut"}),Xt.to(x.introTotalAnimProgressAfter,{value:1,duration:3,delay:2.2,ease:"power3.out",onComplete:()=>{x.introCheetahSeen=!0,De.trigger({name:"introCheetahSeen"})}}),Xt.to(x.introTrackingEnabled,{value:1,duration:5,delay:3,ease:"power3.out"})}}async onLoadEnd(){const e=ce.resources.fractal.asset;e.wrapS=e.wrapT=pt,e.colorSpace=ws;const i=ce.resources.hdr.asset;i.mapping=Sa,i.colorSpace=jt,i.needsUpdate=!0;const a=new Cl;a.environment=i,a.environmentIntensity=1,new eu;const s=ce.resources.concrete.asset;s.wrapS=pt,s.wrapT=pt,s.repeat.set(10,10),s.needsUpdate=!0;const t=ce.resources.grain.asset;t.wrapS=pt,t.wrapT=pt,t.needsUpdate=!0,new Tl,new al,new su;const n=ce.resources.moon_xs.asset,r=ce.resources.surface_xs_bake.asset;new Qi(n,r);const o=ce.resources.moon_md.asset,c=ce.resources.surface_md_bake.asset;new Qi(o,c);const l=ce.resources.moon_xl.asset,u=ce.resources.surface_xl_bake.asset;new Qi(l,u),new il,new ol,se().isMobileOrTablet||new ru,new cl,new vl,new bl,new Sl,new ll,new Jl,new wl,new Rl,new Ml,new nu,se().isMobileOrTablet||new $l}}async function cu(p,e,i,a,s,t,n){let r=!1;try{Bt({isWebGPU:e,isIOS:a,isOffscreen:i,isSafari:s,isMobileOrTablet:t,dpr:n});const o=new Qc({canvas:p,isWebGPU:e});await o.init(),new au({gl:o}),r=!0}catch(o){console.error(o)}return r}let ks=null;async function lu(p){try{ks&&(ks=null),ks=p,De.trigger({name:"newVideoFrame"},{frame:p})}catch(e){console.error("Error processing frame:",e)}return!0}self.addEventListener("unload",()=>{ks&&(ks.close(),ks=null)});function uu(p,e){De.trigger(p,e),p.name==="resize"&&Me.setSize(e.width,e.height),p.name,p.fireVirtualEvents&&Me.dispatchEvent({...e,target:Me})}function hu(p){const e={},i=s=>(e[s]||(e[s]=t=>{t&&t[_a]||s&&p({name:s,data:Pa(t)})}),e[s]),a=s=>{const{newEvent:t}=s;if(t!=="newEventRegistered"){const n=i(t);De.isHandlerRegistered(t,n)||De.on(t,n)}};De.on("newEventRegistered",a);for(const s in De.listeners){const t=i(s);De.isHandlerRegistered(s,t)||De.on(s,t)}}const du={initOffscreen:cu,processVideoFrame:lu,trigger:uu,subscribeToAllEvents:hu};Ta(du);
