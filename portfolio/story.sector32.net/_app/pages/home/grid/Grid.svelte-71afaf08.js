import{O as M,S as z,i as A,s as I,W as D,e as v,k as b,c as p,a as S,d as w,n as C,b as u,f as y,I as f,J as H,A as _,P as W}from"../../../chunks/vendor-e41d84ae.js";class T{constructor(t=!1){this.allowTouch=t,this.x=this.slowX=this.xMax=0,this.y=this.slowY=this.yMax=0,this.pctX=this.slowPctX=0,this.pctY=this.slowPctY=0,this.isInited=this.isMobile=!1,window.addEventListener("mousemove",this.handleMouseMove.bind(this)),window.addEventListener("touchstart",this.handleTouchStart.bind(this)),this.allowTouch&&(window.addEventListener("touchmove",this.handleTouchmove.bind(this)),window.addEventListener("touchend",this.handleTouchmove.bind(this))),setInterval(this.loop.bind(this),30)}handleTouchStart(t){this.isMobile=!0,this.allowTouch&&(this.isInited=!0,this.handleTouchmove(t))}handleTouchmove(t){var i=t.touches[0];this.x=i.clientX,this.y=i.clientY}handleMouseMove(t){(!this.isMobile||this.isMobile&&this.allowTouch)&&(this.x=t.clientX,this.y=t.clientY,this.isInited=!0)}loop(){this.isInited&&(this.slowX+=(this.x-this.slowX)*.1,this.slowY+=(this.y-this.slowY)*.1)}getPosition(t){if(t){var i=t.getBoundingClientRect();return this.calculatePosition(i.left,i.top,i.width,i.height)}else{const e=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),h=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);return this.calculatePosition(0,0,e,h)}}calculatePosition(t,i,e,h){var s={};return s.x=this.x-t,s.y=this.y-i,s.slowX=this.slowX-t,s.slowY=this.slowY-i,s.pctX=s.x/e,s.pctY=s.y/h,s.slowPctX=s.slowX/e,s.slowPctY=s.slowY/h,s}}class P{constructor(t){this.ctx=t.getContext("2d"),this.canvas=t}setSize(t,i){this.width=this.canvas.width=t,this.height=this.canvas.height=i}getDepth(t){return this.imageData&&this.imageData.data?this.imageData.data[t*4]:0}}class E extends P{constructor(){super(drawCanvas)}render(t,i){this.ctx.filter="blur(2px)";let e=(this.width+this.height)/25;e=Math.max(.8,e),this.ctx.beginPath(),this.ctx.fillStyle="#FFF",this.ctx.arc(t*this.width,i*this.height,e,0,2*Math.PI),this.ctx.fill(),this.ctx.fillStyle=`rgba(0,0,0,${.03})`,this.ctx.fillRect(0,0,this.width,this.height),this.imageData=this.ctx.getImageData(0,0,this.width,this.height)}}class X extends P{constructor(){super(imgCanvas);this.ctx.imageSmoothingEnabled=!1,this.ctx.imageSmoothingQuality="high",imgSrc.onload=this.loadHandler.bind(this),this.pos={x:0,y:0},this.scale=0,M.to(this,2,{overwrite:!1,repeat:-1,yoyo:!0,ease:"sine.easeInOut",scale:1})}setSize(t,i){super.setSize(t,i)}load(t,i){imgSrc.src=t,this.callback=i}loadHandler(){this.srcWidth=imgSrc.width,this.srcHeight=imgSrc.height,this.startTweenX(),this.startTweenY(),this.callback()}startTweenX(){const t=Math.random()*(this.srcWidth-this.width),h=Math.abs(t-this.pos.x)/(this.srcWidth-this.width)*45;M.to(this.pos,h,{overwrite:!1,onComplete:this.startTweenX.bind(this),ease:"sine.easeInOut",x:t})}startTweenY(){const t=Math.random()*(this.srcHeight-this.height),h=Math.abs(t-this.pos.y)/(this.srcHeight-this.height)*45;M.to(this.pos,h,{overwrite:!1,onComplete:this.startTweenY.bind(this),ease:"sine.easeInOut",y:t})}render(){this.ctx.globalAlpha=.1,this.ctx.drawImage(imgSrc,this.pos.x,this.pos.y,this.width,this.height,0,0,this.width,this.height),this.imageData=this.ctx.getImageData(0,0,this.width,this.height)}}class Y{constructor(t,i){this.canvas=t,this.container=i,this.ctx=this.canvas.getContext("2d"),this.mousePosition=new T(!1),this.bump=new X,this.draw=new E,this.bgColor="#000f30",this.isActive=!1,this.state=1,this.setSize(),setTimeout(this.setSize.bind(this),500),window.addEventListener("resize",this.setSize.bind(this)),this.bump.load("/images/home/displacement.png",this.loadHandler.bind(this))}show(){this.isActive=!0,this.mainAlpha=.01}activate(){this.isActive=!0}deactivate(){this.isActive=!1}setState(t){this.state=t}loadHandler(){setInterval(this.loop.bind(this),40),this.showPct=1,M.to(this,1.5,{ease:"Sine.easeOut",showPct:0})}setSize(){var t=document.documentElement.clientHeight,i=document.documentElement.clientWidth;this.windowWidth=i,this.windowHeight=t;const e=this.container.offsetWidth,h=this.container.offsetHeight,s=e,a=h;this.canvas.width=s,this.canvas.height=a,this.canvas.style.width=e+"px",this.canvas.style.height=h+"px";let o=Math.round(s/20);this.gridSizeBase=Math.max(40,Math.min(70,o)),this.columns=Math.ceil(s/this.gridSizeBase),this.rows=Math.ceil(a/this.gridSizeBase),this.gridWidth=Math.ceil(s/this.columns),this.gridHeight=Math.ceil(a/this.rows),this.gridWidthHalf=this.gridWidth*.5,this.gridHeightHalf=this.gridHeight*.5,this.cellCenterSize=Math.round((this.gridWidthHalf+this.gridWidthHalf)/5),this.cellCenterRadius=this.gridWidthHalf+this.gridWidthHalf*5.5,this.colStart=Math.ceil((s-this.gridWidth*this.columns)*.5),this.rowStart=Math.ceil((a-this.gridHeight*this.rows)*.5),this.cells=[];for(let l=0;l<this.rows;l++)for(let n=0;n<this.columns;n++)this.cells.push(new R(n,l));this.bump.setSize(this.columns,this.rows),this.draw.setSize(this.columns,this.rows),this.loop()}loop(){this.isActive&&(this.mainAlpha<1&&(this.mainAlpha*=1.2,this.mainAlpha=Math.min(1,this.mainAlpha)),this.drawCells())}drawCells(){this.bump.render();var t;this.mousePosition.isInited&&(t=this.mousePosition.getPosition(this.container),this.state!=2&&this.draw.render(t.slowPctX,t.slowPctY)),this.ctx.fillStyle=this.bgColor,this.ctx.fillRect(0,0,5e3,5e3);const i=this.cells.length;for(let e=0;e<i;e++){let h=this.cells[e];this.drawCell(h,e,t)}}drawCell(t,i,e){const h=t.column*this.gridWidth+this.colStart,s=t.row*this.gridHeight+this.rowStart,a=h+this.gridWidthHalf,o=s+this.gridHeightHalf,l=this.bump.getDepth(i)/256;let n;if(this.state!=2){const d=this.draw.getDepth(i)/256;n=Math.max(l,d)}else n=l;n=Math.max(0,n-this.showPct),this.state==1?this.drawCell1(h,s,a,o,n,e):this.state==2&&this.drawCell2(h,s,a,o,n,e)}drawCell1(t,i,e,h,s,a){t-=14-s*28,i-=14-s*28;let o=Math.max(0,1-s*1.2);this.ctx.fillStyle=`rgba(43,93,113,${o*.8*this.mainAlpha})`,this.ctx.fillRect(t,i,this.gridWidth*.98,this.gridHeight*.98),e-=14-s*28,h-=14-s*28;let l=s*this.cellCenterSize*.4,n;if(this.mousePosition.isInited){const d=Math.dist(e,h,a.slowX,a.slowY);n=1-d/this.cellCenterRadius*.6,n=Math.max(0,Math.min(1,n)),l-=n*this.cellCenterSize*1}if(l=Math.abs(l),s>.1||n>0){n>.5?this.ctx.fillStyle=`rgba(247,0,0,${this.mainAlpha})`:this.ctx.fillStyle=`rgba(43,93,113,${this.mainAlpha})`;let d=Math.min(this.gridWidth,this.gridHeight)*(1-this.mainAlpha)*s;l=Math.max(d,l),this.ctx.fillRect(e-l*.5,h-l*.5,l,l)}}drawCell2(t,i,e,h,s,a){e-=20-s*40,h-=20-s*40;let o=(.2+s*.8)*this.cellCenterSize*.7,l=0;if(this.mousePosition.isInited){const d=Math.dist(e,h,a.slowX,a.slowY);l=1-d/this.cellCenterRadius,l=Math.max(0,Math.min(1,l)),o+=l*this.cellCenterSize*.7}o=Math.abs(o);let n=Math.min(this.gridWidth,this.gridHeight)*(1-this.mainAlpha)*s;o=Math.max(n,o),this.ctx.fillStyle=`rgba(173,199,214,${.3+l*.5})`,this.ctx.fillRect(e-o*.5,h-o*.5,o,o)}}class R{constructor(t,i){this.column=t,this.row=i}}function B(r){let t,i,e,h,s,a,o,l,n,d,g;return{c(){t=v("div"),i=v("canvas"),e=b(),h=v("div"),s=b(),a=v("div"),o=v("img"),l=b(),n=v("canvas"),d=b(),g=v("canvas"),this.h()},l(c){t=p(c,"DIV",{class:!0});var m=S(t);i=p(m,"CANVAS",{class:!0}),S(i).forEach(w),e=C(m),h=p(m,"DIV",{class:!0}),S(h).forEach(w),m.forEach(w),s=C(c),a=p(c,"DIV",{class:!0});var x=S(a);o=p(x,"IMG",{alt:!0,id:!0,class:!0}),l=C(x),n=p(x,"CANVAS",{id:!0,class:!0}),S(n).forEach(w),d=C(x),g=p(x,"CANVAS",{id:!0,class:!0}),S(g).forEach(w),x.forEach(w),this.h()},h(){u(i,"class","noiseCanvas"),u(h,"class","flash svelte-iauu4t"),u(t,"class","noiseContainer svelte-iauu4t"),u(o,"alt","imgSrc"),u(o,"id","imgSrc"),u(o,"class","svelte-iauu4t"),u(n,"id","imgCanvas"),u(n,"class","svelte-iauu4t"),u(g,"id","drawCanvas"),u(g,"class","svelte-iauu4t"),u(a,"class","src svelte-iauu4t")},m(c,m){y(c,t,m),f(t,i),r[6](i),f(t,e),f(t,h),r[7](h),r[8](t),y(c,s,m),y(c,a,m),f(a,o),f(a,l),f(a,n),f(a,d),f(a,g)},p:H,i:H,o:H,d(c){c&&w(t),r[6](null),r[7](null),r[8](null),c&&w(s),c&&w(a)}}}function V(r,t,i){let e,h,s,{cells:a}=t;_(async()=>{i(3,a=new Y(h,e))});const o=()=>{a.show()},l=()=>{a.setState(2),a.show(),M.from(s,{duration:.3,opacity:1,ease:"Power4.easeIn"})};function n(c){W[c?"unshift":"push"](()=>{h=c,i(1,h)})}function d(c){W[c?"unshift":"push"](()=>{s=c,i(2,s)})}function g(c){W[c?"unshift":"push"](()=>{e=c,i(0,e)})}return r.$$set=c=>{"cells"in c&&i(3,a=c.cells)},[e,h,s,a,o,l,n,d,g]}class L extends z{constructor(t){super();A(this,t,V,B,I,{cells:3,show:4,doSwitch:5})}get cells(){return this.$$.ctx[3]}set cells(t){this.$$set({cells:t}),D()}get show(){return this.$$.ctx[4]}get doSwitch(){return this.$$.ctx[5]}}export{L as default};
